webphone_api.platformClass = function () {
    "use strict";

    function e(e) {
        return e = String(e), e.charAt(0).toUpperCase() + e.slice(1)
    }

    function o(e, o, t) {
        var i = {
            "10.0": "10",
            6.4: "10 Technical Preview",
            6.3: "8.1",
            6.2: "8",
            6.1: "Server 2008 R2 / 7",
            "6.0": "Server 2008 / Vista",
            5.2: "Server 2003 / XP 64-bit",
            5.1: "XP",
            5.01: "2000 SP1",
            "5.0": "2000",
            "4.0": "NT",
            "4.90": "ME"
        };
        return o && t && /^Win/i.test(e) && !/^Windows Phone /i.test(e) && (i = i[/[\d.]+$/.exec(e)]) && (e = "Windows " + i), e = String(e), o && t && (e = e.replace(RegExp(o, "i"), t)), e = n(e.replace(/ ce$/i, " CE").replace(/\bhpw/i, "web").replace(/\bMacintosh\b/, "Mac OS").replace(/_PowerPC\b/i, " OS").replace(/\b(OS X) [^ \d]+/i, "$1").replace(/\bMac (OS X)\b/, "$1").replace(/\/(\d)/, " $1").replace(/_/g, ".").replace(/(?: BePC|[ .]*fc[ \d.]+)$/i, "").replace(/\bx86\.64\b/gi, "x86_64").replace(/\b(Windows Phone) OS\b/, "$1").replace(/\b(Chrome OS \w+) [\d.]+\b/, "$1").split(" on ")[0])
    }

    function t(e, o) {
        var t = -1, n = e ? e.length : 0;
        if ("number" == typeof n && n > -1 && n <= b) for (; ++t < n;) o(e[t], t, e); else i(e, o)
    }

    function n(o) {
        return o = p(o), /^(?:webOS|i(?:OS|P))/.test(o) ? o : e(o)
    }

    function i(e, o) {
        for (var t in e) w.call(e, t) && o(e[t], t, e)
    }

    function a(o) {
        return null == o ? e(o) : v.call(o).slice(8, -1)
    }

    function r(e, o) {
        var t = null != e ? typeof e[o] : "number";
        return !(/^(?:boolean|number|string|undefined)$/.test(t) || "object" == t && !e[o])
    }

    function s(e) {
        return String(e).replace(/([ -])(?!$)/g, "$1?")
    }

    function l(e, o) {
        var n = null;
        return t(e, function (t, i) {
            n = o(n, t, i, e)
        }), n
    }

    function p(e) {
        return String(e).replace(/^ +| +$/g, "")
    }

    function c(e) {
        function t(o) {
            return l(o, function (o, t) {
                var i = t.pattern || s(t);
                return !o && (o = RegExp("\\b" + i + " *\\d+[.\\w_]*", "i").exec(e) || RegExp("\\b" + i + " *\\w+-[\\w]*", "i").exec(e) || RegExp("\\b" + i + "(?:; *(?:[a-z]+[_-])?[a-z]+\\d+|[^ ();-]*)", "i").exec(e)) && ((o = String(t.label && !RegExp(i, "i").test(t.label) ? t.label : o).split("/"))[1] && !/[\d.]+/.test(o[0]) && (o[0] += " " + o[1]), t = t.label || t, o = n(o[0].replace(RegExp(i, "i"), t).replace(RegExp("; *(?:" + t + "[_-])?", "i"), " ").replace(RegExp("(" + t + ")[-_.]?(\\w)", "i"), "$1 $2"))), o
            })
        }

        function u() {
            return this.description || ""
        }

        var m = h, g = e && "object" == typeof e && "String" != a(e);
        g && (m = e, e = null);
        var d = m.navigator || {}, b = d.userAgent || "";
        e || (e = b);
        var f, w, E = g ? !!d.likeChrome : /\bChrome\b/.test(e) && !/internal|\n/i.test(v.toString()),
            T = g ? "Object" : "ScriptBridgingProxyObject", P = g ? "Object" : "Environment",
            S = g && m.java ? "JavaPackage" : a(m.java), N = g ? "Object" : "RuntimeObject",
            I = /\bJava/.test(S) && m.java, C = I && a(m.environment) == P, R = I ? "a" : "α", y = I ? "b" : "β",
            L = m.document || {}, D = m.operamini || m.opera,
            G = _.test(G = g && D ? D["[[Class]]"] : a(D)) ? G : D = null, O = e, x = [], A = null, k = e == b,
            U = k && D && "function" == typeof D.version && D.version(), V = function (o) {
                return l(o, function (o, t) {
                    return o || RegExp("\\b" + (t.pattern || s(t)) + "\\b", "i").exec(e) && (t.label || t)
                })
            }([{ label: "EdgeHTML", pattern: "(?:Edge|EdgA|EdgiOS)" }, "Trident", {
                label: "WebKit",
                pattern: "AppleWebKit"
            }, "iCab", "Presto", "NetFront", "Tasman", "KHTML", "Gecko"]), W = function (o) {
                return l(o, function (o, t) {
                    return o || RegExp("\\b" + (t.pattern || s(t)) + "\\b", "i").exec(e) && (t.label || t)
                })
            }(["Adobe AIR", "Arora", "Avant Browser", "Breach", "Camino", "Electron", "Epiphany", "Fennec", "Flock", "Galeon", "GreenBrowser", "iCab", "Iceweasel", "K-Meleon", "Konqueror", "Lunascape", "Maxthon", {
                label: "Microsoft Edge",
                pattern: "(?:Edge|Edg|EdgA|EdgiOS)"
            }, "Midori", "Nook Browser", "PaleMoon", "PhantomJS", "Raven", "Rekonq", "RockMelt", {
                    label: "Samsung Internet",
                    pattern: "SamsungBrowser"
                }, "SeaMonkey", {
                    label: "Silk",
                    pattern: "(?:Cloud9|Silk-Accelerated)"
                }, "Sleipnir", "SlimBrowser", {
                    label: "SRWare Iron",
                    pattern: "Iron"
                }, "Sunrise", "Swiftfox", "Waterfox", "WebPositive", "Opera Mini", {
                    label: "Opera Mini",
                    pattern: "OPiOS"
                }, "Opera", { label: "Opera", pattern: "OPR" }, "Chrome", {
                    label: "Chrome Mobile",
                    pattern: "(?:CriOS|CrMo)"
                }, { label: "Firefox", pattern: "(?:Firefox|Minefield)" }, {
                    label: "Firefox for iOS",
                    pattern: "FxiOS"
                }, { label: "IE", pattern: "IEMobile" }, { label: "IE", pattern: "MSIE" }, "Safari"]),
            M = t([{ label: "BlackBerry", pattern: "BB10" }, "BlackBerry", {
                label: "Galaxy S",
                pattern: "GT-I9000"
            }, { label: "Galaxy S2", pattern: "GT-I9100" }, {
                label: "Galaxy S3",
                pattern: "GT-I9300"
            }, { label: "Galaxy S4", pattern: "GT-I9500" }, { label: "Galaxy S5", pattern: "SM-G900" }, {
                label: "Galaxy S6",
                pattern: "SM-G920"
            }, { label: "Galaxy S6 Edge", pattern: "SM-G925" }, {
                label: "Galaxy S7",
                pattern: "SM-G930"
            }, {
                label: "Galaxy S7 Edge",
                pattern: "SM-G935"
            }, "Google TV", "Lumia", "iPad", "iPod", "iPhone", "Kindle", {
                label: "Kindle Fire",
                pattern: "(?:Cloud9|Silk-Accelerated)"
            }, "Nexus", "Nook", "PlayBook", "PlayStation Vita", "PlayStation", "TouchPad", "Transformer", {
                label: "Wii U",
                pattern: "WiiU"
            }, "Wii", "Xbox One", { label: "Xbox 360", pattern: "Xbox" }, "Xoom"]), F = function (o) {
                return l(o, function (o, t, n) {
                    return o || (t[M] || t[/^[a-z]+(?: +[a-z]+\b)*/i.exec(M)] || RegExp("\\b" + s(n) + "(?:\\b|\\w*\\d)", "i").exec(e)) && n
                })
            }({
                Apple: { iPad: 1, iPhone: 1, iPod: 1 },
                Archos: {},
                Amazon: { Kindle: 1, "Kindle Fire": 1 },
                Asus: { Transformer: 1 },
                "Barnes & Noble": { Nook: 1 },
                BlackBerry: { PlayBook: 1 },
                Google: { "Google TV": 1, Nexus: 1 },
                HP: { TouchPad: 1 },
                HTC: {},
                LG: {},
                Microsoft: { Xbox: 1, "Xbox One": 1 },
                Motorola: { Xoom: 1 },
                Nintendo: { "Wii U": 1, Wii: 1 },
                Nokia: { Lumia: 1 },
                Samsung: { "Galaxy S": 1, "Galaxy S2": 1, "Galaxy S3": 1, "Galaxy S4": 1 },
                Sony: { PlayStation: 1, "PlayStation Vita": 1 }
            }), H = function (t) {
                return l(t, function (t, n) {
                    var i = n.pattern || s(n);
                    return !t && (t = RegExp("\\b" + i + "(?:/[\\d.]+|[ \\w.]*)", "i").exec(e)) && (t = o(t, i, n.label || n)), t
                })
            }(["Windows Phone", "Android", "CentOS", {
                label: "Chrome OS",
                pattern: "CrOS"
            }, "Debian", "Fedora", "FreeBSD", "Gentoo", "Haiku", "Kubuntu", "Linux Mint", "OpenBSD", "Red Hat", "SuSE", "Ubuntu", "Xubuntu", "Cygwin", "Symbian OS", "hpwOS", "webOS ", "webOS", "Tablet OS", "Tizen", "Linux", "Mac OS X", "Macintosh", "Mac", "Windows 98;", "Windows "]);
        if (V && (V = [V]), F && !M && (M = t([F])), (f = /\bGoogle TV\b/.exec(M)) && (M = f[0]), /\bSimulator\b/i.test(e) && (M = (M ? M + " " : "") + "Simulator"), "Opera Mini" == W && /\bOPiOS\b/.test(e) && x.push("running in Turbo/Uncompressed mode"), "IE" == W && /\blike iPhone OS\b/.test(e) ? (f = c(e.replace(/like iPhone OS/, "")), F = f.manufacturer, M = f.product) : /^iP/.test(M) ? (W || (W = "Safari"), H = "iOS" + ((f = / OS ([\d_]+)/i.exec(e)) ? " " + f[1].replace(/_/g, ".") : "")) : "Konqueror" != W || /buntu/i.test(H) ? F && "Google" != F && (/Chrome/.test(W) && !/\bMobile Safari\b/i.test(e) || /\bVita\b/.test(M)) || /\bAndroid\b/.test(H) && /^Chrome/.test(W) && /\bVersion\//i.test(e) ? (W = "Android Browser", H = /\bAndroid\b/.test(H) ? H : "Android") : "Silk" == W ? (/\bMobi/i.test(e) || (H = "Android", x.unshift("desktop mode")), /Accelerated *= *true/i.test(e) && x.unshift("accelerated")) : "PaleMoon" == W && (f = /\bFirefox\/([\d.]+)\b/.exec(e)) ? x.push("identifying as Firefox " + f[1]) : "Firefox" == W && (f = /\b(Mobile|Tablet|TV)\b/i.exec(e)) ? (H || (H = "Firefox OS"), M || (M = f[1])) : !W || (f = !/\bMinefield\b/i.test(e) && /\b(?:Firefox|Safari)\b/.exec(W)) ? (W && !M && /[\/,]|^[^(]+?\)/.test(e.slice(e.indexOf(f + "/") + 8)) && (W = null), (f = M || F || H) && (M || F || /\b(?:Android|Symbian OS|Tablet OS|webOS)\b/.test(H)) && (W = /[a-z]+(?: Hat)?/i.exec(/\bAndroid\b/.test(H) ? H : f) + " Browser")) : "Electron" == W && (f = (/\bChrome\/([\d.]+)\b/.exec(e) || 0)[1]) && x.push("Chromium " + f) : H = "Kubuntu", U || (U = function (o) {
            return l(o, function (o, t) {
                return o || (RegExp(t + "(?:-[\\d.]+/|(?: for [\\w-]+)?[ /-])([\\d.]+[^ ();/_-]*)", "i").exec(e) || 0)[1] || null
            })
        }(["(?:Cloud9|CriOS|CrMo|Edge|Edg|EdgA|EdgiOS|FxiOS|IEMobile|Iron|Opera ?Mini|OPiOS|OPR|Raven|SamsungBrowser|Silk(?!/[\\d.]+$))", "Version", s(W), "(?:Firefox|Minefield|NetFront)"])), (f = "iCab" == V && parseFloat(U) > 3 && "WebKit" || /\bOpera\b/.test(W) && (/\bOPR\b/.test(e) ? "Blink" : "Presto") || /\b(?:Midori|Nook|Safari)\b/i.test(e) && !/^(?:Trident|EdgeHTML)$/.test(V) && "WebKit" || !V && /\bMSIE\b/i.test(e) && ("Mac OS" == H ? "Tasman" : "Trident") || "WebKit" == V && /\bPlayStation\b(?! Vita\b)/i.test(W) && "NetFront") && (V = [f]), "IE" == W && (f = (/; *(?:XBLWP|ZuneWP)(\d+)/i.exec(e) || 0)[1]) ? (W += " Mobile", H = "Windows Phone " + (/\+$/.test(f) ? f : f + ".x"), x.unshift("desktop mode")) : /\bWPDesktop\b/i.test(e) ? (W = "IE Mobile", H = "Windows Phone 8.x", x.unshift("desktop mode"), U || (U = (/\brv:([\d.]+)/.exec(e) || 0)[1])) : "IE" != W && "Trident" == V && (f = /\brv:([\d.]+)/.exec(e)) && (W && x.push("identifying as " + W + (U ? " " + U : "")), W = "IE", U = f[1]), k) {
            if (r(m, "global")) if (I && (f = I.lang.System, O = f.getProperty("os.arch"), H = H || f.getProperty("os.name") + " " + f.getProperty("os.version")), C) {
                try {
                    U = m.require("ringo/engine").version.join("."), W = "RingoJS"
                } catch (j) {
                    (f = m.system) && f.global.system == m.system && (W = "Narwhal", H || (H = f[0].os || null))
                }
                W || (W = "Rhino")
            } else "object" == typeof m.process && !m.process.browser && (f = m.process) && ("object" == typeof f.versions && ("string" == typeof f.versions.electron ? (x.push("Node " + f.versions.node), W = "Electron", U = f.versions.electron) : "string" == typeof f.versions.nw && (x.push("Chromium " + U, "Node " + f.versions.node), W = "NW.js", U = f.versions.nw)), W || (W = "Node.js", O = f.arch, H = f.platform, U = /[\d.]+/.exec(f.version), U = U ? U[0] : null)); else a(f = m.runtime) == T ? (W = "Adobe AIR", H = f.flash.system.Capabilities.os) : a(f = m.phantom) == N ? (W = "PhantomJS", U = (f = f.version || null) && f.major + "." + f.minor + "." + f.patch) : "number" == typeof L.documentMode && (f = /\bTrident\/(\d+)/i.exec(e)) ? (U = [U, L.documentMode], (f = +f[1] + 4) != U[1] && (x.push("IE " + U[1] + " mode"), V && (V[1] = ""), U[1] = f), U = "IE" == W ? String(U[1].toFixed(1)) : U[0]) : "number" == typeof L.documentMode && /^(?:Chrome|Firefox)\b/.test(W) && (x.push("masking as " + W + " " + U), W = "IE", U = "11.0", V = ["Trident"], H = "Windows");
            H = H && n(H)
        }
        if (U && (f = /(?:[ab]|dp|pre|[ab]\d+pre)(?:\d+\+?)?$/i.exec(U) || /(?:alpha|beta)(?: ?\d)?/i.exec(e + ";" + (k && d.appMinorVersion)) || /\bMinefield\b/i.test(e) && "a") && (A = /b/i.test(f) ? "beta" : "alpha", U = U.replace(RegExp(f + "\\+?$"), "") + ("beta" == A ? y : R) + (/\d+\+?/.exec(f) || "")), "Fennec" == W || "Firefox" == W && /\b(?:Android|Firefox OS)\b/.test(H)) W = "Firefox Mobile"; else if ("Maxthon" == W && U) U = U.replace(/\.[\d.]+/, ".x"); else if (/\bXbox\b/i.test(M)) "Xbox 360" == M && (H = null), "Xbox 360" == M && /\bIEMobile\b/.test(e) && x.unshift("mobile mode"); else if (!/^(?:Chrome|IE|Opera)$/.test(W) && (!W || M || /Browser|Mobi/.test(W)) || "Windows CE" != H && !/Mobi/i.test(e)) if ("IE" == W && k) try {
            null === m.external && x.unshift("platform preview")
        } catch (j) {
            x.unshift("embedded")
        } else (/\bBlackBerry\b/.test(M) || /\bBB10\b/.test(e)) && (f = (RegExp(M.replace(/ +/g, " *") + "/([.\\d]+)", "i").exec(e) || 0)[1] || U) ? (f = [f, /BB10/.test(e)], H = (f[1] ? (M = null, F = "BlackBerry") : "Device Software") + " " + f[0], U = null) : this != i && "Wii" != M && (k && D || /Opera/.test(W) && /\b(?:MSIE|Firefox)\b/i.test(e) || "Firefox" == W && /\bOS X (?:\d+\.){2,}/.test(H) || "IE" == W && (H && !/^Win/.test(H) && U > 5.5 || /\bWindows XP\b/.test(H) && U > 8 || 8 == U && !/\bTrident\b/.test(e))) && !_.test(f = c.call(i, e.replace(_, "") + ";")) && f.name && (f = "ing as " + f.name + ((f = f.version) ? " " + f : ""), _.test(W) ? (/\bIE\b/.test(f) && "Mac OS" == H && (H = null), f = "identify" + f) : (f = "mask" + f, W = G ? n(G.replace(/([a-z])([A-Z])/g, "$1 $2")) : "Opera", /\bIE\b/.test(f) && (H = null), k || (U = null)), V = ["Presto"], x.push(f)); else W += " Mobile";
        (f = (/\bAppleWebKit\/([\d.]+\+?)/i.exec(e) || 0)[1]) && (f = [parseFloat(f.replace(/\.(\d)$/, ".0$1")), f], "Safari" == W && "+" == f[1].slice(-1) ? (W = "WebKit Nightly", A = "alpha", U = f[1].slice(0, -1)) : U != f[1] && U != (f[2] = (/\bSafari\/([\d.]+\+?)/i.exec(e) || 0)[1]) || (U = null), f[1] = (/\bChrome\/([\d.]+)/i.exec(e) || 0)[1], 537.36 == f[0] && 537.36 == f[2] && parseFloat(f[1]) >= 28 && "WebKit" == V && (V = ["Blink"]), k && (E || f[1]) ? (V && (V[1] = "like Chrome"), f = f[1] || (f = f[0], f < 530 ? 1 : f < 532 ? 2 : f < 532.05 ? 3 : f < 533 ? 4 : f < 534.03 ? 5 : f < 534.07 ? 6 : f < 534.1 ? 7 : f < 534.13 ? 8 : f < 534.16 ? 9 : f < 534.24 ? 10 : f < 534.3 ? 11 : f < 535.01 ? 12 : f < 535.02 ? "13+" : f < 535.07 ? 15 : f < 535.11 ? 16 : f < 535.19 ? 17 : f < 536.05 ? 18 : f < 536.1 ? 19 : f < 537.01 ? 20 : f < 537.11 ? "21+" : f < 537.13 ? 23 : f < 537.18 ? 24 : f < 537.24 ? 25 : f < 537.36 ? 26 : "Blink" != V ? "27" : "28")) : (V && (V[1] = "like Safari"), f = f[0], f = f < 400 ? 1 : f < 500 ? 2 : f < 526 ? 3 : f < 533 ? 4 : f < 534 ? "4+" : f < 535 ? 5 : f < 537 ? 6 : f < 538 ? 7 : f < 601 ? 8 : "8"), V && (V[1] += " " + (f += "number" == typeof f ? ".x" : /[.+]/.test(f) ? "" : "+")), "Safari" == W && (!U || parseInt(U) > 45) && (U = f)), "Opera" == W && (f = /\bzbov|zvav$/.exec(H)) ? (W += " ", x.unshift("desktop mode"), "zvav" == f ? (W += "Mini", U = null) : W += "Mobile", H = H.replace(RegExp(" *" + f + "$"), "")) : "Safari" == W && /\bChrome\b/.exec(V && V[1]) && (x.unshift("desktop mode"), W = "Chrome Mobile", U = null, /\bOS X\b/.test(H) ? (F = "Apple", H = "iOS 4.3+") : H = null), U && 0 == U.indexOf(f = /[\d.]+$/.exec(H)) && e.indexOf("/" + f + "-") > -1 && (H = p(H.replace(f, ""))), V && !/\b(?:Avant|Nook)\b/.test(W) && (/Browser|Lunascape|Maxthon/.test(W) || "Safari" != W && /^iOS/.test(H) && /\bSafari\b/.test(V[1]) || /^(?:Adobe|Arora|Breach|Midori|Opera|Phantom|Rekonq|Rock|Samsung Internet|Sleipnir|Web)/.test(W) && V[1]) && (f = V[V.length - 1]) && x.push(f), x.length && (x = ["(" + x.join("; ") + ")"]), F && M && M.indexOf(F) < 0 && x.push("on " + F), M && x.push((/^on /.test(x[x.length - 1]) ? "" : "on ") + M), H && (f = / ([\d.+]+)$/.exec(H), w = f && "/" == H.charAt(H.length - f[0].length - 1), H = {
            architecture: 32,
            family: f && !w ? H.replace(f[0], "") : H,
            version: f ? f[1] : null,
            toString: function () {
                var e = this.version;
                return this.family + (e && !w ? " " + e : "") + (64 == this.architecture ? " 64-bit" : "")
            }
        }), (f = /\b(?:AMD|IA|Win|WOW|x86_|x)64\b/i.exec(O)) && !/\bi686\b/i.test(O) ? (H && (H.architecture = 64, H.family = H.family.replace(RegExp(" *" + f), "")), W && (/\bWOW64\b/i.test(e) || k && /\w(?:86|32)$/.test(d.cpuClass || d.platform) && !/\bWin64; x64\b/i.test(e)) && x.unshift("32-bit")) : H && /^OS X/.test(H.family) && "Chrome" == W && parseFloat(U) >= 39 && (H.architecture = 64), e || (e = null);
        var B = {};
        return B.description = e, B.layout = V && V[0], B.manufacturer = F, B.name = W, B.prerelease = A, B.product = M, B.ua = e, B.version = W && U, B.os = H || {
            architecture: null,
            family: null,
            version: null,
            toString: function () {
                return "null"
            }
        }, B.parse = c, B.toString = u, B.version && x.unshift(U), B.name && x.unshift(W), H && W && (H != String(H).split(" ")[0] || H != W.split(" ")[0] && !M) && x.push(M ? "(" + H + ")" : "on " + H), x.length && (B.description = x.join(" ")), B
    }

    var u = { "function": !0, object: !0 }, h = u[typeof window] && window || this, m = u[typeof exports] && exports,
        g = u[typeof module] && module && !module.nodeType && module, d = m && g && "object" == typeof global && global;
    !d || d.global !== d && d.window !== d && d.self !== d || (h = d);
    var b = Math.pow(2, 53) - 1, _ = /\bOpera/, f = Object.prototype, w = f.hasOwnProperty, v = f.toString;
    webphone_api.platform = c()
}(), function (e, o) {
    "use strict";
    e.webphone_api.picoModal = function () {
        "use strict";
        
        function e(e) {
            return "object" == typeof Node ? e instanceof Node : e && "object" == typeof e && "number" == typeof e.nodeType
        }

        function o(e) {
            return "string" == typeof e
        }

        function t() {
            var e = [];
            return {
                watch: e.push.bind(e), trigger: function (o) {
                    for (var t = !0, n = {
                        preventDefault: function () {
                            t = !1
                        }
                    }, i = 0; i < e.length; i++) e[i](o, n);
                    return t
                }
            }
        }

        function n(e) {
            this.elem = e
        }

        function i(e, o) {
            
            return n.div().clazz("pico-overlay").clazz(e("overlayClass", "")).stylize({
                display: "block",
                position: "fixed",
                top: "0px",
                left: "0px",
                height: "100%",
                width: "100%",
                zIndex: 1e4
            }).stylize(e("overlayStyles", { opacity: .5, background: "#000" })).onClick(function () {
                e("overlayClose", !0) && o()
            })
        }

        

        function a(e, o) {
            var t = e("width", "auto");
            
            return "number" == typeof t && (t += "px"), n.div().clazz("pico-content").clazz(e("modalClass", "")).stylize({
                display: "block",
                position: "fixed",
                zIndex: 10001,
                left: "50%",
                top: "50px",
                width: t,
                "-ms-transform": "translateX(-50%)",
                "-moz-transform": "translateX(-50%)",
                "-webkit-transform": "translateX(-50%)",
                "-o-transform": "translateX(-50%)",
                transform: "translateX(-50%)"
            }).stylize(e("modalStyles", {
                backgroundColor: "white",
                padding: "20px",
                borderRadius: "5px"
            })).html(e("content")).attr("role", "dialog").onClick(function (e) {
                new n(e.target).anyAncestor(function (e) {
                    return /\bpico-close\b/.test(e.elem.className)
                }) && o()
            })
        }

        function r(e, o) {
            if (o("closeButton", !0)) return e.child().html(o("closeHtml", "&#xD7;")).clazz("pico-close").clazz(o("closeClass")).stylize(o("closeStyles", {
                borderRadius: "2px",
                cursor: "pointer",
                height: "15px",
                width: "15px",
                position: "absolute",
                top: "5px",
                right: "5px",
                fontSize: "16px",
                textAlign: "center",
                lineHeight: "15px",
                background: "#CCC"
            }))
        }

        function s(e) {
            return function () {
                return e().elem
            }
        }

        return n.div = function (e) {
            var o = document.createElement("div");
            
            return (e || document.body).appendChild(o), new n(o)
        }, n.prototype = {
            child: function () {
                return n.div(this.elem)
            }, stylize: function (e) {
                e = e || {}, "undefined" != typeof e.opacity && (e.filter = "alpha(opacity=" + 100 * e.opacity + ")");
                for (var o in e) e.hasOwnProperty(o) && (this.elem.style[o] = e[o]);
                return this
            }, clazz: function (e) {
                return this.elem.className += " " + e, this
            }, html: function (o) {
                return e(o) ? this.elem.appendChild(o) : this.elem.innerHTML = o, this
            }, onClick: function (e) {
                return this.elem.addEventListener("click", e), this
            }, destroy: function () {
                document.body.removeChild(this.elem)
            }, hide: function () {
                this.elem.style.display = "none"
            }, show: function () {
                this.elem.style.display = "block"
            }, attr: function (e, o) {
                return this.elem.setAttribute(e, o), this
            }, anyAncestor: function (e) {
                for (var o = this.elem; o;) {
                    if (e(new n(o))) return !0;
                    o = o.parentNode
                }
                return !1
            }
        }, function (n) {
            function l(e, o) {
                var t = n[e];
                return "function" == typeof t && (t = t(o)), t === undefined ? o : t
            }

            function p() {
                v().hide(), w().hide(), f.trigger(T)
            }

            function c() {
                _.trigger(T) && p()
            }

            function u(e) {
                return function () {
                    return e.apply(this, arguments), T
                }
            }

            function h(e) {
                if (!m) {
                    var o = a(l, c);
                    m = { modal: o, overlay: i(l, c), close: r(o, l) }, g.trigger(T)
                }
                return m[e]
            }

            (o(n) || e(n)) && (n = { content: n });
            var m, g = t(), d = t(), b = t(), _ = t(), f = t(), w = h.bind(window, "modal"),
                v = h.bind(window, "overlay"), E = h.bind(window, "close"), T = {
                    modalElem: s(w),
                    closeElem: s(E),
                    overlayElem: s(v),
                    buildDom: u(h),
                    show: function () {
                        return d.trigger(T) && (v().show(), E(), w().show(), b.trigger(T)), this
                    },
                    close: u(c),
                    forceClose: u(p),
                    destroy: function () {
                        w = w().destroy(), v = v().destroy(), E = undefined
                    },
                    options: function (e) {
                        n = e
                    },
                    afterCreate: u(g.watch),
                    beforeShow: u(d.watch),
                    afterShow: u(b.watch),
                    beforeClose: u(_.watch),
                    afterClose: u(f.watch)
                };
            return T
        }
    }()
}(this), webphone_api.swfobject = function () {
    function e() {
        if (!M) {
            try {
                var e = O.getElementsByTagName("body")[0].appendChild(b("span"));
                e.parentNode.removeChild(e)
            } catch (n) {
                return
            }
            M = !0;
            for (var o = k.length, t = 0; t < o; t++) k[t]()
        }
    }

    function o(e) {
        M ? e() : k[k.length] = e
    }

    function t(e) {
        if (typeof G.addEventListener != R) G.addEventListener("load", e, !1); else if (typeof O.addEventListener != R) O.addEventListener("load", e, !1); else if (typeof G.attachEvent != R) _(G, "onload", e); else if ("function" == typeof G.onload) {
            var o = G.onload;
            G.onload = function () {
                o(), e()
            }
        } else G.onload = e
    }

    function n() {
        A ? i() : a()
    }

    function i() {
        if (!0 !== webphone_api.flashdeepdetect) return void a();
        var e = O.getElementsByTagName("body")[0], o = b(y);
        o.setAttribute("type", L);
        var t = e.appendChild(o);
        if (t) {
            var n = 0;
            !function () {
                if (typeof t.GetVariable != R) {
                    var i = t.GetVariable("$version");
                    i && (i = i.split(" ")[1].split(","), B.pv = [parseInt(i[0], 10), parseInt(i[1], 10), parseInt(i[2], 10)])
                } else if (n < 10) return n++, void setTimeout(arguments.callee, 10);
                e.removeChild(o), t = null, a()
            }()
        } else a()
    }

    function a() {
        var e = U.length;
        if (e > 0) for (var o = 0; o < e; o++) {
            var t = U[o].id, n = U[o].callbackFn, i = { success: !1, id: t };
            if (B.pv[0] > 0) {
                var a = d(t);
                if (a) if (!f(U[o].swfVersion) || B.wk && B.wk < 312) if (U[o].expressInstall && s()) {
                    var c = {};
                    c.data = U[o].expressInstall, c.width = a.getAttribute("width") || "0", c.height = a.getAttribute("height") || "0", a.getAttribute("class") && (c.styleclass = a.getAttribute("class")), a.getAttribute("align") && (c.align = a.getAttribute("align"));
                    for (var u = {}, h = a.getElementsByTagName("param"), m = h.length, g = 0; g < m; g++) "movie" != h[g].getAttribute("name").toLowerCase() && (u[h[g].getAttribute("name")] = h[g].getAttribute("value"));
                    l(c, u, t, n)
                } else p(a), n && n(i); else v(t, !0), n && (i.success = !0, i.ref = r(t), n(i))
            } else if (v(t, !0), n) {
                var b = r(t);
                b && typeof b.SetVariable != R && (i.success = !0, i.ref = b), n(i)
            }
        }
    }

    function r(e) {
        var o = null, t = d(e);
        if (t && "OBJECT" == t.nodeName) if (typeof t.SetVariable != R) o = t; else {
            var n = t.getElementsByTagName(y)[0];
            n && (o = n)
        }
        return o
    }

    function s() {
        return !F && f("6.0.65") && (B.win || B.mac) && !(B.wk && B.wk < 312)
    }

    function l(e, o, t, n) {
        F = !0, S = n || null, N = { success: !1, id: t };
        var i = d(t);
        if (i) {
            "OBJECT" == i.nodeName ? (T = c(i), P = null) : (T = i, P = t), e.id = D, (typeof e.width == R || !/%$/.test(e.width) && parseInt(e.width, 10) < 310) && (e.width = "310"), (typeof e.height == R || !/%$/.test(e.height) && parseInt(e.height, 10) < 137) && (e.height = "137"), O.title = O.title.slice(0, 47) + " - Flash Player Installation";
            var a = B.ie && B.win ? "ActiveX" : "PlugIn",
                r = "MMredirectURL=" + encodeURI(G.location).toString().replace(/&/g, "%26") + "&MMplayerType=" + a + "&MMdoctitle=" + O.title;
            if (typeof o.flashvars != R ? o.flashvars += "&" + r : o.flashvars = r, B.ie && B.win && 4 != i.readyState) {
                var s = b("div");
                t += "SWFObjectNew", s.setAttribute("id", t), i.parentNode.insertBefore(s, i), i.style.display = "none", function () {
                    4 == i.readyState ? i.parentNode.removeChild(i) : setTimeout(arguments.callee, 10)
                }()
            }
            u(e, o, t)
        }
    }

    function p(e) {
        if (B.ie && B.win && 4 != e.readyState) {
            var o = b("div");
            e.parentNode.insertBefore(o, e), o.parentNode.replaceChild(c(e), o), e.style.display = "none", function () {
                4 == e.readyState ? e.parentNode.removeChild(e) : setTimeout(arguments.callee, 10)
            }()
        } else e.parentNode.replaceChild(c(e), e)
    }

    function c(e) {
        var o = b("div");
        if (B.win && B.ie) o.innerHTML = e.innerHTML; else {
            var t = e.getElementsByTagName(y)[0];
            if (t) {
                var n = t.childNodes;
                if (n) for (var i = n.length, a = 0; a < i; a++) 1 == n[a].nodeType && "PARAM" == n[a].nodeName || 8 == n[a].nodeType || o.appendChild(n[a].cloneNode(!0))
            }
        }
        return o
    }

    function u(e, o, t) {
        var n, i = d(t);
        if (B.wk && B.wk < 312) return n;
        if (i) if (typeof e.id == R && (e.id = t), B.ie && B.win) {
            var a = "";
            for (var r in e) e[r] != Object.prototype[r] && ("data" == r.toLowerCase() ? o.movie = e[r] : "styleclass" == r.toLowerCase() ? a += ' class="' + e[r] + '"' : "classid" != r.toLowerCase() && (a += " " + r + '="' + e[r] + '"'));
            var s = "";
            for (var l in o) o[l] != Object.prototype[l] && (s += '<param name="' + l + '" value="' + o[l] + '" />');
            i.outerHTML = '<object classid="clsid:D27CDB6E-AE6D-11cf-96B8-444553540000"' + a + ">" + s + "</object>", V[V.length] = e.id, n = d(e.id)
        } else {
            var p = b(y);
            p.setAttribute("type", L);
            for (var c in e) e[c] != Object.prototype[c] && ("styleclass" == c.toLowerCase() ? p.setAttribute("class", e[c]) : "classid" != c.toLowerCase() && p.setAttribute(c, e[c]));
            for (var u in o) o[u] != Object.prototype[u] && "movie" != u.toLowerCase() && h(p, u, o[u]);
            i.parentNode.replaceChild(p, i), n = p
        }
        return n
    }

    function h(e, o, t) {
        var n = b("param");
        n.setAttribute("name", o), n.setAttribute("value", t), e.appendChild(n)
    }

    function m(e) {
        var o = d(e);
        o && "OBJECT" == o.nodeName && (B.ie && B.win ? (o.style.display = "none", function () {
            4 == o.readyState ? g(e) : setTimeout(arguments.callee, 10)
        }()) : o.parentNode.removeChild(o))
    }

    function g(e) {
        var o = d(e);
        if (o) {
            for (var t in o) "function" == typeof o[t] && (o[t] = null);
            o.parentNode.removeChild(o)
        }
    }

    function d(e) {
        var o = null;
        try {
            o = O.getElementById(e)
        } catch (t) {
        }
        return o
    }

    function b(e) {
        return O.createElement(e)
    }

    function _(e, o, t) {
        e.attachEvent(o, t), W[W.length] = [e, o, t]
    }

    function f(e) {
        var o = B.pv, t = e.split(".");
        return t[0] = parseInt(t[0], 10), t[1] = parseInt(t[1], 10) || 0, t[2] = parseInt(t[2], 10) || 0, o[0] > t[0] || o[0] == t[0] && o[1] > t[1] || o[0] == t[0] && o[1] == t[1] && o[2] >= t[2]
    }

    function w(e, o, t, n) {
        if (!B.ie || !B.mac) {
            var i = O.getElementsByTagName("head")[0];
            if (i) {
                var a = t && "string" == typeof t ? t : "screen";
                if (n && (I = null, C = null), !I || C != a) {
                    var r = b("style");
                    r.setAttribute("type", "text/css"), r.setAttribute("media", a), I = i.appendChild(r), B.ie && B.win && typeof O.styleSheets != R && O.styleSheets.length > 0 && (I = O.styleSheets[O.styleSheets.length - 1]), C = a
                }
                B.ie && B.win ? I && typeof I.addRule == y && I.addRule(e, o) : I && typeof O.createTextNode != R && I.appendChild(O.createTextNode(e + " {" + o + "}"))
            }
        }
    }

    function v(e, o) {
        if (H) {
            var t = o ? "visible" : "hidden";
            M && d(e) ? d(e).style.visibility = t : w("#" + e, "visibility:" + t)
        }
    }

    function E(e) {
        return null != /[\\\"<>\.;]/.exec(e) && typeof encodeURIComponent != R ? encodeURIComponent(e) : e
    }

    var T, P, S, N, I, C, R = "undefined", y = "object", L = "application/x-shockwave-flash", D = "SWFObjectExprInst",
        G = window, O = document, x = navigator, A = !1, k = [n], U = [], V = [], W = [], M = !1, F = !1, H = !0,
        B = function () {
            var e = typeof O.getElementById != R && typeof O.getElementsByTagName != R && typeof O.createElement != R,
                o = x.userAgent.toLowerCase(), t = x.platform.toLowerCase(), n = /win/.test(t ? t : o),
                i = /mac/.test(t ? t : o),
                a = !!/webkit/.test(o) && parseFloat(o.replace(/^.*webkit\/(\d+(\.\d+)?).*$/, "$1")), r = !1,
                s = [0, 0, 0], l = null;
            if (typeof x.plugins != R && typeof x.plugins["Shockwave Flash"] == y) !(l = x.plugins["Shockwave Flash"].description) || typeof x.mimeTypes != R && x.mimeTypes[L] && !x.mimeTypes[L].enabledPlugin || (A = !0, r = !1, l = l.replace(/^.*\s+(\S+\s+\S+$)/, "$1"), s[0] = parseInt(l.replace(/^(.*)\..*$/, "$1"), 10), s[1] = parseInt(l.replace(/^.*\.(.*)\s.*$/, "$1"), 10), s[2] = /[a-zA-Z]/.test(l) ? parseInt(l.replace(/^.*[a-zA-Z]+(.*)$/, "$1"), 10) : 0); else if (typeof G.ActiveXObject != R) try {
                var p = new ActiveXObject("ShockwaveFlash.ShockwaveFlash");
                p && (l = p.GetVariable("$version")) && (r = !0, l = l.split(" ")[1].split(","), s = [parseInt(l[0], 10), parseInt(l[1], 10), parseInt(l[2], 10)])
            } catch (c) {
            }
            return { w3: e, pv: s, wk: a, ie: r, win: n, mac: i }
        }();
    (function () {
        B.w3 && ((typeof O.readyState != R && "complete" == O.readyState || typeof O.readyState == R && (O.getElementsByTagName("body")[0] || O.body)) && e(), M || (typeof O.addEventListener != R && O.addEventListener("DOMContentLoaded", e, !1), B.ie && B.win && (O.attachEvent("onreadystatechange", function () {
            "complete" == O.readyState && (O.detachEvent("onreadystatechange", arguments.callee), e())
        }), G == top && function () {
            if (!M) {
                try {
                    O.documentElement.doScroll("left")
                } catch (o) {
                    return void setTimeout(arguments.callee, 0)
                }
                e()
            }
        }()), B.wk && function () {
            if (!M) /loaded|complete/.test(O.readyState) ? e() : setTimeout(arguments.callee, 0)
        }(), t(e)))
    })(), function () {
        B.ie && B.win && window.attachEvent("onunload", function () {
            for (var e = W.length, o = 0; o < e; o++) W[o][0].detachEvent(W[o][1], W[o][2]);
            for (var t = V.length, n = 0; n < t; n++) m(V[n]);
            for (var i in B) B[i] = null;
            B = null;
            for (var a in webphone_api.swfobject) webphone_api.swfobject[a] = null;
            webphone_api.swfobject = null
        })
    }();
    return {
        registerObject: function (e, o, t, n) {
            if (B.w3 && e && o) {
                var i = {};
                i.id = e, i.swfVersion = o, i.expressInstall = t, i.callbackFn = n, U[U.length] = i, v(e, !1)
            } else n && n({ success: !1, id: e })
        }, getObjectById: function (e) {
            if (B.w3) return r(e)
        }, embedSWF: function (e, t, n, i, a, r, p, c, h, m) {
            var g = { success: !1, id: t };
            B.w3 && !(B.wk && B.wk < 312) && e && t && n && i && a ? (v(t, !1), o(function () {
                n += "", i += "";
                var o = {};
                if (h && typeof h === y) for (var d in h) o[d] = h[d];
                o.data = e, o.width = n, o.height = i;
                var b = {};
                if (c && typeof c === y) for (var _ in c) b[_] = c[_];
                if (p && typeof p === y) for (var w in p) typeof b.flashvars != R ? b.flashvars += "&" + w + "=" + p[w] : b.flashvars = w + "=" + p[w];
                if (f(a)) {
                    var E = u(o, b, t);
                    o.id == t && v(t, !0), g.success = !0, g.ref = E
                } else {
                    if (r && s()) return o.data = r, void l(o, b, t, m);
                    v(t, !0)
                }
                m && m(g)
            })) : m && m(g)
        }, switchOffAutoHideShow: function () {
            H = !1
        }, ua: B, getFlashPlayerVersion: function () {
            return { major: B.pv[0], minor: B.pv[1], release: B.pv[2] }
        }, hasFlashPlayerVersion: f, createSWF: function (e, o, t) {
            return B.w3 ? u(e, o, t) : undefined
        }, showExpressInstall: function (e, o, t, n) {
            B.w3 && s() && l(e, o, t, n)
        }, removeSWF: function (e) {
            B.w3 && m(e)
        }, createCSS: function (e, o, t, n) {
            B.w3 && w(e, o, t, n)
        }, addDomLoadEvent: o, addLoadEvent: t, getQueryParamValue: function (e) {
            var o = O.location.search || O.location.hash;
            if (o) {
                if (/\?/.test(o) && (o = o.split("?")[1]), null == e) return E(o);
                for (var t = o.split("&"), n = 0; n < t.length; n++) if (t[n].substring(0, t[n].indexOf("=")) == e) return E(t[n].substring(t[n].indexOf("=") + 1))
            }
            return ""
        }, expressInstallCallback: function () {
            if (F) {
                var e = d(D);
                e && T && (e.parentNode.replaceChild(T, e), P && (v(P, !0), B.ie && B.win && (T.style.display = "block")), S && S(N)), F = !1
            }
        }
    }
}(), webphone_api.mwphonecfg = function () {
    function e(e) {
        return void 0 === e || null === e ? "" : (e = e.toLowerCase(), "undefined" == typeof t[e] || null === t[e] ? "" : t[e])
    }

    function o() {
        return t
    }

    var t = {
        passphrase: "h39idbfqw7116ghh",
        loglevel: "5",
        autotransportdetect: "false",
        cfgusetunneling: "0",
        useencryption: "false",
        upperserverfromuser: "2",
        featureset: "10",
        needactivation: "false",
        brandid: "-1",
        video: "1",
        enable_video: "true",
        has_video: "true",
        enablepresence2: "1",
        enablepresence: "1",
        hasfiletransfer: "true",
        screensharing: "1",
        hasconference: "true",
        useg729: "2",
        useopuswb: "2",
        customizedversion: "false",
        autoprovisioning: "1",
        colortheme: "-1",
        actionbarhideicon: "false",
        usemizuwebrtcgateway: "-1",
        deploydate: "3/12/2020 22:43:09",
        homepage: "www.mizu-voip.com",
        server_comment: "VoIP server address (domain or IP:port)",
        companynameex: "MizuTech",
        confighash: "6190565b7a4cc409c70e83fff7cc9739",
        firstdeploydate: "3/12/2020 22:43:09",
        lastdeploydate: "3/12/2020 22:43:09",
        BUILDNUMBER: "705",
        mclientid: "5795"
    };
    return { get: e, getAll: o }
}(), function (e) {
    if ("object" == typeof exports && "undefined" != typeof module) module.exports = e(); else if ("function" == typeof define && define.amd) define([], e); else {
        var o;
        o = "undefined" != typeof window ? window : "undefined" != typeof global ? global : "undefined" != typeof self ? self : this, o.webphone_api.localforage = e()
    }
}(function () {
    return function e(o, t, n) {
        function i(r, s) {
            if (!t[r]) {
                if (!o[r]) {
                    var l = "function" == typeof require && require;
                    if (!s && l) return l(r, !0);
                    if (a) return a(r, !0);
                    var p = new Error("Cannot find module '" + r + "'");
                    throw p.code = "MODULE_NOT_FOUND", p
                }
                var c = t[r] = { exports: {} };
                o[r][0].call(c.exports, function (e) {
                    var t = o[r][1][e];
                    return i(t || e)
                }, c, c.exports, e, o, t, n)
            }
            return t[r].exports
        }

        for (var a = "function" == typeof require && require, r = 0; r < n.length; r++) i(n[r]);
        return i
    }({
        1: [function (e, o, t) {
            (function (e) {
                "use strict";

                function t() {
                    c = !0;
                    for (var e, o, t = u.length; t;) {
                        for (o = u, u = [], e = -1; ++e < t;) o[e]();
                        t = u.length
                    }
                    c = !1
                }

                function n(e) {
                    1 !== u.push(e) || c || i()
                }

                var i, a = e.MutationObserver || e.WebKitMutationObserver;
                if (a) {
                    var r = 0, s = new a(t), l = e.document.createTextNode("");
                    s.observe(l, { characterData: !0 }), i = function () {
                        l.data = r = ++r % 2
                    }
                } else if (e.setImmediate || "undefined" == typeof e.MessageChannel) i = "document" in e && "onreadystatechange" in e.document.createElement("script") ? function () {
                    var o = e.document.createElement("script");
                    o.onreadystatechange = function () {
                        t(), o.onreadystatechange = null, o.parentNode.removeChild(o), o = null
                    }, e.document.documentElement.appendChild(o)
                } : function () {
                    setTimeout(t, 0)
                }; else {
                    var p = new e.MessageChannel;
                    p.port1.onmessage = t, i = function () {
                        p.port2.postMessage(0)
                    }
                }
                var c, u = [];
                o.exports = n
            }).call(this, "undefined" != typeof global ? global : "undefined" != typeof self ? self : "undefined" != typeof window ? window : {})
        }, {}], 2: [function (e, o, t) {
            "use strict";

            function n() {
            }

            function i(e) {
                if ("function" != typeof e) throw new TypeError("resolver must be a function");
                this.state = f, this.queue = [], this.outcome = void 0, e !== n && l(this, e)
            }

            function a(e, o, t) {
                this.promise = e, "function" == typeof o && (this.onFulfilled = o, this.callFulfilled = this.otherCallFulfilled), "function" == typeof t && (this.onRejected = t, this.callRejected = this.otherCallRejected)
            }

            function r(e, o, t) {
                g(function () {
                    var n;
                    try {
                        n = o(t)
                    } catch (i) {
                        return d.reject(e, i)
                    }
                    n === e ? d.reject(e, new TypeError("Cannot resolve promise with itself")) : d.resolve(e, n)
                })
            }

            function s(e) {
                var o = e && e.then;
                if (e && ("object" == typeof e || "function" == typeof e) && "function" == typeof o) return function () {
                    o.apply(e, arguments)
                }
            }

            function l(e, o) {
                function t(o) {
                    a || (a = !0, d.reject(e, o))
                }

                function n(o) {
                    a || (a = !0, d.resolve(e, o))
                }

                function i() {
                    o(n, t)
                }

                var a = !1, r = p(i);
                "error" === r.status && t(r.value)
            }

            function p(e, o) {
                var t = {};
                try {
                    t.value = e(o), t.status = "success"
                } catch (n) {
                    t.status = "error", t.value = n
                }
                return t
            }

            function c(e) {
                return e instanceof this ? e : d.resolve(new this(n), e)
            }

            function u(e) {
                var o = new this(n);
                return d.reject(o, e)
            }

            function h(e) {
                var o = this;
                if ("[object Array]" !== Object.prototype.toString.call(e)) return this.reject(new TypeError("must be an array"));
                var t = e.length, i = !1;
                if (!t) return this.resolve([]);
                for (var a = new Array(t), r = 0, s = -1, l = new this(n); ++s < t;) !function (e, n) {
                    function s(e) {
                        a[n] = e, ++r !== t || i || (i = !0, d.resolve(l, a))
                    }

                    o.resolve(e).then(s, function (e) {
                        i || (i = !0, d.reject(l, e))
                    })
                }(e[s], s);
                return l
            }

            function m(e) {
                var o = this;
                if ("[object Array]" !== Object.prototype.toString.call(e)) return this.reject(new TypeError("must be an array"));
                var t = e.length, i = !1;
                if (!t) return this.resolve([]);
                for (var a = -1, r = new this(n); ++a < t;) !function (e) {
                    o.resolve(e).then(function (e) {
                        i || (i = !0, d.resolve(r, e))
                    }, function (e) {
                        i || (i = !0, d.reject(r, e))
                    })
                }(e[a]);
                return r
            }

            var g = e(1), d = {}, b = ["REJECTED"], _ = ["FULFILLED"], f = ["PENDING"];
            o.exports = i, i.prototype["catch"] = function (e) {
                return this.then(null, e)
            }, i.prototype.then = function (e, o) {
                if ("function" != typeof e && this.state === _ || "function" != typeof o && this.state === b) return this;
                var t = new this.constructor(n);
                if (this.state !== f) {
                    r(t, this.state === _ ? e : o, this.outcome)
                } else this.queue.push(new a(t, e, o));
                return t
            }, a.prototype.callFulfilled = function (e) {
                d.resolve(this.promise, e)
            }, a.prototype.otherCallFulfilled = function (e) {
                r(this.promise, this.onFulfilled, e)
            }, a.prototype.callRejected = function (e) {
                d.reject(this.promise, e)
            }, a.prototype.otherCallRejected = function (e) {
                r(this.promise, this.onRejected, e)
            }, d.resolve = function (e, o) {
                var t = p(s, o);
                if ("error" === t.status) return d.reject(e, t.value);
                var n = t.value;
                if (n) l(e, n); else {
                    e.state = _, e.outcome = o;
                    for (var i = -1, a = e.queue.length; ++i < a;) e.queue[i].callFulfilled(o)
                }
                return e
            }, d.reject = function (e, o) {
                e.state = b, e.outcome = o;
                for (var t = -1, n = e.queue.length; ++t < n;) e.queue[t].callRejected(o);
                return e
            }, i.resolve = c, i.reject = u, i.all = h, i.race = m
        }, { 1: 1 }], 3: [function (e, o, t) {
            (function (o) {
                "use strict"
                    ; "function" != typeof o.Promise && (o.Promise = e(2))
            }).call(this, "undefined" != typeof global ? global : "undefined" != typeof self ? self : "undefined" != typeof window ? window : {})
        }, { 2: 2 }], 4: [function (e, o, t) {
            "use strict";

            function n(e, o) {
                if (!(e instanceof o)) throw new TypeError("Cannot call a class as a function")
            }

            function i(e, o) {
                e = e || [], o = o || {};
                try {
                    return new Blob(e, o)
                } catch (a) {
                    if ("TypeError" !== a.name) throw a;
                    for (var t = "undefined" != typeof BlobBuilder ? BlobBuilder : "undefined" != typeof MSBlobBuilder ? MSBlobBuilder : "undefined" != typeof MozBlobBuilder ? MozBlobBuilder : WebKitBlobBuilder, n = new t, i = 0; i < e.length; i += 1) n.append(e[i]);
                    return n.getBlob(o.type)
                }
            }

            function a(e, o) {
                o && e.then(function (e) {
                    o(null, e)
                }, function (e) {
                    o(e)
                })
            }

            function r(e, o, t) {
                "function" == typeof o && e.then(o), "function" == typeof t && e["catch"](t)
            }

            function s(e) {
                return "string" != typeof e && (console.warn(e + " used as a key, but it is not a string."), e = String(e)), e
            }

            function l() {
                if (arguments.length && "function" == typeof arguments[arguments.length - 1]) return arguments[arguments.length - 1]
            }

            function p(e) {
                for (var o = e.length, t = new ArrayBuffer(o), n = new Uint8Array(t), i = 0; i < o; i++) n[i] = e.charCodeAt(i);
                return t
            }

            function c(e) {
                return new _e(function (o) {
                    var t = e.transaction(fe, Pe), n = i([""]);
                    t.objectStore(fe).put(n, "key"), t.onabort = function (e) {
                        e.preventDefault(), e.stopPropagation(), o(!1)
                    }, t.oncomplete = function () {
                        var e = navigator.userAgent.match(/Chrome\/(\d+)/), t = navigator.userAgent.match(/Edge\//);
                        o(t || !e || parseInt(e[1], 10) >= 43)
                    }
                })["catch"](function () {
                    return !1
                })
            }

            function u(e) {
                return "boolean" == typeof we ? _e.resolve(we) : c(e).then(function (e) {
                    return we = e
                })
            }

            function h(e) {
                var o = ve[e.name], t = {};
                t.promise = new _e(function (e, o) {
                    t.resolve = e, t.reject = o
                }), o.deferredOperations.push(t), o.dbReady ? o.dbReady = o.dbReady.then(function () {
                    return t.promise
                }) : o.dbReady = t.promise
            }

            function m(e) {
                var o = ve[e.name], t = o.deferredOperations.pop();
                if (t) return t.resolve(), t.promise
            }

            function g(e, o) {
                var t = ve[e.name], n = t.deferredOperations.pop();
                if (n) return n.reject(o), n.promise
            }

            function d(e, o) {
                return new _e(function (t, n) {
                    if (ve[e.name] = ve[e.name] || N(), e.db) {
                        if (!o) return t(e.db);
                        h(e), e.db.close()
                    }
                    var i = [e.name];
                    o && i.push(e.version);
                    var a = be.open.apply(be, i);
                    o && (a.onupgradeneeded = function (o) {
                        var t = a.result;
                        try {
                            t.createObjectStore(e.storeName), o.oldVersion <= 1 && t.createObjectStore(fe)
                        } catch (n) {
                            if ("ConstraintError" !== n.name) throw n;
                            console.warn('The database "' + e.name + '" has been upgraded from version ' + o.oldVersion + " to version " + o.newVersion + ', but the storage "' + e.storeName + '" already exists.')
                        }
                    }), a.onerror = function (e) {
                        e.preventDefault(), n(a.error)
                    }, a.onsuccess = function () {
                        t(a.result), m(e)
                    }
                })
            }

            function b(e) {
                return d(e, !1)
            }

            function _(e) {
                return d(e, !0)
            }

            function f(e, o) {
                if (!e.db) return !0;
                var t = !e.db.objectStoreNames.contains(e.storeName), n = e.version < e.db.version,
                    i = e.version > e.db.version;
                if (n && (e.version !== o && console.warn('The database "' + e.name + "\" can't be downgraded from version " + e.db.version + " to version " + e.version + "."), e.version = e.db.version), i || t) {
                    if (t) {
                        var a = e.db.version + 1;
                        a > e.version && (e.version = a)
                    }
                    return !0
                }
                return !1
            }

            function w(e) {
                return new _e(function (o, t) {
                    var n = new FileReader;
                    n.onerror = t, n.onloadend = function (t) {
                        var n = btoa(t.target.result || "");
                        o({ __local_forage_encoded_blob: !0, data: n, type: e.type })
                    }, n.readAsBinaryString(e)
                })
            }

            function v(e) {
                return i([p(atob(e.data))], { type: e.type })
            }

            function E(e) {
                return e && e.__local_forage_encoded_blob
            }

            function T(e) {
                var o = this, t = o._initReady().then(function () {
                    var e = ve[o._dbInfo.name];
                    if (e && e.dbReady) return e.dbReady
                });
                return r(t, e, e), t
            }

            function P(e) {
                h(e);
                for (var o = ve[e.name], t = o.forages, n = 0; n < t.length; n++) {
                    var i = t[n];
                    i._dbInfo.db && (i._dbInfo.db.close(), i._dbInfo.db = null)
                }
                return e.db = null, b(e).then(function (o) {
                    return e.db = o, f(e) ? _(e) : o
                }).then(function (n) {
                    e.db = o.db = n;
                    for (var i = 0; i < t.length; i++) t[i]._dbInfo.db = n
                })["catch"](function (o) {
                    throw g(e, o), o
                })
            }

            function S(e, o, t, n) {
                n === undefined && (n = 1);
                try {
                    var i = e.db.transaction(e.storeName, o);
                    t(null, i)
                } catch (a) {
                    if (n > 0 && (!e.db || "InvalidStateError" === a.name || "NotFoundError" === a.name)) return _e.resolve().then(function () {
                        if (!e.db || "NotFoundError" === a.name && !e.db.objectStoreNames.contains(e.storeName) && e.version <= e.db.version) return e.db && (e.version = e.db.version + 1), _(e)
                    }).then(function () {
                        return P(e).then(function () {
                            S(e, o, t, n - 1)
                        })
                    })["catch"](t);
                    t(a)
                }
            }

            function N() {
                return { forages: [], db: null, dbReady: null, deferredOperations: [] }
            }

            function I(e) {
                function o() {
                    return _e.resolve()
                }

                var t = this, n = { db: null };
                if (e) for (var i in e) n[i] = e[i];
                var a = ve[n.name];
                a || (a = N(), ve[n.name] = a), a.forages.push(t), t._initReady || (t._initReady = t.ready, t.ready = T);
                for (var r = [], s = 0; s < a.forages.length; s++) {
                    var l = a.forages[s];
                    l !== t && r.push(l._initReady()["catch"](o))
                }
                var p = a.forages.slice(0);
                return _e.all(r).then(function () {
                    return n.db = a.db, b(n)
                }).then(function (e) {
                    return n.db = e, f(n, t._defaultConfig.version) ? _(n) : e
                }).then(function (e) {
                    n.db = a.db = e, t._dbInfo = n;
                    for (var o = 0; o < p.length; o++) {
                        var i = p[o];
                        i !== t && (i._dbInfo.db = n.db, i._dbInfo.version = n.version)
                    }
                })
            }

            function C(e, o) {
                var t = this;
                e = s(e);
                var n = new _e(function (o, n) {
                    t.ready().then(function () {
                        S(t._dbInfo, Te, function (i, a) {
                            if (i) return n(i);
                            try {
                                var r = a.objectStore(t._dbInfo.storeName), s = r.get(e);
                                s.onsuccess = function () {
                                    var e = s.result;
                                    e === undefined && (e = null), E(e) && (e = v(e)), o(e)
                                }, s.onerror = function () {
                                    n(s.error)
                                }
                            } catch (l) {
                                n(l)
                            }
                        })
                    })["catch"](n)
                });
                return a(n, o), n
            }

            function R(e, o) {
                var t = this, n = new _e(function (o, n) {
                    t.ready().then(function () {
                        S(t._dbInfo, Te, function (i, a) {
                            if (i) return n(i);
                            try {
                                var r = a.objectStore(t._dbInfo.storeName), s = r.openCursor(), l = 1;
                                s.onsuccess = function () {
                                    var t = s.result;
                                    if (t) {
                                        var n = t.value;
                                        E(n) && (n = v(n));
                                        var i = e(n, t.key, l++);
                                        void 0 !== i ? o(i) : t["continue"]()
                                    } else o()
                                }, s.onerror = function () {
                                    n(s.error)
                                }
                            } catch (p) {
                                n(p)
                            }
                        })
                    })["catch"](n)
                });
                return a(n, o), n
            }

            function y(e, o, t) {
                var n = this;
                e = s(e);
                var i = new _e(function (t, i) {
                    var a;
                    n.ready().then(function () {
                        return a = n._dbInfo, "[object Blob]" === Ee.call(o) ? u(a.db).then(function (e) {
                            return e ? o : w(o)
                        }) : o
                    }).then(function (o) {
                        S(n._dbInfo, Pe, function (a, r) {
                            if (a) return i(a);
                            try {
                                var s = r.objectStore(n._dbInfo.storeName);
                                null === o && (o = undefined);
                                var l = s.put(o, e);
                                r.oncomplete = function () {
                                    o === undefined && (o = null), t(o)
                                }, r.onabort = r.onerror = function () {
                                    var e = l.error ? l.error : l.transaction.error;
                                    i(e)
                                }
                            } catch (p) {
                                i(p)
                            }
                        })
                    })["catch"](i)
                });
                return a(i, t), i
            }

            function L(e, o) {
                var t = this;
                e = s(e);
                var n = new _e(function (o, n) {
                    t.ready().then(function () {
                        S(t._dbInfo, Pe, function (i, a) {
                            if (i) return n(i);
                            try {
                                var r = a.objectStore(t._dbInfo.storeName), s = r["delete"](e);
                                a.oncomplete = function () {
                                    o()
                                }, a.onerror = function () {
                                    n(s.error)
                                }, a.onabort = function () {
                                    var e = s.error ? s.error : s.transaction.error;
                                    n(e)
                                }
                            } catch (l) {
                                n(l)
                            }
                        })
                    })["catch"](n)
                });
                return a(n, o), n
            }

            function D(e) {
                var o = this, t = new _e(function (e, t) {
                    o.ready().then(function () {
                        S(o._dbInfo, Pe, function (n, i) {
                            if (n) return t(n);
                            try {
                                var a = i.objectStore(o._dbInfo.storeName), r = a.clear();
                                i.oncomplete = function () {
                                    e()
                                }, i.onabort = i.onerror = function () {
                                    var e = r.error ? r.error : r.transaction.error;
                                    t(e)
                                }
                            } catch (s) {
                                t(s)
                            }
                        })
                    })["catch"](t)
                });
                return a(t, e), t
            }

            function G(e) {
                var o = this, t = new _e(function (e, t) {
                    o.ready().then(function () {
                        S(o._dbInfo, Te, function (n, i) {
                            if (n) return t(n);
                            try {
                                var a = i.objectStore(o._dbInfo.storeName), r = a.count();
                                r.onsuccess = function () {
                                    e(r.result)
                                }, r.onerror = function () {
                                    t(r.error)
                                }
                            } catch (s) {
                                t(s)
                            }
                        })
                    })["catch"](t)
                });
                return a(t, e), t
            }

            function O(e, o) {
                var t = this, n = new _e(function (o, n) {
                    if (e < 0) return void o(null);
                    t.ready().then(function () {
                        S(t._dbInfo, Te, function (i, a) {
                            if (i) return n(i);
                            try {
                                var r = a.objectStore(t._dbInfo.storeName), s = !1, l = r.openCursor();
                                l.onsuccess = function () {
                                    var t = l.result;
                                    if (!t) return void o(null);
                                    0 === e ? o(t.key) : s ? o(t.key) : (s = !0, t.advance(e))
                                }, l.onerror = function () {
                                    n(l.error)
                                }
                            } catch (p) {
                                n(p)
                            }
                        })
                    })["catch"](n)
                });
                return a(n, o), n
            }

            function x(e) {
                var o = this, t = new _e(function (e, t) {
                    o.ready().then(function () {
                        S(o._dbInfo, Te, function (n, i) {
                            if (n) return t(n);
                            try {
                                var a = i.objectStore(o._dbInfo.storeName), r = a.openCursor(), s = [];
                                r.onsuccess = function () {
                                    var o = r.result;
                                    if (!o) return void e(s);
                                    s.push(o.key), o["continue"]()
                                }, r.onerror = function () {
                                    t(r.error)
                                }
                            } catch (l) {
                                t(l)
                            }
                        })
                    })["catch"](t)
                });
                return a(t, e), t
            }

            function A(e, o) {
                o = l.apply(this, arguments);
                var t = this.config();
                e = "function" != typeof e && e || {}, e.name || (e.name = e.name || t.name, e.storeName = e.storeName || t.storeName);
                var n, i = this;
                if (e.name) {
                    var r = e.name === t.name && i._dbInfo.db,
                        s = r ? _e.resolve(i._dbInfo.db) : b(e).then(function (o) {
                            var t = ve[e.name], n = t.forages;
                            t.db = o;
                            for (var i = 0; i < n.length; i++) n[i]._dbInfo.db = o;
                            return o
                        });
                    n = e.storeName ? s.then(function (o) {
                        if (o.objectStoreNames.contains(e.storeName)) {
                            var t = o.version + 1;
                            h(e);
                            var n = ve[e.name], i = n.forages;
                            o.close();
                            for (var a = 0; a < i.length; a++) {
                                var r = i[a];
                                r._dbInfo.db = null, r._dbInfo.version = t
                            }
                            return new _e(function (o, n) {
                                var i = be.open(e.name, t);
                                i.onerror = function (e) {
                                    i.result.close(), n(e)
                                }, i.onupgradeneeded = function () {
                                    i.result.deleteObjectStore(e.storeName)
                                }, i.onsuccess = function () {
                                    var e = i.result;
                                    e.close(), o(e)
                                }
                            }).then(function (e) {
                                n.db = e;
                                for (var o = 0; o < i.length; o++) {
                                    var t = i[o];
                                    t._dbInfo.db = e, m(t._dbInfo)
                                }
                            })["catch"](function (o) {
                                throw (g(e, o) || _e.resolve())["catch"](function () {
                                }), o
                            })
                        }
                    }) : s.then(function (o) {
                        h(e);
                        var t = ve[e.name], n = t.forages;
                        o.close();
                        for (var i = 0; i < n.length; i++) {
                            n[i]._dbInfo.db = null
                        }
                        return new _e(function (o, t) {
                            var n = be.deleteDatabase(e.name);
                            n.onerror = n.onblocked = function (e) {
                                var o = n.result;
                                o && o.close(), t(e)
                            }, n.onsuccess = function () {
                                var e = n.result;
                                e && e.close(), o(e)
                            }
                        }).then(function (e) {
                            t.db = e;
                            for (var o = 0; o < n.length; o++) m(n[o]._dbInfo)
                        })["catch"](function (o) {
                            throw (g(e, o) || _e.resolve())["catch"](function () {
                            }), o
                        })
                    })
                } else n = _e.reject("Invalid arguments");
                return a(n, o), n
            }

            function k(e) {
                var o, t, n, i, a, r = .75 * e.length, s = e.length, l = 0;
                "=" === e[e.length - 1] && (r--, "=" === e[e.length - 2] && r--);
                var p = new ArrayBuffer(r), c = new Uint8Array(p);
                for (o = 0; o < s; o += 4) t = Ne.indexOf(e[o]), n = Ne.indexOf(e[o + 1]), i = Ne.indexOf(e[o + 2]), a = Ne.indexOf(e[o + 3]), c[l++] = t << 2 | n >> 4, c[l++] = (15 & n) << 4 | i >> 2, c[l++] = (3 & i) << 6 | 63 & a;
                return p
            }

            function U(e) {
                var o, t = new Uint8Array(e), n = "";
                for (o = 0; o < t.length; o += 3) n += Ne[t[o] >> 2], n += Ne[(3 & t[o]) << 4 | t[o + 1] >> 4], n += Ne[(15 & t[o + 1]) << 2 | t[o + 2] >> 6], n += Ne[63 & t[o + 2]];
                return t.length % 3 == 2 ? n = n.substring(0, n.length - 1) + "=" : t.length % 3 == 1 && (n = n.substring(0, n.length - 2) + "=="), n
            }

            function V(e, o) {
                var t = "";
                if (e && (t = He.call(e)), e && ("[object ArrayBuffer]" === t || e.buffer && "[object ArrayBuffer]" === He.call(e.buffer))) {
                    var n, i = Re;
                    e instanceof ArrayBuffer ? (n = e, i += Le) : (n = e.buffer, "[object Int8Array]" === t ? i += Ge : "[object Uint8Array]" === t ? i += Oe : "[object Uint8ClampedArray]" === t ? i += xe : "[object Int16Array]" === t ? i += Ae : "[object Uint16Array]" === t ? i += Ue : "[object Int32Array]" === t ? i += ke : "[object Uint32Array]" === t ? i += Ve : "[object Float32Array]" === t ? i += We : "[object Float64Array]" === t ? i += Me : o(new Error("Failed to get type for BinaryArray"))), o(i + U(n))
                } else if ("[object Blob]" === t) {
                    var a = new FileReader;
                    a.onload = function () {
                        var t = Ie + e.type + "~" + U(this.result);
                        o(Re + De + t)
                    }, a.readAsArrayBuffer(e)
                } else try {
                    o(JSON.stringify(e))
                } catch (r) {
                    console.error("Couldn't convert value into a JSON string: ", e), o(null, r)
                }
            }

            function W(e) {
                if (e.substring(0, ye) !== Re) return JSON.parse(e);
                var o, t = e.substring(Fe), n = e.substring(ye, Fe);
                if (n === De && Ce.test(t)) {
                    var a = t.match(Ce);
                    o = a[1], t = t.substring(a[0].length)
                }
                var r = k(t);
                switch (n) {
                    case Le:
                        return r;
                    case De:
                        return i([r], { type: o });
                    case Ge:
                        return new Int8Array(r);
                    case Oe:
                        return new Uint8Array(r);
                    case xe:
                        return new Uint8ClampedArray(r);
                    case Ae:
                        return new Int16Array(r);
                    case Ue:
                        return new Uint16Array(r);
                    case ke:
                        return new Int32Array(r);
                    case Ve:
                        return new Uint32Array(r);
                    case We:
                        return new Float32Array(r);
                    case Me:
                        return new Float64Array(r);
                    default:
                        throw new Error("Unkown type: " + n)
                }
            }

            function M(e, o, t, n) {
                e.executeSql("CREATE TABLE IF NOT EXISTS " + o.storeName + " (id INTEGER PRIMARY KEY, key unique, value)", [], t, n)
            }

            function F(e) {
                var o = this, t = { db: null };
                if (e) for (var n in e) t[n] = "string" != typeof e[n] ? e[n].toString() : e[n];
                var i = new _e(function (e, n) {
                    try {
                        t.db = openDatabase(t.name, String(t.version), t.description, t.size)
                    } catch (i) {
                        return n(i)
                    }
                    t.db.transaction(function (i) {
                        M(i, t, function () {
                            o._dbInfo = t, e()
                        }, function (e, o) {
                            n(o)
                        })
                    }, n)
                });
                return t.serializer = Be, i
            }

            function H(e, o, t, n, i, a) {
                e.executeSql(t, n, i, function (e, r) {
                    r.code === r.SYNTAX_ERR ? e.executeSql("SELECT name FROM sqlite_master WHERE type='table' AND name = ?", [o.storeName], function (e, s) {
                        s.rows.length ? a(e, r) : M(e, o, function () {
                            e.executeSql(t, n, i, a)
                        }, a)
                    }, a) : a(e, r)
                }, a)
            }

            function B(e, o) {
                var t = this;
                e = s(e);
                var n = new _e(function (o, n) {
                    t.ready().then(function () {
                        var i = t._dbInfo;
                        i.db.transaction(function (t) {
                            H(t, i, "SELECT * FROM " + i.storeName + " WHERE key = ? LIMIT 1", [e], function (e, t) {
                                var n = t.rows.length ? t.rows.item(0).value : null;
                                n && (n = i.serializer.deserialize(n)), o(n)
                            }, function (e, o) {
                                n(o)
                            })
                        })
                    })["catch"](n)
                });
                return a(n, o), n
            }

            function j(e, o) {
                var t = this, n = new _e(function (o, n) {
                    t.ready().then(function () {
                        var i = t._dbInfo;
                        i.db.transaction(function (t) {
                            H(t, i, "SELECT * FROM " + i.storeName, [], function (t, n) {
                                for (var a = n.rows, r = a.length, s = 0; s < r; s++) {
                                    var l = a.item(s), p = l.value;
                                    if (p && (p = i.serializer.deserialize(p)), void 0 !== (p = e(p, l.key, s + 1))) return void o(p)
                                }
                                o()
                            }, function (e, o) {
                                n(o)
                            })
                        })
                    })["catch"](n)
                });
                return a(n, o), n
            }

            function $(e, o, t, n) {
                var i = this;
                e = s(e);
                var r = new _e(function (a, r) {
                    i.ready().then(function () {
                        o === undefined && (o = null);
                        var s = o, l = i._dbInfo;
                        l.serializer.serialize(o, function (o, p) {
                            p ? r(p) : l.db.transaction(function (t) {
                                H(t, l, "INSERT OR REPLACE INTO " + l.storeName + " (key, value) VALUES (?, ?)", [e, o], function () {
                                    a(s)
                                }, function (e, o) {
                                    r(o)
                                })
                            }, function (o) {
                                if (o.code === o.QUOTA_ERR) {
                                    if (n > 0) return void a($.apply(i, [e, s, t, n - 1]));
                                    r(o)
                                }
                            })
                        })
                    })["catch"](r)
                });
                return a(r, t), r
            }

            function q(e, o, t) {
                return $.apply(this, [e, o, t, 1])
            }

            function z(e, o) {
                var t = this;
                e = s(e);
                var n = new _e(function (o, n) {
                    t.ready().then(function () {
                        var i = t._dbInfo;
                        i.db.transaction(function (t) {
                            H(t, i, "DELETE FROM " + i.storeName + " WHERE key = ?", [e], function () {
                                o()
                            }, function (e, o) {
                                n(o)
                            })
                        })
                    })["catch"](n)
                });
                return a(n, o), n
            }

            function K(e) {
                var o = this, t = new _e(function (e, t) {
                    o.ready().then(function () {
                        var n = o._dbInfo;
                        n.db.transaction(function (o) {
                            H(o, n, "DELETE FROM " + n.storeName, [], function () {
                                e()
                            }, function (e, o) {
                                t(o)
                            })
                        })
                    })["catch"](t)
                });
                return a(t, e), t
            }

            function X(e) {
                var o = this, t = new _e(function (e, t) {
                    o.ready().then(function () {
                        var n = o._dbInfo;
                        n.db.transaction(function (o) {
                            H(o, n, "SELECT COUNT(key) as c FROM " + n.storeName, [], function (o, t) {
                                var n = t.rows.item(0).c;
                                e(n)
                            }, function (e, o) {
                                t(o)
                            })
                        })
                    })["catch"](t)
                });
                return a(t, e), t
            }

            function J(e, o) {
                var t = this, n = new _e(function (o, n) {
                    t.ready().then(function () {
                        var i = t._dbInfo;
                        i.db.transaction(function (t) {
                            H(t, i, "SELECT key FROM " + i.storeName + " WHERE id = ? LIMIT 1", [e + 1], function (e, t) {
                                var n = t.rows.length ? t.rows.item(0).key : null;
                                o(n)
                            }, function (e, o) {
                                n(o)
                            })
                        })
                    })["catch"](n)
                });
                return a(n, o), n
            }

            function Y(e) {
                var o = this, t = new _e(function (e, t) {
                    o.ready().then(function () {
                        var n = o._dbInfo;
                        n.db.transaction(function (o) {
                            H(o, n, "SELECT key FROM " + n.storeName, [], function (o, t) {
                                for (var n = [], i = 0; i < t.rows.length; i++) n.push(t.rows.item(i).key);
                                e(n)
                            }, function (e, o) {
                                t(o)
                            })
                        })
                    })["catch"](t)
                });
                return a(t, e), t
            }

            function Q(e) {
                return new _e(function (o, t) {
                    e.transaction(function (n) {
                        n.executeSql("SELECT name FROM sqlite_master WHERE type='table' AND name <> '__WebKitDatabaseInfoTable__'", [], function (t, n) {
                            for (var i = [], a = 0; a < n.rows.length; a++) i.push(n.rows.item(a).name);
                            o({ db: e, storeNames: i })
                        }, function (e, o) {
                            t(o)
                        })
                    }, function (e) {
                        t(e)
                    })
                })
            }

            function Z(e, o) {
                o = l.apply(this, arguments);
                var t = this.config();
                e = "function" != typeof e && e || {}, e.name || (e.name = e.name || t.name, e.storeName = e.storeName || t.storeName);
                var n, i = this;
                return n = e.name ? new _e(function (o) {
                    var n;
                    n = e.name === t.name ? i._dbInfo.db : openDatabase(e.name, "", "", 0), o(e.storeName ? {
                        db: n,
                        storeNames: [e.storeName]
                    } : Q(n))
                }).then(function (e) {
                    return new _e(function (o, t) {
                        e.db.transaction(function (n) {
                            for (var i = [], a = 0, r = e.storeNames.length; a < r; a++) i.push(function (e) {
                                return new _e(function (o, t) {
                                    n.executeSql("DROP TABLE IF EXISTS " + e, [], function () {
                                        o()
                                    }, function (e, o) {
                                        t(o)
                                    })
                                })
                            }(e.storeNames[a]));
                            _e.all(i).then(function () {
                                o()
                            })["catch"](function (e) {
                                t(e)
                            })
                        }, function (e) {
                            t(e)
                        })
                    })
                }) : _e.reject("Invalid arguments"), a(n, o), n
            }

            function ee(e, o) {
                var t = e.name + "/";
                return e.storeName !== o.storeName && (t += e.storeName + "/"), t
            }

            function oe() {
                try {
                    return localStorage.setItem("_localforage_support_test", !0), localStorage.removeItem("_localforage_support_test"), !1
                } catch (e) {
                    return !0
                }
            }

            function te() {
                return !oe() || localStorage.length > 0
            }

            function ne(e) {
                var o = this, t = {};
                if (e) for (var n in e) t[n] = e[n];
                return t.keyPrefix = ee(e, o._defaultConfig), te() ? (o._dbInfo = t, t.serializer = Be, _e.resolve()) : _e.reject()
            }

            function ie(e) {
                var o = this, t = o.ready().then(function () {
                    for (var e = o._dbInfo.keyPrefix, t = localStorage.length - 1; t >= 0; t--) {
                        var n = localStorage.key(t);
                        0 === n.indexOf(e) && localStorage.removeItem(n)
                    }
                });
                return a(t, e), t
            }

            function ae(e, o) {
                var t = this;
                e = s(e);
                var n = t.ready().then(function () {
                    var o = t._dbInfo, n = localStorage.getItem(o.keyPrefix + e);
                    return n && (n = o.serializer.deserialize(n)), n
                });
                return a(n, o), n
            }

            function re(e, o) {
                var t = this, n = t.ready().then(function () {
                    for (var o = t._dbInfo, n = o.keyPrefix, i = n.length, a = localStorage.length, r = 1, s = 0; s < a; s++) {
                        var l = localStorage.key(s);
                        if (0 === l.indexOf(n)) {
                            var p = localStorage.getItem(l);
                            if (p && (p = o.serializer.deserialize(p)), void 0 !== (p = e(p, l.substring(i), r++))) return p
                        }
                    }
                });
                return a(n, o), n
            }

            function se(e, o) {
                var t = this, n = t.ready().then(function () {
                    var o, n = t._dbInfo;
                    try {
                        o = localStorage.key(e)
                    } catch (i) {
                        o = null
                    }
                    return o && (o = o.substring(n.keyPrefix.length)), o
                });
                return a(n, o), n
            }

            function le(e) {
                var o = this, t = o.ready().then(function () {
                    for (var e = o._dbInfo, t = localStorage.length, n = [], i = 0; i < t; i++) {
                        var a = localStorage.key(i);
                        0 === a.indexOf(e.keyPrefix) && n.push(a.substring(e.keyPrefix.length))
                    }
                    return n
                });
                return a(t, e), t
            }

            function pe(e) {
                var o = this, t = o.keys().then(function (e) {
                    return e.length
                });
                return a(t, e), t
            }

            function ce(e, o) {
                var t = this;
                e = s(e);
                var n = t.ready().then(function () {
                    var o = t._dbInfo;
                    localStorage.removeItem(o.keyPrefix + e)
                });
                return a(n, o), n
            }

            function ue(e, o, t) {
                var n = this;
                e = s(e);
                var i = n.ready().then(function () {
                    o === undefined && (o = null);
                    var t = o;
                    return new _e(function (i, a) {
                        var r = n._dbInfo;
                        r.serializer.serialize(o, function (o, n) {
                            if (n) a(n); else try {
                                localStorage.setItem(r.keyPrefix + e, o), i(t)
                            } catch (s) {
                                "QuotaExceededError" !== s.name && "NS_ERROR_DOM_QUOTA_REACHED" !== s.name || a(s), a(s)
                            }
                        })
                    })
                });
                return a(i, t), i
            }

            function he(e, o) {
                if (o = l.apply(this, arguments), e = "function" != typeof e && e || {}, !e.name) {
                    var t = this.config();
                    e.name = e.name || t.name, e.storeName = e.storeName || t.storeName
                }
                var n, i = this;
                return n = e.name ? new _e(function (o) {
                    o(e.storeName ? ee(e, i._defaultConfig) : e.name + "/")
                }).then(function (e) {
                    for (var o = localStorage.length - 1; o >= 0; o--) {
                        var t = localStorage.key(o);
                        0 === t.indexOf(e) && localStorage.removeItem(t)
                    }
                }) : _e.reject("Invalid arguments"), a(n, o), n
            }

            function me(e, o) {
                e[o] = function () {
                    var t = arguments;
                    return arguments.length && "function" == typeof arguments[arguments.length - 1] && (webphone_api.global.localforage_last_cb = arguments[arguments.length - 1]), e.ready().then(function () {
                        return e[o].apply(e, t)
                    })
                }
            }

            function ge() {
                for (var e = 1; e < arguments.length; e++) {
                    var o = arguments[e];
                    if (o) for (var t in o) o.hasOwnProperty(t) && (Ke(o[t]) ? arguments[0][t] = o[t].slice() : arguments[0][t] = o[t])
                }
                return arguments[0]
            }

            var de = "function" == typeof Symbol && "symbol" == typeof Symbol.iterator ? function (e) {
                return typeof e
            } : function (e) {
                return e && "function" == typeof Symbol && e.constructor === Symbol && e !== Symbol.prototype ? "symbol" : typeof e
            }, be = function () {
                try {
                    if ("undefined" != typeof indexedDB) return indexedDB;
                    if ("undefined" != typeof webkitIndexedDB) return webkitIndexedDB;
                    if ("undefined" != typeof mozIndexedDB) return mozIndexedDB;
                    if ("undefined" != typeof OIndexedDB) return OIndexedDB;
                    if ("undefined" != typeof msIndexedDB) return msIndexedDB
                } catch (e) {
                    return
                }
            }();
            "undefined" == typeof Promise && e(3);
            var _e = Promise, fe = "local-forage-detect-blob-support", we = void 0, ve = {},
                Ee = Object.prototype.toString, Te = "readonly", Pe = "readwrite", Se = {
                    _driver: "asyncStorage",
                    _initStorage: I,
                    _support: function () {
                        try {
                            if (!be) return !1;
                            var e = "undefined" != typeof openDatabase && /(Safari|iPhone|iPad|iPod)/.test(navigator.userAgent) && !/Chrome/.test(navigator.userAgent) && !/BlackBerry/.test(navigator.platform),
                                o = "function" == typeof fetch && -1 !== fetch.toString().indexOf("[native code");
                            return (!e || o) && "undefined" != typeof indexedDB && "undefined" != typeof IDBKeyRange
                        } catch (t) {
                            return !1
                        }
                    }(),
                    iterate: R,
                    getItem: C,
                    setItem: y,
                    removeItem: L,
                    clear: D,
                    length: G,
                    key: O,
                    keys: x,
                    dropInstance: A
                }, Ne = "ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/", Ie = "~~local_forage_type~",
                Ce = /^~~local_forage_type~([^~]+)~/, Re = "__lfsc__:", ye = Re.length, Le = "arbf", De = "blob",
                Ge = "si08", Oe = "ui08", xe = "uic8", Ae = "si16", ke = "si32", Ue = "ur16", Ve = "ui32", We = "fl32",
                Me = "fl64", Fe = ye + Le.length, He = Object.prototype.toString,
                Be = { serialize: V, deserialize: W, stringToBuffer: k, bufferToString: U }, je = {
                    _driver: "webSQLStorage",
                    _initStorage: F,
                    _support: function () {
                        return "function" == typeof openDatabase
                    }(),
                    iterate: j,
                    getItem: B,
                    setItem: q,
                    removeItem: z,
                    clear: K,
                    length: X,
                    key: J,
                    keys: Y,
                    dropInstance: Z
                }, $e = {
                    _driver: "localStorageWrapper",
                    _initStorage: ne,
                    _support: function () {
                        try {
                            return "undefined" != typeof localStorage && "setItem" in localStorage && !!localStorage.setItem
                        } catch (e) {
                            return !1
                        }
                    }(),
                    iterate: re,
                    getItem: ae,
                    setItem: ue,
                    removeItem: ce,
                    clear: ie,
                    length: pe,
                    key: se,
                    keys: le,
                    dropInstance: he
                }, qe = function (e, o) {
                    return e === o || "number" == typeof e && "number" == typeof o && isNaN(e) && isNaN(o)
                }, ze = function (e, o) {
                    for (var t = e.length, n = 0; n < t;) {
                        if (qe(e[n], o)) return !0;
                        n++
                    }
                    return !1
                }, Ke = Array.isArray || function (e) {
                    return "[object Array]" === Object.prototype.toString.call(e)
                }, Xe = {}, Je = {}, Ye = { INDEXEDDB: Se, WEBSQL: je, LOCALSTORAGE: $e },
                Qe = [Ye.INDEXEDDB._driver, Ye.WEBSQL._driver, Ye.LOCALSTORAGE._driver], Ze = ["dropInstance"],
                eo = ["clear", "getItem", "iterate", "key", "keys", "length", "removeItem", "setItem"].concat(Ze),
                oo = {
                    description: "",
                    driver: Qe.slice(),
                    name: "localforage",
                    size: 4980736,
                    storeName: "keyvaluepairs",
                    version: 1
                }, to = function () {
                    function e(o) {
                        n(this, e);
                        for (var t in Ye) if (Ye.hasOwnProperty(t)) {
                            var i = Ye[t], a = i._driver;
                            this[t] = a, Xe[a] || this.defineDriver(i)
                        }
                        this._defaultConfig = ge({}, oo), this._config = ge({}, this._defaultConfig, o), this._driverSet = null, this._initDriver = null, this._ready = !1, this._dbInfo = null, this._wrapLibraryMethodsWithReady(), this.setDriver(this._config.driver)["catch"](function () {
                        })
                    }

                    return e.prototype.config = function (e) {
                        if ("object" === (void 0 === e ? "undefined" : de(e))) {
                            if (this._ready) return new Error("Can't call config() after localforage has been used.");
                            for (var o in e) {
                                if ("storeName" === o && (e[o] = e[o].replace(/\W/g, "_")), "version" === o && "number" != typeof e[o]) return new Error("Database version must be a number.");
                                this._config[o] = e[o]
                            }
                            return !("driver" in e && e.driver) || this.setDriver(this._config.driver)
                        }
                        return "string" == typeof e ? this._config[e] : this._config
                    }, e.prototype.defineDriver = function (e, o, t) {
                        var n = new _e(function (o, t) {
                            try {
                                var n = e._driver,
                                    i = new Error("Custom driver not compliant; see https://mozilla.github.io/localForage/#definedriver");
                                if (!e._driver) return void t(i);
                                for (var r = eo.concat("_initStorage"), s = 0, l = r.length; s < l; s++) {
                                    var p = r[s];
                                    if ((!ze(Ze, p) || e[p]) && "function" != typeof e[p]) return void t(i)
                                }
                                !function () {
                                    for (var o = 0, t = Ze.length; o < t; o++) {
                                        var n = Ze[o];
                                        e[n] || (e[n] = function (e) {
                                            return function () {
                                                var o = new Error("Method " + e + " is not implemented by the current driver"),
                                                    t = _e.reject(o);
                                                return a(t, arguments[arguments.length - 1]), t
                                            }
                                        }(n))
                                    }
                                }();
                                var c = function (t) {
                                    Xe[n] && console.info("Redefining LocalForage driver: " + n), Xe[n] = e, Je[n] = t, o()
                                };
                                "_support" in e ? e._support && "function" == typeof e._support ? e._support().then(c, t) : c(!!e._support) : c(!0)
                            } catch (u) {
                                t(u)
                            }
                        });
                        return r(n, o, t), n
                    }, e.prototype.driver = function () {
                        return this._driver || null
                    }, e.prototype.getDriver = function (e, o, t) {
                        var n = Xe[e] ? _e.resolve(Xe[e]) : _e.reject(new Error("Driver not found."));
                        return r(n, o, t), n
                    }, e.prototype.getSerializer = function (e) {
                        var o = _e.resolve(Be);
                        return r(o, e), o
                    }, e.prototype.ready = function (e) {
                        var o = this, t = o._driverSet.then(function () {
                            return null === o._ready && (o._ready = o._initDriver()), o._ready
                        });
                        return r(t, e, e), t
                    }, e.prototype.setDriver = function (e, o, t) {
                        function n() {
                            s._config.driver = s.driver()
                        }

                        function i(e) {
                            return s._extend(e), n(), s._ready = s._initStorage(s._config), s._ready
                        }

                        function a(e) {
                            return function () {
                                function o() {
                                    for (; t < e.length;) {
                                        var a = e[t];
                                        return t++, s._dbInfo = null, s._ready = null, s.getDriver(a).then(i)["catch"](o)
                                    }
                                    n();
                                    var r = new Error("No available storage method found.");
                                    return null !== webphone_api.global.localforage_last_cb && "function" == typeof webphone_api.global.localforage_last_cb && webphone_api.global.localforage_last_cb("ERROR, driverPromiseLoop:No available storage method found.", ""), s._driverSet = _e.reject(r), s._driverSet
                                }

                                var t = 0;
                                return o()
                            }
                        }

                        var s = this;
                        Ke(e) || (e = [e]);
                        var l = this._getSupportedDrivers(e),
                            p = null !== this._driverSet ? this._driverSet["catch"](function () {
                                return _e.resolve()
                            }) : _e.resolve();
                        return this._driverSet = p.then(function () {
                            var e = l[0];
                            return s._dbInfo = null, s._ready = null, s.getDriver(e).then(function (e) {
                                s._driver = e._driver, n(), s._wrapLibraryMethodsWithReady(), s._initDriver = a(l)
                            })
                        })["catch"](function () {
                            n();
                            var e = new Error("No available storage method found.");
                            return s._driverSet = _e.reject(e), s._driverSet
                        }), r(this._driverSet, o, t), this._driverSet
                    }, e.prototype.supports = function (e) {
                        return !!Je[e]
                    }, e.prototype._extend = function (e) {
                        ge(this, e)
                    }, e.prototype._getSupportedDrivers = function (e) {
                        for (var o = [], t = 0, n = e.length; t < n; t++) {
                            var i = e[t];
                            this.supports(i) && o.push(i)
                        }
                        return o
                    }, e.prototype._wrapLibraryMethodsWithReady = function () {
                        for (var e = 0, o = eo.length; e < o; e++) me(this, eo[e])
                    }, e.prototype.createInstance = function (o) {
                        return new e(o)
                    }, e
                }(), no = new to;
            o.exports = no
        }, { 3: 3 }]
    }, {}, [4])(4)
}), function (e, o) {
    function t(e) {
        var o = e.length, t = le.type(e);
        return !le.isWindow(e) && (!(1 !== e.nodeType || !o) || ("array" === t || "function" !== t && (0 === o || "number" == typeof o && o > 0 && o - 1 in e)))
    }

    function n(e) {
        var o = _e[e] = {};
        return le.each(e.match(ce) || [], function (e, t) {
            o[t] = !0
        }), o
    }

    function i(e, t, n, i) {
        if (le.acceptData(e)) {
            var a, r, s = le.expando, l = "string" == typeof t, p = e.nodeType, c = p ? le.cache : e,
                u = p ? e[s] : e[s] && s;
            if (u && c[u] && (i || c[u].data) || !l || n !== o) return u || (p ? e[s] = u = Z.pop() || le.guid++ : u = s), c[u] || (c[u] = {}, p || (c[u].toJSON = le.noop)), ("object" == typeof t || "function" == typeof t) && (i ? c[u] = le.extend(c[u], t) : c[u].data = le.extend(c[u].data, t)), a = c[u], i || (a.data || (a.data = {}), a = a.data), n !== o && (a[le.camelCase(t)] = n), l ? null == (r = a[t]) && (r = a[le.camelCase(t)]) : r = a, r
        }
    }

    function a(e, o, t) {
        if (le.acceptData(e)) {
            var n, i, a, r = e.nodeType, l = r ? le.cache : e, p = r ? e[le.expando] : le.expando;
            if (l[p]) {
                if (o && (a = t ? l[p] : l[p].data)) {
                    le.isArray(o) ? o = o.concat(le.map(o, le.camelCase)) : o in a ? o = [o] : (o = le.camelCase(o), o = o in a ? [o] : o.split(" "));
                    for (n = 0, i = o.length; i > n; n++) delete a[o[n]];
                    if (!(t ? s : le.isEmptyObject)(a)) return
                }
                (t || (delete l[p].data, s(l[p]))) && (r ? le.cleanData([e], !0) : le.support.deleteExpando || l != l.window ? delete l[p] : l[p] = null)
            }
        }
    }

    function r(e, t, n) {
        if (n === o && 1 === e.nodeType) {
            var i = "data-" + t.replace(we, "-$1").toLowerCase();
            if ("string" == typeof (n = e.getAttribute(i))) {
                try {
                    n = "true" === n || "false" !== n && ("null" === n ? null : +n + "" === n ? +n : fe.test(n) ? le.parseJSON(n) : n)
                } catch (K) {
                }
                le.data(e, t, n)
            } else n = o
        }
        return n
    }

    function s(e) {
        var o;
        for (o in e) if (("data" !== o || !le.isEmptyObject(e[o])) && "toJSON" !== o) return !1;
        return !0
    }

    function l() {
        return !0
    }

    function p() {
        return !1
    }

    function c(e, o) {
        do {
            e = e[o]
        } while (e && 1 !== e.nodeType);
        return e
    }

    function u(e, o, t) {
        if (o = o || 0, le.isFunction(o)) return le.grep(e, function (e, n) {
            return !!o.call(e, n, e) === t
        });
        if (o.nodeType) return le.grep(e, function (e) {
            return e === o === t
        });
        if ("string" == typeof o) {
            var n = le.grep(e, function (e) {
                return 1 === e.nodeType
            });
            if (ke.test(o)) return le.filter(o, n, !t);
            o = le.filter(o, n)
        }
        return le.grep(e, function (e) {
            return le.inArray(e, o) >= 0 === t
        })
    }

    function h(e) {
        var o = We.split("|"), t = e.createDocumentFragment();
        if (t.createElement) for (; o.length;) t.createElement(o.pop());
        return t
    }

    function m(e, o) {
        return e.getElementsByTagName(o)[0] || e.appendChild(e.ownerDocument.createElement(o))
    }

    function g(e) {
        var o = e.getAttributeNode("type");
        return e.type = (o && o.specified) + "/" + e.type, e
    }

    function d(e) {
        var o = Je.exec(e.type);
        return o ? e.type = o[1] : e.removeAttribute("type"), e
    }

    function b(e, o) {
        for (var t, n = 0; null != (t = e[n]); n++) le._data(t, "globalEval", !o || le._data(o[n], "globalEval"))
    }

    function _(e, o) {
        if (1 === o.nodeType && le.hasData(e)) {
            var t, n, i, a = le._data(e), r = le._data(o, a), s = a.events;
            if (s) {
                delete r.handle, r.events = {};
                for (t in s) for (n = 0, i = s[t].length; i > n; n++) le.event.add(o, t, s[t][n])
            }
            r.data && (r.data = le.extend({}, r.data))
        }
    }

    function f(e, o) {
        var t, n, i;
        if (1 === o.nodeType) {
            if (t = o.nodeName.toLowerCase(), !le.support.noCloneEvent && o[le.expando]) {
                i = le._data(o);
                for (n in i.events) le.removeEvent(o, n, i.handle);
                o.removeAttribute(le.expando)
            }
            "script" === t && o.text !== e.text ? (g(o).text = e.text, d(o)) : "object" === t ? (o.parentNode && (o.outerHTML = e.outerHTML), le.support.html5Clone && e.innerHTML && !le.trim(o.innerHTML) && (o.innerHTML = e.innerHTML)) : "input" === t && ze.test(e.type) ? (o.defaultChecked = o.checked = e.checked, o.value !== e.value && (o.value = e.value)) : "option" === t ? o.defaultSelected = o.selected = e.defaultSelected : ("input" === t || "textarea" === t) && (o.defaultValue = e.defaultValue)
        }
    }

    function w(e, t) {
        var n, i, a = 0,
            r = typeof e.getElementsByTagName !== z ? e.getElementsByTagName(t || "*") : typeof e.querySelectorAll !== z ? e.querySelectorAll(t || "*") : o;
        if (!r) for (r = [], n = e.childNodes || e; null != (i = n[a]); a++) !t || le.nodeName(i, t) ? r.push(i) : le.merge(r, w(i, t));
        return t === o || t && le.nodeName(e, t) ? le.merge([e], r) : r
    }

    function v(e) {
        ze.test(e.type) && (e.defaultChecked = e.checked)
    }

    function E(e, o) {
        if (o in e) return o;
        for (var t = o.charAt(0).toUpperCase() + o.slice(1), n = o, i = bo.length; i--;) if ((o = bo[i] + t) in e) return o;
        return n
    }

    function T(e, o) {
        return e = o || e, "none" === le.css(e, "display") || !le.contains(e.ownerDocument, e)
    }

    function P(e, o) {
        for (var t, n, i, a = [], r = 0, s = e.length; s > r; r++) n = e[r], n.style && (a[r] = le._data(n, "olddisplay"), t = n.style.display, o ? (a[r] || "none" !== t || (n.style.display = ""), "" === n.style.display && T(n) && (a[r] = le._data(n, "olddisplay", C(n.nodeName)))) : a[r] || (i = T(n), (t && "none" !== t || !i) && le._data(n, "olddisplay", i ? t : le.css(n, "display"))));
        for (r = 0; s > r; r++) n = e[r], n.style && (o && "none" !== n.style.display && "" !== n.style.display || (n.style.display = o ? a[r] || "" : "none"));
        return e
    }

    function S(e, o, t) {
        var n = lo.exec(o);
        return n ? Math.max(0, n[1] - (t || 0)) + (n[2] || "px") : o
    }

    function N(e, o, t, n, i) {
        for (var a = t === (n ? "border" : "content") ? 4 : "width" === o ? 1 : 0, r = 0; 4 > a; a += 2) "margin" === t && (r += le.css(e, t + go[a], !0, i)), n ? ("content" === t && (r -= le.css(e, "padding" + go[a], !0, i)), "margin" !== t && (r -= le.css(e, "border" + go[a] + "Width", !0, i))) : (r += le.css(e, "padding" + go[a], !0, i), "padding" !== t && (r += le.css(e, "border" + go[a] + "Width", !0, i)));
        return r
    }

    function I(e, o, t) {
        var n = !0, i = "width" === o ? e.offsetWidth : e.offsetHeight, a = oo(e),
            r = le.support.boxSizing && "border-box" === le.css(e, "boxSizing", !1, a);
        if (0 >= i || null == i) {
            if (i = to(e, o, a), (0 > i || null == i) && (i = e.style[o]), po.test(i)) return i;
            n = r && (le.support.boxSizingReliable || i === e.style[o]), i = parseFloat(i) || 0
        }
        return i + N(e, o, t || (r ? "border" : "content"), n, a) + "px"
    }

    function C(e) {
        var o = K, t = uo[e];
        return t || (t = R(e, o), "none" !== t && t || (eo = (eo || le("<iframe frameborder='0' width='0' height='0'/>").css("cssText", "display:block !important")).appendTo(o.documentElement), o = (eo[0].contentWindow || eo[0].contentDocument).document, o.write("<!doctype html><html><body>"), o.close(), t = R(e, o), eo.detach()), uo[e] = t), t
    }

    function R(e, o) {
        var t = le(o.createElement(e)).appendTo(o.body), n = le.css(t[0], "display");
        return t.remove(), n
    }

    function y(e, o, t, n) {
        var i;
        if (le.isArray(o)) le.each(o, function (o, i) {
            t || _o.test(e) ? n(e, i) : y(e + "[" + ("object" == typeof i ? o : "") + "]", i, t, n)
        }); else if (t || "object" !== le.type(o)) n(e, o); else for (i in o) y(e + "[" + i + "]", o[i], t, n)
    }

    function L(e) {
        return function (o, t) {
            "string" != typeof o && (t = o, o = "*");
            var n, i = 0, a = o.toLowerCase().match(ce) || [];
            if (le.isFunction(t)) for (; n = a[i++];) "+" === n[0] ? (n = n.slice(1) || "*", (e[n] = e[n] || []).unshift(t)) : (e[n] = e[n] || []).push(t)
        }
    }

    function D(e, t, n, i) {
        function a(l) {
            var p;
            return r[l] = !0, le.each(e[l] || [], function (e, l) {
                var c = l(t, n, i);
                return "string" != typeof c || s || r[c] ? s ? !(p = c) : o : (t.dataTypes.unshift(c), a(c), !1)
            }), p
        }

        var r = {}, s = e === Do;
        return a(t.dataTypes[0]) || !r["*"] && a("*")
    }

    function G(e, t) {
        var n, i, a = le.ajaxSettings.flatOptions || {};
        for (i in t) t[i] !== o && ((a[i] ? e : n || (n = {}))[i] = t[i]);
        return n && le.extend(!0, e, n), e
    }

    function O(e, t, n) {
        var i, a, r, s, l = e.contents, p = e.dataTypes, c = e.responseFields;
        for (s in c) s in n && (t[c[s]] = n[s]);
        for (; "*" === p[0];) p.shift(), a === o && (a = e.mimeType || t.getResponseHeader("Content-Type"));
        if (a) for (s in l) if (l[s] && l[s].test(a)) {
            p.unshift(s);
            break
        }
        if (p[0] in n) r = p[0]; else {
            for (s in n) {
                if (!p[0] || e.converters[s + " " + p[0]]) {
                    r = s;
                    break
                }
                i || (i = s)
            }
            r = r || i
        }
        return r ? (r !== p[0] && p.unshift(r), n[r]) : o
    }

    function x(e, o) {
        var t, n, i, a, r = {}, s = 0, l = e.dataTypes.slice(), p = l[0];
        if (e.dataFilter && (o = e.dataFilter(o, e.dataType)), l[1]) for (i in e.converters) r[i.toLowerCase()] = e.converters[i];
        for (; n = l[++s];) if ("*" !== n) {
            if ("*" !== p && p !== n) {
                if (!(i = r[p + " " + n] || r["* " + n])) for (t in r) if (a = t.split(" "), a[1] === n && (i = r[p + " " + a[0]] || r["* " + a[0]])) {
                    !0 === i ? i = r[t] : !0 !== r[t] && (n = a[0], l.splice(s--, 0, n));
                    break
                }
                if (!0 !== i) if (i && e["throws"]) o = i(o); else try {
                    o = i(o)
                } catch (Z) {
                    return { state: "parsererror", error: i ? Z : "No conversion from " + p + " to " + n }
                }
            }
            p = n
        }
        return { state: "success", data: o }
    }

    function A() {
        try {
            return new e.XMLHttpRequest
        } catch (o) {
        }
    }

    function k() {
        try {
            return new e.ActiveXObject("Microsoft.XMLHTTP")
        } catch (o) {
        }
    }

    function U() {
        return setTimeout(function () {
            Wo = o
        }), Wo = le.now()
    }

    function V(e, o) {
        le.each(o, function (o, t) {
            for (var n = ($o[o] || []).concat($o["*"]), i = 0, a = n.length; a > i; i++) if (n[i].call(e, o, t)) return
        })
    }

    function W(e, o, t) {
        var n, i, a = 0, r = jo.length, s = le.Deferred().always(function () {
            delete l.elem
        }), l = function () {
            if (i) return !1;
            for (var o = Wo || U(), t = Math.max(0, p.startTime + p.duration - o), n = t / p.duration || 0, a = 1 - n, r = 0, l = p.tweens.length; l > r; r++) p.tweens[r].run(a);
            return s.notifyWith(e, [p, a, t]), 1 > a && l ? t : (s.resolveWith(e, [p]), !1)
        }, p = s.promise({
            elem: e,
            props: le.extend({}, o),
            opts: le.extend(!0, { specialEasing: {} }, t),
            originalProperties: o,
            originalOptions: t,
            startTime: Wo || U(),
            duration: t.duration,
            tweens: [],
            createTween: function (o, t) {
                var n = le.Tween(e, p.opts, o, t, p.opts.specialEasing[o] || p.opts.easing);
                return p.tweens.push(n), n
            },
            stop: function (o) {
                var t = 0, n = o ? p.tweens.length : 0;
                if (i) return this;
                for (i = !0; n > t; t++) p.tweens[t].run(1);
                return o ? s.resolveWith(e, [p, o]) : s.rejectWith(e, [p, o]), this
            }
        }), c = p.props;
        for (M(c, p.opts.specialEasing); r > a; a++) if (n = jo[a].call(p, e, c, p.opts)) return n;
        return V(p, c), le.isFunction(p.opts.start) && p.opts.start.call(e, p), le.fx.timer(le.extend(l, {
            elem: e,
            anim: p,
            queue: p.opts.queue
        })), p.progress(p.opts.progress).done(p.opts.done, p.opts.complete).fail(p.opts.fail).always(p.opts.always)
    }

    function M(e, o) {
        var t, n, i, a, r;
        for (i in e) if (n = le.camelCase(i), a = o[n], t = e[i], le.isArray(t) && (a = t[1], t = e[i] = t[0]), i !== n && (e[n] = t, delete e[i]), (r = le.cssHooks[n]) && "expand" in r) {
            t = r.expand(t), delete e[n];
            for (i in t) i in e || (e[i] = t[i], o[i] = a)
        } else o[n] = a
    }

    function F(e, o, t) {
        var n, i, a, r, s, l, p, c, u, h = this, m = e.style, g = {}, d = [], b = e.nodeType && T(e);
        t.queue || (c = le._queueHooks(e, "fx"), null == c.unqueued && (c.unqueued = 0, u = c.empty.fire, c.empty.fire = function () {
            c.unqueued || u()
        }), c.unqueued++, h.always(function () {
            h.always(function () {
                c.unqueued--, le.queue(e, "fx").length || c.empty.fire()
            })
        })), 1 === e.nodeType && ("height" in o || "width" in o) && (t.overflow = [m.overflow, m.overflowX, m.overflowY], "inline" === le.css(e, "display") && "none" === le.css(e, "float") && (le.support.inlineBlockNeedsLayout && "inline" !== C(e.nodeName) ? m.zoom = 1 : m.display = "inline-block")), t.overflow && (m.overflow = "hidden", le.support.shrinkWrapBlocks || h.always(function () {
            m.overflow = t.overflow[0], m.overflowX = t.overflow[1], m.overflowY = t.overflow[2]
        }));
        for (i in o) if (r = o[i], Fo.exec(r)) {
            if (delete o[i], l = l || "toggle" === r, r === (b ? "hide" : "show")) continue;
            d.push(i)
        }
        if (a = d.length) {
            s = le._data(e, "fxshow") || le._data(e, "fxshow", {}), "hidden" in s && (b = s.hidden), l && (s.hidden = !b), b ? le(e).show() : h.done(function () {
                le(e).hide()
            }), h.done(function () {
                var o;
                le._removeData(e, "fxshow");
                for (o in g) le.style(e, o, g[o])
            });
            for (i = 0; a > i; i++) n = d[i], p = h.createTween(n, b ? s[n] : 0), g[n] = s[n] || le.style(e, n), n in s || (s[n] = p.start, b && (p.end = p.start, p.start = "width" === n || "height" === n ? 1 : 0))
        }
    }

    function H(e, o, t, n, i) {
        return new H.prototype.init(e, o, t, n, i)
    }

    function B(e, o) {
        var t, n = { height: e }, i = 0;
        for (o = o ? 1 : 0; 4 > i; i += 2 - o) t = go[i], n["margin" + t] = n["padding" + t] = e;
        return o && (n.opacity = n.width = e), n
    }

    function j(e) {
        return le.isWindow(e) ? e : 9 === e.nodeType && (e.defaultView || e.parentWindow)
    }

    var $, q, z = typeof o, K = e.document, X = e.location, J = e.jQuery, Y = e.$, Q = {}, Z = [], ee = "1.9.1",
        oe = Z.concat, te = Z.push, ne = Z.slice, ie = Z.indexOf, ae = Q.toString, re = Q.hasOwnProperty, se = ee.trim,
        le = function (e, o) {
            return new le.fn.init(e, o, q)
        }, pe = /[+-]?(?:\d*\.|)\d+(?:[eE][+-]?\d+|)/.source, ce = /\S+/g, ue = /^(?:(<[\w\W]+>)[^>]*|#([\w-]*))$/,
        he = /^<(\w+)\s*\/?>(?:<\/\1>|)$/, me = /^[\],:{}\s]*$/, ge = function (e, o) {
            return o.toUpperCase()
        }, de = function (e) {
            (K.addEventListener || "load" === e.type || "complete" === K.readyState) && (be(), le.ready())
        }, be = function () {
            K.addEventListener ? (K.removeEventListener("DOMContentLoaded", de, !1), e.removeEventListener("load", de, !1)) : (K.detachEvent("onreadystatechange", de), e.detachEvent("onload", de))
        };
    le.fn = le.prototype = {
        jquery: ee, constructor: le, init: function (e, t, n) {
            var i, a;
            if (!e) return this;
            if ("string" == typeof e) {
                if (!(i = "<" === e.charAt(0) && ">" === e.charAt(e.length - 1) && e.length >= 3 ? [null, e, null] : ue.exec(e)) || !i[1] && t) return !t || t.jquery ? (t || n).find(e) : this.constructor(t).find(e);
                if (i[1]) {
                    if (t = t instanceof le ? t[0] : t, le.merge(this, le.parseHTML(i[1], t && t.nodeType ? t.ownerDocument || t : K, !0)), he.test(i[1]) && le.isPlainObject(t)) for (i in t) le.isFunction(this[i]) ? this[i](t[i]) : this.attr(i, t[i]);
                    return this
                }
                if ((a = K.getElementById(i[2])) && a.parentNode) {
                    if (a.id !== i[2]) return n.find(e);
                    this.length = 1, this[0] = a
                }
                return this.context = K, this.selector = e, this
            }
            return e.nodeType ? (this.context = this[0] = e, this.length = 1, this) : le.isFunction(e) ? n.ready(e) : (e.selector !== o && (this.selector = e.selector, this.context = e.context), le.makeArray(e, this))
        }, selector: "", length: 0, size: function () {
            return this.length
        }, toArray: function () {
            return ne.call(this)
        }, get: function (e) {
            return null == e ? this.toArray() : 0 > e ? this[this.length + e] : this[e]
        }, pushStack: function (e) {
            var o = le.merge(this.constructor(), e);
            return o.prevObject = this, o.context = this.context, o
        }, each: function (e, o) {
            return le.each(this, e, o)
        }, ready: function (e) {
            return le.ready.promise().done(e), this
        }, slice: function () {
            return this.pushStack(ne.apply(this, arguments))
        }, first: function () {
            return this.eq(0)
        }, last: function () {
            return this.eq(-1)
        }, eq: function (e) {
            var o = this.length, t = +e + (0 > e ? o : 0);
            return this.pushStack(t >= 0 && o > t ? [this[t]] : [])
        }, map: function (e) {
            return this.pushStack(le.map(this, function (o, t) {
                return e.call(o, t, o)
            }))
        }, end: function () {
            return this.prevObject || this.constructor(null)
        }, push: te, sort: [].sort, splice: [].splice
    }, le.fn.init.prototype = le.fn, le.extend = le.fn.extend = function () {
        var e, t, n, i, a, r, s = arguments[0] || {}, l = 1, p = arguments.length, c = !1;
        for ("boolean" == typeof s && (c = s, s = arguments[1] || {}, l = 2), "object" == typeof s || le.isFunction(s) || (s = {}), p === l && (s = this, --l); p > l; l++) if (null != (a = arguments[l])) for (i in a) e = s[i], n = a[i], s !== n && (c && n && (le.isPlainObject(n) || (t = le.isArray(n))) ? (t ? (t = !1, r = e && le.isArray(e) ? e : []) : r = e && le.isPlainObject(e) ? e : {}, s[i] = le.extend(c, r, n)) : n !== o && (s[i] = n));
        return s
    }, le.extend({
        noConflict: function (o) {
            return e.$ === le && (e.$ = Y), o && e.jQuery === le && (e.jQuery = J), le
        }, isReady: !1, readyWait: 1, holdReady: function (e) {
            e ? le.readyWait++ : le.ready(!0)
        }, ready: function (e) {
            if (!0 === e ? !--le.readyWait : !le.isReady) {
                if (!K.body) return setTimeout(le.ready);
                le.isReady = !0, !0 !== e && --le.readyWait > 0 || ($.resolveWith(K, [le]), le.fn.trigger && le(K).trigger("ready").off("ready"))
            }
        }, isFunction: function (e) {
            return "function" === le.type(e)
        }, isArray: Array.isArray || function (e) {
            return "array" === le.type(e)
        }, isWindow: function (e) {
            return null != e && e == e.window
        }, isNumeric: function (e) {
            return !isNaN(parseFloat(e)) && isFinite(e)
        }, type: function (e) {
            return null == e ? e + "" : "object" == typeof e || "function" == typeof e ? Q[ae.call(e)] || "object" : typeof e
        }, isPlainObject: function (e) {
            if (!e || "object" !== le.type(e) || e.nodeType || le.isWindow(e)) return !1;
            try {
                if (e.constructor && !re.call(e, "constructor") && !re.call(e.constructor.prototype, "isPrototypeOf")) return !1
            } catch ($) {
                return !1
            }
            var t;
            for (t in e);
            return t === o || re.call(e, t)
        }, isEmptyObject: function (e) {
            var o;
            for (o in e) return !1;
            return !0
        }, error: function (e) {
            throw Error(e)
        }, parseHTML: function (e, o, t) {
            if (!e || "string" != typeof e) return null;
            "boolean" == typeof o && (t = o, o = !1), o = o || K;
            var n = he.exec(e), i = !t && [];
            return n ? [o.createElement(n[1])] : (n = le.buildFragment([e], o, i), i && le(i).remove(), le.merge([], n.childNodes))
        }, parseJSON: function (t) {
            return e.JSON && e.JSON.parse ? e.JSON.parse(t) : null === t ? t : "string" == typeof t && (t = le.trim(t)) && me.test(t.replace(/\\(?:["\\\/bfnrt]|u[\da-fA-F]{4})/g, "@").replace(/"[^"\\\r\n]*"|true|false|null|-?(?:\d+\.|)\d+(?:[eE][+-]?\d+|)/g, "]").replace(/(?:^|:|,)(?:\s*\[)+/g, "")) ? Function("return " + t)() : (le.error("Invalid JSON: " + t), o)
        }, parseXML: function (t) {
            var n, i;
            if (!t || "string" != typeof t) return null;
            try {
                e.DOMParser ? (i = new DOMParser, n = i.parseFromString(t, "text/xml")) : (n = new ActiveXObject("Microsoft.XMLDOM"), n.async = "false", n.loadXML(t))
            } catch (K) {
                n = o
            }
            return n && n.documentElement && !n.getElementsByTagName("parsererror").length || le.error("Invalid XML: " + t), n
        }, noop: function () {
        }, globalEval: function (o) {
            o && le.trim(o) && (e.execScript || function (o) {
                e.eval.call(e, o)
            })(o)
        }, camelCase: function (e) {
            return e.replace(/^-ms-/, "ms-").replace(/-([\da-z])/gi, ge)
        }, nodeName: function (e, o) {
            return e.nodeName && e.nodeName.toLowerCase() === o.toLowerCase()
        }, each: function (e, o, n) {
            var i = 0, a = e.length, r = t(e);
            if (n) {
                if (r) for (; a > i && !1 !== o.apply(e[i], n); i++); else for (i in e) if (!1 === o.apply(e[i], n)) break
            } else if (r) for (; a > i && !1 !== o.call(e[i], i, e[i]); i++); else for (i in e) if (!1 === o.call(e[i], i, e[i])) break;
            return e
        }, trim: se && !se.call("\ufeff ") ? function (e) {
            return null == e ? "" : se.call(e)
        } : function (e) {
            return null == e ? "" : (e + "").replace(/^[\s\uFEFF\xA0]+|[\s\uFEFF\xA0]+$/g, "")
        }, makeArray: function (e, o) {
            var n = o || [];
            return null != e && (t(Object(e)) ? le.merge(n, "string" == typeof e ? [e] : e) : te.call(n, e)), n
        }, inArray: function (e, o, t) {
            var n;
            if (o) {
                if (ie) return ie.call(o, e, t);
                for (n = o.length, t = t ? 0 > t ? Math.max(0, n + t) : t : 0; n > t; t++) if (t in o && o[t] === e) return t
            }
            return -1
        }, merge: function (e, t) {
            var n = t.length, i = e.length, a = 0;
            if ("number" == typeof n) for (; n > a; a++) e[i++] = t[a]; else for (; t[a] !== o;) e[i++] = t[a++];
            return e.length = i, e
        }, grep: function (e, o, t) {
            var n, i = [], a = 0, r = e.length;
            for (t = !!t; r > a; a++) n = !!o(e[a], a), t !== n && i.push(e[a]);
            return i
        }, map: function (e, o, n) {
            var i, a = 0, r = e.length, s = t(e), l = [];
            if (s) for (; r > a; a++) null != (i = o(e[a], a, n)) && (l[l.length] = i); else for (a in e) null != (i = o(e[a], a, n)) && (l[l.length] = i);
            return oe.apply([], l)
        }, guid: 1, proxy: function (e, t) {
            var n, i, a;
            return "string" == typeof t && (a = e[t], t = e, e = a), le.isFunction(e) ? (n = ne.call(arguments, 2), i = function () {
                return e.apply(t || this, n.concat(ne.call(arguments)))
            }, i.guid = e.guid = e.guid || le.guid++, i) : o
        }, access: function (e, t, n, i, a, r, s) {
            var l = 0, p = e.length, c = null == n;
            if ("object" === le.type(n)) {
                a = !0;
                for (l in n) le.access(e, t, l, n[l], !0, r, s)
            } else if (i !== o && (a = !0, le.isFunction(i) || (s = !0), c && (s ? (t.call(e, i), t = null) : (c = t, t = function (e, o, t) {
                return c.call(le(e), t)
            })), t)) for (; p > l; l++) t(e[l], n, s ? i : i.call(e[l], l, t(e[l], n)));
            return a ? e : c ? t.call(e) : p ? t(e[0], n) : r
        }, now: function () {
            return (new Date).getTime()
        }
    }), le.ready.promise = function (o) {
        if (!$) if ($ = le.Deferred(), "complete" === K.readyState) setTimeout(le.ready); else if (K.addEventListener) K.addEventListener("DOMContentLoaded", de, !1), e.addEventListener("load", de, !1); else {
            K.attachEvent("onreadystatechange", de), e.attachEvent("onload", de);
            var t = !1;
            try {
                t = null == e.frameElement && K.documentElement
            } catch (z) {
            }
            t && t.doScroll && function n() {
                if (!le.isReady) {
                    try {
                        t.doScroll("left")
                    } catch (e) {
                        return setTimeout(n, 50)
                    }
                    be(), le.ready()
                }
            }()
        }
        return $.promise(o)
    }, le.each("Boolean Number String Function Array Date RegExp Object Error".split(" "), function (e, o) {
        Q["[object " + o + "]"] = o.toLowerCase()
    }), q = le(K);
    var _e = {};
    le.Callbacks = function (e) {
        e = "string" == typeof e ? _e[e] || n(e) : le.extend({}, e);
        var t, i, a, r, s, l, p = [], c = !e.once && [], u = function (o) {
            for (i = e.memory && o, a = !0, s = l || 0, l = 0, r = p.length, t = !0; p && r > s; s++) if (!1 === p[s].apply(o[0], o[1]) && e.stopOnFalse) {
                i = !1;
                break
            }
            t = !1, p && (c ? c.length && u(c.shift()) : i ? p = [] : h.disable())
        }, h = {
            add: function () {
                if (p) {
                    var o = p.length;
                    (function n(o) {
                        le.each(o, function (o, t) {
                            var i = le.type(t);
                            "function" === i ? e.unique && h.has(t) || p.push(t) : t && t.length && "string" !== i && n(t)
                        })
                    })(arguments), t ? r = p.length : i && (l = o, u(i))
                }
                return this
            }, remove: function () {
                return p && le.each(arguments, function (e, o) {
                    for (var n; (n = le.inArray(o, p, n)) > -1;) p.splice(n, 1), t && (r >= n && r--, s >= n && s--)
                }), this
            }, has: function (e) {
                return e ? le.inArray(e, p) > -1 : !(!p || !p.length)
            }, empty: function () {
                return p = [], this
            }, disable: function () {
                return p = c = i = o, this
            }, disabled: function () {
                return !p
            }, lock: function () {
                return c = o, i || h.disable(), this
            }, locked: function () {
                return !c
            }, fireWith: function (e, o) {
                return o = o || [], o = [e, o.slice ? o.slice() : o], !p || a && !c || (t ? c.push(o) : u(o)), this
            }, fire: function () {
                return h.fireWith(this, arguments), this
            }, fired: function () {
                return !!a
            }
        };
        return h
    }, le.extend({
        Deferred: function (e) {
            var o = [["resolve", "done", le.Callbacks("once memory"), "resolved"], ["reject", "fail", le.Callbacks("once memory"), "rejected"], ["notify", "progress", le.Callbacks("memory")]],
                t = "pending", n = {
                    state: function () {
                        return t
                    }, always: function () {
                        return i.done(arguments).fail(arguments), this
                    }, then: function () {
                        var e = arguments;
                        return le.Deferred(function (t) {
                            le.each(o, function (o, a) {
                                var r = a[0], s = le.isFunction(e[o]) && e[o];
                                i[a[1]](function () {
                                    var e = s && s.apply(this, arguments);
                                    e && le.isFunction(e.promise) ? e.promise().done(t.resolve).fail(t.reject).progress(t.notify) : t[r + "With"](this === n ? t.promise() : this, s ? [e] : arguments)
                                })
                            }), e = null
                        }).promise()
                    }, promise: function (e) {
                        return null != e ? le.extend(e, n) : n
                    }
                }, i = {};
            return n.pipe = n.then, le.each(o, function (e, a) {
                var r = a[2], s = a[3];
                n[a[1]] = r.add, s && r.add(function () {
                    t = s
                }, o[1 ^ e][2].disable, o[2][2].lock), i[a[0]] = function () {
                    return i[a[0] + "With"](this === i ? n : this, arguments), this
                }, i[a[0] + "With"] = r.fireWith
            }), n.promise(i), e && e.call(i, i), i
        }, when: function (e) {
            var o, t, n, i = 0, a = ne.call(arguments), r = a.length,
                s = 1 !== r || e && le.isFunction(e.promise) ? r : 0, l = 1 === s ? e : le.Deferred(),
                p = function (e, t, n) {
                    return function (i) {
                        t[e] = this, n[e] = arguments.length > 1 ? ne.call(arguments) : i, n === o ? l.notifyWith(t, n) : --s || l.resolveWith(t, n)
                    }
                };
            if (r > 1) for (o = Array(r), t = Array(r), n = Array(r); r > i; i++) a[i] && le.isFunction(a[i].promise) ? a[i].promise().done(p(i, n, a)).fail(l.reject).progress(p(i, t, o)) : --s;
            return s || l.resolveWith(n, a), l.promise()
        }
    }), le.support = function () {
        var o, t, n, i, a, r, s, l, p, c, u = K.createElement("div");
        if (u.setAttribute("className", "t"), u.innerHTML = "  <link/><table></table><a href='/a'>a</a><input type='checkbox'/>", t = u.getElementsByTagName("*"), n = u.getElementsByTagName("a")[0], !t || !n || !t.length) return {};
        a = K.createElement("select"), s = a.appendChild(K.createElement("option")), i = u.getElementsByTagName("input")[0], n.style.cssText = "top:1px;float:left;opacity:.5", o = {
            getSetAttribute: "t" !== u.className,
            leadingWhitespace: 3 === u.firstChild.nodeType,
            tbody: !u.getElementsByTagName("tbody").length,
            htmlSerialize: !!u.getElementsByTagName("link").length,
            style: /top/.test(n.getAttribute("style")),
            hrefNormalized: "/a" === n.getAttribute("href"),
            opacity: /^0.5/.test(n.style.opacity),
            cssFloat: !!n.style.cssFloat,
            checkOn: !!i.value,
            optSelected: s.selected,
            enctype: !!K.createElement("form").enctype,
            html5Clone: "<:nav></:nav>" !== K.createElement("nav").cloneNode(!0).outerHTML,
            boxModel: "CSS1Compat" === K.compatMode,
            deleteExpando: !0,
            noCloneEvent: !0,
            inlineBlockNeedsLayout: !1,
            shrinkWrapBlocks: !1,
            reliableMarginRight: !0,
            boxSizingReliable: !0,
            pixelPosition: !1
        }, i.checked = !0, o.noCloneChecked = i.cloneNode(!0).checked, a.disabled = !0, o.optDisabled = !s.disabled;
        try {
            delete u.test
        } catch (ne) {
            o.deleteExpando = !1
        }
        i = K.createElement("input"), i.setAttribute("value", ""), o.input = "" === i.getAttribute("value"), i.value = "t", i.setAttribute("type", "radio"), o.radioValue = "t" === i.value, i.setAttribute("checked", "t"), i.setAttribute("name", "t"), r = K.createDocumentFragment(), r.appendChild(i), o.appendChecked = i.checked, o.checkClone = r.cloneNode(!0).cloneNode(!0).lastChild.checked, u.attachEvent && (u.attachEvent("onclick", function () {
            o.noCloneEvent = !1
        }), u.cloneNode(!0).click());
        for (c in {
            submit: !0,
            change: !0,
            focusin: !0
        }) u.setAttribute(l = "on" + c, "t"), o[c + "Bubbles"] = l in e || !1 === u.attributes[l].expando;
        return u.style.backgroundClip = "content-box", u.cloneNode(!0).style.backgroundClip = "", o.clearCloneStyle = "content-box" === u.style.backgroundClip, le(function () {
            var t, n, i,
                a = "padding:0;margin:0;border:0;display:block;box-sizing:content-box;-moz-box-sizing:content-box;-webkit-box-sizing:content-box;",
                r = K.getElementsByTagName("body")[0];
            r && (t = K.createElement("div"), t.style.cssText = "border:0;width:0;height:0;position:absolute;top:0;left:-9999px;margin-top:1px", r.appendChild(t).appendChild(u), u.innerHTML = "<table><tr><td></td><td>t</td></tr></table>", i = u.getElementsByTagName("td"), i[0].style.cssText = "padding:0;margin:0;border:0;display:none", p = 0 === i[0].offsetHeight, i[0].style.display = "", i[1].style.display = "none", o.reliableHiddenOffsets = p && 0 === i[0].offsetHeight, u.innerHTML = "", u.style.cssText = "box-sizing:border-box;-moz-box-sizing:border-box;-webkit-box-sizing:border-box;padding:1px;border:1px;display:block;width:4px;margin-top:1%;position:absolute;top:1%;", o.boxSizing = 4 === u.offsetWidth, o.doesNotIncludeMarginInBodyOffset = 1 !== r.offsetTop, e.getComputedStyle && (o.pixelPosition = "1%" !== (e.getComputedStyle(u, null) || {}).top, o.boxSizingReliable = "4px" === (e.getComputedStyle(u, null) || { width: "4px" }).width, n = u.appendChild(K.createElement("div")), n.style.cssText = u.style.cssText = a, n.style.marginRight = n.style.width = "0", u.style.width = "1px", o.reliableMarginRight = !parseFloat((e.getComputedStyle(n, null) || {}).marginRight)), typeof u.style.zoom !== z && (u.innerHTML = "", u.style.cssText = a + "width:1px;padding:1px;display:inline;zoom:1", o.inlineBlockNeedsLayout = 3 === u.offsetWidth, u.style.display = "block", u.innerHTML = "<div></div>", u.firstChild.style.width = "5px", o.shrinkWrapBlocks = 3 !== u.offsetWidth, o.inlineBlockNeedsLayout && (r.style.zoom = 1)), r.removeChild(t), t = u = i = n = null)
        }), t = a = r = s = n = i = null, o
    }();
    var fe = /(?:\{[\s\S]*\}|\[[\s\S]*\])$/, we = /([A-Z])/g;
    le.extend({
        cache: {},
        expando: "jQuery" + (ee + Math.random()).replace(/\D/g, ""),
        noData: { embed: !0, object: "clsid:D27CDB6E-AE6D-11cf-96B8-444553540000", applet: !0 },
        hasData: function (e) {
            return !!(e = e.nodeType ? le.cache[e[le.expando]] : e[le.expando]) && !s(e)
        },
        data: function (e, o, t) {
            return i(e, o, t)
        },
        removeData: function (e, o) {
            return a(e, o)
        },
        _data: function (e, o, t) {
            return i(e, o, t, !0)
        },
        _removeData: function (e, o) {
            return a(e, o, !0)
        },
        acceptData: function (e) {
            if (e.nodeType && 1 !== e.nodeType && 9 !== e.nodeType) return !1;
            var o = e.nodeName && le.noData[e.nodeName.toLowerCase()];
            return !o || !0 !== o && e.getAttribute("classid") === o
        }
    }), le.fn.extend({
        data: function (e, t) {
            var n, i, a = this[0], s = 0, l = null;
            if (e === o) {
                if (this.length && (l = le.data(a), 1 === a.nodeType && !le._data(a, "parsedAttrs"))) {
                    for (n = a.attributes; n.length > s; s++) i = n[s].name, i.indexOf("data-") || (i = le.camelCase(i.slice(5)), r(a, i, l[i]));
                    le._data(a, "parsedAttrs", !0)
                }
                return l
            }
            return "object" == typeof e ? this.each(function () {
                le.data(this, e)
            }) : le.access(this, function (t) {
                return t === o ? a ? r(a, e, le.data(a, e)) : null : (this.each(function () {
                    le.data(this, e, t)
                }), o)
            }, null, t, arguments.length > 1, null, !0)
        }, removeData: function (e) {
            return this.each(function () {
                le.removeData(this, e)
            })
        }
    }), le.extend({
        queue: function (e, t, n) {
            var i;
            return e ? (t = (t || "fx") + "queue", i = le._data(e, t), n && (!i || le.isArray(n) ? i = le._data(e, t, le.makeArray(n)) : i.push(n)), i || []) : o
        }, dequeue: function (e, o) {
            o = o || "fx";
            var t = le.queue(e, o), n = t.length, i = t.shift(), a = le._queueHooks(e, o), r = function () {
                le.dequeue(e, o)
            };
            "inprogress" === i && (i = t.shift(), n--), a.cur = i, i && ("fx" === o && t.unshift("inprogress"), delete a.stop, i.call(e, r, a)), !n && a && a.empty.fire()
        }, _queueHooks: function (e, o) {
            var t = o + "queueHooks";
            return le._data(e, t) || le._data(e, t, {
                empty: le.Callbacks("once memory").add(function () {
                    le._removeData(e, o + "queue"), le._removeData(e, t)
                })
            })
        }
    }), le.fn.extend({
        queue: function (e, t) {
            var n = 2;
            return "string" != typeof e && (t = e, e = "fx", n--), n > arguments.length ? le.queue(this[0], e) : t === o ? this : this.each(function () {
                var o = le.queue(this, e, t);
                le._queueHooks(this, e), "fx" === e && "inprogress" !== o[0] && le.dequeue(this, e)
            })
        }, dequeue: function (e) {
            return this.each(function () {
                le.dequeue(this, e)
            })
        }, delay: function (e, o) {
            return e = le.fx ? le.fx.speeds[e] || e : e, o = o || "fx", this.queue(o, function (o, t) {
                var n = setTimeout(o, e);
                t.stop = function () {
                    clearTimeout(n)
                }
            })
        }, clearQueue: function (e) {
            return this.queue(e || "fx", [])
        }, promise: function (e, t) {
            var n, i = 1, a = le.Deferred(), r = this, s = this.length, l = function () {
                --i || a.resolveWith(r, [r])
            };
            for ("string" != typeof e && (t = e, e = o), e = e || "fx"; s--;) (n = le._data(r[s], e + "queueHooks")) && n.empty && (i++, n.empty.add(l));
            return l(), a.promise(t)
        }
    });
    var ve, Ee, Te = /[\t\r\n]/g, Pe = /^(?:input|select|textarea|button|object)$/i, Se = /^(?:a|area)$/i,
        Ne = /^(?:checked|selected|autofocus|autoplay|async|controls|defer|disabled|hidden|loop|multiple|open|readonly|required|scoped)$/i,
        Ie = /^(?:checked|selected)$/i, Ce = le.support.getSetAttribute, Re = le.support.input;
    le.fn.extend({
        attr: function (e, o) {
            return le.access(this, le.attr, e, o, arguments.length > 1)
        }, removeAttr: function (e) {
            return this.each(function () {
                le.removeAttr(this, e)
            })
        }, prop: function (e, o) {
            return le.access(this, le.prop, e, o, arguments.length > 1)
        }, removeProp: function (e) {
            return e = le.propFix[e] || e, this.each(function () {
                try {
                    this[e] = o, delete this[e]
                } catch ($) {
                }
            })
        }, addClass: function (e) {
            var o, t, n, i, a, r = 0, s = this.length, l = "string" == typeof e && e;
            if (le.isFunction(e)) return this.each(function (o) {
                le(this).addClass(e.call(this, o, this.className))
            });
            if (l) for (o = (e || "").match(ce) || []; s > r; r++) if (t = this[r], n = 1 === t.nodeType && (t.className ? (" " + t.className + " ").replace(Te, " ") : " ")) {
                for (a = 0; i = o[a++];) 0 > n.indexOf(" " + i + " ") && (n += i + " ");
                t.className = le.trim(n)
            }
            return this
        }, removeClass: function (e) {
            var o, t, n, i, a, r = 0, s = this.length, l = 0 === arguments.length || "string" == typeof e && e;
            if (le.isFunction(e)) return this.each(function (o) {
                le(this).removeClass(e.call(this, o, this.className))
            });
            if (l) for (o = (e || "").match(ce) || []; s > r; r++) if (t = this[r], n = 1 === t.nodeType && (t.className ? (" " + t.className + " ").replace(Te, " ") : "")) {
                for (a = 0; i = o[a++];) for (; n.indexOf(" " + i + " ") >= 0;) n = n.replace(" " + i + " ", " ");
                t.className = e ? le.trim(n) : ""
            }
            return this
        }, toggleClass: function (e, o) {
            var t = typeof e, n = "boolean" == typeof o;
            return le.isFunction(e) ? this.each(function (t) {
                le(this).toggleClass(e.call(this, t, this.className, o), o)
            }) : this.each(function () {
                if ("string" === t) for (var i, a = 0, r = le(this), s = o, l = e.match(ce) || []; i = l[a++];) s = n ? s : !r.hasClass(i), r[s ? "addClass" : "removeClass"](i); else (t === z || "boolean" === t) && (this.className && le._data(this, "__className__", this.className), this.className = this.className || !1 === e ? "" : le._data(this, "__className__") || "")
            })
        }, hasClass: function (e) {
            for (var o = " " + e + " ", t = 0, n = this.length; n > t; t++) if (1 === this[t].nodeType && (" " + this[t].className + " ").replace(Te, " ").indexOf(o) >= 0) return !0;
            return !1
        }, val: function (e) {
            var t, n, i, a = this[0];
            return arguments.length ? (i = le.isFunction(e), this.each(function (t) {
                var a, r = le(this);
                1 === this.nodeType && (a = i ? e.call(this, t, r.val()) : e, null == a ? a = "" : "number" == typeof a ? a += "" : le.isArray(a) && (a = le.map(a, function (e) {
                    return null == e ? "" : e + ""
                })), (n = le.valHooks[this.type] || le.valHooks[this.nodeName.toLowerCase()]) && "set" in n && n.set(this, a, "value") !== o || (this.value = a))
            })) : a ? (n = le.valHooks[a.type] || le.valHooks[a.nodeName.toLowerCase()], n && "get" in n && (t = n.get(a, "value")) !== o ? t : (t = a.value, "string" == typeof t ? t.replace(/\r/g, "") : null == t ? "" : t)) : void 0
        }
    }), le.extend({
        valHooks: {
            option: {
                get: function (e) {
                    var o = e.attributes.value;
                    return !o || o.specified ? e.value : e.text
                }
            }, select: {
                get: function (e) {
                    for (var o, t, n = e.options, i = e.selectedIndex, a = "select-one" === e.type || 0 > i, r = a ? null : [], s = a ? i + 1 : n.length, l = 0 > i ? s : a ? i : 0; s > l; l++) if (t = n[l], !(!t.selected && l !== i || (le.support.optDisabled ? t.disabled : null !== t.getAttribute("disabled")) || t.parentNode.disabled && le.nodeName(t.parentNode, "optgroup"))) {
                        if (o = le(t).val(), a) return o;
                        r.push(o)
                    }
                    return r
                }, set: function (e, o) {
                    var t = le.makeArray(o);
                    return le(e).find("option").each(function () {
                        this.selected = le.inArray(le(this).val(), t) >= 0
                    }), t.length || (e.selectedIndex = -1), t
                }
            }
        },
        attr: function (e, t, n) {
            var i, a, r, s = e.nodeType;
            if (e && 3 !== s && 8 !== s && 2 !== s) return typeof e.getAttribute === z ? le.prop(e, t, n) : (a = 1 !== s || !le.isXMLDoc(e), a && (t = t.toLowerCase(), i = le.attrHooks[t] || (Ne.test(t) ? Ee : ve)), n === o ? i && a && "get" in i && null !== (r = i.get(e, t)) ? r : (typeof e.getAttribute !== z && (r = e.getAttribute(t)), null == r ? o : r) : null !== n ? i && a && "set" in i && (r = i.set(e, n, t)) !== o ? r : (e.setAttribute(t, n + ""), n) : (le.removeAttr(e, t), o))
        },
        removeAttr: function (e, o) {
            var t, n, i = 0, a = o && o.match(ce);
            if (a && 1 === e.nodeType) for (; t = a[i++];) n = le.propFix[t] || t, Ne.test(t) ? !Ce && Ie.test(t) ? e[le.camelCase("default-" + t)] = e[n] = !1 : e[n] = !1 : le.attr(e, t, ""), e.removeAttribute(Ce ? t : n)
        },
        attrHooks: {
            type: {
                set: function (e, o) {
                    if (!le.support.radioValue && "radio" === o && le.nodeName(e, "input")) {
                        var t = e.value;
                        return e.setAttribute("type", o), t && (e.value = t), o
                    }
                }
            }
        },
        propFix: {
            tabindex: "tabIndex",
            readonly: "readOnly",
            "for": "htmlFor",
            "class": "className",
            maxlength: "maxLength",
            cellspacing: "cellSpacing",
            cellpadding: "cellPadding",
            rowspan: "rowSpan",
            colspan: "colSpan",
            usemap: "useMap",
            frameborder: "frameBorder",
            contenteditable: "contentEditable"
        },
        prop: function (e, t, n) {
            var i, a, r, s = e.nodeType;
            if (e && 3 !== s && 8 !== s && 2 !== s) return r = 1 !== s || !le.isXMLDoc(e), r && (t = le.propFix[t] || t, a = le.propHooks[t]), n !== o ? a && "set" in a && (i = a.set(e, n, t)) !== o ? i : e[t] = n : a && "get" in a && null !== (i = a.get(e, t)) ? i : e[t]
        },
        propHooks: {
            tabIndex: {
                get: function (e) {
                    var t = e.getAttributeNode("tabindex");
                    return t && t.specified ? parseInt(t.value, 10) : Pe.test(e.nodeName) || Se.test(e.nodeName) && e.href ? 0 : o
                }
            }
        }
    }), Ee = {
        get: function (e, t) {
            var n = le.prop(e, t), i = "boolean" == typeof n && e.getAttribute(t),
                a = "boolean" == typeof n ? Re && Ce ? null != i : Ie.test(t) ? e[le.camelCase("default-" + t)] : !!i : e.getAttributeNode(t);
            return a && !1 !== a.value ? t.toLowerCase() : o
        }, set: function (e, o, t) {
            return !1 === o ? le.removeAttr(e, t) : Re && Ce || !Ie.test(t) ? e.setAttribute(!Ce && le.propFix[t] || t, t) : e[le.camelCase("default-" + t)] = e[t] = !0, t
        }
    }, Re && Ce || (le.attrHooks.value = {
        get: function (e, t) {
            var n = e.getAttributeNode(t);
            return le.nodeName(e, "input") ? e.defaultValue : n && n.specified ? n.value : o
        }, set: function (e, t, n) {
            return le.nodeName(e, "input") ? (e.defaultValue = t, o) : ve && ve.set(e, t, n)
        }
    }), Ce || (ve = le.valHooks.button = {
        get: function (e, t) {
            var n = e.getAttributeNode(t);
            return n && ("id" === t || "name" === t || "coords" === t ? "" !== n.value : n.specified) ? n.value : o
        }, set: function (e, t, n) {
            var i = e.getAttributeNode(n);
            return i || e.setAttributeNode(i = e.ownerDocument.createAttribute(n)), i.value = t += "", "value" === n || t === e.getAttribute(n) ? t : o
        }
    }, le.attrHooks.contenteditable = {
        get: ve.get, set: function (e, o, t) {
            ve.set(e, "" !== o && o, t)
        }
    }, le.each(["width", "height"], function (e, t) {
        le.attrHooks[t] = le.extend(le.attrHooks[t], {
            set: function (e, n) {
                return "" === n ? (e.setAttribute(t, "auto"), n) : o
            }
        })
    })), le.support.hrefNormalized || (le.each(["href", "src", "width", "height"], function (e, t) {
        le.attrHooks[t] = le.extend(le.attrHooks[t], {
            get: function (e) {
                var n = e.getAttribute(t, 2);
                return null == n ? o : n
            }
        })
    }), le.each(["href", "src"], function (e, o) {
        le.propHooks[o] = {
            get: function (e) {
                return e.getAttribute(o, 4)
            }
        }
    })), le.support.style || (le.attrHooks.style = {
        get: function (e) {
            return e.style.cssText || o
        }, set: function (e, o) {
            return e.style.cssText = o + ""
        }
    }), le.support.optSelected || (le.propHooks.selected = le.extend(le.propHooks.selected, {
        get: function (e) {
            var o = e.parentNode;
            return o && (o.selectedIndex, o.parentNode && o.parentNode.selectedIndex), null
        }
    })), le.support.enctype || (le.propFix.enctype = "encoding"), le.support.checkOn || le.each(["radio", "checkbox"], function () {
        le.valHooks[this] = {
            get: function (e) {
                return null === e.getAttribute("value") ? "on" : e.value
            }
        }
    }), le.each(["radio", "checkbox"], function () {
        le.valHooks[this] = le.extend(le.valHooks[this], {
            set: function (e, t) {
                return le.isArray(t) ? e.checked = le.inArray(le(e).val(), t) >= 0 : o
            }
        })
    });
    var ye = /^(?:input|select|textarea)$/i, Le = /^key/, De = /^(?:mouse|contextmenu)|click/,
        Ge = /^(?:focusinfocus|focusoutblur)$/, Oe = /^([^.]*)(?:\.(.+)|)$/;
    le.event = {
        global: {},
        add: function (e, t, n, i, a) {
            var r, s, l, p, c, u, h, m, g, d, b, _ = le._data(e);
            if (_) {
                for (n.handler && (p = n, n = p.handler, a = p.selector), n.guid || (n.guid = le.guid++), (s = _.events) || (s = _.events = {}), (u = _.handle) || (u = _.handle = function (e) {
                    return typeof le === z || e && le.event.triggered === e.type ? o : le.event.dispatch.apply(u.elem, arguments)
                }, u.elem = e), t = (t || "").match(ce) || [""], l = t.length; l--;) r = Oe.exec(t[l]) || [], g = b = r[1], d = (r[2] || "").split(".").sort(), c = le.event.special[g] || {}, g = (a ? c.delegateType : c.bindType) || g, c = le.event.special[g] || {}, h = le.extend({
                    type: g,
                    origType: b,
                    data: i,
                    handler: n,
                    guid: n.guid,
                    selector: a,
                    needsContext: a && le.expr.match.needsContext.test(a),
                    namespace: d.join(".")
                }, p), (m = s[g]) || (m = s[g] = [], m.delegateCount = 0, c.setup && !1 !== c.setup.call(e, i, d, u) || (e.addEventListener ? e.addEventListener(g, u, !1) : e.attachEvent && e.attachEvent("on" + g, u))), c.add && (c.add.call(e, h), h.handler.guid || (h.handler.guid = n.guid)), a ? m.splice(m.delegateCount++, 0, h) : m.push(h), le.event.global[g] = !0;
                e = null
            }
        },
        remove: function (e, o, t, n, i) {
            var a, r, s, l, p, c, u, h, m, g, d, b = le.hasData(e) && le._data(e);
            if (b && (c = b.events)) {
                for (o = (o || "").match(ce) || [""], p = o.length; p--;) if (s = Oe.exec(o[p]) || [], m = d = s[1], g = (s[2] || "").split(".").sort(), m) {
                    for (u = le.event.special[m] || {}, m = (n ? u.delegateType : u.bindType) || m, h = c[m] || [], s = s[2] && RegExp("(^|\\.)" + g.join("\\.(?:.*\\.|)") + "(\\.|$)"), l = a = h.length; a--;) r = h[a], !i && d !== r.origType || t && t.guid !== r.guid || s && !s.test(r.namespace) || n && n !== r.selector && ("**" !== n || !r.selector) || (h.splice(a, 1), r.selector && h.delegateCount--, u.remove && u.remove.call(e, r));
                    l && !h.length && (u.teardown && !1 !== u.teardown.call(e, g, b.handle) || le.removeEvent(e, m, b.handle), delete c[m])
                } else for (m in c) le.event.remove(e, m + o[p], t, n, !0);
                le.isEmptyObject(c) && (delete b.handle, le._removeData(e, "events"))
            }
        },
        trigger: function (t, n, i, a) {
            var r, s, l, p, c, u, h, m = [i || K], g = re.call(t, "type") ? t.type : t,
                d = re.call(t, "namespace") ? t.namespace.split(".") : [];
            if (l = u = i = i || K, 3 !== i.nodeType && 8 !== i.nodeType && !Ge.test(g + le.event.triggered) && (g.indexOf(".") >= 0 && (d = g.split("."), g = d.shift(), d.sort()), s = 0 > g.indexOf(":") && "on" + g, t = t[le.expando] ? t : new le.Event(g, "object" == typeof t && t), t.isTrigger = !0, t.namespace = d.join("."), t.namespace_re = t.namespace ? RegExp("(^|\\.)" + d.join("\\.(?:.*\\.|)") + "(\\.|$)") : null, t.result = o, t.target || (t.target = i), n = null == n ? [t] : le.makeArray(n, [t]), c = le.event.special[g] || {}, a || !c.trigger || !1 !== c.trigger.apply(i, n))) {
                if (!a && !c.noBubble && !le.isWindow(i)) {
                    for (p = c.delegateType || g, Ge.test(p + g) || (l = l.parentNode); l; l = l.parentNode) m.push(l), u = l;
                    u === (i.ownerDocument || K) && m.push(u.defaultView || u.parentWindow || e)
                }
                for (h = 0; (l = m[h++]) && !t.isPropagationStopped();) t.type = h > 1 ? p : c.bindType || g, r = (le._data(l, "events") || {})[t.type] && le._data(l, "handle"), r && r.apply(l, n), (r = s && l[s]) && le.acceptData(l) && r.apply && !1 === r.apply(l, n) && t.preventDefault();
                if (t.type = g, !(a || t.isDefaultPrevented() || c._default && !1 !== c._default.apply(i.ownerDocument, n) || "click" === g && le.nodeName(i, "a") || !le.acceptData(i) || !s || !i[g] || le.isWindow(i))) {
                    u = i[s], u && (i[s] = null), le.event.triggered = g;
                    try {
                        i[g]()
                    } catch (se) {
                    }
                    le.event.triggered = o, u && (i[s] = u)
                }
                return t.result
            }
        },
        dispatch: function (e) {
            e = le.event.fix(e);
            var t, n, i, a, r, s = [], l = ne.call(arguments), p = (le._data(this, "events") || {})[e.type] || [],
                c = le.event.special[e.type] || {};
            if (l[0] = e, e.delegateTarget = this, !c.preDispatch || !1 !== c.preDispatch.call(this, e)) {
                for (s = le.event.handlers.call(this, e, p), t = 0; (a = s[t++]) && !e.isPropagationStopped();) for (e.currentTarget = a.elem, r = 0; (i = a.handlers[r++]) && !e.isImmediatePropagationStopped();) (!e.namespace_re || e.namespace_re.test(i.namespace)) && (e.handleObj = i, e.data = i.data, (n = ((le.event.special[i.origType] || {}).handle || i.handler).apply(a.elem, l)) !== o && !1 === (e.result = n) && (e.preventDefault(), e.stopPropagation()));
                return c.postDispatch && c.postDispatch.call(this, e), e.result
            }
        },
        handlers: function (e, t) {
            var n, i, a, r, s = [], l = t.delegateCount, p = e.target;
            if (l && p.nodeType && (!e.button || "click" !== e.type)) for (; p != this; p = p.parentNode || this) if (1 === p.nodeType && (!0 !== p.disabled || "click" !== e.type)) {
                for (a = [], r = 0; l > r; r++) i = t[r], n = i.selector + " ", a[n] === o && (a[n] = i.needsContext ? le(n, this).index(p) >= 0 : le.find(n, this, null, [p]).length), a[n] && a.push(i);
                a.length && s.push({ elem: p, handlers: a })
            }
            return t.length > l && s.push({ elem: this, handlers: t.slice(l) }), s
        },
        fix: function (e) {
            if (e[le.expando]) return e;
            var o, t, n, i = e.type, a = e, r = this.fixHooks[i];
            for (r || (this.fixHooks[i] = r = De.test(i) ? this.mouseHooks : Le.test(i) ? this.keyHooks : {}), n = r.props ? this.props.concat(r.props) : this.props, e = new le.Event(a), o = n.length; o--;) t = n[o], e[t] = a[t];
            return e.target || (e.target = a.srcElement || K), 3 === e.target.nodeType && (e.target = e.target.parentNode), e.metaKey = !!e.metaKey, r.filter ? r.filter(e, a) : e
        },
        props: "altKey bubbles cancelable ctrlKey currentTarget eventPhase metaKey relatedTarget shiftKey target timeStamp view which".split(" "),
        fixHooks: {},
        keyHooks: {
            props: "char charCode key keyCode".split(" "), filter: function (e, o) {
                return null == e.which && (e.which = null != o.charCode ? o.charCode : o.keyCode), e
            }
        },
        mouseHooks: {
            props: "button buttons clientX clientY fromElement offsetX offsetY pageX pageY screenX screenY toElement".split(" "),
            filter: function (e, t) {
                var n, i, a, r = t.button, s = t.fromElement;
                return null == e.pageX && null != t.clientX && (i = e.target.ownerDocument || K, a = i.documentElement, n = i.body, e.pageX = t.clientX + (a && a.scrollLeft || n && n.scrollLeft || 0) - (a && a.clientLeft || n && n.clientLeft || 0), e.pageY = t.clientY + (a && a.scrollTop || n && n.scrollTop || 0) - (a && a.clientTop || n && n.clientTop || 0)), !e.relatedTarget && s && (e.relatedTarget = s === e.target ? t.toElement : s), e.which || r === o || (e.which = 1 & r ? 1 : 2 & r ? 3 : 4 & r ? 2 : 0), e
            }
        },
        special: {
            load: { noBubble: !0 }, click: {
                trigger: function () {
                    return le.nodeName(this, "input") && "checkbox" === this.type && this.click ? (this.click(), !1) : o
                }
            }, focus: {
                trigger: function () {
                    if (this !== K.activeElement && this.focus) try {
                        return this.focus(), !1
                    } catch (e) {
                    }
                }, delegateType: "focusin"
            }, blur: {
                trigger: function () {
                    return this === K.activeElement && this.blur ? (this.blur(), !1) : o
                }, delegateType: "focusout"
            }, beforeunload: {
                postDispatch: function (e) {
                    e.result !== o && (e.originalEvent.returnValue = e.result)
                }
            }
        },
        simulate: function (e, o, t, n) {
            var i = le.extend(new le.Event, t, { type: e, isSimulated: !0, originalEvent: {} });
            n ? le.event.trigger(i, null, o) : le.event.dispatch.call(o, i), i.isDefaultPrevented() && t.preventDefault()
        }
    }, le.removeEvent = K.removeEventListener ? function (e, o, t) {
        e.removeEventListener && e.removeEventListener(o, t, !1)
    } : function (e, o, t) {
        var n = "on" + o;
        e.detachEvent && (typeof e[n] === z && (e[n] = null), e.detachEvent(n, t))
    }, le.Event = function (e, t) {
        return this instanceof le.Event ? (e && e.type ? (this.originalEvent = e, this.type = e.type, this.isDefaultPrevented = e.defaultPrevented || !1 === e.returnValue || e.defaultPrevented ? l : p) : this.type = e, t && le.extend(this, t), this.timeStamp = e && e.timeStamp || le.now(), this[le.expando] = !0, o) : new le.Event(e, t)
    }, le.Event.prototype = {
        isDefaultPrevented: p,
        isPropagationStopped: p,
        isImmediatePropagationStopped: p,
        preventDefault: function () {
            var e = this.originalEvent;
            this.isDefaultPrevented = l, e && (e.preventDefault ? e.preventDefault() : e.returnValue = !1)
        },
        stopPropagation: function () {
            var e = this.originalEvent;
            this.isPropagationStopped = l, e && (e.stopPropagation && e.stopPropagation(), e.cancelBubble = !0)
        },
        stopImmediatePropagation: function () {
            this.isImmediatePropagationStopped = l, this.stopPropagation()
        }
    }, le.each({ mouseenter: "mouseover", mouseleave: "mouseout" }, function (e, o) {
        le.event.special[e] = {
            delegateType: o, bindType: o, handle: function (e) {
                var t, n = this, i = e.relatedTarget, a = e.handleObj;
                return (!i || i !== n && !le.contains(n, i)) && (e.type = a.origType, t = a.handler.apply(this, arguments), e.type = o), t
            }
        }
    }), le.support.submitBubbles || (le.event.special.submit = {
        setup: function () {
            return !le.nodeName(this, "form") && (le.event.add(this, "click._submit keypress._submit", function (e) {
                var t = e.target, n = le.nodeName(t, "input") || le.nodeName(t, "button") ? t.form : o;
                n && !le._data(n, "submitBubbles") && (le.event.add(n, "submit._submit", function (e) {
                    e._submit_bubble = !0
                }), le._data(n, "submitBubbles", !0))
            }), o)
        }, postDispatch: function (e) {
            e._submit_bubble && (delete e._submit_bubble, this.parentNode && !e.isTrigger && le.event.simulate("submit", this.parentNode, e, !0))
        }, teardown: function () {
            return !le.nodeName(this, "form") && (le.event.remove(this, "._submit"), o)
        }
    }), le.support.changeBubbles || (le.event.special.change = {
        setup: function () {
            return ye.test(this.nodeName) ? (("checkbox" === this.type || "radio" === this.type) && (le.event.add(this, "propertychange._change", function (e) {
                "checked" === e.originalEvent.propertyName && (this._just_changed = !0)
            }), le.event.add(this, "click._change", function (e) {
                this._just_changed && !e.isTrigger && (this._just_changed = !1), le.event.simulate("change", this, e, !0)
            })), !1) : (le.event.add(this, "beforeactivate._change", function (e) {
                var o = e.target;
                ye.test(o.nodeName) && !le._data(o, "changeBubbles") && (le.event.add(o, "change._change", function (e) {
                    !this.parentNode || e.isSimulated || e.isTrigger || le.event.simulate("change", this.parentNode, e, !0)
                }), le._data(o, "changeBubbles", !0))
            }), o)
        }, handle: function (e) {
            var t = e.target;
            return this !== t || e.isSimulated || e.isTrigger || "radio" !== t.type && "checkbox" !== t.type ? e.handleObj.handler.apply(this, arguments) : o
        }, teardown: function () {
            return le.event.remove(this, "._change"), !ye.test(this.nodeName)
        }
    }), le.support.focusinBubbles || le.each({ focus: "focusin", blur: "focusout" }, function (e, o) {
        var t = 0, n = function (e) {
            le.event.simulate(o, e.target, le.event.fix(e), !0)
        };
        le.event.special[o] = {
            setup: function () {
                0 == t++ && K.addEventListener(e, n, !0)
            }, teardown: function () {
                0 == --t && K.removeEventListener(e, n, !0)
            }
        }
    }), le.fn.extend({
        on: function (e, t, n, i, a) {
            var r, s;
            if ("object" == typeof e) {
                "string" != typeof t && (n = n || t, t = o);
                for (r in e) this.on(r, t, n, e[r], a);
                return this
            }
            if (null == n && null == i ? (i = t, n = t = o) : null == i && ("string" == typeof t ? (i = n, n = o) : (i = n, n = t, t = o)), !1 === i) i = p; else if (!i) return this;
            return 1 === a && (s = i, i = function (e) {
                return le().off(e), s.apply(this, arguments)
            }, i.guid = s.guid || (s.guid = le.guid++)), this.each(function () {
                le.event.add(this, e, i, n, t)
            })
        }, one: function (e, o, t, n) {
            return this.on(e, o, t, n, 1)
        }, off: function (e, t, n) {
            var i, a;
            if (e && e.preventDefault && e.handleObj) return i = e.handleObj, le(e.delegateTarget).off(i.namespace ? i.origType + "." + i.namespace : i.origType, i.selector, i.handler), this;
            if ("object" == typeof e) {
                for (a in e) this.off(a, t, e[a]);
                return this
            }
            return (!1 === t || "function" == typeof t) && (n = t, t = o), !1 === n && (n = p), this.each(function () {
                le.event.remove(this, e, n, t)
            })
        }, bind: function (e, o, t) {
            return this.on(e, null, o, t)
        }, unbind: function (e, o) {
            return this.off(e, null, o)
        }, delegate: function (e, o, t, n) {
            return this.on(o, e, t, n)
        }, undelegate: function (e, o, t) {
            return 1 === arguments.length ? this.off(e, "**") : this.off(o, e || "**", t)
        }, trigger: function (e, o) {
            return this.each(function () {
                le.event.trigger(e, o, this)
            })
        }, triggerHandler: function (e, t) {
            var n = this[0];
            return n ? le.event.trigger(e, t, n, !0) : o
        }
    }), function (e, o) {
        function t(e) {
            return ue.test(e + "")
        }

        function n() {
            var e, o = [];
            return e = function (t, n) {
                return o.push(t += " ") > T.cacheLength && delete e[o.shift()], e[t] = n
            }
        }

        function i(e) {
            return e[U] = !0, e
        }

        function a(e) {
            var o = y.createElement("div");
            try {
                return e(o)
            } catch (v) {
                return !1
            } finally {
                o = null
            }
        }

        function r(e, o, t, n) {
            var i, a, r, s, l, u, h, m, g, d;
            if ((o ? o.ownerDocument || o : V) !== y && R(o), o = o || y, t = t || [], !e || "string" != typeof e) return t;
            if (1 !== (s = o.nodeType) && 9 !== s) return [];
            if (!D && !n) {
                if (i = he.exec(e)) if (r = i[1]) {
                    if (9 === s) {
                        if (!(a = o.getElementById(r)) || !a.parentNode) return t;
                        if (a.id === r) return t.push(a), t
                    } else if (o.ownerDocument && (a = o.ownerDocument.getElementById(r)) && A(o, a) && a.id === r) return t.push(a), t
                } else {
                    if (i[2]) return X.apply(t, J.call(o.getElementsByTagName(e), 0)), t;
                    if ((r = i[3]) && W.getByClassName && o.getElementsByClassName) return X.apply(t, J.call(o.getElementsByClassName(r), 0)), t
                }
                if (W.qsa && !G.test(e)) {
                    if (h = !0, m = U, g = o, d = 9 === s && e, 1 === s && "object" !== o.nodeName.toLowerCase()) {
                        for (u = p(e), (h = o.getAttribute("id")) ? m = h.replace(de, "\\$&") : o.setAttribute("id", m), m = "[id='" + m + "'] ", l = u.length; l--;) u[l] = m + c(u[l]);
                        g = ce.test(e) && o.parentNode || o, d = u.join(",")
                    }
                    if (d) try {
                        return X.apply(t, J.call(g.querySelectorAll(d), 0)), t
                    } catch (le) {
                    } finally {
                            h || o.removeAttribute("id")
                        }
                }
            }
            return f(e.replace(ne, "$1"), o, t, n)
        }

        function s(e, o) {
            var t = o && e, n = t && (~o.sourceIndex || q) - (~e.sourceIndex || q);
            if (n) return n;
            if (t) for (; t = t.nextSibling;) if (t === o) return -1;
            return e ? 1 : -1
        }

        function l(e) {
            return i(function (o) {
                return o = +o, i(function (t, n) {
                    for (var i, a = e([], t.length, o), r = a.length; r--;) t[i = a[r]] && (t[i] = !(n[i] = t[i]))
                })
            })
        }

        function p(e, o) {
            var t, n, i, a, s, l, p, c = B[e + " "];
            if (c) return o ? 0 : c.slice(0);
            for (s = e, l = [], p = T.preFilter; s;) {
                (!t || (n = ie.exec(s))) && (n && (s = s.slice(n[0].length) || s), l.push(i = [])), t = !1, (n = ae.exec(s)) && (t = n.shift(), i.push({
                    value: t,
                    type: n[0].replace(ne, " ")
                }), s = s.slice(t.length));
                for (a in T.filter) !(n = pe[a].exec(s)) || p[a] && !(n = p[a](n)) || (t = n.shift(), i.push({
                    value: t,
                    type: a,
                    matches: n
                }), s = s.slice(t.length));
                if (!t) break
            }
            return o ? s.length : s ? r.error(e) : B(e, l).slice(0)
        }

        function c(e) {
            for (var o = 0, t = e.length, n = ""; t > o; o++) n += e[o].value;
            return n
        }

        function u(e, o, t) {
            var n = o.dir, i = t && "parentNode" === n, a = F++;
            return o.first ? function (o, t, a) {
                for (; o = o[n];) if (1 === o.nodeType || i) return e(o, t, a)
            } : function (o, t, r) {
                var s, l, p, c = M + " " + a;
                if (r) {
                    for (; o = o[n];) if ((1 === o.nodeType || i) && e(o, t, r)) return !0
                } else for (; o = o[n];) if (1 === o.nodeType || i) if (p = o[U] || (o[U] = {}), (l = p[n]) && l[0] === c) {
                    if (!0 === (s = l[1]) || s === E) return !0 === s
                } else if (l = p[n] = [c], l[1] = e(o, t, r) || E, !0 === l[1]) return !0
            }
        }

        function h(e) {
            return e.length > 1 ? function (o, t, n) {
                for (var i = e.length; i--;) if (!e[i](o, t, n)) return !1;
                return !0
            } : e[0]
        }

        function m(e, o, t, n, i) {
            for (var a, r = [], s = 0, l = e.length, p = null != o; l > s; s++) (a = e[s]) && (!t || t(a, n, i)) && (r.push(a), p && o.push(s));
            return r
        }

        function g(e, o, t, n, a, r) {
            return n && !n[U] && (n = g(n)), a && !a[U] && (a = g(a, r)), i(function (i, r, s, l) {
                var p, c, u, h = [], g = [], d = r.length, b = i || _(o || "*", s.nodeType ? [s] : s, []),
                    f = !e || !i && o ? b : m(b, h, e, s, l), w = t ? a || (i ? e : d || n) ? [] : r : f;
                if (t && t(f, w, s, l), n) for (p = m(w, g), n(p, [], s, l), c = p.length; c--;) (u = p[c]) && (w[g[c]] = !(f[g[c]] = u));
                if (i) {
                    if (a || e) {
                        if (a) {
                            for (p = [], c = w.length; c--;) (u = w[c]) && p.push(f[c] = u);
                            a(null, w = [], p, l)
                        }
                        for (c = w.length; c--;) (u = w[c]) && (p = a ? Y.call(i, u) : h[c]) > -1 && (i[p] = !(r[p] = u))
                    }
                } else w = m(w === r ? w.splice(d, w.length) : w), a ? a(null, r, w, l) : X.apply(r, w)
            })
        }

        function d(e) {
            for (var o, t, n, i = e.length, a = T.relative[e[0].type], r = a || T.relative[" "], s = a ? 1 : 0, l = u(function (e) {
                return e === o
            }, r, !0), p = u(function (e) {
                return Y.call(o, e) > -1
            }, r, !0), m = [function (e, t, n) {
                return !a && (n || t !== C) || ((o = t).nodeType ? l(e, t, n) : p(e, t, n))
            }]; i > s; s++) if (t = T.relative[e[s].type]) m = [u(h(m), t)]; else {
                if (t = T.filter[e[s].type].apply(null, e[s].matches), t[U]) {
                    for (n = ++s; i > n && !T.relative[e[n].type]; n++);
                    return g(s > 1 && h(m), s > 1 && c(e.slice(0, s - 1)).replace(ne, "$1"), t, n > s && d(e.slice(s, n)), i > n && d(e = e.slice(n)), i > n && c(e))
                }
                m.push(t)
            }
            return h(m)
        }

        function b(e, o) {
            var t = 0, n = o.length > 0, a = e.length > 0, s = function (i, s, l, p, c) {
                var u, h, g, d = [], b = 0, _ = "0", f = i && [], w = null != c, v = C,
                    P = i || a && T.find.TAG("*", c && s.parentNode || s), S = M += null == v ? 1 : Math.random() || .1;
                for (w && (C = s !== y && s, E = t); null != (u = P[_]); _++) {
                    if (a && u) {
                        for (h = 0; g = e[h++];) if (g(u, s, l)) {
                            p.push(u);
                            break
                        }
                        w && (M = S, E = ++t)
                    }
                    n && ((u = !g && u) && b--, i && f.push(u))
                }
                if (b += _, n && _ !== b) {
                    for (h = 0; g = o[h++];) g(f, d, s, l);
                    if (i) {
                        if (b > 0) for (; _--;) f[_] || d[_] || (d[_] = K.call(p));
                        d = m(d)
                    }
                    X.apply(p, d), w && !i && d.length > 0 && b + o.length > 1 && r.uniqueSort(p)
                }
                return w && (M = S, C = v), f
            };
            return n ? i(s) : s
        }

        function _(e, o, t) {
            for (var n = 0, i = o.length; i > n; n++) r(e, o[n], t);
            return t
        }

        function f(e, o, t, n) {
            var i, a, r, s, l, u = p(e);
            if (!n && 1 === u.length) {
                if (a = u[0] = u[0].slice(0), a.length > 2 && "ID" === (r = a[0]).type && 9 === o.nodeType && !D && T.relative[a[1].type]) {
                    if (!(o = T.find.ID(r.matches[0].replace(be, _e), o)[0])) return t;
                    e = e.slice(a.shift().value.length)
                }
                for (i = pe.needsContext.test(e) ? 0 : a.length; i-- && (r = a[i], !T.relative[s = r.type]);) if ((l = T.find[s]) && (n = l(r.matches[0].replace(be, _e), ce.test(a[0].type) && o.parentNode || o))) {
                    if (a.splice(i, 1), !(e = n.length && c(a))) return X.apply(t, J.call(n, 0)), t;
                    break
                }
            }
            return N(e, u)(n, o, D, t, ce.test(e)), t
        }

        function w() {
        }

        var v, E, T, P, S, N, I, C, R, y, L, D, G, O, x, A, k, U = "sizzle" + -new Date, V = e.document, W = {}, M = 0,
            F = 0, H = n(), B = n(), j = n(), $ = typeof o, q = 1 << 31, z = [], K = z.pop, X = z.push, J = z.slice,
            Y = z.indexOf || function (e) {
                for (var o = 0, t = this.length; t > o; o++) if (this[o] === e) return o;
                return -1
            }, Q = "[\\x20\\t\\r\\n\\f]", Z = "(?:\\\\.|[\\w-]|[^\\x00-\\xa0])+", ee = Z.replace("w", "w#"),
            oe = "\\[" + Q + "*(" + Z + ")" + Q + "*(?:([*^$|!~]?=)" + Q + "*(?:(['\"])((?:\\\\.|[^\\\\])*?)\\3|(" + ee + ")|)|)" + Q + "*\\]",
            te = ":(" + Z + ")(?:\\(((['\"])((?:\\\\.|[^\\\\])*?)\\3|((?:\\\\.|[^\\\\()[\\]]|" + oe.replace(3, 8) + ")*)|.*)\\)|)",
            ne = RegExp("^" + Q + "+|((?:^|[^\\\\])(?:\\\\.)*)" + Q + "+$", "g"), ie = RegExp("^" + Q + "*," + Q + "*"),
            ae = RegExp("^" + Q + "*([\\x20\\t\\r\\n\\f>+~])" + Q + "*"), re = RegExp(te), se = RegExp("^" + ee + "$"),
            pe = {
                ID: RegExp("^#(" + Z + ")"),
                CLASS: RegExp("^\\.(" + Z + ")"),
                NAME: RegExp("^\\[name=['\"]?(" + Z + ")['\"]?\\]"),
                TAG: RegExp("^(" + Z.replace("w", "w*") + ")"),
                ATTR: RegExp("^" + oe),
                PSEUDO: RegExp("^" + te),
                CHILD: RegExp("^:(only|first|last|nth|nth-last)-(child|of-type)(?:\\(" + Q + "*(even|odd|(([+-]|)(\\d*)n|)" + Q + "*(?:([+-]|)" + Q + "*(\\d+)|))" + Q + "*\\)|)", "i"),
                needsContext: RegExp("^" + Q + "*[>+~]|:(even|odd|eq|gt|lt|nth|first|last)(?:\\(" + Q + "*((?:-\\d)?\\d*)" + Q + "*\\)|)(?=[^-]|$)", "i")
            }, ce = /[\x20\t\r\n\f]*[+~]/, ue = /^[^{]+\{\s*\[native code/, he = /^(?:#([\w-]+)|(\w+)|\.([\w-]+))$/,
            me = /^(?:input|select|textarea|button)$/i, ge = /^h\d$/i, de = /'|\\/g,
            be = /\\([\da-fA-F]{1,6}[\x20\t\r\n\f]?|.)/g, _e = function (e, o) {
                var t = "0x" + o - 65536;
                return t !== t ? o : 0 > t ? String.fromCharCode(t + 65536) : String.fromCharCode(55296 | t >> 10, 56320 | 1023 & t)
            };
        try {
            J.call(V.documentElement.childNodes, 0)[0].nodeType
        } catch (Ge) {
            J = function (e) {
                for (var o, t = []; o = this[e++];) t.push(o);
                return t
            }
        }
        S = r.isXML = function (e) {
            var o = e && (e.ownerDocument || e).documentElement;
            return !!o && "HTML" !== o.nodeName
        }, R = r.setDocument = function (e) {
            var n = e ? e.ownerDocument || e : V;
            return n !== y && 9 === n.nodeType && n.documentElement ? (y = n, L = n.documentElement, D = S(n), W.tagNameNoComments = a(function (e) {
                return e.appendChild(n.createComment("")), !e.getElementsByTagName("*").length
            }), W.attributes = a(function (e) {
                e.innerHTML = "<select></select>";
                var o = typeof e.lastChild.getAttribute("multiple");
                return "boolean" !== o && "string" !== o
            }), W.getByClassName = a(function (e) {
                return e.innerHTML = "<div class='hidden e'></div><div class='hidden'></div>", !(!e.getElementsByClassName || !e.getElementsByClassName("e").length) && (e.lastChild.className = "e", 2 === e.getElementsByClassName("e").length)
            }), W.getByName = a(function (e) {
                e.id = U + 0, e.innerHTML = "<a name='" + U + "'></a><div name='" + U + "'></div>", L.insertBefore(e, L.firstChild);
                var o = n.getElementsByName && n.getElementsByName(U).length === 2 + n.getElementsByName(U + 0).length;
                return W.getIdNotName = !n.getElementById(U), L.removeChild(e), o
            }), T.attrHandle = a(function (e) {
                return e.innerHTML = "<a href='#'></a>", e.firstChild && typeof e.firstChild.getAttribute !== $ && "#" === e.firstChild.getAttribute("href")
            }) ? {} : {
                    href: function (e) {
                        return e.getAttribute("href", 2)
                    }, type: function (e) {
                        return e.getAttribute("type")
                    }
                }, W.getIdNotName ? (T.find.ID = function (e, o) {
                    if (typeof o.getElementById !== $ && !D) {
                        var t = o.getElementById(e);
                        return t && t.parentNode ? [t] : []
                    }
                }, T.filter.ID = function (e) {
                    var o = e.replace(be, _e);
                    return function (e) {
                        return e.getAttribute("id") === o
                    }
                }) : (T.find.ID = function (e, t) {
                    if (typeof t.getElementById !== $ && !D) {
                        var n = t.getElementById(e);
                        return n ? n.id === e || typeof n.getAttributeNode !== $ && n.getAttributeNode("id").value === e ? [n] : o : []
                    }
                }, T.filter.ID = function (e) {
                    var o = e.replace(be, _e);
                    return function (e) {
                        var t = typeof e.getAttributeNode !== $ && e.getAttributeNode("id");
                        return t && t.value === o
                    }
                }), T.find.TAG = W.tagNameNoComments ? function (e, t) {
                    return typeof t.getElementsByTagName !== $ ? t.getElementsByTagName(e) : o
                } : function (e, o) {
                    var t, n = [], i = 0, a = o.getElementsByTagName(e);
                    if ("*" === e) {
                        for (; t = a[i++];) 1 === t.nodeType && n.push(t);
                        return n
                    }
                    return a
                }, T.find.NAME = W.getByName && function (e, t) {
                    return typeof t.getElementsByName !== $ ? t.getElementsByName(name) : o
                }, T.find.CLASS = W.getByClassName && function (e, t) {
                    return typeof t.getElementsByClassName === $ || D ? o : t.getElementsByClassName(e)
                }, O = [], G = [":focus"], (W.qsa = t(n.querySelectorAll)) && (a(function (e) {
                    e.innerHTML = "<select><option selected=''></option></select>", e.querySelectorAll("[selected]").length || G.push("\\[" + Q + "*(?:checked|disabled|ismap|multiple|readonly|selected|value)"), e.querySelectorAll(":checked").length || G.push(":checked")
                }), a(function (e) {
                    e.innerHTML = "<input type='hidden' i=''/>", e.querySelectorAll("[i^='']").length && G.push("[*^$]=" + Q + "*(?:\"\"|'')"), e.querySelectorAll(":enabled").length || G.push(":enabled", ":disabled"), e.querySelectorAll("*,:x"), G.push(",.*:")
                })), (W.matchesSelector = t(x = L.matchesSelector || L.mozMatchesSelector || L.webkitMatchesSelector || L.oMatchesSelector || L.msMatchesSelector)) && a(function (e) {
                    W.disconnectedMatch = x.call(e, "div"), x.call(e, "[s!='']:x"), O.push("!=", te)
                }), G = RegExp(G.join("|")), O = RegExp(O.join("|")), A = t(L.contains) || L.compareDocumentPosition ? function (e, o) {
                    var t = 9 === e.nodeType ? e.documentElement : e, n = o && o.parentNode;
                    return e === n || !(!n || 1 !== n.nodeType || !(t.contains ? t.contains(n) : e.compareDocumentPosition && 16 & e.compareDocumentPosition(n)))
                } : function (e, o) {
                    if (o) for (; o = o.parentNode;) if (o === e) return !0;
                    return !1
                }, k = L.compareDocumentPosition ? function (e, o) {
                    var t;
                    return e === o ? (I = !0, 0) : (t = o.compareDocumentPosition && e.compareDocumentPosition && e.compareDocumentPosition(o)) ? 1 & t || e.parentNode && 11 === e.parentNode.nodeType ? e === n || A(V, e) ? -1 : o === n || A(V, o) ? 1 : 0 : 4 & t ? -1 : 1 : e.compareDocumentPosition ? -1 : 1
                } : function (e, o) {
                    var t, i = 0, a = e.parentNode, r = o.parentNode, l = [e], p = [o];
                    if (e === o) return I = !0, 0;
                    if (!a || !r) return e === n ? -1 : o === n ? 1 : a ? -1 : r ? 1 : 0;
                    if (a === r) return s(e, o);
                    for (t = e; t = t.parentNode;) l.unshift(t);
                    for (t = o; t = t.parentNode;) p.unshift(t);
                    for (; l[i] === p[i];) i++;
                    return i ? s(l[i], p[i]) : l[i] === V ? -1 : p[i] === V ? 1 : 0
                }, I = !1, [0, 0].sort(k), W.detectDuplicates = I, y) : y
        }, r.matches = function (e, o) {
            return r(e, null, null, o)
        }, r.matchesSelector = function (e, o) {
            if ((e.ownerDocument || e) !== y && R(e), o = o.replace(/\=[\x20\t\r\n\f]*([^'"\]]*)[\x20\t\r\n\f]*\]/g, "='$1']"), !(!W.matchesSelector || D || O && O.test(o) || G.test(o))) try {
                var t = x.call(e, o);
                if (t || W.disconnectedMatch || e.document && 11 !== e.document.nodeType) return t
            } catch (E) {
            }
            return r(o, y, null, [e]).length > 0
        }, r.contains = function (e, o) {
            return (e.ownerDocument || e) !== y && R(e), A(e, o)
        }, r.attr = function (e, o) {
            var t;
            return (e.ownerDocument || e) !== y && R(e), D || (o = o.toLowerCase()), (t = T.attrHandle[o]) ? t(e) : D || W.attributes ? e.getAttribute(o) : ((t = e.getAttributeNode(o)) || e.getAttribute(o)) && !0 === e[o] ? o : t && t.specified ? t.value : null
        }, r.error = function (e) {
            throw Error("Syntax error, unrecognized expression: " + e)
        }, r.uniqueSort = function (e) {
            var o, t = [], n = 1, i = 0;
            if (I = !W.detectDuplicates, e.sort(k), I) {
                for (; o = e[n]; n++) o === e[n - 1] && (i = t.push(n));
                for (; i--;) e.splice(t[i], 1)
            }
            return e
        }, P = r.getText = function (e) {
            var o, t = "", n = 0, i = e.nodeType;
            if (i) {
                if (1 === i || 9 === i || 11 === i) {
                    if ("string" == typeof e.textContent) return e.textContent;
                    for (e = e.firstChild; e; e = e.nextSibling) t += P(e)
                } else if (3 === i || 4 === i) return e.nodeValue
            } else for (; o = e[n]; n++) t += P(o);
            return t
        }, T = r.selectors = {
            cacheLength: 50,
            createPseudo: i,
            match: pe,
            find: {},
            relative: {
                ">": { dir: "parentNode", first: !0 },
                " ": { dir: "parentNode" },
                "+": { dir: "previousSibling", first: !0 },
                "~": { dir: "previousSibling" }
            },
            preFilter: {
                ATTR: function (e) {
                    return e[1] = e[1].replace(be, _e), e[3] = (e[4] || e[5] || "").replace(be, _e), "~=" === e[2] && (e[3] = " " + e[3] + " "), e.slice(0, 4)
                }, CHILD: function (e) {
                    return e[1] = e[1].toLowerCase(), "nth" === e[1].slice(0, 3) ? (e[3] || r.error(e[0]), e[4] = +(e[4] ? e[5] + (e[6] || 1) : 2 * ("even" === e[3] || "odd" === e[3])), e[5] = +(e[7] + e[8] || "odd" === e[3])) : e[3] && r.error(e[0]), e
                }, PSEUDO: function (e) {
                    var o, t = !e[5] && e[2];
                    return pe.CHILD.test(e[0]) ? null : (e[4] ? e[2] = e[4] : t && re.test(t) && (o = p(t, !0)) && (o = t.indexOf(")", t.length - o) - t.length) && (e[0] = e[0].slice(0, o), e[2] = t.slice(0, o)), e.slice(0, 3))
                }
            },
            filter: {
                TAG: function (e) {
                    return "*" === e ? function () {
                        return !0
                    } : (e = e.replace(be, _e).toLowerCase(), function (o) {
                        return o.nodeName && o.nodeName.toLowerCase() === e
                    })
                }, CLASS: function (e) {
                    var o = H[e + " "];
                    return o || (o = RegExp("(^|" + Q + ")" + e + "(" + Q + "|$)")) && H(e, function (e) {
                        return o.test(e.className || typeof e.getAttribute !== $ && e.getAttribute("class") || "")
                    })
                }, ATTR: function (e, o, t) {
                    return function (n) {
                        var i = r.attr(n, e);
                        return null == i ? "!=" === o : !o || (i += "", "=" === o ? i === t : "!=" === o ? i !== t : "^=" === o ? t && 0 === i.indexOf(t) : "*=" === o ? t && i.indexOf(t) > -1 : "$=" === o ? t && i.slice(-t.length) === t : "~=" === o ? (" " + i + " ").indexOf(t) > -1 : "|=" === o && (i === t || i.slice(0, t.length + 1) === t + "-"))
                    }
                }, CHILD: function (e, o, t, n, i) {
                    var a = "nth" !== e.slice(0, 3), r = "last" !== e.slice(-4), s = "of-type" === o;
                    return 1 === n && 0 === i ? function (e) {
                        return !!e.parentNode
                    } : function (o, t, l) {
                        var p, c, u, h, m, g, d = a !== r ? "nextSibling" : "previousSibling", b = o.parentNode,
                            _ = s && o.nodeName.toLowerCase(), f = !l && !s;
                        if (b) {
                            if (a) {
                                for (; d;) {
                                    for (u = o; u = u[d];) if (s ? u.nodeName.toLowerCase() === _ : 1 === u.nodeType) return !1;
                                    g = d = "only" === e && !g && "nextSibling"
                                }
                                return !0
                            }
                            if (g = [r ? b.firstChild : b.lastChild], r && f) {
                                for (c = b[U] || (b[U] = {}), p = c[e] || [], m = p[0] === M && p[1], h = p[0] === M && p[2], u = m && b.childNodes[m]; u = ++m && u && u[d] || (h = m = 0) || g.pop();) if (1 === u.nodeType && ++h && u === o) {
                                    c[e] = [M, m, h];
                                    break
                                }
                            } else if (f && (p = (o[U] || (o[U] = {}))[e]) && p[0] === M) h = p[1]; else for (; (u = ++m && u && u[d] || (h = m = 0) || g.pop()) && ((s ? u.nodeName.toLowerCase() !== _ : 1 !== u.nodeType) || !++h || (f && ((u[U] || (u[U] = {}))[e] = [M, h]), u !== o)););
                            return (h -= i) === n || 0 == h % n && h / n >= 0
                        }
                    }
                }, PSEUDO: function (e, o) {
                    var t, n = T.pseudos[e] || T.setFilters[e.toLowerCase()] || r.error("unsupported pseudo: " + e);
                    return n[U] ? n(o) : n.length > 1 ? (t = [e, e, "", o], T.setFilters.hasOwnProperty(e.toLowerCase()) ? i(function (e, t) {
                        for (var i, a = n(e, o), r = a.length; r--;) i = Y.call(e, a[r]), e[i] = !(t[i] = a[r])
                    }) : function (e) {
                        return n(e, 0, t)
                    }) : n
                }
            },
            pseudos: {
                not: i(function (e) {
                    var o = [], t = [], n = N(e.replace(ne, "$1"));
                    return n[U] ? i(function (e, o, t, i) {
                        for (var a, r = n(e, null, i, []), s = e.length; s--;) (a = r[s]) && (e[s] = !(o[s] = a))
                    }) : function (e, i, a) {
                        return o[0] = e, n(o, null, a, t), !t.pop()
                    }
                }), has: i(function (e) {
                    return function (o) {
                        return r(e, o).length > 0
                    }
                }), contains: i(function (e) {
                    return function (o) {
                        return (o.textContent || o.innerText || P(o)).indexOf(e) > -1
                    }
                }), lang: i(function (e) {
                    return se.test(e || "") || r.error("unsupported lang: " + e), e = e.replace(be, _e).toLowerCase(), function (o) {
                        var t;
                        do {
                            if (t = D ? o.getAttribute("xml:lang") || o.getAttribute("lang") : o.lang) return (t = t.toLowerCase()) === e || 0 === t.indexOf(e + "-")
                        } while ((o = o.parentNode) && 1 === o.nodeType);
                        return !1
                    }
                }), target: function (o) {
                    var t = e.location && e.location.hash;
                    return t && t.slice(1) === o.id
                }, root: function (e) {
                    return e === L
                }, focus: function (e) {
                    return e === y.activeElement && (!y.hasFocus || y.hasFocus()) && !!(e.type || e.href || ~e.tabIndex)
                }, enabled: function (e) {
                    return !1 === e.disabled
                }, disabled: function (e) {
                    return !0 === e.disabled
                }, checked: function (e) {
                    var o = e.nodeName.toLowerCase();
                    return "input" === o && !!e.checked || "option" === o && !!e.selected
                }, selected: function (e) {
                    return e.parentNode && e.parentNode.selectedIndex, !0 === e.selected
                }, empty: function (e) {
                    for (e = e.firstChild; e; e = e.nextSibling) if (e.nodeName > "@" || 3 === e.nodeType || 4 === e.nodeType) return !1;
                    return !0
                }, parent: function (e) {
                    return !T.pseudos.empty(e)
                }, header: function (e) {
                    return ge.test(e.nodeName)
                }, input: function (e) {
                    return me.test(e.nodeName)
                }, button: function (e) {
                    var o = e.nodeName.toLowerCase();
                    return "input" === o && "button" === e.type || "button" === o
                }, text: function (e) {
                    var o;
                    return "input" === e.nodeName.toLowerCase() && "text" === e.type && (null == (o = e.getAttribute("type")) || o.toLowerCase() === e.type)
                }, first: l(function () {
                    return [0]
                }), last: l(function (e, o) {
                    return [o - 1]
                }), eq: l(function (e, o, t) {
                    return [0 > t ? t + o : t]
                }), even: l(function (e, o) {
                    for (var t = 0; o > t; t += 2) e.push(t);
                    return e
                }), odd: l(function (e, o) {
                    for (var t = 1; o > t; t += 2) e.push(t);
                    return e
                }), lt: l(function (e, o, t) {
                    for (var n = 0 > t ? t + o : t; --n >= 0;) e.push(n);
                    return e
                }), gt: l(function (e, o, t) {
                    for (var n = 0 > t ? t + o : t; o > ++n;) e.push(n);
                    return e
                })
            }
        };
        for (v in { radio: !0, checkbox: !0, file: !0, password: !0, image: !0 }) T.pseudos[v] = function (e) {
            return function (o) {
                return "input" === o.nodeName.toLowerCase() && o.type === e
            }
        }(v);
        for (v in { submit: !0, reset: !0 }) T.pseudos[v] = function (e) {
            return function (o) {
                var t = o.nodeName.toLowerCase();
                return ("input" === t || "button" === t) && o.type === e
            }
        }(v);
        N = r.compile = function (e, o) {
            var t, n = [], i = [], a = j[e + " "];
            if (!a) {
                for (o || (o = p(e)), t = o.length; t--;) a = d(o[t]), a[U] ? n.push(a) : i.push(a);
                a = j(e, b(i, n))
            }
            return a
        }, T.pseudos.nth = T.pseudos.eq, T.filters = w.prototype = T.pseudos, T.setFilters = new w, R(), r.attr = le.attr, le.find = r, le.expr = r.selectors, le.expr[":"] = le.expr.pseudos, le.unique = r.uniqueSort, le.text = r.getText, le.isXMLDoc = r.isXML, le.contains = r.contains
    }(e);
    var xe = /Until$/, Ae = /^(?:parents|prev(?:Until|All))/, ke = /^.[^:#\[\.,]*$/, Ue = le.expr.match.needsContext,
        Ve = { children: !0, contents: !0, next: !0, prev: !0 };
    le.fn.extend({
        find: function (e) {
            var o, t, n, i = this.length;
            if ("string" != typeof e) return n = this, this.pushStack(le(e).filter(function () {
                for (o = 0; i > o; o++) if (le.contains(n[o], this)) return !0
            }));
            for (t = [], o = 0; i > o; o++) le.find(e, this[o], t);
            return t = this.pushStack(i > 1 ? le.unique(t) : t), t.selector = (this.selector ? this.selector + " " : "") + e, t
        }, has: function (e) {
            var o, t = le(e, this), n = t.length;
            return this.filter(function () {
                for (o = 0; n > o; o++) if (le.contains(this, t[o])) return !0
            })
        }, not: function (e) {
            return this.pushStack(u(this, e, !1))
        }, filter: function (e) {
            return this.pushStack(u(this, e, !0))
        }, is: function (e) {
            return !!e && ("string" == typeof e ? Ue.test(e) ? le(e, this.context).index(this[0]) >= 0 : le.filter(e, this).length > 0 : this.filter(e).length > 0)
        }, closest: function (e, o) {
            for (var t, n = 0, i = this.length, a = [], r = Ue.test(e) || "string" != typeof e ? le(e, o || this.context) : 0; i > n; n++) for (t = this[n]; t && t.ownerDocument && t !== o && 11 !== t.nodeType;) {
                if (r ? r.index(t) > -1 : le.find.matchesSelector(t, e)) {
                    a.push(t);
                    break
                }
                t = t.parentNode
            }
            return this.pushStack(a.length > 1 ? le.unique(a) : a)
        }, index: function (e) {
            return e ? "string" == typeof e ? le.inArray(this[0], le(e)) : le.inArray(e.jquery ? e[0] : e, this) : this[0] && this[0].parentNode ? this.first().prevAll().length : -1
        }, add: function (e, o) {
            var t = "string" == typeof e ? le(e, o) : le.makeArray(e && e.nodeType ? [e] : e),
                n = le.merge(this.get(), t);
            return this.pushStack(le.unique(n))
        }, addBack: function (e) {
            return this.add(null == e ? this.prevObject : this.prevObject.filter(e))
        }
    }), le.fn.andSelf = le.fn.addBack, le.each({
        parent: function (e) {
            var o = e.parentNode;
            return o && 11 !== o.nodeType ? o : null
        }, parents: function (e) {
            return le.dir(e, "parentNode")
        }, parentsUntil: function (e, o, t) {
            return le.dir(e, "parentNode", t)
        }, next: function (e) {
            return c(e, "nextSibling")
        }, prev: function (e) {
            return c(e, "previousSibling")
        }, nextAll: function (e) {
            return le.dir(e, "nextSibling")
        }, prevAll: function (e) {
            return le.dir(e, "previousSibling")
        }, nextUntil: function (e, o, t) {
            return le.dir(e, "nextSibling", t)
        }, prevUntil: function (e, o, t) {
            return le.dir(e, "previousSibling", t)
        }, siblings: function (e) {
            return le.sibling((e.parentNode || {}).firstChild, e)
        }, children: function (e) {
            return le.sibling(e.firstChild)
        }, contents: function (e) {
            return le.nodeName(e, "iframe") ? e.contentDocument || e.contentWindow.document : le.merge([], e.childNodes)
        }
    }, function (e, o) {
        le.fn[e] = function (t, n) {
            var i = le.map(this, o, t);
            return xe.test(e) || (n = t), n && "string" == typeof n && (i = le.filter(n, i)), i = this.length > 1 && !Ve[e] ? le.unique(i) : i, this.length > 1 && Ae.test(e) && (i = i.reverse()), this.pushStack(i)
        }
    }), le.extend({
        filter: function (e, o, t) {
            return t && (e = ":not(" + e + ")"), 1 === o.length ? le.find.matchesSelector(o[0], e) ? [o[0]] : [] : le.find.matches(e, o)
        }, dir: function (e, t, n) {
            for (var i = [], a = e[t]; a && 9 !== a.nodeType && (n === o || 1 !== a.nodeType || !le(a).is(n));) 1 === a.nodeType && i.push(a), a = a[t];
            return i
        }, sibling: function (e, o) {
            for (var t = []; e; e = e.nextSibling) 1 === e.nodeType && e !== o && t.push(e);
            return t
        }
    });
    var We = "abbr|article|aside|audio|bdi|canvas|data|datalist|details|figcaption|figure|footer|header|hgroup|mark|meter|nav|output|progress|section|summary|time|video",
        Me = RegExp("<(?:" + We + ")[\\s/>]", "i"), Fe = /^\s+/,
        He = /<(?!area|br|col|embed|hr|img|input|link|meta|param)(([\w:]+)[^>]*)\/>/gi, Be = /<([\w:]+)/,
        je = /<tbody/i, $e = /<|&#?\w+;/, qe = /<(?:script|style|link)/i, ze = /^(?:checkbox|radio)$/i,
        Ke = /checked\s*(?:[^=]|=\s*.checked.)/i, Xe = /^$|\/(?:java|ecma)script/i, Je = /^true\/(.*)/, Ye = {
            option: [1, "<select multiple='multiple'>", "</select>"],
            legend: [1, "<fieldset>", "</fieldset>"],
            area: [1, "<map>", "</map>"],
            param: [1, "<object>", "</object>"],
            thead: [1, "<table>", "</table>"],
            tr: [2, "<table><tbody>", "</tbody></table>"],
            col: [2, "<table><tbody></tbody><colgroup>", "</colgroup></table>"],
            td: [3, "<table><tbody><tr>", "</tr></tbody></table>"],
            _default: le.support.htmlSerialize ? [0, "", ""] : [1, "X<div>", "</div>"]
        }, Qe = h(K), Ze = Qe.appendChild(K.createElement("div"));
    Ye.optgroup = Ye.option, Ye.tbody = Ye.tfoot = Ye.colgroup = Ye.caption = Ye.thead, Ye.th = Ye.td, le.fn.extend({
        text: function (e) {
            return le.access(this, function (e) {
                return e === o ? le.text(this) : this.empty().append((this[0] && this[0].ownerDocument || K).createTextNode(e))
            }, null, e, arguments.length)
        }, wrapAll: function (e) {
            if (le.isFunction(e)) return this.each(function (o) {
                le(this).wrapAll(e.call(this, o))
            });
            if (this[0]) {
                var o = le(e, this[0].ownerDocument).eq(0).clone(!0);
                this[0].parentNode && o.insertBefore(this[0]), o.map(function () {
                    for (var e = this; e.firstChild && 1 === e.firstChild.nodeType;) e = e.firstChild;
                    return e
                }).append(this)
            }
            return this
        }, wrapInner: function (e) {
            return le.isFunction(e) ? this.each(function (o) {
                le(this).wrapInner(e.call(this, o))
            }) : this.each(function () {
                var o = le(this), t = o.contents();
                t.length ? t.wrapAll(e) : o.append(e)
            })
        }, wrap: function (e) {
            var o = le.isFunction(e);
            return this.each(function (t) {
                le(this).wrapAll(o ? e.call(this, t) : e)
            })
        }, unwrap: function () {
            return this.parent().each(function () {
                le.nodeName(this, "body") || le(this).replaceWith(this.childNodes)
            }).end()
        }, append: function () {
            return this.domManip(arguments, !0, function (e) {
                (1 === this.nodeType || 11 === this.nodeType || 9 === this.nodeType) && this.appendChild(e)
            })
        }, prepend: function () {
            return this.domManip(arguments, !0, function (e) {
                (1 === this.nodeType || 11 === this.nodeType || 9 === this.nodeType) && this.insertBefore(e, this.firstChild)
            })
        }, before: function () {
            return this.domManip(arguments, !1, function (e) {
                this.parentNode && this.parentNode.insertBefore(e, this)
            })
        }, after: function () {
            return this.domManip(arguments, !1, function (e) {
                this.parentNode && this.parentNode.insertBefore(e, this.nextSibling)
            })
        }, remove: function (e, o) {
            for (var t, n = 0; null != (t = this[n]); n++) (!e || le.filter(e, [t]).length > 0) && (o || 1 !== t.nodeType || le.cleanData(w(t)), t.parentNode && (o && le.contains(t.ownerDocument, t) && b(w(t, "script")), t.parentNode.removeChild(t)));
            return this
        }, empty: function () {
            for (var e, o = 0; null != (e = this[o]); o++) {
                for (1 === e.nodeType && le.cleanData(w(e, !1)); e.firstChild;) e.removeChild(e.firstChild);
                e.options && le.nodeName(e, "select") && (e.options.length = 0)
            }
            return this
        }, clone: function (e, o) {
            return e = null != e && e, o = null == o ? e : o, this.map(function () {
                return le.clone(this, e, o)
            })
        }, html: function (e) {
            return le.access(this, function (e) {
                var t = this[0] || {}, n = 0, i = this.length;
                if (e === o) return 1 === t.nodeType ? t.innerHTML.replace(/ jQuery\d+="(?:null|\d+)"/g, "") : o;
                if (!("string" != typeof e || qe.test(e) || !le.support.htmlSerialize && Me.test(e) || !le.support.leadingWhitespace && Fe.test(e) || Ye[(Be.exec(e) || ["", ""])[1].toLowerCase()])) {
                    e = e.replace(He, "<$1></$2>");
                    try {
                        for (; i > n; n++) t = this[n] || {}, 1 === t.nodeType && (le.cleanData(w(t, !1)), t.innerHTML = e);
                        t = 0
                    } catch (K) {
                    }
                }
                t && this.empty().append(e)
            }, null, e, arguments.length)
        }, replaceWith: function (e) {
            return le.isFunction(e) || "string" == typeof e || (e = le(e).not(this).detach()), this.domManip([e], !0, function (e) {
                var o = this.nextSibling, t = this.parentNode;
                t && (le(this).remove(), t.insertBefore(e, o))
            })
        }, detach: function (e) {
            return this.remove(e, !0)
        }, domManip: function (e, t, n) {
            e = oe.apply([], e);
            var i, a, r, s, l, p, c = 0, u = this.length, h = this, b = u - 1, _ = e[0], f = le.isFunction(_);
            if (f || !(1 >= u || "string" != typeof _ || le.support.checkClone) && Ke.test(_)) return this.each(function (i) {
                var a = h.eq(i);
                f && (e[0] = _.call(this, i, t ? a.html() : o)), a.domManip(e, t, n)
            });
            if (u && (p = le.buildFragment(e, this[0].ownerDocument, !1, this), i = p.firstChild, 1 === p.childNodes.length && (p = i), i)) {
                for (t = t && le.nodeName(i, "tr"), s = le.map(w(p, "script"), g), r = s.length; u > c; c++) a = p, c !== b && (a = le.clone(a, !0, !0), r && le.merge(s, w(a, "script"))), n.call(t && le.nodeName(this[c], "table") ? m(this[c], "tbody") : this[c], a, c);
                if (r) for (l = s[s.length - 1].ownerDocument, le.map(s, d), c = 0; r > c; c++) a = s[c], Xe.test(a.type || "") && !le._data(a, "globalEval") && le.contains(l, a) && (a.src ? le.ajax({
                    url: a.src,
                    type: "GET",
                    dataType: "script",
                    async: !1,
                    global: !1,
                    "throws": !0
                }) : le.globalEval((a.text || a.textContent || a.innerHTML || "").replace(/^\s*<!(?:\[CDATA\[|--)|(?:\]\]|--)>\s*$/g, "")));
                p = i = null
            }
            return this
        }
    }), le.each({
        appendTo: "append",
        prependTo: "prepend",
        insertBefore: "before",
        insertAfter: "after",
        replaceAll: "replaceWith"
    }, function (e, o) {
        le.fn[e] = function (e) {
            for (var t, n = 0, i = [], a = le(e), r = a.length - 1; r >= n; n++) t = n === r ? this : this.clone(!0), le(a[n])[o](t), te.apply(i, t.get());
            return this.pushStack(i)
        }
    }), le.extend({
        clone: function (e, o, t) {
            var n, i, a, r, s, l = le.contains(e.ownerDocument, e);
            if (le.support.html5Clone || le.isXMLDoc(e) || !Me.test("<" + e.nodeName + ">") ? a = e.cloneNode(!0) : (Ze.innerHTML = e.outerHTML, Ze.removeChild(a = Ze.firstChild)), !(le.support.noCloneEvent && le.support.noCloneChecked || 1 !== e.nodeType && 11 !== e.nodeType || le.isXMLDoc(e))) for (n = w(a), s = w(e), r = 0; null != (i = s[r]); ++r) n[r] && f(i, n[r]);
            if (o) if (t) for (s = s || w(e), n = n || w(a), r = 0; null != (i = s[r]); r++) _(i, n[r]); else _(e, a);
            return n = w(a, "script"), n.length > 0 && b(n, !l && w(e, "script")), n = s = i = null, a
        }, buildFragment: function (e, o, t, n) {
            for (var i, a, r, s, l, p, c, u = e.length, m = h(o), g = [], d = 0; u > d; d++) if ((a = e[d]) || 0 === a) if ("object" === le.type(a)) le.merge(g, a.nodeType ? [a] : a); else if ($e.test(a)) {
                for (s = s || m.appendChild(o.createElement("div")), l = (Be.exec(a) || ["", ""])[1].toLowerCase(), c = Ye[l] || Ye._default, s.innerHTML = c[1] + a.replace(He, "<$1></$2>") + c[2], i = c[0]; i--;) s = s.lastChild;
                if (!le.support.leadingWhitespace && Fe.test(a) && g.push(o.createTextNode(Fe.exec(a)[0])), !le.support.tbody) for (a = "table" !== l || je.test(a) ? "<table>" !== c[1] || je.test(a) ? 0 : s : s.firstChild, i = a && a.childNodes.length; i--;) le.nodeName(p = a.childNodes[i], "tbody") && !p.childNodes.length && a.removeChild(p);
                for (le.merge(g, s.childNodes), s.textContent = ""; s.firstChild;) s.removeChild(s.firstChild);
                s = m.lastChild
            } else g.push(o.createTextNode(a));
            for (s && m.removeChild(s), le.support.appendChecked || le.grep(w(g, "input"), v), d = 0; a = g[d++];) if ((!n || -1 === le.inArray(a, n)) && (r = le.contains(a.ownerDocument, a), s = w(m.appendChild(a), "script"), r && b(s), t)) for (i = 0; a = s[i++];) Xe.test(a.type || "") && t.push(a);
            return s = null, m
        }, cleanData: function (e, o) {
            for (var t, n, i, a, r = 0, s = le.expando, l = le.cache, p = le.support.deleteExpando, c = le.event.special; null != (t = e[r]); r++) if ((o || le.acceptData(t)) && (i = t[s], a = i && l[i])) {
                if (a.events) for (n in a.events) c[n] ? le.event.remove(t, n) : le.removeEvent(t, n, a.handle);
                l[i] && (delete l[i], p ? delete t[s] : typeof t.removeAttribute !== z ? t.removeAttribute(s) : t[s] = null, Z.push(i))
            }
        }
    });
    var eo, oo, to, no = /alpha\([^)]*\)/i, io = /opacity\s*=\s*([^)]*)/, ao = /^(top|right|bottom|left)$/,
        ro = /^(none|table(?!-c[ea]).+)/, so = /^margin/, lo = RegExp("^(" + pe + ")(.*)$", "i"),
        po = RegExp("^(" + pe + ")(?!px)[a-z%]+$", "i"), co = RegExp("^([+-])=(" + pe + ")", "i"), uo = { BODY: "block" },
        ho = { position: "absolute", visibility: "hidden", display: "block" }, mo = { letterSpacing: 0, fontWeight: 400 },
        go = ["Top", "Right", "Bottom", "Left"], bo = ["Webkit", "O", "Moz", "ms"];
    le.fn.extend({
        css: function (e, t) {
            return le.access(this, function (e, t, n) {
                var i, a, r = {}, s = 0;
                if (le.isArray(t)) {
                    for (a = oo(e), i = t.length; i > s; s++) r[t[s]] = le.css(e, t[s], !1, a);
                    return r
                }
                return n !== o ? le.style(e, t, n) : le.css(e, t)
            }, e, t, arguments.length > 1)
        }, show: function () {
            return P(this, !0)
        }, hide: function () {
            return P(this)
        }, toggle: function (e) {
            var o = "boolean" == typeof e;
            return this.each(function () {
                (o ? e : T(this)) ? le(this).show() : le(this).hide()
            })
        }
    }), le.extend({
        cssHooks: {
            opacity: {
                get: function (e, o) {
                    if (o) {
                        var t = to(e, "opacity");
                        return "" === t ? "1" : t
                    }
                }
            }
        },
        cssNumber: {
            columnCount: !0,
            fillOpacity: !0,
            fontWeight: !0,
            lineHeight: !0,
            opacity: !0,
            orphans: !0,
            widows: !0,
            zIndex: !0,
            zoom: !0
        },
        cssProps: { "float": le.support.cssFloat ? "cssFloat" : "styleFloat" },
        style: function (e, t, n, i) {
            if (e && 3 !== e.nodeType && 8 !== e.nodeType && e.style) {
                var a, r, s, l = le.camelCase(t), p = e.style;
                if (t = le.cssProps[l] || (le.cssProps[l] = E(p, l)), s = le.cssHooks[t] || le.cssHooks[l], n === o) return s && "get" in s && (a = s.get(e, !1, i)) !== o ? a : p[t];
                if (r = typeof n, "string" === r && (a = co.exec(n)) && (n = (a[1] + 1) * a[2] + parseFloat(le.css(e, t)), r = "number"), !(null == n || "number" === r && isNaN(n) || ("number" !== r || le.cssNumber[l] || (n += "px"), le.support.clearCloneStyle || "" !== n || 0 !== t.indexOf("background") || (p[t] = "inherit"), s && "set" in s && (n = s.set(e, n, i)) === o))) try {
                    p[t] = n
                } catch (Z) {
                }
            }
        },
        css: function (e, t, n, i) {
            var a, r, s, l = le.camelCase(t);
            return t = le.cssProps[l] || (le.cssProps[l] = E(e.style, l)), s = le.cssHooks[t] || le.cssHooks[l], s && "get" in s && (r = s.get(e, !0, n)), r === o && (r = to(e, t, i)), "normal" === r && t in mo && (r = mo[t]), "" === n || n ? (a = parseFloat(r), !0 === n || le.isNumeric(a) ? a || 0 : r) : r
        },
        swap: function (e, o, t, n) {
            var i, a, r = {};
            for (a in o) r[a] = e.style[a], e.style[a] = o[a];
            i = t.apply(e, n || []);
            for (a in o) e.style[a] = r[a];
            return i
        }
    }), e.getComputedStyle ? (oo = function (o) {
        return e.getComputedStyle(o, null)
    }, to = function (e, t, n) {
        var i, a, r, s = n || oo(e), l = s ? s.getPropertyValue(t) || s[t] : o, p = e.style;
        return s && ("" !== l || le.contains(e.ownerDocument, e) || (l = le.style(e, t)), po.test(l) && so.test(t) && (i = p.width, a = p.minWidth, r = p.maxWidth, p.minWidth = p.maxWidth = p.width = l, l = s.width, p.width = i, p.minWidth = a, p.maxWidth = r)), l
    }) : K.documentElement.currentStyle && (oo = function (e) {
        return e.currentStyle
    }, to = function (e, t, n) {
        var i, a, r, s = n || oo(e), l = s ? s[t] : o, p = e.style;
        return null == l && p && p[t] && (l = p[t]), po.test(l) && !ao.test(t) && (i = p.left, a = e.runtimeStyle, r = a && a.left, r && (a.left = e.currentStyle.left), p.left = "fontSize" === t ? "1em" : l, l = p.pixelLeft + "px", p.left = i, r && (a.left = r)), "" === l ? "auto" : l
    }), le.each(["height", "width"], function (e, t) {
        le.cssHooks[t] = {
            get: function (e, n, i) {
                return n ? 0 === e.offsetWidth && ro.test(le.css(e, "display")) ? le.swap(e, ho, function () {
                    return I(e, t, i)
                }) : I(e, t, i) : o
            }, set: function (e, o, n) {
                var i = n && oo(e);
                return S(e, o, n ? N(e, t, n, le.support.boxSizing && "border-box" === le.css(e, "boxSizing", !1, i), i) : 0)
            }
        }
    }), le.support.opacity || (le.cssHooks.opacity = {
        get: function (e, o) {
            return io.test((o && e.currentStyle ? e.currentStyle.filter : e.style.filter) || "") ? .01 * parseFloat(RegExp.$1) + "" : o ? "1" : ""
        }, set: function (e, o) {
            var t = e.style, n = e.currentStyle, i = le.isNumeric(o) ? "alpha(opacity=" + 100 * o + ")" : "",
                a = n && n.filter || t.filter || "";
            t.zoom = 1, (o >= 1 || "" === o) && "" === le.trim(a.replace(no, "")) && t.removeAttribute && (t.removeAttribute("filter"), "" === o || n && !n.filter) || (t.filter = no.test(a) ? a.replace(no, i) : a + " " + i)
        }
    }), le(function () {
        le.support.reliableMarginRight || (le.cssHooks.marginRight = {
            get: function (e, t) {
                return t ? le.swap(e, { display: "inline-block" }, to, [e, "marginRight"]) : o
            }
        }), !le.support.pixelPosition && le.fn.position && le.each(["top", "left"], function (e, t) {
            le.cssHooks[t] = {
                get: function (e, n) {
                    return n ? (n = to(e, t), po.test(n) ? le(e).position()[t] + "px" : n) : o
                }
            }
        })
    }), le.expr && le.expr.filters && (le.expr.filters.hidden = function (e) {
        return 0 >= e.offsetWidth && 0 >= e.offsetHeight || !le.support.reliableHiddenOffsets && "none" === (e.style && e.style.display || le.css(e, "display"))
    }, le.expr.filters.visible = function (e) {
        return !le.expr.filters.hidden(e)
    }), le.each({ margin: "", padding: "", border: "Width" }, function (e, o) {
        le.cssHooks[e + o] = {
            expand: function (t) {
                for (var n = 0, i = {}, a = "string" == typeof t ? t.split(" ") : [t]; 4 > n; n++) i[e + go[n] + o] = a[n] || a[n - 2] || a[0];
                return i
            }
        }, so.test(e) || (le.cssHooks[e + o].set = S)
    });
    var _o = /\[\]$/, fo = /^(?:submit|button|image|reset|file)$/i, wo = /^(?:input|select|textarea|keygen)/i;
    le.fn.extend({
        serialize: function () {
            return le.param(this.serializeArray())
        }, serializeArray: function () {
            return this.map(function () {
                var e = le.prop(this, "elements");
                return e ? le.makeArray(e) : this
            }).filter(function () {
                var e = this.type;
                return this.name && !le(this).is(":disabled") && wo.test(this.nodeName) && !fo.test(e) && (this.checked || !ze.test(e))
            }).map(function (e, o) {
                var t = le(this).val();
                return null == t ? null : le.isArray(t) ? le.map(t, function (e) {
                    return { name: o.name, value: e.replace(/\r?\n/g, "\r\n") }
                }) : { name: o.name, value: t.replace(/\r?\n/g, "\r\n") }
            }).get()
        }
    }), le.param = function (e, t) {
        var n, i = [], a = function (e, o) {
            o = le.isFunction(o) ? o() : null == o ? "" : o, i[i.length] = encodeURIComponent(e) + "=" + encodeURIComponent(o)
        };
        if (t === o && (t = le.ajaxSettings && le.ajaxSettings.traditional), le.isArray(e) || e.jquery && !le.isPlainObject(e)) le.each(e, function () {
            a(this.name, this.value)
        }); else for (n in e) y(n, e[n], t, a);
        return i.join("&").replace(/%20/g, "+")
    }, le.each("blur focus focusin focusout load resize scroll unload click dblclick mousedown mouseup mousemove mouseover mouseout mouseenter mouseleave change select submit keydown keypress keyup error contextmenu".split(" "), function (e, o) {
        le.fn[o] = function (e, t) {
            return arguments.length > 0 ? this.on(o, null, e, t) : this.trigger(o)
        }
    }), le.fn.hover = function (e, o) {
        return this.mouseenter(e).mouseleave(o || e)
    };
    var vo, Eo, To = le.now(), Po = /\?/, So = /([?&])_=[^&]*/, No = /^(.*?):[ \t]*([^\r\n]*)\r?$/gm,
        Io = /^(?:about|app|app-storage|.+-extension|file|res|widget):$/, Co = /^(?:GET|HEAD)$/,
        Ro = /^([\w.+-]+:)(?:\/\/([^\/?#:]*)(?::(\d+)|)|)/, yo = le.fn.load, Lo = {}, Do = {}, Go = "*/".concat("*");
    try {
        Eo = X.href
    } catch (qo) {
        Eo = K.createElement("a"), Eo.href = "", Eo = Eo.href
    }
    vo = Ro.exec(Eo.toLowerCase()) || [], le.fn.load = function (e, t, n) {
        if ("string" != typeof e && yo) return yo.apply(this, arguments);
        var i, a, r, s = this, l = e.indexOf(" ");
        return l >= 0 && (i = e.slice(l, e.length), e = e.slice(0, l)), le.isFunction(t) ? (n = t, t = o) : t && "object" == typeof t && (r = "POST"), s.length > 0 && le.ajax({
            url: e,
            type: r,
            dataType: "html",
            data: t
        }).done(function (e) {
            a = arguments, s.html(i ? le("<div>").append(le.parseHTML(e)).find(i) : e)
        }).complete(n && function (e, o) {
            s.each(n, a || [e.responseText, o, e])
        }), this
    }, le.each(["ajaxStart", "ajaxStop", "ajaxComplete", "ajaxError", "ajaxSuccess", "ajaxSend"], function (e, o) {
        le.fn[o] = function (e) {
            return this.on(o, e)
        }
    }), le.each(["get", "post"], function (e, t) {
        le[t] = function (e, n, i, a) {
            return le.isFunction(n) && (a = a || i, i = n, n = o), le.ajax({
                url: e,
                type: t,
                dataType: a,
                data: n,
                success: i
            })
        }
    }), le.extend({
        active: 0,
        lastModified: {},
        etag: {},
        ajaxSettings: {
            url: Eo,
            type: "GET",
            isLocal: Io.test(vo[1]),
            global: !0,
            processData: !0,
            async: !0,
            contentType: "application/x-www-form-urlencoded; charset=UTF-8",
            accepts: {
                "*": Go,
                text: "text/plain",
                html: "text/html",
                xml: "application/xml, text/xml",
                json: "application/json, text/javascript"
            },
            contents: { xml: /xml/, html: /html/, json: /json/ },
            responseFields: { xml: "responseXML", text: "responseText" },
            converters: { "* text": e.String, "text html": !0, "text json": le.parseJSON, "text xml": le.parseXML },
            flatOptions: { url: !0, context: !0 }
        },
        ajaxSetup: function (e, o) {
            return o ? G(G(e, le.ajaxSettings), o) : G(le.ajaxSettings, e)
        },
        ajaxPrefilter: L(Lo),
        ajaxTransport: L(Do),
        ajax: function (e, t) {
            function n(e, t, n, i) {
                var a, u, f, w, E, P = t;
                2 !== v && (v = 2, l && clearTimeout(l), c = o, s = i || "", T.readyState = e > 0 ? 4 : 0, n && (w = O(h, T, n)), e >= 200 && 300 > e || 304 === e ? (h.ifModified && (E = T.getResponseHeader("Last-Modified"), E && (le.lastModified[r] = E), (E = T.getResponseHeader("etag")) && (le.etag[r] = E)), 204 === e ? (a = !0, P = "nocontent") : 304 === e ? (a = !0, P = "notmodified") : (a = x(h, w), P = a.state, u = a.data, f = a.error, a = !f)) : (f = P, (e || !P) && (P = "error", 0 > e && (e = 0))), T.status = e, T.statusText = (t || P) + "", a ? d.resolveWith(m, [u, P, T]) : d.rejectWith(m, [T, P, f]), T.statusCode(_), _ = o, p && g.trigger(a ? "ajaxSuccess" : "ajaxError", [T, h, a ? u : f]), b.fireWith(m, [T, P]), p && (g.trigger("ajaxComplete", [T, h]), --le.active || le.event.trigger("ajaxStop")))
            }

            "object" == typeof e && (t = e, e = o), t = t || {};
            var i, a, r, s, l, p, c, u, h = le.ajaxSetup({}, t), m = h.context || h,
                g = h.context && (m.nodeType || m.jquery) ? le(m) : le.event, d = le.Deferred(),
                b = le.Callbacks("once memory"), _ = h.statusCode || {}, f = {}, w = {}, v = 0, E = "canceled", T = {
                    readyState: 0, getResponseHeader: function (e) {
                        var o;
                        if (2 === v) {
                            if (!u) for (u = {}; o = No.exec(s);) u[o[1].toLowerCase()] = o[2];
                            o = u[e.toLowerCase()]
                        }
                        return null == o ? null : o
                    }, getAllResponseHeaders: function () {
                        return 2 === v ? s : null
                    }, setRequestHeader: function (e, o) {
                        var t = e.toLowerCase();
                        return v || (e = w[t] = w[t] || e, f[e] = o), this
                    }, overrideMimeType: function (e) {
                        return v || (h.mimeType = e), this
                    }, statusCode: function (e) {
                        var o;
                        if (e) if (2 > v) for (o in e) _[o] = [_[o], e[o]]; else T.always(e[T.status]);
                        return this
                    }, abort: function (e) {
                        var o = e || E;
                        return c && c.abort(o), n(0, o), this
                    }
                };
            if (d.promise(T).complete = b.add, T.success = T.done, T.error = T.fail, h.url = ((e || h.url || Eo) + "").replace(/#.*$/, "").replace(/^\/\//, vo[1] + "//"), h.type = t.method || t.type || h.method || h.type, h.dataTypes = le.trim(h.dataType || "*").toLowerCase().match(ce) || [""], null == h.crossDomain && (i = Ro.exec(h.url.toLowerCase()), h.crossDomain = !(!i || i[1] === vo[1] && i[2] === vo[2] && (i[3] || ("http:" === i[1] ? 80 : 443)) == (vo[3] || ("http:" === vo[1] ? 80 : 443)))), h.data && h.processData && "string" != typeof h.data && (h.data = le.param(h.data, h.traditional)), D(Lo, h, t, T), 2 === v) return T;
            p = h.global, p && 0 == le.active++ && le.event.trigger("ajaxStart"), h.type = h.type.toUpperCase(), h.hasContent = !Co.test(h.type), r = h.url, h.hasContent || (h.data && (r = h.url += (Po.test(r) ? "&" : "?") + h.data, delete h.data), !1 === h.cache && (h.url = So.test(r) ? r.replace(So, "$1_=" + To++) : r + (Po.test(r) ? "&" : "?") + "_=" + To++)), h.ifModified && (le.lastModified[r] && T.setRequestHeader("If-Modified-Since", le.lastModified[r]), le.etag[r] && T.setRequestHeader("If-None-Match", le.etag[r])), (h.data && h.hasContent && !1 !== h.contentType || t.contentType) && T.setRequestHeader("Content-Type", h.contentType), T.setRequestHeader("Accept", h.dataTypes[0] && h.accepts[h.dataTypes[0]] ? h.accepts[h.dataTypes[0]] + ("*" !== h.dataTypes[0] ? ", " + Go + "; q=0.01" : "") : h.accepts["*"]);
            for (a in h.headers) T.setRequestHeader(a, h.headers[a]);
            if (h.beforeSend && (!1 === h.beforeSend.call(m, T, h) || 2 === v)) return T.abort();
            E = "abort";
            for (a in { success: 1, error: 1, complete: 1 }) T[a](h[a]);
            if (c = D(Do, h, t, T)) {
                T.readyState = 1, p && g.trigger("ajaxSend", [T, h]), h.async && h.timeout > 0 && (l = setTimeout(function () {
                    T.abort("timeout")
                }, h.timeout));
                try {
                    v = 1, c.send(f, n)
                } catch (he) {
                    if (!(2 > v)) throw he;
                    n(-1, he)
                }
            } else n(-1, "No Transport");
            return T
        },
        getScript: function (e, t) {
            return le.get(e, o, t, "script")
        },
        getJSON: function (e, o, t) {
            return le.get(e, o, t, "json")
        }
    }), le.ajaxSetup({
        accepts: { script: "text/javascript, application/javascript, application/ecmascript, application/x-ecmascript" },
        contents: { script: /(?:java|ecma)script/ },
        converters: {
            "text script": function (e) {
                return le.globalEval(e), e
            }
        }
    }), le.ajaxPrefilter("script", function (e) {
        e.cache === o && (e.cache = !1), e.crossDomain && (e.type = "GET", e.global = !1)
    }), le.ajaxTransport("script", function (e) {
        if (e.crossDomain) {
            var t, n = K.head || le("head")[0] || K.documentElement;
            return {
                send: function (o, i) {
                    t = K.createElement("script"), t.async = !0, e.scriptCharset && (t.charset = e.scriptCharset), t.src = e.url, t.onload = t.onreadystatechange = function (e, o) {
                        (o || !t.readyState || /loaded|complete/.test(t.readyState)) && (t.onload = t.onreadystatechange = null, t.parentNode && t.parentNode.removeChild(t), t = null, o || i(200, "success"))
                    }, n.insertBefore(t, n.firstChild)
                }, abort: function () {
                    t && t.onload(o, !0)
                }
            }
        }
    });
    var Oo = [], xo = /(=)\?(?=&|$)|\?\?/;
    le.ajaxSetup({
        jsonp: "callback", jsonpCallback: function () {
            var e = Oo.pop() || le.expando + "_" + To++;
            return this[e] = !0, e
        }
    }), le.ajaxPrefilter("json jsonp", function (t, n, i) {
        var a, r, s,
            l = !1 !== t.jsonp && (xo.test(t.url) ? "url" : "string" == typeof t.data && !(t.contentType || "").indexOf("application/x-www-form-urlencoded") && xo.test(t.data) && "data");
        return l || "jsonp" === t.dataTypes[0] ? (a = t.jsonpCallback = le.isFunction(t.jsonpCallback) ? t.jsonpCallback() : t.jsonpCallback, l ? t[l] = t[l].replace(xo, "$1" + a) : !1 !== t.jsonp && (t.url += (Po.test(t.url) ? "&" : "?") + t.jsonp + "=" + a), t.converters["script json"] = function () {
            return s || le.error(a + " was not called"), s[0]
        }, t.dataTypes[0] = "json", r = e[a], e[a] = function () {
            s = arguments
        }, i.always(function () {
            e[a] = r, t[a] && (t.jsonpCallback = n.jsonpCallback, Oo.push(a)), s && le.isFunction(r) && r(s[0]), s = r = o
        }), "script") : o
    });
    var Ao, ko, Uo = 0, Vo = e.ActiveXObject && function () {
        var e;
        for (e in Ao) Ao[e](o, !0)
    };
    le.ajaxSettings.xhr = e.ActiveXObject ? function () {
        return !this.isLocal && A() || k()
    } : A, ko = le.ajaxSettings.xhr(), le.support.cors = !!ko && "withCredentials" in ko, (ko = le.support.ajax = !!ko) && le.ajaxTransport(function (t) {
        if (!t.crossDomain || le.support.cors) {
            var n;
            return {
                send: function (i, a) {
                    var r, s, l = t.xhr();
                    if (t.username ? l.open(t.type, t.url, t.async, t.username, t.password) : l.open(t.type, t.url, t.async), t.xhrFields) for (s in t.xhrFields) l[s] = t.xhrFields[s];
                    t.mimeType && l.overrideMimeType && l.overrideMimeType(t.mimeType), t.crossDomain || i["X-Requested-With"] || (i["X-Requested-With"] = "XMLHttpRequest");
                    try {
                        for (s in i) l.setRequestHeader(s, i[s])
                    } catch (Q) {
                    }
                    l.send(t.hasContent && t.data || null), n = function (e, i) {
                        var s, p, c, u;
                        try {
                            if (n && (i || 4 === l.readyState)) if (n = o, r && (l.onreadystatechange = le.noop, Vo && delete Ao[r]), i) 4 !== l.readyState && l.abort(); else {
                                u = {}, s = l.status, p = l.getAllResponseHeaders(), "string" == typeof l.responseText && (u.text = l.responseText);
                                try {
                                    c = l.statusText
                                } catch (oe) {
                                    c = ""
                                }
                                s || !t.isLocal || t.crossDomain ? 1223 === s && (s = 204) : s = u.text ? 200 : 404
                            }
                        } catch (te) {
                            i || a(-1, te)
                        }
                        u && a(s, c, u, p)
                    }, t.async ? 4 === l.readyState ? setTimeout(n) : (r = ++Uo, Vo && (Ao || (Ao = {}, le(e).unload(Vo)), Ao[r] = n), l.onreadystatechange = n) : n()
                }, abort: function () {
                    n && n(o, !0)
                }
            }
        }
    });
    var Wo, Mo, Fo = /^(?:toggle|show|hide)$/, Ho = RegExp("^(?:([+-])=|)(" + pe + ")([a-z%]*)$", "i"),
        Bo = /queueHooks$/, jo = [F], $o = {
            "*": [function (e, o) {
                var t, n, i = this.createTween(e, o), a = Ho.exec(o), r = i.cur(), s = +r || 0, l = 1, p = 20;
                if (a) {
                    if (t = +a[2], "px" !== (n = a[3] || (le.cssNumber[e] ? "" : "px")) && s) {
                        s = le.css(i.elem, e, !0) || t || 1;
                        do {
                            l = l || ".5", s /= l, le.style(i.elem, e, s + n)
                        } while (l !== (l = i.cur() / r) && 1 !== l && --p)
                    }
                    i.unit = n, i.start = s, i.end = a[1] ? s + (a[1] + 1) * t : t
                }
                return i
            }]
        };
    le.Animation = le.extend(W, {
        tweener: function (e, o) {
            le.isFunction(e) ? (o = e, e = ["*"]) : e = e.split(" ");
            for (var t, n = 0, i = e.length; i > n; n++) t = e[n], $o[t] = $o[t] || [], $o[t].unshift(o)
        }, prefilter: function (e, o) {
            o ? jo.unshift(e) : jo.push(e)
        }
    }), le.Tween = H, H.prototype = {
        constructor: H, init: function (e, o, t, n, i, a) {
            this.elem = e, this.prop = t, this.easing = i || "swing", this.options = o, this.start = this.now = this.cur(), this.end = n, this.unit = a || (le.cssNumber[t] ? "" : "px")
        }, cur: function () {
            var e = H.propHooks[this.prop];
            return e && e.get ? e.get(this) : H.propHooks._default.get(this)
        }, run: function (e) {
            var o, t = H.propHooks[this.prop];
            return this.pos = o = this.options.duration ? le.easing[this.easing](e, this.options.duration * e, 0, 1, this.options.duration) : e, this.now = (this.end - this.start) * o + this.start, this.options.step && this.options.step.call(this.elem, this.now, this), t && t.set ? t.set(this) : H.propHooks._default.set(this), this
        }
    }, H.prototype.init.prototype = H.prototype, H.propHooks = {
        _default: {
            get: function (e) {
                var o;
                return null == e.elem[e.prop] || e.elem.style && null != e.elem.style[e.prop] ? (o = le.css(e.elem, e.prop, ""), o && "auto" !== o ? o : 0) : e.elem[e.prop]
            }, set: function (e) {
                le.fx.step[e.prop] ? le.fx.step[e.prop](e) : e.elem.style && (null != e.elem.style[le.cssProps[e.prop]] || le.cssHooks[e.prop]) ? le.style(e.elem, e.prop, e.now + e.unit) : e.elem[e.prop] = e.now
            }
        }
    }, H.propHooks.scrollTop = H.propHooks.scrollLeft = {
        set: function (e) {
            e.elem.nodeType && e.elem.parentNode && (e.elem[e.prop] = e.now)
        }
    }, le.each(["toggle", "show", "hide"], function (e, o) {
        var t = le.fn[o];
        le.fn[o] = function (e, n, i) {
            return null == e || "boolean" == typeof e ? t.apply(this, arguments) : this.animate(B(o, !0), e, n, i)
        }
    }), le.fn.extend({
        fadeTo: function (e, o, t, n) {
            return this.filter(T).css("opacity", 0).show().end().animate({ opacity: o }, e, t, n)
        }, animate: function (e, o, t, n) {
            var i = le.isEmptyObject(e), a = le.speed(o, t, n), r = function () {
                var o = W(this, le.extend({}, e), a);
                r.finish = function () {
                    o.stop(!0)
                }, (i || le._data(this, "finish")) && o.stop(!0)
            };
            return r.finish = r, i || !1 === a.queue ? this.each(r) : this.queue(a.queue, r)
        }, stop: function (e, t, n) {
            var i = function (e) {
                var o = e.stop;
                delete e.stop, o(n)
            };
            return "string" != typeof e && (n = t, t = e, e = o), t && !1 !== e && this.queue(e || "fx", []), this.each(function () {
                var o = !0, t = null != e && e + "queueHooks", a = le.timers, r = le._data(this);
                if (t) r[t] && r[t].stop && i(r[t]); else for (t in r) r[t] && r[t].stop && Bo.test(t) && i(r[t]);
                for (t = a.length; t--;) a[t].elem !== this || null != e && a[t].queue !== e || (a[t].anim.stop(n), o = !1, a.splice(t, 1));
                (o || !n) && le.dequeue(this, e)
            })
        }, finish: function (e) {
            return !1 !== e && (e = e || "fx"), this.each(function () {
                var o, t = le._data(this), n = t[e + "queue"], i = t[e + "queueHooks"], a = le.timers,
                    r = n ? n.length : 0;
                for (t.finish = !0, le.queue(this, e, []), i && i.cur && i.cur.finish && i.cur.finish.call(this), o = a.length; o--;) a[o].elem === this && a[o].queue === e && (a[o].anim.stop(!0), a.splice(o, 1));
                for (o = 0; r > o; o++) n[o] && n[o].finish && n[o].finish.call(this);
                delete t.finish
            })
        }
    }), le.each({
        slideDown: B("show"),
        slideUp: B("hide"),
        slideToggle: B("toggle"),
        fadeIn: { opacity: "show" },
        fadeOut: { opacity: "hide" },
        fadeToggle: { opacity: "toggle" }
    }, function (e, o) {
        le.fn[e] = function (e, t, n) {
            return this.animate(o, e, t, n)
        }
    }), le.speed = function (e, o, t) {
        var n = e && "object" == typeof e ? le.extend({}, e) : {
            complete: t || !t && o || le.isFunction(e) && e,
            duration: e,
            easing: t && o || o && !le.isFunction(o) && o
        };
        return n.duration = le.fx.off ? 0 : "number" == typeof n.duration ? n.duration : n.duration in le.fx.speeds ? le.fx.speeds[n.duration] : le.fx.speeds._default, (null == n.queue || !0 === n.queue) && (n.queue = "fx"), n.old = n.complete, n.complete = function () {
            le.isFunction(n.old) && n.old.call(this), n.queue && le.dequeue(this, n.queue)
        }, n
    }, le.easing = {
        linear: function (e) {
            return e
        }, swing: function (e) {
            return .5 - Math.cos(e * Math.PI) / 2
        }
    }, le.timers = [], le.fx = H.prototype.init, le.fx.tick = function () {
        var e, t = le.timers, n = 0;
        for (Wo = le.now(); t.length > n; n++) (e = t[n])() || t[n] !== e || t.splice(n--, 1);
        t.length || le.fx.stop(), Wo = o
    }, le.fx.timer = function (e) {
        e() && le.timers.push(e) && le.fx.start()
    }, le.fx.interval = 13, le.fx.start = function () {
        Mo || (Mo = setInterval(le.fx.tick, le.fx.interval))
    }, le.fx.stop = function () {
        clearInterval(Mo), Mo = null
    }, le.fx.speeds = {
        slow: 600,
        fast: 200,
        _default: 400
    }, le.fx.step = {}, le.expr && le.expr.filters && (le.expr.filters.animated = function (e) {
        return le.grep(le.timers, function (o) {
            return e === o.elem
        }).length
    }), le.fn.offset = function (e) {
        if (arguments.length) return e === o ? this : this.each(function (o) {
            le.offset.setOffset(this, e, o)
        });
        var t, n, i = { top: 0, left: 0 }, a = this[0], r = a && a.ownerDocument;
        return r ? (t = r.documentElement, le.contains(t, a) ? (typeof a.getBoundingClientRect !== z && (i = a.getBoundingClientRect()), n = j(r), {
            top: i.top + (n.pageYOffset || t.scrollTop) - (t.clientTop || 0),
            left: i.left + (n.pageXOffset || t.scrollLeft) - (t.clientLeft || 0)
        }) : i) : void 0
    }, le.offset = {
        setOffset: function (e, o, t) {
            var n = le.css(e, "position");
            "static" === n && (e.style.position = "relative");
            var i, a, r = le(e), s = r.offset(), l = le.css(e, "top"), p = le.css(e, "left"),
                c = ("absolute" === n || "fixed" === n) && le.inArray("auto", [l, p]) > -1, u = {}, h = {};
            c ? (h = r.position(), i = h.top, a = h.left) : (i = parseFloat(l) || 0, a = parseFloat(p) || 0), le.isFunction(o) && (o = o.call(e, t, s)), null != o.top && (u.top = o.top - s.top + i), null != o.left && (u.left = o.left - s.left + a), "using" in o ? o.using.call(e, u) : r.css(u)
        }
    }, le.fn.extend({
        position: function () {
            if (this[0]) {
                var e, o, t = { top: 0, left: 0 }, n = this[0];
                return "fixed" === le.css(n, "position") ? o = n.getBoundingClientRect() : (e = this.offsetParent(), o = this.offset(), le.nodeName(e[0], "html") || (t = e.offset()), t.top += le.css(e[0], "borderTopWidth", !0), t.left += le.css(e[0], "borderLeftWidth", !0)), {
                    top: o.top - t.top - le.css(n, "marginTop", !0),
                    left: o.left - t.left - le.css(n, "marginLeft", !0)
                }
            }
        }, offsetParent: function () {
            return this.map(function () {
                for (var e = this.offsetParent || K.documentElement; e && !le.nodeName(e, "html") && "static" === le.css(e, "position");) e = e.offsetParent;
                return e || K.documentElement
            })
        }
    }), le.each({ scrollLeft: "pageXOffset", scrollTop: "pageYOffset" }, function (e, t) {
        var n = /Y/.test(t);
        le.fn[e] = function (i) {
            return le.access(this, function (e, i, a) {
                var r = j(e);
                return a === o ? r ? t in r ? r[t] : r.document.documentElement[i] : e[i] : (r ? r.scrollTo(n ? le(r).scrollLeft() : a, n ? a : le(r).scrollTop()) : e[i] = a, o)
            }, e, i, arguments.length, null)
        }
    }), le.each({ Height: "height", Width: "width" }, function (e, t) {
        le.each({ padding: "inner" + e, content: t, "": "outer" + e }, function (n, i) {
            le.fn[i] = function (i, a) {
                var r = arguments.length && (n || "boolean" != typeof i),
                    s = n || (!0 === i || !0 === a ? "margin" : "border");
                return le.access(this, function (t, n, i) {
                    var a;
                    return le.isWindow(t) ? t.document.documentElement["client" + e] : 9 === t.nodeType ? (a = t.documentElement, Math.max(t.body["scroll" + e], a["scroll" + e], t.body["offset" + e], a["offset" + e], a["client" + e])) : i === o ? le.css(t, n, s) : le.style(t, n, i, s)
                }, t, r ? i : o, r, null)
            }
        })
    }), e.webphone_api.$ = le, "function" == typeof define && define.amd && define.amd.jQuery && define("jquery", [], function () {
        return le
    })
}(window), webphone_api.global = {
    isdebugversion_showengineselection: !1,
    isdebugversion: !1,
    isdebugversionwebrtc: !1,
    isdebugengine: !1,
    linnsengine: !0,
    macnsengine: !0,
    winlinmacnsengine: !1,
    deviceType: "-1",
    autoServerDeployVersion: !1,
    lastautoprovserver: "",
    checkforautoprov: !0,
    flagWaitforautoprov: !1,
    code_version: 17,
    config_version: 1,
    versionstr: "3.1.0312",
    minimumserviceversion: 34,
    maximumserviceversion: 20,
    useengine: "",
    useengineclicked_cache: 0,
    last_useengine: "",
    ENGINE_WEBPHONE: "java",
    ENGINE_WEBRTC: "webrtc",
    ENGINE_SERVICE: "ns",
    ENGINE_FLASH: "flash",
    ENGINE_APP: "app",
    webrtcavailable: -1,
    engineselecttime: 0,
    engineselectstage: -1,
    ENGINE_DELAY: 1e3,
    iscurrengineworking: !1,
    isfirststart: !1,
    recwsload: 0,
    usuk: "",
    predefLoglevel: 5,
    logs: "",
    nrofrecentstodisplay: 10,
    closeCallAtivity: !1,
    nrOfCallfunctionsToDisplay: 5,
    pagewasrefreshed: !0,
    ringstart_time: 0,
    callstart_time: 0,
    wasSettModified: !1,
    wasCtModified: !1,
    wasChModified: !1,
    autoprovsrv_1: "https://www.webvoipphone.com/psettings/",
    autoprovsrv_2: "https://www.mizu-voip.com/phonesettings/",
    ctlist: [],
    chlist: [],
    aclist: [],
    recentlist: [],
    searchctlist: [],
    reloadcontactsaftersync: !1,
    refreshrecents: !1,
    readcallhistoryforrecents: !0,
    isencrypted: 0,
    audio_rec_device_list: "",
    audio_play_device_list: "",
    audio_ring_device_list: "",
    audio_devices_loaded: !1,
    audio_rec_curr_device: "",
    audio_play_curr_device: "",
    audio_ring_curr_device: "",
    video_rec_device_list: "",
    video_rec_curr_device: "",
    usestorage: !0,
    phonestarted: 0,
    service_last_life_signal: 0,
    useajax_forservice: !1,
    serviceStatusPollTimer: null,
    STORAGE_AUTO: 0,
    STORAGE_COOKIE: 1,
    STORAGE_LOCAL: 2,
    ACCOUNTS_FILENAME: "wp_accounts",
    CONTACTS_FILENAME: "wp_contacts",
    SALT: "q8fgdahp9",
    SALT2: "vm1nye8ur2w",
    WIN_SOFTPHONE_URL: "http://127.0.0.1:18420",
    NATIVE_PLUGIN_URL: "ws://127.0.0.1",
    NATIVE_PLUGIN_URL_SECURE: "wss://ns4.webvoipphone.com",
    NATIVE_PLUGIN_URL_SECURE2: "",
    NATIVE_PLUGIN_URL_WIN_PORT: 18520,
    NATIVE_PLUGIN_URL_LINMAC_PORT: 18320,
    NATIVE_PLUGIN_URL_WIN_SSL_PORT: 10443,
    NATIVE_PLUGIN_URL_LINMAC_SSL_PORT: 19433,
    NPUSECURE1_YEAR: 3022,
    NPUSECURE1_MONTH: 1,
    NPUSECURE2_YEAR: 3024,
    NPUSECURE2_MONTH: 0,
    ENABLE_JAVA_URL: "http://java.com/en/download/help/enable_browser.xml",
    INSTALL_JAVA_URL: "http://www.java.com/download/",
    ec_apikey: "aJ6aqK4Nah3hnP7aht",
    ec_autoprov: "gJa6B2oa5Nx3Kya8n",
    wssupported: !1,
    httpmehod: "",
    currhttpmehodworking: !1,
    domloaded: !1,
    loglevel: 1,
    incommingCall: !1,
    acceptReject: !1,
    checkIfInCall: !1,
    checkIfCallActive: !1,
    callTypeInOut: "",
    lastRingEvenet: "",
    hangupPressedCount: 0,
    maintimerid: null,
    polltimerid: null,
    worktimer: null,
    httpkatimer: 0,
    initcalled: !1,
    callName: "",
    credit: "",
    creditRequestIval: 100,
    CREDIT_REQUEST_IVAL_DEFVAL: 12e3,
    creditRequestTimer: 0,
    apppletloaded: !1,
    presenceHM: {},
    waitforpresence: 0,
    presence_started: !1,
    last_used_engine_cache: "",
    haschat: 3,
    applet_started: !1,
    speakerState: !0,
    bluetoothState: !0,
    lastcalldetails: "",
    lastcallduration: 0,
    isfirstwsu: !0,
    wsuser_succeded: !1,
    notifs: [],
    intentsettings: [],
    intentctdetails: [],
    intentcall: [],
    intentaddeditct: [],
    intentchdetails: [],
    intentmsg: [],
    intentbrowser: [],
    intentstartpage: [],
    intentfiletransfer: [],
    intentsmscodeverify: [],
    rating: "",
    httpreqasynccallback: null,
    bwanswercallback: null,
    bwanswerfilename: null,
    bwanswerINCNUMBER: 0,
    dispSaveSettMsg: 0,
    showratewhiletype_cache: 0,
    nsupdatepending: !1,
    isDialpadStarted: !1,
    isCallStarted: !1,
    isContactslistStarted: !1,
    isContactdetailsStarted: !1,
    isCallhistorylistStarted: !1,
    isCallhistorydetailsStarted: !1,
    isSettingsStarted: !1,
    isAddeditcontactStarted: !1,
    isMessagelistStarted: !1,
    isMessageStarted: !1,
    isInternalbrowserStarted: !1,
    isStartpageStarted: !1,
    isLogviewStarted: !1,
    isNewuserStarted: !1,
    isSmscodeverifyStarted: !1,
    isFiletransferStarted: !1,
    isFiltersStarted: !1,
    isAccountsStarted: !1,
    isExtra1Started: !1,
    isExtra2Started: !1,
    isExtra3Started: !1,
    isExtra4Started: !1,
    isExtra5Started: !1,
    alreadyCalledNrs: "",
    contactExists: !0,
    contactExistsNr: "",
    authenticated_displayed: !1,
    favafone_autologin: !1,
    aline: 1,
    acallcount: 0,
    onloaded_called: !1,
    wploaded: !1,
    ep: [],
    lnstat: [],
    redialof: !1,
    redialhideevt: !1,
    lastcallcdr: "",
    reqid: 0,
    sendwsuserjsonp: !1,
    callhistoryfilter: -1,
    webrtcpermissionaccepted: !1,
    isconfcall: !1,
    sessionid: -1,
    dispregfailed: 0,
    onunregistered_flag: !1,
    onunload_flag: !1,
    handlesett_finished: !1,
    dploadingdisplayed: !1,
    telsearchname: "",
    pres_set_at_start: !1,
    laststarttick: 0,
    pres_unreg_called: !1,
    presenceinterval: 72e4,
    msg_presence_timer: 0,
    startendelayed_wascalled: !1,
    sipaccounts: [],
    waiting_conf_numbers: "",
    isconfroom_call: !1,
    checkpres_callback: [],
    active_incoming_call: !1,
    android_aletrnatebrowserurl_DEF: "https://play.google.com/store/apps/details?id=com.android.chrome",
    testmessagevalidity: 3,
    last_event: "",
    wsl_uk_rec: !1,
    wsl_us_rec: !1,
    canfailover_gateway: !0,
    failover_gateway: !0,
    aua_handled: !1,
    stacknotstarted_time: 0,
    stacknotstarted_retry: !1,
    dontshowdiscreason: !1,
    cansetuseengine: !1,
    lastconfroom: "",
    nostun: !1,
    noturn: !1,
    isvideocall: !1,
    lastpermreq: 0,
    dontshow_closecall: !1,
    chrome_ss_plugin_url: "https://chrome.google.com/webstore/detail/screen-capturing/ajhifddimkapgcifgcodmmfdlknahffk",
    printwad_called: !1,
    custmenusL: [],
    bname_charcount: 0,
    selected_apikey: "",
    dontclosecurrpopup: !1,
    last_presence_enabled: !1,
    currcallnumber: "",
    isfirstcall: !0,
    confanswer_received: !1,
    calltransf_completed: !1,
    flagclientreset: !1,
    phonestarttick: -1,
    httpheaderslogged: !1,
    onregisteredcalled: !1,
    flag_delsett: 0,
    resetsett_handled: !1,
    apistartstate: 0,
    apistarttick: 0,
    wnotstartedsession: !1,
    flagnsreconnect: !1,
    colorizelog: 0,
    webrtclastregsent: 0,
    webrtcregtimer_exec: 0,
    wsload_type: -1,
    webrtc_regstate: -1,
    addauser_header: !1,
    fcmstate: -1,
    fcmtoken: "",
    fcmIsEnabled: -1,
    decideusuk_finished: !1,
    wsc_contimeout: 0,
    wsc_reqtimeout: 0,
    add_recall_header: !1,
    domloaded_tick: 0,
    last_ns_ws_succwss: 0,
    callPageStatusCachePerLine: {},
    autoacceptsipheader: "",
    localforage_last_cb: null,
    last_wsu_tick: 0,
    pingpong: 0,
    ever_received_pong: !1,
    sipunicoderewritefrom: "",
    sipunicoderewriteto: "",
    firstregister_sessiontick: 0,
    bothpartyhold: !1,
    firefoxholdcount: 0,
    isholdresume: !1,
    isresume: !1,
    holdresumecount: 0,
    win_nsplugin_filename: "WebPhoneService_Install.exe",
    mac_nsplugin_filename: "webphone_ns_mac.zip",
    lin32_nsplugin_filename: "webphone_ns_lin32.zip",
    lin32arm_nsplugin_filename: "webphone_ns_lin32arm.zip",
    lin64_nsplugin_filename: "webphone_ns_lin64.zip",
    lin64arm_nsplugin_filename: "webphone_ns_lin64arm.zip",
    enstarteddisplayed: !1,
    usemutemutiline: !1,
    nuiswebpage: null,
    minimumservicebuild: 0,
    last_good_status: "",
    display_last_status: !1,
    minten: !1,
    mto: "",
    last_transfer_tick: 0,
    dontSendSignaling: !1,
    dontSendSignalingTimer: 0,
    isappenginestarted: !1,
    smsCodeUser: "",
    isconfdtmf: !1,
    CLOSE_CALL_TIMER: -100,
    lastengine_working_ok: "",
    lastengine_started_ok: "",
    restartice_time: 0,
    ice_timer: null,
    icecompleted: !1,
    ice_callaccepted: !1,
    settmap: {},
    settmap2: {},
    mRealm: "",
    webphone_started: !1
}, webphone_api.common = function () {
    function ClassSipAccounts() {
        this.serveraddress, this.username, this.password, this.ival, this.enabled, this.ismain, this.callerid, this.displayname, this.proxyaddress, this.realm
    }

    function ReceiveNotifications(e) {
        try {
            if (isNull(e) && (e = ""), e = Trim(e), 0 === e.length || e.indexOf(notsep) === e.lastIndexOf(notsep) && e.indexOf(notsep2) === e.lastIndexOf(notsep2)) CleanNotifications(e); else if (e.indexOf(notsep) !== e.lastIndexOf(notsep)) {
                var o = e.split(notsep);
                if (!isNull(o) && o.length > 0) for (var t = 0; t < o.length; t++) isNull(o[t]) || CleanNotifications(o[t])
            } else if (e.indexOf(notsep2) !== e.lastIndexOf(notsep2)) {
                var o = e.split(notsep2);
                if (!isNull(o) && o.length > 0) for (var t = 0; t < o.length; t++) isNull(o[t]) || CleanNotifications(o[t])
            } else CleanNotifications(e)
        } catch (n) {
            PutToDebugLogException(2, "common: ReceiveNotifications", n)
        }
    }

    function CleanNotifications(e) {
        try {
            isNull(e) && (e = ""), e = e.replace("WPNOTIFICATION,", ""), !1 === webphone_api.global.iscurrengineworking && (getuseengine() === webphone_api.global.ENGINE_SERVICE ? (e.indexOf("STATUS") >= 0 && e.indexOf("STOP") < 0 || e.indexOf("START") >= 0) && (webphone_api.global.iscurrengineworking = !0, SaveParameter("lastsessionsuccess", "2")) : (webphone_api.global.iscurrengineworking = !0, SaveParameter("lastsessionsuccess", "2")));
            var o = e.indexOf(notsep);
            if (o > 0 && (e = e.substring(0, o)), o = e.indexOf(notsep2), o > 0 && (e = e.substring(0, o)), e = e.replace("EOFLINE", ""), e = Trim(e), e.indexOf("DISPLAY") > 0) return e = Trim(e.replace("DISPLAY", "")), PutToDebugLog(1, e), void ShowToast(e);
            0 === e.indexOf("LOG") || e.indexOf("APIREQUEST:") >= 0 ? PutToDebugLog(3, e) : !0 === IsWindowsSoftphone() || getuseengine() === webphone_api.global.ENGINE_WEBPHONE || getuseengine() === webphone_api.global.ENGINE_SERVICE ? PutToDebugLog(1, e, "NOTIFICATION,") : PutToDebugLog(1, e)
        } catch (t) {
            PutToDebugLogException(2, "common: CleanNotifications", t)
        }
    }

    function GetLogTimeStamp() {
        var e = new Date, o = e.getHours(), t = e.getMinutes(), n = e.getSeconds(), i = e.getMilliseconds();
        return o < 10 && (o = "0" + o), t < 10 && (t = "0" + t), n < 10 && (n = "0" + n), i < 10 ? i = "00" + i : i < 100 && (i = "0" + i), "[" + o + ":" + t + ":" + n + "." + i + "] "
    }

    function PutToDebugLog(e, o, t) {
        logcount++, checkloglvl++;
        try {
            if (checkloglvl > 2 && (checkloglvl = 0, webphone_api.global.loglevel = GetLogLevel()), isNull(me1)) {
                var n = [];
                n.push("t"), n.push("r"), n.push("i"), n.push("a"), n.push("l "), n.push("e"), n.push("x"), n.push("p"), n.push("i"), n.push("r"), n.push("e"), n.push("d"), me1 = n.join(""), n = [], n.push("t"), n.push("r"), n.push("i"), n.push("a"), n.push("l "), n.push("session "), n.push("time"), n.push("out"), me2 = n.join(""), n = [], n.push("l"), n.push("i"), n.push("c"), n.push("e"), n.push("n"), n.push("s"), n.push("e"), n.push(" "), n.push("e"), n.push("r"), n.push("r"), n.push("o"), n.push("r"), me3 = n.join(""), n = [], n.push("t"), n.push("r"), n.push("i"), n.push("a"), n.push("l "), n.push("v"), n.push("e"), n.push("r"), n.push("s"), n.push("i"), n.push("o"), n.push("n"), n.push(" "), n.push("n"), n.push("e"), n.push("e"), n.push("d"), n.push(" "), n.push("r"), n.push("e"), n.push("s"), n.push("t"), n.push("a"), n.push("r"), n.push("t"), me4 = n.join(""), n = [], n.push("s"), n.push("e"), n.push("r"), n.push("v"), n.push("e"), n.push("r"), n.push(" "), n.push("i"), n.push("s"),
                    n.push(" "), n.push("n"), n.push("o"), n.push("t"), n.push(" "), n.push("e"), n.push("n"), n.push("a"), n.push("b"), n.push("l"), n.push("e"), n.push("d"), me5 = n.join("")
            }
            if (logfirstrun || logcount > 160) {
                logcount = 0;
                var i = logfirstrun;
                logfirstrun = !1, webphone_api.global.loglevel = GetLogLevel();
                return LogWebphoneInfo("\r\n", e, o), void (!0 === i && LogConfig())
            }
            var n = "", a = 0;
            if (isNull(o) || isNull(e)) return;
            if (IsNumber(e)) a = e, n = o; else {
                if (!IsNumber(o)) return;
                a = o, n = e
            }
            if (n.indexOf("Stack not started") >= 0 && (webphone_api.global.stacknotstarted_time = GetTickCount()), n.indexOf("=wsuser") > 0 && n.indexOf("authpwd=") > 0) {
                var r = n.substring(0, n.indexOf("authpwd="));
                n = n.substring(n.indexOf("authpwd=")), n = n.indexOf("&") > 0 ? n.substring(n.indexOf("&") + 1) : "", n = r + n
            }
            if (lastlogmsg === n) return;
            if (lastlogmsg = n, (webphone_api.global.useengine === webphone_api.global.ENGINE_WEBPHONE || webphone_api.global.useengine === webphone_api.global.ENGINE_SERVICE) && ((n.indexOf(me1) >= 0 || n.indexOf(me2) >= 0 || n.indexOf(me3) >= 0 || n.indexOf(me4) >= 0) && (lmsg = n, lm = !0), (n.indexOf(me1) >= 0 || n.indexOf(me3) >= 0 || n.indexOf(me5) >= 0) && getuseengine() === webphone_api.global.ENGINE_SERVICE && !1 === srvinst_offered)) {
                if (0 === GetParameterInt("nsupdate", -1)) return PutToDebugLog(1, "ERROR, NS update failed second time, prompt user to send logs"), void (!0 === IsSDK() ? AlertDialog("ERROR", "Please contact support and send logs from browser console") : AlertDialog("ERROR", "Please contact support and send logs from Menu -> Help -> Logs"));
                if (srvinst_offered = !0, setTimeout(function () {
                    srvinst_offered = !1
                }, 18e4), !1 === Te()) {
                    var s = n;
                    WinAPI("extcmd_version", function (e) {
                        try {
                            if (isNull(e) || e.indexOf("ERROR:") >= 0) return;
                            var o = -1, t = e.toString(), n = t.indexOf("version:");
                            n > 0 && (t = t.substring(n + 8)), n = t.indexOf("eov"), n > 0 && (t = t.substring(0, n)), t = Trim(t), !isNull(t) && IsNumber(t) && (o = StrToInt(t)), o > 0 && (SaveParameter("srvupgrade_currversion", o), webphone_api.global.maximumserviceversion > 0 && o >= webphone_api.global.maximumserviceversion ? AlertDialog("ERROR", s) : setTimeout(function () {
                                SaveParameter("nsupdate", "0");
                                try {
                                    console && console.log && console.log(2, "EVENT, common: PutToDebugLog, service upgrade needed: " + GetMinServiceVersion().toString())
                                } catch (e) {
                                }
                                EngineForcedInstall("ns", webphone_api.stringres.get("service_update")), webphone_api.global.nsupdatepending = !0
                            }, 1))
                        } catch (i) {
                            console.log("ERROR, catch on PutToDebugLog: extcmd_version" + i)
                        }
                    })
                }
            }
            !0 === lm && n.toLowerCase().indexOf("engine") < 0 && (n = lmsg, a = 1);
            try {
                webphone_api.onEventCb("log", n, null)
            } catch (m) {
            }
            try {
                webphone_api.onLogCb(n)
            } catch (m) {
            }
            sendlogstoandroid < 0 && (sendlogstoandroid = IsCExt());
            try {
                sendlogstoandroid > 0 && "undefined" != typeof AndroidWebphoneJsInterface && null !== AndroidWebphoneJsInterface && "undefined" != typeof AndroidWebphoneJsInterface.jstoandroidPutToDebugLog && null !== AndroidWebphoneJsInterface.jstoandroidPutToDebugLog && AndroidWebphoneJsInterface.jstoandroidPutToDebugLog(a.toString(), n)
            } catch (m) {
            }
            if (webphone_api.global.useengine === webphone_api.global.ENGINE_WEBRTC && n.toLowerCase().indexOf("failed to find transport") >= 0 && (isNull(console) || isNull(console.log) || console.log("detected in Log: failed to find transport"), webphone_api.flagrestartwebrtc = !0, webphone_api.webrtcapi.ReStart(0, !0)), n.indexOf("STOP") > 0 && (a = 2), !0 === webphone_api.global.redialhideevt && console && console.log && console.log("webphone: event dropped_1 redialonfail: " + n), 1 === a && n.indexOf("param platform") < 0 && !1 === webphone_api.global.redialhideevt && ("undefined" != typeof webphone_api.notifications && null !== webphone_api.notifications ? webphone_api.notifications.ProcessNotifications(n) : console && console.log && console.log("ERROR, common PutToDebugLog webphone_api.notifications is not defined")), a > webphone_api.global.loglevel) return;
            void 0 !== t && null !== t && (n = t + n), n = ReplaceAll(n, "EOFLINE", "\r\n");
            var l = GetLogTimeStamp();
            if (webphone_api.global.logs = webphone_api.global.logs + l + n + "&#10;", webphone_api.global.logs.length > 6e5) {
                var p = webphone_api.global.logs.substring(0, 1e4);
                webphone_api.global.logs = p + webphone_api.global.logs.substring(3e5)
            }
            try {
                if ("false" == webphone_api.parameters.logtoconsole || 0 == webphone_api.parameters.logtoconsole) return
            } catch (m) {
            }
            if (l = "webphone: " + l, webphone_api.global.deviceType > 0 || navigator.userAgent.toLowerCase().indexOf("firefox") > -1 || navigator.userAgent.toLowerCase().indexOf("chrome") > -1) if (n.indexOf("ERROR") > -1 && webphone_api.global.colorizelog > 0) try {
                console.error(l + n + " ")
            } catch (g) {
            } else if (n.length > 1e3) for (var c = 0; n.length > 0 && !(++c > 15);) {
                var u = n.length;
                u > 1e3 && (u = 1e3);
                var h = n.substring(0, u);
                n = n.substring(u), c > 1 && (l = "\t" + l);
                try {
                    h = ReplaceAll(h, "\r\n", "\r\n\t")
                } catch (d) {
                }
                try {
                    console.log(l + h + " ")
                } catch (b) {
                }
            } else if (n.length > 140 && n.length < 400 && (n.indexOf("http:") >= 0 || n.indexOf("https:") >= 0)) for (var c = 0; n.length > 0 && !(++c > 5);) {
                var u = n.length;
                u > 140 && (u = 140);
                var h = n.substring(0, u);
                n = n.substring(u), c > 1 && (l = "\t" + l);
                try {
                    h = ReplaceAll(h, "\r\n", "\r\n\t")
                } catch (d) {
                }
                try {
                    console.log(l + h + " ")
                } catch (b) {
                }
            } else try {
                console.log(l + n + " ")
            } catch (b) {
            } else if (n.length > 1e3) for (var c = 0; n.length > 0 && !(++c > 15);) {
                var u = n.length;
                u > 1e3 && (u = 1e3);
                var h = n.substring(0, u);
                n = n.substring(u), c > 1 && (l = "\t" + l);
                try {
                    h = ReplaceAll(h, "\r\n", "\r\n\t")
                } catch (_) {
                }
                try {
                    isNull(console) || isNull(console.log) || console.log(l + h + " ")
                } catch (f) {
                }
            } else if (n.length > 140 && n.length < 400 && (n.indexOf("http:") >= 0 || n.indexOf("https:") >= 0)) for (var c = 0; n.length > 0 && !(++c > 5);) {
                var u = n.length;
                u > 140 && (u = 140);
                var h = n.substring(0, u);
                n = n.substring(u), c > 1 && (l = "\t" + l);
                try {
                    h = ReplaceAll(h, "\r\n", "\r\n\t")
                } catch (_) {
                }
                try {
                    isNull(console) || isNull(console.log) || console.log(l + h + " ")
                } catch (f) {
                }
            } else try {
                isNull(console) || isNull(console.log) || console.log(l + n + " ")
            } catch (f) {
            }
        } catch (m) {
            alert(m)
        }
    }

    function PutToDebugLogSpecial(e, o, t, n) {
        function i(e) {
            try {
                return void 0 !== e && null != e && (e = e.toString(), !(null == (e = e.replace(/\s+/g, "")) || e.length < 1) && !isNaN(e))
            } catch (o) {
                alert("ERROR, common: IsNumberInner" + o)
            }
            return !1
        }

        try {
            if (splevel < 1) {
                splevel = webphone_api.global.loglevel;
                var a = StrToInt(GetParameter("loglevel"));
                !isNull(a) && i(a) && a > splevel && a < 1e3 && (splevel = a), a = webphone_api.parameters.loglevel, !isNull(a) && i(a) && a > splevel && a < 1e3 && (splevel = a)
            }
            if (splevel < 0 && (splevel = 2), !isNull(e) && i(e) && e > splevel) return;
            if (void 0 === o || null === o) return;
            t = void 0 !== t && null !== t && !1 !== t, void 0 !== n && null !== n || (n = "");
            var r = GetLogTimeStamp();
            webphone_api.global.logs = webphone_api.global.logs + r + o + " " + n + "&#10;";
            try {
                if ("false" == webphone_api.parameters.logtoconsole || 0 == webphone_api.parameters.logtoconsole) return
            } catch (s) {
            }
            if (o = "webphone: " + r + o + " " + n, !0 === t && webphone_api.global.colorizelog > 0) try {
                console.error(o)
            } catch (l) {
            } else try {
                console.log(o)
            } catch (l) {
            }
        } catch (s) {
            alert("PutToDebugLogSpecial" + s)
        }
    }

    function LogConfig() {
        function e(e) {
            try {
                return void 0 === e || null === e ? "" : (e = e.toLowerCase(), "undefined" == typeof o[e] || null === o[e] ? "" : o[e])
            } catch (t) {
            }
            return ""
        }

        try {
            PutToDebugLog(5, "built in Config parameters: ");
            var o = webphone_api.mwphonecfg.getAll(), t = e("loglevel");
            !isNull(t) && t.length > 0 && PutToDebugLog(5, "cfg_loglevel: " + t);
            var t = e("autotransportdetect");
            !isNull(t) && t.length > 0 && PutToDebugLog(5, "cfg_autotransportdetect: " + t);
            var t = e("cfgusetunneling");
            !isNull(t) && t.length > 0 && PutToDebugLog(5, "cfg_cfgusetunneling: " + t);
            var t = e("useencryption");
            !isNull(t) && t.length > 0 && PutToDebugLog(5, "cfg_useencryption: " + e("useencryption"));
            var t = e("upperserverfromuser");
            !isNull(t) && t.length > 0 && PutToDebugLog(5, "cfg_upperserverfromuser: " + t);
            var t = e("allowsimpleudpencrypt");
            !isNull(t) && t.length > 0 && PutToDebugLog(5, "cfg_allowsimpleudpencrypt: " + t);
            var t = e("cantryudpdirectep");
            !isNull(t) && t.length > 0 && PutToDebugLog(5, "cfg_cantryudpdirectep: " + t);
            var t = e("featureset");
            !isNull(t) && t.length > 0 && PutToDebugLog(5, "cfg_featureset: " + e("featureset"));
            var t = e("brandid");
            !isNull(t) && t.length > 0 && PutToDebugLog(5, "cfg_brandid: " + e("brandid"));
            var t = e("enabledirectcalls");
            !isNull(t) && t.length > 0 && PutToDebugLog(5, "cfg_enabledirectcalls: " + e("enabledirectcalls"));
            var t = e("enabledirectcallstolan");
            !isNull(t) && t.length > 0 && PutToDebugLog(5, "cfg_enabledirectcallstolan: " + e("enabledirectcallstolan"));
            var t = e("colortheme");
            !isNull(t) && t.length > 0 && PutToDebugLog(5, "cfg_colortheme: " + e("colortheme"));
            var t = e("actionbarhideicon");
            !isNull(t) && t.length > 0 && PutToDebugLog(5, "cfg_actionbarhideicon: " + e("actionbarhideicon"));
            var t = e("usemizuwebrtcgateway");
            !isNull(t) && t.length > 0 && PutToDebugLog(5, "cfg_usemizuwebrtcgateway: " + e("usemizuwebrtcgateway"));
            var t = e("deploydate");
            !isNull(t) && t.length > 0 && PutToDebugLog(5, "cfg_deploydate: " + e("deploydate"));
            var t = e("useg729");
            !isNull(t) && t.length > 0 && PutToDebugLog(5, "cfg_useg729: " + e("useg729"));
            var t = e("hidedomaininput");
            !isNull(t) && t.length > 0 && PutToDebugLog(5, "cfg_hidedomaininput: " + e("hidedomaininput"));
            var t = e("usestun");
            !isNull(t) && t.length > 0 && PutToDebugLog(5, "cfg_usestun: " + e("usestun"));
            var t = e("serveraddress");
            !isNull(t) && t.length > 0 && PutToDebugLog(5, "cfg_serveraddress: " + e("serveraddress"));
            var t = e("userport");
            !isNull(t) && t.length > 0 && PutToDebugLog(5, "cfg_userport: " + e("userport"));
            var t = e("voicemail");
            !isNull(t) && t.length > 0 && PutToDebugLog(5, "cfg_voicemail: " + e("voicemail"));
            var t = e("needapikey");
            !isNull(t) && t.length > 0 && PutToDebugLog(5, "cfg_needapikey: " + e("needapikey"));
            var t = e("firstdeploydate");
            !isNull(t) && t.length > 0 && PutToDebugLog(5, "cfg_firstdeploydate: " + e("firstdeploydate"));
            var t = e("lastdeploydate");
            !isNull(t) && t.length > 0 && PutToDebugLog(5, "cfg_lastdeploydate: " + e("lastdeploydate")), PutToDebugLog(5, "built in Config parameters: END")
        } catch (n) {
            alert("LogConfig: " + n)
        }
    }

    function LogWebphoneInfo(e, o, t) {
        try {
            var n = GetWebphoneInfo(e);
            if (!isNull(n) && n.length > 0 && (PutToDebugLog(3, n), PutToDebugLog(3, "Location: " + window.location.href + e)), isNull(o) || isNull(t) || PutToDebugLog(o, t), webphone_api.global.loglevel < 2 && "undefined" != typeof console && null !== console && "undefined" != typeof console.log && null !== console.log && !1 === basicinfologged) return "false" != webphone_api.parameters.logtoconsole && 0 != webphone_api.parameters.logtoconsole && (console.log(n), console.log("Location: " + window.location.href + e)), void (basicinfologged = !0);
            if (!isNull(webphone_api.parameters)) {
                PutToDebugLog(5, "webphone_api.parameters: ");
                for (var i in webphone_api.parameters) if (!isNull(i)) {
                    var a = webphone_api.parameters[i];
                    (!IsNumber(a) || i.indexOf("username") || i.indexOf("sipusername") >= 0) && (a = "'" + a + "'"), PutToDebugLog(5, i + ": " + a + ",")
                }
                PutToDebugLog(5, "webphone_api.parameters: END")
            }
        } catch (r) {
            alert("LogWebphoneInfo: " + r)
        }
    }

    function GetWebphoneInfo(e, o) {
        var t = "";
        try {
            isNull(e) && (e = ""), t = "About:", t += e, t = t + "Brand: " + GetBrandName() + " Version: " + GetVersionStr() + " (" + webphone_api.global.code_version + ")", !isNull(o) && o.length > 0 && (t = t + "Problem description: " + o + e);
            var n = webphone_api.platform.name, i = webphone_api.platform.version;
            (isNull(n) || "Android" === GetOs()) && (n = GetBrowser()), isNull(i) && (i = GetBrowserVersion());
            var a = "", r = new Date;
            if (!isNull(r)) {
                var s = r.getMonth() + 1;
                a = r.getFullYear() + "/" + s + "/" + r.getDate()
            }
            var l = IsWebphoneInIframe(), p = "; isiframe: " + l.toString();
            !0 === l && (p = e + p + "; iframeParentLocation: " + GetParentIframeUrl());
            var c = webphone_api.platform.os;
            (/iPad|iPhone|iPod/.test(navigator.platform) || "MacIntel" === navigator.platform && navigator.maxTouchPoints > 1) && !window.MSStream && (c = "iOS"), t = t + "; Build date: " + GetConfig("lastdeploydate"), t = t + "; OS: " + c + "; voipen: " + getuseengine() + "; date: " + a + p + e, t = t + "Browser: " + n + " " + i, t = t + "; Bengine: " + webphone_api.platform.layout, t = t + "; GetBrowser: " + GetBrowser() + "; Bver: " + GetBrowserVersion() + "; GetOs: " + GetOs();
            var u = "";
            if (webphone_api.global.phonestarttick > 0) {
                var h = Math.floor((GetTickCount() - webphone_api.global.phonestarttick) / 1e3), m = Math.floor(h / 60);
                h %= 60, h < 10 && (h = "0" + h), u = m + ":" + h
            }
            t = t + "; Uptime: " + u;
            var g = GetLogLevel();
            void 0 !== g && null !== g || (g = ""), g = g.toString(), t = t + "; loglevel: " + g;
            var d = !1;
            !0 === IsSDK() && (d = !0);
            try {
                t = t + "; Used as SDK: " + d.toString()
            } catch (b) {
            }
            return t
        } catch (_) {
            alert("GetWebphoneInfo: " + _)
        }
        return ""
    }

    function xml_to_string(e) {
        try {
            if (e.xml) return e.xml;
            if (XMLSerializer) {
                return (new XMLSerializer).serializeToString(e)
            }
            return ""
        } catch (o) {
            PutToDebugLogException(2, "common: xml_to_string", o)
        }
    }

    function PutToDebugLogException(e, o, t) {
        try {
            var n = "";
            if (isNull(o) || isNull(e)) return;
            void 0 === t || null === t ? PutToDebugLog(e, "ERROR, catch on " + o + " unknown exception") : ("undefined" != typeof t.message && null !== t.message && t.message.length > 0 && (n = n + " (" + t.message + ") "), "undefined" != typeof t.fileName && null !== t.fileName && t.fileName.length > 0 && (n = n + " class: " + t.fileName), "undefined" != typeof t.lineNumber && null !== t.lineNumber && t.fileName.lineNumber > 0 && (n = n + ": " + t.lineNumber), PutToDebugLog(e, "ERROR, catch on " + o + " " + t + n)), (!0 === webphone_api.global.usestorage || Strl(90)) && o.indexOf("There is an error in") >= 0 && ShowToast("ERROR, " + o + t + n, 8e3)
        } catch (i) {
        }
    }

    function PutToDebugLogWarning(e, o, t) {
        try {
            var n = "";
            if (isNull(o) || isNull(e)) return;
            void 0 === t || null === t ? PutToDebugLog(e, "WARNING, catch on " + o + " unknown exception") : ("undefined" != typeof t.message && null !== t.message && t.message.length > 0 && (n = n + " (" + t.message + ") "), "undefined" != typeof t.fileName && null !== t.fileName && t.fileName.length > 0 && (n = n + " class: " + t.fileName), "undefined" != typeof t.lineNumber && null !== t.lineNumber && t.fileName.lineNumber > 0 && (n = n + ": " + t.lineNumber), PutToDebugLog(e, "WARNING, catch on " + o + " " + t + n))
        } catch (i) {
        }
    }

    function ReplaceAll(e, o, t) {
        try {
            return isNull(e) || isNull(o) || isNull(t) ? (PutToDebugLogSpecial(2, "ERROR, common ReplaceAll null value", !0, ""), "") : (e = e.toString(), e.split(o).join(t))
        } catch (n) {
            PutToDebugLogSpecial(2, "ERROR, ReplaceAll: ", !0, n)
        }
        return ""
    }

    function Trim(e) {
        try {
            return isNull(e) || e.lenght < 1 ? "" : (e = e.toString(), e.replace(/^\s+|\s+$/g, ""))
        } catch (o) {
            PutToDebugLogSpecial(2, "ERROR, common: Trim", !0, o)
        }
        return e
    }

    function EscapeRegExp(e) {
        try {
            return isNull(e) || e.lenght < 1 ? (PutToDebugLog(3, "ERROR, common EscapeRegExp null value"), "") : e.replace(/[\-\[\]\/\{\}\(\)\*\+\?\.\\\^\$\|]/g, "\\$&")
        } catch (o) {
            PutToDebugLogException(2, "common: EscapeRegExp", o)
        }
        return ""
    }

    function IsNumber(e) {
        try {
            return void 0 !== e && null != e && (e = e.toString(), !(null == (e = e.replace(/\s+/g, "")) || e.length < 1) && !isNaN(e))
        } catch (o) {
            PutToDebugLogSpecial(2, "ERROR, common: IsNumber", !0, o)
        }
        return !1
    }

    function IsNumeric(e, o) {
        try {
            if (void 0 === e || null == e) return !1;
            e = e.toString(), e = e.replace(/\s+/g, "");
            var t = e.split("");
            if (isNull(t) || t.length < 1) return !1;
            var n = [];
            if (void 0 !== o && null !== o && o.length > 0) {
                n = o.split(","), void 0 !== n && null !== n || (n = []);
                for (var i = 0; i < n.length;) "undefined" == typeof n[i] || null === n[i] || 1 !== n[i].length ? n.splice(i, 1) : i++
            }
            if (void 0 !== n && null !== n || (n = []), n.length > 0) {
                for (var a = 0; a < t.length; a++) if ((t[a] < "0" || t[a] > "9") && n.indexOf(t[a]) < 0) return !1
            } else for (var a = 0; a < t.length; a++) if (t[a] < "0" || t[a] > "9") return !1;
            return !0
        } catch (r) {
            PutToDebugLogSpecial(2, "ERROR, common: IsNumeric", !0, r)
        }
        return !1
    }

    function StrToInt(e) {
        try {
            return isNull(e) || !IsNumber(e) ? null : (e = ReplaceAll(e, " ", ""), parseInt(e, 10))
        } catch (o) {
            PutToDebugLogException(2, "common: StrToInt", o)
        }
        return null
    }

    function StrToIntDef(e, o) {
        try {
            return isNull(e) || !IsNumber(e) ? o : (e = ReplaceAll(e, " ", ""), parseInt(e, 10))
        } catch (t) {
            PutToDebugLogException(2, "common: StrToIntDef", t)
        }
        return o
    }

    function StrToIntPx(e) {
        try {
            return isNull(e) ? 0 : (e = ReplaceAll(e, " ", ""), parseInt(e, 10))
        } catch (o) {
            PutToDebugLogException(2, "common: StrToIntPx", o)
        }
        return 0
    }

    function StrIsUpperCase(e) {
        try {
            if (isNull(e)) return !1;
            for (var o = !0, t = 0, n = 0; n < e.length; n++) if (t = e.charCodeAt(n), !(isNull(t) || t < 65 || t > 90 && t < 97 || t > 122)) {
                var i = e.charAt(n);
                if (i === i.toLowerCase()) {
                    o = !1;
                    break
                }
            }
            return o
        } catch (a) {
            PutToDebugLogException(2, "common: StrIsUpperCase", a)
        }
        return !1
    }

    function GetDeviceWidth() {
        try {
            return Math.floor(webphone_api.$("#phone_app_main_container").width())
        } catch (e) {
            PutToDebugLogException(2, "common: GetDeviceWidth", e)
        }
    }

    function GetDeviceHeight() {
        try {
            return Math.floor(webphone_api.$("#phone_app_main_container").height())
        } catch (e) {
            PutToDebugLogException(2, "common: GetDeviceHeight", e)
        }
    }

    function IsWindowsSoftphone() {
        try {
            if (!0 === isPlatformSet) return isWindows;
            var e = window.location.href;
            if (isNull(e) || e.length < 1) return isPlatformSet = !0, isWindows;
            if (e = Trim(e), e.indexOf("platform") > 0 && e.indexOf("windesktop") > 0) return isPlatformSet = !0, isWindows = !0
        } catch (o) {
            PutToDebugLogException(2, "common: IsWindowsSoftphone", o)
        }
        return isWindows
    }

    function DeviceType() {
        return webphone_api.global.deviceType
    }

    function DEVICE_WEBPHONE() {
        return CONST_DEVICE_WEBPHONE
    }

    function DEVICE_WIN_SOFTPHONE() {
        return CONST_DEVICE_WIN_SOFTPHONE
    }

    function DEVICE_ANDROID() {
        return CONST_DEVICE_ANDROID
    }

    function DEVICE_IPHONE() {
        return CONST_DEVICE_IPHONE
    }

    function DEVICE_BB() {
        return CONST_DEVICE_BB
    }

    function DEVICE_WP() {
        return CONST_DEVICE_WP
    }

    function isNull(e) {
        try {
            return void 0 === e || null === e
        } catch (o) {
            PutToDebugLogSpecial(2, "ERROR,common: isNull", !0, o)
        }
        return !0
    }

    function IsFunction(e) {
        try {
            if ("function" === Object.prototype.toString.call(e).slice(8, -1).toLowerCase()) return !0
        } catch (o) {
            PutToDebugLogSpecial(2, "ERROR,common: IsFunction", !0, o)
        }
        return !1
    }

    function getBgColor(e) {
        try {
            var o = "#000000";
            if (webphone_api.$(e).length > 0) {
                var t = webphone_api.$(e).css("background-color"), n = t.match(/^rgb\((\d+),\s*(\d+),\s*(\d+)\)$/);
                !isNull(n) && n.length > 0 && delete n[0];
                for (var i = 1; i <= 3; ++i) n[i] = parseInt(n[i]).toString(16), 1 == n[i].length && (n[i] = "0" + n[i]);
                o = "#" + n.join("")
            }
            return o
        } catch (a) {
            PutToDebugLogException(2, "common: getBgColor", a)
        }
        return "#000000"
    }

    function getElementColor(e) {
        try {
            var o = "#000000";
            if (webphone_api.$(e).length > 0) {
                var t = webphone_api.$(e).css("color"), n = t.match(/^rgb\((\d+),\s*(\d+),\s*(\d+)\)$/);
                delete n[0];
                for (var i = 1; i <= 3; ++i) n[i] = parseInt(n[i]).toString(16), 1 == n[i].length && (n[i] = "0" + n[i]);
                o = "#" + n.join("")
            }
            return o
        } catch (a) {
            PutToDebugLogException(2, "common: getElementColor", a)
        }
        return "#000000"
    }

    function AlertDialog(e, o, t, n) {
        try {
            if (isNull(o) && (o = ""), isNull(e) && (e = ""), o = o.replace("[BRAND]", GetBrandName()), !isNull(webphone_api.displaycb) || "function" == typeof webphone_api.displaycb) try {
                webphone_api.onDisplayCb(o, e)
            } catch (a) {
                PutToDebugLogException(2, "There is an error in ondisplay() callback 1", a)
            }
            try {
                webphone_api.onEventCb("display", e + "," + o, e)
            } catch (a) {
                PutToDebugLogException(2, "There is an error in onEvent() callback 5", a)
            }
            if (!1 === GetParameterBool("showtoasts", !0)) return void t();
            var i = o;
            i === webphone_api.stringres.get("app_en_warning") && (i = webphone_api.stringres.get("app_en_warning_short")), PutToDebugLog(1, "EVENT," + i), !0 === IsSDK() ? setTimeout(function () {
                try {
                    AlertDialogSDK(e, o, t)
                } catch (a) {
                    PutToDebugLogException(2, "common: AlertDialog - SDK", a)
                }
            }, 100) : setTimeout(function () {
                try {
                    AlertDialogDelayed(e, o, t, n)
                } catch (a) {
                    PutToDebugLogException(2, "common: AlertDialog - Delayed", a)
                }
            }, 100)
        } catch (a) {
            PutToDebugLogException(2, "common: AlertDialog", a)
        }
    }

    function AlertDialogDelayed(e, o, t, n) {
        try {
            t = t || function () {
            };
            var i = GetDeviceWidth();
            i = !isNull(i) && IsNumber(i) && i > 100 ? Math.floor(i / 1.2) : 220, isNull(n) && (n = webphone_api.stringres.get("btn_close"));
            var a = '<div data-role="popup" class="ui-content messagePopup" data-overlay-theme="a" data-theme="a" style="max-width:' + i + 'px;"><div data-role="header" data-theme="b"><a href="javascript:;" data-role="button" data-icon="delete" data-iconpos="notext" class="ui-btn-right closePopup">Close</a><h1 class="adialog_title">' + e + '</h1></div><div role="main" class="ui-content adialog_content adialog_alert"><span style="-ms-user-select: text; -moz-user-select: text; -khtml-user-select: text; -webkit-user-select: text;  user-select: text;"> ' + o + ' </span></div><div data-role="footer" data-theme="b" class="adialog_footer"><a href="javascript:;" id="btn_adialog_alert_ok" style="width: 98%;" class="ui-btn ui-corner-all ui-shadow ui-btn-inline ui-btn-b adialog_2button" data-rel="back" data-transition="flow">' + n + "</a></div></div>";
            webphone_api.$.mobile.activePage.append(a).trigger("create"), webphone_api.$.mobile.activePage.find(".closePopup").bind("tap", function (e) {
                webphone_api.$.mobile.activePage.find(".messagePopup").popup("close")
            }), webphone_api.$.mobile.activePage.find(".messagePopup").bind({
                popupbeforeposition: function () {
                    webphone_api.$(this).unbind("popupbeforeposition");
                    var e = Math.floor(.6 * GetDeviceHeight());
                    webphone_api.$(this).height() > e + 100 && webphone_api.$(".messagePopup .ui-content").height(e)
                }
            }), webphone_api.$.mobile.activePage.find(".messagePopup").popup().popup("open").bind({
                popupafterclose: function () {
                    webphone_api.$(this).unbind("popupafterclose").remove(), webphone_api.$("#btn_adialog_alert_ok").off("click"), t(!1)
                }
            }), webphone_api.$("#btn_adialog_alert_ok").on("click", function () {
                t && "function" == typeof t && (t(!0), t = function () {
                })
            })
        } catch (r) {
            PutToDebugLogException(2, "common: AlertDialog", r)
        }
    }

    function ShowToast(e, o, t) {
        try {
            (isNull(o) || !IsNumber(o) && e.length > 75) && (o = e.length - 75, o = 3e3 + o), setTimeout(function () {
                ShowToastDelayed(e, o, t)
            }, 100)
        } catch (n) {
            PutToDebugLogSpecial(2, "common: ShowToastF", !0, n)
        }
    }

    function ShowToastDelayed(e, o, t) {
        try {
            if (t = t || function () {
            }, !isNull(webphone_api.displaycb) || "function" == typeof webphone_api.displaycb) try {
                webphone_api.onDisplayCb(e, "")
            } catch (a) {
                PutToDebugLogException(2, "There is an error in ondisplay() callback 2", a)
            }
            try {
                webphone_api.onEventCb("display", "," + e, null)
            } catch (a) {
                PutToDebugLogException(2, "There is an error in onEvent() callback 6", a)
            }
            if (!1 === GetParameterBool("showtoasts", !0)) return void t();
            if (!0 === IsSDK()) return void ShowToastSDK(e, o);
            if (!isNull(e) && !0 === webphone_api.global.isSettingsStarted && e.toLowerCase().indexOf("register") >= 0 && e.toLowerCase().indexOf("failed") > 0) return;
            var n = GetDeviceWidth();
            n = !isNull(n) && IsNumber(n) && n > 100 ? Math.floor(n / 1.2) : 220;
            var i = '<div data-role="popup" style="padding: .5em;" class="ui-content toastPopup" data-overlay-theme="b" data-transition="fade" data-theme="a" style="max-width:' + n + 'px"><span> ' + e + " </span></div>";
            webphone_api.$.mobile.activePage.append(i).trigger("create"), webphone_api.$.mobile.activePage.find(".closePopup").bind("tap", function (e) {
                webphone_api.$.mobile.activePage.find(".toastPopup").popup("close")
            }), webphone_api.$.mobile.activePage.find(".toastPopup").popup().popup("open").bind({
                popupafterclose: function () {
                    webphone_api.$(this).unbind("popupafterclose").remove(), t()
                }
            }), isNull(o) && (o = 3e3), o > 0 && setTimeout(function () {
                webphone_api.$.mobile.activePage.find(".toastPopup").popup("close")
            }, o)
        } catch (a) {
            PutToDebugLogSpecial(2, "common: ShowToast", !0, a)
        }
    }

    function UsePresence2() {
        try {
            if (!1 === Glpr()) return !1;
            var e = 0, o = GetParameterInt("enablepresence", 0), t = GetParameterInt("enablepresence2", 0);
            if (IsNumber(o) && StrToInt(o) > 0 && (e = StrToInt(o)), IsNumber(t) && StrToInt(t) > 0 && (e = StrToInt(t)), isNull(enablepres_httpapi) && (enablepres_httpapi = GetParameterInt("enablepres_httpapi", 1), enablepres_javaapi = GetParameterInt("enablepres_javaapi", 1), enablepres_webrtc = GetParameterInt("enablepres_webrtc", 1)), e < 1) return !1;
            if (e > 1) return !0;
            if (1 === e) {
                if (!1 === webphone_api.global.usestorage && !1 === Strl(90)) return !1;
                if (enablepres_httpapi < 1 && enablepres_javaapi < 1 && enablepres_webrtc < 1) return !1 === errmsgdisp && (PutToDebugLog(2, "ERROR, common Presence disabled_1"), errmsgdisp = !0), !1;
                if (getuseengine() === webphone_api.global.ENGINE_WEBRTC && enablepres_webrtc < 1 && enablepres_httpapi < 1) return !1 === errmsgdisp && (PutToDebugLog(2, "ERROR, common Presence disabled_2"), errmsgdisp = !0), !1;
                if ((!0 === IsWindowsSoftphone() || getuseengine() === webphone_api.global.ENGINE_WEBPHONE || getuseengine() === webphone_api.global.ENGINE_SERVICE) && enablepres_javaapi < 1 && enablepres_httpapi < 1) return !1 === errmsgdisp && (PutToDebugLog(2, "ERROR, common Presence disabled_3"), errmsgdisp = !0), !1;
                if (getuseengine() === webphone_api.global.ENGINE_WEBRTC && enablepres_webrtc < 1 && enablepres_httpapi > 0) {
                    if (GetHttpAPIKey().length < 1) return !1 === errmsgdisp && (PutToDebugLog(2, "ERROR, common Presence disabled_4"), errmsgdisp = !0), !1
                } else if (enablepres_httpapi > 0 && enablepres_javaapi < 1 && enablepres_webrtc < 1) {
                    if (!1 === GetConfigBool("usingmizuserver", !1) && GetConfigInt("cfgusetunneling", 0) < 1 && !1 === GetConfigBool("useencryption", !1) && !1 === IsMizuWebRTCGateway()) return !1 === errmsgdisp && (PutToDebugLog(2, "ERROR, common Presence disabled_5"), errmsgdisp = !0), !1
                } else {
                    if (getuseengine() === webphone_api.global.ENGINE_WEBRTC && webphone_api.global.recwsload > 1) return !1 === errmsgdisp && (PutToDebugLog(2, "ERROR, common Presence disabled_6 high webrtc load"), errmsgdisp = !0), !1;
                    if (!0 === IsSDK() && (!0 === IsMizuWebRTCGateway() || !0 === IsMizuWebRTCEmbeddedServer() || !0 === IsMizuServer())) return !1
                }
                return !0
            }
        } catch (n) {
            PutToDebugLogException(2, "common: UsePresence2", n)
        }
        return !1
    }

    function GetPresenceServer2() {
        try {
            if (!UsePresence2()) return "";
            var e = -1, o = GetParameter("mainaport"), t = GetParameter("mainaporttls"), n = "";
            if (!0 === IsMizuWebRTCEmbeddedServer()) {
                var i = GetWebrtcSrvAddr();
                !isNull(i) && i.length > 0 && (i = NormalizeInput(i, 0), e = i.indexOf("/"), e > 0 && (i = i.substring(0, e)), e = i.indexOf(":"), e > 0 && (i = i.substring(e + 1)), !isNull(i) && IsNumber(i) && (n = i))
            }
            if (!0 === GetConfigBool("usingmizuserver", !1)) {
                var a = GetParameter2("serveraddress_user");
                return (isNull(a) || a.length < 2) && (a = GetParameter2("serveraddress")), (IsIPAddrress(a) || !1 === IsHttps()) && o.length > 0 ? (e = a.indexOf(":"), e > 0 && (a = a.substring(0, e)), a = "http://" + a + ":" + o) : ((isNull(n) || n.length < 1) && (n = t), !isNull(n) && n.length > 0 && (e = a.indexOf(":"), e > 0 && (a = a.substring(0, e)), a = "https://" + a + ":" + n)), a
            }
            if (GetConfigInt("cfgusetunneling", 0) > 0 && !0 === GetConfigBool("useencryption", !1)) {
                var a = GetParameter2("tunnelserveraddress");
                return (IsIPAddrress(a) || !1 === IsHttps()) && o.length > 0 ? (e = a.indexOf(":"), e > 0 && (a = a.substring(0, e)), a = "http://" + a + ":" + o) : ((isNull(n) || n.length < 1) && (n = t), !isNull(n) && n.length > 0 && (e = a.indexOf(":"), e > 0 && (a = a.substring(0, e)), a = "https://" + a + ":" + n)), a
            }
            if (getuseengine() !== webphone_api.global.ENGINE_WEBRTC && getuseengine() !== webphone_api.global.ENGINE_FLASH && (a = GetServerForHttpReq(), !isNull(a) && a.length > 0)) return a;
            var r = 0, s = GetParameterInt("enablepresence", 0), l = GetParameterInt("enablepresence2", 0);
            if (IsNumber(s) && StrToInt(s) > 0 && (r = StrToInt(s)), IsNumber(l) && StrToInt(l) > 0 && (r = StrToInt(l)), !0 === IsMizuWebRTCGateway() || 2 === r) {
                var p = "";
                return p = !0 === PreferWss() || !0 === IsHttps() ? StrDc(wips_uk, alsvkey) : StrDc(wip_uk, alsvkey), p = NormalizeInput(p, 0), e = p.indexOf("/"), e > 0 && (p = p.substring(0, e)), p = Trim(p), p = !0 === PreferWss() || !0 === IsHttps() ? "https://" + p : "http://" + p
            }
        } catch (c) {
            PutToDebugLogException(2, "common: GetPresenceServer2", c)
        }
        return ""
    }

    function PresenceVerifyuser2(e) {
        try {
            if (isNull(e) || e.length < 1) return;
            var o = "http://";
            IsHttps() && (o = "https://");
            var t = GetPresenceServer2();
            if (t.indexOf("://") > 0 && (o = ""), isNull(t) || t.length < 2) return void PutToDebugLog(3, "ERROR, PresenceVerifyuser2 invalid server");
            var n = GetHttpAPIKey();
            GetWebrtcSrvAddr().indexOf("rtc.mizu-voip.com:2443") >= 0 && (n = "1568108399");
            UriParser(o + t + "/?apientry=verifyuser&authkey=" + n + "&authid=USERNAME&authmd5=MD5VALUE&authsalt=MD5SALT&userlist=" + e, "", "", "", "", "presence_verify")
        } catch (i) {
            PutToDebugLogException(2, "common: PresenceVerifyuser2", i)
        }
    }

    function PresenceGet2(e) {
        try {
            if (isNull(e) || e.length < 1) return;
            if (e = e.replace(" ", ""), isNull(pgstart_timer) || clearTimeout(pgstart_timer), pgstart_timer = null, (getuseengine().length < 1 || webphone_api.global.phonestarted < 3) && pgmaxloop < 120) return pgmaxloop++, void (pgstart_timer = setTimeout(function () {
                PresenceGet2(e)
            }, 1e3));
            pgmaxloop = 0;
            var o = "", t = GetHttpAPIKey();
            if (GetPresenceServer2().indexOf("rtc.mizu-voip.com:2443") >= 0 && (t = "1568108399"), !0 === GetConfigBool("usingmizuserver", !1) || GetConfigInt("cfgusetunneling", 0) > 0 && !0 === GetConfigBool("useencryption", !1) || IsMizuWebRTCGateway()) {
                var n = "http://";
                IsHttps() && (n = "https://");
                var i = GetPresenceServer2();
                if (i.indexOf("://") > 0 && (n = ""), !isNull(i) && i.length > 2) {
                    var a = "1";
                    !0 === first_presence_req && (a = "0", first_presence_req = !1);
                    var r = "";
                    GetParameter("upperserver").length > 0 && (r = GetParameter("upperserver")), o = n + i + "/mvapireq/?apientry=presence_get&authkey=" + t + "&authid=USERNAME&authmd5=MD5VALUE&authsalt=MD5SALT&ptype=" + a + "&domain=" + r + "&userlist=" + e
                }
            }
            !isNull(enablepres_httpapi) && enablepres_httpapi > 0 && o.length > 0 && UriParser(o, "", "", "", "", "presence_get"), !isNull(enablepres_webrtc) && enablepres_webrtc > 0 && getuseengine() === webphone_api.global.ENGINE_WEBRTC && webphone_api.webrtcapi.PresenceGet(e), !isNull(enablepres_javaapi) && enablepres_javaapi > 0 && (GetParameter("devicetype") === DEVICE_WIN_SOFTPHONE() || getuseengine() === webphone_api.global.ENGINE_SERVICE ? WinAPI("API_CheckPresence", null, e) : getuseengine() === webphone_api.global.ENGINE_WEBPHONE && webphone_api.webphone.CheckPresence(e))
        } catch (s) {
            PutToDebugLogException(2, "common: PresenceGet2", s)
        }
    }

    function PresenceSet2() {
        try {
            var e = "", o = GetParameter("presencestatus");
            if (!0 === GetConfigBool("usingmizuserver", !1) || GetConfigInt("cfgusetunneling", 0) > 0 && !0 === GetConfigBool("useencryption", !1)) {
                var t = "http://";
                IsHttps() && (t = "https://");
                var n = GetPresenceServer2();
                n.indexOf("://") > 0 && (t = "");
                var i = GetHttpAPIKey();
                GetWebrtcSrvAddr().indexOf("rtc.mizu-voip.com:2443") >= 0 && (i = "1568108399"), !isNull(n) && n.length > 2 && (e = t + n + "/mvapireq/?apientry=presence_set&authkey=" + i + "&authid=USERNAME&authmd5=MD5VALUE&authsalt=MD5SALT&pstatus=" + o)
            }
            !isNull(enablepres_httpapi) && enablepres_httpapi > 0 && e.length > 0 && UriParser(e, "", "", "", "", "presence_set"), !isNull(enablepres_webrtc) && enablepres_webrtc > 0 && getuseengine() === webphone_api.global.ENGINE_WEBRTC && webphone_api.webrtcapi.PresenceSet(o), !isNull(enablepres_javaapi) && enablepres_javaapi > 0 && (GetParameter("devicetype") === DEVICE_WIN_SOFTPHONE() || getuseengine() === webphone_api.global.ENGINE_SERVICE ? WinAPI("API_SetPresenceStatus", null, o) : getuseengine() === webphone_api.global.ENGINE_WEBPHONE && webphone_api.webphone.SetPresenceStatus(o))
        } catch (a) {
            PutToDebugLogException(2, "common: PresenceSet2", a)
        }
    }

    function SaveReceivedPresence2(e, o) {
        try {
            if (isNull(e) || e.length < 1) return void PutToDebugLog(3, "ERROR, SaveReceivedPresence2 number is NULL: " + e);
            if (isNull(o) || o.length < 1) return void PutToDebugLog(3, "ERROR, SaveReceivedPresence2 status is NULL: " + o);
            e = Trim(e), e = e.toLowerCase(), o = Trim(o), o = o.toLowerCase(), "notexists" === o && (o = "not exists");
            var t = !1, n = "-1";
            if ("open" === o || "online" === o || "reachable" === o || "available" === o || "call me" === o || "registered" === o) n = "5", webphone_api.common.UpdateContactLastActive(e), t = !0; else if ("dnd" === o || "busy" === o || "speaking" === o) n = "4", t = !0; else if ("pending" === o || "forwarding" === o) n = "3", t = !0; else if ("away" === o || "idle" === o) n = "2", t = !0; else if ("invisible" === o) n = "1", t = !0; else if ("closed" === o || "close" === o || "unreachable" === o || "offline" === o || "unregistered" === o) n = "0", t = !0; else {
                if ("unknown" !== o && "not set" !== o && "not exists" !== o) return "-2";
                n = "-1", t = !0
            }
            var i = GetTickCount().toString();
            if (webphone_api.global.presenceHM[e] = [], webphone_api.global.presenceHM[e][PRES_STATUS] = n, webphone_api.global.presenceHM[e][PRES_TIME] = i, !1 === t && PutToDebugLog(3, "ERROR, SaveReceivedPresence2 invalid status: " + o), !isNull(webphone_api.global.checkpres_callback) && webphone_api.global.checkpres_callback.length > 0) {
                var a = webphone_api.global.checkpres_callback.pop();
                a && "function" == typeof a && a(e, o)
            }
            return n
        } catch (r) {
            PutToDebugLogException(2, "common: SaveReceivedPresence2", r)
        }
        return "-1"
    }

    function StartPresence2() {
        try {
            if (!UsePresence2()) return;
            if (!0 === webphone_api.global.presence_started) return;
            if (isNull(startpres_timer) || clearTimeout(startpres_timer), startpres_timer = null, (getuseengine().length < 1 || webphone_api.global.phonestarted < 3) && spmaxloop < 120) return spmaxloop++, void (startpres_timer = setTimeout(function () {
                StartPresence2()
            }, 1e3));
            spmaxloop = 0, webphone_api.global.presence_started = !0, PutToDebugLog(2, "EVENT, common StartPresence2");
            var e = GetParameterInt("verifyuser", 0), o = GetAllContactsNumbersSipuris();
            isNull(o) && (o = ""), o.length > 0 && (o = ReplaceAll(o, " ", ""), o = ReplaceAll(o, "-", ""), o = ReplaceAll(o, "(", ""), o = ReplaceAll(o, ")", "")), o.length > 0 && (GetParameter("devicetype") !== DEVICE_WIN_SOFTPHONE() && getuseengine() !== webphone_api.global.ENGINE_SERVICE || WinAPI("API_PushContactlist", null, o), getuseengine() === webphone_api.global.ENGINE_WEBPHONE && webphone_api.webphone.PushContactlist(o)), webphone_api.global.isdebugversion || e < 1 || GetTickCount() - e > 2592e6 ? (PutToDebugLog(2, "EVENT, common StartPresence2 verifyuser"), PresenceVerifyuser2(o), SaveParameter("verifyuser", GetTickCount())) : PresenceGet2(GetParameter("srvcontacts"))
        } catch (t) {
            PutToDebugLogException(2, "common: StartPresence2", t)
        }
    }

    function PresenceProcessUserlist2(e, o) {
        try {
            if (isNull(e) || e.length < 1) return;
            if (e = e.toString(), e.toLowerCase().indexOf("error") >= 0 || e.toLowerCase().indexOf("auserlist:") < 0 && e.toLowerCase().indexOf("puserlist:") < 0) return void PutToDebugLog(2, "ERROR, PresenceProcessUserlist2: " + e);
            var t = e;
            !isNull(t) && t.length > 500 && (t = t.substring(0, 500)),
                PutToDebugLog(4, "EVENT, PresenceProcessUserlist2: " + t);
            var n = e.indexOf("auserlist:");
            n < 1 && (n = e.indexOf("puserlist:")), n > 0 && (e = Trim(e.substring(n + 10, e.length)));
            var i = e.split(",");
            if (isNull(i) || i.length < 1) return;
            var a = GetParameter("srvcontacts"), r = a.split(",");
            isNull(r) && (r = []);
            for (var s = 0; s < i.length; s++) {
                var l = i[s];
                if (!(isNull(l) || l.length < 1 || l.indexOf(":") < 0)) {
                    var p = Trim(l.substring(0, l.indexOf(":"))), c = Trim(l.substring(l.indexOf(":") + 1));
                    c = c.toLowerCase();
                    var u = SaveReceivedPresence2(p, c);
                    webphone_api._dialpad.PopulateListRecents(), !0 === webphone_api.global.isContactdetailsStarted && webphone_api._contactdetails.PopulateData(), !0 === webphone_api.global.isMessageStarted && webphone_api._message.DisplayPresence(u);
                    for (var h = !0, m = 0; m < r.length; m++) if (!isNull(r[m]) && r[m] === p) {
                        h = !1;
                        break
                    }
                    h && r.push(p)
                }
            }
            var g = "";
            if (!isNull(r) && r.length > 0) for (var s = 0; s < r.length; s++) isNull(r[s]) || Trim(r[s]).length < 1 || (g.length > 0 && (g += ","), g += r[s]);
            SaveParameter("srvcontacts", g), webphone_api.global.waitforpresence = 0
        } catch (d) {
            PutToDebugLogException(2, "common: PresenceProcessUserlist2", d)
        }
    }

    function PresenceSelector(e, o) {
        try {
            var t = GetDeviceWidth();
            t = !isNull(t) && IsNumber(t) && t > 100 ? Math.floor(t / 1.2) : 220, PutToDebugLog(2, "EVENT, PresenceSelector called from: " + e);
            var n = GetParameter("presencestatus");
            (isNull(n) || n.length < 1) && (n = "Online", SaveParameter("presencestatus", n));
            var i = "", a = "", r = "", s = "", l = "";
            "Online" === n ? i = 'checked="checked"' : "Away" === n ? a = 'checked="checked"' : "DND" === n ? r = 'checked="checked"' : "Invisible" === n ? s = 'checked="checked"' : "Offline" === n && (l = 'checked="checked"');
            var p = '<form><fieldset data-role="controlgroup"><input name="presence_sel" id="radio_online" value="on" ' + i + ' type="radio"><label for="radio_online">' + webphone_api.stringres.get("presence_stat_online") + '</label><input name="presence_sel" id="radio_away" value="on" ' + a + ' type="radio"><label for="radio_away">' + webphone_api.stringres.get("presence_stat_away") + '</label><input name="presence_sel" id="radio_dnd" value="on" ' + r + ' type="radio"><label for="radio_dnd">' + webphone_api.stringres.get("presence_stat_dnd") + '</label><input name="presence_sel" id="radio_invisible" value="on" ' + s + ' type="radio"><label for="radio_invisible">' + webphone_api.stringres.get("presence_stat_invisible") + '</label><input name="presence_sel" id="radio_offline" value="on" ' + l + ' type="radio"><label for="radio_offline">' + webphone_api.stringres.get("presence_stat_offline") + "</label></fieldset></form>",
                c = '<div data-role="popup" class="ui-content messagePopup" data-overlay-theme="a" data-theme="a" style="max-width:' + t + "px; min-width: " + Math.floor(.6 * t) + 'px;"><div data-role="header" data-theme="b"><a href="javascript:;" data-role="button" data-icon="delete" data-iconpos="notext" class="ui-btn-right closePopup">Close</a><h1 class="adialog_title">' + webphone_api.stringres.get("presence_title") + '</h1></div><div role="main" class="ui-content">' + p + "</div></div>";
            o = o || function () {
            }, webphone_api.$.mobile.activePage.append(c).trigger("create"), webphone_api.$.mobile.activePage.find(".closePopup").bind("tap", function (e) {
                webphone_api.$.mobile.activePage.find(".messagePopup").popup("close")
            }), webphone_api.$.mobile.activePage.find(".messagePopup").popup().popup("open").bind({
                popupafterclose: function () {
                    webphone_api.$(this).unbind("popupafterclose").remove(), o()
                }
            }), webphone_api.$(":radio").on("change", function (e) {
                webphone_api.$.mobile.activePage.find(".messagePopup").popup("close");
                var o = webphone_api.$(this).attr("id");
                if (!(isNull(o) || o.length < 1)) {
                    var t = o.indexOf("_");
                    t > 0 && t < o.length && (o = o.substring(t + 1)), PutToDebugLog(2, "EVENT, PresenceSelector USER selected: " + o), SetSelectedPresence(o)
                }
            })
        } catch (u) {
            PutToDebugLogException(2, "common: PresenceSelector", u)
        }
    }

    function SetSelectedPresence(e, o) {
        try {
            (isNull(e) || e.length < 1) && (e = GetParameter("presencestatus"), PutToDebugLog(2, "WARNING, SetSelectedPresence invalid status: " + e)), PutToDebugLog(3, "EVENT, SetSelectedPresence status: " + e + "; allow unregister: " + o), e = Trim(e.toLowerCase());
            var t = '<img src="' + GetElementSource() + 'images/presence_green.png" />';
            "offline" === e ? (t = '<img src="' + GetElementSource() + 'images/presence_grey.png" />', SaveParameter("presencestatus", "Offline"), !1 !== o && webphone_api.global.phonestarted > 2 && (webphone_api.global.pres_unreg_called = !0, PutToDebugLog(2, "EVENT, mlogic API_Unregister SetSelectedPresence Offline"), webphone_api.unregister())) : "invisible" === e ? (t = '<img src="' + GetElementSource() + 'images/presence_white.png" />', SaveParameter("presencestatus", "Invisible"), !0 === webphone_api.global.pres_unreg_called && webphone_api.global.phonestarted < 3 && !0 === NeedRegister() && (webphone_api.global.pres_unreg_called = !1, PutToDebugLog(2, "EVENT, mlogic API_Register SetSelectedPresence invisible"), webphone_api.register())) : "away" === e ? (t = '<img src="' + GetElementSource() + 'images/presence_yellow.png" />', SaveParameter("presencestatus", "Away"), !0 === webphone_api.global.pres_unreg_called && webphone_api.global.phonestarted < 3 && !0 === NeedRegister() && (webphone_api.global.pres_unreg_called = !1, PutToDebugLog(2, "EVENT, mlogic API_Register SetSelectedPresence away"), webphone_api.register())) : "dnd" === e ? (t = '<img src="' + GetElementSource() + 'images/presence_red.png" />', SaveParameter("presencestatus", "DND"), !0 === webphone_api.global.pres_unreg_called && webphone_api.global.phonestarted < 3 && !0 === NeedRegister() && (webphone_api.global.pres_unreg_called = !1, PutToDebugLog(2, "EVENT, mlogic API_Register SetSelectedPresence dnd"), webphone_api.register())) : "online" === e && (t = '<img src="' + GetElementSource() + 'images/presence_green.png" />', SaveParameter("presencestatus", "Online"), !0 === webphone_api.global.pres_unreg_called && webphone_api.global.phonestarted < 3 && !0 === NeedRegister() && (PutToDebugLog(2, "EVENT, mlogic API_Register SetSelectedPresence online"), webphone_api.register(), webphone_api.global.pres_unreg_called = !1));
            var n = document.getElementById("dialpad_presence"), i = document.getElementById("contactslist_presence"),
                a = document.getElementById("callhistorylist_presence");
            isNull(n) || (n.innerHTML = t, setTimeout(function () {
                "undefined" != typeof webphone_api._dialpad && null !== webphone_api._dialpad && webphone_api._dialpad.MeasureDialPad()
            }, 10)), isNull(i) || (i.innerHTML = t, setTimeout(function () {
                "undefined" != typeof webphone_api._contactslist && null !== webphone_api._contactslist && webphone_api._contactslist.MeasureContacslist()
            }, 10)), isNull(a) || (a.innerHTML = t, setTimeout(function () {
                "undefined" != typeof webphone_api._callhistorylist && null !== webphone_api._callhistorylist && webphone_api._callhistorylist.MeasureCallhistorylist()
            }, 10)), webphone_api.global.phonestarted > 2 && PresenceSet2()
        } catch (r) {
            PutToDebugLogException(2, "common: SetSelectedPresence", r)
        }
    }

    function HelpWindow(e, o) {
        try {
            if (60 === GetConfigInt("brandid", -1)) return void AboutWindow();
            var t = GetDeviceWidth();
            t = !isNull(t) && IsNumber(t) && t > 100 ? Math.floor(t / 1.2) : 220;
            var n = "", i = '<li id="[ITEMID]"><a data-rel="back">[ITEMTITLE]</a></li>',
                a = ReplaceAll(webphone_api.stringres.get("help_text"), "[BRANDNAME]", GetBrandName()),
                r = GetBrandName();
            "cryptphone" !== r.toLowerCase() && r.toLowerCase().indexOf("mizu") < 0 && (a = ReplaceAll(webphone_api.stringres.get("help_text_custom"), "[BRANDNAME]", GetBrandName())), 2 === GetParameterInt("brandid", -1) && (a = ReplaceAll('Contact GMSDIALER support:<br /><br /><a href="mailto:support@gmstechuk.com">support@gmstechuk.com</a>', "[BRANDNAME]", GetBrandName()));
            var s = "";
            !0 !== GetParameterBool("customizedversion", !0) && !0 === webphone_api.global.usestorage && (s = '<li id="#item_help"><a href="http://www.mizu-voip.com/Portals/0/Files/Webphone_Documentation.pdf" target="_blank">[ITEMTITLE]</a></li>', s = s.replace("[ITEMTITLE]", GetBrandName() + " " + webphone_api.stringres.get("help_help")), n += s, s = "");
            var l = GetParameter2("webcallme");
            !1 !== IsWindowsSoftphone() || isNull(l) || 1 !== l.length || "0" === l || (s = i.replace("[ITEMID]", "#item_webcallme"), s = s.replace("[ITEMTITLE]", webphone_api.stringres.get("menu_webcallme")), n += s, s = ""), 1 === GetLogLevel() ? (s = i.replace("[ITEMID]", "#item_enablelog"), s = s.replace("[ITEMTITLE]", webphone_api.stringres.get("help_enablelog")), n += s, s = "") : (s = i.replace("[ITEMID]", "#item_logwindow"), s = s.replace("[ITEMTITLE]", webphone_api.stringres.get("help_logwindow")), n += s, s = ""), s = i.replace("[ITEMID]", "#item_reconnect"), s = s.replace("[ITEMTITLE]", webphone_api.stringres.get("menu_reconnect")), n += s, s = "";
            webphone_api.global.usestorage && (s = i.replace("[ITEMID]", "#item_upgrade"), s = s.replace("[ITEMTITLE]", webphone_api.stringres.get("btn_upgrade")), n += s, s = ""), s = i.replace("[ITEMID]", "#item_about"), s = s.replace("[ITEMTITLE]", webphone_api.stringres.get("help_about")), n += s, s = "";
            var p = '<div id="help_window" data-role="popup" class="ui-content messagePopup" data-overlay-theme="a" data-theme="a" style="max-width:' + t + "px; min-width: " + Math.floor(.6 * t) + 'px;"><div data-role="header" data-theme="b"><a href="javascript:;" data-role="button" data-icon="delete" data-iconpos="notext" class="ui-btn-right closePopup">Close</a><h1 class="adialog_title">' + webphone_api.stringres.get("menu_help") + '</h1></div><div role="main" class="ui-content adialog_content" style="padding: 0; margin: 0;"><ul id="help_window_ul" data-role="listview" data-inset="true" data-icon="false" style="margin: 0;">' + n + '</ul></div><div data-role="footer" data-theme="b" class="adialog_footer"><a href="javascript:;" style="width: 98%;" class="ui-btn ui-corner-all ui-shadow ui-btn-inline ui-btn-b adialog_2button" data-rel="back" data-transition="flow">' + webphone_api.stringres.get("btn_close") + "</a></div></div>";
            o = o || function () {
            }, webphone_api.$.mobile.activePage.append(p).trigger("create"), webphone_api.$.mobile.activePage.find(".closePopup").bind("tap", function (e) {
                webphone_api.$.mobile.activePage.find(".messagePopup").popup("close")
            }), webphone_api.$.mobile.activePage.find(".messagePopup").popup().popup("open").bind({
                popupafterclose: function () {
                    webphone_api.$(this).unbind("popupafterclose").remove(), webphone_api.$("#help_window_ul").off("click", "li"), o()
                }
            }), webphone_api.$("#help_window_ul").on("click", "li", function (e) {
                var o = webphone_api.$(this).attr("id");
                "#item_help" === o && (webphone_api.$("#help_window").popup("close"), AlertDialog(GetBrandName() + " " + webphone_api.stringres.get("help_help"), a)), webphone_api.$("#help_window").on("popupafterclose", function (e) {
                    if (webphone_api.$("#help_window").off("popupafterclose"), "#item_proversion" === o) UpgradeToProVersion(); else if ("#item_upgrade" === o) Opu(); else if ("#item_loging" === o) LogWindow(); else if ("#item_rate" === o) alert("not implemented yet"); else if ("#item_about" === o) AboutWindow(); else if ("#item_webcallme" === o) GenerateWebcallmeLink(); else if ("#item_reconnect" === o) webphone_api.global.authenticated_displayed = !1, webphone_api.common.GetParameter("devicetype") === webphone_api.common.DEVICE_WIN_SOFTPHONE() || webphone_api.common.getuseengine() === webphone_api.global.ENGINE_SERVICE ? webphone_api.common.WinAPI("API_Restart", null) : webphone_api.common.getuseengine() === webphone_api.global.ENGINE_WEBPHONE ? webphone_api.webphone.Restart() : (webphone_api.plhandler.Start(webphone_api.parameters, !1), webphone_api.plhandler.Stop(!0), setTimeout(function () {
                        webphone_api.startInner()
                    }, 1500)); else if ("#item_enablelog" === o) {
                        var t = GetLogLevel();
                        t < webphone_api.global.predefLoglevel && (t = webphone_api.global.predefLoglevel), SaveParameter("loglevel", t.toString()), SaveParameter("jsscriptevent", "3"), webphone_api.setparameter("jsscriptevent", "3"), webphone_api.global.loglevel = t
                    } else "#item_logwindow" === o && webphone_api.$.mobile.changePage("#page_logview", {
                        transition: "pop",
                        role: "page"
                    })
                })
            })
        } catch (c) {
            PutToDebugLogException(2, "common: HelpWindow", c)
        }
    }

    function GenerateWebcallmeLink() {
        var e = window.location.href;
        try {
            if (isNull(e)) return;
            e = Trim(e);
            var o = e.indexOf("?");
            o > 0 && (e = e.substring(0, o)), o = e.indexOf("#"), o > 0 && (e = e.substring(0, o)), e = Trim(e), e += "?wp_serveraddress=YOURSIPDOMAIN&wp_username=USERNAME&wp_password=PASSWORD&wp_callto=CALLEDNUMBER";
            var t = GetParameter("serveraddress_user"), n = GetSipusername();
            e = e.replace("YOURSIPDOMAIN", t), e = e.replace("USERNAME", "webcallme"), e = e.replace("PASSWORD", "webcallme"), e = e.replace("CALLEDNUMBER", n);
            var i = webphone_api.stringres.get("webcallme_msg") + ":";
            i = i + '<br /><br /><textarea id="webcallme_textarea" class="noshadow" data-theme="a">' + e + "</textarea>", AlertDialog(webphone_api.stringres.get("menu_webcallme"), i)
        } catch (a) {
            PutToDebugLogException(2, "common: GenerateWebcallmeLink", a)
        }
    }

    function AboutWindow() {
        try {
            if ("warble" === GetBrandName().toLowerCase()) return void OpenWebURL("https://support.warbleapp.com", "");
            var e = GetBrandName();
            60 === GetConfigInt("brandid", -1) && (e = "VoIPMuchPhone");
            var o = webphone_api.stringres.get("help_about") + " " + e, t = "", n = [];
            n.push("m"), n.push("i"), n.push("z"), n.push("u"), n.push("-"), n.push("v"), n.push("o"), n.push("i"), n.push("p");
            var i = n.join("");
            !isNull(e) && e.length > 0 && (t = t + e + " " + GetVersionStr());
            var a = GetConfig("homepage");
            if (!isNull(a) && a.length > 0) {
                var r = a.indexOf(",");
                r > 0 && (a = Trim(a.substring(0, r))), t = t + '<div class="about_item"><a href="' + a + '" target="_blank" onclick="webphone_api.common.OpenLinkInExternalBrowser(\'' + a + "')\">" + webphone_api.stringres.get("about_homepage") + "</a></div>"
            } else if (webphone_api.global.usestorage) {
                var n = "http://www." + i + ".com/Software/WebPhone.aspx";
                t = t + '<div class="about_item"><a href="' + n + '" target="_blank" onclick="webphone_api.common.OpenLinkInExternalBrowser(\'' + n + "')\">" + webphone_api.stringres.get("about_homepage") + "</a></div>"
            }
            var s = GetConfig("supporturl");
            if (!isNull(s) && s.length > 0) t = t + '<div class="about_item"><a href="' + s + '" target="_blank" onclick="webphone_api.common.OpenLinkInExternalBrowser(\'' + s + "')\">" + webphone_api.stringres.get("about_support") + "</a></div>"; else {
                var l = GetConfig("supportmail");
                !isNull(l) && l.length > 0 ? t = t + '<div class="about_item"><a href="mailto:' + l + '" target="_blank" onclick="webphone_api.common.OpenLinkInExternalBrowser(\'' + l + "')\">" + webphone_api.stringres.get("about_support") + "</a></div>" : webphone_api.global.usestorage && (l = "support@" + i + ".com", t = t + '<div class="about_item"><a href="mailto:' + l + '" target="_blank" onclick="webphone_api.common.OpenLinkInExternalBrowser(\'' + l + "')\">" + webphone_api.stringres.get("about_support") + "</a></div>")
            }
            var p = GetConfig("logo");
            !isNull(p) && p.length > 2 && (p.toLowerCase().indexOf(".jpg") > 0 || p.toLowerCase().indexOf(".jpeg") > 0 || p.toLowerCase().indexOf(".png") > 0 || p.toLowerCase().indexOf(".gif") > 0) && (t = t + '<br /><img src="' + GetElementSource() + "images/" + p + '" style="border: 0;">');
            var c = GetConfig("companyname"), u = new Date, h = u.getFullYear();
            if (!isNull(c) && c.length > 0) t = t + '<div class="about_item2"><i>' + webphone_api.stringres.get("about_copyright") + " " + h + " " + c + "<br />" + webphone_api.stringres.get("about_copyright2") + "</i></div>"; else if (webphone_api.global.usestorage) {
                var m = [];
                m.push("M"), m.push("i"), m.push("z"), m.push("u"), m.push("t"), m.push("e"), m.push("c"), m.push("h "), m.push("S"), m.push("R"), m.push("L"), c = m.join(""), t = t + '<div class="about_item2"><i>' + webphone_api.stringres.get("about_copyright") + " " + h + " " + c + "<br />" + webphone_api.stringres.get("about_copyright2") + "</i></div>"
            }
            var g = GetConfig("licenseurl");
            t = !isNull(g) && g.length > 0 ? t + '<div class="about_item2"><a href="' + g + '" target="_blank" onclick="webphone_api.common.OpenLinkInExternalBrowser(\'' + g + "')\">" + webphone_api.stringres.get("about_license") + "</a></div>" : t + '<div class="about_item2"><a href="javascript:;" onclick="webphone_api.common.LicenseAgreementWindow()">' + webphone_api.stringres.get("about_license") + "</a></div>", IsWindowsSoftphone() && "true" == GetConfig("needactivation") && !1 === CanShowLicKeyInput() && (t = t + '<div class="about_item2"><i>' + webphone_api.stringres.get("activated") + "</i></div>"), AlertDialog(o, t)
        } catch (d) {
            PutToDebugLogException(2, "common: AboutWindow", d)
        }
    }

    function Opu() {
        try {
            var e = [];
            e.push("h"), e.push("t"), e.push("t"), e.push("p"), e.push("s"), e.push(":"), e.push("/"), e.push("/"), e.push("w"), e.push("w"), e.push("w"), e.push("."), e.push("m"), e.push("i"), e.push("z"), e.push("u"), e.push("-"), e.push("v"), e.push("o"), e.push("i"), e.push("p"), e.push("."), e.push("c"), e.push("o"), e.push("m"), e.push("/"), e.push("S"), e.push("u"), e.push("p"), e.push("p"), e.push("o"), e.push("r"), e.push("t"), e.push("/"), e.push("W"), e.push("e"), e.push("b"), e.push("p"), e.push("h"), e.push("o"), e.push("n"), e.push("e"), e.push("p"), e.push("r"), e.push("i"), e.push("c"), e.push("i"), e.push("n"), e.push("g"), e.push("."), e.push("a"), e.push("s"), e.push("p"), e.push("x"), e.push("?"), e.push("S"), e.push("k"), e.push("i"), e.push("n"), e.push("S"), e.push("r"), e.push("c"), e.push("="), e.push("P"), e.push("o"), e.push("r"), e.push("t"), e.push("a"), e.push("l"), e.push("s"), e.push("/"), e.push("_"), e.push("d"), e.push("e"), e.push("f"), e.push("a"), e.push("u"), e.push("l"), e.push("t"), e.push("/"), e.push("S"), e.push("k"), e.push("i"), e.push("n"), e.push("s"), e.push("/"), e.push("D"), e.push("a"), e.push("r"), e.push("k"), e.push("K"), e.push("n"), e.push("i"), e.push("g"), e.push("h"), e.push("t"), e.push("M"), e.push("o"), e.push("b"), e.push("i"), e.push("l"), e.push("e"), e.push("/"), e.push("h"), e.push("o"), e.push("m"), e.push("e"), e.push("&"), e.push("C"), e.push("o"), e.push("n"), e.push("t"), e.push("a"), e.push("i"), e.push("n"), e.push("r"), e.push("S"), e.push("r"), e.push("c"), e.push("="), e.push("P"), e.push("o"), e.push("r"), e.push("t"), e.push("a"), e.push("l"), e.push("s"), e.push("/"), e.push("_"), e.push("d"), e.push("e"), e.push("f"), e.push("a"), e.push("u"), e.push("l"), e.push("t"), e.push("/"), e.push("C"), e.push("o"), e.push("n"), e.push("t"), e.push("a"), e.push("i"), e.push("n"), e.push("e"), e.push("r"), e.push("s"), e.push("/"), e.push("D"), e.push("a"), e.push("r"), e.push("k"), e.push("K"), e.push("n"), e.push("i"), e.push("g"), e.push("h"), e.push("t"), e.push("/"), e.push("P"), e.push("a"), e.push("g"), e.push("e"), e.push("T"), e.push("i"), e.push("T"), e.push("i"), e.push("t"), e.push("l"), e.push("l"), e.push("e"), e.push("_"), e.push("B"), e.push("l"), e.push("u"), e.push("e");
            var o = e.join("");
            window.open(o)
        } catch (t) {
            PutToDebugLogException(2, "common: Abs", t)
        }
    }

    function LicenseAgreementWindow() {
        try {
            var e = GetConfig("companyname"), o = GetConfig("brandname");
            if ((isNull(e) || e.length < 2) && webphone_api.global.usestorage) {
                var t = [];
                t.push("M"), t.push("i"), t.push("z"), t.push("u"), t.push("t"), t.push("e"), t.push("c"), t.push("h "), t.push("S"), t.push("R"), t.push("L"), e = t.join("")
            }
            (isNull(e) || e.length < 2) && (e = o);
            var n = "";
            n = !0 === webphone_api.global.usestorage || Strl(60) ? ReplaceAll(webphone_api.stringres.get("dlg_about_msg"), "[BRANDNAME]", o) : ReplaceAll(webphone_api.stringres.get("dlg_about_msg2"), "[BRANDNAME]", o), n = ReplaceAll(n, "[APPVERSION]", GetVersionStr());
            var i = e;
            (isNull(i) || i.length < 2) && (i = o), n = ReplaceAll(n, "[COMPANY]", i), webphone_api.$.mobile.activePage.find(".messagePopup").popup("close"), setTimeout(function () {
                AlertDialog(webphone_api.stringres.get("about_license"), n.toString())
            }, 200)
        } catch (a) {
            PutToDebugLogException(2, "common: LicenseAgreementWindow", a)
        }
    }

    function LogWindow(e) {
        try {
            var o = GetDeviceWidth();
            o = !isNull(o) && IsNumber(o) && o > 100 ? Math.floor(o / 1.2) : 220;
            var t = "", n = '<li id="[ITEMID]"><a data-rel="back">[ITEMTITLE]</a></li>', i = "";
            1 !== GetParameterInt("loglevel", 1) ? (i = n.replace("[ITEMID]", "#item_stoplog"), i = i.replace("[ITEMTITLE]", webphone_api.stringres.get("help_stoplog")), t += i, i = "", i = n.replace("[ITEMID]", "#item_sendlog"), i = i.replace("[ITEMTITLE]", webphone_api.stringres.get("help_sendlog")), t += i, i = "") : (i = n.replace("[ITEMID]", "#item_startlog"), i = i.replace("[ITEMTITLE]", webphone_api.stringres.get("help_startlog")), t += i, i = "");
            var a = '<div id="log_window" data-role="popup" class="ui-content messagePopup" data-overlay-theme="a" data-theme="a" style="max-width:' + o + "px; min-width: " + Math.floor(.6 * o) + 'px;"><div data-role="header" data-theme="b"><a href="javascript:;" data-role="button" data-icon="delete" data-iconpos="notext" class="ui-btn-right closePopup">Close</a><h1 class="adialog_title">' + webphone_api.stringres.get("help_loging") + '</h1></div><div role="main" class="ui-content adialog_content" style="padding: 0; margin: 0;"><ul id="log_window_ul" data-role="listview" data-inset="true" data-icon="false" style="margin: 0;">' + t + '</ul></div><div data-role="footer" data-theme="b" class="adialog_footer"><a href="javascript:;" style="width: 98%;" class="ui-btn ui-corner-all ui-shadow ui-btn-inline ui-btn-b adialog_2button" data-rel="back" data-transition="flow">' + webphone_api.stringres.get("btn_close") + "</a></div></div>";
            e = e || function () {
            }, webphone_api.$.mobile.activePage.append(a).trigger("create"), webphone_api.$.mobile.activePage.find(".closePopup").bind("tap", function (e) {
                webphone_api.$.mobile.activePage.find(".messagePopup").popup("close")
            }), webphone_api.$.mobile.activePage.find(".messagePopup").popup().popup("open").bind({
                popupafterclose: function () {
                    webphone_api.$(this).unbind("popupafterclose").remove(), webphone_api.$("#log_window_ul").off("click", "li"), e()
                }
            }), webphone_api.$("#log_window_ul").on("click", "li", function (e) {
                var o = webphone_api.$(this).attr("id");
                webphone_api.$("#log_window").on("popupafterclose", function (e) {
                    if (webphone_api.$("#log_window").off("popupafterclose"), "#item_startlog" === o) {
                        var t = GetLogLevel();
                        t < webphone_api.global.predefLoglevel && (t = webphone_api.global.predefLoglevel), SaveParameter("loglevel", t.toString()), SaveParameter("jsscriptevent", "3"), webphone_api.setparameter("jsscriptevent", "3"), webphone_api.global.loglevel = t
                    } else "#item_stoplog" === o ? (SaveParameter("loglevel", "1"), SaveParameter("jsscriptevent", "2"), webphone_api.setparameter("jsscriptevent", "2"), webphone_api.global.loglevel = 1, webphone_api.$("#log_text").html("")) : "#item_sendlog" === o && webphone_api.$.mobile.changePage("#page_logview", {
                        transition: "pop",
                        role: "page"
                    })
                })
            })
        } catch (r) {
            PutToDebugLogException(2, "common: LogWindow", r)
        }
    }

    function UpgradeToProVersion(e) {
        try {
            var o = GetDeviceWidth();
            o = !isNull(o) && IsNumber(o) && o > 100 ? Math.floor(o / 1.2) : 220;
            var t = '<div data-role="popup" class="ui-content messagePopup" data-overlay-theme="a" data-theme="a" style="max-width:' + o + 'px;"><div data-role="header" data-theme="b"><a href="javascript:;" data-role="button" data-icon="delete" data-iconpos="notext" class="ui-btn-right closePopup">Close</a><h1 class="adialog_title">' + webphone_api.stringres.get("help_proversion") + '</h1></div><div role="main" class="ui-content adialog_content adialog_alert"><span> ' + webphone_api.stringres.get("proversion_content_text") + ' </span><br /><button id="btn_buynow">Buy now</button><br />' + webphone_api.stringres.get("license_key") + ': <input type="text" id="proversion_input" name="setting_item" data-theme="a" placeholder="' + webphone_api.stringres.get("enter_license_key") + '" autocapitalize="off"/></div><div data-role="footer" data-theme="b" class="adialog_footer"><a href="javascript:;" id="btn_upgrade" class="ui-btn ui-corner-all ui-shadow ui-btn-inline ui-btn-b adialog_2button" data-rel="back" data-transition="flow">' + webphone_api.stringres.get("btn_activate") + '</a><a href="javascript:;" id="adialog_negative" class="ui-btn ui-corner-all ui-shadow ui-btn-inline ui-btn-b adialog_2button" data-rel="back">' + webphone_api.stringres.get("btn_close") + "</a></div></div>";
            e = e || function () {
            }, webphone_api.$.mobile.activePage.append(t).trigger("create"), webphone_api.$.mobile.activePage.find(".closePopup").bind("tap", function (e) {
                webphone_api.$.mobile.activePage.find(".messagePopup").popup("close")
            }), webphone_api.$.mobile.activePage.find(".messagePopup").bind({
                popupbeforeposition: function () {
                    webphone_api.$(this).unbind("popupbeforeposition");
                    var e = Math.floor(.6 * GetDeviceHeight());
                    webphone_api.$(this).height() > e && webphone_api.$(".messagePopup .ui-content").height(e)
                }
            }), webphone_api.$.mobile.activePage.find(".messagePopup").popup().popup("open").bind({
                popupafterclose: function () {
                    webphone_api.$(this).unbind("popupafterclose").remove(), webphone_api.$("#btn_upgrade").off("click"), e()
                }
            }), webphone_api.$("#btn_upgrade").on("click", function () {
                var e = document.getElementById("proversion_input").value;
                if (isNull(e) || Trim(e).length < 1) return void ShowToast("Invalid license key.");
                e = Trim(e), WinAPI("API_EnterLicKey", function (e) {
                }, e), setTimeout(function () {
                    canshowlickeyinput = null, CanShowLicKeyInput()
                }, 1e4)
            }), webphone_api.$("#btn_buynow").on("click", function () {
                OpenLinkInExternalBrowser("http://www.mizu-voip.com/Support/Store.aspx")
            })
        } catch (n) {
            PutToDebugLogException(2, "common: UpgradeToProVersion", n)
        }
    }

    function GetTickCount() {
        try {
            return (new Date).getTime()
        } catch (e) {
            PutToDebugLogSpecial(2, "common: GetTickCount", !0, e)
        }
        return 0
    }

    function HoverCalc(e, o) {
        try {
            var t = e, n = e.indexOf("#");
            if (n >= 0 && (e = e.substring(n + 1)), 6 === e.length) {
                var i = parseInt(e.substring(0, 2), 16), a = parseInt(e.substring(2, 4), 16),
                    r = parseInt(e.substring(4, 6), 16);
                i + o > 255 ? i -= o : i + o < 0 ? i -= o : i += o, a + o > 255 ? a -= o : a + o < 0 ? a -= o : a += o, r + o > 255 ? r -= o : r + o < 0 ? r -= o : r += o, i = i.toString(16), a = a.toString(16), r = r.toString(16), i.length < 2 && (i = "0" + i), a.length < 2 && (a = "0" + a), r.length < 2 && (r = "0" + r), e = "#" + i + a + r
            } else {
                if (3 !== e.length) return t;
                var i = parseInt(e.substring(0, 1), 16), a = parseInt(e.substring(1, 2), 16),
                    r = parseInt(e.substring(2, 3), 16);
                i + o > 255 ? i -= o : i + o < 0 ? i -= o : i += o, a + o > 255 ? a -= o : a + o < 0 ? a -= o : a += o, r + o > 255 ? r -= o : r + o < 0 ? r -= o : r += o, i = i.toString(16), a = a.toString(16), r = r.toString(16), i.length < 2 && (i = "0" + i), a.length < 2 && (a = "0" + a), r.length < 2 && (r = "0" + r), e = "#" + i + a + r
            }
            return e
        } catch (s) {
            PutToDebugLogException(2, "common: HoverCalc", s)
        }
        return ""
    }

    function IsIeLocal() {
        try {
            if (!0 === lf_isconfigured) return isielocal;
            lf_isconfigured = !0;
            var e = GetBrowser();
            if (isNull(e)) return;
            e = e.toLowerCase();
            var o = window.location.href;
            if (isNull(o)) return;
            o = o.toLowerCase(), o = Trim(o), "msie" === e && o.indexOf("http") < 0 && o.indexOf("https") < 0 && (isielocal = !0, PutToDebugLog(2, "EVENT, common: IsIeLocalFilesystem: IE from local file system"))
        } catch (t) {
            PutToDebugLogException(2, "common: IsIeLocal", t)
        }
        return isielocal
    }

    function IsIeVersion(e) {
        try {
            if (isNull(e)) return !1;
            var o = navigator.userAgent, t = o.match(/MSIE\s?(\d+)(?:\.(\d+))?/i);
            if (!isNull(t) && !isNull(t[0]) && t[0].indexOf(e) >= 0) return !0
        } catch (n) {
            PutToDebugLogException(2, "common: IsIeVersion", n)
        }
        return !1
    }

    function GetBrowser() {
        try {
            if (isNull(browserName) || isNull(browserName2)) {
                var e = navigator.userAgent.toLowerCase();
                -1 !== e.indexOf("edge") ? (browserName = "Edge", browserName2 = "Edge") : -1 !== e.indexOf("msie") && -1 === e.indexOf("opera") ? (browserName = "MSIE", browserName2 = "MSIE") : -1 !== e.indexOf("trident") || -1 !== e.indexOf("Trident") ? (browserName = "MSIE", browserName2 = "MSIE") : -1 !== e.indexOf("iphone") ? (browserName2 = -1 !== e.indexOf("fxios") || -1 !== e.indexOf("firefox") ? "Firefox" : -1 !== e.indexOf("crios") || -1 !== e.indexOf("chrome") ? "Chrome" : "iPhone", browserName = "Netscape Family") : -1 !== e.indexOf("firefox") && -1 === e.indexOf("opera") ? (browserName = "Netscape Family", browserName2 = "Firefox") : -1 !== e.indexOf("chrome") ? (browserName = "Netscape Family", browserName2 = "Chrome", "Android" === GetOs() && (e = e.replace("mozilla/", ""), browserName2 = e.match(/\/\d\.\d /i) ? "AndroidNative" : "Chrome")) : -1 !== e.indexOf("safari") ? (browserName = "Netscape Family", browserName2 = "Safari") : -1 !== e.indexOf("mozilla") && -1 === e.indexOf("opera") ? (browserName = "Netscape Family", browserName2 = "Other") : -1 !== e.indexOf("opera") ? (browserName = "Netscape Family", browserName2 = "Opera") : (browserName = "?", browserName2 = "unknown")
            }
        } catch (o) {
            PutToDebugLogException(2, "common: GetBrowser", o)
        }
        return browserName2
    }

    function GetBrowserVersion() {
        try {
            if (browserversion > 0) return browserversion;
            var e = GetBrowser(), o = navigator.userAgent.toLowerCase();
            if ("Chrome" === e) {
                var t = o.indexOf("chrome");
                t > 0 && (o = o.substring(t + 6)), isNull(o) || (o = o.replace("/", "")), t = o.indexOf("."), t > 0 && (o = o.substring(0, t)), isNull(o) || (o = Trim(o), IsNumber(o) && (browserversion = StrToInt(o)))
            } else if ("Firefox" === e) {
                var t = o.indexOf("firefox");
                t > 0 && (o = o.substring(t + 7)), isNull(o) || (o = o.replace("/", "")), t = o.indexOf("."), t > 0 && (o = o.substring(0, t)), isNull(o) || (o = Trim(o), IsNumber(o) && (browserversion = StrToInt(o)))
            } else if ("Safari" === e || "iPhone" === e) {
                var t = o.indexOf("version");
                t > 0 ? o = o.substring(t + 7) : o.indexOf("_") > 0 && (o = o.substring(0, o.indexOf("_")), o = Trim(o), o = o.substring(o.lastIndexOf(" "))), isNull(o) || (o = o.replace("/", "")), t = o.indexOf("."), t > 0 && (o = o.substring(0, t)), isNull(o) || (o = Trim(o), IsNumber(o) && (browserversion = StrToInt(o)))
            } else if ("MSIE" === e) {
                var n = window.navigator.userAgent, i = n.indexOf("MSIE ");
                i > 0 && (browserversion = parseInt(n.substring(i + 5, n.indexOf(".", i)), 10));
                var a = n.indexOf("Trident/");
                if (a > 0) {
                    var r = n.indexOf("rv:");
                    browserversion = parseInt(n.substring(r + 3, n.indexOf(".", r)), 10)
                }
                var s = n.indexOf("Edge/");
                s > 0 && (browserversion = parseInt(n.substring(s + 5, n.indexOf(".", s)), 10))
            } else if ("Edge" === e) {
                var t = o.indexOf("edge");
                t > 0 && (o = o.substring(t + 4)), isNull(o) || (o = o.replace("/", "")), t = o.indexOf("."), t > 0 && (o = o.substring(0, t)), isNull(o) || (o = Trim(o), IsNumber(o) && (browserversion = StrToInt(o)))
            }
            !isNull(browserversion) && IsNumber(browserversion) || (browserversion = -1), PutToDebugLog(2, "EVENT, common: GetBrowserVersion Detected browser version: " + browserversion)
        } catch (l) {
            PutToDebugLogException(2, "common: GetBrowserVersion", l)
        }
        return browserversion
    }

    function IsARM() {
        try {
            var e = navigator.userAgent.toLowerCase();
            if (e.indexOf("arm") >= 0 && e.indexOf("x86") < 0) return !0
        } catch (o) {
            PutToDebugLogException(2, "common: IsARM", o)
        }
        return !1
    }

    function Is64BitBrowser() {
        try {
            var e = navigator.userAgent.toLowerCase();
            return "Firefox" === GetBrowser() && e.indexOf("x64") > 0 && !0, !(e.indexOf("64") < 0)
        } catch (o) {
            PutToDebugLogException(2, "common: Is64BitBrowser", o)
        }
        return !1
    }

    function GetOs() {
        var e = "";
        try {
            if (!isNull(curros) && curros.length > 0) return curros;
            if (e = webphone_api.platform.os, isNull(e) || (e = e.toString()), isNull(e) || e.length < 1) return curros;
            e = e.toLowerCase(), curros = e.indexOf("windows") >= 0 ? "Windows" : e.indexOf("mac") >= 0 || e.indexOf("os x") >= 0 ? "Mac" : e.indexOf("centos") > -1 || e.indexOf("debian") > -1 || e.indexOf("fedora") > -1 || e.indexOf("gentoo") > -1 || e.indexOf("ubuntu") > -1 || e.indexOf("linux mint") > -1 || e.indexOf("red hat") > -1 || e.indexOf("suse") > -1 || e.indexOf("linux") > -1 || e.indexOf("x11") > -1 ? "Linux" : e.indexOf("ios") > -1 ? "iOS" : e.indexOf("android") > -1 ? "Android" : Trim(e), (/iPad|iPhone|iPod/.test(navigator.platform) || "MacIntel" === navigator.platform && navigator.maxTouchPoints > 1) && !window.MSStream && (curros = "iOS")
        } catch (o) {
            PutToDebugLogException(2, "common: GetOs", o)
        }
        return curros
    }

    function PickContact(e, o) {
        try {
            var t = GetDeviceWidth();
            t = !isNull(t) && IsNumber(t) && t > 100 ? Math.floor(t / 1.2) : 220;
            var n = GetDeviceHeight();
            n = !isNull(n) && IsNumber(n) && n > 100 ? Math.floor(n / 1.5) : 250;
            for (var i = "", a = 0; a < webphone_api.global.ctlist.length; a++) {
                var r = webphone_api.global.ctlist[a];
                if (!(isNull(r) || r.length < 1)) {
                    var s = r[CT_NAME];
                    if (isNull(s) || s.length < 1) {
                        var l = p[CT_NUMBER];
                        if (isNull(l) || l.length < 1 || isNull(l[0]) || l[0].length < 1) continue;
                        s = l[0]
                    }
                    var p = '<li id="pickcontact_' + a + '"><a data-rel="back">' + s + "</a></li>";
                    i += p
                }
            }
            var c = '<div id="pickcontact_popup" data-role="popup" class="ui-content messagePopup" data-overlay-theme="a" data-theme="a" style="max-width:' + t + "px; min-width: " + Math.floor(.6 * t) + 'px;"><div data-role="header" data-theme="b"><a href="javascript:;" data-role="button" data-icon="delete" data-iconpos="notext" class="ui-btn-right closePopup">Close</a><h1 class="adialog_title">' + webphone_api.stringres.get("pick_ct") + '</h1></div><div role="main" class="ui-content adialog_content adialog_alert" style="padding: 0; margin: 0;"><ul id="pickcontact_ul" data-role="listview" data-inset="true" data-icon="false" data-filter="true" data-filter-placeholder="Search Contacts" data-autodividers="true" style="margin: 0; max-height: ' + n + 'px;">' + i + '</ul></div><div data-role="footer" data-theme="b" class="adialog_footer"><a href="javascript:;" style="width: 98%;" class="ui-btn ui-corner-all ui-shadow ui-btn-inline ui-btn-b adialog_2button" data-rel="back" data-transition="flow">' + webphone_api.stringres.get("btn_close") + "</a></div></div>";
            o = o || function () {
            }, webphone_api.$.mobile.activePage.append(c).trigger("create"), webphone_api.$.mobile.activePage.find(".closePopup").bind("tap", function (e) {
                webphone_api.$.mobile.activePage.find(".messagePopup").popup("close")
            }), webphone_api.$.mobile.activePage.find(".messagePopup").popup().popup("open").bind({
                popupafterclose: function () {
                    webphone_api.$(this).unbind("popupafterclose").remove(), webphone_api.$("#pickcontact_ul").off("click", "li"), o()
                }
            }), webphone_api.$("#pickcontact_ul").on("click", "li", function (o) {
                var t = webphone_api.$(this).attr("id"), n = "", i = t.indexOf("_")
                    ;
                if (i < 2) return void PutToDebugLog(2, "ERROR, common PickContact OnListItemClick invalid id: " + t);
                n = Trim(t.substring(i + 1));
                var a = webphone_api.global.ctlist[n];
                if (isNull(a) || a.length < 1) return void PutToDebugLog(3, "ERROR, PickContact ctentry is NULL");
                var r = a[CT_NUMBER];
                webphone_api.$("#pickcontact_popup").on("popupafterclose", function (o) {
                    if (webphone_api.$("#pickcontact_popup").off("popupafterclose"), 1 === r.length) return void e(r[0], a[CT_NAME]);
                    PickContactNumber(n, e)
                })
            })
        } catch (u) {
            PutToDebugLogException(2, "common: PickContact", u)
        }
    }

    function PickContactNumber(e, o, t) {
        try {
            if (!o || "function" != typeof o) return void PutToDebugLog(2, "ERROR, PickContactNumber callback is NULL");
            var n = GetDeviceWidth();
            n = !isNull(n) && IsNumber(n) && n > 100 ? Math.floor(n / 1.2) : 220;
            var i = webphone_api.global.ctlist[e];
            if (isNull(i) || i.length < 1) return void PutToDebugLog(3, "ERROR, PickContactNumber ctentry is NULL");
            for (var a = i[CT_NUMBER], r = "", s = 0; s < a.length; s++) if (!(isNull(a[s]) || a[s].length < 1)) {
                var l = '<li id="pickcontactnumber_' + s + '"><a data-rel="back">' + a[s] + "</a></li>";
                r += l
            }
            var p = '<div id="pickcontactnumber_popup" data-role="popup" class="ui-content messagePopup" data-overlay-theme="a" data-theme="a" style="max-width:' + n + "px; min-width: " + Math.floor(.6 * n) + 'px;"><div data-role="header" data-theme="b"><a href="javascript:;" data-role="button" data-icon="delete" data-iconpos="notext" class="ui-btn-right closePopup">Close</a><h1 class="adialog_title">' + i[CT_NAME] + '</h1></div><div role="main" class="ui-content adialog_content adialog_alert" style="padding: 0; margin: 0;"><ul id="pickcontactnumber_ul" data-role="listview" data-inset="true" data-icon="false" style="margin: 0;">' + r + '</ul></div><div data-role="footer" data-theme="b" class="adialog_footer"><a href="javascript:;" style="width: 98%;" class="ui-btn ui-corner-all ui-shadow ui-btn-inline ui-btn-b adialog_2button" data-rel="back" data-transition="flow">' + webphone_api.stringres.get("btn_close") + "</a></div></div>";
            t = t || function () {
            }, webphone_api.$.mobile.activePage.append(p).trigger("create"), webphone_api.$.mobile.activePage.find(".closePopup").bind("tap", function (e) {
                webphone_api.$.mobile.activePage.find(".messagePopup").popup("close")
            }), webphone_api.$.mobile.activePage.find(".messagePopup").popup().popup("open").bind({
                popupafterclose: function () {
                    webphone_api.$(this).unbind("popupafterclose").remove(), webphone_api.$("#pickcontactnumber_ul").off("click", "li"), t()
                }
            }), webphone_api.$("#pickcontactnumber_ul").on("click", "li", function (e) {
                var t = webphone_api.$(this).attr("id"), n = "", r = t.indexOf("_");
                if (r < 2) return void PutToDebugLog(2, "ERROR, common PickContactNumber OnListItemClick invalid nrid: " + t);
                n = Trim(t.substring(r + 1)), webphone_api.$("#pickcontactnumber_popup").on("popupafterclose", function (e) {
                    webphone_api.$("#pickcontactnumber_popup").off("popupafterclose"), o(a[n], i[CT_NAME])
                })
            })
        } catch (c) {
            PutToDebugLogException(2, "common: PickContactNumber", c)
        }
    }

    function NormalizeNumber(e) {
        try {
            if (isNull(e)) return "";
            if (e = Trim(e), e = NormalizeInput(e, 0), !IsWindowsSoftphone() && (getuseengine() === webphone_api.global.ENGINE_WEBRTC || getuseengine() === webphone_api.global.ENGINE_FLASH)) {
                var o = GetParameter2("techprefix");
                (!isNull(o) || o.length > 0) && (o = Trim(o), e = o + e)
            }
            if (0 == GetParameterInt("normalizenumber", -1)) return ApplyFilters(e);
            if (e.length < 6 || e.length > 20) return ApplyFilters(e);
            var t = GetSipusername();
            if (!isNull(t) && t.length > 0 && t !== NormalizeInput2(t, 1)) return ApplyFilters(e);
            for (var n = 0, i = 0; i < e.length; i++) e.charAt(i) >= "0" && e.charAt(i) <= "9" && n++;
            if (n < 5) return ApplyFilters(e);
            for (var i = 0; i < e.length; i++) if (e.charAt(i) >= "a" && e.charAt(i) <= "z" || e.charAt(i) >= "A" && e.charAt(i) <= "Z" || "@" == e.charAt(i)) return ApplyFilters(e);
            for (var a = "", i = 0; i < e.length; i++) (e.charAt(i) >= "0" && e.charAt(i) <= "9" || "*" == e.charAt(i) || "," == e.charAt(i) || "#" == e.charAt(i) || 0 == i && "+" == e.charAt(i)) && (a += e.charAt(i));
            return ApplyFilters(e)
        } catch (r) {
            PutToDebugLogException(2, "common: NormalizeNumber", r)
        }
        return ApplyFilters(e)
    }

    function NormalizeInput(e, o) {
        try {
            var t = e;
            return isNull(t) ? "" : (t = t.toString(), t = Trim(t), o < 1 && (t = ReplaceAll(t, "WSS://", ""), t = ReplaceAll(t, "wss://", ""), t = ReplaceAll(t, "WSS:", ""), t = ReplaceAll(t, "wss:", ""), t = ReplaceAll(t, "WS://", ""), t = ReplaceAll(t, "ws://", ""), t = ReplaceAll(t, "WS:", ""), t = ReplaceAll(t, "ws:", "")), t = ReplaceAll(t, "SIP:", ""), t = ReplaceAll(t, "sip:", ""), t = ReplaceAll(t, "SIPS:", ""), t = ReplaceAll(t, "sips:", ""), t = ReplaceAll(t, "UDP:", ""), t = ReplaceAll(t, "udp:", ""), t = ReplaceAll(t, "TCP:", ""), t = ReplaceAll(t, "tcp:", ""), t = ReplaceAll(t, "URL:", ""), t = ReplaceAll(t, "url:", ""), t = ReplaceAll(t, "TEL:", ""), t = ReplaceAll(t, "tel:", ""), t = ReplaceAll(t, "HTTPS://", ""), t = ReplaceAll(t, "https://", ""), t = ReplaceAll(t, "HTTPS:", ""), t = ReplaceAll(t, "https:", ""), t = ReplaceAll(t, "HTTP://", ""), t = ReplaceAll(t, "http://", ""), t = ReplaceAll(t, "HTTP:", ""), t = ReplaceAll(t, "http:", ""), t = ReplaceAll(t, "'", ""), t = ReplaceAll(t, '"', ""))
        } catch (n) {
            PutToDebugLogException(2, "common: NormalizeInput", n)
        }
        return e
    }

    function NormalizeInput2(e, o) {
        try {
            var t = e;
            if (isNull(t)) return "";
            t = t.toString(), t = Trim(t), t = NormalizeInput(t, 0);
            var n = t.split("");
            if (isNull(n) || n.length < 1) return e;
            if (o < 1) {
                for (var i = 0; i < n.length; i++) n[i] >= "0" && n[i] <= "9" || (n[i] = "");
                return n.join("")
            }
            if (1 === o) {
                for (var i = 0; i < n.length; i++) n[i] >= "0" && n[i] <= "9" || n[i] >= "A" && n[i] <= "Z" || n[i] >= "a" && n[i] <= "z" || "_" === n[i] || "." === n[i] || "-" === n[i] || (n[i] = "_");
                return n.join("")
            }
            if (2 === o) {
                for (var i = 0; i < n.length; i++) n[i] >= "0" && n[i] <= "9" || n[i] >= "A" && n[i] <= "Z" || n[i] >= "a" && n[i] <= "z" || "_" === n[i] || "." === n[i] || "-" === n[i] || " " === n[i] || (n[i] = "_");
                return n.join("")
            }
            for (var i = 0; i < n.length; i++) n[i] >= "0" && n[i] <= "9" || n[i] >= "A" && n[i] <= "Z" || n[i] >= "a" && n[i] <= "z" || "_" === n[i] || "." === n[i] || "-" === n[i] || " " === n[i] || "+" === n[i] || ":" === n[i] || "@" === n[i] || (n[i] = "_");
            return n.join("")
        } catch (a) {
            PutToDebugLogException(2, "common: NormalizeInput2", a)
        }
        return e
    }

    function PasswordStringIsValidForServer(e) {
        try {
            if (isNull(e) || e.length < 1) return !1;
            for (var o = 0; o < e.length; o++) if (e.charCodeAt(o) < 33 || e.charCodeAt(o) > 126 || "'" === e.charAt(o) || '"' === e.charAt(o) || "<" === e.charAt(o) || ">" === e.charAt(o)) return !1
        } catch (t) {
            PutToDebugLogException(2, "common: PasswordStringIsValidForServer", t)
        }
        return !0
    }

    function UsernameStringIsValidForServer(e) {
        try {
            if (isNull(e) || e.length < 1) return !1;
            for (var o = 0; o < e.length; o++) if (!(e.charAt(o) >= "0" && e.charAt(o) <= "9" || e.charAt(o) >= "a" && e.charAt(o) <= "z" || e.charAt(o) >= "A" && e.charAt(o) <= "Z" || "#" === e.charAt(o) || "*" === e.charAt(o) || "(" === e.charAt(o) || ")" === e.charAt(o) || "[" === e.charAt(o) || "]" === e.charAt(o) || "{" === e.charAt(o) || "}" === e.charAt(o) || "+" === e.charAt(o) || "." === e.charAt(o) || "," === e.charAt(o) || "/" === e.charAt(o) || "\\" === e.charAt(o) || "_" === e.charAt(o) || "-" === e.charAt(o) || "^" === e.charAt(o) || "~" === e.charAt(o) || "!" === e.charAt(o))) return !1
        } catch (t) {
            PutToDebugLogException(2, "common: UsernameStringIsValidForServer", t)
        }
        return !0
    }

    function ApplyFilters(e) {
        try {
            if (isNull(e)) return "";
            e = Trim(e), PutToDebugLog(4, "EVENT, normalized number: " + e);
            var o = GetParameter("filters");
            if (isNull(o) || o.length < 3) return e;
            var t = o.split(";");
            if (isNull(t) || t.length < 1) return e;
            for (var n = 0; n < t.length; n++) if (!isNull(t[n])) {
                var i = t[n].split(",");
                if (!isNull(i) && 4 === i.length) {
                    var a = "", r = "", s = -1, l = -1;
                    try {
                        if (a = i[F_WHAT], r = i[F_WITH], isNull(a) && (a = ""), isNull(r) && (r = ""), a.length < 1 && r.length < 1) continue;
                        !isNull(i[F_MIN]) && IsNumber(i[F_MIN]) && (s = StrToInt(i[F_MIN])), !isNull(i[F_MAX]) && IsNumber(i[F_MAX]) && (l = StrToInt(i[F_MAX])), 0 !== a.length && 0 !== e.indexOf(a) || (s < 0 && l < 0 ? e = e.replace(a, r) : s < 0 && l > 0 && e.length <= l ? e = e.replace(a, r) : l < 0 && s > 0 && e.length > s ? e = e.replace(a, r) : s >= 0 && l > 0 && l >= s && e.length >= s && e.length <= l && (e = e.replace(a, r)))
                    } catch (p) {
                        continue
                    }
                }
            }
            PutToDebugLog(4, "EVENT, filtered number: " + e)
        } catch (c) {
            PutToDebugLogException(2, "common: ApplyFilters", c)
        }
        return e
    }

    function InitializeSettings() {
        try {
            PutToDebugLog(2, "EVENT, common: InitializeSettings called");
            var e = "", o = "2";
            !isNull(GetConfig("upperserverfromuser")) && GetConfig("upperserverfromuser").length > 0 && (o = Trim(GetConfig("upperserverfromuser"))), SettingItem("upperserverfromuser", o, "-1", GROUP_NOGROUP, "", "", "1", "2"), "9999" !== GetConfig("brandid") && (!1 === RequestUserServerInput(o) && !isNull(GetConfig("serveraddress")) && GetConfig("serveraddress").length > 0 && (e = Trim(GetConfig("serveraddress"))), SettingItem("serveraddress_user", e, "8", GROUP_LOGIN, "", "", "1", "")), SettingItem("serveraddress_orig", "", "-1", GROUP_NOGROUP, "", "", "1", ""), SettingItem("upperserver", "", "-1", "-1", "", "", "1", ""), SettingItem("sipusername", "", "1", GROUP_LOGIN, "", "", "1", ""), SettingItem("password", "", "1", GROUP_LOGIN, "", "", "1", ""), SettingItem("settlevelbasic", "true", "-1", GROUP_NOGROUP, "", "", "1", "true"), SettingItem("submenu_sipsettings", "", "6", GROUP_MAIN, "", "", "1", ""), SettingItem("submenu_media", "", "6", GROUP_MAIN, "", "", "1", ""), SettingItem("submenu_video", "", "6", GROUP_MEDIA, "", "", "1", ""), SettingItem("submenu_calldivert", "", "6", GROUP_MAIN, "", "", "1", ""), SettingItem("submenu_general", "", "6", GROUP_MAIN, "", "", "1", ""), SettingItem("submenu_profile", "", "6", GROUP_MAIN, "", "", "1", ""), SettingItem("advancedloginsettings2", "", "6", GROUP_SIP, "", "", "1", ""), SettingItem("submenu_integrate", "", "6", GROUP_GENERAL, "", "", "1", ""), SettingItem("submenu_screenshare", "", "6", GROUP_MEDIA, "", "", "1", "");
            var t = "true";
            !isNull(GetConfig("customizedversion")) && GetConfig("customizedversion").length > 0 && (t = Trim(GetConfig("customizedversion"))), SettingItem("customizedversion", t, "-1", GROUP_NOGROUP, "", "", "1", "true");
            var n = "1";
            !isNull(GetConfig("autoprovisioning")) && GetConfig("autoprovisioning").length > 0 && (n = Trim(GetConfig("autoprovisioning"))), !0 !== n && "true" !== n || (n = "1"), !1 !== n && "false" !== n || (n = "0"), SettingItem("autoprovisioning", n, "-1", GROUP_NOGROUP, "", "", "1", "1");
            var i = "Server";
            !isNull(GetConfig("server_label")) && GetConfig("server_label").length > 0 && (i = Trim(GetConfig("server_label"))), SettingItem("server_label", i, "-1", GROUP_NOGROUP, "", "", "1", "Server");
            var a = "false";
            !isNull(GetConfig("serverinputisupperserver")) && GetConfig("serverinputisupperserver").length > 0 && (a = Trim(GetConfig("serverinputisupperserver"))), SettingItem("serverinputisupperserver", a, "-1", GROUP_NOGROUP, "", "", "1", "false");
            var r = "";
            !isNull(GetConfig("serveraddress")) && GetConfig("serveraddress").length > 0 && (r = Trim(GetConfig("serveraddress"))), SettingItem("serveraddress", r, "-1", GROUP_NOGROUP, "", "", "1", "");
            var s = "";
            !isNull(GetConfig("webrtcserveraddress")) && GetConfig("webrtcserveraddress").length > 0 && (s = Trim(GetConfig("webrtcserveraddress"))), SettingItem("webrtcserveraddress", s, "-1", GROUP_NOGROUP, "", "", "1", "");
            var l = "";
            !isNull(GetConfig("rtmpserveraddress")) && GetConfig("rtmpserveraddress").length > 0 && (l = Trim(GetConfig("rtmpserveraddress"))), SettingItem("rtmpserveraddress", l, "-1", GROUP_NOGROUP, "", "", "1", "");
            var p = "";
            !isNull(GetConfig("realm")) && GetConfig("realm").length > 0 && (p = Trim(GetConfig("realm"))), SettingItem("realm", p, "1", GROUP_SIP, "", "", "1", "");
            var c = "1";
            !isNull(GetConfig("showserverinput")) && GetConfig("showserverinput").length > 0 && (c = Trim(GetConfig("showserverinput"))), SettingItem("showserverinput", c, "-1", GROUP_NOGROUP, "", "", "1", "1");
            var u = "";
            !isNull(GetConfig("apiv2md5salt")) && GetConfig("apiv2md5salt").length > 0 && (u = Trim(GetConfig("apiv2md5salt"))), SettingItem("apiv2md5salt", u, "-1", GROUP_NOGROUP, "", "", "1", ""), SettingItem("displaypopupdirectcalls", "true", "-1", GROUP_NOGROUP, "", "", "1", "true"), SettingItem("register", "1", "2", GROUP_SIP, webphone_api.stringres.get("register__no") + "," + webphone_api.stringres.get("register__auto") + "," + webphone_api.stringres.get("register__yes"), "0,1,2", "1", "1"), SettingItem("registerinterval", "180", "1", GROUP_SIP, "", "", "1", "180"), SettingItem("cfgnetworkspeed", "0", "2", GROUP_MEDIA, "Auto guess,Slow (< 20 KBits on GPRS or 3G),Normal (20 - 60 kbits),Fast (> 60 KBits)", "0,1,2,3", "1", "0"), SettingItem("prefcodec", "", "3", GROUP_NOGROUP, "", "", "1", ""), SettingItem("dtmfmode", "2", "2", GROUP_SIP, webphone_api.stringres.get("dtmfmode_op_0") + "," + webphone_api.stringres.get("dtmfmode_op_1") + "," + webphone_api.stringres.get("dtmfmode_op_2") + "," + webphone_api.stringres.get("dtmfmode_op_3") + "," + webphone_api.stringres.get("dtmfmode_op_4") + "," + webphone_api.stringres.get("dtmfmode_op_5") + "," + webphone_api.stringres.get("dtmfmode_op_6"), "0,1,2,3,4,5,6", "1", "2"), SettingItem("audiorecorder", "1", "2", GROUP_MEDIA, "Default,Auto guess, Mic,Voice call,Voice downlink,Voice uplink,Voice communication", "0,1,2,3,4,5,6", "1", "1"), SettingItem("audioplayer", "-2147483648", "2", GROUP_MEDIA, "Default (Automatic),Alarm stream,Music playback,Notifications stream,Ring stream,System sounds,Voice call", "-2147483648,4,3,5,2,1,0", "1", "-2147483648"), SettingItem("speakerphoneplayer", "-2147483648", "2", GROUP_MEDIA, "Default (Automatic),Alarm stream,Music playback,Notifications stream,Ring stream,System sounds,Voice call,No change", "-2147483648,4,3,5,2,1,0,6", "1", "-2147483648"), SettingItem("speakerphoneoutput", "0", "2", GROUP_MEDIA, "Auto guess,Speaker,Speaker and mode,VoIP,Bluetooth,Normal,Mode only,No changes", "0,1,2,3,4,5,6,7", "1", "0"), SettingItem("autousebluetooth", "0", "2", GROUP_MEDIA, "Guess,No,Yes", "0,1,2", "1", "0"), SettingItem("playring", "2", "2", GROUP_MEDIA, webphone_api.stringres.get("playring__no") + "," + webphone_api.stringres.get("playring__incoming") + "," + webphone_api.stringres.get("playring__both"), "0,1,2", "1", "2"), SettingItem("volumein", "50", "4", GROUP_MEDIA, "", "", "1", "50"), SettingItem("volumeout", "50", "4", GROUP_MEDIA, "", "", "1", "50"), SettingItem("agc", "3", "2", GROUP_MEDIA, webphone_api.stringres.get("agc__disabled") + "," + webphone_api.stringres.get("agc__for_redcording") + "," + webphone_api.stringres.get("agc__both_for_recording_and_playback") + "," + webphone_api.stringres.get("agc__guess"), "0,1,2,3", "1", "3"), SettingItem("aec", "1", "8", GROUP_MEDIA, "No,Yes except if headset is guessed,Yes if supported,Forced yes even if not supported (might result in unexpected errors)", "0,1,2,3", "1", "1"), SettingItem("denoise", "3", "2", GROUP_MEDIA, webphone_api.stringres.get("denoise__disabled") + "," + webphone_api.stringres.get("denoise__recording") + "," + webphone_api.stringres.get("denoise__both") + "," + webphone_api.stringres.get("denoise__auto"), "0,1,2,3", "1", "3"), SettingItem("plc", "1", "2", GROUP_MEDIA, webphone_api.stringres.get("plc__no") + "," + webphone_api.stringres.get("plc__auto") + "," + webphone_api.stringres.get("plc__yes"), "0,1,2", "1", "1"), SettingItem("silencesupress", "-1", "2", GROUP_MEDIA, webphone_api.stringres.get("silencesupress__auto") + "," + webphone_api.stringres.get("silencesupress__no") + "," + webphone_api.stringres.get("silencesupress__yes"), "-1,0,1", "1", "-1"), SettingItem("hardwaremedia", "0", "2", GROUP_MEDIA, webphone_api.stringres.get("hardwaremedia__auto") + "," + webphone_api.stringres.get("hardwaremedia__no") + "," + webphone_api.stringres.get("hardwaremedia__yes"), "0,1,2", "1", "0"), SettingItem("mediaencryption", "0", "2", GROUP_MEDIA, webphone_api.stringres.get("mediaencryption__no") + "," + webphone_api.stringres.get("mediaencryption__auto") + "," + webphone_api.stringres.get("mediaencryption__srtp"), "0,1,2", "1", "0"), SettingItem("setqos", "0", "2", GROUP_MEDIA, webphone_api.stringres.get("setqos__auto") + "," + webphone_api.stringres.get("setqos__no") + "," + webphone_api.stringres.get("setqos__yes"), "0,1,2", "1", "0"), SettingItem("codecframecount", "0", "2", GROUP_MEDIA, webphone_api.stringres.get("codecframecount_auto") + ",1,2,3,4,5,6", "0,1,2,3,4,5,6", "1", "0"), SettingItem("doublesendrtp", "0", "2", GROUP_MEDIA, webphone_api.stringres.get("doublesendrtp__no") + "," + webphone_api.stringres.get("doublesendrtp__yes"), "0,1", "1", "0"), SettingItem("ringtimeout", "90000", "1", GROUP_SIP, "", "", "1", "90000"), SettingItem("calltimeout", "10800000", "1", GROUP_SIP, "", "", "1", "10800000");
            var h = "1";
            !isNull(GetConfig("displaynotification")) && GetConfig("displaynotification").length > 0 && (h = Trim(GetConfig("transfertype"))), "2" === h && (h = "1"), SettingItem("displaynotification", h, "2", GROUP_CALLDIVERT, webphone_api.stringres.get("displaynotification__never") + "," + webphone_api.stringres.get("displaynotification__onevent"), "0,1", "1", h);
            var m = "false";
            !isNull(GetConfig("hasvolume")) && GetConfig("hasvolume").length > 0 && (m = Trim(GetConfig("hasvolume"))), SettingItem("displayvolumecontrols", m, "0", GROUP_GENERAL, "", "", "1", m), SettingItem("displayaudiodevice", "false", "0", GROUP_GENERAL, "", "", "1", "false"), SettingItem("use_fast_ice", "1", "2", GROUP_SIP, webphone_api.stringres.get("use_fast_ice__no") + "," + webphone_api.stringres.get("use_fast_ice__auto") + "," + webphone_api.stringres.get("use_fast_ice__yes") + "," + webphone_api.stringres.get("use_fast_ice__always"), "0,1,2,3", "1", "1"), SettingItem("use_stun", "1", "2", GROUP_SIP, webphone_api.stringres.get("use_stun__force") + "," + webphone_api.stringres.get("use_stun__no") + "," + webphone_api.stringres.get("use_stun__stable_nat") + "," + webphone_api.stringres.get("use_stun__all_symetric") + "," + webphone_api.stringres.get("use_stun__always") + "," + webphone_api.stringres.get("use_stun__public_ip"), "-1,0,1,2,3,4", "1", "1"), SettingItem("prack", "false", "0", GROUP_SIP, "", "", "1", "false"), SettingItem("localip", "", "1", GROUP_SIP, "", "", "1", ""), SettingItem("signalingport", "", "1", GROUP_SIP, "", "", "1", ""), SettingItem("rtpport", "", "1", GROUP_SIP, "", "", "1", "");
            var g = "2";
            !isNull(GetConfig("earlymedia")) && GetConfig("earlymedia").length > 0 && (g = Trim(GetConfig("earlymedia"))), SettingItem("earlymedia", g, "2", GROUP_SIP, webphone_api.stringres.get("earlymedia__no") + "," + webphone_api.stringres.get("earlymedia__reserved") + "," + webphone_api.stringres.get("earlymedia__auto") + "," + webphone_api.stringres.get("earlymedia__just_early") + "," + webphone_api.stringres.get("earlymedia__null_packets") + "," + webphone_api.stringres.get("earlymedia__yes") + "," + webphone_api.stringres.get("earlymedia__always_force"), "0,1,2,3,4,5,6", "1", g), SettingItem("jittersize", "3", "2", GROUP_MEDIA, webphone_api.stringres.get("jittersize__no") + "," + webphone_api.stringres.get("jittersize__esmall") + "," + webphone_api.stringres.get("jittersize__small") + "," + webphone_api.stringres.get("jittersize__normal") + "," + webphone_api.stringres.get("jittersize__big") + "," + webphone_api.stringres.get("jittersize__ebig") + "," + webphone_api.stringres.get("jittersize__max"), "0,1,2,3,4,5,6", "1", "3"), SettingItem("proxyaddress", "", "1", GROUP_SIP, "", "", "1", ""), SettingItem("username", "", "1", GROUP_SIP, "", "", "1", ""), SettingItem("displayname", "", "1", GROUP_SIP, "", "", "1", ""), SettingItem("email", "", "1", GROUP_GENERAL, "", "", "1", ""), SettingItem("chatsms", "0", "2", GROUP_SIP, webphone_api.stringres.get("chatsms__auto_guess_or_ask") + "," + webphone_api.stringres.get("chatsms__sms_only") + "," + webphone_api.stringres.get("chatsms__chat_only") + "," + webphone_api.stringres.get("chatsms__disable"), "0,1,2,3", "1", "0"), SettingItem("savetocontacts", "1", "2", GROUP_GENERAL, webphone_api.stringres.get("savetocontacts__no") + "," + webphone_api.stringres.get("savetocontacts__ask") + "," + webphone_api.stringres.get("savetocontacts__yes"), "0,1,2", "1", "1"), SettingItem("call_access", "", "7", GROUP_GENERAL, "", "", "1", "");
            var d = "-1";
            !isNull(GetConfig("transfertype")) && GetConfig("transfertype").length > 0 && (d = Trim(GetConfig("transfertype"))), SettingItem("transfertype", d, "2", GROUP_CALLDIVERT, webphone_api.stringres.get("transfertype__auto") + "," + webphone_api.stringres.get("transfertype__unattended") + "," + webphone_api.stringres.get("transfertype__withhold") + "," + webphone_api.stringres.get("transfertype__attanded"), "-1,1,6,5", "1", d), SettingItem("callforwardonbusy", "", "1", GROUP_CALLDIVERT, "", "", "1", ""), SettingItem("rejectonvoipbusy", "3", "2", GROUP_CALLDIVERT, "Auto,Reject calls,Allow calls,Forward calls", "3,0,1,2", "1", "3"), SettingItem("rejectonphonebusy", "0", "2", GROUP_CALLDIVERT, "Reject calls,Allow calls,Forward calls", "0,1,2", "1", "0");
            var b = "";
            !isNull(GetConfig("voicemailnum")) && GetConfig("voicemailnum").length > 0 && (b = Trim(GetConfig("voicemailnum"))), SettingItem("voicemailnum", b, "1", GROUP_CALLDIVERT, "", "", "1", "");
            var _ = "2";
            !isNull(GetConfig("voicemail")) && GetConfig("voicemail").length > 0 && (_ = Trim(GetConfig("voicemail"))), SettingItem("voicemail", _, "2", GROUP_CALLDIVERT, "Disabled,Only if NOTIFY is received,Auto-detect if SUBSCRIBE is needed,Subscribe for voicemail after registration,Subscribe for voicemail on startup", "0,1,2,3,4", "1", "false"), SettingItem("techprefix", "", "1", GROUP_CALLDIVERT, "", "", "1", ""), SettingItem("filters", "", "5", GROUP_CALLDIVERT, "", "", "1", ""), SettingItem("startonboot", "true", "0", GROUP_GENERAL, "", "", "1", "true"), SettingItem("startwithos", "true", "0", GROUP_GENERAL, "", "", "1", "true"), SettingItem("startwithos_was_sent", "false", "-1", GROUP_NOGROUP, "", "", "1", "false");
            var f = "1";
            webphone_api.global.isdebugversion ? (SettingItem("loglevel", "5", "0", GROUP_GENERAL, "", "", "1", "1"), webphone_api.global.loglevel = 5) : (!isNull(webphone_api.parameters.loglevel) && 1 === webphone_api.parameters.loglevel.length && IsNumber(webphone_api.parameters.loglevel) && (f = Trim(webphone_api.parameters.loglevel.length)), SettingItem("loglevel", f, "0", GROUP_GENERAL, "", "", "1", "1")), SettingItem("loglevel_dbg", f, "1", GROUP_GENERAL, "", "", "1", "1"), SettingItem("code_version", "1", "-1", GROUP_NOGROUP, "", "", "1", "1");
            var w = "";
            !isNull(GetConfig("brandname")) && GetConfig("brandname").length > 0 && (w = Trim(GetConfig("brandname"))), SettingItem("brandname", w, "-1", GROUP_NOGROUP, "", "", "1", "");
            !isNull(GetConfig("brandid")) && GetConfig("brandid").length > 0 && (w = Trim(GetConfig("brandid"))), SettingItem("brandid", "", "-1", GROUP_NOGROUP, "", "", "1", "");
            var v = "";
            !isNull(GetConfig("companyname")) && GetConfig("companyname").length > 0 && (v = Trim(GetConfig("companyname"))), SettingItem("companyname", v, "-1", GROUP_NOGROUP, "", "", "1", "");
            var E = "";
            !isNull(GetConfig("newuser")) && GetConfig("newuser").length > 0 && (E = Trim(GetConfig("newuser"))), SettingItem("newuser", E, "-1", GROUP_NOGROUP, "", "", "1", "");
            var T = "";
            !isNull(GetConfig("homepage")) && GetConfig("homepage").length > 0 && (T = Trim(GetConfig("homepage"))), SettingItem("homepage", T, "-1", GROUP_NOGROUP, "", "", "1", "");
            var P = "";
            !isNull(GetConfig("accounturi")) && GetConfig("accounturi").length > 0 && (P = Trim(GetConfig("accounturi"))), SettingItem("accounturi", P, "-1", GROUP_NOGROUP, "", "", "1", "");
            var S = "";
            !isNull(GetConfig("recharge")) && GetConfig("recharge").length > 0 && (S = Trim(GetConfig("recharge"))), SettingItem("recharge", S, "-1", GROUP_NOGROUP, "", "", "1", "");
            var N = "";
            !isNull(GetConfig("p2p")) && GetConfig("p2p").length > 0 && (N = Trim(GetConfig("p2p"))), SettingItem("p2p", N, "1", GROUP_CALLDIVERT, "", "", "1", "");
            var I = "";
            !isNull(GetConfig("callback")) && GetConfig("callback").length > 0 && (I = Trim(GetConfig("callback"))), SettingItem("callback", I, "1", GROUP_CALLDIVERT, "", "", "1", "");
            var C = "";
            !isNull(GetConfig("sms")) && GetConfig("sms").length > 0 && (C = Trim(GetConfig("sms"))), SettingItem("sms", C, "1", GROUP_CALLDIVERT, "", "", "1", "");
            var R = "";
            !isNull(GetConfig("sms_recieve")) && GetConfig("sms_recieve").length > 0 && (R = Trim(GetConfig("sms_recieve"))), SettingItem("sms_recieve", R, "-1", GROUP_NOGROUP, "", "", "1", "");
            var y = "";
            !isNull(GetConfig("creditrequest")) && GetConfig("creditrequest").length > 0 && (y = Trim(GetConfig("creditrequest"))), SettingItem("creditrequest", y, "1", GROUP_CALLDIVERT, "", "", "1", "");
            var L = "";
            !isNull(GetConfig("ratingrequest")) && GetConfig("ratingrequest").length > 0 && (L = Trim(GetConfig("ratingrequest"))), SettingItem("ratingrequest", L, "1", GROUP_CALLDIVERT, "", "", "1", "");
            var D = "";
            !isNull(GetConfig("supportmail")) && GetConfig("supportmail").length > 0 && (D = Trim(GetConfig("supportmail"))), SettingItem("supportmail", D, "-1", GROUP_NOGROUP, "", "", "1", "");
            var G = "";
            !isNull(GetConfig("supporturl")) && GetConfig("supporturl").length > 0 && (G = Trim(GetConfig("supporturl"))), SettingItem("supporturl", G, "-1", GROUP_NOGROUP, "", "", "1", "");
            var O = GetParameter("header");
            !isNull(GetConfig("header")) && GetConfig("header").length > 0 && (O = Trim(GetConfig("header"))), O.length < 1 && !isNull(GetConfig("headertext")) && GetConfig("headertext").length > 0 && (O = GetConfig("headertext")), SettingItem("header", O, "-1", GROUP_NOGROUP, "", "", "1", "");
            var x = "";
            !isNull(GetConfig("footer")) && GetConfig("footer").length > 0 && (x = Trim(GetConfig("footer"))), x.length < 1 && !isNull(GetConfig("footertext")) && GetConfig("footertext").length > 0 && (x = GetConfig("footertext")), SettingItem("footer", x, "-1", GROUP_NOGROUP, "", "", "1", "");
            var A = "";
            !isNull(GetConfig("logo")) && GetConfig("logo").length > 0 && (A = Trim(GetConfig("logo"))), SettingItem("logo", A, "-1", GROUP_NOGROUP, "", "", "1", "");
            var k = "";
            !isNull(GetConfig("version")) && GetConfig("version").length > 0 && (k = Trim(GetConfig("version"))), SettingItem("version", k, "-1", GROUP_NOGROUP, "", "", "1", "");
            var U = "";
            !isNull(GetConfig("messagedisplay")) && GetConfig("messagedisplay").length > 0 && (U = Trim(GetConfig("messagedisplay"))), SettingItem("messagedisplay", U, "-1", GROUP_NOGROUP, "", "", "1", "");
            var V = "";
            !isNull(GetConfig("messagepopup")) && GetConfig("messagepopup").length > 0 && (V = Trim(GetConfig("messagepopup"))), SettingItem("messagepopup", V, "-1", GROUP_NOGROUP, "", "", "1", "");
            var W = "";
            !isNull(GetConfig("advertisement")) && GetConfig("advertisement").length > 0 && (W = Trim(GetConfig("advertisement"))), SettingItem("advertisement", W, "-1", GROUP_NOGROUP, "", "", "1", "");
            var M = "";
            !isNull(GetConfig("helpurl")) && GetConfig("helpurl").length > 0 && (M = Trim(GetConfig("helpurl"))), SettingItem("helpurl", M, "-1", GROUP_NOGROUP, "", "", "1", "");
            var F = "";
            !isNull(GetConfig("licenseurl")) && GetConfig("licenseurl").length > 0 && (F = Trim(GetConfig("licenseurl"))), SettingItem("licenseurl", F, "-1", GROUP_NOGROUP, "", "", "1", "");
            var H = "";
            !isNull(GetConfig("extramenuurl")) && GetConfig("extramenuurl").length > 0 && (H = Trim(GetConfig("extramenuurl"))), SettingItem("extramenuurl", H, "-1", GROUP_NOGROUP, "", "", "1", "");
            var B = "";
            !isNull(GetConfig("extramenutxt")) && GetConfig("extramenutxt").length > 0 && (B = Trim(GetConfig("extramenutxt"))), SettingItem("extramenutxt", B, "-1", GROUP_NOGROUP, "", "", "1", "");
            var j = "0";
            !isNull(GetConfig("enablepresence")) && GetConfig("enablepresence").length > 0 && (j = Trim(GetConfig("enablepresence"))), SettingItem("enablepresence", j, "-1", GROUP_NOGROUP, "", "", "1", "0"), SettingItem("presencestatus", "Online", "2", GROUP_PROFILE, "Online,Away,DND,Invisible,Offline", "Online,Away,DND,Invisible,Offline", "1", "Online"), SettingItem("numexistscalled", "false", "-1", GROUP_NOGROUP, "", "", "1", "false"), SettingItem("servercontacts", "", "-1", GROUP_NOGROUP, "", "", "1", ""), SettingItem("verifyuser", "0", "-1", GROUP_NOGROUP, "", "", "1", "0"), SettingItem("srvcontacts", "", "-1", GROUP_NOGROUP, "", "", "1", "0");
            var $ = "false";
            !isNull(GetConfig("contacttoggle")) && GetConfig("contacttoggle").length > 0 && ($ = Trim(GetConfig("contacttoggle"))), SettingItem("contacttoggle", $, "-1", GROUP_NOGROUP, "", "", "1", "false"), SettingItem("last_callback_nr", "", "-1", GROUP_NOGROUP, "", "", "1", ""), SettingItem("callback_mode", "0", "2", GROUP_CALLDIVERT, "No,Ask,On no internet,On no WIFI,Always", "0,1,2,3,4", "1", "0"), SettingItem("accounts", "", "5", GROUP_SIP, "", "", "1", ""), SettingItem("reset_settings", "", "8", GROUP_GENERAL, "", "", "1", "");
            var q = "false";
            !isNull(GetConfig("voicerecording")) && GetConfig("voicerecording").length > 0 && ("true" == q || "false" == q) && (q = Trim(GetConfig("voicerecording"))), SettingItem("voicerecording", q, "0", GROUP_GENERAL, "", "", "1", q), SettingItem("ringtone", "", "8", GROUP_GENERAL, "Ringtone1,Ringtone2,Ringtone3", "0,1,2", "1", ""), SettingItem("changesptoring", "2", "2", GROUP_SIP, webphone_api.stringres.get("changesptoring__nothing") + "," + webphone_api.stringres.get("changesptoring__disp_ringing") + "," + webphone_api.stringres.get("changesptoring__start_media") + "," + webphone_api.stringres.get("changesptoring__start_media_disp"), "0,1,2,3", "1", "2");
            var z = "-1";
            isNull(GetConfig("transport")) || (z = GetConfigInt("transport", -1)), SettingItem("transport", z.toString(), "2", GROUP_SIP, "Auto,UDP,TCP,TLS", "-1,0,1,2", "1", z.toString()), SettingItem("defmute", "0", "2", GROUP_SIP, webphone_api.stringres.get("defmute__both") + "," + webphone_api.stringres.get("defmute__speakers_only") + "," + webphone_api.stringres.get("defmute__mic_only"), "0,1,2", "1", "2"), SettingItem("automute", "0", "2", GROUP_CALLDIVERT, webphone_api.stringres.get("automute__no") + "," + webphone_api.stringres.get("automute__incoming") + "," + webphone_api.stringres.get("automute__outgoing") + "," + webphone_api.stringres.get("automute__both") + "," + webphone_api.stringres.get("automute__other_line"), "0,1,2,3,4", "1", "0"), SettingItem("autohold", "0", "2", GROUP_CALLDIVERT, webphone_api.stringres.get("autohold__no") + "," + webphone_api.stringres.get("autohold__incoming") + "," + webphone_api.stringres.get("autohold__outgoing") + "," + webphone_api.stringres.get("autohold__both") + "," + webphone_api.stringres.get("autohold__other_line"), "0,1,2,3,4", "1", "0"), SettingItem("customsipheader", "", "1", GROUP_SIP, "", "", "1", ""), SettingItem("sendrtponmuted", "false", "0", GROUP_SIP, "", "", "1", "false"), SettingItem("capabilityrequest", "false", "0", GROUP_SIP, "", "", "1", "false"), SettingItem("devtest", "0,0,0,0,0,0,0,0,0", "8", GROUP_SIP, "", "", "1", "0,0,0,0,0,0,0,0,0"), SettingItem("enableaudio", "true", "0", GROUP_CALLDIVERT, "", "", "1", "true"), SettingItem("settobasefunctionality", "true", "8", GROUP_MAIN, "", "", "1", "true"), SettingItem("dialerintegration", "false", "0", GROUP_INTEGRATE, "", "", "1", "false"), SettingItem("screenrotation", "0", "2", GROUP_GENERAL, "Auto,No,Yes", "0,1,2", "1", "0"), SettingItem("audiobufferlength", "-1", "1", GROUP_MEDIA, "", "", "1", "-1"), SettingItem("keepaliveival", "28000", "1", GROUP_SIP, "", "", "1", "28000"), SettingItem("cpualwayspartiallock", "false", "0", GROUP_GENERAL, "", "", "1", "false"), SettingItem("disablewbforpstn", "1", "2", GROUP_MEDIA, "No,Yes (check on first call),Yes (check always)", "0,1,2", "1", "1"), SettingItem("storecallhistory", "1", "2", GROUP_GENERAL, "Local + Native,Local,Native,No history", "0,1,2,3", "1", "1"), SettingItem("keepdeviceawakeincall", "2", "2", GROUP_GENERAL, "No,Basic only,Auto,Full then partial,Always full", "0,1,2,3,4", "1", "2"), SettingItem("speakermode", "0", "2", GROUP_MEDIA, webphone_api.stringres.get("speakermode__auto") + "," + webphone_api.stringres.get("speakermode__never") + "," + webphone_api.stringres.get("speakermode__always"), "0,1,2", "1", "0"), SettingItem("focusaudio", "1", "2", GROUP_MEDIA, "Auto guess,No,Yes", "0,1,2", "1", "1"), SettingItem("useroutingapi", "0", "2", GROUP_MEDIA, "Auto,No,Yes", "0,1,2", "1", "0"), SettingItem("integrateifwifionly", "false", "0", GROUP_INTEGRATE, "", "", "1", "false"), SettingItem("nativefilterallow", "", "1", GROUP_INTEGRATE, "", "", "1", ""), SettingItem("nativefilterblock", "", "1", GROUP_INTEGRATE, "", "", "1", ""), SettingItem("companyname", "", "-1", GROUP_NOGROUP, "", "", "1", ""), SettingItem("supportpageuri", "", "-1", GROUP_NOGROUP, "", "", "1", ""), SettingItem("proversioncallcount", "0", "-1", GROUP_NOGROUP, "", "", "1", "0"), SettingItem("magicnumber", SETT_MAGIC_NUMBER, "-1", GROUP_NOGROUP, "", "", "1", SETT_MAGIC_NUMBER), SettingItem("upgradesettfromdatabase", "true", "-1", GROUP_NOGROUP, "", "", "1", "true"), SettingItem("cfgvideo", "4", "2", GROUP_VIDEO, "Never,On Request,Ask,Autoaccept,Always", "2,4,6,8,10", "1", "4"), SettingItem("video_profile", "0", "2", GROUP_VIDEO, "Auto,Low,Medium,High,Ultra,Extra", "0,4,6,8,10,15", "1", "0"), SettingItem("cust_lastautoprov", "0", "-1", GROUP_NOGROUP, "", "", "1", "0"), SettingItem("lastautoprov", "0", "-1", GROUP_NOGROUP, "", "", "1", "0"), SettingItem("loglastusage", "0", "-1", GROUP_NOGROUP, "", "", "1", "0"), SettingItem("callfunctionsbtnusage", "10,0,5,9,8,10,12,1,3,-2", "-1", GROUP_NOGROUP, "", "", "1"), SettingItem("redial", "", "-1", GROUP_NOGROUP, "", "", "1", ""), SettingItem("vibrate", "0", "2", GROUP_GENERAL, "Auto,Never,Always", "0,1,2", "1", "0"), SettingItem("video_fps", "0", "1", GROUP_VIDEO, "", "", "1", "0"), SettingItem("setfinalcodec", "1", "2", GROUP_MEDIA, webphone_api.stringres.get("setfinalcodec__never") + "," + webphone_api.stringres.get("setfinalcodec__auto") + "," + webphone_api.stringres.get("setfinalcodec__multiple_codec") + "," + webphone_api.stringres.get("setfinalcodec__always"), "0,1,2,3", "1", "1"), SettingItem("use_rport", "1", "2", GROUP_SIP, webphone_api.stringres.get("use_rport__no") + "," + webphone_api.stringres.get("use_rport__simmetric_nat") + "," + webphone_api.stringres.get("use_rport__always") + "," + webphone_api.stringres.get("use_rport__public_ip") + "," + webphone_api.stringres.get("use_rport__request"), "0,1,2,3,9", "1", "1"), SettingItem("natopenpackets", "2", "1", GROUP_SIP, "", "", "1", "2"), SettingItem("video_accept_checkbox", "false", "-1", GROUP_NOGROUP, "", "", "1", "false"), SettingItem("successfulcalls", "0", "-1", GROUP_NOGROUP, "", "", "1", "0"), SettingItem("webrtc_successfulcalls", "0", "-1", GROUP_NOGROUP, "", "", "1", "0"), SettingItem("wasrated", "false", "-1", GROUP_NOGROUP, "", "", "1", "false"), SettingItem("lastratedate", "0", "-1", GROUP_NOGROUP, "", "", "1", "0"),
                SettingItem("hidemyidentity", "false", "0", GROUP_SIP, "", "", "1", "false"), SettingItem("last_transfer_number", "", "-1", GROUP_NOGROUP, "", "", "1", ""), SettingItem("last_conference_number", "", "-1", GROUP_NOGROUP, "", "", "1", ""), SettingItem("last_forward_number", "", "-1", GROUP_NOGROUP, "", "", "1", ""), SettingItem("validprovisioning", "false", "-1", GROUP_NOGROUP, "", "", "1", "false"), SettingItem("jsscriptevent", "2", "-1", GROUP_NOGROUP, "", "", "1", "2"), SettingItem("devicetype", "" + DEVICE_WEBPHONE(), "-1", GROUP_NOGROUP, "", "", "1", "" + DEVICE_WEBPHONE()), SettingItem("extraoption", "", "1", GROUP_GENERAL, "", "", "1", ""), SettingItem("enginepriority_java", "2", "2", GROUP_SIP, "Disabled,Lower,Default,Higher,Highest,Force", "0,1,2,3,4,5", "1", "2"), SettingItem("enginepriority_webrtc", "2", "2", GROUP_SIP, "Disabled,Lower,Default,Higher,Highest,Force", "0,1,2,3,4,5", "1", "2"), SettingItem("enginepriority_ns", "2", "2", GROUP_SIP, "Disabled,Lower,Default,Higher,Highest,Force", "0,1,2,3,4,5", "1", "2"), SettingItem("enginepriority_flash", "2", "2", GROUP_SIP, "Disabled,Lower,Default,Higher,Highest,Force", "0,1,2,3,4,5", "1", "2"), SettingItem("enginepriority_app", "2", "2", GROUP_SIP, "Disabled,Lower,Default,Higher,Highest,Force", "0,1,2,3,4,5", "1", "2"), SettingItem("enginepriority_p2p", "2", "2", GROUP_SIP, "Disabled,Lower,Default,Higher,Highest,Force", "0,1,2,3,4,5", "1", "2"), SettingItem("enginepriority_accessnum", "2", "2", GROUP_SIP, "Disabled,Lower,Default,Higher,Highest,Force", "0,1,2,3,4,5", "1", "2"), SettingItem("enginepriority_nativedial", "2", "2", GROUP_SIP, "Disabled,Lower,Default,Higher,Highest,Force", "0,1,2,3,4,5", "1", "2"), SettingItem("enginepriority_otherbrowser", "2", "2", GROUP_SIP, "Disabled,Lower,Default,Higher,Highest,Force", "0,1,2,3,4,5", "1", "2"), SettingItem("engineoldavailable_java", "1", "-1", GROUP_NOGROUP, "", "", "1", "1"), SettingItem("engineoldavailable_webrtc", "1", "-1", GROUP_NOGROUP, "", "", "1", "1"), SettingItem("engineoldavailable_ns", "1", "-1", GROUP_NOGROUP, "", "", "1", "1"), SettingItem("engineoldavailable_flash", "1", "-1", GROUP_NOGROUP, "", "", "1", "1"), SettingItem("engineoldavailable_app", "1", "-1", GROUP_NOGROUP, "", "", "1", "1"), SettingItem("engineoldavailable_p2p", "1", "-1", GROUP_NOGROUP, "", "", "1", "1"), SettingItem("engineoldavailable_accessnum", "1", "-1", GROUP_NOGROUP, "", "", "1", "1"), SettingItem("engineoldavailable_nativedial", "1", "-1", GROUP_NOGROUP, "", "", "1", "1"), SettingItem("lastusedengine", "", "-1", GROUP_NOGROUP, "", "", "1", ""), SettingItem("ignoreengineselect", "false", "-1", GROUP_NOGROUP, "", "", "1", "false");
            var K = "";
            !isNull(GetConfig("pc_alternatebrowserurl")) && GetConfig("pc_alternatebrowserurl").length > 0 && (K = Trim(GetConfig("pc_alternatebrowserurl"))), SettingItem("pc_alternatebrowserurl", K, "-1", GROUP_NOGROUP, "", "", "1", ""), SettingItem("lccnr", "0", "-1", GROUP_NOGROUP, "", "", "1", "0"), SettingItem("vdnr", "0", "-1", GROUP_NOGROUP, "", "", "1", "0");
            var X = "";
            !isNull(GetConfig("ios_nativedialerurl")) && GetConfig("ios_nativedialerurl").length > 0 && (X = Trim(GetConfig("ios_nativedialerurl"))), SettingItem("ios_nativedialerurl", X, "-1", GROUP_NOGROUP, "", "", "1", "");
            var J = "";
            !isNull(GetConfig("android_nativedialerurl")) && GetConfig("android_nativedialerurl").length > 0 && (J = Trim(GetConfig("android_nativedialerurl"))), SettingItem("android_nativedialerurl", J, "-1", GROUP_NOGROUP, "", "", "1", "");
            var Y = "";
            !isNull(GetConfig("showsynccontactsmenu")) && GetConfig("showsynccontactsmenu").length > 0 && (Y = Trim(GetConfig("showsynccontactsmenu"))), SettingItem("showsynccontactsmenu", Y, "-1", GROUP_NOGROUP, "", "", "1", "");
            var Q = "";
            !isNull(GetConfig("accessnumber")) && GetConfig("accessnumber").length > 0 && (Q = Trim(GetConfig("accessnumber"))), SettingItem("accessnumber", Q, "-1", GROUP_NOGROUP, "", "", "1", "");
            var Z = "0";
            !isNull(GetConfig("colortheme")) && GetConfig("colortheme").length > 0 && (Z = Trim(GetConfig("colortheme"))), SettingItem("theme", Z, "2", GROUP_GENERAL, "Webphone,Light Blue,Light Green,Light Orange,Light Purple,Dark Red,Yellow,Blue,Purple,Turquoise,Light Skin,Green Orange,Custom 1,Custom 2,Custom 3,Custom 4,Custom 5", "0,1,2,3,4,5,6,7,8,9,10,11,14,15,16,18,19", "1", "0");
            var ee = "-1";
            !isNull(GetConfig("useloginpage")) && GetConfig("useloginpage").length > 0 && (ee = Trim(GetConfig("useloginpage"))), SettingItem("useloginpage", ee, "-1", GROUP_NOGROUP, "", "", "1", "-1");
            var oe = "10";
            !isNull(GetConfig("featureset")) && GetConfig("featureset").length > 0 && (oe = Trim(GetConfig("featureset"))), SettingItem("featureset", oe, "-1", GROUP_NOGROUP, "", "", "1", oe), SettingItem("wsusers", "", "-1", GROUP_NOGROUP, "", "", "1", ""), SettingItem("mainconfigs", "", "-1", GROUP_NOGROUP, "", "", "1", ""), SettingItem("notifications2", "", "-1", GROUP_NOGROUP, "", "", "1", ""), SettingItem("canshowlickeyinput", "", "-1", GROUP_NOGROUP, "", "", "1", ""), SettingItem("normalizenumber", "-1", "2", GROUP_CALLDIVERT, webphone_api.stringres.get("normalizenumber__auto") + "," + webphone_api.stringres.get("normalizenumber__no") + "," + webphone_api.stringres.get("normalizenumber__yes"), "-1,0,1", "1", "-1");
            var te = "";
            !isNull(GetConfig("callforwardonbusy")) && GetConfig("callforwardonbusy").length > 0 && (te = Trim(GetConfig("callforwardonbusy"))), SettingItem("callforwardonbusy", te, "1", GROUP_CALLDIVERT, "", "", "1", "");
            var ne = "";
            !isNull(GetConfig("callforwardonnoanswer")) && GetConfig("callforwardonnoanswer").length > 0 && (ne = Trim(GetConfig("callforwardonnoanswer"))), SettingItem("callforwardonnoanswer", ne, "1", GROUP_CALLDIVERT, "", "", "1", "");
            var ie = "15";
            !isNull(GetConfig("callforwardonnoanswertimeout")) && GetConfig("callforwardonnoanswertimeout").length > 0 && (ie = Trim(GetConfig("callforwardonnoanswertimeout"))), SettingItem("callforwardonnoanswertimeout", ie, "1", GROUP_CALLDIVERT, "", "", "1", "");
            var ae = "";
            !isNull(GetConfig("callforwardalways")) && GetConfig("callforwardalways").length > 0 && (ae = Trim(GetConfig("callforwardalways"))), SettingItem("callforwardalways", ae, "1", GROUP_CALLDIVERT, "", "", "1", "");
            var re = "";
            !isNull(GetConfig("calltransferalways")) && GetConfig("calltransferalways").length > 0 && (re = Trim(GetConfig("calltransferalways"))), SettingItem("calltransferalways", re, "1", GROUP_CALLDIVERT, "", "", "1", "");
            var se = "0";
            !isNull(GetConfig("autoignore")) && GetConfig("autoignore").length > 0 && (se = Trim(GetConfig("autoignore"))), SettingItem("autoignore", se, "2", GROUP_CALLDIVERT, webphone_api.stringres.get("autoignore__dont") + "," + webphone_api.stringres.get("autoignore__silently") + "," + webphone_api.stringres.get("autoignore__reject"), "0,1,2", "1", "0");
            var le = "false";
            !isNull(GetConfig("autoaccept")) && GetConfig("autoaccept").length > 0 && (le = Trim(GetConfig("autoaccept"))), SettingItem("autoaccept", le, "0", GROUP_CALLDIVERT, "", "", "1", "false"), SettingItem("filters", "", "5", GROUP_CALLDIVERT, "", "", "1", ""), SettingItem("blocked_contacts", "", "-1", GROUP_NOGROUP, "", "", "1", ""), SettingItem("usemizutlsproxy", "1", "-1", GROUP_NOGROUP, "No,Auto,Yes", "0,1,2", "1", ""), SettingItem("usemizutlsproxy_userreload", "", "-1", GROUP_NOGROUP, "", "0,1,2", "1", ""), SettingItem("notification_count2", "0", "-1", GROUP_NOGROUP, "", "", "1", "0"), SettingItem("autostart", "1", "-1", GROUP_NOGROUP, "", "", "1", "1"), SettingItem("displaypeerdetails", "0", "-1", GROUP_NOGROUP, "", "", "1", "0"), SettingItem("rejectonbusy", "false", "-1", GROUP_NOGROUP, "", "", "1", "false"), SettingItem("voicerecupload", "", "-1", GROUP_NOGROUP, "", "", "1", ""), SettingItem("lastsessionsuccess", "0", "-1", GROUP_NOGROUP, "", "", "1", "0"), SettingItem("codec", "-1", "3", GROUP_MEDIA, "Optimal,PCMU,PCMA,GSM,iLBC,SPEEX,SPEEX-WB,G.729,Opus,OpusWB,OpusUWB", "-1,1,2,3,4,5,6,8,10,11,13", "1", "-1"), GetCodecsFromApiParam(), SettingItem("videocodec", "-1", "3", GROUP_MEDIA, "Optimal,H264,VP8,VP9", "-1", "1", "-1"), SettingItem("use_h264", "true", "0", GROUP_MEDIA, "", "", "1", "true"), SettingItem("use_vp8", "true", "0", GROUP_MEDIA, "", "", "1", "true"), SettingItem("use_vp9", "true", "0", GROUP_MEDIA, "", "", "1", "true"), SettingItem("blacklist", "", "1", GROUP_CALLDIVERT, "", "", "1", ""), SettingItem("sel_rtc_audio_in", "", "-1", GROUP_NOGROUP, "", "", "1", ""), SettingItem("sel_rtc_audio_out", "", "-1", GROUP_NOGROUP, "", "", "1", ""), SettingItem("sel_rtc_video_in", "", "-1", GROUP_NOGROUP, "", "", "1", ""), SettingItem("audiodevices", "", "8", GROUP_MEDIA, "", "", "1", ""), SettingItem("autoaction", "0", "-1", GROUP_NOGROUP, "", "", "1", "0"), SettingItem("webcallme", "1", "-1", GROUP_NOGROUP, "", "", "1", "1");
            var pe = GetConfigInt("conferencetype", 1);
            SettingItem("conferencetype", pe.toString(), "2", GROUP_CALLDIVERT, webphone_api.stringres.get("conferencetype__disabled") + "," + webphone_api.stringres.get("conferencetype__auto") + "," + webphone_api.stringres.get("conferencetype__native") + "," + webphone_api.stringres.get("conferencetype__server") + "," + webphone_api.stringres.get("conferencetype__3way") + "," + webphone_api.stringres.get("conferencetype__cr_msg_ref") + "," + webphone_api.stringres.get("conferencetype__cr_msg") + "," + webphone_api.stringres.get("conferencetype__cr_ref"), "0,1,2,3,4,5,6,7", "1", pe.toString()), SettingItem("received_confrooms", "", "-1", GROUP_NOGROUP, "", "", "1", "");
            var ce = "";
            !isNull(GetConfig("callbacknumber")) && GetConfig("callbacknumber").length > 0 && (ce = Trim(GetConfig("callbacknumber"))), SettingItem("callbacknumber", ce, "1", GROUP_CALLDIVERT, "", "", "1", ""), SettingItem("iswebrtcuppersrvfromuser", "false", "-1", GROUP_NOGROUP, "", "", "1", "false"), SettingItem("java_worked", "false", "-1", GROUP_NOGROUP, "", "", "1", "false"), SettingItem("ns_worked", "false", "-1", GROUP_NOGROUP, "", "", "1", "false"), SettingItem("webrtc_worked", "false", "-1", GROUP_NOGROUP, "", "", "1", "false");
            var ue = "-1";
            !isNull(GetConfig("video")) && GetConfig("video").length > 0 && (ue = Trim(GetConfig("video"))), SettingItem("video", ue, "2", GROUP_MEDIA, webphone_api.stringres.get("video__auto") + "," + webphone_api.stringres.get("video__disable") + "," + webphone_api.stringres.get("video__enable") + "," + webphone_api.stringres.get("video__force"), "-1,0,1,2", "1", "1");
            var he = "0";
            !isNull(GetConfig("video_bandwidth")) && GetConfig("video_bandwidth").length > 0 && (he = Trim(GetConfig("video_bandwidth"))), SettingItem("video_bandwidth", he, "1", GROUP_MEDIA, "", "", "1", "0");
            var me = "640";
            !isNull(GetConfig("video_width")) && GetConfig("video_width").length > 0 && (me = Trim(GetConfig("video_width"))), SettingItem("video_width", me, "1", GROUP_MEDIA, "", "", "1", "640");
            var ge = "480";
            !isNull(GetConfig("video_height")) && GetConfig("video_height").length > 0 && (ge = Trim(GetConfig("video_height"))), SettingItem("video_height", ge, "1", GROUP_MEDIA, "", "", "1", "480"), SettingItem("androidchromedisplayed", "false", "-1", GROUP_NOGROUP, "", "", "1", "false"), SettingItem("conf_engineswitcheoffered", "false", "-1", GROUP_NOGROUP, "", "", "1", "false"), SettingItem("transf_engineswitcheoffered", "false", "-1", GROUP_NOGROUP, "", "", "1", "false"), SettingItem("filterchatduplicates", "true", "-1", GROUP_NOGROUP, "", "", "1", "true");
            var de = "true";
            !isNull(GetConfig("has_video")) && GetConfig("has_video").length > 0 && (de = Trim(GetConfig("has_video"))), "0" === GetParameter2("video") && (de = "false"), SettingItem("has_video", de, "1", GROUP_MEDIA, "", "", "1", de), SettingItem("sendchatonenter", "true", "0", GROUP_GENERAL, "", "", "1", "true");
            var be = "-1";
            !isNull(GetConfig("transfwithreplace")) && GetConfig("transfwithreplace").length > 0 && (be = Trim(GetConfig("transfwithreplace"))), SettingItem("transfwithreplace", be, "2", GROUP_CALLDIVERT, webphone_api.stringres.get("transfwithreplace__auto") + "," + webphone_api.stringres.get("transfwithreplace__no") + "," + webphone_api.stringres.get("transfwithreplace__yes"), "-1,0,1", "1", "-1"), SettingItem("acceptcall_onsharedevice", "1", "-1", GROUP_NOGROUP, "", "", "1", "1"), SettingItem("showratewhiletype_minlenth", "3", "-1", GROUP_NOGROUP, "", "", "1", "3"), SettingItem("showratewhiletype_maxlenth", "6", "-1", GROUP_NOGROUP, "", "", "1", "6");
            var _e = "1";
            !isNull(GetConfig("multilinegui")) && GetConfig("multilinegui").length > 0 && (_e = Trim(GetConfig("multilinegui"))), SettingItem("multilinegui", _e, "-1", GROUP_NOGROUP, "", "", "1", _e), SettingItem("enginechecksum", "", "-1", GROUP_NOGROUP, "", "", "1", ""), SettingItem("redialonfail", "1", "-1", GROUP_NOGROUP, "", "", "1", "1"), SettingItem("autosrvupgrade", "1", "-1", GROUP_NOGROUP, "", "", "1", "1"), SettingItem("srvupgrade_count", "0", "-1", GROUP_NOGROUP, "", "", "1", "0"), SettingItem("srvupgrade_version", "", "-1", GROUP_NOGROUP, "", "", "1", ""), SettingItem("srvupgrade_currversion", "-1", "-1", GROUP_NOGROUP, "", "", "1", "-1"), SettingItem("srvupgrade_currversion_extcmd_test", "-1", "-1", GROUP_NOGROUP, "", "", "1", "-1"), SettingItem("srv_exe_version", "0", "-1", GROUP_NOGROUP, "", "", "1", "-1"), SettingItem("srv_java_version", "0", "-1", GROUP_NOGROUP, "", "", "1", "-1");
            var fe = "1";
            0 == GetConfigBool("useaudiodevicerecord", !0) && (fe = "0"), SettingItem("checkmicrophone", fe, "-1", GROUP_NOGROUP, "", "", "1", fe), SettingItem("fasthold", "0", "-1", GROUP_NOGROUP, "", "", "1", "-1");
            SettingItem("calldivertchecksum", Md5Hash(te + ne + ae + ie), "-1", GROUP_NOGROUP, "", "", "1", ""), SettingItem("calldivertsuccess", "-1", "-1", GROUP_NOGROUP, "", "", "1", "-1"), SettingItem("muteholdalllines", "0", "-1", GROUP_NOGROUP, "", "", "1", "0");
            var we = "1";
            !isNull(GetConfig("allowcallredirect")) && GetConfig("allowcallredirect").length > 0 && (we = Trim(GetConfig("allowcallredirect"))), SettingItem("allowcallredirect", we, "-1", GROUP_NOGROUP, "", "", "1", we);
            var ve = "1";
            !isNull(GetConfig("playdtmfsound")) && GetConfig("playdtmfsound").length > 0 && (ve = Trim(GetConfig("playdtmfsound"))), SettingItem("playdtmfsound", ve, "-1", GROUP_NOGROUP, "", "", "1", ve);
            var Ee = "en";
            "rigitel" === GetConfig("brandname").toLowerCase() && (Ee = "de"), isNull(GetConfig("language")) || 2 !== GetConfig("language").length || (Ee = Trim(GetConfig("language"))), SettingItem("language", Ee, "2", GROUP_GENERAL, "English,German,Hungarian,Portuguese", "en,de,hu,pt", "1", "en"), SettingItem("chrome_local_alert_displayed", "false", "-1", GROUP_NOGROUP, "", "", "1", "false");
            var Te = GetConfig("telsearchurl");
            !isNull(Te) && Te.length > 0 && SettingItem("telsearchkey", "3606e399f2ec49f31831949efba6daf1", "1", GROUP_GENERAL, "", "", "1", "3606e399f2ec49f31831949efba6daf1");
            var Pe = "1";
            !isNull(GetConfig("screensharing")) && GetConfig("screensharing").length > 0 && (Pe = Trim(GetConfig("screensharing"))), SettingItem("screensharing", Pe, "-1", GROUP_NOGROUP, "", "", "1", Pe), SettingItem("extraregisteraccounts", "", "-1", GROUP_NOGROUP, "", "", "1", ""), SettingItem("lastsucc", "-1", "-1", GROUP_NOGROUP, "", "", "1", "-1"), SettingItem("enproblem", "0", "-1", GROUP_NOGROUP, "", "", "1", "0");
            var Se = "0";
            !isNull(GetConfig("audio_bandwidth")) && GetConfig("audio_bandwidth").length > 0 && (Se = Trim(GetConfig("audio_bandwidth"))), SettingItem("audio_bandwidth", Se, "1", GROUP_MEDIA, "", "", "1", "0");
            var Ne = "1";
            !isNull(GetConfig("enablepres_httpapi")) && GetConfig("enablepres_httpapi").length > 0 && (Ne = Trim(GetConfig("enablepres_httpapi"))), SettingItem("enablepres_httpapi", Ne, "-1", GROUP_NOGROUP, "", "", "1", "1");
            var Ie = "1";
            !isNull(GetConfig("enablepres_javaapi")) && GetConfig("enablepres_javaapi").length > 0 && (Ie = Trim(GetConfig("enablepres_javaapi"))), SettingItem("enablepres_javaapi", Ie, "-1", GROUP_NOGROUP, "", "", "1", "1");
            var Ce = "1";
            !isNull(GetConfig("enablepres_webrtc")) && GetConfig("enablepres_webrtc").length > 0 && (Ce = Trim(GetConfig("enablepres_webrtc"))), SettingItem("enablepres_webrtc", Ce, "-1", GROUP_NOGROUP, "", "", "1", "1");
            var Re = "1";
            !isNull(GetConfig("incomingcallpopup")) && GetConfig("incomingcallpopup").length > 0 && (Re = Trim(GetConfig("incomingcallpopup"))), SettingItem("incomingcallpopup", Re, "2", GROUP_GENERAL, webphone_api.stringres.get("incomingcallpopup__no") + "," + webphone_api.stringres.get("incomingcallpopup__auto") + "," + webphone_api.stringres.get("incomingcallpopup__yes") + "," + webphone_api.stringres.get("incomingcallpopup__always"), "0,1,2,3", "1", "1"), SettingItem("wpfirststart", "true", "-1", GROUP_NOGROUP, "", "", "1", "true"), SettingItem("useragent", "", "-1", GROUP_NOGROUP, "", "", "1", "");
            var ye = "1";
            !isNull(GetConfig("allowsipuriasusername")) && GetConfig("allowsipuriasusername").length > 0 && (ye = Trim(GetConfig("allowsipuriasusername")));
            var Le = GetConfigInt("enabledirectcalls", -5);
            Le >= 0 && (ye = Le.toString()), SettingItem("allowsipuriasusername", ye, "-1", GROUP_NOGROUP, "", "", "1", "0");
            var De = "0";
            !isNull(GetConfig("beeponconnect")) && GetConfig("beeponconnect").length > 0 && (De = Trim(GetConfig("beeponconnect"))), SettingItem("beeponconnect", De, "-1", GROUP_NOGROUP, "", "", "1", "0");
            var Ge = "0";
            !isNull(GetConfig("disablepopups")) && GetConfig("disablepopups").length > 0 && (Ge = Trim(GetConfig("disablepopups"))), SettingItem("disablepopups", Ge, "-1", GROUP_NOGROUP, "", "", "1", Ge);
            var Oe = "true";
            !isNull(GetConfig("showtoasts")) && GetConfig("showtoasts").length > 0 && (Oe = Trim(GetConfig("showtoasts"))), SettingItem("showtoasts", Oe, "-1", GROUP_NOGROUP, "", "", "1", "true"), SettingItem("isfirstcallfwd", "true", "-1", GROUP_NOGROUP, "", "", "1", "true");
            var xe = "0";
            !isNull(GetConfig("beeponincoming")) && GetConfig("beeponincoming").length > 0 && (xe = Trim(GetConfig("beeponincoming"))), SettingItem("beeponincoming", xe, "0", GROUP_GENERAL, "", "", "1", "0");
            var Ae = "2";
            !isNull(GetConfig("flash")) && GetConfig("flash").length > 0 && (Ae = Trim(GetConfig("flash"))), SettingItem("flash", Ae, "0", GROUP_GENERAL, "", "", "1", "2");
            var ke = "1";
            !isNull(GetConfig("importonlywithnum")) && GetConfig("importonlywithnum").length > 0 && (ke = Trim(GetConfig("importonlywithnum"))), SettingItem("importonlywithnum", ke, "2", GROUP_GENERAL, webphone_api.stringres.get("importonlywithnum__no") + "," + webphone_api.stringres.get("importonlywithnum__yes"), "0,1", "1", "1");
            var Ue = "2";
            !isNull(GetConfig("videomode")) && GetConfig("videomode").length > 0 && (Ue = Trim(GetConfig("importonlywithnum"))), SettingItem("videomode", Ue, "2", GROUP_MEDIA, webphone_api.stringres.get("videomode__always") + "," + webphone_api.stringres.get("videomode__noask") + "," + webphone_api.stringres.get("videomode__askonce") + "," + webphone_api.stringres.get("videomode__alwaysask") + "," + webphone_api.stringres.get("videomode__disable"), "1,2,3,4,5", "1", "2");
            var Ve = "2";
            !isNull(GetConfig("sscontrol")) && GetConfig("sscontrol").length > 0 && (Ve = Trim(GetConfig("sscontrol"))), SettingItem("sscontrol", Ve, "0", GROUP_SCRSHARE, "", "", "1", "2");
            var We = "2";
            !isNull(GetConfig("ssscroll")) && GetConfig("ssscroll").length > 0 && (We = Trim(GetConfig("ssscroll"))), SettingItem("ssscroll", We, "0", GROUP_SCRSHARE, "", "", "1", "2");
            var Me = "1";
            !isNull(GetConfig("sstop")) && GetConfig("sstop").length > 0 && (Me = Trim(GetConfig("sstop"))), SettingItem("sstop", Me, "0", GROUP_SCRSHARE, "", "", "1", "1");
            var Fe = "2";
            !isNull(GetConfig("ssquality")) && GetConfig("ssquality").length > 0 && (Fe = Trim(GetConfig("ssquality"))), SettingItem("ssquality", Fe, "2", GROUP_SCRSHARE, webphone_api.stringres.get("ssquality__low") + "," + webphone_api.stringres.get("ssquality__medium") + "," + webphone_api.stringres.get("ssquality__high"), "1,2,3", "1", "2");
            var He = "";
            !isNull(GetConfig("bundlepolicy")) && GetConfig("bundlepolicy").length > 0 && (He = Trim(GetConfig("bundlepolicy"))), SettingItem("bundlepolicy", He, "-1", GROUP_NOGROUP, "", "", "1", He);
            var Be = "";
            !isNull(GetConfig("icecandidatepoolsize")) && GetConfig("icecandidatepoolsize").length > 0 && (Be = Trim(GetConfig("icecandidatepoolsize"))), SettingItem("icecandidatepoolsize", Be, "-1", GROUP_NOGROUP, "", "", "1", Be);
            var je = "";
            !isNull(GetConfig("icetransportpolicy")) && GetConfig("icetransportpolicy").length > 0 && (je = Trim(GetConfig("icetransportpolicy"))), SettingItem("icetransportpolicy", je, "-1", GROUP_NOGROUP, "", "", "1", je);
            var $e = "0";
            !isNull(GetConfig("displayvideodevice")) && GetConfig("displayvideodevice").length > 0 && ($e = Trim(GetConfig("displayvideodevice"))), SettingItem("displayvideodevice", $e, "-1", GROUP_NOGROUP, "", "", "1", $e);
            var qe = "30000";
            !isNull(GetConfig("wskeepaliveival")) && GetConfig("wskeepaliveival").length > 0 && (qe = Trim(GetConfig("wskeepaliveival"))), SettingItem("wskeepaliveival", qe, "-1", GROUP_NOGROUP, "", "", "1", qe);
            var ze = "1";
            !isNull(GetConfig("enableblf")) && GetConfig("enableblf").length > 0 && (ze = Trim(GetConfig("enableblf"))), SettingItem("enableblf", ze, "-1", GROUP_SIP, "", "", "1", ze);
            var Ke = "";
            !isNull(GetConfig("profilestatustext")) && GetConfig("profilestatustext").length > 0 && (Ke = Trim(GetConfig("profilestatustext"))), SettingItem("profilestatustext", Ke, "1", GROUP_PROFILE, "", "", "1", Ke);
            var Xe = "0";
            !isNull(GetConfig("share_location")) && GetConfig("share_location").length > 0 && (Xe = Trim(GetConfig("share_location"))), SettingItem("share_location", Xe, "2", GROUP_PROFILE, webphone_api.stringres.get("share_location__no") + "," + webphone_api.stringres.get("share_location__yes"), "0,1", "1", Xe);
            var Je = "";
            !isNull(GetConfig("profilepicture")) && GetConfig("profilepicture").length > 0 && (Je = Trim(GetConfig("profilepicture"))), SettingItem("profilepicture", Je, "1", GROUP_PROFILE, "", "", "1", Je), SettingItem("profilehistory", "", "-1", GROUP_NOGROUP, "", "", "1", "");
            var Ye = "1";
            !isNull(GetConfig("p2psignaling")) && GetConfig("p2psignaling").length > 0 && (Ye = Trim(GetConfig("p2psignaling"))), SettingItem("p2psignaling", Ye, "-1", GROUP_NOGROUP, "", "", "1", Ye), SettingItem("nsupdate", "-1", "-1", GROUP_NOGROUP, "", "", "1", "-1"), SettingItem("lastwpapixxx", "", "-1", GROUP_NOGROUP, "", "", "1", "");
            var Qe = "1";
            !isNull(GetConfig("androidspeaker")) && GetConfig("androidspeaker").length > 0 && (Qe = Trim(GetConfig("androidspeaker"))), SettingItem("androidspeaker", Qe, "2", GROUP_MEDIA, webphone_api.stringres.get("androidspeaker__def") + "," + webphone_api.stringres.get("androidspeaker__before_fcall") + "," + webphone_api.stringres.get("androidspeaker__after_fcall") + "," + webphone_api.stringres.get("androidspeaker__atstart"), "0,1,2,3", "1", Qe);
            var Ze = [];
            Ze.push("w"), Ze.push("s"), Ze.push("s"), Ze.push(":"), Ze.push("/"), Ze.push("/"), Ze.push("d"), Ze.push("e"), Ze.push("m"), Ze.push("o"), Ze.push("s"), Ze.push("."), Ze.push("k"), Ze.push("a"), Ze.push("a"), Ze.push("z"), Ze.push("i"), Ze.push("n"), Ze.push("g"), Ze.push("."), Ze.push("c"), Ze.push("o"), Ze.push("m"), Ze.push("/"), Ze.push("e"), Ze.push("c"), Ze.push("h"), Ze.push("o"), Ze.push(","), Ze.push("w"), Ze.push("s"), Ze.push("s"), Ze.push(":"), Ze.push("/"), Ze.push("/"), Ze.push("e"), Ze.push("c"), Ze.push("h"), Ze.push("o"), Ze.push("."), Ze.push("w"), Ze.push("e"), Ze.push("b"), Ze.push("s"), Ze.push("o"), Ze.push("c"), Ze.push("k"), Ze.push("e"), Ze.push("t"), Ze.push("."), Ze.push("o"), Ze.push("r"), Ze.push("g"), Ze.push(","), Ze.push("w"), Ze.push("s"), Ze.push("s"), Ze.push(":"), Ze.push("/"), Ze.push("/"), Ze.push("w"), Ze.push("e"), Ze.push("b"), Ze.push("s"), Ze.push("o"), Ze.push("c"), Ze.push("k"), Ze.push("e"), Ze.push("t"), Ze.push("s"), Ze.push("t"), Ze.push("e"), Ze.push("s"), Ze.push("t"), Ze.push("."), Ze.push("c"), Ze.push("o"), Ze.push("m"), Ze.push(":"), Ze.push("4"), Ze.push("4"), Ze.push("3"), Ze.push("/"), Ze.push("s"), Ze.push("e"), Ze.push("r"), Ze.push("v"), Ze.push("i"), Ze.push("c"), Ze.push("e"), Ze.push(","), Ze.push("w"), Ze.push("s"), Ze.push("s"), Ze.push(":"), Ze.push("/"), Ze.push("/"), Ze.push("l"), Ze.push("i"), Ze.push("b"), Ze.push("w"), Ze.push("e"), Ze.push("b"), Ze.push("s"), Ze.push("o"), Ze.push("c"), Ze.push("k"), Ze.push("e"), Ze.push("t"), Ze.push("s"), Ze.push("."), Ze.push("o"), Ze.push("r"), Ze.push("g");
            var eo = Ze.join("");
            SettingItem("wstestservers", eo, "-1", GROUP_NOGROUP, "", "", "1", eo), SettingItem("lastgood_wstest", "", "-1", GROUP_NOGROUP, "", "", "1", ""), SettingItem("domaintoip_cache", "", "-1", GROUP_NOGROUP, "", "", "1", ""), SettingItem("last_clientreset", "-1", "-1", GROUP_NOGROUP, "", "", "1", "-1"), SettingItem("last_clientresetall", "-1", "-1", GROUP_NOGROUP, "", "", "1", "-1");
            var oo = "1";
            !isNull(GetConfig("alwaysallowlowcodec")) && GetConfig("alwaysallowlowcodec").length > 0 && (oo = Trim(GetConfig("alwaysallowlowcodec"))), SettingItem("alwaysallowlowcodec", oo, "2", GROUP_MEDIA, webphone_api.stringres.get("alwaysallowlowcodec__never") + "," + webphone_api.stringres.get("alwaysallowlowcodec__auto") + "," + webphone_api.stringres.get("alwaysallowlowcodec__always"), "0,1,2", "1", oo);
            var to = "90";
            !isNull(GetConfig("keeprecfiles")) && GetConfig("keeprecfiles").length > 0 && (to = Trim(GetConfig("keeprecfiles"))), SettingItem("keeprecfiles", to, "1", GROUP_GENERAL, "", "", "1", to);
            var no = "0";
            !isNull(GetConfig("sipprotocol")) && GetConfig("sipprotocol").length > 0 && (no = Trim(GetConfig("sipprotocol"))), SettingItem("sipprotocol", no, "-1", GROUP_NOGROUP, "", "", "1", no), SettingItem("resetsettings", "false", "-1", GROUP_NOGROUP, "", "", "1", "false"), SettingItem("wphoneappurl", "", "-1", GROUP_NOGROUP, "", "", "1", ""), SettingItem("needunregister", "true", "-1", GROUP_NOGROUP, "", "", "1", "true");
            var io = "-1";
            !isNull(GetConfig("holdtype")) && GetConfig("holdtype").length > 0 && (io = Trim(GetConfig("holdtype"))), SettingItem("holdtype", io, "2", GROUP_CALLDIVERT, webphone_api.stringres.get("holdtype__never") + "," + webphone_api.stringres.get("holdtype__auto") + "," + webphone_api.stringres.get("holdtype__no") + "," + webphone_api.stringres.get("holdtype__notused") + "," + webphone_api.stringres.get("holdtype__hold") + "," + webphone_api.stringres.get("holdtype__otherparty") + "," + webphone_api.stringres.get("holdtype__both"), "-2,-1,0,1,2,3,4", "1", io);
            var ao = "0";
            !isNull(GetConfig("colorizelog")) && GetConfig("colorizelog").length > 0 && (ao = Trim(GetConfig("colorizelog"))), SettingItem("colorizelog", ao, "-1", GROUP_NOGROUP, "", "", "1", ao);
            var ro = "1";
            !isNull(GetConfig("forcereregister")) && GetConfig("forcereregister").length > 0 && (ro = Trim(GetConfig("forcereregister"))), SettingItem("forcereregister", ro, "-1", GROUP_NOGROUP, "", "", "1", ro);
            var so = "0";
            !isNull(GetConfig("enablepush")) && GetConfig("enablepush").length > 0 && (so = Trim(GetConfig("enablepush"))), SettingItem("enablepush", so, "2", GROUP_GENERAL, webphone_api.stringres.get("enablepush__auto") + "," + webphone_api.stringres.get("enablepush__no") + "," + webphone_api.stringres.get("enablepush__yes"), "-1,0,1", "1", so);
            var lo = "-1";
            !isNull(GetConfig("callreceiver")) && GetConfig("callreceiver").length > 0 && (lo = Trim(GetConfig("callreceiver"))), SettingItem("callreceiver", lo, "-1", GROUP_NOGROUP, webphone_api.stringres.get("callreceiver__auto") + "," + webphone_api.stringres.get("callreceiver__noincoming") + "," + webphone_api.stringres.get("callreceiver__enablewhilerunning") + "," + webphone_api.stringres.get("callreceiver__enablebackgroud"), "-1,0,1,2", "1", lo), SettingItem("appinstalltime", GetTickCount().toString(), "-1", GROUP_NOGROUP, "", "", "1", GetTickCount().toString()), SettingItem("lastincalltime", "0", "-1", GROUP_NOGROUP, "", "", "1", "0");
            var ze = "1";
            !isNull(GetConfig("enableblf")) && GetConfig("enableblf").length > 0 && (ze = Trim(GetConfig("enableblf"))), SettingItem("enableblf", ze, "2", GROUP_SIP, webphone_api.stringres.get("enableblf__no") + "," + webphone_api.stringres.get("enableblf__auto") + "," + webphone_api.stringres.get("enableblf__always") + "," + webphone_api.stringres.get("enableblf__must"), "0,1,2,3", "1", ze), SettingItem("firststart_webrtc", "true", "-1", GROUP_NOGROUP, "", "", "1", "true");
            var po = "2";
            !isNull(GetConfig("dropsameoldcall")) && GetConfig("dropsameoldcall").length > 0 && (po = Trim(GetConfig("dropsameoldcall"))), SettingItem("dropsameoldcall", po, "2", GROUP_CALLDIVERT, webphone_api.stringres.get("dropsameoldcall__no") + "," + webphone_api.stringres.get("dropsameoldcall__requested") + "," + webphone_api.stringres.get("dropsameoldcall__reqvideo") + "," + webphone_api.stringres.get("dropsameoldcall__forall"), "0,1,2,3", "1", po), SettingItem("wseverconnected", "false", "-1", GROUP_NOGROUP, "", "", "1", "false"), SettingItem("sortcontacts", "0", "-1", GROUP_NOGROUP, "", "", "1", "0"), SettingItem("filtercontacts", "0", "-1", GROUP_NOGROUP, "", "", "1", "0"), SettingItem("lastfilterval", "0", "-1", GROUP_NOGROUP, "", "", "1", "0");
            var co = "";
            !isNull(GetConfig("serveraddressbook_url")) && GetConfig("serveraddressbook_url").length > 0 && (co = Trim(GetConfig("serveraddressbook_url"))), SettingItem("serveraddressbook_url", co, "-1", GROUP_NOGROUP, "", "", "1", co);
            var uo = "0";
            !isNull(GetConfig("serveraddressbook_sync")) && GetConfig("serveraddressbook_sync").length > 0 && (uo = Trim(GetConfig("serveraddressbook_sync"))), SettingItem("serveraddressbook_sync", uo, "-1", GROUP_NOGROUP, "", "", "1", uo), SettingItem("serveraddressbook_status", "0", "-1", GROUP_NOGROUP, "", "", "1", "0"), SettingItem("last_good_webrtc_gw", "", "-1", GROUP_NOGROUP, "", "", "1", ""), SettingItem("last_login_failed", "false", "-1", GROUP_NOGROUP, "", "", "1", "false"), SettingItem("startpage_disp_count", "0", "-1", GROUP_NOGROUP, "", "", "1", "0");
            var ho = "false";
            !isNull(GetConfig("mustconnect")) && GetConfig("mustconnect").length > 0 && (ho = Trim(GetConfig("mustconnect"))), SettingItem("mustconnect", ho, "-1", GROUP_NOGROUP, "", "", "1", ho), SettingItem("reloadalertdisplayed", "false", "-1", GROUP_NOGROUP, "", "", "1", "false");
            var mo = "1";
            !isNull(GetConfig("networkchecks")) && GetConfig("networkchecks").length > 0 && (mo = Trim(GetConfig("networkchecks"))), SettingItem("networkchecks", mo, "-1", GROUP_NOGROUP, "", "", "1", mo);
            var go = "0";
            !isNull(GetConfig("qrcode_login")) && GetConfig("qrcode_login").length > 0 && (go = Trim(GetConfig("qrcode_login"))), SettingItem("qrcode_login", go, "-1", GROUP_NOGROUP, "", "", "1", go);
            var bo = "2000";
            !isNull(GetConfig("icetimeout")) && GetConfig("icetimeout").length > 0 && (bo = Trim(GetConfig("icetimeout"))), SettingItem("icetimeout", bo, "1", GROUP_SIP, "", "", "1", bo);
            var _o = "1";
            !isNull(GetConfig("normalize_contact")) && GetConfig("normalize_contact").length > 0 && (_o = Trim(GetConfig("normalize_contact"))), SettingItem("normalize_contact", _o, "1", GROUP_SIP, "", "", "1", _o);
            var fo = "300";
            !isNull(GetConfig("nspollinterval")) && GetConfig("nspollinterval").length > 0 && (fo = Trim(GetConfig("nspollinterval"))), SettingItem("nspollinterval", fo, "-1", GROUP_NOGROUP, "", "", "1", fo), SettingItem("cache_audio_rec_device_list", "", "-1", GROUP_NOGROUP, "", "", "1", ""), SettingItem("cache_audio_play_device_list", "", "-1", GROUP_NOGROUP, "", "", "1", ""), SettingItem("cache_audio_ring_device_list", "", "-1", GROUP_NOGROUP, "", "", "1", ""), SettingItem("cache_video_rec_device_list", "", "-1", GROUP_NOGROUP, "", "", "1", ""), SettingItem("cache_audio_rec_curr_device", "", "-1", GROUP_NOGROUP, "", "", "1", ""), SettingItem("cache_audio_play_curr_device", "", "-1", GROUP_NOGROUP, "", "", "1", ""), SettingItem("cache_audio_ring_curr_device", "", "-1", GROUP_NOGROUP, "", "", "1", ""), SettingItem("cache_video_rec_curr_device", "", "-1", GROUP_NOGROUP, "", "", "1", ""), SettingItem("lnsengine", "-1", "-1", GROUP_NOGROUP, "", "", "1", "-1"), SettingItem("cancelonnsdownload", "0", "-1", GROUP_NOGROUP, "", "", "1", "0");
            var wo = "0";
            !isNull(GetConfig("autogenpassword")) && GetConfig("autogenpassword").length > 0 && (wo = Trim(GetConfig("autogenpassword"))), SettingItem("autogenpassword", wo, "-1", GROUP_NOGROUP, "", "", "1", wo);
            var vo = "2";
            !isNull(GetConfig("appengine_startat")) && GetConfig("appengine_startat").length > 0 && (vo = Trim(GetConfig("appengine_startat"))), SettingItem("appengine_startat", vo, "-1", GROUP_NOGROUP, "", "", "1", vo);
            var Eo = "";
            !isNull(GetConfig("customautoprov_url")) && GetConfig("customautoprov_url").length > 0 && (Eo = Trim(GetConfig("customautoprov_url"))), SettingItem("customautoprov_url", Eo, "-1", GROUP_NOGROUP, "", "", "1", Eo);
            var To = "1";
            !isNull(GetConfig("customautoprov_when")) && GetConfig("customautoprov_when").length > 0 && (To = Trim(GetConfig("customautoprov_when"))), SettingItem("customautoprov_when", To, "-1", GROUP_NOGROUP, "", "", "1", To);
            var Po = "1";
            !isNull(GetConfig("customautoprov_repeat")) && GetConfig("customautoprov_repeat").length > 0 && (Po = Trim(GetConfig("customautoprov_repeat"))), SettingItem("customautoprov_repeat", Po, "-1", GROUP_NOGROUP, "", "", "1", Po), SettingItem("custautoprov_exectimes", "0", "-1", GROUP_NOGROUP, "", "", "1", "0"), SettingItem("storagecookiefailback", "1", "-1", GROUP_NOGROUP, "", "", "1", "0");
            var So = "1";
            !isNull(GetConfig("quick_access_list")) && GetConfig("quick_access_list").length > 0 && (So = Trim(GetConfig("quick_access_list"))), SettingItem("quick_access_list", So, "-1", GROUP_NOGROUP, "", "", "1", So);
            var No = "1";
            !isNull(GetConfig("nsupgrademode")) && GetConfig("nsupgrademode").length > 0 && (No = Trim(GetConfig("nsupgrademode"))), SettingItem("nsupgrademode", No, "2", GROUP_SIP, webphone_api.stringres.get("nsupgrademode__background") + "," + webphone_api.stringres.get("nsupgrademode__delayed") + "," + webphone_api.stringres.get("nsupgrademode__immediate"), "0,1,2", "1", No), SettingItem("last_good_ns_plugin_url", "", "-1", GROUP_NOGROUP, "", "", "1", ""), SettingItem("app_popup_displayed", "0", "-1", GROUP_NOGROUP, "", "", "1", "0"), SettingItem("allow_start_app_engine", "1", "-1", GROUP_NOGROUP, "", "", "1", "1"), 58 === GetConfigInt("brandid", -1) && (SaveParameter("dtmfmode", "1"), SaveParameter("aec", "0"), SaveParameter("agc", "0"), SaveParameter("silencesupress", "0"), SaveParameter("voicemailnum", "*97")), SaveParameter("code_version", webphone_api.global.code_version), "undefined" == typeof webphone_api.plhandler || webphone_api.plhandler
        } catch (Io) {
            PutToDebugLogException(2, "common: InitializeSettings", Io)
        }
    }

    function DoVersioning() {
        try {
            var e = GetParameterInt("code_version", 0);
            if (PutToDebugLog(2, "EVENT, common: DoVersioning called, oldversion: " + e), !isNull(e) && IsNumber(e) || (e = 0), e < webphone_api.global.code_version) {
                if (GetConfig("autoprovisioning").length < 1 || "0" === GetConfig("autoprovisioning") || "false" === GetConfig("autoprovisioning") || !1 === GetConfig("autoprovisioning")) {
                    var o = GetParameter("customizedversion");
                    !isNull(GetConfig("customizedversion")) && GetConfig("customizedversion").length > 0 && (o = Trim(GetConfig("customizedversion"))), SettingItem("customizedversion", o, "-1", GROUP_NOGROUP, "", "", "1", "true");
                    var t = GetParameter("serveraddress");
                    !isNull(GetConfig("serveraddress")) && GetConfig("serveraddress").length > 0 && (t = Trim(GetConfig("serveraddress"))), SettingItem("serveraddress", t, "-1", GROUP_NOGROUP, "", "", "1", "");
                    var n = GetParameter("server_label");
                    !isNull(GetConfig("server_label")) && GetConfig("server_label").length > 0 && (n = Trim(GetConfig("server_label"))), SettingItem("server_label", n, "-1", GROUP_NOGROUP, "", "", "1", "Server");
                    var i = GetParameter("showserverinput");
                    !isNull(GetConfig("showserverinput")) && GetConfig("showserverinput").length > 0 && (i = Trim(GetConfig("showserverinput"))), SettingItem("showserverinput", i, "-1", GROUP_NOGROUP, "", "", "1", "1");
                    var a = GetParameter("brandname");
                    !isNull(GetConfig("brandname")) && GetConfig("brandname").length > 0 && (a = Trim(GetConfig("brandname"))), SettingItem("brandname", a, "-1", GROUP_NOGROUP, "", "", "1", "");
                    var r = GetParameter("brandid");
                    !isNull(GetConfig("brandid")) && GetConfig("brandid").length > 0 && (a = Trim(GetConfig("brandid"))), SettingItem("brandid", r, "-1", GROUP_NOGROUP, "", "", "1", "");
                    var s = GetParameter("companyname");
                    !isNull(GetConfig("companyname")) && GetConfig("companyname").length > 0 && (s = Trim(GetConfig("companyname"))), SettingItem("companyname", s, "-1", GROUP_NOGROUP, "", "", "1", "");
                    var l = GetParameter("newuser");
                    !isNull(GetConfig("newuser")) && GetConfig("newuser").length > 0 && (l = Trim(GetConfig("newuser"))), SettingItem("newuser", l, "-1", GROUP_NOGROUP, "", "", "1", "");
                    var p = GetParameter("homepage");
                    !isNull(GetConfig("homepage")) && GetConfig("homepage").length > 0 && (p = Trim(GetConfig("homepage"))), SettingItem("homepage", p, "-1", GROUP_NOGROUP, "", "", "1", "");
                    var c = GetParameter("accounturi");
                    !isNull(GetConfig("accounturi")) && GetConfig("accounturi").length > 0 && (c = Trim(GetConfig("accounturi"))), SettingItem("accounturi", c, "-1", GROUP_NOGROUP, "", "", "1", "");
                    var u = GetParameter("recharge");
                    !isNull(GetConfig("recharge")) && GetConfig("recharge").length > 0 && (u = Trim(GetConfig("recharge"))), SettingItem("recharge", u, "-1", GROUP_NOGROUP, "", "", "1", "");
                    var h = GetParameter("p2p");
                    !isNull(GetConfig("p2p")) && GetConfig("p2p").length > 0 && (h = Trim(GetConfig("p2p"))), SettingItem("p2p", h, "1", GROUP_CALLDIVERT, "", "", "1", "");
                    var m = GetParameter("callback");
                    !isNull(GetConfig("callback")) && GetConfig("callback").length > 0 && (m = Trim(GetConfig("callback"))), SettingItem("callback", m, "1", GROUP_CALLDIVERT, "", "", "1", "");
                    var g = GetParameter("sms");
                    !isNull(GetConfig("sms")) && GetConfig("sms").length > 0 && (g = Trim(GetConfig("sms"))), SettingItem("sms", g, "1", GROUP_CALLDIVERT, "", "", "1", "");
                    var d = GetParameter("sms_recieve");
                    !isNull(GetConfig("sms_recieve")) && GetConfig("sms_recieve").length > 0 && (d = Trim(GetConfig("sms_recieve"))), SettingItem("sms_recieve", d, "-1", GROUP_NOGROUP, "", "", "1", "");
                    var b = GetParameter("creditrequest");
                    !isNull(GetConfig("creditrequest")) && GetConfig("creditrequest").length > 0 && (b = Trim(GetConfig("creditrequest"))), SettingItem("creditrequest", b, "1", GROUP_CALLDIVERT, "", "", "1", "");
                    var _ = GetParameter("ratingrequest");
                    !isNull(GetConfig("ratingrequest")) && GetConfig("ratingrequest").length > 0 && (_ = Trim(GetConfig("ratingrequest"))), SettingItem("ratingrequest", _, "1", GROUP_CALLDIVERT, "", "", "1", "");
                    var f = GetParameter("supportmail");
                    !isNull(GetConfig("supportmail")) && GetConfig("supportmail").length > 0 && (f = Trim(GetConfig("supportmail"))), SettingItem("supportmail", f, "-1", GROUP_NOGROUP, "", "", "1", "");
                    var w = GetParameter("supporturl");
                    !isNull(GetConfig("supporturl")) && GetConfig("supporturl").length > 0 && (w = Trim(GetConfig("supporturl"))), SettingItem("supporturl", w, "-1", GROUP_NOGROUP, "", "", "1", "");
                    var v = GetParameter("header");
                    !isNull(GetConfig("header")) && GetConfig("header").length > 0 && (v = Trim(GetConfig("header"))), v.length < 1 && !isNull(GetConfig("headertext")) && GetConfig("headertext").length > 0 && (v = GetConfig("headertext")), SettingItem("header", v, "-1", GROUP_NOGROUP, "", "", "1", "");
                    var E = "";
                    !isNull(GetConfig("footer")) && GetConfig("footer").length > 0 && (E = Trim(GetConfig("footer"))), E.length < 1 && !isNull(GetConfig("footertext")) && GetConfig("footertext").length > 0 && (E = GetConfig("footertext")), SettingItem("footer", E, "-1", GROUP_NOGROUP, "", "", "1", "");
                    var T = GetParameter("logo");
                    !isNull(GetConfig("logo")) && GetConfig("logo").length > 0 && (T = Trim(GetConfig("logo"))), SettingItem("logo", T, "-1", GROUP_NOGROUP, "", "", "1", "");
                    var P = GetParameter("version");
                    !isNull(GetConfig("version")) && GetConfig("version").length > 0 && (P = Trim(GetConfig("version"))), SettingItem("version", P, "-1", GROUP_NOGROUP, "", "", "1", "");
                    var S = GetParameter("messagedisplay");
                    !isNull(GetConfig("messagedisplay")) && GetConfig("messagedisplay").length > 0 && (S = Trim(GetConfig("messagedisplay"))), SettingItem("messagedisplay", S, "-1", GROUP_NOGROUP, "", "", "1", "");
                    var N = GetParameter("messagepopup");
                    !isNull(GetConfig("messagepopup")) && GetConfig("messagepopup").length > 0 && (N = Trim(GetConfig("messagepopup"))), SettingItem("messagepopup", N, "-1", GROUP_NOGROUP, "", "", "1", "");
                    var I = GetParameter("advertisement");
                    !isNull(GetConfig("advertisement")) && GetConfig("advertisement").length > 0 && (I = Trim(GetConfig("advertisement"))), SettingItem("advertisement", I, "-1", GROUP_NOGROUP, "", "", "1", "");
                    var C = GetParameter("helpurl");
                    !isNull(GetConfig("helpurl")) && GetConfig("helpurl").length > 0 && (C = Trim(GetConfig("helpurl"))), SettingItem("helpurl", C, "-1", GROUP_NOGROUP, "", "", "1", "");
                    var R = GetParameter("licenseurl");
                    !isNull(GetConfig("licenseurl")) && GetConfig("licenseurl").length > 0 && (R = Trim(GetConfig("licenseurl"))), SettingItem("licenseurl", R, "-1", GROUP_NOGROUP, "", "", "1", "");
                    var y = GetParameter("extramenuurl");
                    !isNull(GetConfig("extramenuurl")) && GetConfig("extramenuurl").length > 0 && (y = Trim(GetConfig("extramenuurl"))), SettingItem("extramenuurl", y, "-1", GROUP_NOGROUP, "", "", "1", "");
                    var L = GetParameter("extramenutxt");
                    !isNull(GetConfig("extramenutxt")) && GetConfig("extramenutxt").length > 0 && (L = Trim(GetConfig("extramenutxt"))), SettingItem("extramenutxt", L, "-1", GROUP_NOGROUP, "", "", "1", "")
                }
                if (e < 12) {
                    var D = GetParameter("username"), G = GetParameter("password"),
                        O = GetParameter("serveraddress_orig"), x = GetParameter("serveraddress_user"),
                        A = GetParameter("proxyaddress"), k = GetParameter("sipusername"),
                        U = GetParameter("displayname"), V = GetParameter("email"), W = GetParameter("voicemailnum"),
                        M = GetParameter("callforwardonbusy"), F = GetParameter("wsusers");
                    for (var H in webphone_api.global.settmap) delete webphone_api.global.settmap[H];
                    PutToDebugLog(2, "WARNING, DoVersioning, Initializesettings, because older version"), HandleSettings("", "", function () {
                    }), SaveParameter("username", D), SaveParameter("password", G), SaveParameter("serveraddress_orig", O), SaveParameter("serveraddress_user", x), SaveParameter("proxyaddress", A), SaveParameter("sipusername", k), SaveParameter("displayname", U), SaveParameter("email", V), SaveParameter("voicemailnum", W), SaveParameter("callforwardonbusy", M), SaveParameter("wsusers", F)
                }
                if (e < 13) {
                    var B = "";
                    !isNull(GetConfig("rtmpserveraddress")) && GetConfig("rtmpserveraddress").length > 0 && (B = Trim(GetConfig("rtmpserveraddress"))), SettingItem("rtmpserveraddress", B, "-1", GROUP_NOGROUP, "", "", "1", ""), SettingItem("audiodevices", "", "8", GROUP_MEDIA, "", "", "1", ""), SettingItem("autoaction", "0", "-1", GROUP_NOGROUP, "", "", "1", "0"), SettingItem("webcallme", "1", "-1", GROUP_NOGROUP, "", "", "1", "1");
                    var j = "";
                    !isNull(GetConfig("callbacknumber")) && GetConfig("callbacknumber").length > 0 && (j = Trim(GetConfig("callbacknumber"))), SettingItem("callbacknumber", j, "1", GROUP_CALLDIVERT, "", "", "1", ""), SettingItem("received_confrooms", "", "-1", GROUP_NOGROUP, "", "", "1", ""), SettingItem("iswebrtcuppersrvfromuser", "false", "-1", GROUP_NOGROUP, "", "", "1", "false"), SettingItem("java_worked", "false", "-1", GROUP_NOGROUP, "", "", "1", "false"), SettingItem("ns_worked", "false", "-1", GROUP_NOGROUP, "", "", "1", "false"), SettingItem("webrtc_worked", "false", "-1", GROUP_NOGROUP, "", "", "1", "false");
                    var $ = "-1";
                    !isNull(GetConfig("video")) && GetConfig("video").length > 0 && ($ = Trim(GetConfig("video"))), SettingItem("video", $, "2", GROUP_MEDIA, webphone_api.stringres.get("video__auto") + "," + webphone_api.stringres.get("video__disable") + "," + webphone_api.stringres.get("video__enable") + "," + webphone_api.stringres.get("video__force"), "-1,0,1,2", "1", "1");
                    var q = "0";
                    !isNull(GetConfig("video_bandwidth")) && GetConfig("video_bandwidth").length > 0 && (q = Trim(GetConfig("video_bandwidth"))), SettingItem("video_bandwidth", q, "1", GROUP_MEDIA, "", "", "1", "0");
                    var z = "640";
                    !isNull(GetConfig("video_width")) && GetConfig("video_width").length > 0 && (z = Trim(GetConfig("video_width"))), SettingItem("video_width", z, "1", GROUP_MEDIA, "", "", "1", "640");
                    var K = "480";
                    !isNull(GetConfig("video_height")) && GetConfig("video_height").length > 0 && (K = Trim(GetConfig("video_height"))), SettingItem("video_height", K, "1", GROUP_MEDIA, "", "", "1", "480"), SettingItem("androidchromedisplayed", "false", "-1", GROUP_NOGROUP, "", "", "1", "false"), SettingItem("conf_engineswitcheoffered", "false", "-1", GROUP_NOGROUP, "", "", "1", "false"), SettingItem("transf_engineswitcheoffered", "false", "-1", GROUP_NOGROUP, "", "", "1", "false"), SettingItem("filterchatduplicates", "true", "-1", GROUP_NOGROUP, "", "", "1", "true");
                    var X = "true";
                    !isNull(GetConfig("has_video")) && GetConfig("has_video").length > 0 && (X = Trim(GetConfig("has_video"))), "0" === GetParameter2("video") && (X = "false"), SettingItem("has_video", X, "1", GROUP_MEDIA, "", "", "1", X), SettingItem("sendchatonenter", "true", "0", GROUP_GENERAL, "", "", "1", "true");
                    var J = "-1";
                    !isNull(GetConfig("transfwithreplace")) && GetConfig("transfwithreplace").length > 0 && (J = Trim(GetConfig("transfwithreplace"))), SettingItem("transfwithreplace", J, "2", GROUP_CALLDIVERT, webphone_api.stringres.get("transfwithreplace__auto") + "," + webphone_api.stringres.get("transfwithreplace__no") + "," + webphone_api.stringres.get("transfwithreplace__yes"), "-1,0,1", "1", "-1"), SettingItem("showratewhiletype_minlenth", "3", "-1", GROUP_NOGROUP, "", "", "1", "3"), SettingItem("showratewhiletype_maxlenth", "6", "-1", GROUP_NOGROUP, "", "", "1", "6")
                }
                if (e < 14 && (SettingItem("enginechecksum", "", "-1", GROUP_NOGROUP, "", "", "1", ""), SettingItem("redialonfail", "1", "-1", GROUP_NOGROUP, "", "", "1", "1")), e < 15) {
                    var Y = "1";
                    0 == GetConfigBool("useaudiodevicerecord", !0) && (Y = "0"), SettingItem("checkmicrophone", Y, "-1", GROUP_NOGROUP, "", "", "1", Y), SettingItem("calldivertsuccess", "-1", "-1", GROUP_NOGROUP, "", "", "1", "-1"), SettingItem("enginepriority_otherbrowser", GetParameter("enginepriority_otherbrowser"), "2", GROUP_SIP, "Disabled,Lower,Default,Higher,Highest,Force", "0,1,2,3,4,5", "1", "2")
                }
                if (e < 16) {
                    var Q = "en";
                    "rigitel" === GetConfig("brandname").toLowerCase() && (Q = "de"), isNull(GetConfig("language")) || 2 !== GetConfig("language").length || (Q = Trim(GetConfig("language"))), SettingItem("language", Q, "2", GROUP_GENERAL, "English,German,Hungarian,Portuguese", "en,de,hu,pt", "1", "en");
                    var Z = GetParameter("extraregisteraccounts");
                    isNull(Z) && (Z = ""), SettingItem("extraregisteraccounts", Z, "-1", GROUP_NOGROUP, "", "", "1", "");
                    var ee = "0";
                    !isNull(GetConfig("audio_bandwidth")) && GetConfig("audio_bandwidth").length > 0 && (ee = Trim(GetConfig("audio_bandwidth"))), SettingItem("audio_bandwidth", ee, "1", GROUP_MEDIA, "", "", "1", "0")
                }
                e < 18 && (SettingItem("normalizenumber", GetParameterInt("normalizenumber", -1).toString(), "2", GROUP_CALLDIVERT, webphone_api.stringres.get("normalizenumber__auto") + "," + webphone_api.stringres.get("normalizenumber__no") + "," + webphone_api.stringres.get("normalizenumber__yes"), "-1,0,1", "1", "-1"), SettingItem("nsupgrademode", GetParameterInt("nsupgrademode", 1), "2", GROUP_SIP, webphone_api.stringres.get("nsupgrademode__background") + "," + webphone_api.stringres.get("nsupgrademode__delayed") + "," + webphone_api.stringres.get("nsupgrademode__immediate"), "0,1,2", "1", "1"))
            }
            SaveParameter("code_version", webphone_api.global.code_version)
        } catch (oe) {
            PutToDebugLogException(2, "_settings: DoVersioning", oe)
        }
    }

    function SettingItem(e, o, t, n, i, a, r, s, l) {
        try {
            if (isNull(e)) return void PutToDebugLog(2, "WARNING, _settings: SettingItem invalid setting: " + e + ", " + o + ", " + t + ", " + n + ", " + i + ", " + a + ", " + r + ", " + s);
            "DEF" === o ? o = s : "NULL" === o && (o = "");
            var p = [];
            p[SETT_VALUE] = o, p[SETT_TYPE] = t, p[SETT_GROUP] = n, p[SETT_ALLNAMES] = i, p[SETT_ALLVALUES] = a, p[SETT_ISDEFAULT] = r, p[SETT_DEF_VALUE] = s, !0 === l ? webphone_api.global.settmap2[e] = p : webphone_api.global.settmap[e] = p
        } catch (c) {
            PutToDebugLogException(2, "common: SettingItem", c)
        }
    }

    function ParamAsBool(e) {
        try {
            if (isNull(e) || e.length < 1) return !1;
            if (e = e.toString(), e = e.toLowerCase(), e.indexOf("false") >= 0) return !1;
            if (e.indexOf("true") >= 0) return !0;
            if (IsNumber(e)) {
                if (StrToInt(e) > 0) return !0
            }
        } catch (o) {
            PutToDebugLogException(2, "common: ParamAsBool", o)
        }
        return !1
    }

    function ParamAsInt(e, o) {
        try {
            if (isNull(e) || e.length < 1) return !isNull(o) && IsNumber(o) ? StrToInt(o) : o;
            if (e = e.toString(), e = e.toLowerCase(), e.indexOf("false") >= 0) return 0;
            if (e.indexOf("true") >= 0) return 1;
            if (IsNumber(e)) return StrToInt(e)
        } catch (t) {
            PutToDebugLogException(2, "common: ParamAsInt", t)
        }
        return e
    }

    function GetParameter2(e, o) {
        try {
            if (isNull(e) || e.length < 1) return PutToDebugLogSpecial(2, "WARNING, common: GetParameter2 no input param", !0, ""), "";
            var t = webphone_api.parameters[e];
            return isNull(t) && (t = GetParameter(e, o)), isNull(t) && (t = ""), t = t.toString(), 0 === t.indexOf("encrypted__3__") && (t = StrDc(t, GetPassphrase())), "NULL" === t && (t = ""), isNull(t) && (t = ""), Trim(t)
        } catch (n) {
            PutToDebugLogSpecial(2, "ERROR, common: GetParameter2", !0, n)
        }
        return ""
    }

    function GetParameter(e, o) {
        var t = 0;
        try {
            if (isNull(e) || e.length < 1) return t = 2, PutToDebugLogSpecial(2, "WARNING, common: GetParameter no input param", !1, ""), "";
            if ((isNull(webphone_api.global.settmap2) || isNull(webphone_api.global.settmap2.magicnumber)) && "loglevel" !== e) return t = 8, PutToDebugLogSpecial(6, "EVENT, common GetParameter no settings: " + e, !1, ""), "";
            if (t = 9, !(e in webphone_api.global.settmap2)) return "";
            var n = webphone_api.global.settmap2[e];
            "serveraddress" === e && (n[SETT_VALUE] = StripServeraddress(n[SETT_VALUE])), "username" !== e && "sipusername" !== e || 0 === GetParameterInt("allowsipuriasusername", 0) && (n[SETT_VALUE] = StripUsername(n[SETT_VALUE]));
            var i;
            return i = isNull(o) || !0 !== o ? n[SETT_VALUE] : n[SETT_DEF_VALUE], t = 10, isNull(i) || (i = i.toString(), 0 === i.indexOf("encrypted__3__") && (i = StrDc(i, GetPassphrase()))), i
        } catch (a) {
            PutToDebugLogSpecial(2, "common: GetParameter (" + t + "), parameter: " + e, !0, a)
        }
        return ""
    }

    function ParameterIsDefault(e) {
        try {
            if (isNull(e) || e.length < 1) return 2, PutToDebugLogSpecial(2, "WARNING, common: ParameterIsDefault no input param", !1, ""), !1;
            if (isNull(webphone_api.global.settmap) || isNull(webphone_api.global.settmap.magicnumber)) return 8, PutToDebugLogSpecial(2, "WARNING, common: ParameterIsDefault no settings param: " + e, !1, ""), !1;
            if (9, !(e in webphone_api.global.settmap)) return !1;
            return "1" === webphone_api.global.settmap[e][SETT_ISDEFAULT]
        } catch (o) {
            PutToDebugLogSpecial(2, "ERROR, common: ParameterIsDefault", !0, o)
        }
        return !1
    }

    function GetParameterInt(e, o) {
        function t(e) {
            try {
                return void 0 !== e && null != e && (e = e.toString(), !(null == (e = e.replace(/\s+/g, "")) || e.length < 1) && !isNaN(e))
            } catch (o) {
                alert("ERROR, common: IsNumberInnerInt" + o)
            }
            return !1
        }

        try {
            if (isNull(o) || !t(o)) return PutToDebugLogSpecial(3, "ERROR, GetParameterInt invalid default value", !0, ""), -1e6;
            var n = GetParameter(e);
            if (isNull(n) || (n = n.toString()), !isNull(n) && n.length > 0) {
                var i = null;
                return n = n.toLowerCase(), "true" === n || "yes" === n ? i = 1 : "false" === n || "no" === n ? i = 0 : t(Trim(n)) && (i = StrToInt(n)), isNull(i) ? o : i
            }
        } catch (a) {
            PutToDebugLogSpecial(2, "ERROR, common: GetParameterInt parameter: " + e, !0, a)
        }
        return o
    }

    function GetParameterBool(e, o) {
        try {
            if (isNull(o) || "true" !== o.toString() && "false" !== o.toString()) return PutToDebugLog(3, "ERROR, GetParameterBool invalid default value"), "invalidbool";
            var t = GetParameter(e);
            if (!isNull(t)) {
                var n = null;
                return t = t.toString(), t = t.toLowerCase(), "true" === t || "1" === t || "yes" === t ? n = !0 : "false" !== t && "0" !== t && "no" !== t || (n = !1), isNull(n) ? o : n
            }
        } catch (i) {
            PutToDebugLogException(3, "common: GetParameterBool parameter: " + e, i)
        }
        return o
    }

    function SaveParameter(e, o, t) {
        try {
            if (isNull(e) || e.length < 1) return PutToDebugLog(3, "WARNING, common: SaveParameter no input param"), !1;
            if (isNull(webphone_api.global.settmap)) return PutToDebugLog(2, "WARNING, common: SaveParameter no settings"), !1;
            if (e.indexOf("server") >= 0) {
                if ("YOURSIPDOMAIN.COM" === o || "YOURSIPSERVER.COM" === o || "SIPSERVER" === o || "VOIPSERVER" === o || "SERVERADDRESS" === o) return !1
            } else if (e.indexOf("username") >= 0) {
                if ("USERNAME" === o || "SIPUSERNAME" === o) return !1
            } else if (e.indexOf("password") >= 0) {
                if ("PASSWORD" === o || "SIPPASSWORD" === o || "SIPASSWORD" === o) return !1
            } else if (e.indexOf("callto") >= 0 && ("DESTINATION" === o || "CALLTO" === o)) return !1;
            if ("lastsessionsuccess" === e && GetParameter("lastsessionsuccess") === o) return;
            if (isNull(o) || (o = o.toString()), isNull(o) || 0 !== o.indexOf("encrypted__3__") || (o = StrDc(o, GetPassphrase())), "webrtcserver" !== e && "webrtcaddress" !== e && "rtcserver" !== e && "rtcaddress" !== e || (e = "webrtcserveraddress"), "webrtcserveraddress" === e) webphone_api.parameters.webrtcserveraddress = o, selectedwserver = ""; else {
                if ("callto" === e) return webphone_api.parameters.callto = o, !0;
                if (("username" === e || "sipusername" === e) && !isNull(o) && o.indexOf("@") > 0) {
                    if (0 === GetParameterInt("allowsipuriasusername", 0)) {
                        var n = webphone_api.global.settmap.serveraddress_user;
                        n[SETT_VALUE] = Trim(o.substring(o.indexOf("@") + 1)), webphone_api.global.settmap.serveraddress_user = n
                    }
                } else if (e === Ssidcode() && (PutToDebugLog(2, "EVENT," + Ssidcode() + "_1: " + o), !isNull(o) && o.length > 0 && unlockcodetricktogled < 1)) {
                    var i = StrDc(unlockcodetrick, alsvkey);
                    PutToDebugLog(2, "EVENT," + Ssidcode() + "_2: " + i), Trim(o) === i && (PutToDebugLog(2, "EVENT," + Ssidcode() + "_3: " + o), unlockcodetricktogled = 1)
                }
            }
            var a;
            if (e in webphone_api.global.settmap2) {
                var r = "0";
                a = webphone_api.global.settmap2[e], "DEF" === o ? (o = a[SETT_DEF_VALUE], r = "1") : "NULL" === o && (o = ""), a[SETT_VALUE] = o, a[SETT_ISDEFAULT] = r, webphone_api.global.settmap2[e] = a, webphone_api.global.wasSettModified = !0
            } else SettingItem(e, o, "-1", "-1", "", "", "0", o, !0), webphone_api.global.wasSettModified = !0;
            if (!0 !== t) if (a = null, e in webphone_api.global.settmap) {
                var r = "0";
                a = webphone_api.global.settmap[e], "DEF" === o ? (o = a[SETT_DEF_VALUE], r = "1") : "NULL" === o && (o = ""), a[SETT_VALUE] = o, a[SETT_ISDEFAULT] = r, webphone_api.global.settmap[e] = a, webphone_api.global.wasSettModified = !0
            } else SettingItem(e, o, "-1", "-1", "", "", "0", o), webphone_api.global.wasSettModified = !0;
            return "extraregisteraccounts" === e && ParseSipAccounts(), !0
        } catch (s) {
            PutToDebugLogException(3, "common: SaveParameter", s)
        }
        return !1
    }

    function Ssidcode() {
        if (null !== ssidcode_string) return ssidcode_string;
        var e = [];
        return e.push("s"), e.push("s"), e.push("i"), e.push("d"), e.push("c"), e.push("o"), e.push("d"), e.push("e"), ssidcode_string = e.join("")
    }

    function GetConfig(e, o) {
        try {
            if (isNull(e) || e.length < 1) return PutToDebugLog(3, "WARNING, common: GetConfig no input param"), "";
            isNull(o) && (o = !0);
            var t = webphone_api.mwphonecfg.get(e);
            return isNull(t) ? (PutToDebugLog(3, "WARNING, common: GetConfig value is NULL"), "") : (o && GetPassphrase().length > 0 && (t = StrDc(t, GetPassphrase())), "serveraddress" === e && (t = StripServeraddress(t)), "username" !== e && "sipusername" !== e || (t = StripUsername(t)), t)
        } catch (n) {
            PutToDebugLogException(3, "common: GetConfig", n)
        }
        return ""
    }

    function GetConfigInt(e, o) {
        try {
            if (isNull(o) || !IsNumber(o)) return PutToDebugLog(3, "ERROR, GetConfigInt invalid default value"), -1e6;
            var t = GetConfig(e);
            if (!isNull(t) && t.length > 0) {
                var n = null;
                return t = t.toLowerCase(), "true" === t || "yes" === t ? n = 1 : "false" === t || "no" === t ? n = 0 : IsNumber(Trim(t)) && (n = StrToInt(t)), isNull(n) ? o : n
            }
        } catch (i) {
            PutToDebugLogException(3, "common: GetConfigInt parameter: " + e, i)
        }
        return o
    }

    function GetConfigBool(e, o) {
        try {
            if (isNull(o) || "true" !== o.toString() && "false" !== o.toString()) return PutToDebugLog(3, "ERROR, GetParameterBool invalid default value"), "invalidbool";
            var t = GetConfig(e);
            if (!isNull(t)) {
                var n = null;
                return "true" === t.toLowerCase() || "1" === t || "yes" === t.toLowerCase() ? n = !0 : "false" !== t.toLowerCase() && "0" !== t && "no" !== t.toLowerCase() || (n = !1), isNull(n) ? o : n
            }
        } catch (i) {
            PutToDebugLogException(3, "common: GetConfigBool parameter: " + e, i)
        }
        return o
    }

    function SaveSettingsFile(e, o) {
        try {
            if (0 === GetPreferredStorage()) return PutToDebugLog(2, "EVENT, SaveSettingsFile do not save because preferred_storage is 0"), void o(!0);
            if (webphone_api.global.flag_delsett > 1 || !0 === GetParameterBool("resetsettings", !1)) return PutToDebugLog(2, "EVENT, SaveSettingsFile DO NOT SAVE, flag delsett is: " + webphone_api.global.flag_delsett.toString() + "; resetsettings is: " + GetParameterBool("resetsettings", !1)), void o(!0);
            if (!o || "function" != typeof o) return PutToDebugLog(2, "ERROR, common: SaveSettingsFile callback not defined"), !1;
            if (isNull(e) || e.length < 1) return PutToDebugLog(2, "ERROR, common: SaveSettingsFile filename is NULL"), o(!1), !1;
            if (isNull(webphone_api.global.settmap) || isNull(webphone_api.global.settmap.magicnumber)) return PutToDebugLog(2, "ERROR, common: SaveSettingsFile no setings to be saved"), o(!1), !1;
            webphone_api.global.dispSaveSettMsg++, webphone_api.global.dispSaveSettMsg < 3 && PutToDebugLog(2, "EVENT, SaveSettingsFile filename: " + e);
            var t = "", n = "";
            if (!0 === GetParameterBool("serverinputisupperserver", !1)) {
                var i = GetParameter("upperserver"), a = GetParameter("serveraddress_user");
                if ((i.length < 0 || a.indexOf(".") > 0) && ShowServerInput()) {
                    var r = GetConfigInt("upperserverfromuser", 2), s = GetConfig("upperserver");
                    r < 2 && s.length > 0 ? SaveParameter("upperserver", s) : SaveParameter("upperserver", a), webphone_api.global.wasSettModified = !1
                }
            }
            for (var l in webphone_api.global.settmap) if (!(isNull(l) || l.length < 1) && "clientreset" !== l && "clientresetall" !== l) {
                var p = webphone_api.global.settmap[l];
                t = t + l + ";" + p[SETT_VALUE] + ";" + p[SETT_TYPE] + ";" + p[SETT_GROUP] + ";" + p[SETT_ALLNAMES] + ";" + p[SETT_ALLVALUES] + ";" + p[SETT_ISDEFAULT] + ";" + p[SETT_DEF_VALUE] + "\r\n", "username" !== l && "sipusername" !== l && "password" !== l && "serveraddress_user" !== l && "serveraddress_orig" !== l && "upperserver" !== l && "loglevel" !== l && "code_version" !== l && "lastusedengine" !== l || (n = n + l + ";" + p[SETT_VALUE] + "\r\n")
            }
            if (1 === GetParameterInt("storagecookiefailback", 1) && webphone_api.global.dispSaveSettMsg < 3 && PutToDebugLog(2, "EVENT, SaveSettingsFile save coockie backup = " + n), isNull(webphone_api.File)) return PutToDebugLog(2, "EVENT, SaveSettingsFile File handling module not loaded yet"), o(!1), !1;
            1 === GetParameterInt("storagecookiefailback", 1) && webphone_api.File.SaveFile(e + "_backup", n, webphone_api.global.STORAGE_COOKIE, function (e) {
                webphone_api.global.dispSaveSettMsg < 3 && PutToDebugLog(3, "EVENT, SaveSettingsFile save coockie backup: " + e.toString())
            }), IsWindowsSoftphone() ? ApiWinSaveFile(e, t, function (e) {
                o(!0)
            }) : webphone_api.File.SaveFile(e, t, webphone_api.global.STORAGE_LOCAL, function (e) {
                o(!0)
            })
        } catch (c) {
            PutToDebugLogException(2, "common: SaveSettingsFile", c)
        }
    }

    function ReadSettingsFile(e, o) {
        try {
            if (PutToDebugLogSpecial(3, "EVENT, common ReadSettingsFile called; filename: " + e, !1, ""), !o || "function" != typeof o) return void PutToDebugLog(2, "ERROR, common: ReadSettingsFile callback not defined");
            if (isNull(e) || e.length < 1) return void PutToDebugLog(2, "ERROR, common: ReadSettingsFile filename is NULL");
            if (isNull(webphone_api.File)) return PutToDebugLog(2, "ERROR, ReadSettingsFile File handling module not loaded yet"), o(!1), !1;
            if (!0 === webphone_api.parameters.resetsettings || "true" === webphone_api.parameters.resetsettings) return !1 === settdeleted && (settdeleted = !0, webphone_api.File.DeleteAllCookies(), webphone_api.File.DeleteFile(GetActiveAccSettingsFilename(), function (e) {
                PutToDebugLog(2, "EVENT, delete settings file resetsettings: " + GetActiveAccSettingsFilename() + " result: " + e)
            })), PutToDebugLog(2, "EVENT, ReadSettingsFile not read because resetsettings"), InitializeSettings(), o(!0), !0;
            IsWindowsSoftphone() ? ApiWinLoadFile(e, function (t) {
                t += "", (isNull(t) || Trim(t).length < 2 || "null" == t) && (PutToDebugLog(4, "EVENT, common: ReadSettingsFile no content WinApi"), webphone_api.File.ReadFile(e + "_backup", webphone_api.global.STORAGE_COOKIE, function (t) {
                    (isNull(t) || Trim(t).length < 1) && (t = ""), PutToDebugLog(2, "READ contentfromcookie WinApi = " + HideClearPassword(t)), HandleSettings("", e, o), webphone_api.plhandler.ConfigChanged();
                    var n = t.split("\r\n");
                    (isNull(n) || n.length < 1) && (n = []);
                    for (var i = 0; i < n.length; i++) if (!(isNull(n[i]) || n[i].length < 2 || n[i].indexOf(";") < 0)) {
                        var a = n[i].indexOf(";");
                        if (!(a < 1)) {
                            var r = Trim(n[i].substring(0, a)), s = Trim(n[i].substring(a + 1));
                            SaveParameter(r, s)
                        }
                    }
                    PutToDebugLog(2, "EVENT, common: ReadSettingsFile important settings restored from cookie WinApi: " + t)
                })), HandleSettings(t, e, o), webphone_api.plhandler.ConfigChanged()
            }) : webphone_api.File.ReadFile(e, webphone_api.global.STORAGE_LOCAL, function (t) {
                isNull(t) || Trim(t).length < 1 ? (PutToDebugLog(4, "EVENT, common: ReadSettingsFile no content"), 1 === GetParameterInt("storagecookiefailback", 1) && webphone_api.File.ReadFile(e + "_backup", webphone_api.global.STORAGE_COOKIE, function (t) {
                    (isNull(t) || Trim(t).length < 1) && (t = ""), PutToDebugLog(2, "READ contentfromcookie = " + HideClearPassword(t)), HandleSettings("", e, o), webphone_api.plhandler.ConfigChanged();
                    var n = t.split("\r\n");
                    (isNull(n) || n.length < 1) && (n = []);
                    for (var i = 0; i < n.length; i++) if (!(isNull(n[i]) || n[i].length < 2 || n[i].indexOf(";") < 0)) {
                        var a = n[i].indexOf(";");
                        if (!(a < 1)) {
                            var r = Trim(n[i].substring(0, a)), s = Trim(n[i].substring(a + 1));
                            "lastusedengine" === r ? s.length > 0 && (SaveParameter(r, s), webphone_api.global.last_used_engine_cache = s) : SaveParameter(r, s)
                        }
                    }
                    PutToDebugLog(2, "EVENT, common: ReadSettingsFile important settings restored from cookie: " + HideClearPassword(t))
                })) : (HandleSettings(t, e, o), webphone_api.plhandler.ConfigChanged())
            })
        } catch (t) {
            PutToDebugLogException(2, "common: ReadSettingsFile", t)
        }
    }

    function ClientReset(e, o, t, n) {
        try {
            if (!0 === webphone_api.global.flagclientreset) return;
            if ((isNull(t) || t.length < 1) && (t = !0 === IsSDK() ? GetSettFilenameSDK() : GetActiveAccSettingsFilename()), !0 === n) {
                webphone_api.File.DeleteFile(GetActiveAccCallhistoryFilename(), function (e) {
                    PutToDebugLog(2, "EVENT, ClientReset delete call history file: " + GetActiveAccCallhistoryFilename() + " result: " + e)
                }), webphone_api.global.chlist = [], webphone_api.global.recentlist = [];
                var i = GetParameter("messagefiles");
                if (!isNull(i)) {
                    for (var a = i.split(","), r = 0; r < a.length; r++) if (!(isNull(a[r]) || a[r].length < 3)) {
                        var s = a[r].indexOf("[#");
                        s > 0 && (a[r] = a[r].substring(0, s)), webphone_api.File.DeleteFile(a[r], function (e) {
                            PutToDebugLog(3, "EVENT, ClientReset DeleteFile: " + a[r] + " status: " + e.toString())
                        })
                    }
                    SaveParameter("messagefiles", "")
                }
                var l = GetConfig("brandid");
                (isNull(l) || l.length < 1 || "-1" == l) && (l = GetBrandName().toLowerCase()), webphone_api.File.DeleteFile(GetAccountsFilename(), function (e) {
                    PutToDebugLog(2, "EVENT, ClientReset delete accounts file result: " + e)
                }), webphone_api.global.aclist = [], webphone_api.File.DeleteFile(webphone_api.global.CONTACTS_FILENAME + l, function (e) {
                    PutToDebugLog(2, "EVENT, ClientReset delete contacts file result: " + e)
                }), webphone_api.global.ctlist = []
            }
            !isNull(t) && t.length > 0 && (webphone_api.global.flagclientreset = !0, webphone_api.global.flag_delsett = 1, webphone_api.File.DeleteAllCookies(), webphone_api.File.DeleteFile(filename, function (t) {
                PutToDebugLog(2, "EVENT, ClientReset delete settings file result: " + t), webphone_api.global.flag_delsett = 0, HandleSettings("", "", function () {
                }), webphone_api.global.flagclientreset = !1, SaveParameter("last_clientreset", e), SaveParameter("last_clientresetall", o), !1 === IsSDK() && OpenSettings(!0, 1)
            }))
        } catch (p) {
            PutToDebugLogException(2, "common: ClientReset", p)
        }
    }

    function HandleSettings(e, o, t) {
        try {
            if (PutToDebugLogSpecial(1, "EVENT,HandleSettings", !1, ""), isNull(webphone_api.global.settmap)) webphone_api.global.settmap = {}; else for (var n in webphone_api.global.settmap) delete webphone_api.global.settmap[n];
            if (isNull(webphone_api.global.settmap2)) webphone_api.global.settmap2 = {}; else for (var n in webphone_api.global.settmap2) delete webphone_api.global.settmap2[n];
            InitializeSettings();
            var i = webphone_api.mwphonecfg.getAll();
            if (!isNull(i)) {
                PutToDebugLog(3, "EVENT,HandleSettings cfg");
                for (var a in i) if (!(isNull(a) || a.length < 1 || a.indexOf("overwrite_") >= 0)) {
                    var r = i[a];
                    "NULL" === r && (r = ""), SaveParameter(a, r)
                }
            }
            var s = e.split("\r\n");
            if (isNull(s) || s.length < 1) PutToDebugLog(2, "ERROR, common: ParseSettingsReadFromFile empty content"); else if (e.indexOf("magicnumber") < 0 && e.length > 30) PutToDebugLog(3, "ERROR, common ParseSettingsReadFromFile settings file is corrupt"), webphone_api.File.DeleteAllCookies(), webphone_api.File.DeleteFile(o, function (e) {
                PutToDebugLog(2, "EVENT, ParseSettingsReadFromFile delete settings file result: " + e)
            }); else {
                PutToDebugLog(3, "EVENT,HandleSettings file");
                for (var l = !1, p = !1, c = "", u = "", h = "", m = "", g = "", d = "", b = -1, _ = -1, f = 0; f < s.length; f++) if (!(isNull(s[f]) || s[f].length < 2 || s[f].indexOf(";") < 0)) {
                    var w = s[f].split(";");
                    isNull(w) || 8 !== w.length || ("serveraddress" === w[0] && (c = w[1]), "webrtcserveraddress" === w[0] && (u = w[1]), "upperserver" === w[0] && (h = w[1]), "proxyaddress" === w[0] && (m = w[1]), "lastsettcrc" === w[0] && (g = w[1]), "last_clientreset" === w[0] && IsNumber(w[1]) && (b = StrToInt(w[1])), "last_clientresetall" === w[0] && IsNumber(w[1]) && (_ = StrToInt(w[1])))
                }
                !isNull(webphone_api.parameters.last_clientreset) && IsNumber(webphone_api.parameters.last_clientreset) && (b = StrToInt(webphone_api.parameters.last_clientreset)), !isNull(webphone_api.parameters.last_clientresetall) && IsNumber(webphone_api.parameters.last_clientresetall) && (_ = StrToInt(webphone_api.parameters.last_clientresetall));
                var v = -1, E = -1;
                if (!isNull(webphone_api.parameters.clientreset) && IsNumber(webphone_api.parameters.clientreset) && (v = StrToInt(webphone_api.parameters.clientreset)), !isNull(webphone_api.parameters.clientresetall) && IsNumber(webphone_api.parameters.clientresetall) && (E = StrToInt(webphone_api.parameters.clientresetall)), E > _ && (ClientReset(v, E, o, !0), l = !0), v > b && (ClientReset(v, E, o, !1), l = !0), !isNull(webphone_api.parameters.serveraddress) && webphone_api.parameters.serveraddress.length > 0 && (c = webphone_api.parameters.serveraddress), !isNull(webphone_api.parameters.webrtcserveraddress) && webphone_api.parameters.webrtcserveraddress.length > 0 && (u = webphone_api.parameters.webrtcserveraddress), !isNull(webphone_api.parameters.upperserver) && webphone_api.parameters.upperserver.length > 0 && (h = webphone_api.parameters.upperserver), !isNull(webphone_api.parameters.proxyaddress) && webphone_api.parameters.proxyaddress.length > 0 && (m = webphone_api.parameters.proxyaddress), isNull(c) && (c = ""), isNull(u) && (u = ""), isNull(h) && (h = ""), isNull(m) && (m = ""), isNull(g) && (g = ""), d = Md5Hash(c + u + h + m), g.length > 0 && !isNull(d) && d !== g && (p = !0, PutToDebugLog(2, "WARNING, HandleSettings: key settings changed, omit them from local storage"), SaveParameter("autostart", 0)), setTimeout(function () {
                    SaveParameter("lastsettcrc", d)
                }, 500), !1 === l) for (var T = "", P = "", S = "", N = "", I = "", C = "", R = "", y = "", L = 0; L < s.length; L++) if (!(isNull(s[L]) || s[L].length < 2 || s[L].indexOf(";") < 0)) {
                    var D = s[L].split(";");
                    if (isNull(D)) PutToDebugLog(2, "WARNING, common ReadSettingsFile can't parse setting: " + s[L]); else if (8 === D.length || "get" === D[0] || "getAll" === D[0]) T = D[0], (!0 !== p || "serveraddress" !== T && "serveraddress_orig" !== T && "serveraddress_user" !== T && "webrtcserveraddress" !== T && "upperserver" !== T && "proxyaddress" !== T && "realm" !== T && "lastsettcrc" !== T) && (P = D[1], S = D[2], N = D[3], I = D[4], C = D[5], R = D[6], y = D[7], SettingItem(T, P, S, N, I, C, R, y), "loglevel" === T && SettingItem(T, P, S, N, I, C, R, y, !0), T = "", P = "", S = "", N = "", I = "", C = "", R = "", y = ""); else {
                        PutToDebugLog(2, "WARNING, common ReadSettingsFile broken or invalid setting after parse; length: " + D.length + "; sett: " + D.toString())
                    }
                }
            }
            if (!isNull(i)) for (var a in i) if (!(isNull(a) || a.length < 1 || a.indexOf("overwrite_") < 0)) {
                a = a.replace("overwrite_", "");
                var r = i[a];
                "NULL" === r && (r = ""), SaveParameter(a, r)
            }
            for (var n in webphone_api.global.settmap) isNull(n) || n.length < 1 || (webphone_api.global.settmap2[n] = webphone_api.global.settmap[n]);
            if (!isNull(webphone_api.parameters)) {
                for (var n in webphone_api.parameters) if (!(isNull(n) || n.length < 1 || "codec" === n)) {
                    var P = webphone_api.parameters[n];
                    if (isNull(P) && (P = ""), "object" == typeof P) try {
                        P = JSON.stringify(P)
                    } catch (x) {
                    }
                    P = isNull(P) ? "" : P.toString(), P.length < 1 || 0 === n.indexOf("ucfg_") && !isNull(GetParameter(n)) && GetParameter(n).length > 0 || (n = n.replace("ucfg_", ""), "NULL" === P && (P = ""), "webrtcserver" !== n && "webrtcaddress" !== n && "rtcserver" !== n && "rtcaddress" !== n || (n = "webrtcserveraddress"), "loglevel" === n ? !isNull(StrToInt(P)) && StrToInt(P) > 1 && SaveParameter(n, P, !0) : SaveParameter(n, P, !0),
                        "username" !== n || "undefined" != typeof webphone_api.parameters.sipusername && null !== webphone_api.parameters.sipusername ? "sipusername" !== n || "undefined" != typeof webphone_api.parameters.username && null !== webphone_api.parameters.username || SaveParameter("username", P, !0) : SaveParameter("sipusername", P, !0))
                }
                var G = webphone_api.parameters.serveraddress;
                !isNull(G) && G.length > 1 && (SaveParameter("serveraddress", G, !0), SaveParameter("serveraddress_user", G, !0), SaveParameter("serveraddress_orig", G, !0)), GetCodecsFromApiParam()
            }
            GetSettingsFromUrl();
            var O = GetParameter("serveraddress");
            return !isNull(O) && O.length > 0 && SaveParameter("serveraddress", NormalizeInput(O, 0)), O = GetParameter("serveraddress_user"), !isNull(O) && O.length > 0 && SaveParameter("serveraddress_user", NormalizeInput(O, 0)), O = GetParameter("serveraddress_orig"), !isNull(O) && O.length > 0 && SaveParameter("serveraddress_orig", NormalizeInput(O, 0)), O = GetParameter("webrtcserveraddress"), !isNull(O) && O.length > 0 && SaveParameter("webrtcserveraddress", NormalizeInput(O, 0)), O = GetParameter("turnserveraddress"), !isNull(O) && O.length > 0 && SaveParameter("turnserveraddress", NormalizeInput(O, 0)), O = GetParameter("sipusername"), !isNull(O) && O.length > 0 && SaveParameter("sipusername", NormalizeInput(O, 0)), O = GetParameter("username"), !isNull(O) && O.length > 0 && SaveParameter("username", NormalizeInput(O, 0)), SetLanguage(), SetCurrTheme(), HandleScurlSetparameters(), ParseSipAccounts(), void t(!0)
        } catch (A) {
            PutToDebugLog(2, "EVENT, common: HandleSettings er1")
        }
        HandleScurlSetparameters(), ParseSipAccounts(), t(!1)
    }

    function GetSettingsFromUrl() {
        var e = !1;
        try {
            var o = window.location.href, t = "", n = "", i = "";
            if (isNull(o) || o.length < 1) return;
            o = decodeURIComponent(o), o = Trim(o), PutToDebugLog(3, "EVENT, GetSettingsFromUrl url: " + o);
            var a = o.indexOf("?");
            if (a < 0) return;
            o = o.substring(a + 1, o.length), a = o.indexOf("#page_"), a > 0 && (o = o.substring(0, a));
            for (var r = 0; o.length > 3 && r < 100;) {
                r++, a = o.indexOf("&"), a < 0 && (a = o.length);
                var s = o.substring(0, a);
                if (o = o.substring(a, o.length), 0 === o.indexOf("&") && (o = o.substring(1, o.length)), !(isNull(s) || s.length < 1)) if (s = Trim(s), (a = s.indexOf("=")) < 1) PutToDebugLog(3, "EVENT, GetSettingsFromUrl invalid settings: " + s); else {
                    var l = Trim(s.substring(0, a)), p = Trim(s.substring(a + 1, s.length));
                    p = StrDc(p, "1AzbNh5FdLT9m"), "platform" !== l || "windesktop" !== p ? 0 === l.indexOf("wp_") && ((l.indexOf("serveraddres") > 0 || l.indexOf("username") > 0 || l.indexOf("sipusername") > 0 || l.indexOf("password") > 0) && (webphone_api.global.sipaccounts = [], SaveSipAccounts()), l = l.substring(l.indexOf("wp_") + 3, l.length), "brandnamestr" === l && p.length > 0 ? l = "brandname" : "resetsettings" === l && p.length > 0 && ("1" === p.toLowerCase() || "true" === p.toLowerCase()) ? e = !0 : "serveraddress" === l && p.length > 0 && (SaveParameter("iswebrtcuppersrvfromuser", "true", !0), SaveParameter("serveraddress_user", Trim(p), !0), SaveParameter("serveraddress_orig", Trim(p), !0)), "video" === l && !0 === CanIUseWebRTC() && (PutToDebugLog(2, "WARNING, Enginepriority_WebRTC is set manually to 4 because video is forced"), SaveParameter("enginepriority_webrtc", "4")), "callto" === l && !isNull(p) && p.length > 0 ? t = p : "sendchat" === l && !isNull(p) && p.length > 0 ? n = p : "to" === l && !isNull(p) && p.length > 0 ? i = p : SaveParameter(l, Trim(p), !0)) : (l = "devicetype", p = "" + DEVICE_WIN_SOFTPHONE(), SaveParameter(l, p, !0))
                }
            }
            if (!0 === e) return PutToDebugLog(2, "EVENT, mlogic Delsettings GetSettingsFromUrl"), void webphone_api.delsettings(2);
            (isNull(t) || t.length < 1) && (t = GetParameter("callto")), !isNull(t) && t.length > 0 && !1 === autocall_called && (autocall_called = !0, webphone_api.global.aua_handled = !0, setTimeout(function () {
                3 === GetParameterInt("autoaction", 0) ? (PutToDebugLog(2, "EVENT,GetSettingsFromUrl initiate autoaction video call to: " + t), PutToDebugLog(2, "EVENT, mlogic API_VideoCall GetSettingsFromUrl"), webphone_api.videocall(decodeURIComponent(t))) : (PutToDebugLog(2, "EVENT,GetSettingsFromUrl initiate autoaction call to: " + t), PutToDebugLog(2, "EVENT, mlogic API_Call GetSettingsFromUrl"), webphone_api.call(decodeURIComponent(t)))
            }, 200)), !isNull(n) && n.length > 0 && !isNull(i) && i.length > 0 && !1 === sendchat_called && (sendchat_called = !0, webphone_api.global.aua_handled = !0, setTimeout(function () {
                PutToDebugLog(2, "EVENT, mlogic API_SendChat GetSettingsFromUrl"), webphone_api.sendchat(decodeURIComponent(i), decodeURIComponent(n))
            }, 200))
        } catch (c) {
            PutToDebugLogException(2, "common: GetSettingsFromUrl", c)
        }
    }

    function GetOverWriteSettings() {
        try {
            var e = webphone_api.mwphonecfg.getAll();
            if (isNull(e)) return;
            for (var o in e) isNull(o) || o.length < 1 || o.indexOf("overwrite_") < 0 || (o = o.replace("overwrite_", ""), SaveParameter(o, e[o]))
        } catch (t) {
            PutToDebugLogException(2, "common: GetOverWriteSettings", t)
        }
    }

    function OpenSettings(e, o) {
        try {
            3 === o && (webphone_api.common.getuseengine() === webphone_api.global.ENGINE_SERVICE || webphone_api.common.getuseengine() === webphone_api.global.ENGINE_WEBPHONE) || 8 === o ? PutToDebugLog(2, "EVENT, mlogic OpenSettings: " + o) : (PutToDebugLog(2, "EVENT, mlogic API_Unregister OpenSettings: " + o), webphone_api.unregister(), PutToDebugLog(2, "EVENT, mlogic API_Stop OpenSettings: " + o), webphone_api.stop()), !1 === IsSDK() && (isNull(e) || !0 !== e || (webphone_api.global.intentsettings[0] = "startedfrom=app"), "undefined" != typeof webphone_api.$ && null !== webphone_api.$ && "undefined" != typeof webphone_api.$.mobile && null !== webphone_api.$.mobile && webphone_api.$.mobile.changePage("#page_settings", {
                transition: "pop",
                role: "page"
            })), IsWindowsSoftphone() || "Android" === GetOs() || setTimeout(function () {
                ChooseEngineLogic(function () {
                    PutToDebugLog(3, "ChooseEngineLogic called on goind to settings page")
                }, !1)
            }, 350)
        } catch (t) {
            PutToDebugLogException(2, "common: OpenSettings", t)
        }
    }

    function GetIntentParam(e, o) {
        try {
            if (isNull(e) || isNull(o)) return "";
            if (o = Trim(o), e.length < 1 || o.length < 1) return "";
            for (var t = 0; t < e.length; t++) if (!isNull(e[t]) && 0 === e[t].indexOf(o) && e[t].indexOf("=") > 0) {
                var n = e[t].substring(e[t].indexOf("=") + 1);
                return Trim(n)
            }
        } catch (i) {
            PutToDebugLogException(2, "common: GetIntentParam", i)
        }
        return ""
    }

    function SaveContactsFile(e) {
        try {
            if (0 === GetPreferredStorage()) return PutToDebugLog(2, "EVENT, SaveContactsFile do not save because preferred_storage is 0"), void e(!0);
            if (webphone_api.global.flag_delsett > 1 || !0 === GetParameterBool("resetsettings", !1)) return void PutToDebugLog(2, "EVENT, SaveContactsFile DO NOT SAVE, flag delsett is: " + webphone_api.global.flag_delsett.toString() + "; resetsettings is: " + GetParameterBool("resetsettings", !1));
            if (!e || "function" != typeof e) return void PutToDebugLog(2, "ERROR, common: SaveContactsFile callback not defined");
            if (isNull(webphone_api.global.ctlist)) return PutToDebugLog(2, "EVENT, SaveContactsFile no contacts to be saved"), e(!1), !1;
            if (isNull(webphone_api.File)) return PutToDebugLog(2, "EVENT, SaveContactsFile File handling module not loaded yet"), e(!1), !1;
            for (var o = "", t = null, n = 0; n < webphone_api.global.ctlist.length; n++) if (t = webphone_api.global.ctlist[n], !isNull(t)) {
                var i = t[CT_EMAIL], a = t[CT_ADDRESS], r = t[CT_NOTES], s = t[CT_WEBSITE], l = t[CT_LASTACTIVE],
                    p = t[CT_ISFROMSYNC];
                isNull(i) && (i = ""), isNull(a) && (a = ""), isNull(r) && (r = ""), isNull(s) && (s = ""), (isNull(l) || l.length < 1 || !1 === IsNumber(l)) && (l = "0"), (isNull(p) || p.length < 1 || !1 === IsNumber(p)) && (p = "1"), o = o + t[CT_NAME] + ",[", o = o + t[CT_NUMBER].join(";") + "],[", o = o + t[CT_PTYPE].join(";") + "],", o = o + t[CT_USAGE] + "," + t[CT_LASTMODIF] + "," + t[CT_DELFLAG] + "," + t[CT_FAV] + "," + i + "," + a + "," + r + "," + s + "," + l + "," + p + "\r\n"
            }
            var c = GetConfig("brandid");
            (isNull(c) || c.length < 1 || "-1" == c) && (c = GetBrandName().toLowerCase()), IsWindowsSoftphone() ? ApiWinSaveFile(webphone_api.global.CONTACTS_FILENAME + c, o, function (o) {
                webphone_api.global.wereCtModified = !1, e(!0)
            }) : webphone_api.File.SaveFile(webphone_api.global.CONTACTS_FILENAME + c, o, webphone_api.global.STORAGE_LOCAL, function (o) {
                webphone_api.global.wereCtModified = !1, e(o)
            })
        } catch (u) {
            PutToDebugLogException(2, "common: SaveContactsFile", u)
        }
    }

    function ReadContactsFile(e) {
        try {
            if (!e || "function" != typeof e) return void PutToDebugLog(2, "ERROR, common: ReadContactsFile callback not defined");
            if (isNull(webphone_api.File)) return PutToDebugLog(2, "EVENT, ReadContactsFile File handling module not loaded yet"), e(!1), !1;
            var o = GetConfig("brandid");
            if ((isNull(o) || o.length < 1 || "-1" == o) && (o = GetBrandName().toLowerCase()), !0 === webphone_api.parameters.resetsettings || "true" === webphone_api.parameters.resetsettings) return !1 === contactsdeleted && (contactsdeleted = !0, webphone_api.File.DeleteFile(webphone_api.global.CONTACTS_FILENAME + o, function (e) {
                PutToDebugLog(2, "EVENT, delete contacts file resetsettings result: " + e)
            }), webphone_api.global.ctlist = []), PutToDebugLog(2, "EVENT, ReadContactsFile not read because resetsettings"), e(!0), !0;
            IsWindowsSoftphone() ? ApiWinLoadFile(webphone_api.global.CONTACTS_FILENAME + o, function (o) {
                if (isNull(o) || Trim(o).length < 1) return PutToDebugLog(2, "EVENT, common: ReadContactsFile no content WinApi"), e(!1), !1;
                ParseContactsReadFromFile(o, !0, e)
            }) : webphone_api.File.ReadFile(webphone_api.global.CONTACTS_FILENAME + o, webphone_api.global.STORAGE_LOCAL, function (o) {
                if (isNull(o) || Trim(o).length < 1) return PutToDebugLog(2, "EVENT, common: ReadContactsFile no content"), e(!1), !1;
                ParseContactsReadFromFile(o, !0, e)
            })
        } catch (t) {
            PutToDebugLogException(2, "common: ReadContactsFile", t)
        }
    }

    function ParseContactsReadFromFile(e, o, t) {
        try {
            var n = e.split("\r\n");
            if (isNull(n) || n.length < 1) return PutToDebugLog(2, "ERROR, common: ParseContactsReadFromFile empty content"), t(!1), !1;
            if (!0 === o && !isNull(webphone_api.global.ctlist)) for (var i in webphone_api.global.ctlist) delete webphone_api.global.ctlist[i];
            for (var a = "", r = "", s = 0; s < n.length; s++) if (isNull(n[s]) || n[s].length < 2 || n[s].indexOf(",") < 0) PutToDebugLog(2, "EVENT, common ParseContactsReadFromFile broken or invalid contact (1): " + n[s]); else if (a = n[s].split(","), r = "", r = a[CT_NUMBER], isNull(r) || r.length < 2 || r.indexOf("[") < 0) PutToDebugLog(2, "EVENT, common ParseContactsReadFromFile broken or invalid contact: (2)" + n[s]); else {
                r = r.substring(1, r.length - 1);
                var l = r.split(";");
                if (isNull(l) && (l = []), r = "", r = a[CT_PTYPE], isNull(r) || r.length < 2 || r.indexOf("[") < 0) PutToDebugLog(2, "WARNING, common ParseContactsReadFromFile broken or invalid contact: (3)" + n[s]); else {
                    r = r.substring(1, r.length - 1);
                    var p = r.split(";");
                    isNull(p) && (p = []);
                    var c = a[CT_EMAIL], u = a[CT_ADDRESS], h = a[CT_NOTES], m = a[CT_WEBSITE], g = "0";
                    a.length > CT_LASTACTIVE && (g = a[CT_LASTACTIVE]);
                    var d = "1";
                    a.length > CT_ISFROMSYNC && (d = a[CT_ISFROMSYNC]), isNull(c) && (c = ""), isNull(u) && (u = ""), isNull(h) && (h = ""), isNull(m) && (m = "");
                    var b = [];
                    b[CT_NAME] = a[CT_NAME], b[CT_NUMBER] = l, b[CT_PTYPE] = p, b[CT_USAGE] = a[CT_USAGE], b[CT_LASTMODIF] = a[CT_LASTMODIF], b[CT_DELFLAG] = a[CT_DELFLAG], b[CT_FAV] = a[CT_FAV], b[CT_EMAIL] = c, b[CT_ADDRESS] = u, b[CT_NOTES] = h, b[CT_WEBSITE] = m, b[CT_LASTACTIVE] = g, b[CT_ISFROMSYNC] = d, webphone_api.global.ctlist.push(b)
                }
            }
            SortContacts(), t(!0)
        } catch (_) {
            PutToDebugLogException(2, "common: ParseContactsReadFromFile", _)
        }
    }

    function ParseContactsFromServer(e, o, t) {
        try {
            var n = e.split("\r\n");
            if (isNull(n) || n.length < 1) return PutToDebugLog(2, "ERROR, common: ParseContactsFromServer empty content"), t(!1), !1;
            if (!0 === o && !isNull(webphone_api.global.ctlist)) for (var i in webphone_api.global.ctlist) delete webphone_api.global.ctlist[i];
            for (var a = "", r = 0; r < n.length; r++) if (isNull(n[r]) || n[r].length < 2 || n[r].indexOf(",") < 0) PutToDebugLog(2, "EVENT, common ParseContactsFromServer broken or invalid contact [" + r.toString() + "] (1): " + n[r]); else if (a = n[r].split(","), isNull(a) || a.length < 7) PutToDebugLog(2, "EVENT, common ParseContactsFromServer broken or invalid contact [" + r.toString() + "] (2): " + n[r]); else {
                var s = a[0];
                isNull(s) && (s = ""), s = Trim(s);
                for (var l = [], p = [], c = 1; c <= 5;) {
                    var u = a[c];
                    !isNull(u) && u.length > 0 && (u = ReplaceAll(u, " ", ""), u = ReplaceAll(u, "-", ""), u = ReplaceAll(u, "(", ""), u = ReplaceAll(u, ")", ""), l.indexOf(u) < 0 && (l.push(a[c]), !0 === IsNumeric(a[c], "+") && a[c].length > 6 ? p.push("phone") : p.push("sip"))), c++
                }
                var h = [];
                h[CT_NAME] = s, h[CT_NUMBER] = l, h[CT_PTYPE] = p, h[CT_USAGE] = "0", h[CT_LASTMODIF] = "0", h[CT_DELFLAG] = "0", h[CT_FAV] = "0", h[CT_EMAIL] = "", h[CT_ADDRESS] = "", h[CT_NOTES] = "", h[CT_WEBSITE] = "", h[CT_LASTACTIVE] = "0", h[CT_ISFROMSYNC] = "1", webphone_api.global.ctlist.push(h)
            }
            SortContacts(), t(!0)
        } catch (m) {
            PutToDebugLogException(2, "common: ParseContactsFromServer", m)
        }
    }

    function GetContacts(e) {
        try {
            isNull(webphone_api.global.ctlist) || webphone_api.global.ctlist.length < 1 || webphone_api.common.GetParameter("lastfilterval") !== webphone_api.common.GetParameter("filtercontacts") ? ReadContactsFile(function (o) {
                SortContacts(), e && e(o)
            }) : webphone_api.global.wasCtModified ? (SortContacts(), e && e(!0)) : e && e(!0)
        } catch (o) {
            PutToDebugLogException(2, "common: GetContacts", o)
        }
    }

    function SortContacts() {
        try {
            var e = GetParameterInt("sortcontacts", 0);
            0 === e ? webphone_api.global.ctlist.sort(function (e, o) {
                return e[CT_NAME].toLowerCase() < o[CT_NAME].toLowerCase() ? -1 : e[CT_NAME].toLowerCase() > o[CT_NAME].toLowerCase() ? 1 : 0
            }) : 1 === e ? webphone_api.global.ctlist.sort(function (e, o) {
                return StrToInt(e[CT_USAGE]) < StrToInt(o[CT_USAGE]) ? 1 : StrToInt(e[CT_USAGE]) > StrToInt(o[CT_USAGE]) ? -1 : 0
            }) : 2 === e && webphone_api.global.ctlist.sort(function (e, o) {
                for (var t = 0, n = 0, i = 0; i < e[CT_NUMBER].length; i++) {
                    var a = webphone_api.global.presenceHM[e[CT_NUMBER][i]];
                    if (!isNull(a) && "5" === a[PRES_STATUS]) {
                        t = 5;
                        break
                    }
                }
                for (var r = 0; r < o[CT_NUMBER].length; r++) {
                    var s = webphone_api.global.presenceHM[e[CT_NUMBER][r]];
                    if (!isNull(s) && "5" === s[PRES_STATUS]) {
                        n = 5;
                        break
                    }
                }
                return t < n ? 1 : t > n ? -1 : 0
            })
        } catch (o) {
            PutToDebugLogException(2, "common: SortContacts", o)
        }
    }

    function UpdateContactLastActive(e) {
        try {
            if (isNull(e) || e.length < 1) return;
            var o = GetContactIdFromNumber(e);
            if (o >= 0) {
                var t = webphone_api.global.ctlist[o];
                t[CT_LASTACTIVE] = GetTickCount().toString(), webphone_api.global.ctlist[o] = t
            }
        } catch (n) {
            PutToDebugLogException(2, "common: UpdateContactLastActive", n)
        }
    }

    function GetContactIdFromNumber(e) {
        var o = -1;
        try {
            if (isNull(e) || Trim(e).length < 1 || isNull(webphone_api.global.ctlist) || webphone_api.global.ctlist.length < 1) return -1;
            e = Trim(e.replace("+", ""));
            var t = e;
            t.length > 4 && (t = Trim(t.substring(1))), t.length > 4 && "0" === t.charAt(0) && (t = Trim(t.substring(1)));
            var n = t;
            n = n.replace("-", ""), n = n.replace(" ", ""), n = n.replace("(", ""), n = n.replace(")", ""), n = Trim(n);
            for (var i = 0; i < webphone_api.global.ctlist.length; i++) {
                var a = webphone_api.global.ctlist[i];
                if (!isNull(a)) {
                    var r = a[CT_NUMBER];
                    if (!isNull(r)) for (var s = 0; s < r.length; s++) if (!isNull(r[s]) && (r[s].indexOf(e) > -1 || r[s].indexOf(t) > -1 || r[s].indexOf(n) > -1)) {
                        o = i;
                        break
                    }
                }
            }
        } catch (l) {
            PutToDebugLogException(2, "common: GetContactIdFromNumber", l)
        }
        return o
    }

    function GetContactNameFromNumber(e) {
        var o = e;
        try {
            if (isNull(e) || Trim(e).length < 1) return "";
            if (isNull(webphone_api.global.ctlist) || webphone_api.global.ctlist.length < 1) return e;
            e = Trim(e), e = e.replace("-", ""), e = e.replace(" ", ""), e = e.replace("(", ""), e = e.replace(")", "");
            for (var t = !1, n = 0; n < webphone_api.global.ctlist.length; n++) {
                var i = webphone_api.global.ctlist[n];
                if (!isNull(i)) {
                    var a = i[CT_NUMBER];
                    if (!isNull(a)) for (var r = 0; r < a.length; r++) if (!isNull(a[r]) && a[r] === e) {
                        o = i[CT_NAME], t = !0;
                        break
                    }
                }
            }
            if (!1 === t) for (var n = 0; n < webphone_api.global.ctlist.length; n++) {
                var i = webphone_api.global.ctlist[n];
                if (!isNull(i)) {
                    var a = i[CT_NUMBER];
                    if (!isNull(a)) for (var r = 0; r < a.length; r++) if (!isNull(a[r]) && (a[r].length > 6 && e.length > 5 && a[r].indexOf(e) >= 0 || a[r].length > 5 && e.length > 6 && e.indexOf(a[r]) >= 0 || e === "+" + a[r] || e === "00" + a[r] || a[r] === "+" + e || a[r] === "00" + e)) {
                        o = i[CT_NAME], t = !0;
                        break
                    }
                }
            }
        } catch (s) {
            PutToDebugLogException(2, "common: GetContactNameFromNumber", s)
        }
        return o
    }

    function ContactExists(e, o) {
        try {
            if (isNull(webphone_api.global.ctlist) || webphone_api.global.ctlist.length < 1) return !1;
            isNull(e) && (e = ""), e = Trim(e), isNull(o) && (o = ""), o = Trim(o);
            var t = !1, n = !1;
            if (e.length > 0 && (t = !0), o.length > 0 && (n = !0), (isNull(e) || e.length < 1) && (isNull(o) || o.length < 1) || !1 === t && !1 === n) return PutToDebugLog(2, "ERROR, ContactExists invalid name and number"), !1;
            for (var i = 0; i < webphone_api.global.ctlist.length; i++) {
                var a = webphone_api.global.ctlist[i];
                if (!(isNull(a) || a.length < 4)) {
                    if (!0 === t && a[CT_NAME] === e) return !0;
                    if (!0 === n) {
                        var r = a[CT_NUMBER];
                        if (isNull(r) || r.length < 1) continue;
                        for (var s = 0; s < r.length; s++) if (r[s] === o) return !0
                    }
                }
            }
        } catch (l) {
            PutToDebugLogException(2, "common: ContactExists", l)
        }
        return !1
    }

    function SaveCallhistoryFile(e) {
        try {
            if (0 === GetPreferredStorage()) return PutToDebugLog(2, "EVENT, SaveCallhistoryFile do not save because preferred_storage is 0"), void e(!0);
            if (webphone_api.global.flag_delsett > 1 || !0 === GetParameterBool("resetsettings", !1)) return void PutToDebugLog(2, "EVENT, SaveCallhistoryFile DO NOT SAVE, flag delsett is: " + webphone_api.global.flag_delsett.toString() + "; resetsettings is: " + GetParameterBool("resetsettings", !1));
            if (!e || "function" != typeof e) return void PutToDebugLog(2, "ERROR, common: SaveCallhistoryFile callback not defined");
            if (isNull(webphone_api.global.chlist)) return PutToDebugLog(2, "EVENT, SaveCallhistoryFile no contacts to be saved"), e(!1), !1;
            if (isNull(webphone_api.File)) return PutToDebugLog(2, "EVENT, SaveCallhistoryFile File handling module not loaded yet"), e(!1), !1;
            for (var o = "", t = null, n = 0; n < webphone_api.global.chlist.length; n++) if (t = webphone_api.global.chlist[n], !isNull(t)) {
                var i = "";
                t.length > 6 && (i = t[CH_REASON]), o.length > 3 && (o += "\r\n"), o = o + t[CH_TYPE] + "," + t[CH_NAME] + "," + t[CH_NUMBER] + "," + t[CH_DATE] + "," + t[CH_DURATION] + "," + t[CH_RECORDING] + "," + i
            }
            IsWindowsSoftphone() ? ApiWinSaveFile(GetActiveAccCallhistoryFilename(), o, function (o) {
                webphone_api.global.wasChModified = !1, e(!0)
            }) : webphone_api.File.SaveFile(GetActiveAccCallhistoryFilename(), o, webphone_api.global.STORAGE_LOCAL, function (o) {
                webphone_api.global.wasChModified = !1, e(o)
            })
        } catch (a) {
            PutToDebugLogException(2, "common: SaveCallhistoryFile", a)
        }
    }

    function ReadCallhistoryFile(e) {
        try {
            if (!e || "function" != typeof e) return void PutToDebugLog(2, "ERROR, common: ReadCallhistoryFile callback not defined");
            if (isNull(webphone_api.File)) return PutToDebugLog(2, "EVENT, ReadCallhistoryFile File handling module not loaded yet"), e(!1), !1;
            if (!0 === webphone_api.parameters.resetsettings || "true" === webphone_api.parameters.resetsettings) return !1 === callhdeleted && (callhdeleted = !0, webphone_api.File.DeleteFile(GetActiveAccCallhistoryFilename(), function (e) {
                PutToDebugLog(2, "EVENT, delete call history file resetsettings: " + GetActiveAccCallhistoryFilename() + " result: " + e)
            }), webphone_api.global.chlist = [], webphone_api.global.recentlist = []), PutToDebugLog(2, "EVENT, ReadCallhistoryFile not read because resetsettings"), e(!0), !0;
            IsWindowsSoftphone() ? ApiWinLoadFile(GetActiveAccCallhistoryFilename(), function (o) {
                if (isNull(o) || Trim(o).length < 1) return PutToDebugLog(2, "EVENT, common: ReadCallhistoryFile no content WinApi"), e(!1), !1;
                ParseCallhistoryReadFromFile(o, e)
            }) : webphone_api.File.ReadFile(GetActiveAccCallhistoryFilename(), webphone_api.global.STORAGE_LOCAL, function (o) {
                if (isNull(o) || Trim(o).length < 1) return PutToDebugLog(2, "EVENT, common: ReadCallhistoryFile no content"), e(!1), !1;
                ParseCallhistoryReadFromFile(o, e)
            })
        } catch (o) {
            PutToDebugLogException(2, "common: ReadCallhistoryFile", o)
        }
    }

    function ParseCallhistoryReadFromFile(e, o) {
        try {
            var t = e.split("\r\n");
            if (isNull(t) || t.length < 1) return PutToDebugLog(2, "ERROR, common: ReadCallhistoryFile empty content"), o(!1), !1;
            if (!isNull(webphone_api.global.chlist)) for (var n in webphone_api.global.chlist) delete webphone_api.global.chlist[n];
            for (var i = null, a = 0; a < t.length; a++) isNull(t[a]) || t[a].length < 2 || t[a].indexOf(",") < 0 ? PutToDebugLog(2, "WARNING, common ReadCallhistoryFile broken or invalid contact (1): " + t[a]) : (i = t[a].split(","), isNull(i) || i.length < 2 ? PutToDebugLog(2, "WARNING, common ReadCallhistoryFile broken or invalid contact: (2)" + t[a]) : (i.length < 7 && i.push(""), webphone_api.global.chlist.push(i)));
            o(!0)
        } catch (r) {
            PutToDebugLogException(2, "common: ParseCallhistoryReadFromFile", r)
        }
    }

    function StartMsg(e, o, t) {
        try {
            e = NormalizeNumber(e);
            var n = "", i = GetParameter("sms"), a = GetParameter("chatsms");
            if (!isNull(i) && i.length > 0) if ("1" === a) n = "sms", PutToDebugLog(4, "EVENT, StartMsg called action: " + n + "; number: " + e + "; fromclass: " + t + " (1)"), StartMsgActivity(e, o, n, t); else if ("2" === a) n = "chat", PutToDebugLog(4, "EVENT, StartMsg called action: " + n + "; number: " + e + "; fromclass: " + t + " (2)"), StartMsgActivity(e, o, n, t); else {
                var r = e;
                r.indexOf("+") >= 0 && (r = r.substring(r.indexOf("+") + 1, r.length)), IsNumber(r) && r.length > 6 && r.length < 20 ? (n = "sms", PutToDebugLog(4, "EVENT, StartMsg called action: " + n + "; number: " + e + "; fromclass: " + t + " (3)"), StartMsgActivity(e, o, n, t)) : (n = "chat", PutToDebugLog(4, "EVENT, StartMsg called action: " + n + "; number: " + e + "; fromclass: " + t + " (4)"), StartMsgActivity(e, o, n, t))
            } else n = "chat", PutToDebugLog(4, "EVENT, StartMsg called action: " + n + "; number: " + e + "; fromclass: " + t + " (5)"), StartMsgActivity(e, o, n, t)
        } catch (s) {
            PutToDebugLogException(2, "common: StartMsg", s)
        }
    }

    function ChooseChatOrSms(e, o, t, n) {
        try {
            var i = GetDeviceWidth();
            i = !isNull(i) && IsNumber(i) && i > 100 ? Math.floor(i / 1.2) : 220;
            var a = "", r = '<li id="[ITEMID]"><a data-rel="back">[ITEMTITLE]</a></li>', s = "";
            s = r.replace("[ITEMID]", "#item_chat"), s = s.replace("[ITEMTITLE]", webphone_api.stringres.get("chat")), a += s, s = "", s = r.replace("[ITEMID]", "#item_sms"), s = s.replace("[ITEMTITLE]", webphone_api.stringres.get("sms")), a += s, s = "";
            var l = '<div id="chatsms_popup" data-role="popup" class="ui-content messagePopup" data-overlay-theme="a" data-theme="a" style="max-width:' + i + "px; min-width: " + Math.floor(.6 * i) + 'px;"><div data-role="header" data-theme="b"><a href="javascript:;" data-role="button" data-icon="delete" data-iconpos="notext" class="ui-btn-right closePopup">Close</a><h1 class="adialog_title">' + webphone_api.stringres.get("chat_sms_title") + '</h1></div><div role="main" class="ui-content adialog_content" style="padding: 0; margin: 0;"><ul id="chatsms_ul" data-role="listview" data-inset="true" data-icon="false" style="margin: 0;">' + a + '</ul></div><div data-role="footer" data-theme="b" class="adialog_footer"><a href="javascript:;" style="width: 98%;" class="ui-btn ui-corner-all ui-shadow ui-btn-inline ui-btn-b adialog_2button" data-rel="back" data-transition="flow">' + webphone_api.stringres.get("btn_close") + "</a></div></div>";
            n = n || function () {
            }, webphone_api.$.mobile.activePage.append(l).trigger("create"), webphone_api.$.mobile.activePage.find(".closePopup").bind("tap", function (e) {
                webphone_api.$.mobile.activePage.find(".messagePopup").popup("close")
            }), webphone_api.$.mobile.activePage.find(".messagePopup").popup().popup("open").bind({
                popupafterclose: function () {
                    webphone_api.$(this).unbind("popupafterclose").remove(), webphone_api.$("#chatsms_ul").off("click", "li"), n()
                }
            });
            var p = "";
            webphone_api.$("#chatsms_ul").on("click", "li", function (n) {
                var i = webphone_api.$(this).attr("id");
                "#item_chat" === i && (p = "chat"), "#item_sms" === i && (p = "sms"), webphone_api.$("#chatsms_popup").on("popupafterclose", function (n) {
                    webphone_api.$("#chatsms_popup").off("popupafterclose"), PutToDebugLog(5, "EVENT, ChooseChatOrSms: action: " + p + "; number: " + e + "; fromclass: " + t + "; msg: " + o), StartMsgActivity(e, o, p, t)
                })
            })
        } catch (c) {
            PutToDebugLogException(2, "common: ChooseChatOrSms", c)
        }
    }

    function StartMsgActivity(e, o, t, n) {
        try {
            if ("_messagelist" !== n && (isNull(e) || e.length < 1)) {
                var i = GetParameter("messagefiles");
                isNull(i) || i.length < 3 ? (isNull(o) && (o = ""), webphone_api.global.intentmsg[0] = "action=" + t, webphone_api.global.intentmsg[1] = "to=" + e, webphone_api.global.intentmsg[2] = "message=" + o, webphone_api.$.mobile.changePage("#page_message", {
                    transition: "slide",
                    role: "page"
                })) : webphone_api.$.mobile.changePage("#page_messagelist", { transition: "none", role: "page" })
            } else isNull(o) && (o = ""), webphone_api.global.intentmsg[0] = "action=" + t, webphone_api.global.intentmsg[1] = "to=" + e, webphone_api.global.intentmsg[2] = "message=" + o, webphone_api.$.mobile.changePage("#page_message", {
                transition: "slide",
                role: "page"
            })
        } catch (a) {
            PutToDebugLogException(2, "common: StartMsgActivity", a)
        }
    }

    function OpenLinkInExternalBrowser(e) {
        try {
            !isNull(e) && e.length > 0 && GetParameter("devicetype") === DEVICE_WIN_SOFTPHONE() && (PutToDebugLog(2, "EVENT, OpenLinkInExternalBrowser: " + e), WinAPI("API_BrowserOpenExtern", null, e))
        } catch (o) {
            PutToDebugLogException(2, "common: OpenLinkInExternalBrowser", o)
        }
    }

    function OpenLinkInInternalBrowser(e) {
        try {
            !isNull(e) && e.length > 0 && GetParameter("devicetype") === DEVICE_WIN_SOFTPHONE() && WinAPI("API_BrowserOpen", null, e)
        } catch (o) {
            PutToDebugLogException(2, "common: OpenLinkInInternalBrowser", o)
        }
    }

    function OpenWebURL(e, o, t) {
        try {
            if (isNull(e) || e.length < 3) return void PutToDebugLog(2, "WARNING, common OpenWebURL no url passed");
            var n = GetSipusername(), i = GetParameter("password"), a = "", r = "", s = "", l = "", p = "", c = "",
                u = "", h = RandomInt(1e4, 9999999).toString();
            return s = Md5Hash("C8y5:" + n + ":" + i + ":" + h), l = Md5Hash(n + ":" + i), p = Md5Hash(n + ":" + i + ":" + h), c = Md5Hash("rD58s:" + n + ":" + i + ":" + h), u = Md5Hash("ck5Gp" + n + i + GetParameter("apiv2md5salt") + h), 1 === GetParameter("brandid") && (a = Md5Hash("C8y5:" + n + ":" + i + ":8294032567")), e.indexOf("mvapireq") > 0 && (n = encodeURIComponent(n), i = encodeURIComponent(i), a = encodeURIComponent(a), r = encodeURIComponent(r), s = encodeURIComponent(s), l = encodeURIComponent(l), p = encodeURIComponent(p), h = encodeURIComponent(h), c = encodeURIComponent(c), u = encodeURIComponent(u)), e = Trim(e), e = e.replace("[USERNAME]", n), e = e.replace("USERNAME", n), e = e.replace("USRNAME", n), e = e.replace("[PASSWORD]", i), e = e.replace("PASSWORD", i), e = e.replace("PWD", i), e = e.replace("[MD5AUTH]", a), e = e.replace("[SHA1HASH]", r), e = e.replace("SHA1CHECKSUM", r), e = e.replace("MD5WEB", s), e = e.replace("MD5SIMPLE", l), e = e.replace("MD5NORMAL", p), e = e.replace("MD5SALT", h), e = e.replace("MD5CHECKSUM", c), e = e.replace("MD5VALUE", u), e = e.replace("CURRENCY", ""), e = e.replace("DEVICEID", GetDeviceId()), e = e.replace("SERVERAPIKEY", GetConfig("serverapikey")), Trim(e.toLowerCase()).indexOf("http") < 0 && o !== webphone_api.stringres.get("np_download") && (e = "http://" + e), !1 !== t && (IsHttps() && e.indexOf("https:") < 0 && (e = GetTlsProxyUrl(e)), PutToDebugLog(3, "EVENT, OpenWebURL = " + e), webphone_api.global.intentbrowser[0] = "url=" + e, webphone_api.global.intentbrowser[1] = "lastpage=" + webphone_api.$.mobile.activePage.attr("id"), isNull(o) && (o = ""), webphone_api.global.intentbrowser[2] = "title=" + o, webphone_api.$.mobile.changePage("#page_internalbrowser", {
                transition: "pop",
                role: "page"
            })), e
        } catch (m) {
            PutToDebugLogException(2, "common: OpenWebURL", m)
        }
        return e
    }

    function Md5Hash(e) {
        var o = "";
        try {
            return isNull(e) || Trim(e).length < 1 ? (PutToDebugLog(2, "EVENT, common: Md5Hash string to hash is NULL"), "") : (o = Md5Lib(e), isNull(o) && (o = ""), o)
        } catch (t) {
            PutToDebugLogException(2, "common: Md5Hash", t)
        }
        return ""
    }

    function Md5Lib(e) {
        function o(e, o) {
            var t = e[0], s = e[1], l = e[2], p = e[3];
            t = n(t, s, l, p, o[0], 7, -680876936), p = n(p, t, s, l, o[1], 12, -389564586), l = n(l, p, t, s, o[2], 17, 606105819), s = n(s, l, p, t, o[3], 22, -1044525330), t = n(t, s, l, p, o[4], 7, -176418897), p = n(p, t, s, l, o[5], 12, 1200080426), l = n(l, p, t, s, o[6], 17, -1473231341), s = n(s, l, p, t, o[7], 22, -45705983), t = n(t, s, l, p, o[8], 7, 1770035416), p = n(p, t, s, l, o[9], 12, -1958414417), l = n(l, p, t, s, o[10], 17, -42063), s = n(s, l, p, t, o[11], 22, -1990404162), t = n(t, s, l, p, o[12], 7, 1804603682), p = n(p, t, s, l, o[13], 12, -40341101), l = n(l, p, t, s, o[14], 17, -1502002290), s = n(s, l, p, t, o[15], 22, 1236535329), t = i(t, s, l, p, o[1], 5, -165796510), p = i(p, t, s, l, o[6], 9, -1069501632), l = i(l, p, t, s, o[11], 14, 643717713), s = i(s, l, p, t, o[0], 20, -373897302), t = i(t, s, l, p, o[5], 5, -701558691), p = i(p, t, s, l, o[10], 9, 38016083), l = i(l, p, t, s, o[15], 14, -660478335), s = i(s, l, p, t, o[4], 20, -405537848), t = i(t, s, l, p, o[9], 5, 568446438), p = i(p, t, s, l, o[14], 9, -1019803690), l = i(l, p, t, s, o[3], 14, -187363961), s = i(s, l, p, t, o[8], 20, 1163531501), t = i(t, s, l, p, o[13], 5, -1444681467), p = i(p, t, s, l, o[2], 9, -51403784), l = i(l, p, t, s, o[7], 14, 1735328473), s = i(s, l, p, t, o[12], 20, -1926607734), t = a(t, s, l, p, o[5], 4, -378558), p = a(p, t, s, l, o[8], 11, -2022574463), l = a(l, p, t, s, o[11], 16, 1839030562), s = a(s, l, p, t, o[14], 23, -35309556), t = a(t, s, l, p, o[1], 4, -1530992060), p = a(p, t, s, l, o[4], 11, 1272893353), l = a(l, p, t, s, o[7], 16, -155497632), s = a(s, l, p, t, o[10], 23, -1094730640), t = a(t, s, l, p, o[13], 4, 681279174), p = a(p, t, s, l, o[0], 11, -358537222), l = a(l, p, t, s, o[3], 16, -722521979), s = a(s, l, p, t, o[6], 23, 76029189), t = a(t, s, l, p, o[9], 4, -640364487), p = a(p, t, s, l, o[12], 11, -421815835), l = a(l, p, t, s, o[15], 16, 530742520), s = a(s, l, p, t, o[2], 23, -995338651), t = r(t, s, l, p, o[0], 6, -198630844), p = r(p, t, s, l, o[7], 10, 1126891415), l = r(l, p, t, s, o[14], 15, -1416354905), s = r(s, l, p, t, o[5], 21, -57434055), t = r(t, s, l, p, o[12], 6, 1700485571), p = r(p, t, s, l, o[3], 10, -1894986606), l = r(l, p, t, s, o[10], 15, -1051523), s = r(s, l, p, t, o[1], 21, -2054922799), t = r(t, s, l, p, o[8], 6, 1873313359), p = r(p, t, s, l, o[15], 10, -30611744), l = r(l, p, t, s, o[6], 15, -1560198380), s = r(s, l, p, t, o[13], 21, 1309151649), t = r(t, s, l, p, o[4], 6, -145523070), p = r(p, t, s, l, o[11], 10, -1120210379), l = r(l, p, t, s, o[2], 15, 718787259), s = r(s, l, p, t, o[9], 21, -343485551), e[0] = h(t, e[0]), e[1] = h(s, e[1]), e[2] = h(l, e[2]), e[3] = h(p, e[3])
        }

        function t(e, o, t, n, i, a) {
            return o = h(h(o, e), h(n, a)), h(o << i | o >>> 32 - i, t)
        }

        function n(e, o, n, i, a, r, s) {
            return t(o & n | ~o & i, e, o, a, r, s)
        }

        function i(e, o, n, i, a, r, s) {
            return t(o & i | n & ~i, e, o, a, r, s)
        }

        function a(e, o, n, i, a, r, s) {
            return t(o ^ n ^ i, e, o, a, r, s)
        }

        function r(e, o, n, i, a, r, s) {
            return t(n ^ (o | ~i), e, o, a, r, s)
        }

        function s(e) {
            var t, n = e.length, i = [1732584193, -271733879, -1732584194, 271733878];
            for (t = 64; t <= e.length; t += 64) o(i, l(e.substring(t - 64, t)));
            e = e.substring(t - 64);
            var a = [0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0];
            for (t = 0; t < e.length; t++) a[t >> 2] |= e.charCodeAt(t) << (t % 4 << 3);
            if (a[t >> 2] |= 128 << (t % 4 << 3), t > 55) for (o(i, a), t = 0; t < 16; t++) a[t] = 0;
            return a[14] = 8 * n, o(i, a), i
        }

        function l(e) {
            var o, t = [];
            for (o = 0; o < 64; o += 4) t[o >> 2] = e.charCodeAt(o) + (e.charCodeAt(o + 1) << 8) + (e.charCodeAt(o + 2) << 16) + (e.charCodeAt(o + 3) << 24);
            return t
        }

        function p(e) {
            for (var o = "", t = 0; t < 4; t++) o += m[e >> 8 * t + 4 & 15] + m[e >> 8 * t & 15];
            return o
        }

        function c(e) {
            for (var o = 0; o < e.length; o++) e[o] = p(e[o]);
            return e.join("")
        }

        function u(e) {
            return c(s(e))
        }

        function h(e, o) {
            return e + o & 4294967295
        }

        function h(e, o) {
            var t = (65535 & e) + (65535 & o);
            return (e >> 16) + (o >> 16) + (t >> 16) << 16 | 65535 & t
        }

        try {
            var m = "0123456789abcdef".split("");
            return u("hello"), u(e)
        } catch (g) {
            PutToDebugLogException(2, "common: Md5Lib", g)
        }
        return ""
    }

    function UriParser(e, o, t, n, i, a) {
        try {
            if (isNull(e) || Trim(e).length < 1) return void PutToDebugLog(2, "WARNING, common: UriParser uri is NULL");
            var r = GetSipusername(), s = GetParameter("password"), l = "";
            !isNull(s) && s.length > 0 && (l = Md5Hash(s));
            var p = "", c = "", u = "", h = "", m = "", g = "", d = RandomInt(1e4, 9999999).toString();
            c = Md5Hash("C8y5:" + r + ":" + s + ":" + d), u = Md5Hash(r + ":" + s), h = Md5Hash(r + ":" + s + ":" + d), m = Md5Hash("rD58s:" + r + ":" + s + ":" + d), g = Md5Hash("ck5Gp" + r + s + GetParameter("apiv2md5salt") + d), 0 === Trim(e).indexOf("*") && (e = e.substring(1));
            var b = e, _ = b.indexOf("authpwd=");
            if (_ > 0 && GetLogLevel() < 5) {
                var f = b.substring(0, _ + 8);
                b = b.substring(_ + 8), _ = b.indexOf("&"), _ < 0 && (_ = b.length), b = b.substring(_), b = f + "*****" + b
            }
            PutToDebugLog(3, "EVENT, uri = " + b), e.indexOf("mvapireq") > 0 && (r = encodeURIComponent(r), s = encodeURIComponent(s), l = encodeURIComponent(l), o = encodeURIComponent(o), t = encodeURIComponent(t), n = encodeURIComponent(n), p = encodeURIComponent(p), c = encodeURIComponent(c), u = encodeURIComponent(u), h = encodeURIComponent(h), d = encodeURIComponent(d), m = encodeURIComponent(m), g = encodeURIComponent(g)), e = Trim(e), e = e.replace("[USERNAME]", r), e = e.replace("USERNAME", r), e = e.replace("USRNAME", r), e = e.replace("[PASSWORD]", s), e = e.replace("PASSWORD", s), e = e.replace("PWD", s), e = e.replace("[MD5AUTH]", l), e = e.replace("MD5AUTH", l), e = e.replace("[PIN]", o), e = e.replace("PINCODE", o), e = e.replace("[ANUM]", t), e = e.replace("ANUM", t), e = e.replace("MYNUMBER", t), e = e.replace("PHONE1", t), e = e.replace("PREFIX_OR_NUMBER", t), e = e.replace("CALLEDNUMBER", t), e = e.replace("[CALLBACKNR]", GetParameter("callbacknumber")), e = e.replace("CALLBACKNR", GetParameter("callbacknumber")), e = e.replace("[BNUM]", n), e = e.replace("BNUM", n), e = e.replace("PHONE2", n), e = e.replace("TARGETMOBILE", n), e = e.replace("[TXT]", i), e = e.replace("TEXT", i), e = e.replace("CURRENCY", ""), e = e.replace("DEVICEID", GetDeviceId()), e = e.replace("[SHA1HASH]", p), e = e.replace("SHA1CHECKSUM", p), e = e.replace("MD5WEB", c), e = e.replace("MD5SIMPLE", u), e = e.replace("MD5NORMAL", h), e = e.replace("MD5SALT", d), e = e.replace("SALT", d), e = e.replace("MD5CHECKSUM", m), e = e.replace("MD5VALUE", g), e = e.replace("BRANDNAME", encodeURIComponent(GetBrandName()));
            var w = GetParameter("upperserver");
            if ((isNull(w) || w.length < 1) && (w = GetWebrtcUpperServer()), e = e.replace("UPPERSERVER", w), e = e.replace("SERVERAPIKEY", GetConfig("serverapikey")), e = e.replace("KEY", GetConfig("serverapikey")), e.indexOf("tel.search") > 0) {
                var v = GetParameter2("telsearchkey");
                isNull(v) && (v = ""), e = e.replace("TELSEARCHKEY", v)
            }
            Trim(e.toLowerCase()).indexOf("http") < 0 && (e = "http://" + e);
            var b = e, _ = b.indexOf("authpwd=");
            if (_ > 0) {
                var f = b.substring(0, _ + 8);
                b = b.substring(_ + 8), _ = b.indexOf("&"), _ < 0 && (_ = b.length), b = b.substring(_), b = f + "*****" + b
            }
            if (PutToDebugLog(5, "EVENT,httpRequestUri = " + b + ";   action = " + a), "return_uri" === a) return e;
            var E = !1, T = ""
                ; e.indexOf("[POST]") > 0 ? (E = !0, T = e.substring(e.indexOf("[POST]") + 6), e = e.substring(0, e.indexOf("[POST]"))) : (T = GetUrlParamVal(e, "POSTDATA"), !isNull(T) && T.length > 2 && (E = !0, e.indexOf("?") > 0 && (e = e.substring(0, e.indexOf("?"))))), !1 === webphone_api.global.isdebugversion && !1 === E && "true" === GetConfig("usingmizuserver") && e.indexOf("mvapireq") > 0 && (e = McrfsEnc(e, a)), HttpRequest(e, a, E, T)
        } catch (P) {
            PutToDebugLogException(2, "common: UriParser", P)
        }
    }

    function McrfsEnc(e, o) {
        try {
            if (isNull(e) || e.length < 1) return e;
            var t = e, n = t.indexOf("?");
            if (n < 0) return t;
            t = t + "&reqid=" + GetReqId();
            var i = t.substring(n + 1);
            t = t.substring(0, n + 1);
            var a = "", r = "", s = i.split("&");
            if (!isNull(s) && s.length > 0) {
                i = "";
                for (var l = 0; l < s.length; l++) if (!isNull(s[l])) {
                    var p = s[l].indexOf("=");
                    if (!(p < 1)) {
                        var c = s[l].substring(0, p + 1), u = s[l].substring(p + 1);
                        i.length > 0 && (i += "&"), i = i + c + encodeURIComponent(u), "authkey=" === c || "authid=" === c || "authpwd=" === c ? (r.length > 0 && (r += "&"), r = r + c + encodeURIComponent(u)) : (a.length > 0 && (a += "&"), a = a + c + encodeURIComponent(u))
                    }
                }
            }
            var h = StrEc(i, webphone_api.global.ec_apikey, !0);
            if (i === StrDc("mcrfs_" + h, webphone_api.global.ec_apikey, !0)) return t = t + "mcrfs=" + h, PutToDebugLog(5, "EVENT,httpRequestUri ENC All = " + t + ";   action = " + o), t;
            if (!isNull(r) && r.length > 0) {
                var m = StrEc(r, webphone_api.global.ec_apikey, !0);
                if (r === StrDc("mcrfs_" + m, webphone_api.global.ec_apikey, !0)) return !isNull(a) && a.length > 0 && (t = t + a + "&"), t = t + "mcrfs=" + m, PutToDebugLog(5, "EVENT,httpRequestUri ENC main = " + t + ";   action = " + o), t
            }
        } catch (g) {
            PutToDebugLogException(2, "common: McrfsEnc", g)
        }
        return e
    }

    function ConfigureRequestEngine(e, o, t) {
        try {
            if (e && ("jsonp" === webphone_api.global.httpmehod || "ws" === webphone_api.global.httpmehod)) return void ReConfigureRequestEngine(e);
            if (!1 === e && o.indexOf("mvapireq") < 1 && o.indexOf("mcrfs=") < 1 && "ws" === webphone_api.global.httpmehod) return GetParameter("devicetype") === DEVICE_WIN_SOFTPHONE() || getuseengine() === webphone_api.global.ENGINE_SERVICE ? void (webphone_api.global.httpmehod = "win") : void (webphone_api.global.httpmehod = "jsonp");
            if (o.indexOf("mvapireq") >= 0 || o.indexOf("mcrfs=") >= 0 && getuseengine() === webphone_api.global.ENGINE_WEBRTC) return void (webphone_api.global.httpmehod = "ws");
            if (webphone_api.global.httpmehod.length > 0) return;
            return "waitforparameters" === t ? void (webphone_api.global.httpmehod = "cors") : (("true" === GetConfig("usingmizuserver") || IsMizuServer()) && window.WebSocket && !0 !== e && (webphone_api.global.wssupported = !0), !0 === webphone_api.global.wssupported ? void (webphone_api.global.httpmehod = "ws") : GetParameter("devicetype") === DEVICE_WIN_SOFTPHONE() || getuseengine() === webphone_api.global.ENGINE_SERVICE ? void (webphone_api.global.httpmehod = "win") : getuseengine() === webphone_api.global.ENGINE_WEBPHONE ? void (webphone_api.global.httpmehod = "java") : "true" === GetConfig("usingmizuserver") || !isNull(o) && o.indexOf("xautoprov") >= 0 ? void (webphone_api.global.httpmehod = "cors") : void (webphone_api.global.httpmehod = "jsonp"))
        } catch (n) {
            PutToDebugLogException(2, "common: ConfigureRequestEngine", n)
        }
    }

    function ReConfigureRequestEngine(e) {
        try {
            if (!1 === webphone_api.global.currhttpmehodworking && "ws" === webphone_api.global.httpmehod && CheckInternetConnectionWS(), !0 === e) return void (webphone_api.global.httpmehod = "cors");
            if (!0 === webphone_api.global.currhttpmehodworking) return;
            GetParameter("devicetype") === DEVICE_WIN_SOFTPHONE() ? "win" === webphone_api.global.httpmehod ? !0 === webphone_api.global.wssupported && (webphone_api.global.httpmehod = "ws") : "ws" === webphone_api.global.httpmehod && getuseengine() === webphone_api.global.ENGINE_WEBPHONE ? webphone_api.global.httpmehod = "java" : "ws" === webphone_api.global.httpmehod || "java" === webphone_api.global.httpmehod ? webphone_api.global.httpmehod = "cors" : "cors" === webphone_api.global.httpmehod ? webphone_api.global.httpmehod = "jsonp" : webphone_api.global.httpmehod = "win" : "ws" === webphone_api.global.httpmehod ? getuseengine() === webphone_api.global.ENGINE_WEBPHONE ? webphone_api.global.httpmehod = "java" : getuseengine() === webphone_api.global.ENGINE_SERVICE ? webphone_api.global.httpmehod = "win" : webphone_api.global.httpmehod = "cors" : "java" === webphone_api.global.httpmehod || "win" === webphone_api.global.httpmehod ? webphone_api.global.httpmehod = "cors" : "cors" === webphone_api.global.httpmehod && (webphone_api.global.httpmehod = "jsonp"), PutToDebugLog(4, "EVENT, common:ReConfigureRequestEngine called. HTTP method: " + webphone_api.global.httpmehod)
        } catch (o) {
            PutToDebugLogException(2, "common: ReConfigureRequestEngine", o)
        }
    }

    function HttpRequest(e, o, t, n) {
        var i = 0;
        try {
            if (isNull(n) && (n = ""), "downloadcontacts" === o && "cors" !== webphone_api.global.httpmehod) {
                PutToDebugLog(2, "EVENT, HttpRequest method: cors downloadcontacts");
                var a = CORSRequest(e, o, t, n);
                return void (!1 === a && (PutToDebugLog(2, "WARNING, HttpRequest method: cors not available downloadcontacts; retry with other method"), ReConfigureRequestEngine(), HttpRequest(e, o, t, n)))
            }
            if (ConfigureRequestEngine(t, e, o), setTimeout(function () {
                ReConfigureRequestEngine(t)
            }, 3500), isNull(t) || !0 !== t || "post", i = 1, "telsearchname" === o) {
                PutToDebugLog(2, "EVENT, HttpRequest method: cors telsearchname");
                var a = CORSRequest(e, o, t, n);
                return void (!1 === a && (PutToDebugLog(2, "WARNING, HttpRequest method: cors not available telsearchname"), ReConfigureRequestEngine(), HttpRequest(e, o, t, n)))
            }
            if (i = 2, 50 === GetConfigInt("brandid", -1) && (webphone_api.global.httpmehod = "win"), "win" === webphone_api.global.httpmehod) {
                if (i = 10, PutToDebugLog(2, "EVENT, HttpRequest method: win"), e = e.replace("[POST]", ""), (isNull(n) || n.length < 1) && (n = "data=dummy"), 50 === GetConfigInt("brandid", -1)) return void WinAPI("API_HTTPReqAsyncFavafone", function (e) {
                    PutToDebugLog(2, "EVENT, common: API_HTTPReqAsyncFavafone returned (4): " + e + " waiting for response in notifications")
                }, e, n);
                i = 11, WinAPI("API_HTTPReqAsync", function (e) {
                    PutToDebugLog(2, "EVENT, common: API_HTTPReqAsync returned (4): " + e + " waiting for response in notifications")
                }, e, n)
            } else if ("ws" === webphone_api.global.httpmehod) {
                PutToDebugLog(2, "EVENT, HttpRequest method: ws");
                var a = WSRequest(e, o, t);
                !1 === a && (i = 20, PutToDebugLog(2, "WARNING, HttpRequest method: ws not available"), ReConfigureRequestEngine(), i = 21, HttpRequest(e, o, t, n))
            } else if ("java" === webphone_api.global.httpmehod) PutToDebugLog(2, "EVENT, HttpRequest method: java"), i = 25, webphone_api.webphone_handle.API_HTTPReqAsync(e, n), i = 26; else if ("cors" === webphone_api.global.httpmehod) {
                PutToDebugLog(2, "EVENT, HttpRequest method: cors"), i = 30;
                var a = CORSRequest(e, o, t, n);
                i = 31, !1 === a && (PutToDebugLog(2, "WARNING, HttpRequest method: cors not available"), ReConfigureRequestEngine(), i = 32, HttpRequest(e, o, t, n))
            } else if ("jsonp" === webphone_api.global.httpmehod) {
                PutToDebugLog(2, "EVENT, HttpRequest method: jsonp"), i = 40;
                var r = decodeURIComponent(e);
                if (r = encodeURIComponent(r), r.toLowerCase().indexOf("wsuser") > 0 || r.toLowerCase().indexOf("wsload") > 0) return PutToDebugLog(2, "WARNING, will not send wsuser/wsload over jsonp"), void (webphone_api.global.sendwsuserjsonp = !0);
                i = 41;
                var s = "http://";
                IsHttps() && (s = "https://"), r.toLowerCase().indexOf("wsuser") > 0 && (s = "https://");
                var l = "rtc.mizu-voip.com";
                if ("us" === webphone_api.global.usuk && (l = "usrtcx.webvoipphone.com"), i = 42, IsMizuServer() && webphone_api.global.usuk.length < 1 && (r.toLowerCase().indexOf("wsuser") < 0 || r.toLowerCase().indexOf("wsload") < 0)) if (i = 45, GetParameter("webrtcserveraddress").length > 3) {
                    l = GetParameter("webrtcserveraddress");
                    var p = l.indexOf("://");
                    p >= 0 && (l = l.substring(p + 3)), p = l.indexOf("/"), p > 0 && (l = l.substring(0, p))
                } else GetConfig("serveraddress").length > 1 ? l = GetConfig("serveraddress") : !isNull(webphone_api.parameters) && !isNull(webphone_api.parameters.serveraddress) && webphone_api.parameters.serveraddress.length > 1 && (l = Trim(webphone_api.parameters.serveraddress), l = NormalizeInput(l, 0), l.indexOf(":") > 0 && (l = l.substring(0, l.indexOf(":"))));
                i = 46, IsHttps() && IsIPAddrress(l) && jsonpmaxloop < 3 && (jsonpmaxloop++, ReConfigureRequestEngine(t), HttpRequest(e, o, t, n)), jsonpmaxloop = 0, i = 50;
                var c = GetConfig("mainaport");
                !isNull(c) && c.length > 0 && (l.indexOf(":") > 0 && (l = l.substring(0, l.indexOf(":"))), l += c);
                var u = s + l + "/mvapireq/jppget?url=" + r + "&callback=?";
                PutToDebugLog(4, "EVENT, jsonpurl: " + u), i = 51, webphone_api.$.getJSON(u, function (e) {
                    var t = "";
                    isNull(e) ? PutToDebugLog(2, "ERROR, HttpRequest jsonp response is NULL") : t = e.contents, HttpResponseHandler(t, o)
                })
            } else PutToDebugLog(2, "ERROR, common: HttpRequest NO supported http request method");
            i = 59
        } catch (h) {
            PutToDebugLogException(2, "common: HttpRequest (" + i.toString() + ")", h);
            try {
                "creditrequest" === o && (webphone_api.global.creditRequestIval < 3e4 ? webphone_api.global.creditRequestIval = 2 * webphone_api.global.creditRequestIval : webphone_api.global.creditRequestIval = webphone_api.global.CREDIT_REQUEST_IVAL_DEFVAL)
            } catch (m) {
            }
        }
    }

    function CORSRequest(e, o, t, n) {
        try {
            var i = "GET";
            t && (i = "POST"), e = e.replace("[POST]", "");
            var a = new XMLHttpRequest;
            if (PutToDebugLog(2, "EVENT, CORSRequest url: " + e + "; action: " + o + "; ispost: " + t + "; postdata: " + n), "withCredentials" in a) a.open(i, e, !0); else {
                if ("undefined" == typeof XDomainRequest) return a = null, PutToDebugLog(2, "ERROR, common: CORSRequest, CORS not supported"), webphone_api.global.httpmehod = "jsonp", !1;
                a = new XDomainRequest, a.open(i, e)
            }
            var r = 0;
            a.onload = function () {
                try {
                    if (PutToDebugLog(4, "EVENT, CORSRequest.onload"), r = 19, !1 === webphone_api.global.httpheaderslogged && a.getAllResponseHeaders) {
                        webphone_api.global.httpheaderslogged = !0;
                        PutToDebugLog(5, "EVENT, HTTP request answer headers 1: " + a.getAllResponseHeaders())
                    }
                    var e = a.responseText, t = "";
                    t = !isNull(e) && e.length > 250 ? e.substring(0, 250) + "...." : e, isNull(t) && (t = "NULL"), r = 20, PutToDebugLog(2, "EVENT, CORSRequest response: " + t);
                    return r = 21, isNull(e) || e.length < 1 ? (r = 23, PutToDebugLog(2, "ERROR, CORSRequest response is NULL"), !1) : (HttpResponseHandler(e, o), e)
                } catch (n) {
                    PutToDebugLogException(2, "common: CORSRequest.onload inner (" + r + ")", n)
                }
            }, a.onerror = function (e) {
                var o = "";
                isNull(e) || (o = e.toString(), isNull(e.target) || (o = isNull(e.target.status) ? o + " " + e.target.toString() : o + " " + e.target.status.toString())), PutToDebugLog(2, "ERROR, common: CORSRequest: onerror: " + o)
            };
            var s = reqtimeout;
            !0 === t && (s += 2e3), e.indexOf("xautoprov") >= 0 && (s += 15e3), a.timeout = s, a.ontimeout = function (e) {
                PutToDebugLog(2, "ERROR, common: CORSRequest: Timeout")
            }, t ? (isNull(n) && (n = ""), n = Trim(n), 0 === n.indexOf("?") && (n = n.replace("?", "")), a.send(n)) : a.send()
        } catch (l) {
            PutToDebugLogException(2, "common: CORSRequest", l)
        }
    }

    function ResetWsapisocket(e) {
        try {
            isNull(e) && (e = ""), void 0 !== wsapisocket && null !== wsapisocket && (wsapisocket.close && (PutToDebugLog(2, "EVENT, ResetWsapisocket, close from: " + e), wsapiskt_closedmanually = !0, wsapisocket.close()), wsapisocket.onopen && (wsapisocket.onopen = null), wsapisocket.onclose && (wsapisocket.onclose = null), wsapisocket.onerror && (wsapisocket.onerror = null))
        } catch (o) {
            PutToDebugLogException(2, "common: ResetWsapisocket", o)
        }
        wsapisocket = null
    }

    function WSAPIRequest(method, data, apiname, callback) {
        try {
            if (!callback || "function" != typeof callback) return void PutToDebugLog(2, "ERROR, webphone_api.common.WSAPIRequest websocketNS callback is NULL");
            if (!1 === Glsp()) return void PutToDebugLog(2, "WARNING, WSAPIRequest websocketNS do not send");
            if (!isNull(apiname) && (apiname = Trim(apiname), 0 === apiname.indexOf("API_") && "API_Poll" !== apiname && "API_Stop" !== apiname)) {
                srv_cb.push(callback), srv_apiname.push(apiname.toLowerCase());
                var finalparam = "";
                if (!isNull(data) && data.indexOf("param1=") > 0) {
                    var tmp = ReplaceAll(data, "BOFLINE", "");
                    tmp = ReplaceAll(tmp, "EOFLINE", "");
                    var param1 = tmp.substring(tmp.indexOf("param1=") + 7), param2 = "";
                    param1.indexOf("param2=") >= 0 ? (param2 = param1.substring(param1.indexOf("param2=") + 7), param2 = param2.indexOf("param3=") >= 0 ? param2.substring(0, param2.indexOf("param3=")) : param2.substring(0, param2.indexOf("EOFCOMMAND")), param2 = Trim(param2), param1 = param1.substring(0, param1.indexOf("param2=")), param1 = Trim(param1)) : (param1 = param1.substring(0, param1.indexOf("EOFCOMMAND")), param1 = Trim(param1)), finalparam = param1 + param2
                }
                srv_params.push(finalparam)
            }
            if (!0 === TestNSPolling() && (webphone_api.global.useajax_forservice = !0), wsapimaxloop > 15 && !IsMacLin() && !IsWinMacLinNsTest() && (webphone_api.global.useajax_forservice = !0), !0 === webphone_api.global.useajax_forservice || "API_Poll" === apiname) WSAPIReqHTTP(method, data, callback); else if (!0 === webphone_api.global.flagnsreconnect && (PutToDebugLog(2, "EVENT,WSAPIReconnect websocketNS because engine was stopped"), webphone_api.global.flagnsreconnect = !1, void 0 !== wsapisocket && null !== wsapisocket && (wsapisocket.close && (wsapiskt_closedmanually = !0, wsapisocket.close()), wsapisocket.onopen = null, wsapisocket.onclose = null, wsapisocket.onerror = null), wsapisocket = null), void 0 === wsapisocket || null === wsapisocket) {
                var url = GetParameter("last_good_ns_plugin_url");
                "API_Poll" !== apiname && "API_Stop" !== apiname && "API_HTTPKeepAlive" !== apiname && (wsapi_method.push(method), wsapi_data.push(data), wsapi_cb.push(callback)), isNull(url) || url.length < 5 ? IsServiceInstalled(function (e) {
                    PutToDebugLog(2, "EVENT WSAPIRequest IsServiceInstalled returned: " + e)
                }) : WSAPIConnect(url, method, data, callback)
            } else {
                if ((!1 === wsapiready || wsapi_method.length > 0) && "API_Poll" !== apiname && "API_Stop" !== apiname && "API_HTTPKeepAlive" !== apiname) {
                    wsapi_method.push(method), wsapi_data.push(data), wsapi_cb.push(callback);
                    var toprint = data;
                    return isNull(toprint) && (toprint = ""), toprint.length > 100 && (toprint = toprint.substring(0, 99)), !0 === wsapiready && wsapi_method.length > 0 && HandleWsapiQueue(), void PutToDebugLog(2, "EVENT, WSAPIRequest websocketNS cached for later execution: Websocket not ready: " + wsapiready + "(" + wsapi_method.length + "): " + toprint)
                }
                if ("API_Start" !== apiname && "API_SetParameters" !== apiname && "API_Poll" !== apiname && "API_Stop" !== apiname && webphone_api.global.apistartstate < 2 && webphone_api.global.apistarttick > 0 && GetTickCount() - webphone_api.global.apistarttick < 3e3) {
                    wsapi_method.push(method), wsapi_data.push(data), wsapi_cb.push(callback);
                    var toprint = data;
                    return isNull(toprint) && (toprint = ""), toprint.length > 100 && (toprint = toprint.substring(0, 99)), void PutToDebugLog(2, "EVENT, WSAPIRequest websocketNS cached for later execution: no API_Start feedback: " + toprint)
                }
                PutToDebugLog(4, "EVENT, _common: WSAPIRequest websocketNS SEND data: " + data), void 0 !== wsapisocket && null !== wsapisocket || PutToDebugLog(2, "ERROR, _common: WSAPIRequest websocketNS wsapisocket is NULL 1"), wsapisocket.send(data), wsapisocket.onmessage = function (evt) {
                    var recdata = null;
                    if (isNull(evt) || (recdata = evt.data), isNull(recdata)) return void PutToDebugLog(2, "ERROR, common: WSAPIRequest.onmessage websocketNS, received data is NULL");
                    webphone_api.webphone_pollstatus = !1;
                    var resp = ArrayBufferToString(recdata);
                    if (resp.indexOf("WPNOTIFICATION,") >= 0 && !0 === webphone_api.global.cansetuseengine && (webphone_api.global.useengine = webphone_api.global.ENGINE_SERVICE, webphone_api.global.cansetuseengine = !1), isNull(resp) || (resp = Trim(resp)), 0 !== resp.indexOf("webphone_api.") || resp.lastIndexOf(")") !== resp.length - 1 && resp.lastIndexOf(");") !== resp.length - 2) ProcessServiceReqResponse(resp, callback); else {
                        resp = Trim(resp), PutToDebugLog(2, "EVENT, Process service command: " + resp);
                        try {
                            eval(resp)
                        } catch (errp) {
                            PutToDebugLogException(2, "ERROR, Process service command failed: " + resp, errp)
                        }
                    }
                }
            }
        } catch (err) {
            PutToDebugLogException(2, "common: WSAPIRequest websocketNS", err)
        }
    }

    function WSAPIHandleReConnect() {
        try {
            WinAPI("extcmd_version", function (e) {
                isNull(e) || e.indexOf("ERROR:") >= 0 || (webphone_api.global.last_ns_ws_succwss = GetTickCount())
            }), setTimeout(function () {
                webphone_api.global.last_ns_ws_succwss < 1 || GetTickCount() - webphone_api.global.last_ns_ws_succwss > 1200 ? (webphone_api.common.PutToDebugLog(2, "ERROR, exec WSAPIReConnect from timer (1)"), WSAPIReConnect()) : !0 === webphone_api.isincall() ? (webphone_api.common.PutToDebugLog(2, "ERROR, exec WSAPIReConnect from timer (2) incall"), WSAPIReConnect()) : WinAPI("API_Start2", function (e) {
                    PutToDebugLog(2, "EVENT, exec API_Start2 because NS engine is not responsive: answer: " + e)
                })
            }, 1e3)
        } catch (e) {
            PutToDebugLogException(2, "common: WSAPIHandleReConnect", e)
        }
    }

    function WSAPIReConnect() {
        try {
            wsar_count++;
            var e = GetTickCount();
            if (e - wsar_lastcalled < 100) return;
            if (wsar_lastcalled = e, (!0 === wsa_ever_connected && wsar_count < 150 || wsar_count < 50) && null === wsar_timer) {
                wsar_delay > 2e3 && getuseengine() === webphone_api.global.ENGINE_SERVICE && webphone_api.global.phonestarted > 1 && (PutToDebugLog(1, "STATUS," + webphone_api.stringres.get("ns_engine_unreachable")), webphone_api.global.display_last_status = !0), wsar_delay < 32e3 && (wsar_delay *= 2);
                return PutToDebugLog(2, "EVENT, WSAPIReConnect websocketNS after: " + (wsar_delay / 1e3).toString() + " sec"), wsar_timer = setTimeout(function () {
                    wsar_delay > 3e4 ? (PutToDebugLog(2, "EVENT, WSAPIReConnect websocketNS whole SIPStack restart"), WSAPIConnect(wsapi_reconnect_address, "", "", function () {
                    })) : (PutToDebugLog(2, "EVENT, WSAPIReConnect websocketNS reconnecting..."), WSAPIConnect(wsapi_reconnect_address, "", "", function () {
                    })), isNull(wsar_timer) || clearTimeout(wsar_timer), wsar_timer = null
                }, wsar_delay), wsar_delay < 10 && (wsar_delay = 500), !0
            }
        } catch (o) {
            PutToDebugLogException(2, "common: WSAPIReConnect websocketNS", o)
        }
    }

    function WSAPIConnect(e, o, t, n) {
        try {
            0 !== e.indexOf("ws") && (e = "ws://" + e), PutToDebugLog(3, "EVENT, common: WSAPIConnect websocketNS url: " + e), wsapi_reconnect_address = e, wsapiskt_closedmanually = !1;
            var i = !1;
            0 === e.toLowerCase().indexOf("wss:") && (i = !0);
            var a = !1;
            if (!1 === TestNSPolling()) {
                try {
                    PutToDebugLog(3, "EVENT, common: WSAPIConnect websocketNS create socket (1)"), void 0 !== wsapisocket && null !== wsapisocket && (wsapisocket.close && (PutToDebugLog(2, "EVENT, WSAPIConnect websocketNS, close previous WebSocket connection (1)"), wsapiskt_closedmanually = !0, wsapisocket.close()), wsapisocket.onopen = null, wsapisocket.onclose = null, wsapisocket.onerror = null), wsapisocket = null, wsapisocket = new WebSocket(e, "api"), wsapisocket.binaryType = "arraybuffer", wsapisocket.onopen = WsapisktOnOpen, wsapisocket.onclose = WsapisktOnClose, wsapisocket.onerror = WsapisktOnError, a = !0, webphone_api.global.cansetuseengine = !0
                } catch (r) {
                    PutToDebugLogException(2, "common: WSAPIConnect websocketNS failed to connect to: " + e, r)
                }
                if (!1 === a && !1 === i) {
                    e = webphone_api.global.NATIVE_PLUGIN_URL_SECURE;
                    try {
                        PutToDebugLog(3, "EVENT, common: WSAPIConnect websocketNS create socket (2)"), void 0 !== wsapisocket && null !== wsapisocket && (wsapisocket.close && (PutToDebugLog(2, "EVENT, WSAPIConnect websocketNS, close previous WebSocket connection (2)"), wsapiskt_closedmanually = !0, wsapisocket.close()), wsapisocket.onopen = null, wsapisocket.onclose = null, wsapisocket.onerror = null), wsapisocket = null, wsapisocket = new WebSocket(e, "api"), wsapisocket.binaryType = "arraybuffer", wsapisocket.onopen = WsapisktOnOpen, wsapisocket.onclose = WsapisktOnClose, wsapisocket.onerror = WsapisktOnError, a = !0
                    } catch (s) {
                        PutToDebugLogException(2, "WSAPIConnect failed to connect on 2nd attempt to (on SECURE connection) : " + e, s)
                    }
                }
            }
            if (!1 === a) return void (IsMacLin() || IsWinMacLinNsTest() || (WSAPIReqHTTP(o, t, n), webphone_api.global.useajax_forservice = !0));
            (isNull(wsapisocket) || !1 === a) && (PutToDebugLog(3, "EVENT, common: WSAPIConnect websocketNS create socket (3)"), void 0 !== wsapisocket && null !== wsapisocket && (wsapisocket.close && (PutToDebugLog(2, "EVENT, WSAPIConnect websocketNS, close previous WebSocket connection (3)"), wsapiskt_closedmanually = !0, wsapisocket.close()), wsapisocket.onopen && (wsapisocket.onopen = null), wsapisocket.onclose && (wsapisocket.onclose = null), wsapisocket.onerror && (wsapisocket.onerror = null)), wsapisocket = null, wsapisocket = new WebSocket(e, "api"), wsapisocket.binaryType = "arraybuffer", wsapisocket.onopen = WsapisktOnOpen, wsapisocket.onclose = WsapisktOnClose, wsapisocket.onerror = WsapisktOnError), wsapisocket.onopen = WsapisktOnOpen, wsapisocket.onclose = WsapisktOnClose, wsapisocket.onerror = WsapisktOnError
        } catch (l) {
            PutToDebugLogException(2, "common: WSAPIConnect websocketNS", l)
        }
    }

    function WsapisktOnOpen() {
        PutToDebugLog(2, "EVENT, common: WSAPIConnect.onopen websocketNS, connection ready"), wsapiready = !0, wsapimaxloop = 0, wsa_ever_connected = !0, wsar_delay = 1, webphone_api.global.display_last_status && (webphone_api.global.display_last_status = !1, PutToDebugLog(2, "EVENT, Display last good status to hide Engine unreachable"), PutToDebugLog(1, "EVENT, " + webphone_api.global.last_good_status)), HandleWsapiQueue()
    }

    function WsapisktOnClose() {
        PutToDebugLog(2, "EVENT, common: WSAPIConnect.onclose websocketNS, connection closed"), wsapisocket = null, wsapiready = !1, !1 === wsapiskt_closedmanually && (PutToDebugLog(2, "ERROR, common: WSAPIConnect.onclose connection interrupted"), PutToDebugLog(2, "ERROR, common: WSAPIConnect.onclose websocketNS, call WSAPIReConnect"), WSAPIReConnect())
    }

    function WsapisktOnError() {
        var e = "";
        "undefined" != typeof wserr && null !== wserr && (e = wserr.toString()), PutToDebugLog(2, "ERROR, common: WSAPIConnect.onerror websocketNS, connection onerror: " + e), PutToDebugLog(2, "ERROR, common: WSAPIConnect.onerror websocketNS, call WSAPIReConnect"), WSAPIReConnect(), setTimeout(function () {
            void 0 !== wsapisocket && null !== wsapisocket && !0 === wsapiready && (webphone_api.global.wnotstartedsession = !1)
        }, 1500), wsapiready = !1, wsapimaxloop++
    }

    function HandleWsapiQueue() {
        try {
            if (isNull(wsapi_data) || wsapi_data.length < 1) return wsapi_method = [], wsapi_data = [], void (wsapi_cb = []);
            if (!isNull(hwqueue_timer)) return;
            hwqueue_timer = setInterval(function () {
                try {
                    if (isNull(wsapi_data) || wsapi_data.length < 1) return isNull(hwqueue_timer) || clearInterval(hwqueue_timer), hwqueue_timer = null, wsapi_method = [], wsapi_data = [], void (wsapi_cb = []);
                    if (void 0 === wsapisocket || null === wsapisocket) return void PutToDebugLog(2, "WANING, _common: WSAPIRequest websocketNS HandleWsapiQueue wsapisocket is NULL 2");
                    var e = wsapi_data[0], o = "", t = e.indexOf("function=");
                    if (t > 0 && (o = e.substring(t + 9), t = o.indexOf("EOFLINE"), o = t > 0 ? o.substring(0, t) : ""), "API_Start" !== o && "API_SetParameters" !== o && webphone_api.global.apistartstate < 2 && webphone_api.global.apistarttick > 0 && GetTickCount() - webphone_api.global.apistarttick < 3e3) return;
                    e = wsapi_data.shift();
                    var n = (wsapi_method.shift(), wsapi_cb.shift());
                    PutToDebugLog(4, "EVENT, _common: WSAPIRequest websocketNS HandleWsapiQueue SEND data: " + e), wsapisocket.send(e), wsapisocket.onmessage = function (e) {
                        var o = null;
                        if (isNull(e) || (o = e.data), isNull(o)) return void PutToDebugLog(2, "ERROR, common: WSAPIRequest.onmessage websocketNS HandleWsapiQueue, received data is NULL");
                        ProcessServiceReqResponse(ArrayBufferToString(o), n)
                    }
                } catch (i) {
                    PutToDebugLogException(2, "common: HandleWsapiQueue Timer, skip all cached requests", i), wsapi_method = [], wsapi_data = [], wsapi_cb = []
                }
            }, 60)
        } catch (e) {
            PutToDebugLogException(2, "common: HandleWsapiQueue", e)
        }
    }

    function WSAPIReqHTTP(e, o, t) {
        try {
            if (isNull(wreqhttp) || wreqhttp.length < 1) {
                if (wreqhttp = GetParameter("last_good_ns_plugin_url"), isNull(wreqhttp) || wreqhttp.length < 5) {
                    var n = GetNsPluginWsUrl();
                    if (null === n || n.length < 1) return void PutToDebugLog(2, "ERROR, WSAPIReqHTTP could not find a valid URL");
                    wreqhttp = n[0], n.length > 1(PreferWss() || IsHttps()) && n[0].indexOf("wss://") < 0 && n[1].indexOf("wss://") >= 0 && (wreqhttp = n[1])
                }
                wreqhttp = wreqhttp.toLowerCase(), wreqhttp = wreqhttp.replace("wss:", "https:"), wreqhttp = wreqhttp.replace("ws:", "http:"), wreqhttp = wreqhttp.replace("msstwebsock", ""), PutToDebugLog(2, "EVENT, WSAPIReqHTTP url: " + wreqhttp)
            }
            PollServiceStatus(e, wreqhttp);
            var i = "POST";
            "get" === e.toLowerCase() && (i = "GET"), webphone_api.$.ajax({
                url: wreqhttp,
                data: o,
                timeout: 2500,
                method: i
            }).done(function (e, o, n) {
                if (PutToDebugLog(2, "EVENT, common: WSAPIReqHTTP response: " + e), isNull(e)) return void PutToDebugLog(2, "ERROR, common: WSAPIReqHTTP received data is NULL");
                ProcessServiceReqResponse(e, t)
            }).fail(function (e, o, t) {
                PutToDebugLog(2, "ERROR, common: WSAPIReqHTTP ajax failed, status: " + o + "; error: " + t)
            })
        } catch (a) {
            PutToDebugLogException(2, "common: WSAPIReqHTTP", a)
        }
    }

    function PollServiceStatus(e, o) {
        try {
            if (!0 !== webphone_api.global.useajax_forservice) return;
            if (!isNull(webphone_api.global.serviceStatusPollTimer)) return;
            nspollinterval < 1 && (nspollinterval = GetParameterInt("nspollinterval", 300)), webphone_api.global.serviceStatusPollTimer = setInterval(function () {
                pollreqcount++, !0 === TestNSPolling() && PutToDebugLog(2, "EVENT, common: PollServiceStatus: send extcmd_poll; request sent count: " + pollreqcount), webphone_api.$.ajax({
                    url: o,
                    data: "extcmd_poll",
                    timeout: 1e3,
                    method: e.toUpperCase()
                }).done(function (e, o, t) {
                    isNull(e) && (e = "");
                    var n = e.indexOf("APIRESULT:");
                    n > 0 && (e = e.substring(n + 10), e.indexOf("nomessage") < 0 && (n = e.indexOf("message:")) > 0 && (e = Trim(e.substring(n + 8)), webphonetojs(e)))
                }).fail(function (e, o, t) {
                    PutToDebugLog(2, "ERROR, common: PollServiceStatus ajax failed, status: " + o + "; error: " + t)
                })
            }, nspollinterval)
        } catch (t) {
            PutToDebugLogException(2, "common: WSAPIReqHTTP", t)
        }
    }

    function ProcessServiceReqResponse(e, o) {
        var t = 0;
        try {
            var n = "";
            if (t = 11, isNull(e) || e.length < 1) return t = 13, PutToDebugLog(4, "EVENT, common: ServiceResponse, received data(1): " + e), o(null), o = null, "";
            if (e = e.replace("NORETRY", ""), e.indexOf("webphone_api.") >= 0 && (")" === e.charAt(e.length - 1) || ")" === e.charAt(e.length - 2) && ";" === e.charAt(e.length - 1))) return PutToDebugLog(2, "EVENT, common: ServiceResponse exec function received form websocket: " + e), void ExecFunction(e);
            if (e.indexOf("OK: pending") >= 0) return void PutToDebugLog(2, "EVENT, common: ServiceResponse received pending, waiting for answer");
            if (e.indexOf("WPNOTIFICATION") >= 0) return webphonetojs(e), !0;
            if (!(e.indexOf("APIREQUEST:") >= 0)) return PutToDebugLog(4, "EVENT, common: ServiceResponse, received data(3): " + e), t = 46, void 0 !== o && null !== o && IsFunction(o) && o(n), o = null, n;
            PutToDebugLog(4, "EVENT, common: ServiceResponse, received data(2): " + e), t = 14;
            var i = "", a = "", r = "";
            if (e.indexOf("APIRESULT:") > 0 && (t = 15, getuseengine() === webphone_api.global.ENGINE_SERVICE && (webphone_api.global.service_last_life_signal = GetTickCount()), e.indexOf("RPARAM1") > 0 ? (i = e.substring(e.indexOf("APIREQUEST:") + 11, e.indexOf("RPARAM1:")), e.indexOf("RPARAM2") > 0 ? (a = e.substring(e.indexOf("RPARAM1:") + 8, e.indexOf("RPARAM2")), r = e.substring(e.indexOf("RPARAM2:") + 8, e.indexOf("APIRESULT:"))) : a = e.substring(e.indexOf("RPARAM1:") + 8, e.indexOf("APIRESULT:")), n = e.substring(e.indexOf("APIRESULT:") + 10, e.length)) : (i = e.substring(e.indexOf("APIREQUEST:") + 11, e.indexOf("APIRESULT:")), n = e.substring(e.indexOf("APIRESULT:") + 10, e.length))), t = 18, isNull(i) ? i = "" : (i = Trim(i), i = i.toLowerCase()), n = isNull(n) ? "" : Trim(n), t = 19, 50 === GetConfigInt("brandid", -1) && (isNull(a) && (a = ""), a = a.toLowerCase(), a.indexOf("ww.favafone") > 0)) return a.indexOf("countries-list") > 0 ? HttpResponseHandler(n, "get_new_user_countrylist") : a.indexOf("registration-form") > 0 ? HttpResponseHandler(n, "get_new_user_form_fields") : a.indexOf("create-account") > 0 && HttpResponseHandler(n, "newuser_dynamic"), n;
            if (t = 20, "api_poll" === i) t = 21, webphonetojs(n), t = 22; else {
                if (0 !== i.indexOf("api_")) return n.indexOf("ERROR") >= 0 ? (t = 30, PutToDebugLog(2, "ERROR, " + n), t = 31, o && IsFunction(o) && (t = 32, o(n), o = null), "") : "true" === n.toLowerCase() ? (t = 35, o(!0), o = null, !0) : "false" === n.toLowerCase() ? (t = 36, o(!1), o = null, !1) : IsNumber(n) ? (t = 37, o(StrToInt(n)), o = null, StrToInt(n)) : n.indexOf("OK") >= 0 && n.length < 12 ? (t = 40, o(!0), o = null, !0) : (t = 41, o(n), o = null, n);
                if (t = 23, n.indexOf("ERROR") >= 0) if (GetParameter("devicetype") === DEVICE_WIN_SOFTPHONE() || getuseengine() === webphone_api.global.ENGINE_SERVICE) n.indexOf("wphone") > 0 && n.indexOf("not") > 0 && n.indexOf("started") > 0 && !1 === webphone_api.global.wnotstartedsession && webphone_api.global.apistartstate > 0 && webphone_api.global.apistarttick > 0 && GetTickCount() - webphone_api.global.apistarttick > 3e3 && (webphone_api.global.wnotstartedsession = !0, PutToDebugLog(2, "WARNING, mlogic API_Sart because: wphone not started received"), WinAPI("API_Start", function (e) {
                    PutToDebugLog(2, "ERROR, API_Start because: wphone not started answer: " + e)
                })); else if ("api_call" === i) {
                    t = 24;
                    var s = n.replace("ERROR", "");
                    s = s.replace(":", ""), PutToDebugLog(1, "ERROR, " + s)
                } else t = 25, PutToDebugLog(2, "ERROR, " + n);
                t = 26;
                var l = null;
                if (!isNull(srv_cb) && srv_cb.length > 0) {
                    var p = a + r;
                    !isNull(p) && p.length > 85 && (p = p.substring(0, 85));
                    for (var c = 0; c < srv_apiname.length; c++) if (srv_apiname[c] === i) {
                        !isNull(srv_params[c]) && srv_params[c].length > 85 && (srv_params[c] = srv_params[c].substring(0, 85));
                        var u = srv_params[c], h = p, m = u.indexOf("\r");
                        if (m > 0 && (u = u.substring(0, m)), u = Trim(u), m = h.indexOf("\r"), m > 0 && (h = h.substring(0, m)), h = Trim(h), srv_params[c] === p || !isNull(u) && u.length > 0 && u === h) {
                            srv_apiname[c], l = srv_cb[c], isNull(l) || IsFunction(l) || (PutToDebugLog(2, "WARNING,ProcessServiceReqResponse callback is not a function: " + typeof l), l = null), srv_apiname.splice(c, 1), srv_cb.splice(c, 1), srv_params.splice(c, 1);
                            break
                        }
                    }
                }
                if (t = 27, !isNull(l) && IsFunction(l)) return t = 28, isNull(n) && (t = 102, n = ""), t = 103, n = n.toString(), t = 104, "true" === n.toLowerCase() ? (t = 105, l(!0), t = 106, !0) : "false" === n.toLowerCase() ? (t = 107, l(!1), t = 108, !1) : n.toString && IsNumber(n.toString().replace("OK:", "")) ? (t = 109, l(StrToInt(n.toString().replace("OK:", ""))), StrToInt(n.toString().replace("OK:", ""))) : n.indexOf("OK") >= 0 && n.length < 15 ? (t = 110, l(!0), t = 111, !0) : (t = 112, "function" == typeof l ? l(n) : PutToDebugLog(2, "WARNING, ProcessServiceResponse cb_tmp is not a function (" + t + ")"), t = 113, n);
                var g = "";
                g = isNull(l) ? "NULL" : l.toString(), PutToDebugLog(2, "WARNING, ProcessServiceResponse cb_tmp is not a function: " + g), t = 29
            }
            t = 45
        } catch (_) {
            if (void 0 !== _ && null !== _) {
                var d = _.toString(), b = "";
                if ("undefined" != typeof _.message && null !== _.message && (b = _.message), d.toLowerCase().indexOf("is not a function") >= 0 || b.toLowerCase().indexOf("is not a function") >= 0) return void PutToDebugLog(2, "EVENT, common: ProcessServiceReqResponse (" + t.toString() + ")" + d + " " + b)
            }
            PutToDebugLogException(2, "common: ProcessServiceReqResponse (" + t.toString() + ")", _)
        }
    }

    function WSRequest(e, o, t) {
        var n = 0;
        try {
            if (isNull(wssocket)) {
                PutToDebugLog(2, "EVENT, WSRequest need WsConnect websocketAPI, url: " + e), n = 1;
                var i = GetWebrtcSrvAddr();
                if (n = 2, isNull(i) || i.length < 2) {
                    if (i = GetWp(), IsLocalServer(!0)) return void PutToDebugLog(2, "ERROR, " + webphone_api.stringres.get("webrtc_local_sipserver") + " (1)")
                } else PutToDebugLog(2, "EVENT, WSRequest webrtcserveraddress found: " + i);
                if (i = i.replace("*", ""), n = 11, "true" === GetConfig("usingmizuserver")) {
                    n = 12;
                    var a = i.indexOf("/mfst");
                    a > 0 && (i = i.substring(0, a)), i += "/mvstwebsock"
                }
                if (i = i.replace("/mfstwebsock", "/mvstwebsock"), ws_inurl.push(e), ws_action.push(o), ws_ispost.push(t), HandleQueueOverload(), IsMizuWebRTCGateway() && !1 === webphone_api.global.decideusuk_finished && getuseengine() === webphone_api.global.ENGINE_WEBRTC) return void PutToDebugLog(2, "EVENT, WSRequest decideusuk not yet finished");
                PutToDebugLog(2, "EVENT, WSRequest call WsConnect websocketAPI"), WSConnect(e, o, t, i), n = 17
            } else {
                if (!1 === wsready || ws_inurl.length > 0) return ws_inurl.push(e), ws_action.push(o), ws_ispost.push(t), HandleQueueOverload(), void PutToDebugLog(2, "EVENT, webphone_api.common.WSRequest request cached for later execution");
                var r = e;
                r = r.replace("mvapireq", "mvstwebsock/mvapireq"), r = HandleApiKey(r), !isNull(r) && r.indexOf("google.com") > 0 ? PutToDebugLog(4, "EVENT, _common: WSRequest initialized") : PutToDebugLog(4, "EVENT, _common: WSRequest url: " + r);
                try {
                    n = 30, isNull(ws_action_sent) && (ws_action_sent = []), isNull(o) && (o = ""), ws_action_sent.push(o), void 0 !== wssocket && null !== wssocket || PutToDebugLog(2, "ERROR, _common: WSRequest wssocket is NULL 1"), webphone_api.global.wsc_reqtimeout = GetTickCount(), wssocket.send(r + "\r\n"), n = 34
                } catch (s) {
                    PutToDebugLogWarning(3, "WARNING, common: WSRequest", s)
                }
                n = 35
            }
        } catch (l) {
            PutToDebugLogException(2, "common: WSRequest (" + n.toString() + ")", l)
        }
    }

    function HandleQueueOverload() {
        try {
            var e = 0, o = 0;
            if (!isNull(ws_inurl) && ws_inurl.length > 0) for (; o < ws_inurl.length && e < 15;) "webrtcload" === ws_action[o] || "webrtccreateuser" === ws_action[o] ? o++ : (ws_inurl.splice(o, 1), ws_action.splice(o, 1), ws_ispost.splice(o, 1), e++)
        } catch (t) {
            PutToDebugLogException(2, "common: HandleQueueOverload", t)
        }
    }

    function WSConnect(e, o, t, n) {
        var i = 0;
        try {
            if (isNull(n) || n.length < 2) PutToDebugLog(2, "ERROR, common: WSConnect websocketAPI address is NULL"); else {
                i = 2, 0 !== n.indexOf("ws") && (n = "ws://" + n);
                var a = "";
                try {
                    a = location.host.toLowerCase()
                } catch (r) {
                }
                (IsHttps() || (a.indexOf("localhost") >= 0 || a.indexOf("127.0.0.1") >= 0) && ("Chrome" === GetBrowser() || "Firefox" === GetBrowser())) && (n = n.replace("ws:", "wss:")), n = n.toString(), PutToDebugLog(2, "EVENT, WSConnect websocketAPI address: " + n), webphone_api.global.wsc_contimeout = GetTickCount(), wsconnect_address = n, wssocket = new WebSocket(n, "api"), wssocket.binaryType = "arraybuffer", i = 5
            }
            wssocket.onopen = function () {
                webphone_api.global.wsc_contimeout = 0, PutToDebugLog(2, "EVENT, common: WSConnect.onopen websocketAPI, connection ready"), SaveParameter("wseverconnected", "true"), wsready = !0, HandleWsQueue()
            }, wssocket.onclose = function () {
                PutToDebugLog(2, "EVENT, common: WSConnect.onclose websocketAPI, connection closed"), wssocket = null, wsready = !1
            }, wssocket.onerror = function (e) {
                var o = "";
                isNull(e) || (o = e.toString()), PutToDebugLog(2, "ERROR, common: WSConnect.onerror websocketAPI, connection onerror: " + o), wsready = !1, wssocket = null, PutToDebugLog(2, "ERROR, common: WSConnect.onerror websocketAPI, call WSReConnect"), WSReConnect()
            }, i = 20, wssocket.onmessage = function (e) {
                webphone_api.global.wsc_reqtimeout = 0;
                var o = null;
                if (isNull(e) || (o = e.data), isNull(o)) return void PutToDebugLog(2, "ERROR, common: WSConnect.onmessage websocketAPI, received data is NULL");
                var t = "";
                isNull(ws_action_sent) || isNull(ws_action_sent[0]) || (t = ws_action_sent.shift()), HttpResponseHandler(ArrayBufferToString(o), t)
            }
        } catch (s) {
            PutToDebugLogException(2, "common: WSConnect websocketAPI (" + i.toString() + ")", s)
        }
    }

    function WSReConnect() {
        try {
            if (++wsr_count < 80 && null === wsr_timer) {
                wsr_delay < 32e3 && (wsr_delay *= 2);
                return PutToDebugLog(2, "EVENT, WSReConnect websocketAPI after: " + (wsr_delay / 1e3).toString() + " sec"), wsr_timer = setTimeout(function () {
                    PutToDebugLog(2, "EVENT, WSReConnect websocketAPI reconnecting..."), WSConnect("", "", "", wsconnect_address), isNull(wsr_timer) || clearTimeout(wsr_timer), wsr_timer = null
                }, wsr_delay), wsr_delay < 10 && (wsr_delay = 500), !0
            }
        } catch (e) {
            PutToDebugLogException(2, "common: WSReConnect websocketAPI", e)
        }
    }

    function HandleWsQueue() {
        try {
            if (isNull(ws_inurl) || ws_inurl.length < 1) return;
            if (!isNull(hawsqueue_timer)) return;
            hawsqueue_timer = setInterval(function () {
                if (isNull(ws_inurl) || ws_inurl.length < 1) return isNull(hawsqueue_timer) || clearInterval(hawsqueue_timer), void (hawsqueue_timer = null);
                if (void 0 === wssocket || null === wssocket) return void PutToDebugLog(2, "WARNING, _common: WSRequest HandleWsQueue wssocket is NULL 2");
                var e = ws_inurl.shift(), o = ws_action.shift();
                ws_ispost.shift();
                ws_action_sent.push(o), e = HandleApiKey(e), PutToDebugLog(4, "EVENT, _common: WSRequest HandleWsQueue SEND data: " + e), webphone_api.global.wsc_reqtimeout = GetTickCount(), wssocket.send(e + "\r\n")
            }, 200)
        } catch (e) {
            PutToDebugLogException(2, "common: HandleWsQueue", e)
        }
    }

    function HandleApiKey(e) {
        try {
            if (isNull(e)) return e;
            var o = e, t = o.indexOf("mcrfs=");
            if (t > 0 && (o = StrDc("mcrfs_" + o.substring(t + 6), webphone_api.global.ec_apikey)), !isNull(webphone_api.global.selected_apikey) && webphone_api.global.selected_apikey.length > 0) {
                var n = o.indexOf("authkey=");
                if (n > 0) {
                    var i = o.substring(0, n + 8), a = "";
                    o = o.substring(n + 8), n = o.indexOf("&"), n > 0 && (a = o.substring(n + 1)), e = i + webphone_api.global.selected_apikey + a
                }
                t > 0 && (e = e.substring(0, t + 6) + StrEc(o, webphone_api.global.ec_apikey, !0))
            } else {
                if (o.indexOf("1568108399") > 0) return e;
                if (o.indexOf("authkey=1568108345") > 0 && "us" === webphone_api.global.usuk) o = o.replace("authkey=1568108345", "authkey=1552303117"), e = t > 0 ? e.substring(0, t + 6) + StrEc(o, webphone_api.global.ec_apikey, !0) : o; else if (o.indexOf("authkey=1552303117") > 0 && "uk" === webphone_api.global.usuk) o = o.replace("authkey=1552303117", "authkey=1568108345"), e = t > 0 ? e.substring(0, t + 6) + StrEc(o, webphone_api.global.ec_apikey, !0) : o; else if (!isNull(wsconnect_address) && wsconnect_address.length > 3 && webphone_api.global.usuk.length > 0) {
                    var r = 0;
                    if (wsuk_ip.length < 1 && (wsuk_ip = StrDc(wip_uk, alsvkey), wsuk_domain = StrDc(wips_uk, alsvkey), wsus_ip = StrDc(wip_us, alsvkey), wsus_domain = StrDc(wips_us, alsvkey), t = -1, wsuk_ip = wsuk_ip.replace("ws://", ""), t = wsuk_ip.lastIndexOf("/"), t > 0 && (wsuk_ip = wsuk_ip.substring(0, t)), t = wsuk_ip.lastIndexOf(":"), t > 0 && (wsuk_ip = wsuk_ip.substring(0, t)), wsus_ip = wsus_ip.replace("ws://", ""), t = wsus_ip.lastIndexOf("/"), t > 0 && (wsus_ip = wsus_ip.substring(0, t)), t = wsus_ip.lastIndexOf(":"), t > 0 && (wsus_ip = wsus_ip.substring(0, t)), wsuk_domain = wsuk_domain.replace("wss://", ""), t = wsuk_domain.lastIndexOf("/"), t > 0 && (wsuk_domain = wsuk_domain.substring(0, t)), t = wsuk_domain.lastIndexOf(":"), t > 0 && (wsuk_domain = wsuk_domain.substring(0, t)), wsus_domain = wsus_domain.replace("wss://", ""), t = wsus_domain.lastIndexOf("/"), t > 0 && (wsus_domain = wsus_domain.substring(0, t)), (t = wsus_domain.lastIndexOf(":")) > 0 && (wsus_domain = wsus_domain.substring(0, t))), o.indexOf("authkey=1552303117") < 0 && o.indexOf("authkey=1568108345") < 0 && (wsconnect_address.indexOf(wsuk_ip) >= 0 || wsconnect_address.indexOf(wsuk_domain) >= 0 ? r = 1 : (wsconnect_address.indexOf(wsus_ip) >= 0 || wsconnect_address.indexOf(wsus_domain) >= 0) && (r = 2), r > 0)) {
                        var s = "";
                        if (t = e.indexOf("mcrfs="), t > 0 && (s = e.substring(0, e.indexOf("mcrfs=") + 6)), (t = o.indexOf("authkey=")) > 0) {
                            var l = o.substring(0, t), p = "";
                            o = o.substring(t), t = o.indexOf("&"), t < 0 && (t = o.length), t > 0 && (p = o.substring(t)), isNull(p) && (p = "");
                            var c = "";
                            c = 1 === r ? "authkey=1568108345" : "authkey=1552303117", o = l + c + p, e.indexOf("mcrfs=") > 0 && (o = StrEc(o, webphone_api.global.ec_apikey, !0)), e = s + o
                        }
                    }
                }
            }
        } catch (u) {
            PutToDebugLogException(2, "common: HandleApiKey", u)
        }
        return e
    }

    function HttpAsyncHandler(e) {
        try {
            if (isNull(e) || e.length < 1) return void PutToDebugLog(2, "ERROR, HttpAsyncHandler notification is NULL");
            e = Trim(e), webphone_api.global.currhttpmehodworking = !0;
            var o = "", t = "";
            if ("true" === GetConfig("usingmizuserver")) {
                var n = e.indexOf("oenc1_");
                n > 0 && (e = e.substring(n + 6), e = StrDc(e, webphone_api.global.ec_apikey))
            }
            var n = e.indexOf("REQUEST:");
            if (n > 0 && (t = e.substring(n + 8, e.length), t = Trim(t)), (n = e.indexOf("RESULT:")) >= 0) {
                var i = e.indexOf("REQUEST:");
                i < 1 && (i = e.length), o = e.substring(n + 7, i), o = Trim(o), o.lastIndexOf(",") === o.length - 1 && (o = Trim(o.substring(0, o.length - 1)))
            }
            if (isNull(o) || o.length < 1) return void PutToDebugLog(2, "WARNING, HttpAsyncHandler response is NULL");
            if (isNull(t) || t.length < 1) return void PutToDebugLog(2, "WARNING, HttpAsyncHandler request is NULL");
            if (t.indexOf("AUTOPROVISIONING") >= 0) {
                if (isNull(o) || !(o.toLowerCase().indexOf("endofautoprovisioning") > 0)) return void PutToDebugLog(2, "ERROR, HttpAsyncHandler autoprovidioning error: " + o);
                PutToDebugLog(2, "EVENT, HttpAsyncHandler autoprovidioning succeded: " + o), ParseAutoprovisioning(o), "false" === GetParameter("serverinputisupperserver") && RestartPhone()
            }
            t.toLowerCase().indexOf("balance") > 0 || t.toLowerCase().indexOf("includecurrency") > 0 ? HttpResponseHandler(o, "creditrequest") : t.toLowerCase().indexOf("rating") > 0 || t.toLowerCase().indexOf("tariffs") > 0 ? HttpResponseHandler(o, "getrating") : t.toLowerCase().indexOf("=callback") > 0 ? HttpResponseHandler(o, "callback") : t.toLowerCase().indexOf("=wsload") > 0 ? HttpResponseHandler(o, "webrtcload") : t.toLowerCase().indexOf("srvct") > 0 ? HttpResponseHandler(o, "downloadcontacts") : t.toLowerCase().indexOf("lastcalldetails") > 0 ? HttpResponseHandler(o, "lastcalldetails") : t.toLowerCase().indexOf("wrtcload_uk") > 0 ? HttpResponseHandler(o, "wrtcload_uk") : t.toLowerCase().indexOf("wrtcload_us") > 0 ? HttpResponseHandler(o, "wrtcload_us") : t.toLowerCase().indexOf("scurl_displaypeerdetails") > 0 ? HttpResponseHandler(o, "scurl_displaypeerdetails") : t.toLowerCase().indexOf("getconfroom") > 0 ? HttpResponseHandler(o, "getconferenceroom") : t.toLowerCase().indexOf("waitforparameters") > 0 ? HttpResponseHandler(o, "waitforparameters") : t.toLowerCase().indexOf("recharge") > 0 ? HttpResponseHandler(o, "recharge") : t.toLowerCase().indexOf("tel.search.ch") > 0 ? HttpResponseHandler(o, "telsearchname") : t.toLowerCase().indexOf("calldivert") > 0 ? HttpResponseHandler(o, "calldivertapi") : t.toLowerCase().indexOf("presence_set") > 0 ? HttpResponseHandler(o, "presence_set") : (t.toLowerCase().indexOf("get_custom_menu") > 0 || t.toLowerCase().indexOf("logincheck") > 0) && HttpResponseHandler(o, "get_custom_menu")
        } catch (a) {
            PutToDebugLogException(2, "common: HttpAsyncHandler", a)
        }
    }

    function HttpResponseHandler(e, o) {
        try {
            if (webphone_api.global.currhttpmehodworking = !0, !isNull(e) && e.toString().indexOf("auth failed: wrong key") >= 0) {
                var t = e.toString();
                t = t.substring(0, t.indexOf("wrong key") + 9)
            }
            if (isNull(e)) return void PutToDebugLog(3, "ERROR, common: httpResponse is NULL");
            var n = e.toString(), i = "";
            i = n.length > 600 ? n.substring(0, 600) + " ..." : n;
            var a = n.toLowerCase();
            if (a.indexOf("wsuser") >= 0 || "webrtccreateuser" === o) {
                var r = n;
                if (r.indexOf("DISPLAY") > 0) return r = Trim(r.replace("DISPLAY", "")), PutToDebugLog(1, r), void ShowToast(r);
                if (a.indexOf("ok:") >= 0) {
                    var s = GetParameter("wsusers"), l = GetSipusername();
                    if (webphone_api.iswebrtcengineworking = 1, webphone_api.global.last_wsu_tick = GetTickCount(), l.length > 0) s.indexOf(l) < 0 && (s.length > 0 && "," !== s.charAt(s.length - 1) && (s += ","), s += l, SaveParameter("wsusers", s)); else {
                        a.indexOf(" ") > 0 && (a = Trim(a), l = a.substring(a.lastIndexOf(" ") + 1), l = Trim(l), l.length > 0 && s.indexOf(l) < 0 && (s.length > 0 && "," !== s.charAt(s.length - 1) && (s += ","), s += l, SaveParameter("wsusers", s)))
                    }
                    PutToDebugLog(3, "EVENT, common wsuser response: " + i), webphone_api.global.wsuser_succeded = !0
                } else PutToDebugLog(3, "ERROR, common wsuser failed, response: " + i);
                return
            }
            if (PutToDebugLog(3, "EVENT, common: httpResponse: " + i + "; action: " + o), isNull(o) || Trim(o).length < 1) return void PutToDebugLog(2, "ERROR, common: HttpResponseHandler action is NULL");
            if ("creditrequest" === o) {
                var p = n.toLowerCase();
                if (p.indexOf("error") >= 0 && 50 !== GetConfigInt("brandid", -1) || p.indexOf("postpaid") >= 0 || p.indexOf("invalid") >= 0 || p.indexOf("not found") >= 0) webphone_api.global.creditRequestIval < 3e4 ? webphone_api.global.creditRequestIval = 2 * webphone_api.global.creditRequestIval : webphone_api.global.creditRequestIval = webphone_api.global.CREDIT_REQUEST_IVAL_DEFVAL; else {
                    if (50 === GetConfigInt("brandid", -1)) {
                        var c = JSON.parse(n), u = c.data, h = c.error;
                        if (!isNull(h) && h.length > 0) return void PutToDebugLog(2, "ERROR, Favafone creditrequest error: " + h);
                        if (isNull(u)) return void PutToDebugLog(3, "ERROR, Favafone creditrequest httpresponsehandler data is NULL");
                        var m = u.balance, g = u.currency_sign;
                        return m.length > 0 && (webphone_api.global.credit = "Credit: " + g + " " + m), void PutToDebugLog(4, "EVENT, Favafone received credit balance: " + webphone_api.global.credit)
                    }
                    n = n.replace("{", ""), n = n.replace("}", ""), n = ReplaceAll(n, '"', "");
                    webphone_api.global.credit = "" + n, webphone_api.global.credit.indexOf("Your credit is") >= 0 && (webphone_api.global.credit = webphone_api.global.credit.replace("Your credit is", "Credit:")), webphone_api.global.creditRequestIval = webphone_api.global.CREDIT_REQUEST_IVAL_DEFVAL
                }
            } else if ("getrating" === o) {
                if ((n.toLowerCase().indexOf("error") >= 0 || n.indexOf("postpaid") >= 0 || n.indexOf("invalid") >= 0 || n.indexOf("not found") >= 0) && 50 !== GetConfigInt("brandid", -1)) return void PutToDebugLog(2, "ERROR, HttpResponseHandler action: Call, error: " + n);
                var d = n;
                if (50 === GetConfigInt("brandid", -1)) {
                    var c = JSON.parse(n), b = c.data, h = c.error;
                    if (!isNull(h) && h.length > 0) return void PutToDebugLog(2, "ERROR, Favafone getrating error: " + h);
                    if (isNull(b) || isNull(b[0])) return void PutToDebugLog(3, "ERROR, Favafone getrating httpresponsehandler data is NULL");
                    var _ = b[0].voice_rate, f = b[0].description, g = b.currency_sign;
                    if (_.length < 1 || "null" === _.toLowerCase()) return void PutToDebugLog(2, "ERROR, Favafone getrating, rating request respose2: " + n);
                    d = g + " " + _ + " / min (" + f + ")"
                }
                50 !== GetConfigInt("brandid", -1) && (d += webphone_api.stringres.get("rating_minute")), ShowRatingWhyleType(d), webphone_api.global.rating = " (" + d + webphone_api.stringres.get("rating_minute") + ")"
            } else if ("get_custom_menu" === o) ProcessCustomMenu(n); else if ("waitforparameters" === o) webphone_api.plhandler.ParseReceivedParameters(n); else if ("presence_set" === o) HandleOfflineMessages(n); else if ("webrtcload" === o) {
                if (n.toLowerCase().indexOf("error") >= 0) return void PutToDebugLog(2, "ERROR, HttpResponseHandler action: webrtcload, error: " + n);
                var w = n.toLowerCase(), v = w.indexOf("ws load:");
                if (v >= 0) {
                    if (w.indexOf("type:") > 0) {
                        var E = w.substring(w.indexOf("type:") + 5);
                        E = Trim(E), !isNull(E) && IsNumber(E) && (webphone_api.global.wsload_type = StrToInt(E))
                    }
                    w = w.substring(v + 8), w = Trim(w);
                    var T = -1;
                    webphone_api.iswebrtcengineworking = 1;
                    try {
                        T = parseInt(w, 10)
                    } catch (A) {
                        PutToDebugLogException(2, "common: HttpResponseHandler parse webrtc load", A)
                    }
                    var P = GetEngine("webrtc");
                    if (P.serversupport_cache = T, SetEngine("webrtc", P), webphone_api.global.recwsload = T, T > 2) if (T > 3) {
                        if (!1 === webphone_api.global.usestorage && !1 === Strl(60) && getuseengine() === webphone_api.global.ENGINE_WEBRTC && !0 === CanIUseService()) {
                            SaveParameter("lastusedengine", "ns"), webphone_api.flagrestartwebrtc = !1, ResetEngineClicked();
                            var S = GetEngine("ns");
                            S.clicked = 2, SetEngine("ns", S), EngineSelect(1), PutToDebugLog(2, "WARNING, common wsload: offer ns engine because webrtc load is too high: " + T.toString()), EngineForcedInstall("ns", webphone_api.stringres.get("serviceengine_msg"), function () {
                                webphone_api.startInner()
                            })
                        }
                    } else setTimeout(function () {
                        getuseengine() === webphone_api.global.ENGINE_WEBRTC && (SaveParameter("enablepresence", "0"), PutToDebugLog(2, "EVENT, disable presence because wsload is high: " + T.toString()))
                    }, 5e3); else 2 === T ? webphone_api.global.presenceinterval = 144e4 : 0 === T && (webphone_api.global.presenceinterval = 36e4)
                }
            } else if ("wrtcload_uk" === o || "wrtcload_us" === o) {
                if (n.toLowerCase().indexOf("error") >= 0) return void PutToDebugLog(2, "ERROR, HttpResponseHandler action: webrtcload, error: " + n);
                var w = n.toLowerCase(), v = w.indexOf("ws load:");
                if (v >= 0) {
                    var N = 0;
                    if (w.indexOf("pmsec:") > 0) {
                        var I = w.substring(w.indexOf("pmsec:") + 6);
                        I = Trim(I), !isNull(I) && IsNumber(I) && (N = StrToInt(I))
                    }
                    w = w.substring(v + 8), w = Trim(w);
                    var T = -1;
                    try {
                        T = parseInt(w, 10)
                    } catch (A) {
                        PutToDebugLogException(2, "common: HttpResponseHandler parse webrtc load", A)
                    }
                    var C = GetParameter("last_good_webrtc_gw");
                    "wrtcload_uk" === o ? (wsl_uk = T, wsl_uk_time = GetTickCount() - N, isNull(C) || "uk" !== C || (wsl_uk_time -= 15), webphone_api.global.wsl_uk_rec = !0) : (wsl_us = T, wsl_us_time = GetTickCount() - N, isNull(C) || "us" !== C || (wsl_us_time -= 15), webphone_api.global.wsl_us_rec = !0), DecideUsUk()
                }
            } else if ("recharge" === o) n.toLowerCase().indexOf("error") >= 0 && PutToDebugLog(2, "ERROR, HttpResponseHandler action: recharge, error: " + n), ShowToast(n); else if ("newuserreg" === o) webphone_api._newuser.HttpResponseHandler(n, o); else if ("get_new_user_form_fields" === o || "newuser_dynamic" === o || "get_new_user_countrylist" === o) webphone_api._newuser.HttpResponseHandler(n, o); else if ("verifysmscode" === o) webphone_api._smscodeverify.HttpResponseHandler(n, o); else if ("phone2phone" === o) n.toLowerCase().indexOf("error") >= 0 && PutToDebugLog(2, "ERROR, HttpResponseHandler action: phone2phone, error: " + n), ShowToast(n); else if ("callback" === o) {
                if (n.toLowerCase().indexOf("error") >= 0) return void PutToDebugLog(2, "ERROR, HttpResponseHandler action: callback, error: " + n);
                isNull(n) && (n = ""), n = Trim(n), ShowToast(n)
            } else if ("presence_verify" === o || "presence_get" === o) PresenceProcessUserlist2(Trim(n), o); else if ("downloadcontacts" === o) {
                if (n.toLowerCase().indexOf("error") >= 0) return void PutToDebugLog(2, "ERROR, HttpResponseHandler action: " + o + ", error: " + n);
                ParseContactsFromServer(n, !1, function (e) {
                    e ? (PutToDebugLog(1, "EVENT, " + webphone_api.stringres.get("sync_succeded")), PutToDebugLog(1, "EVENT, POPUP, " + webphone_api.stringres.get("sync_succeded")), webphone_api.global.reloadcontactsaftersync = !0) : (PutToDebugLog(1, "ERROR, " + webphone_api.stringres.get("sync_failed")), PutToDebugLog(1, "EVENT, POPUP, " + webphone_api.stringres.get("sync_failed")))
                })
            } else if ("lastcalldetails" === o) webphone_api.global.lastcalldetails = n; else if ("additional_info" === o) {
                if (n.toLowerCase().indexOf("error") >= 0) return void PutToDebugLog(2, "ERROR, HttpResponseHandler action: " + o + ", error: " + n);
                var R = n;
                R = ReplaceAll(R, "\r\n", "<br>"), R = ReplaceAll(R, "\n", "<br>"), isNull(document.getElementById("page_call_additional_info")) || (PutToDebugLog(4, "EVENT, HttpResponseHandler Display additional call info: " + R), document.getElementById("page_call_additional_info").innerHTML = R)
            } else if ("scurl_displaypeerdetails" === o) {
                if (n.toLowerCase().indexOf("error") >= 0) return void PutToDebugLog(2, "ERROR, HttpResponseHandler action: " + o + ", error: " + n);
                DisplayPeerDetails(n)
            } else if ("getconferenceroom" === o) ConferenceRoomReceived(n); else if ("webcontactsearch" === o) WebContactReceived(n); else if ("telsearchname" === o) TelSearchNameReceived(n); else if ("calldivertapi" === o) {
                var y = n.toLowerCase();
                if (y.indexOf("error") >= 0) return void PutToDebugLog(2, "ERROR, HttpResponseHandler action: " + o + ", error: " + n);
                if (y.indexOf("ok") >= 0) {
                    SaveParameter("calldivertsuccess", "1");
                    var L = GetParameter2("callforwardonbusy"), D = GetParameter2("callforwardonnoanswer"),
                        G = GetParameter2("callforwardalways"), O = GetParameter2("callforwardonnoanswertimeout"),
                        x = Md5Hash(L + D + G + O);
                    SaveParameter("calldivertchecksum", x)
                }
            } else if ("get_custom_menu" === o) {
                var y = n.toLowerCase();
                if (y.indexOf("error") >= 0) return void PutToDebugLog(2, "ERROR, HttpResponseHandler action: " + o + ", error: " + n);
                ProcessCustomMenu(n)
            }
        } catch (k) {
            PutToDebugLogException(2, "common: HttpResponseHandler", k)
        }
    }

    function WinAPI(e, o, t, n, i, a, r, s) {
        try {
            if (o && "function" == typeof o || (o = function (e) {
                isNull(e) || (e = e.toString(), e.indexOf("OK:") >= 0 && e.indexOf("wphone") > 0 && e.indexOf("started") > 0 && setTimeout(function () {
                    webphone_api.global.phonestarted < 2 && (webphone_api.global.phonestarted = 2)
                }, 2e3)), PutToDebugLog(2, "EVENT, common: WinAPI NO callback specified; result: " + e)
            }), isNull(e) || e.length < 1) return PutToDebugLog(2, "ERROR, common: WinAPI: apiname is NULL"), o(!1), !1;
            var l = "BOFCOMMAND";
            l = l + "BOFLINEfunction=" + e + "EOFLINE", !isNull(t) && t.toString().length > 0 && (t = Trim(t), l = l + "BOFLINEparam1=" + t + "EOFLINE"), !isNull(n) && n.toString().length > 0 && (n = Trim(n), l = l + "BOFLINEparam2=" + n + "EOFLINE"), !isNull(i) && i.toString().length > 0 && (i = Trim(i), l = l + "BOFLINEparam3=" + i + "EOFLINE"), !isNull(a) && a.toString().length > 0 && (a = Trim(a), l = l + "BOFLINEparam4=" + a + "EOFLINE"), !isNull(r) && r.toString().length > 0 && (r = Trim(r), l = l + "BOFLINEparam5=" + r + "EOFLINE"), !isNull(s) && s.toString().length > 0 && (s = Trim(s), l = l + "BOFLINEparam6=" + s + "EOFLINE"), l += "EOFCOMMAND";
            var p = "";
            webphone_api.global.httpkatimer = GetTickCount(), IsWindowsSoftphone() ? (p = AddJscommport(webphone_api.global.WIN_SOFTPHONE_URL) + p, PutToDebugLog(4, "EVENT, WinAPI windows url: " + p), WinSoftphoneHttpReq(p, "POST", "data=" + l, function (e) {
                return o(e), e
            })) : getuseengine() === webphone_api.global.ENGINE_SERVICE || !0 === webphone_api.global.onunload_flag ? WSAPIRequest("POST", "data=" + l, e, function (e) {
                return o(e), e
            }) : PutToDebugLog(2, "ERROR, common: winapi invalid engine/device: " + getuseengine() + "; apiname: " + e + "; data=" + l)
        } catch (c) {
            PutToDebugLogException(2, "common: WinAPI", c)
        }
    }

    function WinSoftphoneHttpReq(e, o, t, n) {
        var i = 0;
        try {
            var a = "";
            if (isNull(t) || (a = t.length > 300 ? t.substring(0, 300) + "...." : t), PutToDebugLog(2, "EVENT, WinSoftphoneHttpReq called " + o + " url: " + e + "; data: " + a), (isNull(o) || o.length < 1) && (i = 1, PutToDebugLog(2, "WARNING, common: WinSoftphoneHttpReq: method not specified; fallback to GET"), o = "GET"), i = 2, isNull(t)) return i = 3, PutToDebugLog(2, "ERROR, common: WinSoftphoneHttpReq: data is NULL "), cbexecuted = !0, n(null), "";
            i = 4, t.indexOf("API_CallEOFLINE"), i = 5, setTimeout(function () {
                if (i = 6, !isNull(n) && n && "function" == typeof n) return i = 7, PutToDebugLog(2, "ERROR, common: WinSoftphoneHttpReq: manual Timeout"), n(null), n = null, ""
            }, reqtimeout + 1e3);
            var r;
            window.XMLHttpRequest ? (i = 8, r = new XMLHttpRequest) : (i = 9, r = new ActiveXObject("Microsoft.XMLHTTP")), "get" === o.toLowerCase() ? (i = 10, r.open("GET", e + t, !0)) : (r.open("POST", e, !0), i = 11), r.onreadystatechange = function () {
                try {
                    if (PutToDebugLog(4, "EVENT, WinSoftphoneHttpReq: xmlhttp.readyState: " + r.readyState + ";  xmlhttp.status: " + r.status), i = 19, 4 == r.readyState && 200 == r.status) {
                        if (!1 === webphone_api.global.httpheaderslogged && r.getAllResponseHeaders) {
                            webphone_api.global.httpheaderslogged = !0;
                            PutToDebugLog(5, "EVENT, HTTP request answer headers 2: " + r.getAllResponseHeaders())
                        }
                        var e = r.responseText, o = "";
                        o = !isNull(e) && e.length > 250 ? e.substring(0, 250) + "...." : e, isNull(o) && (o = "NULL"), i = 20, PutToDebugLog(2, "EVENT, WinSoftphoneHttpReq response: " + o), cbexecuted = !0;
                        var t = "";
                        if (i = 21, isNull(e) || e.length < 1) return i = 23, isNull(n) ? PutToDebugLog(3, "EVENT, WinSoftphoneHttpReq inner_1 callback is null__1") : n(null), n = null, "";
                        if (!(e.indexOf("APIREQUEST:") >= 0)) return i = 42, isNull(n) ? PutToDebugLog(3, "EVENT, WinSoftphoneHttpReq inner_1 callback is null__3") : n(t), n = null, t;
                        i = 24;
                        var a = "", s = "";
                        if (e.indexOf("APIRESULT:") > 0 && (i = 25, e.indexOf("RPARAM1") > 0 ? (a = e.substring(e.indexOf("APIREQUEST:") + 11, e.indexOf("RPARAM1:")), e.indexOf("RPARAM2") > 0 ? (s = e.substring(e.indexOf("RPARAM1:") + 8, e.indexOf("RPARAM2")), e.substring(e.indexOf("RPARAM2:") + 8, e.indexOf("APIRESULT:"))) : s = e.substring(e.indexOf("RPARAM1:") + 8, e.indexOf("APIRESULT:")), t = e.substring(e.indexOf("APIRESULT:") + 10, e.length)) : (a = e.substring(e.indexOf("APIREQUEST:") + 11, e.indexOf("APIRESULT:")), t = e.substring(e.indexOf("APIRESULT:") + 10, e.length))), i = 28, isNull(a) ? a = "" : (a = Trim(a), a = a.toLowerCase()), t = isNull(t) ? "" : Trim(t), i = 29, 50 === GetConfigInt("brandid", -1) && (isNull(s) && (s = ""), s = s.toLowerCase(), s.indexOf("ww.favafone") > 0)) return s.indexOf("countries-list") > 0 ? HttpResponseHandler(t, "get_new_user_countrylist") : s.indexOf("registration-form") > 0 ? HttpResponseHandler(t, "get_new_user_form_fields") : s.indexOf("create-account") > 0 && HttpResponseHandler(t, "newuser_dynamic"), t;
                        if (isNull(n) && PutToDebugLog(3, "EVENT, WinSoftphoneHttpReq inner_1 callback is null__2"), i = 30, "api_poll" !== a) {
                            if (t.indexOf("ERROR") >= 0) {
                                if (i = 33, "api_call" === a) {
                                    var l = t.replace("ERROR", "");
                                    l = l.replace(":", ""), PutToDebugLog(1, "ERROR, " + l)
                                } else PutToDebugLog(2, "ERROR, " + t);
                                return i = 34, isNull(n) || n(null), n = null, ""
                            }
                            return "true" === t.toLowerCase() ? (isNull(n) || n(!0), n = null, !0) : "false" === t.toLowerCase() ? (isNull(n) || n(!1), n = null, !1) : IsNumber(t) ? (isNull(n) || n(StrToInt(t)), n = null, StrToInt(t)) : t.indexOf("OK") >= 0 && t.length < 12 ? (i = 37, isNull(n) || n(!0), n = null, !0) : (isNull(n) || n(t), n = null, t)
                        }
                        i = 31, webphonetojs(t), i = 32, i = 40, i = 48
                    }
                } catch (p) {
                    PutToDebugLogException(2, "common: WinSoftphoneHttpReq inner_1 (" + i + ")", p)
                }
            }, r.timeout = reqtimeout, r.ontimeout = function (e) {
                if (!isNull(n) && n && "function" == typeof n) return i = 49, PutToDebugLog(2, "ERROR, common: WinSoftphoneHttpReq: Timeout"), cbexecuted = !0, n(null), n = null, ""
            }, "get" === o.toLowerCase() ? (t.length > 0 && (t = "?" + t), i = 50, r.send()) : (i = 51, 50 === GetConfigInt("brandid", -1) && PutToDebugLog(2, "EVENT, WinSoftphoneHttpReq SEND post request with data: " + t), r.send(t))
        } catch (s) {
            PutToDebugLogException(2, "common: WinSoftphoneHttpReq (" + i + ")", s)
        }
    }

    function GetNotifications2() {
        try {
            if (!0 === nread) return;
            nread = !0;
            var e = GetParameter("notifications2");
            if (webphone_api.global.notifs = [], isNull(e) || e.length < 10) return;
            var o = e.split(not_linesep);
            if (isNull(o) || o.length < 1) return;
            for (var t = 0; t < o.length; t++) if (!(isNull(o[t]) || o[t].length < 1 || o[t].indexOf(",") < 0)) {
                var n = o[t].split(not_sep);
                isNull(n) || n.length < 4 || webphone_api.global.notifs.push(n)
            }
        } catch (i) {
            PutToDebugLogException(2, "common: GetNotifications2", i)
        }
    }

    function SaveNotifications2() {
        var e = "";
        try {
            if (!isNull(webphone_api.global.notifs) && webphone_api.global.notifs.length > 0) for (var o = 0; o < webphone_api.global.notifs.length; o++) if (!(isNull(webphone_api.global.notifs[o]) || webphone_api.global.notifs[o].length < 1)) {
                var t = webphone_api.global.notifs[o];
                isNull(t) || t.length < 4 || (e.length > 0 && (e += not_linesep), e = e + t[0] + not_sep + t[1] + not_sep + t[2] + not_sep + t[3])
            }
            SaveParameter("notifications2", e)
        } catch (n) {
            PutToDebugLogException(2, "common: SaveNotifications2", n)
        }
    }

    function PutNotifications2(e, o, t, n) {
        try {
            if (GetParameterInt("displaynotification", 0) < 1) return;
            if (isNull(e) || !IsNumber(e)) return void PutToDebugLog(4, "ERROR, common: PutNotifications2 invalid type");
            GetNotifications2(), isNull(o) && (o = ""), isNull(t) && (t = ""), (isNull(n) || !IsNumber(n) || n < 1e3) && (n = GetTickCount());
            var i = [];
            i[0] = e, i[1] = o, i[2] = t, i[3] = n.toString(), webphone_api.global.notifs.unshift(i), SaveNotifications2(), ShowNotifications2();
            var a = GetParameterInt("notification_count2", 0);
            a < 0 && (a = 0), a++, SaveParameter("notification_count2", a)
        } catch (r) {
            PutToDebugLogException(2, "common: PutNotifications2", r)
        }
    }

    function GetDateForNotifications(e) {
        try {
            if (isNull(e) || !IsNumber(e) || e < 1) return "";
            var o = new Date(e), t = o.getMinutes();
            t < 10 && (t = "0" + t);
            var n = o.getDate();
            n < 10 && (n = "0" + n);
            return month[o.getMonth()] + ", " + n + " " + o.getHours() + ":" + t
        } catch (i) {
            PutToDebugLogException(2, "common: GetDateForNotifications", i)
        }
        return ""
    }

    function ShowNotifications2() {
        try {
            if (GetNotifications2(), isNull(webphone_api.global.notifs) || webphone_api.global.notifs.length < 1) return void HideNotificationsElements();
            for (var e = "", o = "", t = "", n = "", i = '<li class="mlistitem"><a id="[PAGE]_notitem_[NOTID]" class="nt_anchor"><div class="nt_title">[TITLE]</div><div class="nt_desc">[DESC]</div><div class="nt_date">[DATE]</div></a><a id="[PAGE]_notmenu_[NOTID]" class="ui-btn ui-btn-inline ui-icon-delete nt_menu">' + webphone_api.stringres.get("hint_notif_clear") + "</a></li>", a = 0; a < webphone_api.global.notifs.length; a++) if (!(isNull(webphone_api.global.notifs[a]) || webphone_api.global.notifs[a].length < 1)) {
                var r = webphone_api.global.notifs[a], s = i;
                "0" === r[0] ? (s = s.replace("[TITLE]", webphone_api.stringres.get("not_missed_call") + ":"), s = s.replace("[DESC]", r[2])) : "1" === r[0] && (s = s.replace("[TITLE]", webphone_api.stringres.get("not_missed_chat") + ":"), s = s.replace("[DESC]", r[2]));
                var l = StrToInt(r[3]);
                isNull(l) && (l = 0);
                var p = GetDateForNotifications(l);
                s = s.replace("[DATE]", p), s = ReplaceAll(s, "[NOTID]", a.toString()), e += ReplaceAll(s, "[PAGE]", "dialpad"), o += ReplaceAll(s, "[PAGE]", "contactslist"), t += ReplaceAll(s, "[PAGE]", "callhistorylist"), n += ReplaceAll(s, "[PAGE]", "message")
            }
            var c = GetParameterInt("notification_count2", 0);
            e.length > 0 ? (webphone_api.$(".not_panel_title").html(webphone_api.stringres.get("not_panel_title")), webphone_api.$(".not_close_btn").html(webphone_api.stringres.get("btn_close")), webphone_api.$("#dialpad_notification_list").html(""), webphone_api.$("#dialpad_notification_list").hasClass("ui-listview") && webphone_api.$("#dialpad_notification_list").append(e).listview("refresh"), c > 0 ? (webphone_api.$("#dialpad_not_counter").html(c), webphone_api.$("#dialpad_not_counter").show()) : (webphone_api.$("#dialpad_not_counter").html(""), webphone_api.$("#dialpad_not_counter").hide()), webphone_api.$("#dialpad_not_btn").show(), webphone_api.$("#contactslist_notification_list").html(""), webphone_api.$("#contactslist_notification_list").hasClass("ui-listview") && webphone_api.$("#contactslist_notification_list").append(o).listview("refresh"), c > 0 ? (webphone_api.$("#contactslist_not_counter").html(c), webphone_api.$("#contactslist_not_counter").show()) : (webphone_api.$("#contactslist_not_counter").html(""), webphone_api.$("#contactslist_not_counter").hide()), webphone_api.$("#contactslist_not_btn").show(), webphone_api.$("#callhistorylist_notification_list").html(""), webphone_api.$("#callhistorylist_notification_list").hasClass("ui-listview") && webphone_api.$("#callhistorylist_notification_list").append(t).listview("refresh"), c > 0 ? (webphone_api.$("#callhistorylist_not_counter").html(c), webphone_api.$("#callhistorylist_not_counter").show()) : (webphone_api.$("#callhistorylist_not_counter").html(""), webphone_api.$("#callhistorylist_not_counter").hide()), webphone_api.$("#callhistorylist_not_btn").show(), webphone_api.$("#messagelist_notification_list").html(""), webphone_api.$("#messagelist_notification_list").hasClass("ui-listview") && webphone_api.$("#messagelist_notification_list").append(n).listview("refresh"), c > 0 ? (webphone_api.$("#messagelist_not_counter").html(c), webphone_api.$("#messagelist_not_counter").show()) : (webphone_api.$("#messagelist_not_counter").html(""), webphone_api.$("#messagelist_not_counter").hide()), webphone_api.$("#messagelist_not_btn").show()) : HideNotificationsElements()
        } catch (u) {
            PutToDebugLogException(2, "common: ShowNotifications2", u)
        }
    }

    function HideNotificationsElements() {
        webphone_api.$("#dialpad_notification_list").html(""), webphone_api.$("#dialpad_not_counter").html(""), webphone_api.$("#dialpad_not_counter").hide(), webphone_api.$("#dialpad_not_btn").hide(), webphone_api.$("#contactslist_notification_list").html(""), webphone_api.$("#contactslist_not_counter").html(""), webphone_api.$("#contactslist_not_counter").hide(), webphone_api.$("#contactslist_not_btn").hide(), webphone_api.$("#callhistorylist_notification_list").html(""), webphone_api.$("#callhistorylist_not_counter").html(""), webphone_api.$("#callhistorylist_not_counter").hide(), webphone_api.$("#callhistorylist_not_btn").hide(), webphone_api.$("#messagelist_notification_list").html(""), webphone_api.$("#messagelist_not_counter").html(""), webphone_api.$("#messagelist_not_counter").hide(), webphone_api.$("#messagelist_not_btn").hide()
    }

    function HideCallNotifications2() {
        try {
            if (!isNull(webphone_api.global.notifs) || webphone_api.global.notifs.length > 0) {
                for (var e = 0; e < webphone_api.global.notifs.length && webphone_api.global.notifs.length > 0;) {
                    var o = webphone_api.global.notifs[e];
                    !isNull(o) && o.length > 0 && "0" === o[0] ? webphone_api.global.notifs.splice(e, 1) : e++
                }
                SaveNotifications2()
            }
            ShowNotifications2()
        } catch (t) {
            PutToDebugLogException(2, "common: HideCallNotifications2", t)
        }
    }

    function HideMessageNotifications2() {
        try {
            if (!isNull(webphone_api.global.notifs) || webphone_api.global.notifs.length > 0) {
                for (var e = 0; e < webphone_api.global.notifs.length && webphone_api.global.notifs.length > 0;) {
                    var o = webphone_api.global.notifs[e];
                    !isNull(o) && o.length > 0 && "1" === o[0] ? webphone_api.global.notifs.splice(e, 1) : e++
                }
                SaveNotifications2()
            }
            ShowNotifications2()
        } catch (t) {
            PutToDebugLogException(2, "common: HideMessageNotifications2", t)
        }
    }

    function NotificationOnClick2(e, o) {
        try {
            if (isNull(e) || e.indexOf("notitem_") < 0 && e.indexOf("notmenu_") < 0) return void PutToDebugLog(4, "ERROR, common: NotificationOnClick2 invalid id: " + e);
            if (o) {
                if (e = e.substring(e.indexOf("notmenu_") + 8), isNull(e) || !IsNumber(e)) return;
                var t = StrToInt(e);
                if (t >= 0 && t < webphone_api.global.notifs.length) return webphone_api.global.notifs.splice(t, 1), void ShowNotifications2()
            } else {
                if (e = e.substring(e.indexOf("notitem_") + 8), isNull(e) || !IsNumber(e)) return;
                var t = StrToInt(e);
                if (t >= 0 && t < webphone_api.global.notifs.length) {
                    var n = webphone_api.global.notifs[t], i = n[0];
                    "0" === i ? webphone_api.$.mobile.changePage("#page_callhistorylist", {
                        transition: "none",
                        role: "page"
                    }) : "1" === i && webphone_api.$.mobile.changePage("#page_messagelist", {
                        transition: "none",
                        role: "page"
                    })
                }
            }
        } catch (a) {
            PutToDebugLogException(2, "common: NotificationOnClick2", a)
        }
    }

    function PutNotifications(e, o, t) {
        try {
            if (GetParameterInt("displaynotification", 0) < 1) return;
            if (isNull(t) && (t = !0), isNull(o)) return void PutToDebugLog(2, "ERROR, common: PutNotifications number is NULL");
            var n = GetParameter("call_notifications"), i = GetParameter("message_notifications");
            if (n = isNull(n) ? "" : Trim(n), i = isNull(i) ? "" : Trim(i), t) if (n.length > 2) if (IsNumber(n.charAt(0))) {
                var a = StrToInt(n.charAt(0));
                n = n.replace(a.toString(), (a + 1).toString())
            } else n = "2 " + webphone_api.stringres.get("calls"); else n = webphone_api.stringres.get("call_from") + ": " + e + ", " + o; else if (i.length > 2) if (IsNumber(i.charAt(0))) {
                var a = StrToInt(i.charAt(0));
                i = i.replace(a.toString(), (a + 1).toString())
            } else i = "2 " + webphone_api.stringres.get("messages"); else i = webphone_api.stringres.get("message_from") + ": " + e + ", " + o;
            SaveParameter("call_notifications", n), SaveParameter("message_notifications", i), ShowNotifications()
        } catch (r) {
            PutToDebugLogException(2, "common: PutNotifications", r)
        }
    }

    function ShowNotifications() {
        try {
            var e = GetParameter("call_notifications"), o = GetParameter("message_notifications"), t = "";
            !isNull(e) && e.length > 2 && (t = e + "<br>"), t += o, PutToDebugLog(2, "EVENT, ShowNotifications: " + t), webphone_api.$("#dialpad_notification").html(t), webphone_api.$("#contactslist_notification").html(t), webphone_api.$("#callhistorylist_notification").html(t), webphone_api.$("#messagelist_notification").html(t), !isNull(t) && t.length > 2 ? (webphone_api.$("#msglist_title").hide(), webphone_api.$("#messagelist_notification").show(), webphone_api.$("#ctlist_title").hide(), webphone_api.$("#contactslist_notification").show(), webphone_api.$("#chlist_title").hide(), webphone_api.$("#callhistorylist_notification").show(), webphone_api.$("#dialpad_title").hide(), webphone_api.$("#dialpad_notification").show()) : (webphone_api.$("#msglist_title").show(), webphone_api.$("#messagelist_notification").hide(), webphone_api.$("#ctlist_title").show(), webphone_api.$("#contactslist_notification").hide(), webphone_api.$("#chlist_title").show(), webphone_api.$("#callhistorylist_notification").hide(), webphone_api.$("#dialpad_title").show(), webphone_api.$("#dialpad_notification").hide())
        } catch (n) {
            PutToDebugLogException(2, "common: ShowNotifications", n)
        }
    }

    function HideCallNotifications() {
        try {
            SaveParameter("call_notifications", "");
            var e = GetParameter("message_notifications");
            webphone_api.$("#dialpad_notification").html(e), webphone_api.$("#contactslist_notification").html(e), webphone_api.$("#callhistorylist_notification").html(e), webphone_api.$("#messagelist_notification").html(e),
                !isNull(e) && e.length > 2 ? (webphone_api.$("#msglist_title").hide(), webphone_api.$("#messagelist_notification").show(), webphone_api.$("#ctlist_title").hide(), webphone_api.$("#contactslist_notification").show(), webphone_api.$("#chlist_title").hide(), webphone_api.$("#callhistorylist_notification").show(), webphone_api.$("#dialpad_title").hide(), webphone_api.$("#dialpad_notification").show()) : (webphone_api.$("#msglist_title").show(), webphone_api.$("#messagelist_notification").hide(), webphone_api.$("#ctlist_title").show(), webphone_api.$("#contactslist_notification").hide(), webphone_api.$("#chlist_title").show(), webphone_api.$("#callhistorylist_notification").hide(), webphone_api.$("#dialpad_title").show(), webphone_api.$("#dialpad_notification").hide())
        } catch (o) {
            PutToDebugLogException(2, "common: HideCallNotifications", o)
        }
    }

    function HideMessageNotifications() {
        try {
            SaveParameter("message_notifications", "");
            var e = GetParameter("call_notifications");
            webphone_api.$("#dialpad_notification").html(e), webphone_api.$("#contactslist_notification").html(e), webphone_api.$("#callhistorylist_notification").html(e), webphone_api.$("#messagelist_notification").html(e), !isNull(e) && e.length > 2 ? (webphone_api.$("#msglist_title").hide(), webphone_api.$("#messagelist_notification").show(), webphone_api.$("#ctlist_title").hide(), webphone_api.$("#contactslist_notification").show(), webphone_api.$("#chlist_title").hide(), webphone_api.$("#callhistorylist_notification").show(), webphone_api.$("#dialpad_title").hide(), webphone_api.$("#dialpad_notification").show()) : (webphone_api.$("#msglist_title").show(), webphone_api.$("#messagelist_notification").hide(), webphone_api.$("#ctlist_title").show(), webphone_api.$("#contactslist_notification").hide(), webphone_api.$("#chlist_title").show(), webphone_api.$("#callhistorylist_notification").hide(), webphone_api.$("#dialpad_title").show(), webphone_api.$("#dialpad_notification").hide())
        } catch (o) {
            PutToDebugLogException(2, "common: HideMessageNotifications", o)
        }
    }

    function HideAllNotifications() {
        try {
            SaveParameter("call_notifications", ""), SaveParameter("message_notifications", ""), webphone_api.$("#dialpad_notification").html(""), webphone_api.$("#contactslist_notification").html(""), webphone_api.$("#callhistorylist_notification").html(""), webphone_api.$("#messagelist_notification").html(""), webphone_api.$("#msglist_title").show(), webphone_api.$("#messagelist_notification").hide(), webphone_api.$("#ctlist_title").show(), webphone_api.$("#contactslist_notification").hide(), webphone_api.$("#chlist_title").show(), webphone_api.$("#callhistorylist_notification").hide(), webphone_api.$("#dialpad_title").show(), webphone_api.$("#dialpad_notification").hide()
        } catch (e) {
            PutToDebugLogException(2, "common: HideAllNotifications", e)
        }
    }

    function NotificationOnClick(e) {
        try {
            var o = GetParameter("call_notifications"), t = GetParameter("message_notifications");
            if (isNull(o) && (o = ""), isNull(t) && (t = ""), o.length < 2 && t.length < 2) return;
            if (o.length > 2 && t.length < 2) webphone_api.$.mobile.changePage("#page_callhistorylist", {
                transition: "none",
                role: "page"
            }); else if (o.length < 2 && t.length > 2) webphone_api.$.mobile.changePage("#page_messagelist", {
                transition: "none",
                role: "page"
            }); else {
                var n = GetDeviceWidth();
                n = !isNull(n) && IsNumber(n) && n > 100 ? Math.floor(n / 1.2) : 220;
                var i = "", a = '<li id="[ITEMID]"><a data-rel="back">[ITEMTITLE]</a></li>', r = "";
                r = a.replace("[ITEMID]", "#item_call_history"), r = r.replace("[ITEMTITLE]", webphone_api.stringres.get("callhistory")), i += r, r = "", r = a.replace("[ITEMID]", "#item_message_history"), r = r.replace("[ITEMTITLE]", webphone_api.stringres.get("messagehistory")), i += r, r = "";
                var s = '<div id="notification_popup" data-role="popup" class="ui-content messagePopup" data-overlay-theme="a" data-theme="a" style="max-width:' + n + "px; min-width: " + Math.floor(.6 * n) + 'px;"><div data-role="header" data-theme="b"><a href="javascript:;" data-role="button" data-icon="delete" data-iconpos="notext" class="ui-btn-right closePopup">Close</a><h1 class="adialog_title">' + webphone_api.stringres.get("goto") + '</h1></div><div role="main" class="ui-content adialog_content" style="padding: 0; margin: 0;"><ul id="notifications_ul" data-role="listview" data-inset="true" data-icon="false" style="margin: 0;">' + i + '</ul></div><div data-role="footer" data-theme="b" class="adialog_footer"><a href="javascript:;" style="width: 98%;" class="ui-btn ui-corner-all ui-shadow ui-btn-inline ui-btn-b adialog_2button" data-rel="back" data-transition="flow">' + webphone_api.stringres.get("btn_close") + "</a></div></div>";
                e = e || function () {
                }, webphone_api.$.mobile.activePage.append(s).trigger("create"), webphone_api.$.mobile.activePage.find(".closePopup").bind("tap", function (e) {
                    webphone_api.$.mobile.activePage.find(".messagePopup").popup("close")
                }), webphone_api.$.mobile.activePage.find(".messagePopup").popup().popup("open").bind({
                    popupafterclose: function () {
                        webphone_api.$(this).unbind("popupafterclose").remove(), webphone_api.$("#notifications_ul").off("click", "li"), e()
                    }
                }), webphone_api.$("#notifications_ul").on("click", "li", function (e) {
                    var o = webphone_api.$(this).attr("id");
                    webphone_api.$("#notification_popup").on("popupafterclose", function (e) {
                        webphone_api.$("#notification_popup").off("popupafterclose"), "#item_call_history" === o ? webphone_api.$.mobile.changePage("#page_callhistorylist", {
                            transition: "none",
                            role: "page"
                        }) : "#item_message_history" === o && webphone_api.$.mobile.changePage("#page_messagelist", {
                            transition: "none",
                            role: "page"
                        })
                    })
                })
            }
        } catch (l) {
            PutToDebugLogException(2, "common: NotificationOnClick", l)
        }
    }

    function RestartPhone() {
        try {
            OpenSettings(!0, 2), webphone_api.global.flagWaitforautoprov = !1, webphone_api.$.mobile.changePage("#page_dialpad", {
                transition: "pop",
                role: "page"
            }), webphone_api.startInner()
        } catch (e) {
            PutToDebugLogException(2, "common: RestartPhone", e)
        }
    }

    function ApiWinSaveFile(e, o, t) {
        try {
            if (!t || "function" != typeof t) return PutToDebugLog(2, "ERROR, common: ApiWinSaveFile callback not defined"), !1;
            if (isNull(e) || e.length < 1) return PutToDebugLog(2, "ERROR, common: ApiWinSaveFile: filename is NULL"), t(!1), !1;
            if (isNull(o)) return PutToDebugLog(2, "ERROR, common: ApiWinSaveFile: content is NULL"), t(!1), !1;
            o = "BOFFILE" + o + "EOFFILE", e = Trim(e);
            WinSoftphoneHttpReq(AddJscommport(webphone_api.global.WIN_SOFTPHONE_URL) + "?extcmd_savedata=" + e, "POST", "data=" + o, function (e) {
                return t(e), e
            })
        } catch (n) {
            PutToDebugLogException(2, "common: ApiWinSaveFile", n)
        }
    }

    function ApiWinLoadFile(e, o) {
        try {
            if (!o || "function" != typeof o) return PutToDebugLog(2, "ERROR, common: ApiWinLoadFile callback not defined"), !1;
            if (isNull(e) || e.length < 1) return PutToDebugLog(2, "ERROR, common: ApiWinLoadFile: filename is NULL"), o(null), !1;
            e = Trim(e);
            WinSoftphoneHttpReq(AddJscommport(webphone_api.global.WIN_SOFTPHONE_URL) + "?extcmd_loaddata=" + e, "GET", "", function (e) {
                return isNull(e) || (e = StrDc(e, webphone_api.global.ec_apikey)), o(e), e
            })
        } catch (t) {
            PutToDebugLogException(2, "common: ApiWinLoadFile", t)
        }
    }

    function ApiWinSaveFileNew(e, o, t, n) {
        try {
            if (!t || "function" != typeof t) return PutToDebugLog(2, "ERROR, common: ApiWinSaveFileNew callback not defined"), !1;
            var i = document.getElementById("EXTERNREQUESTELEM");
            if (isNull(i)) return PutToDebugLog(2, "ERROR, common: ApiWinSaveFileNew: html element: EXTERNREQUESTELEM is NULL"), t(!1), !1;
            if (isNull(e) || e.length < 1) return PutToDebugLog(2, "ERROR, common: ApiWinSaveFileNew: filename is NULL"), t(!1), !1;
            if (isNull(o)) return PutToDebugLog(2, "ERROR, common: ApiWinSaveFileNew: content is NULL"), t(!1), !1;
            o = "BOFFILE" + o + "EOFFILEEOFCOMMAND", e = Trim(e);
            var a = "";
            a = !isNull(n) && n.length > 0 ? n : "extcmd_savedata=" + e, webphone_api.global.bwanswerINCNUMBER++, a = a + "&now=" + webphone_api.global.bwanswerINCNUMBER.toString() + "\r\n", PutToDebugLog(2, "EVENT, common: ApiWinSaveFileNew cmd: " + a);
            var r = a + encodeURIComponent(o);
            return PutToDebugLog(2, "EVENT, common: ApiWinSaveFileNew encoded: " + r), i.innerHTML = r, t(!0), !0
        } catch (s) {
            PutToDebugLogException(2, "common: ApiWinSaveFileNew", s)
        }
    }

    function bwanswer(e) {
        try {
            if (PutToDebugLog(2, "ERROR, bwanswer called; answer: " + e), webphone_api.global.bwanswercallback && "function" == typeof webphone_api.global.bwanswercallback) if (isNull(e) || e.length < 1 || e.indexOf("ERROR") >= 0) webphone_api.global.bwanswercallback(null), webphone_api.global.bwanswercallback = null; else if (e.length > 100 || tempfile.length > 10) {
                if (tempfile = tempfile = e, tempfile.indexOf("EOFFILE")) {
                    var o = decodeURIComponent(tempfile);
                    webphone_api.global.bwanswercallback(o), webphone_api.global.bwanswercallback = null
                }
            } else {
                var o = decodeURIComponent(e);
                webphone_api.global.bwanswercallback(o), webphone_api.global.bwanswercallback = null
            } else PutToDebugLog(2, "ERROR, bwanswer: bwanswercallback is NULL")
        } catch (t) {
            PutToDebugLogException(2, "common: bwanswer", t)
        }
    }

    function ApiWinLoadFileNew(e, o) {
        try {
            if (!o || "function" != typeof o) return PutToDebugLog(2, "ERROR, common: ApiWinLoadFileNew callback not defined"), !1;
            var t = document.getElementById("EXTERNREQUESTELEM");
            if (isNull(t)) return PutToDebugLog(2, "ERROR, common: ApiWinLoadFileNew: html element: EXTERNREQUESTELEM is NULL"), o(!1), !1;
            if (isNull(e) || e.length < 1) return PutToDebugLog(2, "ERROR, common: ApiWinLoadFileNew: filename is NULL"), o(null), !1;
            e = Trim(e), webphone_api.global.bwanswerINCNUMBER++;
            var n = "extcmd_loaddata=" + e + "&now=" + webphone_api.global.bwanswerINCNUMBER.toString() + "\r\n";
            PutToDebugLog(2, "EVENT, common: ApiWinLoadFileNew cmd: " + n + "EOFCOMMAND"), webphone_api.global.bwanswercallback = o, t.innerHTML = n + "EOFCOMMAND", PutToDebugLog(2, "EVENT, common: ApiWinLoadFileNew  element.innerHTML: " + t.innerHTML)
        } catch (i) {
            PutToDebugLogException(2, "common: ApiWinLoadFileNew", i)
        }
    }

    function Exit() {
        WinSoftphoneHttpReq(AddJscommport(webphone_api.global.WIN_SOFTPHONE_URL) + "?extcmd_exit=true", "GET", "", function (e) {
            PutToDebugLog(2, "EVENT, common: Exit response: " + e)
        })
    }

    function CallNumberProtocolHandler(e, o) {
        try {
            if (isNull(e) || e.length < 2 || e.length > 10) return void PutToDebugLog(2, "ERROR, CallNumberProtocolHandler invalid protocol: " + e);
            if (isNull(o) || o.length < 1) return void PutToDebugLog(2, "ERROR, CallNumberProtocolHandler invalid number: " + o);
            var t = e + "://" + encodeURIComponent(o),
                n = '<a href="' + t + '" id="make_native_call" style="display: none;">call</a>';
            webphone_api.$("body").append(n), webphone_api.$("#make_native_call").on("click", function () {
                var e = webphone_api.$("#make_native_call").attr("href");
                webphone_api.$("#make_native_call").remove(), window.location = e
            }), webphone_api.$("#make_native_call").click(), ShowToast(webphone_api.stringres.get("native_call"))
        } catch (i) {
            PutToDebugLogException(2, "common: CallNumberProtocolHandler", i)
        }
    }

    function EnterKeyPress() {
        try {
            return "page_dialpad" === webphone_api.$.mobile.activePage.attr("id") ? webphone_api.$("#btn_call").click() : "page_settings" === webphone_api.$.mobile.activePage.attr("id") && webphone_api.$("#adialog_positive").click(), !0
        } catch (e) {
            PutToDebugLogException(2, "common: EnterKeyPress", e)
        }
        return !1
    }

    function GetNrOfAcc() {
        try {
            if (!isNull(webphone_api.global.sipaccounts)) return webphone_api.global.sipaccounts.length
        } catch (e) {
            PutToDebugLogException(2, "common: GetNrOfAcc", e)
        }
        return 1
    }

    function SaveAccountsFile(e) {
        try {
            if (webphone_api.global.flag_delsett > 1 || !0 === GetParameterBool("resetsettings", !1)) return void PutToDebugLog(2, "EVENT, SaveAccountsFile DO NOT SAVE, flag delsett is: " + webphone_api.global.flag_delsett.toString() + "; resetsettings is: " + GetParameterBool("resetsettings", !1));
            if (!e || "function" != typeof e) return void PutToDebugLog(2, "ERROR, common: SaveAccountsFile callback not defined");
            var o = GetAccountsFilename();
            if (isNull(webphone_api.global.aclist)) return PutToDebugLog(2, "EVENT, SaveAccountsFile no accounts to be saved"), e(!1), !1;
            if (isNull(webphone_api.File)) return PutToDebugLog(2, "EVENT, SaveAccountsFile File handling module not loaded yet"), e(!1), !1;
            for (var t = "", n = null, i = 0; i < webphone_api.global.aclist.length; i++) n = webphone_api.global.aclist[i], isNull(n) || (t.length > 2 && (t += "\r\n"), t = t + n[AC_NAME] + "," + n[AC_SIPUSERNAME] + "," + n[AC_SETTFILE] + "," + n[AC_CHFILE] + "," + n[AC_ISACTIVE]);
            PutToDebugLog(2, "EVENT, acfile = " + t), IsWindowsSoftphone() && (ApiWinSaveFile(o, t, function (o) {
                e(!0)
            }), webphone_api.File.SaveFile(o, t, webphone_api.global.STORAGE_COOKIE, function (e) {
                PutToDebugLog(2, "EVENT, SaveAccountsFile saved in cookie")
            })), webphone_api.File.SaveFile(o, t, webphone_api.global.STORAGE_LOCAL, function (o) {
                e(o)
            })
        } catch (a) {
            PutToDebugLogException(2, "common: SaveAccountsFile", a)
        }
    }

    function ReadAccountsFile(e) {
        try {
            if (!e || "function" != typeof e) return void PutToDebugLog(2, "ERROR, common: ReadAccountsFile callback not defined");
            var o = GetAccountsFilename();
            if (isNull(webphone_api.File)) return PutToDebugLog(2, "ERROR, ReadAccountsFile File handling module not loaded yet"), e(!1), !1;
            IsWindowsSoftphone() ? ApiWinLoadFile(o, function (t) {
                isNull(t) || Trim(t).length < 1 ? (PutToDebugLog(2, "WARNING, common: ReadAccountsFile no content WinApi"), webphone_api.File.ReadFile(o, webphone_api.global.STORAGE_COOKIE, function (o) {
                    if (isNull(o) || Trim(o).length < 1) {
                        var t = [], n = "Account" + GetSipusername(),
                            i = Md5Hash(n + GetParameter("serveraddress_user") + GetSipusername() + webphone_api.global.SALT + GetParameter("password") + GetLocationPathName());
                        t[AC_NAME] = n, t[AC_SIPUSERNAME] = GetSipusername(), t[AC_SETTFILE] = i, t[AC_CHFILE] = i + "_ch", t[AC_ISACTIVE] = "true", webphone_api.global.aclist.push(t), PutToDebugLog(3, "EEVENT, common ReadAccountsFile(2) save new account file"), SaveAccountsFile(function (e) {
                            e ? PutToDebugLog(3, "EVENT, common ReadAccountsFile(2) saved successfully") : PutToDebugLog(3, "EVENT, common ReadAccountsFile(2) failed to saved")
                        }), o = n + "," + GetSipusername() + "," + i + "," + i + "_ch,true"
                    }
                    ParseAccountsReadFromFile(o, e)
                })) : ParseAccountsReadFromFile(t, e)
            }) : webphone_api.File.ReadFile(o, webphone_api.global.STORAGE_LOCAL, function (o) {
                if (isNull(o) || Trim(o).length < 1) {
                    var t = [], n = GetSipusername(), i = "Account" + n,
                        a = Md5Hash(i + GetParameter("serveraddress_user") + n + webphone_api.global.SALT + GetParameter("password") + GetLocationPathName());
                    t[AC_NAME] = i, t[AC_SIPUSERNAME] = n, t[AC_SETTFILE] = a, t[AC_CHFILE] = a + "_ch", t[AC_ISACTIVE] = "true", webphone_api.global.aclist.push(t), PutToDebugLog(3, "EVENT, common ReadAccountsFile(3) save new account file"), SaveAccountsFile(function (e) {
                        e ? PutToDebugLog(3, "EVENT, common ReadAccountsFile(3) saved successfully") : PutToDebugLog(3, "EVENT, common ReadAccountsFile(3) failed to saved")
                    }), o = i + "," + n + "," + a + "," + a + "_ch,true"
                }
                ParseAccountsReadFromFile(o, e)
            })
        } catch (t) {
            PutToDebugLogException(2, "common: ReadAccountsFile", t)
        }
    }

    function ParseAccountsReadFromFile(e, o) {
        try {
            var t = e.split("\r\n");
            if (isNull(t) || t.length < 1) return PutToDebugLog(2, "ERROR, common: ParseAccountsReadFromFile empty content"), o(!1), !1;
            if (!isNull(webphone_api.global.aclist)) for (var n in webphone_api.global.aclist) delete webphone_api.global.aclist[n];
            for (var i = !0, a = 0; a < t.length; a++) if (isNull(t[a]) || t[a].length < 2 || t[a].indexOf(",") < 0 || t[a].indexOf("true") < 0 && t[a].indexOf("false") < 0) PutToDebugLog(2, "WARNING, common ParseAccountsReadFromFile broken or invalid account (1): " + t[a]); else {
                i = !1;
                var r = t[a].split(",");
                webphone_api.global.aclist.push(r)
            }
            return i && (PutToDebugLog(3, "ERROR, common ParseAccountsReadFromFile accounts is corrupt"), webphone_api.File.DeleteAllCookies(), webphone_api.File.DeleteFile(GetAccountsFilename(), function (e) {
                PutToDebugLog(2, "EVENT, delsettings accounts result: " + e);
                var o = [], t = "Account" + GetSipusername(),
                    n = Md5Hash(t + GetParameter("serveraddress_user") + GetSipusername() + webphone_api.global.SALT + GetParameter("password") + GetLocationPathName());
                o[AC_NAME] = t, o[AC_SIPUSERNAME] = GetSipusername(), o[AC_SETTFILE] = n, o[AC_CHFILE] = n + "_ch", o[AC_ISACTIVE] = "true", webphone_api.global.aclist.push(o), PutToDebugLog(3, "EEVENT, common ParseAccountsReadFromFile save new account file"), SaveAccountsFile(function (e) {
                    e ? PutToDebugLog(3, "EVENT, common ParseAccountsReadFromFile Accounts file saved successfully") : PutToDebugLog(2, "ERROR, common ParseAccountsReadFromFile Accounts file save failed")
                })
            })), o(!0), !0
        } catch (s) {
            PutToDebugLogException(2, "common: ParseAccountsReadFromFile", s)
        }
    }

    function GetActiveAccount() {
        try {
            if (isNull(webphone_api.global.aclist) || webphone_api.global.aclist.length < 1) return PutToDebugLog(2, "WARNING, common GetActiveAccount no available accounts"), null;
            for (var e = 0; e < webphone_api.global.aclist.length; e++) if (!(isNull(webphone_api.global.aclist[e]) || webphone_api.global.aclist[e].length < 2)) {
                var o = webphone_api.global.aclist[e];
                if ("true" === o[AC_ISACTIVE]) return o
            }
        } catch (t) {
            PutToDebugLogException(2, "common: GetActiveAccount", t)
        }
        return null
    }

    function GetActiveAccSettingsFilename() {
        try {
            var e = GetActiveAccount();
            return isNull(e) || e.length < 2 ? (PutToDebugLog(2, "EVENT, common GetActiveAccSettingsFilename cant get filename, probably doesn't exist"), "") : isNull(e[AC_SETTFILE]) || e[AC_SETTFILE].length < 1 ? (PutToDebugLog(2, "ERROR, common GetActiveAccSettingsFilename no filename"), "") : e[AC_SETTFILE]
        } catch (o) {
            PutToDebugLogException(2, "common: GetActiveAccount", o)
        }
        return ""
    }

    function GetActiveAccCallhistoryFilename() {
        try {
            var e = GetActiveAccSettingsFilename();
            return isNull(e) || e.length < 1 ? "" : e + "_ch"
        } catch (o) {
            PutToDebugLogException(2, "common: GetActiveAccCallhistoryFilename", o)
        }
        return ""
    }

    function GetActiveAccUsername() {
        try {
            var e = GetActiveAccount();
            return isNull(e) || e.length < 2 ? (PutToDebugLog(2, "EVENT, common GetActiveAccUsername cant get active account"), "") : isNull(e[AC_SIPUSERNAME]) || e[AC_SIPUSERNAME].length < 1 ? GetSipusername() : e[AC_SIPUSERNAME]
        } catch (o) {
            PutToDebugLogException(2, "common: GetActiveAccUsername", o)
        }
        return ""
    }

    function GetAccountsFilename() {
        try {
            if (!isNull(sessionaccfilename) && sessionaccfilename.length > 0) return sessionaccfilename;
            var e = GetConfig("brandid");
            return (isNull(e) || e.length < 1 || "-1" == e) && (e = GetBrandName().toLowerCase()), sessionaccfilename = webphone_api.global.ACCOUNTS_FILENAME + "_" + Md5Hash(GetLocationPathName() + e)
        } catch (o) {
            PutToDebugLogException(2, "common: GetAccountsFilename", o)
        }
        return ""
    }

    function GetLocationPathName() {
        try {
            if ("false" == GetConfig("usepathinfilenames")) return "";
            if (!isNull(lpname) && lpname.length > 0) return lpname;
            var e = GetProfile();
            isNull(e) && (e = "");
            var o = location.href;
            isNull(o) && (o = ""), o = Trim(o), o = o.toLowerCase();
            var t = o.indexOf("file:");
            if (t >= 0 && t < 5) {
                t = o.indexOf("?"), t > 0 && (o = o.substring(0, t)), t = o.indexOf("#"), t > 0 && (o = o.substring(0, t));
                var n = "";
                t = o.lastIndexOf("/"), t > 0 && (n = o.substring(t + 1), o = o.substring(0, t), (isNull(n) || n.indexOf(".") > 0) && (n = "")), lpname = o + n, isNull(lpname) && (lpname = ""), lpname = ReplaceAll(lpname, "/", ""), e.length > 0 && (lpname = lpname + "_" + e), PutToDebugLog(2, "EVENT, LPname local and profile: " + lpname)
            } else if (e.length > 0) {
                var i = location.hostname;
                isNull(i) && (i = ""), lpname = i + "_" + e, PutToDebugLog(2, "EVENT, LPname and profile: " + lpname)
            } else {
                var a = location.pathname;
                if (!isNull(a) && a.length > 0 && !isNull(location.protocol) && ("http:" === location.protocol.toLowerCase() || "https:" === location.protocol.toLowerCase())) {
                    a = Trim(a);
                    var t = a.indexOf("/");
                    if (0 === t && (a = a.substring(1)), (t = a.lastIndexOf("/")) > 0) {
                        var r = a.substring(t);
                        !isNull(r) && r.indexOf(".") > 0 && (a = a.substring(0, t))
                    }
                    t = a.lastIndexOf("?"), t > 0 && (a = a.substring(0, t)), t = a.lastIndexOf("#"), t > 0 && (a = a.substring(0, t)), a = ReplaceAll(a, "/", ""), !isNull(a) && a.length > 0 && (lpname = Trim(a)), PutToDebugLog(2, "EVENT, LPname: " + lpname)
                }
            }
            return lpname
        } catch (s) {
            PutToDebugLogException(2, "common: GetLocationPathName", s)
        }
        return ""
    }

    function GetProfile() {
        try {
            if (!isNull(currprofile)) return currprofile;
            currprofile = "";
            var e = window.location.href;
            e = decodeURIComponent(e), e = e.toLowerCase();
            var o = e.indexOf("profile=");
            o > 0 && (e = e.substring(o + 8), o = e.indexOf("&"), o > 0 && (e = e.substring(0, o)), o = e.indexOf("#"), o > 0 && (e = e.substring(0, o)), e = Trim(e), currprofile = e), currprofile.length < 1 && !isNull(webphone_api.parameters) && !isNull(webphone_api.parameters.profile) && webphone_api.parameters.profile.length > 0 && (currprofile = webphone_api.parameters.profile), currprofile.length < 1 && !isNull(GetConfig("profile")) && GetConfig("profile").length > 0 && (currprofile = GetConfig("profile"))
        } catch (t) {
            PutToDebugLogException(2, "common: GetProfile", t)
        }
        return currprofile
    }

    function GetSettFilenameSDK() {
        try {
            var e = Md5Hash("sdksettfilename" + GetLocationPathName()), o = GetConfig("brandid");
            return (isNull(o) || o.length < 1 || "-1" == o) && (o = GetBrandName().toLowerCase()), e += o
        } catch (t) {
            PutToDebugLogException(2, "common: GetSettFilenameSDK", t)
        }
        return ""
    }

    function Encrypt(e, o) {
        try {
            if (isNull(o) || o.length < 1 || isNull(e)) return PutToDebugLog(2, "ERROR, file: common no key or value"), null;
            for (var t = "", n = 0; n < o.length; n++) t += o.charCodeAt(n).toString();
            var i = Math.floor(t.length / 5),
                a = parseInt(t.charAt(i) + t.charAt(2 * i) + t.charAt(3 * i) + t.charAt(4 * i) + t.charAt(5 * i)),
                r = Math.ceil(o.length / 2), s = Math.pow(2, 31) - 1;
            if (a < 2) return PutToDebugLog(2, "ERROR, Algorithm cannot find a suitable hash. Please choose a different key. \nPossible considerations are to choose a more complex or longer key."), null;
            var l = Math.round(1e9 * Math.random()) % 1e8;
            for (t += l; t.length > 10;) t = (parseInt(t.substring(0, 10)) + parseInt(t.substring(10, t.length))).toString();
            t = (a * t + r) % s;
            for (var p = "", c = "", n = 0; n < e.length; n++) p = parseInt(e.charCodeAt(n) ^ Math.floor(t / s * 255)), c += p < 16 ? "0" + p.toString(16) : p.toString(16), t = (a * t + r) % s;
            for (l = l.toString(16); l.length < 8;) l = "0" + l;
            return c += l
        } catch (u) {
            PutToDebugLogException(2, "common: Encrypt", u)
        }
        return null
    }

    function Decrypt(e, o) {
        try {
            if (isNull(e) || e.length < 8) return PutToDebugLog(2, "ERROR, A salt value could not be extracted from the encrypted message because it's length is too short. The message cannot be decrypted."), null;
            if (isNull(o) || o.length < 1) return PutToDebugLog(2, "ERROR, Please enter a key with which to decrypt the message."), null;
            var t = "", n = e.indexOf("almakorte_2_");
            n >= 0 && (e = e.substring(n + 12));
            for (var i = 0; i < o.length; i++) t += o.charCodeAt(i).toString();
            var a = Math.floor(t.length / 5),
                r = parseInt(t.charAt(a) + t.charAt(2 * a) + t.charAt(3 * a) + t.charAt(4 * a) + t.charAt(5 * a)),
                s = Math.round(o.length / 2), l = Math.pow(2, 31) - 1,
                p = parseInt(e.substring(e.length - 8, e.length), 16);
            for (e = e.substring(0, e.length - 8), t += p; t.length > 10;) t = (parseInt(t.substring(0, 10)) + parseInt(t.substring(10, t.length))).toString();
            t = (r * t + s) % l;
            for (var c = "", u = "", i = 0; i < e.length; i += 2) c = parseInt(parseInt(e.substring(i, i + 2), 16) ^ Math.floor(t / l * 255)), u += String.fromCharCode(c), t = (r * t + s) % l;
            return u
        } catch (h) {
            PutToDebugLogException(2, "common: Decrypt", h)
        }
        return null
    }

    function B64Enc(e) {
        try {
            if (isNull(e)) return PutToDebugLog(2, "ERROR, B6 value could not be extracted"), null;
            if (e.length < 1) return "";
            var o = e;
            return o = Base64.encode(o), o = ReplaceAll(o, "=", "-"), o = ReplaceAll(o, "+", "_"), o = ReplaceAll(o, "/", ".")
        } catch (t) {
            PutToDebugLogException(2, "common: B64Enc", t)
        }
        return e
    }

    function B64Dec(e) {
        try {
            if (isNull(e)) return "";
            if (e.indexOf("_BASE64_") < 0) return e;
            var o = e.replace("_BASE64_", "");
            return o = ReplaceAll(o, "-", "="), o = ReplaceAll(o, "_", "+"), o = ReplaceAll(o, ".", "/"), o = Base64.decode(o)
        } catch (t) {
            PutToDebugLogException(2, "common: B64Dec", t)
        }
        return e
    }

    function StrEc(e, o, t) {
        var n = "";
        try {
            if (isNull(e)) return PutToDebugLog(2, "ERROR, A salt value could not be extracted(2)"), null;
            if (e.length < 1) return "";
            if (isNull(o) || o.length < 1) return PutToDebugLog(2, "ERROR, Please enter a correct key(2)"), null;
            for (var i = 0, a = o.length, r = 0, s = 0; s < e.length; s++) {
                r = e.charCodeAt(s) ^ o.charCodeAt(i), !0 === t && (r %= 128) < 0 && (r = 95);
                n += String.fromCharCode(r), i < a - 1 ? i++ : i = 0
            }
            return n = Base64.encode(n), n = ReplaceAll(n, "=", "-"), n = ReplaceAll(n, "+", "_"), n = ReplaceAll(n, "/", ".")
        } catch (l) {
            PutToDebugLogException(2, "common: StrEc", l)
        }
        return null
    }

    function StrDc(e, o, t) {
        var n = "";
        try {
            if (isNull(e)) return PutToDebugLog(2, "ERROR, A salt value could not be extracted(3)"), null;
            if (e.lenght < 1) return e;
            if (isNull(o) || o.length < 1) return PutToDebugLog(2, "ERROR, Please enter a correct key(3)"), e;
            if (e = e.toString(), e = Trim(e), 0 !== e.indexOf("encrypted") && 0 !== e.indexOf("oenc1_") && 0 !== e.indexOf("alenc1_") && 0 !== e.indexOf("dcid_") && 0 !== e.indexOf("wetrt_") && 0 !== e.indexOf("mcrfs_")) return e;
            if (e = e.replace("oenc1_", ""), e = e.replace("alenc1_", ""), e = e.replace("dcid_", ""), e = e.replace("wetrt_", ""), e = e.replace("encrypted__3__", ""), e = e.replace("encrypted__16__", ""), e = e.replace("mcrfs_", ""), e.indexOf("encrypted__4") >= 0) return e = e.replace("encrypted__4__", ""), e = Base64.decode(e);
            var i = e.indexOf("__");
            i > 0 && (e = e.substring(i + 2));
            i = e.indexOf("__"), i >= 0 && (e.substring(0, i), e = e.substring(i + 2)), e = ReplaceAll(e, "-", "="), e = ReplaceAll(e, "_", "+"), e = ReplaceAll(e, ".", "/"), e = Base64.decode(e);
            for (var a = 0, r = o.length, s = 0, l = 0; l < e.length; l++) {
                s = e.charCodeAt(l) ^ o.charCodeAt(a), !0 === t && (s %= 128) < 0 && (s = 95);
                n += String.fromCharCode(s), a < r - 1 ? a++ : a = 0
            }
            return n
        } catch (p) {
            PutToDebugLogException(2, "common: StrDc", p)
        }
        return null
    }

    function delsettings(e) {
        try {
            if (isNull(e) || e < 1) return void PutToDebugLog(4, "WARNING, delsettings invalid level parameter");
            if (PutToDebugLog(2, "EVENT, common delsettings called, level: " + e.toString()), e > 2 && (e = 2), webphone_api.global.flag_delsett = e, webphone_api.global.resetsett_handled = !0, 2 === e) {
                webphone_api.File.DeleteFile(GetActiveAccCallhistoryFilename(), function (e) {
                    PutToDebugLog(2, "EVENT, delete call history file: " + GetActiveAccCallhistoryFilename() + " result: " + e)
                }), webphone_api.global.chlist = [], webphone_api.global.recentlist = [];
                var o = GetParameter("messagefiles");
                if (!isNull(o)) {
                    for (var t = o.split(","), n = 0; n < t.length; n++) if (!(isNull(t[n]) || t[n].length < 3)) {
                        var i = t[n].indexOf("[#");
                        i > 0 && (t[n] = t[n].substring(0, i)), webphone_api.File.DeleteFile(t[n], function (e) {
                            PutToDebugLog(3, "EVENT, delsettings DeleteFile: " + t[n] + " status: " + e.toString())
                        })
                    }
                    SaveParameter("messagefiles", "")
                }
                var a = GetConfig("brandid");
                (isNull(a) || a.length < 1 || "-1" == a) && (a = GetBrandName().toLowerCase()), webphone_api.File.DeleteFile(GetAccountsFilename(), function (e) {
                    PutToDebugLog(2, "EVENT, delete accounts file result: " + e)
                }), webphone_api.global.aclist = [], webphone_api.File.DeleteFile(webphone_api.global.CONTACTS_FILENAME + a, function (e) {
                    PutToDebugLog(2, "EVENT, delete contacts file result: " + e)
                }), webphone_api.global.ctlist = []
            }
            webphone_api.File.DeleteAllCookies(), webphone_api.File.DeleteFile(GetActiveAccSettingsFilename(), function (e) {
                PutToDebugLog(2, "EVENT, delete settings file: " + GetActiveAccSettingsFilename() + " result: " + e)
            }), webphone_api.global.settmap = {}, HandleSettings("", "", function () {
            }), setTimeout(function () {
                webphone_api.global.flag_delsett = 0, PutToDebugLog(2, "EVENT, delete settings flag delsett is reset to: 0")
            }, 250), OpenSettings(!0, 3)
        } catch (r) {
            PutToDebugLogException(2, "common: delsettings", r)
        }
    }

    function HideClearPassword(e) {
        var o = e, t = "";
        try {
            if (isNull(e)) return PutToDebugLog(2, "WARNING, common: HideClearPassword textin is NULL"), "";
            var n = o.indexOf("password");
            if (n > 0) return t = o.substring(0, n) + "password: *****", o = o.substring(n, o.length), n = o.indexOf("\r\n"), n < 0 && (n = ("password " + GetParameter("password")).length) > o.length && (n = o.length - 1), o = o.substring(n, o.length), t += o
        } catch (i) {
            PutToDebugLogException(2, "common: HideClearPassword", i)
        }
        return e
    }

    function UseCustomAutoprov(e) {
        try {
            var o = GetParameter("customautoprov_url");
            if (isNull(o) || o.length < 3) return !1;
            if (1 == GetParameterInt("customautoprov_repeat", 1) && GetParameterInt("custautoprov_exectimes", 0) > 0) return !1;
            var t = GetParameterInt("customautoprov_when", 1);
            return !(!0 === e && 2 == t || !1 === e && 1 == t)
        } catch (n) {
            PutToDebugLogException(2, "common: UseCustomAutoprov", n)
        }
        return !1
    }

    function GetCustomAutoprov(e) {
        try {
            var o = GetParameter("customautoprov_url");
            if (isNull(o) || o.length < 5) return PutToDebugLog(2, "ERROR, GetCustomAutoprov invalid url"), void e("ERROR, GetCustomAutoprov invalid url");
            IsHttps() && (o = o.replace("http:", "https:")), o = UriParser(o, "", "", "", "", "return_uri"), PutToDebugLog(3, "EVENT, GetCustomAutoprov url: " + o), acploop++;
            var t = new XMLHttpRequest;
            if ("withCredentials" in t) t.open("GET", o, !0); else {
                if ("undefined" == typeof XDomainRequest) return PutToDebugLog(2, "ERROR, common: GetCustomAutoprov, CORS not supported"), void e("ERROR, GetCustomAutoprov CORS not supported callback");
                t = new XDomainRequest, t.open("GET", o)
            }
            var n = 0;
            t.onload = function () {
                try {
                    if (PutToDebugLog(4, "EVENT, GetCustomAutoprov.onload"), n = 19, !1 === webphone_api.global.httpheaderslogged && t.getAllResponseHeaders) {
                        webphone_api.global.httpheaderslogged = !0;
                        PutToDebugLog(5, "EVENT, GetCustomAutoprov: HTTP request answer headers 3: " + t.getAllResponseHeaders())
                    }
                    var o = t.responseText;
                    return n = 20, PutToDebugLog(2, "EVENT, GetCustomAutoprov response: " + o), n = 21, isNull(o) || o.length < 1 ? (n = 23, PutToDebugLog(2, "ERROR, GetCustomAutoprov response is NULL"), void e("")) : void e(o)
                } catch (i) {
                    PutToDebugLogException(2, "common: GetCustomAutoprov.onload inner (" + n + ")", i), e("ERROR, catch on: common: GetCustomAutoprov.onload inner (" + n + ")")
                }
            }, t.onerror = function (o) {
                var t = "";
                isNull(o) || (t = o.toString(), isNull(o.target) || (t = isNull(o.target.status) ? t + " " + o.target.toString() : t + " " + o.target.status.toString())), PutToDebugLog(2, "ERROR, common: GetCustomAutoprov: onerror: " + t), e("ERROR, common: GetCustomAutoprov: onerror FAILED")
            }, t.timeout = 9e3, t.ontimeout = function (o) {
                PutToDebugLog(2, "ERROR, common: GetCustomAutoprov: Timeout"), e("ERROR, common: GetCustomAutoprov: ontimeout FAILED")
            }, t.send()
        } catch (i) {
            PutToDebugLogException(2, "common: GetCustomAutoprov", i), e("ERROR, common: GetCustomAutoprov: global failure")
        }
    }

    function RecAutoprovCustom(e) {
        try {
            PutToDebugLog(3, "EVENT, RecAutoprovCustom: " + e);
            if (isNull(e) || Trim(e).length <= 0 || e.toLowerCase().indexOf("error") >= 0 && e.length < 160) return void PutToDebugLog(3, "ERROR, can't get custom autoprovisioning: " + e);
            if (e.indexOf("AUTOPROVISIONINGSTART") < 0 || e.indexOf("AUTOPROVISIONINGEND") < 0) return void PutToDebugLog(3, "ERROR, custom autoprovisioning: no AUTOPROVISIONINGSTART and AUTOPROVISIONINGEND found: " + e);
            e = e.substring(e.indexOf("AUTOPROVISIONINGSTART") + 21, e.indexOf("AUTOPROVISIONINGEND")), e = Trim(e);
            var o = e.split("\n");
            if (isNull(o) || o.length < 1) return void PutToDebugLog(3, "ERROR, custom autoprovisioning invalid received data: " + e);
            var t = [];
            t.push("s"), t.push("e"), t.push("r"), t.push("v"), t.push("e"), t.push("r"), t.push("a"), t.push("d"), t.push("d"), t.push("r"), t.push("e"), t.push("s"), t.push("s");
            for (var n = t.join(""), i = 0, a = 0; a < o.length; a++) if (!(isNull(o[a]) || o[a].length < 3 || o[a].indexOf(":") < 1)) {
                o[a] = Trim(o[a]);
                var r = Trim(o[a].substring(0, o[a].indexOf(":"))), s = Trim(o[a].substring(o[a].indexOf(":") + 1));
                r = r.toLowerCase(), PutToDebugLog(5, "EVENT, custom autoprovisioning set: " + r + " = " + s), r !== n && 0 !== Trim(r).indexOf(n) && (SaveParameter(r, s), i++)
            }
            if (PutToDebugLog(2, "EVENT, RecAutoprovCustom number of configs received: " + i), i > 1) {
                var l = GetParameterInt("custautoprov_exectimes", 0);
                l += 1, SaveParameter("custautoprov_exectimes", l.toString())
            } else PutToDebugLog(5, "WARNING, custom autoprovisioning probably failed because too few parameters found: " + i)
        } catch (p) {
            PutToDebugLogException(2, "common: RecAutoprovCustom", p)
        }
    }

    function GetAutoprovisioning(e, o) {
        try {
            if (getuseengine() !== webphone_api.global.ENGINE_WEBRTC && getuseengine() !== webphone_api.global.ENGINE_FLASH) return PutToDebugLog(2, "ERROR, GetAutoprovisioning invalid engine: " + getuseengine()), void o("");
            (isNull(e) || e.length < 1) && (e = webphone_api.global.autoprovsrv_1);
            var t = GetParameter("serveraddress_user");
            if (isNull(t) || Trim(t).length < 1) return PutToDebugLog(2, "ERROR, GetAutoprovisioning no serveraddress_user specified"), void o("ERROR, GetAutoprovisioning no serveraddress_user specified callback");
            e = e + t + ".txt", IsHttps() && (e = e.replace("http:", "https:")), PutToDebugLog(3, "EVENT, GetAutoprovisioning url: " + e), aploop++;
            var n = new XMLHttpRequest;
            if ("withCredentials" in n) n.open("GET", e, !0); else {
                if ("undefined" == typeof XDomainRequest) return PutToDebugLog(2, "ERROR, common: GetAutoprovisioning, CORS not supported"), void o("ERROR, GetAutoprovisioning CORS not supported callback");
                n = new XDomainRequest, n.open("GET", e)
            }
            var i = 0;
            n.onload = function () {
                try {
                    if (PutToDebugLog(4, "EVENT, GetAutoprovisioning.onload"), i = 19, !1 === webphone_api.global.httpheaderslogged && n.getAllResponseHeaders) {
                        webphone_api.global.httpheaderslogged = !0;
                        PutToDebugLog(5, "EVENT, HTTP request answer headers 3: " + n.getAllResponseHeaders())
                    }
                    var e = n.responseText;
                    return i = 20, PutToDebugLog(2, "EVENT, GetAutoprovisioning response: " + e), i = 21, isNull(e) || e.length < 1 ? (i = 23, PutToDebugLog(2, "ERROR, GetAutoprovisioning response is NULL"), void o("")) : void o(e)
                } catch (t) {
                    PutToDebugLogException(2, "common: GetAutoprovisioning.onload inner (" + i + ")", t), o("ERROR, catch on: common: GetAutoprovisioning.onload inner (" + i + ")")
                }
            }, n.onerror = function (e) {
                var t = "";
                isNull(e) || (t = e.toString(), isNull(e.target) || (t = isNull(e.target.status) ? t + " " + e.target.toString() : t + " " + e.target.status.toString())),
                    PutToDebugLog(2, "ERROR, common: GetAutoprovisioning: onerror: " + t), o("ERROR, common: GetAutoprovisioning: onerror FAILED")
            }, n.timeout = 9e3, n.ontimeout = function (e) {
                PutToDebugLog(2, "ERROR, common: GetAutoprovisioning: Timeout"), o("ERROR, common: GetAutoprovisioning: ontimeout FAILED")
            }, n.send()
        } catch (a) {
            PutToDebugLogException(2, "common: GetAutoprovisioning", a), o("ERROR, common: GetAutoprovisioning: global failure")
        }
    }

    function ParseAutoprovisioning(e, o) {
        try {
            !0 === o ? SaveParameter("cust_lastautoprov", GetTickCount().toString()) : SaveParameter("lastautoprov", GetTickCount().toString()), e.lastIndexOf("EOFLINE") > 0 && (e = ReplaceAll(e, "EOFLINE", "\r\n")), SaveParameter("serveraddress_orig", GetAPparam("server", e)), SaveParameter("proxyaddress", GetAPparam("proxyserver", e)), SaveParameter("cfgusetunneling", GetAPparam("encryption", e)), SaveParameter("cfgusetunneling", GetAPparam("cfgusetunneling", e)), SaveParameter("techprefix", GetAPparam("techprefix", e)), SaveParameter("creditrequest", GetAPparam("creditrequest", e)), SaveParameter("ratingrequest", GetAPparam("ratingrequest", e)), SaveParameter("accounturi", GetAPparam("accounturi", e)), SaveParameter("newuser", GetAPparam("newuser", e)), SaveParameter("callback", GetAPparam("callback", e)), SaveParameter("p2p", GetAPparam("p2p", e)), SaveParameter("sms", GetAPparam("sms", e)), SaveParameter("brandname", GetAPparam("brandname", e)), SaveParameter("companyname", GetAPparam("companyname", e)), SaveParameter("homepage", GetAPparam("website", e)), SaveParameter("recharge", GetAPparam("recharge", e)), SaveParameter("brandtext", GetAPparam("brandtext", e)), SaveParameter("voicemail", GetAPparam("voicemail", e)), SaveParameter("voicemailnum", GetAPparam("voicemailnum", e)), SaveParameter("messagepopup", GetAPparam("messagepopup", e)), SaveParameter("messagedisplay", GetAPparam("messagedisplay", e)), SaveParameter("encryptionseries", GetAPparam("encryptionseries", e)), SaveParameter("directserveraddress", GetAPparam("directserveraddress", e)), SaveParameter("consoleaddress", GetAPparam("consoleaddress", e)), SaveParameter("httptunnelport", GetAPparam("httptunnelport", e)), SaveParameter("tcptunnelingport", GetAPparam("tcptunnelingport", e)), SaveParameter("rsakey_public_k", GetAPparam("rsakey_public_k", e)), SaveParameter("fastencryptkey", GetAPparam("fastencryptkey", e)), SaveParameter("autotransportdetect", GetAPparam("autotransportdetect", e)), SaveParameter("remotehttpport", GetAPparam("remotehttpport", e)), SaveParameter("encryptionmethod", GetAPparam("encryptionmethod", e)), SaveParameter("cantryudpdirectep", GetAPparam("cantryudpdirectep", e)), SaveParameter("usingmizuserver", GetAPparam("usingmizuserver", e)), SaveParameter("upperserver", GetAPparam("upperserver", e)), SaveParameter("serverinputisupperserver", GetAPparam("serverinputisupperserver", e)), SaveParameter("version", GetAPparam("version", e)), SaveParameter("header", GetAPparam("header", e)), SaveParameter("footer", GetAPparam("footer", e)), SaveParameter("logo", GetAPparam("logo", e)), SaveParameter("supportmail", GetAPparam("supportmail", e)), SaveParameter("supporturl", GetAPparam("supporturl", e)), SaveParameter("advertisement", GetAPparam("advertisement", e)), SaveParameter("helpurl", GetAPparam("helpurl", e)), SaveParameter("licenseurl", GetAPparam("licenseurl", e)), SaveParameter("extramenuurl", GetAPparam("extramenuurl", e)), SaveParameter("extramenutxt", GetAPparam("extramenutxt", e))
        } catch (t) {
            PutToDebugLogException(2, "common: ParseAutoprovisioning", t)
        }
    }

    function GetAPparam(e, o) {
        try {
            if (isNull(e) || e.length < 1 || isNull(o) || o.indexOf(e) < 0) return "";
            var t = o.split("\r\n");
            if (isNull(t) || t.length < 1) return "";
            for (var n = 0; n < t.length; n++) if (!isNull(t[n]) && 0 === Trim(t[n]).indexOf(e + ":")) {
                var i = t[n].substring(t[n].indexOf(e + ":") + e.length + 1, t[n].length);
                return Trim(i)
            }
        } catch (a) {
            PutToDebugLogException(2, "common: GetAPparam", a)
        }
        return ""
    }

    function RandomInt(e, o) {
        try {
            var t = o - e + 1, n = Math.round(Math.random() * t) % t;
            return n += Math.round(e)
        } catch (i) {
            PutToDebugLogException(2, "common: RandomInt", i)
        }
        return 0
    }

    function RandomStr(e, o, t) {
        try {
            if (isNull(e) || e < 1) return "";
            isNull(o) && (o = !1), isNull(t) && (t = !1);
            var n = 48;
            !1 === t && (n = 65);
            for (var i = "", a = 0; a < 5e3; a++) {
                var r = RandomInt(n, 122);
                if (!1 === o ? ASCII_NRLOWER.indexOf(r) > -1 && (i += String.fromCharCode(r)) : ASCII_ALL.indexOf(r) > -1 && (i += String.fromCharCode(r)), i.length >= e) return i
            }
            return i
        } catch (s) {
            PutToDebugLogException(2, "common: RandomStr", s)
        }
        return 0
    }

    function ShowModalLoader(e) {
        try {
            webphone_api.$("body").append('<div class="modalWindow"/>'), webphone_api.$.mobile.loading("show", {
                text: e,
                textVisible: !0,
                theme: "b",
                html: ""
            })
        } catch (o) {
            PutToDebugLogException(2, "common: ShowModalLoader", o)
        }
    }

    function HideModalLoader() {
        try {
            webphone_api.$(".modalWindow").remove(), webphone_api.$.mobile.loading("hide")
        } catch (e) {
            PutToDebugLogException(2, "common: HideModalLoader", e)
        }
    }

    function GetDefaultFontSize(e) {
        var o = 0;
        try {
            e = e || document.body;
            var t = document.createElement("span");
            return t.style.cssText = "display:inline-block; padding:0; line-height:1; position:absolute; visibility:hidden; font-size:1em", t.appendChild(document.createTextNode("M")), e.appendChild(t), o = t.offsetHeight, e.removeChild(t), isNull(o) && (o = 0), o
        } catch (n) {
            PutToDebugLogException(2, "common: GetDefaultFontSize", n)
        }
        return 0
    }

    function ShowServerInput() {
        try {
            var e = GetParameter("showserverinput");
            if ("0" === e) return !1;
            if ("2" === e) return !0;
            if ("1" === e) {
                var o = webphone_api.parameters.serveraddress, t = GetConfig("serveraddress");
                return isNull(o) && (o = ""), isNull(t) && (t = ""), !(o.length > 0 || t.length > 0) || "false" !== GetParameter("serverinputisupperserver")
            }
        } catch (n) {
            PutToDebugLogException(2, "common: ShowServerInput", n)
        }
        return !1
    }

    function RequestUserServerInput(e) {
        try {
            if (isNull(e) && (e = GetParameter("upperserverfromuser")), "0" === e || "1" === e) return !1;
            if ("3" === e) return !0;
            if ("2" === e) return !!ShowServerInput()
        } catch (o) {
            PutToDebugLogException(2, "common: RequestUserServerInput", o)
        }
        return !1
    }

    function GetAllContactsNumbersSipuris() {
        var e = "";
        try {
            if (isNull(webphone_api.global.ctlist)) return PutToDebugLog(2, "WARNING, common: GetAllContactsNumbersSipuris no numbers to return"), "";
            if (webphone_api.global.ctlist.length < 1) return PutToDebugLog(2, "EVENT, common: GetAllContactsNumbersSipuris no numbers to return"), "";
            for (var o = 0; o < webphone_api.global.ctlist.length; o++) {
                var t = webphone_api.global.ctlist[o];
                if (!(isNull(t) || t.length < 1)) {
                    var n = t[CT_NUMBER];
                    if (!(isNull(n) || n.length < 1)) for (var i = 0; i < n.length; i++) !isNull(n[i]) && n[i].length > 0 && (e.length > 0 && (e += ","), e += n[i])
                }
            }
            return e
        } catch (a) {
            PutToDebugLogException(2, "common: GetAllContactsNumbersSipuris", a)
        }
        return ""
    }

    function SetDID() {
        try {
            if (sdcalled) return;
            sdt++, sdt > 3 && (sdcalled = !0), setTimeout(function () {
                SetDID()
            }, 8e3);
            var e = RandomInt(1e4, 99999999);
            WinAPI("API_SetDIDChange", null, e, Md5Hash("didchange" + e))
        } catch (o) {
            PutToDebugLogException(2, "common: SetDIDX", o)
        }
    }

    function GtUc() {
        return unlockcodetrick
    }

    function GtUct() {
        return unlockcodetricktogled
    }

    function Hasesw() {
        return !isNull(alsv) && alsv.length > 0 || !isNull(alsww) && alsww.length > 0
    }

    function Us() {
        return webphone_api.global.usestorage
    }

    function Alwr() {
        var e = !1;
        try {
            if (webphone_api.global.useengine !== webphone_api.global.ENGINE_WEBRTC || isNull(alswrt) || Trim(alswrt).length < 1) return !0;
            var o = GetWebrtcSrvAddr();
            o = o.toLowerCase();
            var t = [];
            t.push("l"), t.push("o"), t.push("c"), t.push("a"), t.push("l"), t.push("f"), t.push("i"), t.push("l"), t.push("e");
            var n = t.join("");
            t = [], t.push("l"), t.push("o"), t.push("c"), t.push("a"), t.push("l");
            var i = t.join("");
            t = [], t.push("1"), t.push("2"), t.push("7"), t.push("."), t.push("0"), t.push("."), t.push("0"), t.push("."), t.push("1");
            var a = t.join("");
            t = [], t.push("l"), t.push("o"), t.push("c"), t.push("a"), t.push("l"), t.push("h"), t.push("o"), t.push("s"), t.push("t");
            var r = t.join(""), s = o.indexOf("//");
            if (s > 0 && (o = o.substring(s + 2, o.length)), s = o.indexOf("/"), s > 0 && (o = o.substring(0, s)), s = o.indexOf(":"), s > 0 && (o = o.substring(0, s)), o = o.replace("www.", ""), isNull(o) || Trim(o).length < 1) return !1;
            o = Trim(o);
            var l = StrDc(alswrt, alsvkey);
            if (!isNull(l) && l.length > 0) {
                var p = l.split(",");
                if (!isNull(p) && p.length > 0) for (var c = 0; c < p.length; c++) if (!(isNull(p[c]) || p[c].length < 1)) {
                    if (p[c] = Trim(p[c]), p[c] = p[c].toLowerCase(), o.indexOf(p[c]) >= 0) {
                        e = !0;
                        break
                    }
                    if (p[c] === n && !0 === IsLocalFileSys() || p[c] === r && (o.indexOf(a) >= 0 || o.indexOf(r) >= 0) || p[c] === i && (!0 === IsLocalFileSys() || o.indexOf(a) >= 0 || o.indexOf(r) >= 0)) {
                        e = !0;
                        break
                    }
                }
            }
            return e
        } catch (u) {
            PutToDebugLogException(2, "common: Alwr", u)
        }
        return !1
    }

    function Awre() {
        if (!1 === Alwr()) {
            var e = [];
            e.push("E"), e.push("R"), e.push("R"), e.push("O"), e.push("R"), e.push(","), e.push("w"), e.push("e"), e.push("b"), e.push("r"), e.push("t"), e.push("c"), e.push(" "), e.push("s"), e.push("e"), e.push("r"), e.push("v"), e.push("e"), e.push("r"), e.push(" "), e.push("n"), e.push("o"), e.push("t"), e.push(" "), e.push("a"), e.push("l"), e.push("l"), e.push("o"), e.push("w"), e.push("e"), e.push("d"), e.push("_"), e.push("1");
            var o = e.join("");
            setTimeout(function () {
                PutToDebugLog(1, o)
            }, 1881)
        }
    }

    function Alwm() {
        var e = !1;
        try {
            if (webphone_api.global.useengine !== webphone_api.global.ENGINE_WEBRTC) return !0;
            if (void 0 === alsww || isNull(alsww) || null == alsww || Trim(alsww).length < 1) return void 0 !== malsx2 && null != malsx2 && 44 === malsx2;
            var o = GetParameter("aldm");
            if ((isNull(o) || Trim(o).length < 1) && (o = window.location.href), isNull(o) || Trim(o).length < 1) return !1;
            o = decodeURIComponent(o), o = o.toLowerCase();
            var t = [];
            t.push("l"), t.push("o"), t.push("c"), t.push("a"), t.push("l"), t.push("f"), t.push("i"), t.push("l"), t.push("e");
            var n = t.join("");
            t = [], t.push("l"), t.push("o"), t.push("c"), t.push("a"), t.push("l");
            var i = t.join("");
            t = [], t.push("1"), t.push("2"), t.push("7"), t.push("."), t.push("0"), t.push("."), t.push("0"), t.push(".");
            var a = t.join("");
            t = [], t.push("l"), t.push("o"), t.push("c"), t.push("a"), t.push("l"), t.push("h"), t.push("o"), t.push("s"), t.push("t");
            var r = t.join(""), s = o.indexOf("//");
            if (s > 0 && (o = o.substring(s + 2, o.length)), s = o.indexOf("/"), s > 0 && (o = o.substring(0, s)), s = o.indexOf(":"), s > 0 && (o = o.substring(0, s)), o = o.replace("www.", ""), isNull(o) || Trim(o).length < 1) return !1;
            if (o = Trim(o), o.indexOf("localhost") >= 0 || o.indexOf("127.0.0.1") >= 0) return !0;
            var l = StrDc(alsww, alsvkey);
            if (!isNull(l) && l.length > 0) {
                var p = l.split(",");
                if (!isNull(p) && p.length > 0) for (var c = 0; c < p.length; c++) if (!(isNull(p[c]) || p[c].length < 1)) {
                    if (p[c] = Trim(p[c]), p[c] = p[c].toLowerCase(), o.indexOf(p[c]) >= 0) {
                        e = !0;
                        break
                    }
                    if (p[c] === n && !0 === IsLocalFileSys() || p[c] === r && (o.indexOf(a) >= 0 || o.indexOf(r) >= 0) || p[c] === i && (!0 === IsLocalFileSys() || o.indexOf(a) >= 0 || o.indexOf(r) >= 0)) {
                        e = !0;
                        break
                    }
                }
            }
            return e
        } catch (u) {
            PutToDebugLogException(2, "common: Alwm", u)
        }
        return !1
    }

    function Awe() {
        if (!1 === Alwm()) {
            var e = [];
            e.push("E"), e.push("R"), e.push("R"), e.push("O"), e.push("R"), e.push(","), e.push("W"), e.push("e"), e.push("b"), e.push("s"), e.push("e"), e.push("r"), e.push("v"), e.push("e"), e.push("r"), e.push(" "), e.push("n"), e.push("o"), e.push("t"), e.push(" "), e.push("a"), e.push("l"), e.push("l"), e.push("o"), e.push("w"), e.push("e"), e.push("d"), e.push("_"), e.push("1");
            var o = e.join("");
            setTimeout(function () {
                PutToDebugLog(1, o)
            }, 1881), setTimeout(function () {
                ShowToast(o)
            }, 1246)
        }
    }

    function Awb() {
        var e = Alwm();
        return !1 === e && Awe(), e = Alwr(), !1 === e && Awre(), e
    }

    function Awb2() {
        var e = Alwm();
        return !1 === e && Awe(), e
    }

    function CheckDID(e, o) {
        var t = !1;
        try {
            if (isNull(e) || e.length < 1) return !0 !== o;
            e = e.toLowerCase();
            var n = e.indexOf(":");
            if (n > 0 && (e = e.substring(0, n)), e = Trim(e), e.indexOf(".") < 1) return !0;
            var i = [];
            i.push("l"), i.push("a"), i.push("n"), i.push("i"), i.push("p");
            var a = i.join("");
            i = [], i.push("l"), i.push("o"), i.push("c"), i.push("a"), i.push("l"), i.push("f"), i.push("i"), i.push("l"), i.push("e");
            var r = i.join("");
            i = [], i.push("l"), i.push("o"), i.push("c"), i.push("a"), i.push("l");
            var s = i.join("");
            i = [], i.push("1"), i.push("2"), i.push("7"), i.push("."), i.push("0"), i.push("."), i.push("0"), i.push("."), i.push("1");
            var l = i.join("");
            i = [], i.push("l"), i.push("o"), i.push("c"), i.push("a"), i.push("l"), i.push("h"), i.push("o"), i.push("s"), i.push("t");
            var p = i.join(""), c = [];
            c.push("w"), c.push("e"), c.push("b"), c.push("s"), c.push("e"), c.push("r"), c.push("v"), c.push("e"), c.push("r");
            var u = c.join("");
            if (void 0 === alsv || null == alsv || Trim(alsv).length < 1) return void 0 !== malsx1 && null != malsx1 && 77 === malsx1;
            if (!(!isNull(alsv) && alsv.length > 0 || !isNull(alsvir1) && alsvir1.length > 0 || !isNull(alsvir2) && alsvir2.length > 0 || !isNull(alsvir3) && alsvir3.length > 0)) return !0 !== o;
            var h = StrDc(alsv, alsvkey);
            if (!isNull(h) && h.length > 0) {
                var m = h.split(",");
                if (!isNull(m) && m.length > 0) {
                    for (var g = 0; g < m.length; g++) if (!(isNull(m[g]) || m[g].length < 1) && (m[g] = Trim(m[g]), m[g] = m[g].toLowerCase(), u === m[g])) {
                        var d = e.indexOf("sip.");
                        0 === d && (e = e.substring(d + 4));
                        var b = GetDomainFromURL(window.location.href);
                        return !(isNull(b) || b.length < 3) && (b = b.toLowerCase(), b = Trim(b), d = b.indexOf("www."), 0 === d && (b = b.substring(d + 4)), e === b)
                    }
                    for (var g = 0; g < m.length; g++) if (!(isNull(m[g]) || m[g].length < 1)) {
                        if (m[g] = Trim(m[g]), m[g] = m[g].toLowerCase(), e.indexOf(m[g]) >= 0) {
                            t = !0;
                            break
                        }
                        if (m[g] === a && IsLanIP(e)) {
                            t = !0;
                            break
                        }
                        if (m[g] === r && !0 === IsLocalFileSys() || m[g] === p && (e.indexOf(l) >= 0 || e.indexOf(p) >= 0) || m[g] === s && (!0 === IsLocalFileSys() || e.indexOf(l) >= 0 || e.indexOf(p) >= 0)) {
                            t = !0;
                            break
                        }
                    }
                }
            }
            if (!isNull(alsvir1) && Trim(alsvir1).length > 2) {
                var _ = StrDc(alsvir1, alsvkey);
                _ = Trim(_), _ = _.toLowerCase(), 0 === e.indexOf(_) && (t = !0)
            }
            if (!isNull(alsvir2) && Trim(alsvir2).length > 2) {
                var f = StrDc(alsvir2, alsvkey);
                f = Trim(f), f = f.toLowerCase(), 0 === e.indexOf(f) && (t = !0)
            }
            if (!isNull(alsvir3) && Trim(alsvir3).length > 2) {
                var w = StrDc(alsvir3, alsvkey);
                w = Trim(w), w = w.toLowerCase(), 0 === e.indexOf(w) && (t = !0)
            }
        } catch (v) {
            PutToDebugLogException(2, "common: CheckDIDX", v)
        }
        return t
    }

    function Ch() {
        try {
            if (alsvu1.length < 1 && alsvu2.length < 1 && alsvu3.length < 1) return !0;
            if (hua.length < 1 && (hua = GetSipHeader("User-agent")), hsrv.length < 1 && (hsrv = GetSipHeader("Server")), hsrvx.length < 1 && (hsrvx = GetSipHeader("X-Server")), webphone_api.global.useengine !== webphone_api.global.ENGINE_WEBRTC) return !0;
            if (hua.length < 1 && hsrv.length < 1) return !1;
            hua = hua.toLowerCase(), hsrv = hsrv.toLowerCase(), hsrvx = hsrvx.toLowerCase();
            var e = alsvu1, o = alsvu2, t = alsvu3;
            isNull(e) && (e = ""), isNull(o) && (o = ""), isNull(t) && (t = ""), e = StrDc(e, alsvkey), o = StrDc(o, alsvkey), t = StrDc(t, alsvkey), e = e.toLowerCase(), o = o.toLowerCase(), t = t.toLowerCase();
            var n = !1;
            if (hua.length > 0 && (e.length > 0 && hua.indexOf(e) >= 0 ? n = !0 : o.length > 0 && hua.indexOf(o) >= 0 ? n = !0 : t.length > 0 && hua.indexOf(t) >= 0 && (n = !0)), hsrv.length > 0 && (e.length > 0 && hsrv.indexOf(e) >= 0 ? n = !0 : o.length > 0 && hsrv.indexOf(o) >= 0 ? n = !0 : t.length > 0 && hsrv.indexOf(t) >= 0 && (n = !0)), hsrvx.length > 0 && (e.length > 0 && hsrvx.indexOf(e) >= 0 ? n = !0 : o.length > 0 && hsrvx.indexOf(o) >= 0 ? n = !0 : t.length > 0 && hsrvx.indexOf(t) >= 0 && (n = !0)), void 0 === alsv || null == alsv || Trim(alsv).length < 1) return void 0 !== malsx1 && null != malsx1 && 77 === malsx1;
            if (!1 === n && !isNull(alsv) && alsv.length > 2) {
                var i = GetParameter("serveraddress_user");
                (isNull(i) || i.length < 2) && (i = GetParameter("serveraddress")), n = CheckDID(i, !0)
            }
            return n
        } catch (a) {
            PutToDebugLogException(2, "common: Ch", a)
        }
        return !0
    }

    function Loa() {
        if (lic_onlyandroidvideo < 1) return !0;
        if (null === myLoaCachedvalueFrom) {
            var e = [];
            e.push("c"), e.push("a"), e.push("l"), e.push("l"), e.push("e"), e.push("r"), e.push("e"), e.push("x"), e.push("t"), e.push("e"), e.push("n"), e.push("s"), e.push("i"), e.push("o"), e.push("n"), e.push("="), e.push("3"), e.push("4"), e.push("5");
            var o = e.join("");
            e = [], e.push("A"), e.push("n"), e.push("d"), e.push("r"), e.push("o"), e.push("i"), e.push("d");
            var t = e.join("");
            e = [], e.push("w"), e.push("e"), e.push("b"), e.push("v"), e.push("o"), e.push("i"), e.push("p"), e.push("p"), e.push("h"), e.push("o"), e.push("n"), e.push("e"), e.push("."), e.push("c"), e.push("o"), e.push("m");
            var n = e.join("");
            e = [], e.push("a"), e.push("r"), e.push("t"), e.push("c"), e.push("v"), e.push("i"), e.push("d"), e.push("e"), e.push("o"), e.push("c"), e.push("a"), e.push("l"), e.push("l");
            var i = e.join(""), a = window.location.href;
            myLoaCachedvalueFrom = !(GetOs() !== t || a.indexOf(n) < 1 || a.indexOf(i) < 1 || a.indexOf(o) < 1)
        }
        return myLoaCachedvalueFrom
    }

    function Glsp() {
        var e = GetOs();
        e = e.toLowerCase();
        var o = [];
        o.push("w"), o.push("i"), o.push("n"), o.push("d"), o.push("o"), o.push("w"), o.push("s");
        var t = o.join("");
        o = [], o.push("m"), o.push("a"), o.push("c");
        var n = o.join("");
        o = [], o.push("l"), o.push("i"), o.push("n"), o.push("u"), o.push("x");
        var i = o.join("");
        return o = [], e === t || e === n || e === i || !(lic_smartphone < 1) && !(lic_smartphone < 2 && lversion < 2)
    }

    function Glv() {
        return lversion
    }

    function Glss() {
        return !(lic_screensharing < 1) && !(lic_screensharing < 2 && lversion < 2)
    }

    function Glbr() {
        return !(lic_balancerating < 1) && !(lic_balancerating < 2 && lversion < 2)
    }

    function Glop() {
        return !(lic_opus < 1) && !(lic_opus < 2 && lversion < 2)
    }

    function Glpr() {
        return !(lic_presence < 1) && !(lic_presence < 2 && lversion < 2)
    }

    function Glcr() {
        return !(lic_callrecord < 1) && !(lic_callrecord < 2 && lversion < 2)
    }

    function Glcf() {
        var e = [];
        return e.push("h"), e.push("a"), e.push("s"), e.push("c"), e.push("o"), e.push("n"), e.push("f"), e.push("e"), e.push("r"), e.push("e"), e.push("n"), e.push("c"), e.push("e"), !(!1 === GetParameterBool(e.join(""), !0) || lic_conference < 1 || lic_conference < 2 && lversion < 2)
    }

    function Glft() {
        return !(lic_filetransfer < 1) && !(lic_filetransfer < 2 && lversion < 1)
    }

    function Glvd() {
        return !(lic_video < 1) && !(lic_video < 2 && lversion < 2)
    }

    function Glt() {
        return !(lic_transfer < 1) && !(lic_transfer < 2 && lversion < 1)
    }

    function Te() {
        try {
            var e = 2016, o = 11, t = 10;
            try {
                e = StrToInt(StrDc(usestoragetry, alsvkey))
            } catch (s) {
                return !0
            }
            try {
                o = StrToInt(StrDc(usestoragetrm, alsvkey))
            } catch (s) {
                return !0
            }
            try {
                t = StrToInt(StrDc(usestoragetrd, alsvkey))
            } catch (s) {
                return !0
            }
            if (e > 2300) return !1;
            var n = new Date, i = n.getFullYear(), a = n.getMonth(), r = n.getDate();
            return a += 1, i > e || (i === e && a > o || i === e && a === o && r >= t)
        } catch (s) {
            PutToDebugLogException(2, "common: te", s)
        }
        return !0
    }

    function Te2() {
        try {
            var e = 1008, o = 11, t = 1;
            e *= 2;
            try {
                e = StrToInt(StrDc(usestoragetry2, alsvkey))
            } catch (l) {
                return !0
            }
            try {
                o = StrToInt(StrDc(usestoragetrm2, alsvkey))
            } catch (l) {
                return !0
            }
            if (e > 2300) return !1;
            var n = new Date, i = n.getFullYear(), a = n.getMonth(), r = n.getDate();
            a += 1;
            var s = GetParameterInt("stgrnd", -1);
            return (s < 0 || s > 27) && (s = RandomInt(1, 27), SaveParameter("stgrnd", s)), t = s, i > e || (i === e && a > o || i === e && a === o && r >= t)
        } catch (l) {
            PutToDebugLogException(2, "common: te2", l)
        }
        return !0
    }

    function Ted() {
        try {
            var e = 2016, o = 11, t = 10;
            try {
                e = StrToInt(StrDc(usestoragetry, alsvkey))
            } catch (l) {
                return !0
            }
            try {
                o = StrToInt(StrDc(usestoragetrm, alsvkey))
            } catch (l) {
                return !0
            }
            try {
                t = StrToInt(StrDc(usestoragetrd, alsvkey))
            } catch (l) {
                return !0
            }
            var n = new Date, i = n.getFullYear(), a = n.getMonth(), r = n.getDate();
            a += 1;
            var s = 183;
            return s = 2 * s * (e - i), s += 30 * (o - a), s += t - r
        } catch (l) {
            PutToDebugLogException(2, "common: ted", l)
        }
        return 0
    }

    function Strl(e) {
        try {
            if (void 0 !== e && null !== e && IsNumber(e) || (e = 9, e *= 10), Ted() < e) {
                if (null === days_since_deploy) {
                    days_since_deploy = 130;
                    var o = GetConfig("lastdeploydate");
                    if (!isNull(o) && o.length > 0 && o.indexOf("/") > 0) {
                        var t = StrToIntDef(Trim(o.substring(0, o.indexOf("/"))), 1);
                        o = o.substring(o.indexOf("/") + 1);
                        var n = StrToIntDef(Trim(o.substring(0, o.indexOf("/"))), 1);
                        o = o.substring(o.indexOf("/") + 1);
                        var i = StrToIntDef(Trim(o.substring(0, o.indexOf(" "))), 2018), a = new Date,
                            r = a.getFullYear(), s = a.getMonth(), l = a.getDate();
                        return s += 1, days_since_deploy = 183, days_since_deploy = 2 * days_since_deploy * (r - i), days_since_deploy += 30 * (s - t), !((days_since_deploy += l - n) > e + 10)
                    }
                    return !0
                }
                return !(days_since_deploy > e + 10)
            }
        } catch (p) {
            PutToDebugLogException(2, "common: strl", p)
        }
        return !1
    }

    function GetFp() {
        return StrDc(fip, alsvkey)
    }

    function GetWp(e) {
        try {
            (isNull(e) || e.length < 1) && (e = webphone_api.global.usuk);
            var o = "";
            return o = !0 === BrowserRequiresHttps(!1) ? "us" === e ? StrDc(wips_us, alsvkey) : StrDc(wips_uk, alsvkey) : "us" === e ? StrDc(wip_us, alsvkey) : StrDc(wip_uk, alsvkey), o = o.replace("*", "")
        } catch (t) {
            PutToDebugLogException(2, "common: GetWp", t)
        }
        return ""
    }

    function GetWpS(e) {
        try {
            var o = "";
            return o = isNull(e) || "uk" !== e && "us" !== e ? "us" === webphone_api.global.usuk ? StrDc(wips_us, alsvkey) : StrDc(wips_uk, alsvkey) : "us" === e ? StrDc(wips_us, alsvkey) : StrDc(wips_uk, alsvkey), o = o.replace("*", "")
        } catch (t) {
            PutToDebugLogException(2, "common: GetWpS", t)
        }
        return ""
    }

    function GetPassphrase() {
        try {
            return !isNull(pphe) && pphe.length > 0 ? pphe : (pphe = GetConfig("passphrase", !1), isNull(pphe) ? "" : (pphe.indexOf("dcid_") >= 0 && (pphe = StrDc(pphe, alsvkey)), pphe))
        } catch (e) {
            PutToDebugLogException(2, "common: GetPassphrase", e)
        }
        return ""
    }

    function SvCont() {
        try {
            var e = [];
            e.push("m"), e.push("i"), e.push("z"), e.push("u"), e.push("-"), e.push("v"), e.push("o"), e.push("i"), e.push("p");
            var o = e.join(""), t = GetParameter("serveraddress_user"), n = GetParameter("serveraddress_orig"),
                i = GetParameter("serveraddress");
            if (t.length > 0 && t.toLowerCase().indexOf(o) || n.length > 0 && n.toLowerCase().indexOf(o) || i.length > 0 && i.toLowerCase().indexOf(o)) return !0
        } catch (a) {
            PutToDebugLogException(2, "common: SvCont", a)
        }
        return !1
    }

    function WbCont() {
        try {
            var e = [];
            e.push("m"), e.push("i"), e.push("z"), e.push("u"), e.push("-"), e.push("v"), e.push("o"), e.push("i"), e.push("p");
            var o = e.join(""), t = document.location.hostname;
            if (!isNull(t) && t.length > 2 && (t = t.toLowerCase(), t.indexOf(o) >= 0)) return !0
        } catch (n) {
            PutToDebugLogException(2, "common: WbCont", n)
        }
        return !1
    }

    function IsServiceInstalled(e, o) {
        function t(e) {
            function o(e) {
                if (isNull(m) || m.length < 5) return n(e), !1;
                if (t) return !1;
                t = !0, PutToDebugLog(2, "EVENT, common: IsServiceInstalled.CheckWebsocket3 exec: " + e), PutToDebugLog(2, "EVENT, IsServiceInstalled url_3: " + m);
                try {
                    wsocket3 && wsocket3.close && wsocket3.close(), wsocket3 = null, wsocket3 = new WebSocket(m), wsocket3.binaryType = "arraybuffer", wsocket3.onopen = function () {
                        ws3ready = !0, wready = !0, i(wsocket3, 3, m)
                    }, wsocket3.onclose = function () {
                        a(3)
                    }, wsocket3.onerror = function (e) {
                        r(3, e), n("onerror")
                    }, wsocket3.onmessage = function (e) {
                        s(3, e)
                    }, worked = !0
                } catch (o) {
                    PutToDebugLogException(2, "IsServiceInstalled.CheckWebsocket2 failed to connect to: " + m, o), n("onexception")
                }
                isNull(wstimer3) || clearTimeout(wstimer3), wstimer3 = setTimeout(function () {
                    ws3ready || n("ontimer")
                }, srvinstalled_timeout)
            }

            if (isNull(h) || h.length < 5) return n(e, u), !1;
            if (g) return !1;
            g = !0, PutToDebugLog(2, "EVENT, common: IsServiceInstalled.CheckWebsocket2 exec: " + e), PutToDebugLog(2, "EVENT, IsServiceInstalled url_2: " + h);
            try {
                wsocket2 && wsocket2.close && wsocket2.close(), wsocket2 = null, wsocket2 = new WebSocket(h), wsocket2.binaryType = "arraybuffer", wsocket2.onopen = function () {
                    ws2ready = !0, wready = !0, i(wsocket2, 2, h)
                }, wsocket2.onclose = function () {
                    a(2)
                }, wsocket2.onerror = function (e) {
                    r(2, e), o("onerror")
                }, wsocket2.onmessage = function (e) {
                    s(2, e)
                }, worked = !0
            } catch (l) {
                PutToDebugLogException(2, "IsServiceInstalled.CheckWebsocket2 failed to connect to: " + h, l), o("onexception")
            }
            isNull(wstimer2) || clearTimeout(wstimer2), wstimer2 = setTimeout(function () {
                ws2ready || o("ontimer")
            }, srvinstalled_timeout);
            var t = !1
        }

        function n(e, o) {
            try {
                if (!0 === NSMacLinEnabled()) return PutToDebugLog(2, "EVENT, IsServiceInstalled.CheckHttpPolling returned FLASE because http polling is not available on: " + GetOs()), ExecSrvInstalledCallback(!1), !1;
                PutToDebugLog(2, "EVENT, common: IsServiceInstalled.CheckHttpPolling exec: " + e + "; addr: " + u);
                var t = "";
                if (!isNull(o) && o.length > 5 && (t = o), isNull(t) || t.length < 5) for (var n = 0; n < l.length; n++) if (!(isNull(l[n]) || !0 === IsHttps && l[n].indexOf("wss://") < 0)) {
                    t = l[n];
                    break
                }
                t = t.toLowerCase(), t = t.replace("wss:", "https:"), t = t.replace("ws:", "http:"), t = t.replace("msstwebsock", "extcmd_test"), !0 === IsHttps() && (t = t.replace("http:", "https:")), PutToDebugLog(2, "EVENT, IsServiceInstalled try ajax, url: " + t), webphone_api.$.ajax(t).done(function (e, o, t) {
                    if (wready = !0, PutToDebugLog(2, "EVENT, common: IsServiceInstalled ajax connected, status: " + o + "; msg: " + e), !isNull(e) && (e = e.toLowerCase(), e.indexOf("error") < 0)) {
                        var n = e.indexOf("apiresult:");
                        if (n > 0 && (e = e.substring(n + 10)), !isNull(e) && e.length > 0) if (e.indexOf("version") < 0) PutToDebugLog(2, "EVENT, common: IsServiceInstalled.onmessage, service upgrade needed(1): " + GetMinServiceVersion().toString()), setTimeout(function () {
                            EngineForcedInstall("ns", webphone_api.stringres.get("service_update")), webphone_api.global.nsupdatepending = !0
                        }, 5e3); else {
                            var i = e.substring(e.indexOf("version") + 7);
                            isNull(i) && (i = ""), i = i.replace(":", ""), i = Trim(i), i.indexOf(" ") > 0 && (i = Trim(i.substring(0, i.indexOf(" ")))), !isNull(i) && IsNumber(i) && SaveParameter("srvupgrade_currversion_extcmd_test", i)
                        }
                    }
                    return PutToDebugLog(2, "EVENT, common: IsServiceInstalled AJAX it is installed"), ExecSrvInstalledCallback(!0), !0
                }).fail(function (e, o, t) {
                    return wready = !1, PutToDebugLog(2, "EVENT, Note: it is not a webphone bug if the connection attempt will fail. We are just checking the availability of the local NS engine here"), PutToDebugLog(2, "EVENT, common: IsServiceInstalled ajax failed, status: " + o + "; error: " + t), ExecSrvInstalledCallback(!1), !1
                })
            } catch (i) {
                return PutToDebugLogException(2, "IsServiceInstalled.CheckHttpPolling", i), ExecSrvInstalledCallback(!1), !1
            }
        }

        function i(e, o, t) {
            if (PutToDebugLog(2, "EVENT, common: IsServiceInstalled.onopen, connection ready: " + o + "; addr: " + t), SaveParameter("last_good_ns_plugin_url", t), isNull(e)) return void PutToDebugLog(2, "ERROR, common: IsServiceInstalled.onopen websocket is NULL");
            if (e !== wsocket && e !== wsocket2 && e !== wsocket3) return void PutToDebugLog(2, "ERROR, common: IsServiceInstalled.onopen invalid websocket connection");
            e === wsocket ? (void 0 !== wsocket && null !== wsocket || PutToDebugLog(2, "ERROR, _common: IsServiceInstalled wsocket is NULL"), wsocket.send("extcmd_test")) : e === wsocket2 ? (void 0 !== wsocket2 && null !== wsocket2 || PutToDebugLog(2, "ERROR, _common: IsServiceInstalled wsocket2 is NULL"), wsocket2.send("extcmd_test")) : e === wsocket3 && (void 0 !== wsocket3 && null !== wsocket3 || PutToDebugLog(2, "ERROR, _common: IsServiceInstalled wsocket3 is NULL"), wsocket3.send("extcmd_test"));
            var n = GetEngine("ns");
            return n.isinstalled_cache = 2, SetEngine("ns", n), ExecSrvInstalledCallback(!0), !0
        }

        function a(e) {
            return PutToDebugLog(2, "EVENT, common: IsServiceInstalled.onclose, connection closed: " + e), !1
        }

        function r(e, o) {
            var t = "";
            if (void 0 !== o && null !== o) try {
                t = JSON.stringify(o)
            } catch (n) {
                t = o.toString()
            }
            PutToDebugLog(2, "EVENT, Note: it is not a webphone bug if the connection attempt will fail. We are just checking the availability of the local NS engine here"), PutToDebugLog(2, "EVENT, common: IsServiceInstalled.onerror: " + e + ": " + t)
        }

        function s(e, o) {
            var t = null;
            if (isNull(o) || isNull(o.data) || (t = ArrayBufferToString(o.data)), !isNull(wsocket) && wsocket.close && (wsocket.close(), PutToDebugLog(2, "EVENT, common: IsServiceInstalled.onmessage websocket closed_1")), wsocket = null, !isNull(wsocket2) && wsocket2.close && (wsocket2.close(), PutToDebugLog(2, "EVENT, common: IsServiceInstalled.onmessage websocket closed_2")), wsocket2 = null, !isNull(wsocket3) && wsocket3.close && (wsocket3.close(), PutToDebugLog(2, "EVENT, common: IsServiceInstalled.onmessage websocket closed_3")), wsocket3 = null, !isNull(t) && (PutToDebugLog(2, "EVENT, common: IsServiceInstalled.onmessage, received data: " + e + ": " + t), t = t.toLowerCase(), t.indexOf("error") < 0 && t.indexOf("extcmd_test") >= 0)) {
                var n = t.indexOf("apiresult:");
                if (n > 0 && (t = t.substring(n + 10)), !isNull(t) && t.length > 0) if (t.indexOf("version") < 0) PutToDebugLog(2, "EVENT, common: IsServiceInstalled.onmessage, service upgrade needed(2): " + GetMinServiceVersion().toString()), setTimeout(function () {
                    EngineForcedInstall("ns", webphone_api.stringres.get("service_update")), webphone_api.global.nsupdatepending = !0
                }, 5e3); else {
                    var i = t.substring(t.indexOf("version") + 7);
                    isNull(i) && (i = ""), i = i.replace(":", ""), i = Trim(i), i.indexOf(" ") > 0 && (i = Trim(i.substring(0, i.indexOf(" ")))), !isNull(i) && IsNumber(i) && SaveParameter("srvupgrade_currversion_extcmd_test", i)
                }
            }
            return ExecSrvInstalledCallback(!0), !0
        }

        if (!0 === IsWinMacLinNsTest()) return e(!0), !0;
        var l = null;
        try {
            if (e && "function" == typeof e || (e = function () {
            }), "Windows" !== GetOs() && !IsMacLin() || IsMacLin() && !1 === NSMacLinEnabled()) return e(!1), !1;
            if (void 0 !== srvinstalled_callback && null !== srvinstalled_callback || (srvinstalled_callback = []), srvinstalled_callback.push(e), "0" === GetParameter2("enginepriority_ns") || "5" === GetParameter2("enginepriority_java") || "5" === GetParameter2("enginepriority_webrtc") || "5" === GetParameter2("enginepriority_flash") || "5" === GetParameter2("enginepriority_app") || "5" === GetParameter2("enginepriority_p2p") || "5" === GetParameter2("enginepriority_accessnum") || "5" === GetParameter2("enginepriority_nativedial")) return PutToDebugLog(2, "EVENT, IsServiceInstalled returned FLASE because of priority"), ExecSrvInstalledCallback(!1), !1;
            if (!0 !== o) {
                var p = GetLastUsedEngine(), c = GetParameterInt("enginepriority_ns", 2);
                if (!isNull(p) && p.length > 0 && p !== webphone_api.global.ENGINE_SERVICE && c <= 2) return PutToDebugLog(2, "EVENT, IsServiceInstalled returned FLASE because of priority2"), ExecSrvInstalledCallback(!1), !1
            }
            if (wready) return PutToDebugLog(2, "EVENT, IsServiceInstalled returned TRUE already checked"), ExecSrvInstalledCallback(!0), !0;
            if (lastCheckTick > 0 && GetTickCount() - lastCheckTick < 2e3) return void ((isNull(srvinstalled_callback) || srvinstalled_callback.length < 2) && (PutToDebugLog(2, "EVENT, IsServiceInstalled skip because recently checked: " + wready.toString()), ExecSrvInstalledCallback(wready ? !0 : !1)));
            if (lastCheckTick = GetTickCount(), l = GetNsPluginWsUrl(), isNull(l) || l.length < 1) return PutToDebugLog("ERROR, IsServiceInstalled win failed, address list is empty"), ExecSrvInstalledCallback(!1), !1;
            var u = l[0], h = "", m = "";
            l.length > 1 && (h = l[1]), l.length > 2 && (m = l[2]), PutToDebugLog(2, "EVENT, IsServiceInstalled url_1: " + u);
            try {
                wsocket && wsocket.close && wsocket.close(), wsocket = null, wsocket = new WebSocket(u), wsocket.binaryType = "arraybuffer", wsocket.onopen = function () {
                    ws1ready = !0, wready = !0, i(wsocket, 1, u)
                }, wsocket.onclose = function () {
                    a(1)
                }, wsocket.onerror = function (e) {
                    r(1, e), t("onerror")
                }, wsocket.onmessage = function (e) {
                    s(1, e)
                }, worked = !0
            } catch (d) {
                PutToDebugLogException(2, "IsServiceInstalled failed to connect to: " + u, d), t("onexception")
            }
            isNull(wstimer1) || clearTimeout(wstimer1), wstimer1 = setTimeout(function () {
                ws1ready || t("ontimer")
            }, srvinstalled_timeout);
            var g = !1
        } catch (b) {
            return PutToDebugLogException(2, "common: ServiceInstalled", b), e && "function" == typeof e && e(!1), !1
        }
    }

    function ExecSrvInstalledCallback(e) {
        try {
            if (void 0 === srvinstalled_callback || null === srvinstalled_callback || srvinstalled_callback.length < 1) return;
            for (; srvinstalled_callback.length > 0;) try {
                var o = srvinstalled_callback.shift();
                if ("function" != typeof o || null === o) continue;
                o(e)
            } catch (t) {
                PutToDebugLogException(2, "common: ExecSrvInstalledCallback inner while", t);
                continue
            }
        } catch (t) {
            PutToDebugLogException(2, "common: ExecSrvInstalledCallback", t)
        }
        srvinstalled_callback = null, srvinstalled_callback = []
    }

    function ServiceStartPolling() {
        try {
            if (stopPolling) return;
            PutToDebugLog(5, "EVENT, common: ServiceStartPolling"), IsServiceInstalled(function (e) {
                webphone_api.global.phonestarted < 3 && (!1 === e ? setTimeout(function () {
                    ServiceStartPolling()
                }, 1e3) : (SaveParameter("lastusedengine", "ns"), webphone_api.startInner(), !1 === IsSDK() && webphone_api.$.mobile.changePage("#page_dialpad", {
                    transition: "pop",
                    role: "page"
                })))
            }, !0)
        } catch (e) {
            PutToDebugLogException(2, "common: ServiceStartPolling", e)
        }
    }

    function ApplyParameters(e) {
        try {
            if (!isNull(e)) {
                var o;
                for (o in e) if (!isNull(o) && o.length > 0 && !isNull(e[o])) {
                    if ("loglevel" === o && !1 === ParameterIsDefault("loglevel")) continue;
                    var t = o;
                    "aec" === t ? t = "aec_orig" : "agc" === t ? t = "agc_orig" : "denoise" === t ? t = "denoise_orig" : "plc" === t ? t = "plc_orig" : "sippassword" === t && (t = "password");
                    var n = Trim(e[o]);
                    0 === n.indexOf("encrypted__3__") && (n = StrDc(n, GetPassphrase())), webphone_api.setparameter(t, n), "serveraddress" === o ? (SaveParameter("serveraddress_user", n), "true" === GetParameter("serverinputisupperserver") ? SaveParameter("upperserver", n) : SaveParameter("serveraddress_orig", n)) : SaveParameter(o, n)
                }
            }
        } catch (i) {
            PutToDebugLogException(2, "common: ApplyParameters", i)
        }
    }

    function GetEngineDisplayName(e) {
        var o = "";
        try {
            if (isNull(e) || e.length < 1) return "";
            switch (e) {
                case "java":
                    o = "Java";
                    break;
                case "ns":
                    o = "NS - Service Plugin";
                    break;
                case "webrtc":
                    o = "WebRTC";
                    break;
                case "flash":
                    o = "Flash";
                    break;
                case "app":
                    o = "App - Native Application";
                    break;
                case "p2p":
                    o = "Phone to Phone";
                    break;
                case "accessnum":
                    o = "Access Number";
                    break;
                case "nativedial":
                    o = "Native Dialer";
                    break;
                case "otherbrowser":
                    o = "Alternate Browser"
            }
            return o
        } catch (t) {
            PutToDebugLogException(2, "common: GetEngineDisplayName", t)
        }
        return ""
    }

    function ChooseEngineLogic2(e) {
        try {
            if (GetParameter("devicetype") !== DEVICE_WEBPHONE()) return;
            if (isNull(e) || e.length < 1) return void PutToDebugLog(2, "ERROR, ChooseEngineLogic2 invalid engine");
            if ("java" === e) return void (IsJavaInstalled() < 1 && InstallJavaPopup(!0));
            if ("ns" !== e) return;
            var o = GetEngine("ns");
            o.isinstalled_cache < 0 ? IsServiceInstalled(function (e) {
                !1 === e && NPDownloadAndInstall()
            }, !0) : 0 === o.isinstalled_cache && NPDownloadAndInstall()
        } catch (t) {
            PutToDebugLogException(2, "common: ChooseEngineLogic2", t)
        }
    }

    function ChooseEngineLogic(e, o) {
        try {
            if (PutToDebugLog(4, "EVENT, ChooseEngineLogic; isstart: " + o), !1 === Glsp()) return void PutToDebugLog(2, "WARNING, ChooseEngineLogic wait");
            if (Glv() <= 0 && "Chrome" === GetBrowser()) {
                var t = [];
                t.push("E"), t.push("R"), t.push("R"), t.push("O"), t.push("R"), t.push(","), t.push(" "), t.push("T"), t.push("h"), t.push("e"), t.push(" "), t.push("B"), t.push("a"), t.push("s"), t.push("i"), t.push("c"), t.push(" "), t.push("v"), t.push("e"), t.push("r"), t.push("s"), t.push("i"), t.push("o"), t.push("n"), t.push(" "), t.push("o"), t.push("f"), t.push(" "), t.push("W"), t.push("e"), t.push("b"), t.push("p"), t.push("h"), t.push("o"), t.push("n"), t.push("e"), t.push(" "), t.push("d"), t.push("o"), t.push("e"), t.push("s"), t.push(" "), t.push("n"), t.push("o"), t.push("t"), t.push(" "), t.push("s"), t.push("u"), t.push("p"), t.push("p"), t.push("o"), t.push("r"), t.push("t"), t.push(" "), t.push("C"), t.push("h"), t.push("r"), t.push("o"), t.push("m"), t.push("e"), t.push(" "), t.push("b"), t.push("r"), t.push("o"), t.push("w"), t.push("s"), t.push("e"), t.push("r"), t.push("_");
                var n = t.join("");
                return setTimeout(function () {
                    PutToDebugLog(1, n)
                }, 1400), setTimeout(function () {
                    AlertDialog("", n)
                }, 2400), void e(!1)
            }
            var i = "", a = GetSelectedEngine(), r = GetRecommendedEngine();
            if (!isNull(a) && a.name === webphone_api.global.ENGINE_SERVICE && -3 === GetMinServiceVersion()) return PutToDebugLog(2, "EVENT, ChooseEngineLogic: " + a.name + "; install popup is disabled by minserviceversion: " + GetMinServiceVersion().toString()), void e();
            if (!0 === o) {
                var s = GetSinglePossibleEngine();
                if (!isNull(a) && a.name === webphone_api.global.ENGINE_APP || s === webphone_api.global.ENGINE_APP) return GetParameterInt("enginepriority_app", 2) < 1 ? void (!0 === webphone_api.global.usestorage || Strl(60) ? (PutToDebugLog(1, "WARNING," + webphone_api.stringres.get("only_app_engine1")), AlertDialog("Warning", webphone_api.stringres.get("only_app_engine1"))) : (PutToDebugLog(1, "WARNING," + webphone_api.stringres.get("only_app_engine2")), AlertDialog("Warning", webphone_api.stringres.get("only_app_engine2")))) : (PutToDebugLog(2, "EVENT, Selected only possible engine: " + webphone_api.global.ENGINE_APP), selected_engine = GetEngine(webphone_api.global.ENGINE_APP), void e());
                if (!isNull(a) && a.name === webphone_api.global.ENGINE_SERVICE || s === webphone_api.global.ENGINE_SERVICE) {
                    var l = GetParameterInt("enginepriority_ns", 2);
                    return l < 1 ? void ("Windows" === GetOs() && a.name === webphone_api.global.ENGINE_WEBPHONE ? (PutToDebugLog(1, "WARNING," + webphone_api.stringres.get("only_ns_engine3")), AlertDialog("Warning", webphone_api.stringres.get("only_ns_engine3"))) : !0 === webphone_api.global.usestorage || Strl(60) ? (PutToDebugLog(1, "WARNING," + webphone_api.stringres.get("only_ns_engine1")), AlertDialog("Warning", webphone_api.stringres.get("only_ns_engine1"))) : (PutToDebugLog(1, "WARNING," + webphone_api.stringres.get("only_ns_engine2")), AlertDialog("Warning", webphone_api.stringres.get("only_ns_engine2")))) : (PutToDebugLog(2, "EVENT, Selected only possible engine: " + webphone_api.global.ENGINE_SERVICE), selected_engine = GetEngine(webphone_api.global.ENGINE_SERVICE), e(), void (5 !== l && IsServiceInstalled(function (e) {
                        if (!1 === e) {
                            var o = GetParameterBool("wpfirststart", !0), t = GetParameterInt("prev_sess_failed", 0);
                            (!0 === o || t < 1 || t > 1) && (PutToDebugLog(2, "EVENT, common: ChooseEngineLogic, install service: " + GetMinServiceVersion().toString()), EngineForcedInstall("ns"))
                        }
                    }, !0)))
                }
                if (!isNull(a) && a.name === webphone_api.global.ENGINE_WEBPHONE && 0 == CanIUseApplet() && s === webphone_api.global.ENGINE_WEBRTC && GetParameterInt("enginepriority_java", 2) > GetParameterInt("enginepriority_webrtc", 2) + 1) return void ("Windows" === GetOs() ? (PutToDebugLog(1, "WARNING," + webphone_api.stringres.get("only_ns_engine3")), AlertDialog("Warning", webphone_api.stringres.get("only_ns_engine3"))) : (PutToDebugLog(1, "WARNING," + webphone_api.stringres.get("only_ns_engine4")), AlertDialog("Warning", webphone_api.stringres.get("only_ns_engine4"))))
            }
            var p = -1, c = -1, u = "", h = "", m = "";
            !0 !== IsSDK() && (m = webphone_api.$.mobile.activePage.attr("id"));
            var g = m.indexOf("page_");
            if (g >= 0 && (m = m.substring(g + 5)), isNull(a) || (p = a.pushlevel, u = a.name), isNull(r) || (c = r.pushlevel, h = r.name), PutToDebugLog(4, "EVENT, ChooseEngineLogic selected engine> " + u + " pushlevel: " + p), PutToDebugLog(4, "EVENT, ChooseEngineLogic recommended engine> " + h + " pushlevel: " + c), PutToDebugLog(4, "EVENT, ChooseEngineLogic active page: " + m), webphone_api.global.isdebugengine && (p = 3, c = 3, u = "ns", h = "webrtc"), "Android" !== GetOs() && "iOS" !== GetOs() || "app" === u && (isNull(h) || h.length < 1) && (p = 6), p < 3 && c < 3) return PutToDebugLog(4, "EVENT, ChooseEngineLogic return callback"), void e(!1);
            var d = GetNPLocation(),
                b = '<a href="' + d + '" target="_blank" id="adialog_nativeplugin">' + webphone_api.stringres.get("nativeplugin") + "</a>";
            PutToDebugLog(5, "EVENT, common ChooseEngineLogic nplink: " + b);
            var _ = webphone_api.stringres.get("ce_installnativeplugin");
            _ = _.replace("[NATIVE_PLUGIN]", b);
            var f = !1, w = !1,
                v = 'Enable Java in your browser or enable from the settings( <a href="' + webphone_api.global.ENABLE_JAVA_URL + '" id="click_enable_java" target="_blank">How to enable Java ?</a>)',
                E = 'Install Java from <a href="' + webphone_api.global.INSTALL_JAVA_URL + '" id="click_install_java" target="_blank">here.</a>',
                T = '<a href="' + GetNPLocation() + '" target="_blank" id="adialog_nativeplugin">Install ' + webphone_api.stringres.get("nativeplugin") + "</a>",
                P = "For best experience: ",
                S = '<a href="javascript:;" id="click_use_webrtc" target="_blank">Use WebRTC.</a>',
                N = 'Use <a href="[BWURL]" id="click_use_alternatebrowser" target="_blank">alternate browser.</a>',
                I = "", C = 'Use <a href="javascript:;" id="click_use_p2p">phone to phone</a> server initiated call.',
                R = 'Call <a href="javascript:;" id="click_use_accessnumber">access number</a> using native dialer.',
                y = '<a href="javascript:;" id="click_use_internetexplorer">use Internet Explorer</a>';
            if ("iOS" === GetOs()) {
                var L = GetParameter("ios_nativedialerurl");
                if ((isNull(L) || L.length < 3) && (L = "https://itunes.apple.com/ro/app/mizuphone/id483685573"), i = "", ("Safari" === GetBrowser() || "iPhone" === GetBrowser()) && GetBrowserVersion() < 11) i = "&SmallCircle; " + webphone_api.stringres.get("ce_native_ios_safari") + ' <a href="javascript:;" id="click_use_app">' + webphone_api.stringres.get("ce_native_ios2") + "</a><br /><br />"; else {
                    try {
                        var D = webphone_api.platform.os;
                        if (!isNull(D) && D.length > 0 && (D = Trim(D), D.indexOf(" ") > 0)) {
                            D = D.substring(D.indexOf(" ") + 1), D.indexOf(".") > 0 && (D = D.substring(0, D.indexOf("."))), D = Trim(D);
                            var G = StrToIntDef(D, -1);
                            G > 0 && G >= 11 && (i = "&SmallCircle; " + webphone_api.stringres.get("ce_native_ios_not_safari") + ' <a href="javascript:;" id="click_use_app">' + webphone_api.stringres.get("ce_native_ios2") + "</a><br /><br />")
                        }
                    } catch (k) {
                        PutToDebugLogException(2, "common: ChooseEngineLogic inner iOS", k)
                    }
                    i.length < 1 && (i = "&SmallCircle; " + webphone_api.stringres.get("ce_native_ios_safari") + ' <a href="javascript:;" id="click_use_app">' + webphone_api.stringres.get("ce_native_ios2") + "</a><br /><br />")
                }
            } else if ("Android" === GetOs()) {
                if (GetBrowserVersion() < 40) {
                    if (GetParameterInt("enginepriority_otherbrowser", 2) > 0) {
                        var O = GetConfig("android_aletrnatebrowserurl");
                        (isNull(O) || O.length < 5) && (O = webphone_api.global.android_aletrnatebrowserurl_DEF), i = i + "&SmallCircle; " + webphone_api.stringres.get("ce_browser_install") + ' <a href="' + O + '" target="_blank">' + webphone_api.stringres.get("ce_browser_alternate") + "</a>", i += "<br /><br />"
                    }
                } else i = i + '&SmallCircle; <a href="javascript:;" id="click_use_webrtc">' + webphone_api.stringres.get("ce_usewebrtc") + "</a>", (webphone_api.global.recwsload < 0 || webphone_api.global.recwsload > 2) && (i = i + " " + webphone_api.stringres.get("ce_webrtcnot")), i += "<br /><br />";
                "app" === u && GetParameterInt("enginepriority_app", 2) > 0 && (i = i + '&SmallCircle; <a href="javascript:;" id="click_use_app">' + webphone_api.stringres.get("ce_native_android") + "</a>")
            } else {
                if (3 === p || 4 === p || 5 === p || 6 === p) {
                    if ("java" === u) {
                        var x = IsJavaInstalled();
                        0 === x ? (6 === p && (f = !0), "MSIE" === GetBrowser() && (i = i + v + " OR "), i = i + E + "<br><br>") : 1 === x && (6 === p && (f = !0), i = i + v + "<br><br>")
                    } else if ("ns" !== u || webphone_api.global.isdebugengine) if ("otherbrowser" === u) {
                        var O = "";
                        O = GetParameter("Windows" === GetOs() ? "pc_alternatebrowserurl" : "pc_alternatebrowserurl"), N = N.replace("[BWURL]", O), i += P, i = i + N + "<br>", I.length > 0 && (i = i + I.replace("[ENGINE]", A) + "<br>"), i += "<br>"
                    } else "p2p" === u ? i = i + C + "<br><br>" : "accessnum" === u && (i = i + R + "<br><br>"); else !isNull(selected_engine) && selected_engine.isinstalled_cache < 2 ? (6 === p && (f = !0), i = i + T + "<br><br>") : e(!1);
                    "Edge" === GetBrowser() && (i += P, i = i + y + "<br><br>")
                }
                if (3 === c || 4 === c || 5 === c || 6 === c) {
                    if (6 === c && (f = !0), 3 === c && "settings" !== m) return void UserChooseEnginePopup(i, f, w, e);
                    if ("true" === GetParameter("ignoreengineselect")) return void UserChooseEnginePopup(i, f, w, e);
                    var A = GetEngineDisplayName(u);
                    if (I = A.length > 0 ? I.replace("[ENGINE]", A) : "", w = !0, "java" === h) {
                        var x = IsJavaInstalled();
                        0 === x ? "MSIE" === GetBrowser() ? (i += P, i = i + v + " OR ", i = i + E + "<br>", I.length > 0 && (i = i + I.replace("[ENGINE]", A) + "<br>"), i += "<br>") : (i += P, i = i + E + "<br>", I.length > 0 && (i = i + I.replace("[ENGINE]", A) + "<br>"), i += "<br>") : 1 === x && (i += P, i = i + v + "<br>", I.length > 0 && (i = i + I.replace("[ENGINE]", A) + "<br>"), i += "<br>")
                    } else if ("ns" === h) recommend_engine.isinstalled_cache < 2 && (i += P, i = i + T + "<br>", I.length > 0 && (i = i + I.replace("[ENGINE]", A) + "<br>"), i += "<br>"); else if ("webrtc" === h) i = i + S + "<br>", I.length > 0 && (i = i + I.replace("[ENGINE]", A) + "<br>"), i += "<br>"; else if ("app" === h) {
                        if (GetParameterInt("enginepriority_otherbrowser", 2) > 0) {
                            var O = "";
                            O = GetParameter("Windows" === GetOs() ? "pc_alternatebrowserurl" : "pc_alternatebrowserurl"), N = N.replace("[BWURL]", O), i += P, i = i + N + "<br>", I.length > 0 && (i = i + I.replace("[ENGINE]", A) + "<br>"), i += "<br>"
                        }
                    } else "p2p" === h ? i = i + C + "<br><br>" : "accessnum" === h ? i = i + R + "<br><br>" : "nativedial" === h && (i += 'Direct call with <a href="javascript:;" id="click_use_nativedialer">native dialer</a>.<br><br>');
                    "Edge" === GetBrowser() && i.indexOf(y) < 1 && (i += P, i = i + y + "<br><br>")
                }
            }
            webphone_api.global.isdebugengine && (I = I.replace("[ENGINE]", "JAVA"), i = E + "<br><br>", i += P, i = i + T + "<br>", I.length > 0 && (i = i + I.replace("[ENGINE]", A) + "<br>"), i += "<br>", i += P, i = i + S + "<br>", I.length > 0 && (i = i + I.replace("[ENGINE]", A) + "<br>"), i += "<br>", O = GetParameter("pc_alternatebrowserurl"), N = N.replace("[BWURL]", O), i += P, i = i + N + "<br><br>", i = i + C + "<br><br>", i += P, i = i + y + "<br><br>", f = !0, w = !1), UserChooseEnginePopup(i, f, w, e)
        } catch (U) {
            PutToDebugLogException(2, "common: ChooseEngineLogic", U)
        }
    }

    function UserChooseEnginePopupSDK(e, o, t, n, i) {
        try {
            PutToDebugLog(4, "EVENT, UserChooseEnginePopupSDK");
            var a = !1;
            if (isNull(e) || e.length < 2) return void n(!1);
            var r = '<span style="width: 100%; display: inline-block; background: #eeeeee; padding-top: 1.2em; padding-bottom: 1.2em;">',
                s = "", l = e.split("<br><br>"), p = 0;
            if (!isNull(l) && l.length > 0) for (var c = 0; c < l.length; c++) isNull(l[c]) || l[c].length < 3 || (s += '<div style="margin:0; padding:0; border:0; width:100%; height: .1em; clear:both; background: #dddddd;">\x3c!--//--\x3e</div>', s = s + r + "&nbsp;&nbsp;&nbsp;" + l[c] + "</span>", p++); else s = r + "&nbsp;&nbsp;&nbsp;" + e + "</span>";
            var u = webphone_api.stringres.get("choose_engine_title");
            p < 2 && (u = webphone_api.stringres.get("choose_engine_title_single_engine")), s = '<div id="adialog_formattedmsg" style="display: inline-block; width: 100%;">' + s + "</div>";
            var h = "";
            if (h = '<div id="checkbox_ignore_container" style="width: 100%; background: #eeeeee; height: 3.5em; line-height: 3.5em; border-top: .1em solid #dddddd; border-bottom: .1em solid #dddddd; text-align: right;"><label for="checkbox_ignore">' + webphone_api.stringres.get("ce_dontask") + '&nbsp;&nbsp;</label><input name="checkbox_ignore" id="checkbox_ignore" type="checkbox">&nbsp;&nbsp;&nbsp;</div>', !isNull(cemodal)) return void cemodal.show();
            cemodal = webphone_api.picoModal({
                content: '<div id="ce_modal" class="pmodal_container" style="height: 100%;"><div id="ce_modal_header" class="pmodal_header">' + u + '</div><div id="ce_modal_content" class="pmodal_content"><div id="ce_modal_content_inner">' + s + "</div>" + h + '</div><div id="ce_modal_footer" class="pmodal_footer"><button id="btn_close_adialog">' + webphone_api.stringres.get("btn_close") + "</button></div></div>",
                overlayStyles: { backgroundColor: "#565656", opacity: .6 },
                modalStyles: { width: "20em" },
                closeButton: !1,
                overlayClose: !1,
                closeStyles: {
                    background: "#eeeeee",
                    position: "absolute",
                    top: ".2em",
                    right: ".3em",
                    textAlign: "center",
                    fontSize: "1.2em",
                    fontWeight: "bold",
                    border: ".15em solid #bbb",
                    borderRadius: ".8em",
                    paddingLeft: ".25em",
                    paddingRight: ".25em",
                    cursor: "pointer"
                }
            }).afterCreate(function (e) {
            }).beforeShow(function (e, o) {
            }).afterShow(function (e) {
                try {
                    var o = webphone_api.$("#ce_modal").height() - webphone_api.$("#ce_modal_header").height() - webphone_api.$("#ce_modal_footer").height() - 1;
                    webphone_api.$("#ce_modal_content").height(o), webphone_api.$("#ce_modal_content_inner").height(o - webphone_api.$("#checkbox_ignore_container").height() - 5);
                    var t = webphone_api.$("#ce_modal_content_inner").height() - webphone_api.$("#adialog_formattedmsg").height();
                    webphone_api.$("#adialog_formattedmsg").css("margin-top", t / 2)
                } catch (n) {
                    PutToDebugLogException(2, "common: UserChooseEnginePopupSDK afterShow", n)
                }
            }).beforeClose(function (e, o) {
            }).afterClose(function (e) {
                e.destroy(), cemodal = null, (!1 === a || "MSIE" === GetBrowser() && IsJavaInstalled() < 2 || "flash" === GetSelectedEngineName()) && (PutToDebugLog(3, "EVENT, UserChooseEngine callback onclose"), a = !0, EngineSelect(1), n(!0))
            }), cemodal.show(), o && webphone_api.$("#ce_modal_footer").hide(), webphone_api.$("#checkbox_ignore").on("change", function (e) {
                webphone_api.$(this).prop("checked") ? SaveParameter("ignoreengineselect", "true") : SaveParameter("ignoreengineselect", "false")
            }), webphone_api.$("#click_use_alternatebrowser").on("click", function () {
                a = !0, webphone_api.flagrestartwebrtc = !1, cemodal.close()
            }), webphone_api.$("#click_enable_java").on("click", function () {
                a = !0, webphone_api.flagrestartwebrtc = !1, cemodal.close(), ResetEngineClicked();
                var e = GetEngine("java");
                e.clicked = 2, SetEngine("java", e)
            }), webphone_api.$("#click_install_java").on("click", function () {
                a = !0, webphone_api.flagrestartwebrtc = !1, cemodal.close(), ResetEngineClicked();
                var e = GetEngine("java");
                e.clicked = 2, SetEngine("java", e), setTimeout(function () {
                    InstallJavaPopup(!1)
                }, 400)
            }), webphone_api.$("#adialog_nativeplugin").on("click", function () {
                a = !0, webphone_api.flagrestartwebrtc = !1, cemodal.close(), ResetEngineClicked();
                var e = GetEngine("ns");
                e.clicked = 2, SetEngine("ns", e), setTimeout(function () {
                    NPDownloadAndInstall()
                }, 400);
                var o = GetNPLocation();
                !isNull(o) && o.length > 0 && window.open(o)
            }), webphone_api.$("#click_use_webrtc").on("click", function () {
                a = !0, webphone_api.flagrestartwebrtc = !0, cemodal.close(), ResetEngineClicked();
                var e = GetEngine("webrtc");
                e.clicked = 2, SetEngine("webrtc", e), EngineSeengineprioritylect(1), n(!0)
            }), webphone_api.$("#click_use_p2p").on("click", function () {
                a = !0, webphone_api.flagrestartwebrtc = !1, cemodal.close(), ResetEngineClicked();
                var e = GetEngine("p2p");
                e.clicked = 2, SetEngine("p2p", e), EngineSelect(1), n(!0)
            }), webphone_api.$("#click_use_accessnumber").on("click", function () {
                a = !0, webphone_api.flagrestartwebrtc = !1, cemodal.close(), ResetEngineClicked();
                var e = GetEngine("accessnum");
                e.clicked = 2, SetEngine("accessnum", e), EngineSelect(1), n(!0)
            }), webphone_api.$("#click_use_nativedialer").on("click", function () {
                a = !0, webphone_api.flagrestartwebrtc = !1, cemodal.close(), ResetEngineClicked();
                var e = GetEngine("nativedial");
                e.clicked = 2, SetEngine("nativedial", e), EngineSelect(1), n(!0)
            }), webphone_api.$("#click_use_app").on("click", function () {
                SaveParameter("allow_start_app_engine", "1"), a = !0, webphone_api.flagrestartwebrtc = !1, cemodal.close(), ResetEngineClicked();
                var e = GetEngine("app");
                e.clicked = 2, SetEngine("app", e), StartAppEngine(!1, "")
            }), webphone_api.$("#click_use_internetexplorer").on("click", function () {
                a = !0, webphone_api.flagrestartwebrtc = !1, cemodal.close()
            }), webphone_api.$("#btn_close_adialog").on("click", function () {
                PutToDebugLog(5, "EVENT, common UserChooseEngineSDK close on click"), cemodal.close(), (o || !1 === a) && (PutToDebugLog(3, "EVENT, UserChooseEngineSDK callback"), EngineSelect(1), a = !0, n(!0))
            })
        } catch (m) {
            PutToDebugLogException(2, "common: UserChooseEnginePopupSDK", m)
        }
    }

    function UserChooseEnginePopup(e, o, t, n, i) {
        try {
            PutToDebugLog(2, "EVENT, UserChooseEnginePopup message: " + e);
            var a = GetBrowserVersion();
            if ("java" === GetSelectedEngineName() && "Chrome" === GetBrowser() && StrToIntDef(a, 70) > webphone_api.getmaxchromeversionforjava()) {
                PutToDebugLog(2, "EVENT," + webphone_api.stringres.get("jnotsupported") + "_1"), e = webphone_api.stringres.get("jnotsupported");
                var r = GetConfig("pc_alternatebrowserurl");
                return !isNull(r) && r.length > 2 && (e = e + ': <a href="' + r + '" target="_blank">' + r + "</a>"), AlertDialog("Warning", e), void n(!1)
            }
            var s = !1;
            if ("true" === GetParameter("ignoreengineselect")) return void n(!1);
            if (isNull(e) || e.length < 2) return void n(!1);
            if (1 == IsSDK()) return void UserChooseEnginePopupSDK(e, o, t, n, i);
            SaveParameter("enproblem", "1"), PutToDebugLog(4, "EVENT, UserChooseEnginePopup");
            var l = "", p = e.split("<br><br>"), c = 0;
            if (!isNull(p) && p.length > 0) for (var u = 0; u < p.length; u++) isNull(p[u]) || p[u].length < 3 || (l += '<div class="separator_line_chooseengine">\x3c!--//--\x3e</div>', l = l + "<span>&nbsp;&nbsp;&nbsp;" + p[u] + "</span>", c++); else l = "<span>&nbsp;&nbsp;&nbsp;" + e + "</span>";
            var h = webphone_api.stringres.get("choose_engine_title");
            c < 2 && (h = webphone_api.stringres.get("choose_engine_title_single_engine")), l = '<div id="adialog_formattedmsg" style="display: inline-block; width: 100%;">' + l + "</div>";
            var m = "";
            t && !o && (m = '<div id="checkbox_ignore_container"><label for="checkbox_ignore">' + webphone_api.stringres.get("ce_dontask") + '</label><input name="checkbox_ignore" id="checkbox_ignore" type="checkbox"></div>');
            var g = GetDeviceWidth();
            (isNull(g) || g < 10) && (g = 220);
            var d = '<div data-role="popup" id="choose_engine" class="ui-content messagePopup" data-overlay-theme="a" data-theme="a" style="max-width:' + g + "px; width:" + g + "px; margin=0; float:left; height=" + GetDeviceHeight() + 'px;"><div data-role="header" data-theme="b" id="choose_engine_header"><h1 class="adialog_title" style="font-weight: bold;">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;' + h + '</h1></div><div role="main" id="choose_engine_container" class="ui-content adialog_content adialog_alert"><div id="choose_engine_top_section" style="margin: 0em;"><div id="chooseengine_spacer" style="display: inline-block; width: 100%;">&nbsp;</div>' + l + "</div>" + m + '</div><div data-role="footer" data-theme="b" class="adialog_footer" id="choose_engine_footer"><a href="javascript:;" id="adialog_positive" style="width: 100%;" class="ui-btn ui-corner-all ui-shadow ui-btn-inline ui-btn-b adialog_2button" data-rel="back" data-transition="flow">' + webphone_api.stringres.get("btn_close") + "</a></div></div>";
            i = i || function () {
            }, webphone_api.$.mobile.activePage.append(d).trigger("create"), webphone_api.$.mobile.activePage.find(".messagePopup").popup({
                beforeposition: function () {
                    webphone_api.$(".ui-popup-screen").off(), webphone_api.$(this).css({
                        width: window.innerWidth,
                        height: window.innerHeight - 10
                    }), o && webphone_api.$("#choose_engine_footer").hide();
                    var e = GetDeviceHeight() - webphone_api.$("#choose_engine_header").height();
                    webphone_api.$("#choose_engine_footer").is(":visible") && (e -= webphone_api.$("#choose_engine_footer").height()), e = Math.floor(e), webphone_api.$(".messagePopup .ui-content").height(e - Math.floor(.015 * e)), webphone_api.$(".messagePopup .ui-content").css({
                        padding: 0,
                        margin: 0,
                        background: "#ffffff"
                    })
                }, afteropen: function (e, o) {
                    webphone_api.$(this).parent().css({ top: 0, left: 0, position: "absolute" });
                    var t = webphone_api.$("#choose_engine_container").height() - 20;
                    isNull(document.getElementById("checkbox_ignore_container")) || (t -= webphone_api.$("#checkbox_ignore_container").height()), document.getElementById("choose_engine_top_section").style.height = t + "px";
                    var n = t - webphone_api.$("#adialog_formattedmsg").height();
                    document.getElementById("chooseengine_spacer").style.height = Math.floor(n / 2) + "px"
                }
            }), webphone_api.$.mobile.activePage.find(".messagePopup").popup().popup("open").bind({
                popupafterclose: function () {
                    webphone_api.$(this).unbind("popupafterclose").remove(), i(), (!1 === s || "MSIE" === GetBrowser() && IsJavaInstalled() < 2 || "flash" === GetSelectedEngineName()) && (PutToDebugLog(3, "EVENT, UserChooseEngine callback onclose"), EngineSelect(1), s = !0, n(!0))
                }
            }), webphone_api.$("#checkbox_ignore").on("change", function (e) {
                webphone_api.$(this).prop("checked") ? SaveParameter("ignoreengineselect", "true") : SaveParameter("ignoreengineselect", "false")
            }), webphone_api.$("#click_use_alternatebrowser").on("click", function () {
                s = !0, webphone_api.flagrestartwebrtc = !1, webphone_api.$.mobile.activePage.find(".messagePopup").popup("close")
            }), webphone_api.$("#click_enable_java").on("click", function () {
                s = !0, webphone_api.flagrestartwebrtc = !1, webphone_api.$.mobile.activePage.find(".messagePopup").popup("close"), ResetEngineClicked();
                var e = GetEngine("java");
                e.clicked = 2, SetEngine("java", e)
            }), webphone_api.$("#click_install_java").on("click", function () {
                s = !0, webphone_api.flagrestartwebrtc = !1, webphone_api.$.mobile.activePage.find(".messagePopup").popup("close"), ResetEngineClicked();
                var e = GetEngine("java");
                e.clicked = 2, SetEngine("java", e), webphone_api.$("#choose_engine").on("popupafterclose", function (e) {
                    OpenSettings(!0, 5), setTimeout(function () {
                        InstallJavaPopup(!1)
                    }, 400)
                })
            }), webphone_api.$("#adialog_nativeplugin").on("click", function () {
                s = !0, webphone_api.flagrestartwebrtc = !1, webphone_api.$.mobile.activePage.find(".messagePopup").popup("close"), webphone_api.$("#choose_engine").on("popupafterclose", function (e) {
                    ResetEngineClicked();
                    var o = GetEngine("ns");
                    o.clicked = 2, SetEngine("ns", o), setTimeout(function () {
                        NPDownloadAndInstall()
                    }, 400);
                    var t = GetNPLocation();
                    !isNull(t) && t.length > 0 && window.open(t)
                })
            }), webphone_api.$("#click_use_webrtc").on("click", function () {
                s = !0, webphone_api.flagrestartwebrtc = !0, webphone_api.$.mobile.activePage.find(".messagePopup").popup("close"), ResetEngineClicked();
                var e = GetEngine("webrtc");
                e.clicked = 2, SetEngine("webrtc", e), EngineSelect(1), n(!0)
            }), webphone_api.$("#click_use_p2p").on("click", function () {
                s = !0, webphone_api.flagrestartwebrtc = !1, webphone_api.$.mobile.activePage.find(".messagePopup").popup("close"), ResetEngineClicked();
                var e = GetEngine("p2p");
                e.clicked = 2, SetEngine("p2p", e), EngineSelect(1), n(!0)
            }), webphone_api.$("#click_use_accessnumber").on("click", function () {
                s = !0, webphone_api.flagrestartwebrtc = !1, webphone_api.$.mobile.activePage.find(".messagePopup").popup("close"), ResetEngineClicked();
                var e = GetEngine("accessnum");
                e.clicked = 2, SetEngine("accessnum", e), EngineSelect(1), n(!0)
            }), webphone_api.$("#click_use_nativedialer").on("click", function () {
                s = !0, webphone_api.flagrestartwebrtc = !1, webphone_api.$.mobile.activePage.find(".messagePopup").popup("close"), ResetEngineClicked();
                var e = GetEngine("nativedial");
                e.clicked = 2, SetEngine("nativedial", e), EngineSelect(1), n(!0)
            }), webphone_api.$("#click_use_app").on("click", function () {
                SaveParameter("allow_start_app_engine", "1"), s = !0, webphone_api.flagrestartwebrtc = !1, webphone_api.$.mobile.activePage.find(".messagePopup").popup("close"), ResetEngineClicked();
                var e = GetEngine("app");
                e.clicked = 2, SetEngine("app", e), StartAppEngine(!1, "")
            }), webphone_api.$("#click_use_internetexplorer").on("click", function () {
                s = !0, webphone_api.flagrestartwebrtc = !1, webphone_api.$.mobile.activePage.find(".messagePopup").popup("close")
            }), webphone_api.$("#adialog_positive").on("click", function (e) {
                PutToDebugLog(5, "EVENT, common UserChooseEngine close on click"), (o || !1 === s) && (PutToDebugLog(3, "EVENT, UserChooseEngine callback"), EngineSelect(1), s = !0, n(!0))
            })
        } catch (b) {
            PutToDebugLogException(2, "common: UserChooseEnginePopup", b)
        }
    }

    function AppEngineClick() {
        try {
            alert("AppEngineClick")
        } catch (e) {
            PutToDebugLogException(2, "common: AppEngineClick", e)
        }
    }

    function ShowEngineOptionOnPage(e) {
        try {
            if (GetParameter("devicetype") !== DEVICE_WEBPHONE()) return void e("", "");
            if ("true" === GetParameter("ignoreengineselect")) return void e("", "");
            if (isNull(GetSelectedEngine()) && semaxloop < 10) return setTimeout(function () {
                ShowEngineOptionOnPage(e)
            }, 500), void semaxloop++;
            semaxloop = 0;
            var o = GetSelectedEngine(), t = GetRecommendedEngine(), n = -1, i = -1, a = "", r = "";
            isNull(o) || (n = o.pushlevel, a = o.name), isNull(t) || (i = t.pushlevel, r = t.name);
            var s = "Engine is [XXX]. Click here if wish to use [YYY].", l = "";
            webphone_api.global.useengine.length > 0 && a.length > 0 && webphone_api.global.useengine !== a && 2 === n ? (l = s.replace("[XXX]", GetEngineDisplayName(webphone_api.global.useengine)), l = l.replace("[YYY]", GetEngineDisplayName(a)), e(l, a)) : webphone_api.global.useengine.length > 0 && r.length > 0 && webphone_api.global.useengine !== r && 2 === i && (l = s.replace("[XXX]", GetEngineDisplayName(webphone_api.global.useengine)), l = l.replace("[YYY]", GetEngineDisplayName(r)), e(l, r))
        } catch (p) {
            PutToDebugLogException(2, "common: ShowEngineOptionOnPage", p)
        }
        e("", "")
    }

    function GatewayFailower(e, o) {
        try {
            if (gwround++, PutToDebugLog(2, "EVENT,GatewayCheck called: " + o + " (" + gwround + ")"), getuseengine() !== webphone_api.global.ENGINE_WEBRTC) return void PutToDebugLog(2, "EVENT,skip GatewayCheck because not WebRTC (" + gwround + ")");
            if (!1 === webphone_api.global.canfailover_gateway) return void PutToDebugLog(2, "EVENT,skip GatewayCheck because already failowered once in this session (" + gwround + ")");
            if (!1 === IsMizuWebRTCGateway()) return void PutToDebugLog(2, "EVENT,skip GatewayCheck because not Mwebrtc gateway (" + gwround + ")");
            isNull(fail_timer) || clearTimeout(fail_timer), fail_timer = null, e < 0 && (e = 8e3), PutToDebugLog(2, "EVENT,GatewayCheck started checking, delay: " + e.toString() + " (" + gwround + ")"), webphone_api.global.canfailover_gateway = !1, fail_timer = setTimeout(function () {
                try {
                    if ("us" === webphone_api.global.usuk && !1 === webphone_api.global.wsl_uk_rec || "uk" === webphone_api.global.usuk && !1 === webphone_api.global.wsl_us_rec) return void PutToDebugLog(2, "EVENT,skip GatewayCheck because no answers for wsload, UK: " + webphone_api.global.wsl_uk_rec + "; US: " + webphone_api.global.wsl_us_rec + " (" + gwround + ")");
                    if (!1 === IsMizuWebRTCGateway()) return void PutToDebugLog(2, "EVENT,skip GatewayCheck because not Mwebrtc gateway from timer (" + gwround + ")");
                    if (isNull(webphone_api.global.usuk) || webphone_api.global.usuk.length < 1) return void PutToDebugLog(2, "ERROR,skip GatewayCheck failower usuk NOT defined (" + gwround + ")");
                    var e = GetParameter("webrtcserveraddress");
                    if (!isNull(e) && e.length > 3) {
                        var o = StrDc(wip_uk, alsvkey), t = StrDc(wips_uk, alsvkey), n = StrDc(wip_us, alsvkey),
                            i = StrDc(wips_us, alsvkey);
                        if (o.indexOf(e) >= 0 || t.indexOf(e) >= 0 || n.indexOf(e) >= 0 || i.indexOf(e) >= 0) return void PutToDebugLog(2, "WARNING,GatewayCheck do NOT failower because gateway address is set manually (" + gwround + ")")
                    }
                    !0 === webphone_api.global.failover_gateway && !0 === NeedRegister() ? (webphone_api.global.failover_gateway = !1, "uk" === webphone_api.global.usuk ? webphone_api.global.usuk = "us" : webphone_api.global.usuk = "uk", isNull(webphone_api.global.worktimer) || (clearTimeout(webphone_api.global.worktimer), webphone_api.global.worktimer = null), PutToDebugLog(2, "EVENT, mlogic API_Unregister GatewayCheck (" + gwround + ")"), PutToDebugLog(2, "ERROR,GatewayCheck  failower to: " + webphone_api.global.usuk + " (" + gwround + ")"), !isNull(wssocket) && wssocket.close && wssocket.close(), wssocket = null, PutToDebugLog(2, "EVENT, mlogic API_Start GatewayCheck (" + gwround + ")"), webphone_api.start()) : PutToDebugLog(2, "EVENT,skip GatewayCheck because failover_gateway: " + webphone_api.global.failover_gateway.toString() + "; NeedRegister: " + NeedRegister() + " (" + gwround + ")")
                } catch (a) {
                    PutToDebugLogException(2, "common: GatewayCheck inner timer", a)
                }
            }, e)
        } catch (t) {
            PutToDebugLogException(2, "common: GatewayCheck", t)
        }
    }

    function CheckEngineFirstStart(e) {
        try {
            if (isNull(isWebphoneFirstStart) && (isWebphoneFirstStart = GetParameterBool("wpfirststart", !1)), !1 === isWebphoneFirstStart) return;
            isWebphoneFirstStart = !1, isNull(cestimer) || clearTimeout(cestimer), cestimer = setTimeout(function (o) {
                try {
                    if (getuseengine() === webphone_api.global.ENGINE_WEBRTC && webphone_api.iswebrtcengineworking < 1 && !0 === CanIUseService()) {
                        var t = StrToInt(GetParameter2("enginepriority_webrtc")),
                            n = StrToInt(GetParameter2("enginepriority_ns"));
                        if (t < 5 && t <= n) {
                            IsCurrentEngineWorking(e, 1, !0);
                            var i = webphone_api.common.GetParameter2("serveraddress");
                            (webphone_api.common.isNull(i) || i.length < 2 || "YOURSIPDOMAIN.COM" === i || "YOURSIPSERVER.COM" === i || "SIPSERVER" === i || "VOIPSERVER" === i || "SERVERADDRESS" === i) && (webphone_api.common.SaveParameter("serveraddress", ""), i = webphone_api.common.GetParameter2("serveraddress_user"), (webphone_api.common.isNull(i) || i.length < 2 || "YOURSIPDOMAIN.COM" === i || "YOURSIPSERVER.COM" === i || "SIPSERVER" === i || "VOIPSERVER" === i || "SERVERADDRESS" === i) && ("undefined" != typeof webphone_api.global.worktimer && null !== webphone_api.global.worktimer && clearTimeout(webphone_api.global.worktimer), webphone_api.global.worktimer = null))
                        }
                    }
                } catch (a) {
                    PutToDebugLogException(2, "common: CheckEngineFirstStart Inner Timer", a)
                }
            }, 4e3)
        } catch (o) {
            PutToDebugLogException(2, "common: CheckEngineFirstStart", o)
        }
    }

    function IsCurrentEngineWorking(e, o, t) {
        try {
            if ((isNull(o) || !1 === IsNumber(o)) && (o = 25e3, GetTickCount() - lastcalledtick < 2500)) return;
            lastcalledtick = GetTickCount(), isNull(webphone_api.global.worktimer) || clearTimeout(webphone_api.global.worktimer), paramcache = e, webphone_api.global.iscurrengineworking = !1, webphone_api.global.lastengine_working_ok = "", webphone_api.global.worktimer = setTimeout(function (e) {
                try {
                    if (HandleCalldivert(), "app" === getuseengine() || "p2p" === getuseengine() || "accessnum" === getuseengine() || "nativedial" === getuseengine() || "otherbrowser" === getuseengine()) return;
                    if (webphone_api.global.phonestarted > 2 && (SaveParameter("wpfirststart", "false"), PutToDebugLog(2, "EVENT, Save wpfirststart = false")), !1 === webphone_api.global.iscurrengineworking) {
                        PutToDebugLog(3, "ERROR, common: IsCurrentEngineWorking " + getuseengine() + "> NOT WORKING no SIP signaling received from server");
                        var o = GetEngine(webphone_api.global.useengine), n = GetParameterBool("wpfirststart", !0),
                            i = GetParameterInt("prev_sess_failed", 0);
                        if (!0 === n || i < 1 || (EngineSelect(1), isNull(o) || ("Linux" !== GetOs() && "Mac" !== GetOs() || !1 !== CanIUseService() || 0 != CanIUseApplet()) && (o.failed = 1, SetEngine(webphone_api.global.useengine, o))), SaveParameter("prev_sess_failed", (i + 1).toString()), !1 === n) {
                            var a = GetSelectedEngineName();
                            EngineSelect(1);
                            var r = GetSelectedEngineName();
                            if (a !== r) {
                                var s = GetParameterInt("enginepriority_" + a, 2),
                                    l = GetParameterInt("enginepriority_" + r, 2);
                                if (a !== webphone_api.global.ENGINE_WEBRTC && a !== webphone_api.global.ENGINE_SERVICE || r !== webphone_api.global.ENGINE_WEBRTC && r !== webphone_api.global.ENGINE_SERVICE) {
                                    if (r !== webphone_api.global.ENGINE_WEBRTC && r !== webphone_api.global.ENGINE_SERVICE && s >= l) return void PutToDebugLog(2, "WARNING, IsCurrentEngineWorking, NO engine switch because of priority HIGHER or EQUAL from: " + a + "(" + s.toString() + ") to: " + r + "(" + l.toString() + ")")
                                } else if (s > l) return void PutToDebugLog(2, "WARNING, IsCurrentEngineWorking, NO engine switch because of priority HIGHER from: " + a + "(" + s.toString() + ") to: " + r + "(" + l.toString() + ")")
                            }
                        }
                        if (2 === webphone_api.global.useengineclicked_cache || !0 === t) {
                            webphone_api.global.useengineclicked_cache = 1;
                            var p = webphone_api.stringres.get("ce_ask_user"), c = GetSelectedEngineName();
                            p = p.replace("[SELECTEDENGINE]", GetEngineDisplayName(c)), PutToDebugLog(2, "WARNING, IsCurrentEngineWorking: " + p), EngineSelect(1), ChooseEngineLogic(function (o) {
                                if (!1 === o) {
                                    var t = GetSelectedEngineName();
                                    if (p = p.replace("[RECOMMENDED]", GetEngineDisplayName(t)), PutToDebugLog(2, "WARNING, IsCurrentEngineWorking 2: " + p), isNull(c) || c.length < 1 || isNull(t) || t.length < 1 || c === t) return PutToDebugLog(2, "ERROR, IsCurrentEngineWorking invalid message to be displayed: " + p + " reset useengine"), webphone_api.global.useengine = "", void webphone_api.plhandler.StartUp(e);
                                    if (!0 !== confirm(p)) return PutToDebugLog(2, "WARNING, user denied recommended engine failback"), void IsCurrentEngineWorking(e);
                                    PutToDebugLog(2, "EVENT, user confirmed recommended engine failback reset useengine"), webphone_api.global.useengine = "", webphone_api.plhandler.StartUp(e)
                                } else webphone_api.plhandler.StartUp(e)
                            }, !0)
                        } else PutToDebugLog(2, "WARNING, IsCurrentEngineWorking just start webphone"), webphone_api.startInner(e)
                    } else webphone_api.global.lastengine_started_ok = webphone_api.global.useengine, webphone_api.global.lastengine_working_ok = webphone_api.global.useengine, PutToDebugLog(3, "EVENT, this engine is working: " + webphone_api.global.useengine),
                        "java" !== webphone_api.global.useengine && "ns" !== webphone_api.global.useengine && "webrtc" !== webphone_api.global.useengine || SaveParameter(webphone_api.global.useengine + "_worked", "true"), "ns" === webphone_api.global.useengine && HandleServiceBuildUpgrade(), setTimeout(function () {
                            webphone_api.global.isencrypted = webphone_api.isencrypted()
                        }, 3e3)
                } catch (u) {
                    PutToDebugLogException(2, "common: IsCurrentEngineWorking timer", u)
                }
            }, o)
        } catch (n) {
            PutToDebugLogException(2, "common: IsCurrentEngineWorking", n)
        }
    }

    function InstallJavaPopupSDK(e, o) {
        try {
            if (PutToDebugLog(4, "EVENT, InstallJavaPopupSDK"), e && window.open(webphone_api.global.INSTALL_JAVA_URL, "_blank"), !isNull(jinstallmodal)) return void jinstallmodal.show();
            jinstallmodal = webphone_api.picoModal({
                content: '<div id="ce_modal" class="pmodal_container"><div id="ce_modal_header" class="pmodal_header">' + webphone_api.stringres.get("java_install_title") + '</div><div id="ce_modal_content" class="pmodal_content" style="padding: 1em;"><div id="ce_modal_content_inner">' + webphone_api.stringres.get("java_install") + '</div></div><div id="ce_modal_footer" class="pmodal_footer"><button id="btn_close_jsinst_adialog">' + webphone_api.stringres.get("btn_ok") + "</button></div></div>",
                overlayStyles: { backgroundColor: "#565656", opacity: .6 },
                modalStyles: {},
                overlayClose: !1,
                closeStyles: {
                    background: "#eeeeee",
                    position: "absolute",
                    top: ".2em",
                    right: ".3em",
                    textAlign: "center",
                    fontSize: "1.2em",
                    fontWeight: "bold",
                    border: ".15em solid #bbb",
                    borderRadius: ".8em",
                    paddingLeft: ".25em",
                    paddingRight: ".25em",
                    cursor: "pointer"
                }
            }).afterCreate(function (e) {
            }).beforeShow(function (e, o) {
            }).afterShow(function (e) {
            }).beforeClose(function (e, o) {
            }).afterClose(function (e) {
                e.destroy(), jinstallmodal = null
            }), jinstallmodal.show(), webphone_api.$("#btn_close_jsinst_adialog").on("click", function () {
                jinstallmodal.close()
            })
        } catch (t) {
            PutToDebugLogException(2, "common: InstallJavaPopupSDK", t)
        }
    }

    function InstallJavaPopup(e, o) {
        try {
            if (1 == IsSDK()) return void InstallJavaPopupSDK(e, o);
            PutToDebugLog(4, "EVENT, InstallJavaPopup");
            var t = GetDeviceWidth();
            t = !isNull(t) && IsNumber(t) && t > 100 ? Math.floor(t / 1.2) : 220;
            var n = webphone_api.stringres.get("java_install"),
                i = '<div data-role="popup" id="np_downloadinstall" class="ui-content messagePopup" data-overlay-theme="a" data-theme="a" style="max-width:' + t + 'px;"><div data-role="header" data-theme="b"><h1 class="adialog_title">' + webphone_api.stringres.get("java_install_title") + '</h1></div><div role="main" class="ui-content adialog_content adialog_alert"><span> ' + n + ' </span></div><div data-role="footer" data-theme="b" class="adialog_footer"><a href="javascript:;" id="adialog_positive" style="width: 100%;" class="ui-btn ui-corner-all ui-shadow ui-btn-inline ui-btn-b adialog_2button" data-rel="back" data-transition="flow">' + webphone_api.stringres.get("btn_ok") + "</a></div></div>";
            o = o || function () {
            }, webphone_api.$.mobile.activePage.append(i).trigger("create"), webphone_api.$.mobile.activePage.find(".messagePopup").bind({
                popupbeforeposition: function () {
                    webphone_api.$(".ui-popup-screen").off(), webphone_api.$(this).unbind("popupbeforeposition")
                }
            }), webphone_api.$.mobile.activePage.find(".messagePopup").popup().popup("open").bind({
                popupafterclose: function () {
                    webphone_api.$(this).unbind("popupafterclose").remove(), o()
                }
            }), webphone_api.$("#adialog_positive").on("click", function (o) {
                e && window.open(webphone_api.global.INSTALL_JAVA_URL, "_blank"), PutToDebugLog(5, "EVENT, common InstallJavaPopup ok click")
            })
        } catch (a) {
            PutToDebugLogException(2, "common: InstallJavaPopup", a)
        }
    }

    function GetNPLocation() {
        var e = "";
        try {
            if (e = GetConfig("nativepluginurl"), (isNull(e) || e.length < 2) && (e = GetParameter2("nativepluginurl")), !isNull(e) && e.length > 5) return PutToDebugLog(4, "EVENT, GetNPLocation service location(1): " + e), e;
            var e = webphone_api.getbasedir2();
            isNull(e) && (e = "");
            var o = GetConfig("nativepluginname");
            return "Mac" === GetOs() ? o = GetConfig("nativepluginname_mac") : "Linux" === GetOs() && (o = GetConfig("nativepluginname_linux")), (isNull(o) || o.length < 3) && (o = !0 === NSMacLinEnabled() ? "Mac" === GetOs() ? webphone_api.global.mac_nsplugin_filename : !0 === Is64BitBrowser() ? !0 === IsARM() ? webphone_api.global.lin64arm_nsplugin_filename : webphone_api.global.lin64_nsplugin_filename : !0 === IsARM() ? webphone_api.global.lin32arm_nsplugin_filename : webphone_api.global.lin32_nsplugin_filename : webphone_api.global.win_nsplugin_filename), "/" !== e.charAt(e.length - 1) && (e += "/"), e = e + "native/" + o, PutToDebugLog(4, "EVENT, GetNPLocation doc location: " + location.href), PutToDebugLog(4, "EVENT, GetNPLocation service location: " + e), e
        } catch (t) {
            PutToDebugLogException(2, "common: GetNPLocation", t)
        }
        return ""
    }

    function NPDownloadAndInstallSDK(e, o) {
        try {
            if (PutToDebugLog(4, "EVENT, NPDownloadAndInstallSDK popup displayed"), ServiceStartPolling(), !isNull(npmodal)) return void npmodal.show();
            o = o || function () {
            };
            var t = webphone_api.stringres.get("np_install_msg"),
                n = '<a href="https://www.webvoipphone.com/hosted/webphonedemo/nsenginedownload.html" target="_blank">' + webphone_api.stringres.get("np_install_why") + "</a>";
            "Linux" === GetOs() ? (t = webphone_api.stringres.get("np_install_msg_lin"), (!0 === webphone_api.global.usestorage || Strl(90)) && (t = t + "<br><br>" + n)) : "Mac" === GetOs() && (t = webphone_api.stringres.get("np_install_msg_mac"), (!0 === webphone_api.global.usestorage || Strl(90)) && (t = t + "<br><br>" + n));
            var i = '<button id="btn_np_negative">' + webphone_api.stringres.get("btn_cancel") + "</button>";
            !0 === e && (i = ""), npmodal = webphone_api.picoModal({
                content: '<div id="ce_modal" class="pmodal_container"><div id="ce_modal_header" class="pmodal_header">' + webphone_api.stringres.get("np_install_title") + '</div><div id="ce_modal_content" class="pmodal_content" style="padding: 1em;"><div id="ce_modal_content_inner">' + t + '</div></div><div id="ce_modal_footer" class="pmodal_footer"><button id="btn_np_positive">' + webphone_api.stringres.get("btn_ok") + "</button>" + i + "</div></div>",
                overlayStyles: { backgroundColor: "#565656", opacity: .6 },
                modalStyles: {},
                closeButton: !1,
                overlayClose: !1,
                closeStyles: {
                    background: "#eeeeee",
                    position: "absolute",
                    top: ".2em",
                    right: ".3em",
                    textAlign: "center",
                    fontSize: "1.2em",
                    fontWeight: "bold",
                    border: ".15em solid #bbb",
                    borderRadius: ".8em",
                    paddingLeft: ".25em",
                    paddingRight: ".25em",
                    cursor: "pointer"
                }
            }).afterCreate(function (e) {
            }).beforeShow(function (e, o) {
            }).afterShow(function (e) {
            }).beforeClose(function (e, o) {
            }).afterClose(function (e) {
                e.destroy(), npmodal = null, PutToDebugLog(4, "EVENT, NPDownloadAndInstallSDK popup closed")
            }), npmodal.show(), webphone_api.$("#btn_np_positive").on("click", function () {
                npmodal.close(), PutToDebugLog(5, "EVENT, common NPDownloadAndInstallSDK 1 ok"), lm = !1, !0 === webphone_api.global.nsupdatepending && (webphone_api.global.nsupdatepending = !1, PutToDebugLog(2, "EVENT, mlogic API_Start NPDownloadAndInstallSDK"), webphone_api.start()), o("ok")
            }), webphone_api.$("#btn_np_negative").on("click", function () {
                npmodal.close(), PutToDebugLog(5, "EVENT, settings NPDownloadAndInstallSDK 1 cancel");
                var e = GetEngine("webrtc");
                e.clicked = 0, SetEngine("webrtc", e), EngineSelect(1), stopPolling = !0, o("cancel")
            })
        } catch (a) {
            PutToDebugLogException(2, "common: NPDownloadAndInstallSDK", a)
        }
    }

    function NPDownloadAndInstall(e, o) {
        try {
            if (npclosehandled = !1, 1 == IsSDK()) return void NPDownloadAndInstallSDK(e, o);
            PutToDebugLog(4, "EVENT, NPDownloadAndInstall popup displayed"), ServiceStartPolling();
            var t = GetDeviceWidth();
            t = !isNull(t) && IsNumber(t) && t > 100 ? Math.floor(t / 1.2) : 220, enginep.ns = enginep.ns + 5e3;
            var n = webphone_api.stringres.get("np_install_msg"),
                i = '<a href="https://www.webvoipphone.com/hosted/webphonedemo/nsenginedownload.html" target="_blank">' + webphone_api.stringres.get("np_install_why") + "</a>";
            n = n + "<br><br>" + i, "Linux" === GetOs() ? (n = webphone_api.stringres.get("np_install_msg_lin"), (!0 === webphone_api.global.usestorage || Strl(90)) && (n = n + "<br><br>" + i)) : "Mac" === GetOs() && (n = webphone_api.stringres.get("np_install_msg_mac"), (!0 === webphone_api.global.usestorage || Strl(90)) && (n = n + "<br><br>" + i));
            var a = '<a href="javascript:;" id="adialog_negative" class="ui-btn ui-corner-all ui-shadow ui-btn-inline ui-btn-b adialog_2button" data-rel="back">' + webphone_api.stringres.get("btn_cancel") + "</a>";
            !0 === e && (a = "");
            var r = '<div data-role="popup" id="np_downloadinstall" class="ui-content messagePopup" data-overlay-theme="a" data-dismissible="false" data-theme="a" style="max-width:' + t + 'px;"><div data-role="header" data-theme="b"><h1 class="adialog_title">' + webphone_api.stringres.get("np_install_title") + '</h1></div><div role="main" class="ui-content adialog_content adialog_alert"><span> ' + n + ' </span></div><div data-role="footer" data-theme="b" class="adialog_footer"><a href="javascript:;" id="adialog_positive" class="ui-btn ui-corner-all ui-shadow ui-btn-inline ui-btn-b adialog_2button" data-rel="back" data-transition="flow">' + webphone_api.stringres.get("btn_ok") + "</a>" + a + "</div></div>";
            o = o || function () {
            }, webphone_api.$.mobile.activePage.append(r).trigger("create"), webphone_api.$.mobile.activePage.find(".messagePopup").bind({
                popupbeforeposition: function () {
                    webphone_api.$(".ui-popup-screen").off(), webphone_api.$(this).unbind("popupbeforeposition");
                    var e = Math.floor(.6 * GetDeviceHeight());
                    webphone_api.$(this).height() > e && webphone_api.$(".messagePopup .ui-content").height(e)
                }
            }), webphone_api.$.mobile.activePage.find(".messagePopup").popup().popup("open").bind({
                popupafterclose: function () {
                    !1 === npclosehandled && NPHandleCancel(), webphone_api.$(this).unbind("popupafterclose").remove(), PutToDebugLog(4, "EVENT, NPDownloadAndInstall popup closed")
                }
            }), webphone_api.$("#adialog_positive").on("click", function (e) {
                PutToDebugLog(5, "EVENT, common NPDownloadAndInstall 1 ok"), npclosehandled = !0, lm = !1, setTimeout(function () {
                    webphone_api.$.mobile.activePage.find(".messagePopup").popup("close")
                }, 500), !0 === webphone_api.global.nsupdatepending && (webphone_api.global.nsupdatepending = !1, PutToDebugLog(2, "EVENT, mlogic API_Start NPDownloadAndInstall"), webphone_api.start()), setTimeout(function () {
                    IsServiceInstalled(function (e) {
                        !1 === e && (PutToDebugLog(2, "WARNING, on NPDownloadAndInstall OK clikc, NS service is not reachable"), AlertDialog(webphone_api.stringres.get("warning"), webphone_api.stringres.get("np_install_warn")))
                    }, !0)
                }, 500), o("ok")
            }), webphone_api.$("#adialog_negative").on("click", function (e) {
                PutToDebugLog(5, "EVENT, settings NPDownloadAndInstall 1 cancel"), o("cancel"), NPHandleCancel(), setTimeout(function () {
                    webphone_api.$.mobile.activePage.find(".messagePopup").popup("close")
                }, 500)
            })
        } catch (s) {
            PutToDebugLogException(2, "common: NPDownloadAndInstall", s)
        }
    }

    function NPHandleCancel() {
        npclosehandled = !0;
        var e = GetEngine("ns");
        e.clicked = 0, SetEngine("ns", e), EngineSelect(1), stopPolling = !0, webphone_api.startInner()
    }

    function EngineForcedInstallSDK(e, o, t, n) {
        function i() {
            if ("java" === e) InstallJavaPopup(!0), n("ok"); else if ("ns" === e) {
                n("ok"), setTimeout(function () {
                    NPDownloadAndInstall(!0)
                }, 450);
                var o = GetNPLocation();
                !isNull(o) && o.length > 0 && window.open(o)
            }
        }

        try {
            var a = !1;
            if (PutToDebugLog(4, "EVENT, EngineForcedInstallSDK popup displayed: " + e + "; message: " + o), n = n || function () {
            }, !isNull(efmodal)) return void efmodal.show();
            if (isNull(o) || o.length < 1) if ("java" === e && "Chrome" === GetBrowser()) {
                PutToDebugLog(2, "EVENT," + webphone_api.stringres.get("jnotsupported") + "_2"), o = webphone_api.stringres.get("jnotsupported");
                var r = GetConfig("pc_alternatebrowserurl");
                !isNull(r) && r.length > 2 && (o = o + ': <a href="' + r + '" target="_blank">' + r + "</a>"), a = !0
            } else o = webphone_api.stringres.get("ce_alert_user") + " " + GetEngineDisplayName(e) + ".", o = o.replace("[BRAND]", GetBrandName());
            o.indexOf(webphone_api.stringres.get("service_update")) >= 0 && (o += '<br /><a id="efi_download_link" style="cursor:pointer; color:#3f8fcf;">Download NS -Service Plugin</a>');
            var s = webphone_api.stringres.get("btn_ok");
            e === webphone_api.global.ENGINE_SERVICE && (s = webphone_api.stringres.get("btn_download"));
            var l = '<button id="btn_ef_positive">' + s + "</button>";
            !0 === t && (l = '<button id="btn_ef_negative">' + webphone_api.stringres.get("btn_cancel") + "</button>" + l), efmodal = webphone_api.picoModal({
                content: '<div id="ce_modal" class="pmodal_container"><div id="ce_modal_header" class="pmodal_header">' + webphone_api.stringres.get("ce_alert_title") + '</div><div id="ce_modal_content" class="pmodal_content" style="padding: 1em;"><div id="ce_modal_content_inner">' + o + '</div></div><div id="ce_modal_footer" class="pmodal_footer">' + l + "</div></div>",
                overlayStyles: { backgroundColor: "#565656", opacity: .6 },
                modalStyles: {},
                closeButton: !1,
                overlayClose: !1,
                closeStyles: {
                    background: "#eeeeee",
                    position: "absolute",
                    top: ".2em",
                    right: ".3em",
                    textAlign: "center",
                    fontSize: "1.2em",
                    fontWeight: "bold",
                    border: ".15em solid #bbb",
                    borderRadius: ".8em",
                    paddingLeft: ".25em",
                    paddingRight: ".25em",
                    cursor: "pointer"
                }
            }).afterCreate(function (e) {
            }).beforeShow(function (e, o) {
            }).afterShow(function (e) {
            }).beforeClose(function (e, o) {
            }).afterClose(function (e) {
                webphone_api.$("#efi_download_link").off("click"), e.destroy(), PutToDebugLog(4, "EVENT, EngineForcedInstallSDK popup closed"), efmodal = null
            }), efmodal.show(), webphone_api.$("#efi_download_link").on("click", function (e) {
                PutToDebugLog(5, "EVENT, common EngineForcedInstallSDK link click"), i(), efmodal.close()
            }), webphone_api.$("#btn_ef_positive").on("click", function () {
                efmodal.close(), !0 !== a && (PutToDebugLog(5, "EVENT, common EngineForcedInstallSDK 1 ok"), i())
            }), webphone_api.$("#btn_ef_negative").on("click", function () {
                efmodal.close(), PutToDebugLog(5, "EVENT, common EngineForcedInstallSDK 1 cancel");
                var e = GetEngine("webrtc");
                e.clicked = 0, SetEngine("webrtc", e), EngineSelect(1), stopPolling = !0, n("cancel")
            })
        } catch (p) {
            PutToDebugLogException(2, "common: EngineForcedInstallSDK", p)
        }
    }

    function EngineForcedInstall(e, o, t, n) {
        function i() {
            if ("java" === e) InstallJavaPopup(!0), n("ok"); else if ("ns" === e) {
                n("ok"), setTimeout(function () {
                    NPDownloadAndInstall(!0)
                }, 450);
                var o = GetNPLocation();
                !isNull(o) && o.length > 0 && window.open(o)
            }
            setTimeout(function () {
                webphone_api.$.mobile.activePage.find(".messagePopup").popup("close")
            }, 200)
        }

        try {
            if ("ns" === e && -3 === GetMinServiceVersion()) return void PutToDebugLog(2, "ERROR, EngineForcedInstall: " + e + "; install popup is disabled by minserviceversion: " + GetMinServiceVersion().toString());
            var a = !1;
            if (1 == IsSDK()) return void EngineForcedInstallSDK(e, o, t, n);
            PutToDebugLog(4, "EVENT, EngineForcedInstall popup displayed: " + e + "; message: " + o);
            var r = GetDeviceWidth();
            if (r = !isNull(r) && IsNumber(r) && r > 100 ? Math.floor(r / 1.2) : 220, isNull(o) || o.length < 1) if ("java" === e && "Chrome" === GetBrowser()) {
                PutToDebugLog(2, "EVENT," + webphone_api.stringres.get("jnotsupported") + "_3"), o = webphone_api.stringres.get("jnotsupported");
                var s = GetConfig("pc_alternatebrowserurl");
                !isNull(s) && s.length > 2 && (o = o + ': <a href="' + s + '" target="_blank">' + s + "</a>"), a = !0
            } else o = webphone_api.stringres.get("ce_alert_user") + " " + GetEngineDisplayName(e) + ".", o = o.replace("[BRAND]", GetBrandName());
            var l = webphone_api.stringres.get("btn_ok");
            e === webphone_api.global.ENGINE_SERVICE && (l = webphone_api.stringres.get("btn_download")), o.indexOf(webphone_api.stringres.get("service_update")) >= 0 && (o += '<br /><a id="efi_download_link" style="cursor:pointer;">Download NS -Service Plugin</a>');
            var p = '<a href="javascript:;" id="adialog_positive" class="ui-btn ui-corner-all ui-shadow ui-btn-inline ui-btn-b adialog_2button" data-rel="back" data-transition="flow">' + l + "</a>";
            !0 === t && (p = '<a href="javascript:;" id="adialog_negative" class="ui-btn ui-corner-all ui-shadow ui-btn-inline ui-btn-b adialog_2button" data-rel="back">' + webphone_api.stringres.get("btn_cancel") + "</a>" + p);
            var c = '<div data-role="popup" id="np_forcedinstall" class="ui-content messagePopup" data-overlay-theme="a" data-theme="a" style="max-width:' + r + 'px;"><div data-role="header" data-theme="b"><h1 class="adialog_title" style="margin-left: 2.2em;">' + webphone_api.stringres.get("ce_alert_title") + '</h1></div><div role="main" class="ui-content adialog_content adialog_alert"><span> ' + o + ' </span></div><div data-role="footer" data-theme="b" class="adialog_footer">' + p + "</div></div>";
            n = n || function () {
            }, webphone_api.$.mobile.activePage.append(c).trigger("create"), webphone_api.$.mobile.activePage.find(".messagePopup").bind({
                popupbeforeposition: function () {
                    webphone_api.$(".ui-popup-screen").off(), webphone_api.$(this).unbind("popupbeforeposition");
                    var e = Math.floor(.6 * GetDeviceHeight());
                    webphone_api.$(this).height() > e && webphone_api.$(".messagePopup .ui-content").height(e)
                }
            }), webphone_api.$.mobile.activePage.find(".messagePopup").popup().popup("open").bind({
                popupafterclose: function () {
                    webphone_api.$("#efi_download_link").off("click"), webphone_api.$(this).unbind("popupafterclose").remove(), PutToDebugLog(4, "EVENT, EngineForcedInstall popup closed")
                }
            }), webphone_api.$("#efi_download_link").on("click", function (e) {
                PutToDebugLog(5, "EVENT, common EngineForcedInstall link click"), webphone_api.$.mobile.activePage.find(".messagePopup").popup("close"), i()
            }), webphone_api.$("#adialog_positive").on("click", function (e) {
                !0 !== a && (PutToDebugLog(5, "EVENT, common EngineForcedInstall ok"), i())
            }), webphone_api.$("#adialog_negative").on("click", function (e) {
                PutToDebugLog(5, "EVENT, common EngineForcedInstall 1 cancel"), n("cancel"), NPHandleCancel(), setTimeout(function () {
                    webphone_api.$.mobile.activePage.find(".messagePopup").popup("close")
                }, 200)
            })
        } catch (u) {
            PutToDebugLogException(2, "common: EngineForcedInstall", u)
        }
    }

    function GetAppEnProtocol(e) {
        try {
            var o = GetConfig("app_protocol");
            if ((isNull(o) || o.length < 1) && (o = "webphone:"), o.indexOf(":") < 1 && (o += ":"), o.indexOf("//") < 1 && (o += "//"), "Mac" !== GetOs() && "Linux" !== GetOs() || (o = "sip://"), (isNull(o) || o.length < 1) && (o = "webphone://"), o = o.toLowerCase(), !0 === e) {
                var t = GetParameter("callto");
                isNull(t) && (t = ""), t = Trim(t), o += t
            }
            return o
        } catch (n) {
            PutToDebugLogException(2, "common: GetAppEnProtocol", n)
        }
        return "webphone://"
    }

    function HandleProtocol(e) {
        var o = 0;
        try {
            if (PutToDebugLog(2, "EVENT, HandleProtocol called: " + e), !1 === webphone_api.global.isdebugversion && "iOS" !== GetOs() && "Android" !== GetOs()) return;
            o = 1;
            var t = window.location;
            if (o = 2, o = 5, PutToDebugLog(2, "EVENT, HandleProtocol: " + e), "iOS" === GetOs()) o = 6, window.location = e; else if ("Chrome" === GetBrowser()) {
                var n = e;
                n = n.replace(":", ""), n = n.replace("//", ""), n = n.replace("\\", "");
                var i = GetNativeDialerUrl(GetOs());
                i = i.toLowerCase();
                var a = i.indexOf("id=");
                a > 0 ? (i = i.substring(a + 3), a = i.indexOf("&"), a > 0 && (i = i.substring(0, a)), a = i.indexOf("#"), a > 0 && (i = i.substring(0, a)), i = Trim(i)) : i = "com.mizuvoip.mizudroid.app";
                var r = encodeURIComponent(GetNativeDialerUrl(GetOs())),
                    s = "intent://#Intent;scheme=" + n + ";package=" + i + ";S.browser_fallback_url=" + r + ";end";
                PutToDebugLog(2, "EVENT, HandleProtocol for Chrome in Android: " + s), window.location = s
            } else {
                o = 7;
                var l = document.getElementById("loader");
                if (isNull(l)) return PutToDebugLog(1, "ERROR, HandleProtocol loader iframe is NULL"), void ShowToast("ERROR, app loader is not defined.");
                l.src = e
            }
            o = 11, t = GetNativeDialerUrl(GetOs()), o = 14, PutToDebugLog(2, "EVENT, HandleProtocol fallbackLink: " + t), redirect_timer = setTimeout(function () {
                try {
                    o = 15, window.location = t, o = 16
                } catch (e) {
                    PutToDebugLogException(2, "common: HandleProtocol inner timer second( " + o + " ), fallbackLink: " + t, e)
                }
            }, 3e3), o = 17, clear_timer = setInterval(function () {
                try {
                    o = 18, protocolmaxloop++;
                    var e = window.document.hasFocus();
                    o = 17, (!e || document.hidden || protocolmaxloop > 100) && (o = 21, protocolmaxloop = 0, isNull(clear_timer) || clearInterval(clear_timer), clear_timer = null, o = 22, isNull(redirect_timer) || clearTimeout(redirect_timer), redirect_timer = null, o = 23)
                } catch (t) {
                    PutToDebugLogException(2, "common: HandleProtocol inner timer( " + o + " )", t)
                }
            }, 200), o = 24
        } catch (p) {
            PutToDebugLogException(2, "common: HandleProtocol( " + o + " )", p)
        }
    }

    function StartAppEngine(e, o, t, n) {
        try {
            if (GetParameterInt("allow_start_app_engine", 1) < 1) return void PutToDebugLog(1, "STATUS, Skip app engine start, last start was cancelled");
            var i = GetParameterInt("app_popup_displayed", 0);
            if (!0 !== e || i > 0) return void StartAppEngineExec(e, o, t, n);
            var a = GetParameterInt("enginepriority_webrtc", 2), r = GetParameterInt("enginepriority_app", 2),
                s = GetParameterInt("enginepriority_p2p", 2), l = GetParameterInt("enginepriority_accessnum", 2);
            if (r >= 5 && a < 5 && s < 5 && l < 5 || r >= 2 && a < r && s < r && l < r) return void StartAppEngineExec(e, o, t, n);
            var p = webphone_api.stringres.get("app_en_message3");
            a < 1 && (p = webphone_api.stringres.get("app_en_message2")), i += 1, SaveParameter("app_popup_displayed", i.toString());
            var c = webphone_api.common.GetDeviceWidth();
            c = !webphone_api.common.isNull(c) && webphone_api.common.IsNumber(c) && c > 100 ? Math.floor(c / 1.2) : 220;
            var u = '<div id="adialog_appenalert" data-role="popup" class="ui-content messagePopup" data-overlay-theme="a" data-theme="a" style="max-width:' + c + 'px;"><div data-role="header" data-theme="b"><a href="javascript:;" data-role="button" data-icon="delete" data-iconpos="notext" class="ui-btn-right closePopup">Close</a><h1 class="adialog_title">' + webphone_api.stringres.get("warning") + '</h1></div><div role="main" class="ui-content adialog_content adialog_btn_nexttoinput"><span>' + p + '</span><div style="clear: both;">\x3c!--//--\x3e</div></div><div data-role="footer" data-theme="b" class="adialog_footer"><a href="javascript:;" id="adialog_positive" class="ui-btn ui-corner-all ui-shadow ui-btn-inline ui-btn-b adialog_2button" data-rel="back" data-transition="flow">' + webphone_api.stringres.get("btn_ok") + '</a><a href="javascript:;" id="adialog_negative" class="ui-btn ui-corner-all ui-shadow ui-btn-inline ui-btn-b adialog_2button" data-rel="back">' + webphone_api.stringres.get("btn_cancel") + "</a></div></div>";
            webphone_api.$.mobile.activePage.append(u).trigger("create"), webphone_api.$.mobile.activePage.find(".closePopup").bind("tap", function (e) {
                webphone_api.$.mobile.activePage.find(".messagePopup").popup("close")
            }), webphone_api.$.mobile.activePage.find(".messagePopup").popup().popup("open").bind({
                popupafterclose: function () {
                    webphone_api.$(this).unbind("popupafterclose").remove(), webphone_api.$("#adialog_positive").off("click"), webphone_api.$("#adialog_negative").off("click")
                }
            }), webphone_api.$("#adialog_positive").on("click", function (i) {
                webphone_api.$("#adialog_appenalert").on("popupafterclose", function (i) {
                    StartAppEngineExec(e, o, t, n)
                })
            }), webphone_api.$("#adialog_negative").on("click", function (e) {
                PutToDebugLog(1, "STATUS, No engines to start."), ShowToast("ERROR, No engines to start!", 8e3), PutToDebugLog(2, "ERROR, StartAppEngine user clicked cancel, so do NOT start APP engine"), SaveParameter("allow_start_app_engine", "0")
            })
        } catch (h) {
            PutToDebugLogException(2, "common: StartAppEngine", h)
        }
    }

    function StartAppEngineExec(e, o, t, n) {
        try {
            void 0 !== t && null !== t || (t = !1), void 0 !== n && null !== n && n.length > 0 && Trim(n), function (e, o, t) {
                try {
                    webphone_api.global.isappenginestarted = !0, !isNull(e) && e.length > 0 && PutToDebugLog(2, e), isNull(t) && (t = ""), 0 === GetAppEnProtocol(o).indexOf("webphone:") ? (UploadAutoprov(), setTimeout(function () {
                        HandleProtocol(GetAppEnProtocol(o) + t)
                    }, 1200)) : HandleProtocol(GetAppEnProtocol(o) + t)
                } catch (n) {
                    webphone_api.common.PutToDebugLogException(2, "common: StartAE", n)
                }
            }(o, t, n)
        } catch (i) {
            webphone_api.common.PutToDebugLogException(2, "common: StartAppEngineExec", i)
        }
    }

    function Phone2Phone(e, o) {
        try {
            var t = GetParameter("p2p");
            if (0 !== Trim(t).indexOf("*")) return void OpenWebURL(t, webphone_api.stringres.get("p2p"));
            var n = GetDeviceWidth();
            n = !isNull(n) && IsNumber(n) && n > 100 ? Math.floor(n / 1.2) : 220, isNull(e) && (e = ""), isNull(o) && (o = "");
            var i = '<div id="adialog_p2p" data-role="popup" class="ui-content messagePopup" data-overlay-theme="a" data-theme="a" style="max-width:' + n + 'px;"><div data-role="header" data-theme="b"><a href="javascript:;" data-role="button" data-icon="delete" data-iconpos="notext" class="ui-btn-right closePopup">Close</a><h1 class="adialog_title">' + webphone_api.stringres.get("p2p") + '</h1></div><div role="main" class="ui-content adialog_content"><span>' + webphone_api.stringres.get("p2p_nra") + '</span><input type="text" id="phonea_input" name="phonea_input" value="' + e + '" data-theme="a" autocapitalize="off"/><span>' + webphone_api.stringres.get("p2p_nrb") + '</span><input type="text" id="phoneb_input" name="phoneb_input" value="' + o + '" data-theme="a" autocapitalize="off"/></div><div data-role="footer" data-theme="b" class="adialog_footer"><a href="javascript:;" id="adialog_positive" class="ui-btn ui-corner-all ui-shadow ui-btn-inline ui-btn-b adialog_2button" data-rel="back" data-transition="flow">' + webphone_api.stringres.get("btn_ok") + '</a><a href="javascript:;" id="adialog_negative" class="ui-btn ui-corner-all ui-shadow ui-btn-inline ui-btn-b adialog_2button" data-rel="back">' + webphone_api.stringres.get("btn_cancel") + "</a></div></div>";
            webphone_api.$.mobile.activePage.append(i).trigger("create"), webphone_api.$.mobile.activePage.find(".closePopup").bind("tap", function (e) {
                webphone_api.$.mobile.activePage.find(".messagePopup").popup("close")
            }), webphone_api.$.mobile.activePage.find(".messagePopup").popup().popup("open").bind({
                popupafterclose: function () {
                    webphone_api.$(this).unbind("popupafterclose").remove(), webphone_api.$("#adialog_positive").off("click"), webphone_api.$("#adialog_negative").off("click")
                }
            });
            var a = document.getElementById("phonea_input"), r = document.getElementById("phoneb_input");
            isNull(a) || a.focus(), webphone_api.$("#adialog_positive").on("click", function (e) {
                PutToDebugLog(5, "EVENT, _dialpad Phone2Phone 1 ok");
                var o = a.value, t = r.value;
                return isNull(o) || Trim(o).length < 1 ? void ShowToast(webphone_api.stringres.get("p2p_err1")) : (o = Trim(o), isNull(t) || Trim(t).length < 1 ? void ShowToast(webphone_api.stringres.get("p2p_err2")) : (t = Trim(t), void UriParser(GetParameter("p2p"), "", o, t, "", "phone2phone")))
            }), webphone_api.$("#adialog_negative").on("click", function (e) {
            })
        } catch (s) {
            PutToDebugLogException(2, "common: Phone2Phone", s)
        }
    }

    function AlertDialogSDK(e, o, t, n) {
        try {
            if (!isNull(admodal)) return void admodal.show();
            isNull(n) && (n = webphone_api.stringres.get("btn_ok")), admodal = webphone_api.picoModal({
                content: '<div id="ce_modal" class="pmodal_container"><div id="ce_modal_header" class="pmodal_header">' + e + '</div><div id="ce_modal_content" class="pmodal_content" style="padding: 1em;"><div id="ce_modal_content_inner">' + o + '</div></div><div id="ce_modal_footer" class="pmodal_footer"><button id="btn_close_adialog">' + n + "</button></div></div>",
                overlayStyles: { backgroundColor: "#565656", opacity: .6 },
                modalStyles: {},
                overlayClose: !1,
                closeStyles: {
                    background: "#eeeeee",
                    position: "absolute",
                    top: ".2em",
                    right: ".3em",
                    textAlign: "center",
                    fontSize: "1.2em",
                    fontWeight: "bold",
                    border: ".15em solid #bbb",
                    borderRadius: ".8em",
                    paddingLeft: ".25em",
                    paddingRight: ".25em",
                    cursor: "pointer"
                }
            }).afterCreate(function (e) {
            }).beforeShow(function (e, o) {
            }).afterShow(function (e) {
            }).beforeClose(function (e, o) {
            }).afterClose(function (e) {
                e.destroy(), admodal = null
            }), admodal.show(), webphone_api.$("#btn_close_adialog").on("click", function () {
                admodal.close(), t && "function" == typeof t && (t(!0), t = null)
            })
        } catch (i) {
            PutToDebugLogException(2, "common: AlertDialogSDK", i)
        }
    }

    function ShowToastSDK(e, o) {
        try {
            if (!isNull(toastmodal)) return void toastmodal.show();
            toastmodal = webphone_api.picoModal({
                content: '<div id="ce_modal" class="pmodal_container"><div id="ce_modal_content" class="modal_content" style="font-size: .8em; padding: .7em;"><div id="ce_modal_content_inner" style="margin-right: 1.6em;">' + e + "</div></div></div>",
                overlayStyles: { backgroundColor: "#565656", opacity: .6 },
                modalStyles: {
                    padding: "0",
                    margin: "0",
                    border: ".2em solid #d8d8d8",
                    borderRadius: ".5em",
                    width: "auto",
                    background: "#ffffff",
                    fontFamily: "sans-serif"
                },
                overlayClose: !1,
                closeStyles: {
                    background: "#eeeeee",
                    position: "absolute",
                    top: ".2em",
                    right: ".3em",
                    textAlign: "center",
                    fontSize: "1.2em",
                    fontWeight: "bold",
                    border: ".15em solid #bbb",
                    borderRadius: ".8em",
                    paddingLeft: ".25em",
                    paddingRight: ".25em",
                    cursor: "pointer"
                }
            }).afterCreate(function (e) {
            }).beforeShow(function (e, o) {
            }).afterShow(function (e) {
            }).beforeClose(function (e, o) {
            }).afterClose(function (e) {
                e.destroy(), toastmodal = null
            }), toastmodal.show(), webphone_api.$("#btn_close_adialog").on("click", function () {
                toastmodal.close()
            }), isNull(o) && (o = 3e3), o > 0 && setTimeout(function () {
                isNull(toastmodal) || toastmodal.close()
            }, o)
        } catch (t) {
            PutToDebugLogSpecial(2, "common: ShowToastSDK", !0, t)
        }
    }

    function LcAc(e, o) {
        try {
            if (IsWindowsSoftphone() || !webphone_api.global.usestorage) return !0;
            if (e && isNull(lctmr)) return lctmr = setTimeout(function () {
                lcsexp = !0
            }, 36e5), !0;
            var t = 1;
            !0 === SvCont() && !0 === WbCont() ? t = 5 : !0 === SvCont() ? t = 3 : !0 === WbCont() && (t = 2);
            if (lccsenr > 15 * t && (lcsexp = !0), !0 === o) {
                var n = GetParameter("lccnr"), i = 0;
                if (!isNull(n) && n.length > 0) {
                    n = Trim(n);
                    try {
                        i = StrToInt(n)
                    } catch (c) {
                        PutToDebugLogException(2, "_call: convert to int", c)
                    }
                    var a = t;
                    a > 1 && (a /= 2), a *= 100, i > a ? lcsexp = !0 : (i++, lccsenr++, SaveParameter("lccnr", i.toString()))
                } else SaveParameter("lccnr", "1")
            }
            if (lcsexp) {
                var r = [];
                r.push("D"), r.push("e"), r.push("m"), r.push("o "), r.push("l"), r.push("i"), r.push("m"), r.push("i"), r.push("t "), r.push("r"), r.push("e"), r.push("a"), r.push("c"), r.push("h"), r.push("e"), r.push("d"), r.push(". "), r.push("P"), r.push("l"), r.push("e"), r.push("a"), r.push("s"), r.push("e "), r.push("r"), r.push("e"), r.push("s"), r.push("t"), r.push("a"), r.push("r"), r.push("t "), r.push("t"), r.push("h"), r.push("e "), r.push("b"), r.push("r"), r.push("o"), r.push("w"), r.push("s"), r.push("e"), r.push("r "), r.push("t"), r.push("o "), r.push("c"), r.push("o"), r.push("n"), r.push("t"), r.push("i"), r.push("n"), r.push("u"), r.push("e "), r.push("t"), r.push("e"), r.push("s"), r.push("t"), r.push("i"), r.push("n"), r.push("g"), r.push(". "), r.push("\n<br>"), r.push("C"), r.push("o"), r.push("n"), r.push("t"), r.push("a"), r.push("c"), r.push("t "), r.push("M"), r.push("i"), r.push("z"), r.push("u"), r.push("t"), r.push("e"), r.push("c"), r.push("h "), r.push("t"), r.push("o "), r.push("b"), r.push("u"), r.push("y "), r.push("a "), r.push("l"), r.push("i"), r.push("c"), r.push("e"), r.push("n"), r.push("s"), r.push("e"), r.push("d "), r.push("c"), r.push("o"), r.push("p"), r.push("y"), r.push(": "), r.push("s"), r.push("u"), r.push("p"), r.push("p"), r.push("o"), r.push("r"), r.push("t"), r.push("@"), r.push("m"), r.push("i"), r.push("z"), r.push("u"), r.push("-"), r.push("v"), r.push("o"), r.push("i"), r.push("p"), r.push("."), r.push("c"), r.push("o"), r.push("m");
                var s = r.join(""), l = [];
                l.push("D"), l.push("e"), l.push("m"), l.push("o");
                var p = l.join("");
                return setTimeout(function () {
                    AlertDialog(p, s)
                }, 950), !1
            }
        } catch (c) {
            PutToDebugLogException(2, "common: LcAc", c)
        }
        return !0
    }

    function GetServerForHttpReq() {
        var e = "";
        try {
            e = GetParameter("serveraddress_user");
            var o = GetParameter("upperserver");
            return (GetConfigInt("cfgusetunneling", 0) > 0 || e.length > 0 && e.indexOf(".") < 1) && !isNull(o) && o.length > 1 && (e = o), (isNull(e) || e.length < 1) && (e = GetParameter2("serveraddress"), (isNull(e) || e.length < 1) && (e = GetParameter("serveraddress_user")), (isNull(e) || e.length < 1) && (e = GetParameter("serveraddress_orig")), (isNull(e) || e.length < 1) && (e = GetConfig("serveraddress")), GetConfigInt("cfgusetunneling", 0) > 0 && !isNull(GetConfig("upperserver")) && GetConfig("upperserver").length > 1 && (e = GetConfig("upperserver"))), isNull(e) && (e = ""), e.indexOf(":") > 0 && (e = e.substring(0, e.indexOf(":"))), e
        } catch (t) {
            PutToDebugLogException(2, "common: GetServerForHttpReq", t)
        }
        return ""
    }

    function GetProxyaddress(e) {
        try {
            var o = "";
            if (!isNull(e) && e.length > 0) o = e; else {
                if ((isNull(o) || o.length < 3) && (o = GetConfig("proxyaddress")), !isNull(o) && o.length > 2 && o.indexOf(":") < 1) {
                    var t = GetConfig("serverport");
                    !isNull(t) && t.length > 0 && "5060" !== t && (o = o + ":" + t)
                }
                (isNull(o) || o.length < 3) && (o = GetParameter("proxyaddress"))
            }
            return isNull(o) && (o = ""), o = o.toLowerCase(), o = o.replace("udp://", ""), o = o.replace("tcp://", ""), o = o.replace("http://", ""), o = o.replace("https://", ""), o = o.replace("udp:", ""), o = o.replace("tcp:", ""), o = o.replace("http:", ""), o = o.replace("https:", ""), o = Trim(o), 0 === o.indexOf("udp") && (o = o.replace("udp", "")), 0 === o.indexOf("tcp") && (o = o.replace("tcp", "")), 0 === o.indexOf("http") && (o = o.replace("http", "")), 0 === o.indexOf("https") && (o = o.replace("https", "")), o
        } catch (n) {
            PutToDebugLogException(2, "common: GetProxyaddress", n)
        }
        return ""
    }

    function GetWebrtcUpperServer(e) {
        try {
            var o = "", t = GetParameter("upperserverip");
            if (!isNull(t) && Trim(t).length > 0) return t;
            if (!0 !== e) {
                var n = GetParameter("upperserverdomain");
                if (!isNull(n) && Trim(n).length > 0) return n
            }
            var i = GetConfig("wsuser");
            if (!isNull(i) && i.length > 10) {
                if (t = GetUrlParamVal("upperserverip"), n = GetUrlParamVal("upperserverdomain"), !isNull(t) && Trim(t).length > 0) return t;
                if (!0 !== e && !isNull(n) && Trim(n).length > 0) return n
            }
            var a = GetParameter("webrtcserveraddress");
            if (isNull(a) || a.length < 2) {
                o = GetParameter("serveraddress_user")
                    ; var r = GetParameter("upperserver");
                return (GetConfigInt("cfgusetunneling", 0) > 0 || o.length > 0 && o.indexOf(".") < 1) && !isNull(r) && r.length > 1 && (o = r), Trim(o)
            }
            return o = GetParameter2("serveraddress"), (isNull(o) || o.length < 1) && (o = GetParameter("serveraddress_user")), (isNull(o) || o.length < 1) && (o = GetParameter("serveraddress_orig")), (isNull(o) || o.length < 1) && (o = GetConfig("serveraddress")), GetConfigInt("cfgusetunneling", 0) > 0 && !isNull(GetConfig("upperserver")) && GetConfig("upperserver").length > 1 && (o = GetConfig("upperserver")), o
        } catch (s) {
            PutToDebugLogException(2, "common: GetWebrtcUpperServer", s)
        }
        return ""
    }

    function GetWebrtcSyUpperHeader(e) {
        try {
            var o = GetParameter("jsupperserver");
            if ((isNull(o) || o.length < 1) && (o = GetWebrtcUpperServer(!0)), !isNull(o) && o.length > 0) {
                var t = GetConfig("transport");
                return !isNull(t) && t.length > 0 && (t.indexOf(":") < 0 && (t = ":" + t), o = t + o), o
            }
            PutToDebugLog(2, "WARNING, GetWebrtcUpperServer is NULL (" + e + ")")
        } catch (n) {
            PutToDebugLogException(2, "common: GetWebrtcSyUpperHeader", n)
        }
        return ""
    }

    function GetWebrtcSyUpperDomainHeader(e) {
        try {
            var o = GetParameter("upperserverd");
            isNull(o) && (o = "");
            var t = GetConfig("wsuser");
            if (!isNull(t) && t.length > 10) {
                var n = GetParameter("upperserverdomain");
                if (!isNull(n) && Trim(n).length > 0) return n
            }
            if (o.length > 0) {
                var i = GetConfig("transport");
                return !isNull(i) && i.length > 0 && (i.indexOf(":") < 0 && (i = ":" + i), o = i + o), o
            }
        } catch (a) {
            PutToDebugLogException(2, "common: GetWebrtcSyUpperHeader", a)
        }
        return ""
    }

    function GetUpperProxyHeaderForSignaling() {
        var e = "";
        try {
            if (e = GetParameter("upperproxy"), !isNull(e) && Trim(e).length > 0) return e;
            var o = GetConfig("wsuser");
            if (!isNull(o) && o.length > 10 && (e = GetUrlParamVal(o, "proxyaddress"), !isNull(e) && Trim(e).length > 0)) return e;
            if (e = GetParameter("proxyaddress"), !isNull(e) && Trim(e).length > 0) return e
        } catch (t) {
            PutToDebugLogException(2, "_filetransfer:  GetUpperProxyHeaderForSignaling", t)
        }
        return ""
    }

    function GetWebrtcSrvAddr() {
        return GetBestWsAddress()
    }

    function HandleAddress(e) {
        try {
            if (isNull(e) || e.length < 1) return "";
            e = e.toLowerCase(), e = Trim(e);
            var o = !1;
            location.host.toLowerCase();
            !0 !== PreferWss() && !0 !== IsHttps() || (o = !0), !0 === o && 0 === e.indexOf("ws:") && (e = e.replace("ws:", "wss:")), e.indexOf("ws:") < 0 && e.indexOf("wss:") < 0 && (e = !0 === o ? "wss://" + e : "ws://" + e), e.indexOf("?") > 0 && (e = e.substring(0, e.indexOf("?")))
        } catch (t) {
            PutToDebugLogException(2, "common: HandleAddress", t)
        }
        return e
    }

    function AddWsAddress(e, o) {
        try {
            if (isNull(e) || !e.address || isNull(e.address) || e.address.length < 4) return void PutToDebugLog(2, "ERROR, AddWsAddress invalid object");
            if (isNull(wsrvL) && (wsrvL = []), wsrvL.length > 0) for (var t = 0; t < wsrvL.length; t++) if (wsrvL[t].address === e.address) return void (wsrvL[t].answertime < 2 && (wsrvL[t].answertime = e.answertime, wsrvL[t].load = e.load));
            var n = GetParameter("lastwebrtcserver");
            !isNull(n) && n.length > 3 && n === e.address && (e.answertime = e.answertime - 20), wsrvL.push(e), GetBestWsAddress(o)
        } catch (i) {
            PutToDebugLogException(2, "common: AddWsAddress", i)
        }
    }

    function GetBestWsAddress(e) {
        try {
            if (!isNull(selectedwserver) && selectedwserver.length > 3) return selectedwserver;
            var o = "";
            if ("undefined" != typeof webphone_api.parameters.webrtcserveraddress && null !== webphone_api.parameters.webrtcserveraddress ? o = webphone_api.parameters.webrtcserveraddress : "undefined" != typeof webphone_api.parameters.webrtcserver && null !== webphone_api.parameters.webrtcserver ? o = webphone_api.parameters.webrtcserver : "undefined" != typeof webphone_api.parameters.webrtcaddress && null !== webphone_api.parameters.webrtcaddress ? o = webphone_api.parameters.webrtcaddress : "undefined" != typeof webphone_api.parameters.rtcserver && null !== webphone_api.parameters.rtcserver ? o = webphone_api.parameters.rtcserver : "undefined" != typeof webphone_api.parameters.rtcaddress && null !== webphone_api.parameters.rtcaddress && (o = webphone_api.parameters.rtcaddress), void 0 !== o && null !== o && o.length > 3 && o.indexOf(",") < 0) return selectedwserver = o;
            if (!1 === decide_already_run) return DecideWebrtcServer(), "";
            if (!0 === e) return selectedwserver = wsrvL[0].address, webphone_api.global.recwsload = wsrvL[0].load, webphone_api.global.selected_apikey = wsrvL[0].apikey, SaveParameter("lastwebrtcserver", selectedwserver), selectedwserver;
            isNull(addrtimer) && (ADDR_TIMERSTART = GetTickCount(), addrtimer = setInterval(function () {
                if (addr_maxloop > 60 || !isNull(selectedwserver) && selectedwserver.length > 3) return isNull(addrtimer) || clearInterval(addrtimer), void (addrtimer = null);
                var e = null;
                if (!isNull(wsrvL) && wsrvL.length > 0) for (var o = 0; o < wsrvL.length; o++) !0 !== wsrvL[o].worked || wsrvL[o].load < 0 || (isNull(e) && wsrvL[o].answertime < 9e4 && wsrvL[o].load < 2 || e.answertime > wsrvL[o].answertime && wsrvL[o].load < 2) && (e = wsrvL[o]);
                if (!isNull(e)) return selectedwserver = e.address, webphone_api.global.recwsload = e.load, webphone_api.global.selected_apikey = e.apikey, isNull(addrtimer) || clearInterval(addrtimer), addrtimer = null, void (!0 === IsUKGateway(selectedwserver) ? webphone_api.global.usuk = "uk" : !0 === IsUSGateway(selectedwserver) && (webphone_api.global.usuk = "us"));
                var t = GetTickCount(), n = !0, i = !1;
                wsrvL.length < 1 && (n = !1);
                for (var o = 0; o < wsrvL.length; o++) wsrvL[o].load < 0 ? n = !1 : i = !0;
                if (!0 === n || t - ADDR_TIMERSTART >= 3e3 && !0 === i || t - ADDR_TIMERSTART >= 6e3) {
                    for (var a = wsrvL.length, r = 0, o = 0; o < a && (wsrvL[o].load < 0 && (wsrvL.push(wsrvL.splice(o, 1)[0]), o < a - 1 && o--), !(++r > 3 * a)); o++);
                    for (var o = 0; o < a; o++) for (var s = o + 1; s < a; s++) if (wsrvL[o].load > -1 && wsrvL[s].load > -1 && wsrvL[o].load > wsrvL[s].load) {
                        var l = wsrvL[o];
                        wsrvL[o] = wsrvL[s], wsrvL[s] = l
                    }
                    for (var p = -1, o = 0; o < a; o++) wsrvL[o].load < 0 || (p < 0 && (p = wsrvL[o].load), isNull(e) && (e = wsrvL[o]), wsrvL[o].load > p || e.answertime > wsrvL[o].answertime && (e = wsrvL[o]))
                }
                isNull(e) || (selectedwserver = e.address, webphone_api.global.recwsload = e.load, webphone_api.global.selected_apikey = e.apikey, isNull(addrtimer) || clearInterval(addrtimer), addrtimer = null, !0 === IsUKGateway(selectedwserver) ? webphone_api.global.usuk = "uk" : !0 === IsUSGateway(selectedwserver) && (webphone_api.global.usuk = "us"))
            }, 100))
        } catch (t) {
            PutToDebugLogException(2, "common: GetBestWsAddress", t)
        }
        return ""
    }

    function GetSpecialWsloadUrl(e) {
        try {
            var o = GetWsloadUrl(GetSipusername()), t = o.indexOf("://");
            if (t > 0) {
                var n = o.substring(0, t + 3), i = o.substring(t + 3);
                i = i.substring(i.indexOf("/"));
                o = n + NormalizeInput(e, 0) + i
            }
            return o
        } catch (a) {
            PutToDebugLogException(2, "common: GetSpecialWsloadUrl", a)
        }
        return ""
    }

    function IsUKGateway(e) {
        try {
            if (isNull(e) || e.length < 3) return !1;
            isNull(uk_ip) && (uk_ip = StrDc(wip_uk, alsvkey), uk_domain = StrDc(wips_uk, alsvkey));
            var o = -1;
            if (uk_ip = uk_ip.replace("ws://", ""), o = uk_ip.lastIndexOf("/"), o > 0 && (uk_ip = uk_ip.substring(0, o)), o = uk_ip.lastIndexOf(":"), o > 0 && (uk_ip = uk_ip.substring(0, o)), uk_domain = uk_domain.replace("wss://", ""), o = uk_domain.lastIndexOf("/"), o > 0 && (uk_domain = uk_domain.substring(0, o)), o = uk_domain.lastIndexOf(":"), o > 0 && (uk_domain = uk_domain.substring(0, o)), e.indexOf(uk_ip) >= 0 || e.indexOf(uk_domain) >= 0) return !0
        } catch (t) {
            PutToDebugLogException(2, "common: IsUKGateway", t)
        }
        return !1
    }

    function IsUSGateway(e) {
        try {
            if (isNull(e) || e.length < 3) return !1;
            isNull(us_ip) && (us_ip = StrDc(wip_us, alsvkey), us_domain = StrDc(wips_us, alsvkey));
            var o = -1;
            if (us_ip = us_ip.replace("ws://", ""), o = us_ip.lastIndexOf("/"), o > 0 && (us_ip = us_ip.substring(0, o)), o = us_ip.lastIndexOf(":"), o > 0 && (us_ip = us_ip.substring(0, o)), us_domain = us_domain.replace("wss://", ""), o = us_domain.lastIndexOf("/"), o > 0 && (us_domain = us_domain.substring(0, o)), o = us_domain.lastIndexOf(":"), o > 0 && (us_domain = us_domain.substring(0, o)), e.indexOf(us_ip) >= 0 || e.indexOf(us_domain) >= 0) return !0
        } catch (t) {
            PutToDebugLogException(2, "common: IsUSGateway", t)
        }
        return !1
    }

    function ClassWServers() {
        this.address = "", this.worked = !1, this.answertime = 99999, this.load = -1, this.apikey = ""
    }

    function DecideWebrtcServer() {
        try {
            if (!isNull(selectedwserver) && selectedwserver.length > 3) return;
            if (!0 === decide_already_run) return void PutToDebugLog(2, "ERROR, DecideWebrtcServer already run");
            var e = GetParameter("webrtcserveraddress");
            if (isNull(e) || e.length < 4) return;
            if (e.indexOf(",") < 0) {
                e.indexOf("://") < 0 && (e = IsHttps() || !1 === IsIPAddrress(e) ? "wss://" + e : "ws://" + e), selectedwserver = e;
                var o = "", t = selectedwserver.indexOf("authkey=");
                return void (t > 0 && (o = selectedwserver.substring(t + 8), selectedwserver = selectedwserver.substring(0, t), isNull(o) && (o = ""), t = o.indexOf("&"), t > 0 && (o = o.substring(0, t)), o = Trim(o), webphone_api.global.selected_apikey = api_key, !0 === IsUKGateway(selectedwserver) ? webphone_api.global.usuk = "uk" : !0 === IsUSGateway(selectedwserver) && (webphone_api.global.usuk = "us")))
            }
            for (var n = e.split(","), i = 0; i < n.length;) isNull(n[i]) || n[i].length < 4 ? n.splice(i, 1) : i++;
            if (isNull(n) || n.length < 1) return;
            for (var a = !0, r = n.length, s = 0; s < r; s++) if (n[s].toLowerCase().indexOf("mfstwebsock") < 1 && n[s].toLowerCase().indexOf("mvstwebsock") < 1) {
                a = !1;
                break
            }
            n = ShuffleArray(n);
            var l = GetParameter("lastwebrtcserver"), p = GetParameter("topprioritywebrtcserver");
            if (!isNull(p) && p.length > 0) for (var s = 0; s < r; s++) if (n[s] === p) {
                var c = splice(s, 1);
                n.unshift(c);
                break
            }
            if (!isNull(l) && l.length > 0) for (var s = 0; s < r; s++) if (n[s] === l) {
                var c = splice(s, 1);
                n.unshift(c);
                break
            }
            var u = GetTickCount();
            if (wsrvL = [], isNull(addrtimer) || clearInterval(addrtimer), addrtimer = null, addr_maxloop = 0, decide_already_run = !0, !0 === a) for (var s = 0; s < r; s++) !function () {
                function e() {
                    !isNull(c) && c.close && c.close(), c = null
                }

                var o = s, t = new ClassWServers;
                try {
                    var i = n[o], a = "", r = i.indexOf("authkey=");
                    r > 0 && (a = i.substring(r + 8), isNull(a) && (a = ""), r = a.indexOf("&"), r > 0 && (a = a.substring(0, r)), a = Trim(a));
                    var l = !1;
                    i.indexOf("mfstwebsock") > 0 && (l = !0);
                    var p = HandleAddress(i);
                    t.address = p, t.apikey = a, PutToDebugLog(2, "EVENT, DecideWebrtcServer (" + o + ") url: " + p);
                    var c = new WebSocket(p, "sip");
                    c.binaryType = "arraybuffer", c.onopen = function () {
                        h = !0
                    };
                    var u = 0, h = !1, m = setInterval(function () {
                        u++, 1 === c.readyState && !0 === h && !0 === l && (d = GetTickCount(), c.send("mrtcping\r\n")), (u > 25 || 1 === c.readyState) && (isNull(m) || clearInterval(m), m = null)
                    }, 100), g = -1, d = 0;
                    c.onerror = function () {
                        t.worked = !1, AddWsAddress(t)
                    }, c.onclose = function () {
                        t.worked = !1, AddWsAddress(t)
                    }, c.onmessage = function (n) {
                        var i = null;
                        if (isNull(n) || (i = n.data), !isNull(i)) {
                            var a = ArrayBufferToString(i);
                            if (a = a.toLowerCase(), a.indexOf("mrtcpong") >= 0) {
                                g = GetTickCount() - d, t.answertime = g;
                                var s = GetSpecialWsloadUrl(p);
                                PutToDebugLog(2, "EVENT, DecideWebrtcServer send wsload (" + o + ") url: " + p + "; answertime: " + g.toString() + "; url: " + s), c.send(s + "\r\n")
                            } else {
                                var l = a;
                                if ((r = l.indexOf("ws load:")) >= 0) {
                                    l = l.substring(r + 8), l = Trim(l), r = l.indexOf(" "), r > 0 && (l = l.substring(0, r));
                                    var u = -1;
                                    !isNull(l) && IsNumber(l) && (u = StrToInt(l)), t.load = u, PutToDebugLog(2, "EVENT, DecideWebrtcServer rec wsload (" + o + ") url: " + p + "; answertime: " + g.toString() + "; load: " + l), AddWsAddress(t), e()
                                }
                            }
                        }
                    }, setTimeout(function () {
                        e()
                    }, 6500)
                } catch (b) {
                    t.worked = !1, PutToDebugLogException(2, "DecideWebrtcServer (" + o + ") failure", b)
                }
            }(); else {
                var h = 0;
                if (h < r) {
                    var m = h, g = new ClassWServers;
                    try {
                        var d = HandleAddress(n[m]);
                        g.address = d, PutToDebugLog(2, "EVENT, DecideWebrtcServerT (" + m + ") url: " + d);
                        var b = new WebSocket(d, "sip");
                        b.binaryType = "arraybuffer", b.onopen = function () {
                            var e = GetTickCount() - u;
                            g.answertime = e, g.worked = !0, PutToDebugLog(2, "EVENT, DecideWebrtcServerT onopen (" + m + ") url: " + d + "; answertime: " + e.toString()), !isNull(b) && b.close && b.close(), b = null, AddWsAddress(g, !0)
                        }
                    } catch (_) {
                        g.worked = !1, PutToDebugLogException(2, "DecideWebrtcServerT (" + m + ") failed to connect", _)
                    }
                }
                if (++h < r) {
                    var m = h, g = new ClassWServers;
                    try {
                        var d = HandleAddress(n[m]);
                        g.address = d, PutToDebugLog(2, "EVENT, DecideWebrtcServerT (" + m + ") url: " + d);
                        var b = new WebSocket(d, "sip");
                        b.binaryType = "arraybuffer", b.onopen = function () {
                            var e = GetTickCount() - u;
                            g.answertime = e, g.worked = !0, PutToDebugLog(2, "EVENT, DecideWebrtcServerT onopen (" + m + ") url: " + d + "; answertime: " + e.toString()), !isNull(b) && b.close && b.close(), b = null, AddWsAddress(g, !0)
                        }
                    } catch (_) {
                        g.worked = !1, PutToDebugLogException(2, "DecideWebrtcServerT (" + m + ") failed to connect", _)
                    }
                }
                if (++h < r) {
                    var m = h, g = new ClassWServers;
                    try {
                        var d = n[m];
                        g.address = d, PutToDebugLog(2, "EVENT, DecideWebrtcServerT (" + m + ") url: " + d);
                        var b = new WebSocket(d, "sip");
                        b.binaryType = "arraybuffer", b.onopen = function () {
                            var e = GetTickCount() - u;
                            g.answertime = e, g.worked = !0, PutToDebugLog(2, "EVENT, DecideWebrtcServerT onopen (" + m + ") url: " + d + "; answertime: " + e.toString()), !isNull(b) && b.close && b.close(), b = null, AddWsAddress(g, !0)
                        }
                    } catch (_) {
                        g.worked = !1, PutToDebugLogException(2, "DecideWebrtcServerT (" + m + ") failed to connect", _)
                    }
                }
                if (++h < r) {
                    var m = h, g = new ClassWServers;
                    try {
                        var d = n[m];
                        g.address = d, PutToDebugLog(2, "EVENT, DecideWebrtcServerT (" + m + ") url: " + d);
                        var b = new WebSocket(d, "sip");
                        b.binaryType = "arraybuffer", b.onopen = function () {
                            var e = GetTickCount() - u;
                            g.answertime = e, g.worked = !0, PutToDebugLog(2, "EVENT, DecideWebrtcServerT onopen (" + m + ") url: " + d + "; answertime: " + e.toString()), !isNull(b) && b.close && b.close(), b = null, AddWsAddress(g, !0)
                        }
                    } catch (_) {
                        g.worked = !1, PutToDebugLogException(2, "DecideWebrtcServerT (" + m + ") failed to connect", _)
                    }
                }
                if (++h < r) {
                    var m = h, g = new ClassWServers;
                    try {
                        var d = n[m];
                        g.address = d, PutToDebugLog(2, "EVENT, DecideWebrtcServerT (" + m + ") url: " + d);
                        var b = new WebSocket(d, "sip");
                        b.binaryType = "arraybuffer", b.onopen = function () {
                            var e = GetTickCount() - u;
                            g.answertime = e, g.worked = !0, PutToDebugLog(2, "EVENT, DecideWebrtcServerT onopen (" + m + ") url: " + d + "; answertime: " + e.toString()), !isNull(b) && b.close && b.close(), b = null, AddWsAddress(g, !0)
                        }
                    } catch (_) {
                        g.worked = !1, PutToDebugLogException(2, "DecideWebrtcServerT (" + m + ") failed to connect", _)
                    }
                }
                if (++h < r) {
                    var m = h, g = new ClassWServers;
                    try {
                        var d = n[m];
                        g.address = d, PutToDebugLog(2, "EVENT, DecideWebrtcServerT (" + m + ") url: " + d);
                        var b = new WebSocket(d, "sip");
                        b.binaryType = "arraybuffer", b.onopen = function () {
                            var e = GetTickCount() - u;
                            g.answertime = e, g.worked = !0, PutToDebugLog(2, "EVENT, DecideWebrtcServerT onopen (" + m + ") url: " + d + "; answertime: " + e.toString()), !isNull(b) && b.close && b.close(), b = null, AddWsAddress(g, !0)
                        }
                    } catch (_) {
                        g.worked = !1, PutToDebugLogException(2, "DecideWebrtcServerT (" + m + ") failed to connect", _)
                    }
                }
                if (++h < r) {
                    var m = h, g = new ClassWServers;
                    try {
                        var d = n[m];
                        g.address = d, PutToDebugLog(2, "EVENT, DecideWebrtcServerT (" + m + ") url: " + d);
                        var b = new WebSocket(d, "sip");
                        b.binaryType = "arraybuffer", b.onopen = function () {
                            var e = GetTickCount() - u;
                            g.answertime = e, g.worked = !0, PutToDebugLog(2, "EVENT, DecideWebrtcServerT onopen (" + m + ") url: " + d + "; answertime: " + e.toString()), !isNull(b) && b.close && b.close(), b = null, AddWsAddress(g, !0)
                        }
                    } catch (_) {
                        g.worked = !1, PutToDebugLogException(2, "DecideWebrtcServerT (" + m + ") failed to connect", _)
                    }
                }
                if (++h < r) {
                    var m = h, g = new ClassWServers;
                    try {
                        var d = n[m];
                        g.address = d, PutToDebugLog(2, "EVENT, DecideWebrtcServerT (" + m + ") url: " + d);
                        var b = new WebSocket(d, "sip");
                        b.binaryType = "arraybuffer", b.onopen = function () {
                            var e = GetTickCount() - u;
                            g.answertime = e, g.worked = !0, PutToDebugLog(2, "EVENT, DecideWebrtcServerT onopen (" + m + ") url: " + d + "; answertime: " + e.toString()), !isNull(b) && b.close && b.close(), b = null, AddWsAddress(g, !0)
                        }
                    } catch (_) {
                        g.worked = !1, PutToDebugLogException(2, "DecideWebrtcServerT (" + m + ") failed to connect", _)
                    }
                }
                if (++h < r) {
                    var m = h, g = new ClassWServers;
                    try {
                        var d = n[m];
                        g.address = d, PutToDebugLog(2, "EVENT, DecideWebrtcServerT (" + m + ") url: " + d);
                        var b = new WebSocket(d, "sip");
                        b.binaryType = "arraybuffer", b.onopen = function () {
                            var e = GetTickCount() - u;
                            g.answertime = e, g.worked = !0, PutToDebugLog(2, "EVENT, DecideWebrtcServerT onopen (" + m + ") url: " + d + "; answertime: " + e.toString()), !isNull(b) && b.close && b.close(), b = null, AddWsAddress(g, !0)
                        }
                    } catch (_) {
                        g.worked = !1, PutToDebugLogException(2, "DecideWebrtcServerT (" + m + ") failed to connect", _)
                    }
                }
                if (++h < r) {
                    var m = h, g = new ClassWServers;
                    try {
                        var d = n[m];
                        g.address = d, PutToDebugLog(2, "EVENT, DecideWebrtcServerT (" + m + ") url: " + d);
                        var b = new WebSocket(d, "sip");
                        b.binaryType = "arraybuffer", b.onopen = function () {
                            var e = GetTickCount() - u;
                            g.answertime = e, g.worked = !0, PutToDebugLog(2, "EVENT, DecideWebrtcServerT onopen (" + m + ") url: " + d + "; answertime: " + e.toString()), !isNull(b) && b.close && b.close(), b = null, AddWsAddress(g, !0)
                        }
                    } catch (_) {
                        g.worked = !1, PutToDebugLogException(2, "DecideWebrtcServerT (" + m + ") failed to connect", _)
                    }
                }
                h++
            }
        } catch (f) {
            PutToDebugLogException(2, "common: DecideWebrtcServer", f)
        }
    }

    function ShuffleArray(e) {
        try {
            var o, t, n, i = e;
            for (n = i.length - 1; n > 0; n--) o = Math.floor(Math.random() * (n + 1)), t = i[n], i[n] = i[o], i[o] = t;
            return i
        } catch (a) {
            PutToDebugLogException(2, "common: ShuffleArray", a)
        }
        return e
    }

    function Engine() {
        this.name, this.cfg_priority, this.defpriority, this.available, this.serversupport, this.finalscore, this.finalscorex, this.pushlevel, this.failed, this.clicked, this.issupported_cache, this.isinstalled_cache, this.serversupport_cache, this.available_old, this.asyncreqbegintime
    }

    function GetEngineList() {
        return engines
    }

    function GetSelectedEngine() {
        return selected_engine
    }

    function GetRecommendedEngine() {
        return recommend_engine
    }

    function GetSelectedEngineName() {
        try {
            if (!isNull(selected_engine) && !isNull(selected_engine.name)) return selected_engine.name
        } catch (e) {
            PutToDebugLogException(2, "common: GetSelectedEngineName", e)
        }
        return null
    }

    function GetRecommendedEngineName() {
        try {
            if (!isNull(recommend_engine) && !isNull(recommend_engine.name)) return recommend_engine.name
        } catch (e) {
            PutToDebugLogException(2, "common: GetRecommendedEngineName", e)
        }
        return null
    }

    function GetEngine(e) {
        try {
            if (isNull(engines)) return null;
            for (var o, t = 0; t < engines.length; t++) if (o = engines[t], o.name === e) return o
        } catch (n) {
            PutToDebugLogException(2, "common: GetEngine", n)
        }
        return null
    }

    function SetEngine(e, o) {
        try {
            if (isNull(e) || e.length < 1) return PutToDebugLog(2, "ERROR, common SetEngine invalid engine name: " + e), !1;
            if (isNull(o)) return PutToDebugLog(2, "ERROR, common SetEngine invalid engine object"), !1;
            if (isNull(engines)) return PutToDebugLog(2, "ERROR, common SetEngine engines is NULL"), !1;
            for (var t = 0; t < engines.length; t++) engines[t].name === e && (engines[t] = o)
        } catch (n) {
            PutToDebugLogException(2, "common: GetEngine", n)
        }
        return !1
    }

    function ResetEngineClicked() {
        try {
            if (isNull(engines)) return PutToDebugLog(2, "ERROR, common ResetEngineClicked engines is NULL"), !1;
            for (var e, o = 0; o < engines.length; o++) e = engines[o], e.clicked = 0, engines[o] = e
        } catch (t) {
            PutToDebugLogException(2, "common: ResetEngineClicked", t)
        }
    }

    function HasUsableEngine(e) {
        try {
            if (isNull(engines)) return !1;
            for (var o, t = 0; t < engines.length; t++) if (o = engines[t], o.available > 1 && o.failed < 1 && e.name !== o.name && o.name.indexOf("_avail") < 0 && o.defpriority > 0) return !0
        } catch (n) {
            PutToDebugLogException(2, "common: HasUsableEngine", n)
        }
        return !1
    }

    function HasUsableEngineFromEngines(e, o) {
        try {
            if (isNull(engines)) return !1;
            for (var t, n = 0; n < engines.length; n++) if (t = engines[n], !(o.indexOf(t.name) < 0) && t.available > 1 && t.failed < 1 && e.name !== t.name && t.name.indexOf("_avail") < 0 && t.defpriority > 0) return !0
        } catch (i) {
            PutToDebugLogException(2, "common: HasUsableEngineFromEngines", i)
        }
        return !1
    }

    function IsMizuWebRTCGateway2() {
        try {
            return GetConfigInt("ismrtcgateway", 0) > 0 || (webphone_api.global.wsload_type > 0 || IsMizuWebRTCGateway())
        } catch (e) {
            PutToDebugLogException(2, "common: IsMizuWebRTCGateway2", e)
        }
        return !1
    }

    function IsMizuWebRTCGateway() {
        try {
            var e = GetWebrtcSrvAddr();
            if (isNull(e) || e.length < 2) return !0;
            e = e.toLowerCase(), e = NormalizeInput(e, 0), e = e.replace("*", "");
            var o = e.indexOf("/");
            o > 0 && (e = e.substring(0, o));
            var o = 0, t = StrDc(wip_uk, alsvkey);
            t = t.toLowerCase(), t = NormalizeInput(t, 0), t = t.replace("*", ""), o = t.indexOf(":"), o > 0 && (t = t.substring(0, o)), o = t.indexOf("/"), o > 0 && (t = t.substring(0, o));
            var n = StrDc(wips_uk, alsvkey);
            n = n.toLowerCase(), n = NormalizeInput(n, 0), n = n.replace("*", ""), o = n.indexOf(":"), o > 0 && (n = n.substring(0, o)), o = n.indexOf("/"), o > 0 && (n = n.substring(0, o));
            var i = StrDc(wip_us, alsvkey);
            i = i.toLowerCase(), i = NormalizeInput(i, 0), i = i.replace("*", ""), o = i.indexOf(":"), o > 0 && (i = i.substring(0, o)), o = i.indexOf("/"), o > 0 && (i = i.substring(0, o));
            var a = StrDc(wips_us, alsvkey);
            if (a = a.toLowerCase(), a = NormalizeInput(a, 0), a = a.replace("*", ""), o = a.indexOf(":"), o > 0 && (a = a.substring(0, o)), o = a.indexOf("/"), o > 0 && (a = a.substring(0, o)), t === e || n === e || i === e || a === e) return !0
        } catch (r) {
            PutToDebugLogException(2, "common: IsMizuWebRTCGateway", r)
        }
        return !1
    }

    function IsMizuWebRTCEmbeddedServer() {
        try {
            var e = GetWebrtcSrvAddr();
            if (isNull(e) || e.length < 2) return !1;
            if (e.indexOf("*") >= 0 || e.indexOf("mfstwebsock") > 0) return !0
        } catch (o) {
            PutToDebugLogException(2, "common: IsMizuWebRTCEmbeddedServer", o)
        }
        return !1
    }

    function IsMizuServer() {
        try {
            var e = webphone_api.parameters.webrtcserveraddress;
            if ((isNull(e) || e.length < 2) && (e = GetConfig("webrtcserveraddress"), (isNull(e) || e.length < 2) && (e = GetWp())), isNull(e) && (e = ""), e = e.toLowerCase(), e.indexOf("mfstwebsock") > 0) return !0
        } catch (o) {
            PutToDebugLogException(2, "common: IsMizuServer", o)
        }
        return !1
    }

    function CanIUseApplet() {
        try {
            var e = GetBrowserVersion(), o = GetBrowser(), t = GetOs(), n = webphone_api.getmaxchromeversionforjava();
            if (PutToDebugLog(4, "CanIUseApplet, OS: " + t + "; browser: " + o), "Windows" === t) {
                if ("Chrome" === o) return !(isNull(e) || IsNumber(e) && (e < 1 || e > n));
                if ("Firefox" === o) {
                    var i = GetParameterInt("nojavaforff", 52);
                    return !(!0 === Is64BitBrowser() || GetBrowserVersion() >= i) || (PutToDebugLog(4, "CanIUseApplet, nojavaforff: " + i), !1)
                }
                return "Safari" === o ? GetBrowserVersion() < 6 : "Edge" !== o
            }
            if ("Mac" === t) return "Chrome" === o ? !(isNull(e) || IsNumber(e) && (e < 1 || e > n)) : "Safari" !== o || !!(!isNull(e) && IsNumber(e) && e > 0 && e < 7);
            if ("Linux" === t) return "Chrome" !== o || !(isNull(e) || IsNumber(e) && (e < 1 || e > n))
        } catch (a) {
            PutToDebugLogException(2, "common: CanIUseApplet", a)
        }
        return !1
    }

    function CanIUseWebRTC() {
        try {
            if (lversion <= 0) {
                var e = [];
                if ("Android" === GetOs() || "iOS" === GetOs()) {
                    e.push("D"), e.push("e"), e.push("s"), e.push("k"), e.push("t"), e.push("o"), e.push("p"), e.push(" "), e.push("o"), e.push("n"), e.push("l"), e.push("y"), e.push("_");
                    var o = e.join("");
                    setTimeout(function () {
                        PutToDebugLog(1, "ERROR, " + o)
                    }, 500)
                }
                return !1
            }
            if (1 === lversion && !1 === Glsp()) {
                var e = [];
                e.push("D"), e.push("e"), e.push("s"), e.push("k"), e.push("t"), e.push("o"), e.push("p"), e.push(" "), e.push("o"), e.push("n"), e.push("l"), e.push("y"), e.push("_");
                var o = e.join("");
                return setTimeout(function () {
                    PutToDebugLog(1, "ERROR, " + o)
                }, 510), !1
            }
            if (IsMizuWebRTCGateway() && IsLanIP(GetWebrtcUpperServer())) return PutToDebugLog(2, "EVENT, CanIUseWebRTC server is on local network"), !1;
            if ("iOS" === GetOs()) {
                if ("Safari" !== GetBrowser() && "iPhone" !== GetBrowser()) return !1;
                if (GetBrowserVersion() < 11) return !1
            }
            if (75 !== GetParameterInt("brandid", -1)) {
                var t = webphone_api.parameters.webrtcserveraddress;
                if ((isNull(t) || Trim(t).length < 1) && (t = GetConfig("webrtcserveraddress")), isNull(t) || Trim(t).length < 1) {
                    var n = webphone_api.webrtcapi.GetUDPServerAddress();
                    if (isNull(n) && (n = ""), n = n.replace("udp://", ""), n.length > 0 && !1 === IsIPAddrress(n)) if (n.length > 0 && (GetConfig("serverip") === n || GetConfig("server") === n || GetConfig("knownip") === n)) PutToDebugLog(2, "EVENT, CanIUseWebRTC: skip dtisrv"), canresolvedomain = !0; else {
                        var i = GetParameterInt("enginepriority_java", 2),
                            a = GetParameterInt("enginepriority_webrtc", 2),
                            r = GetParameterInt("enginepriority_ns", 2), s = GetParameterInt("enginepriority_flash", 2);
                        a > 2 || a > i && a > r && a > s || DomainToIpServer(n, function (e) {
                            isNull(e) || e.length < 1 || (canresolvedomain = !(e.indexOf("cannotresolve") >= 0))
                        })
                    }
                    if (!1 === canresolvedomain) return PutToDebugLog(2, "EVENT, CanIUseWebRTC WebRTC NOT available: Cannot resolve SIP server domain: " + n), !1
                }
            }
            if (webphone_api.global.webrtcavailable < 1) return PutToDebugLog(2, "EVENT, CanIUseWebRTC WebRTC NOT available in this environment: " + webphone_api.global.webrtcavailable.toString()), !1;
            if (0 === GetConfigInt("usemizuwebrtcgateway", 1) && GetWebrtcSrvAddr().length < 2) return PutToDebugLog(2, "WARNING, CanIUseWebRTC WebRTC available but there is no webrtc server"), !1;
            if ("Windows" === GetOs()) {
                if ("MSIE" === GetBrowser()) return !1;
                if ("Edge" === GetBrowser() && GetBrowserVersion() < 14) return !1
            }
            return !0
        } catch (l) {
            PutToDebugLogException(2, "common: CanIUseWebRTC", l)
        }
        return !1
    }

    function CanIUseService() {
        try {
            if ("Windows" !== GetOs() && !IsMacLin() || IsMacLin() && !1 === NSMacLinEnabled()) return PutToDebugLog(2, "EVENT, CanIUseService not windows/mac/linux: false"), !1;
            var e = StrToInt(GetParameter2("enginepriority_java")),
                o = StrToInt(GetParameter2("enginepriority_webrtc")), t = StrToInt(GetParameter2("enginepriority_ns")),
                n = StrToInt(GetParameter2("enginepriority_flash")), i = StrToInt(GetParameter2("enginepriority_app")),
                a = StrToInt(GetParameter2("enginepriority_p2p")),
                r = StrToInt(GetParameter2("enginepriority_accessnum")),
                s = StrToInt(GetParameter2("enginepriority_nativedial")), l = !1;
            if (!isNull(e) && IsNumber(e) || (l = !0, e = 2), !isNull(o) && IsNumber(o) || (l = !0, o = 2), !isNull(t) && IsNumber(t) || (l = !0, t = 2), !isNull(n) && IsNumber(n) || (l = !0, n = 2), !isNull(i) && IsNumber(i) || (l = !0, i = 2), !isNull(a) && IsNumber(a) || (l = !0, a = 2), !isNull(r) && IsNumber(r) || (l = !0, r = 2), !isNull(s) && IsNumber(s) || (l = !0, s = 2), !0 === l && PutToDebugLog(2, "EVENT, CanIUseService priorities are NULL, probably couldnt read settings"), t < 1 || e > 4 || o > 4 || n > 4 || i > 4 || a > 4 || r > 4 || s > 4) return PutToDebugLog(2, "EVENT, CanIUseService: false, other forced"), !1;
            if (lversion <= 0) return !1;
            if (1 === lversion && !1 === Glsp()) {
                var p = [];
                p.push("D"), p.push("e"), p.push("s"), p.push("k"), p.push("t"), p.push("o"), p.push("p"), p.push(" "), p.push("o"), p.push("n"), p.push("l"), p.push("y"), p.push("_"), p.push("2");
                var c = p.join("");
                return setTimeout(function () {
                    PutToDebugLog(1, "ERROR, " + c)
                }, 620), !1
            }
            if (window.WebSocket) return PutToDebugLog(2, "EVENT, CanIUseService_1 true"), !0;
            if ("Chrome" === GetBrowser()) return PutToDebugLog(2, "EVENT, CanIUseService_2 true"), !0;
            PutToDebugLog(2, "EVENT, CanIUseService final false")
        } catch (u) {
            PutToDebugLogException(2, "common: CanIUseService", u)
        }
        return !1
    }

    function CanIUseFlash() {
        try {
            if (PutToDebugLog("EVENT, CanIUseFlash__1"), IsLocalServer(!0)) return PutToDebugLog("EVENT, CanIUseFlash__2"), PutToDebugLog(2, "EVENT, Cannot use flash (can i use this engine) server to connect to local network VoIP server"), !1;
            if (lversion <= 0) {
                PutToDebugLog("EVENT, CanIUseFlash__3");
                var e = [];
                if ("Android" === GetOs() || "iOS" === GetOs()) {
                    e.push("D"), e.push("e"), e.push("s"), e.push("k"), e.push("t"), e.push("o"), e.push("p"), e.push(" "), e.push("o"), e.push("n"), e.push("l"), e.push("y"), e.push("_"), e.push("3");
                    var o = e.join("");
                    setTimeout(function () {
                        PutToDebugLog(1, "ERROR, " + o)
                    }, 650)
                }
                return !1
            }
            if (1 === lversion && (PutToDebugLog("EVENT, CanIUseFlash__4"), !1 === Glsp())) {
                e.push("D"), e.push("e"), e.push("s"), e.push("k"), e.push("t"), e.push("o"), e.push("p"), e.push(" "), e.push("o"), e.push("n"), e.push("l"), e.push("y"), e.push("_"), e.push("3");
                var o = e.join("");
                return setTimeout(function () {
                    PutToDebugLog(1, "ERROR, " + o)
                }, 680), !1
            }
            PutToDebugLog("EVENT, CanIUseFlash__5");
            var t = GetParameterInt("enginepriority_java", 2), n = GetParameterInt("enginepriority_webrtc", 2),
                i = GetParameterInt("enginepriority_ns", 2), a = GetParameterInt("enginepriority_flash", 2),
                r = GetParameterInt("enginepriority_app", 2), s = GetParameterInt("enginepriority_p2p", 2),
                l = GetParameterInt("enginepriority_accessnum", 2), p = GetParameterInt("enginepriority_nativedial", 2);
            if (PutToDebugLog("EVENT, CanIUseFlash__6"), a > 2 || t < a && n < a && i < a && r < a && s < a && l < a && p < a) {
                if (PutToDebugLog("EVENT, CanIUseFlash__7 old style detect"), webphone_api.flashdeepdetect = !0, webphone_api.swfobject.hasFlashPlayerVersion("9.0.115")) return !0
            } else {
                PutToDebugLog("EVENT, CanIUseFlash__8");
                try {
                    var c = navigator.plugins["ShockwaveFlash.ShockwaveFlash"];
                    if (c) return PutToDebugLog("EVENT, CanIUseFlash__9"), !0;
                    if (PutToDebugLog("EVENT, CanIUseFlash__10"), c = new ActiveXObject("ShockwaveFlash.ShockwaveFlash")) return !0
                } catch (u) {
                    if (PutToDebugLog("EVENT, CanIUseFlash__11"), navigator.mimeTypes && navigator.mimeTypes["application/x-shockwave-flash"] != undefined && navigator.mimeTypes["application/x-shockwave-flash"].enabledPlugin) return PutToDebugLog("EVENT, CanIUseFlash__12"), !0
                }
                PutToDebugLog("EVENT, CanIUseFlash__13")
            }
            PutToDebugLog("EVENT, CanIUseFlash__14")
        } catch (h) {
            PutToDebugLogException(2, "common: CanIUseFlash", h)
        }
        return !1
    }

    function GetSinglePossibleEngine() {
        try {
            var e = GetParameterInt("enginepriority_java", 2), o = GetParameter2("enginepriority_webrtc", 2),
                t = GetParameter2("enginepriority_ns", 2), n = CanIUseWebRTC(), i = CanIUseApplet();
            if ("Android" === GetOs()) {
                if (!1 === n) return webphone_api.global.ENGINE_APP
            } else if ("iOS" === GetOs()) {
                if (!1 === n) return webphone_api.global.ENGINE_APP
            } else if ("Windows" === GetOs()) if ("Edge" === GetBrowser()) {
                if (!1 === n) return webphone_api.global.ENGINE_SERVICE
            } else if (!1 === i || e < 1) {
                if (!1 === n || o < 1) return webphone_api.global.ENGINE_SERVICE;
                if (!0 === n || t < 1) return webphone_api.global.ENGINE_WEBRTC
            }
        } catch (a) {
            PutToDebugLogException(2, "common: GetSinglePossibleEngine", a)
        }
        return ""
    }

    function IsJavaInstalled() {
        try {
            if ("Windows" === GetOs() && "Edge" === GetBrowser()) return 0;
            var e = null, o = !1, t = 0;
            if (navigator.mimeTypes && navigator.mimeTypes.length ? (e = navigator.mimeTypes["application/x-java-jnlp-file"], null == e && (e = navigator.mimeTypes["application/x-java-vm"]), null == e && (e = navigator.mimeTypes["application/x-java-applet"]), e ? t = 1 : "MSIE" === GetBrowser() && (o = !0)) : o = !0, o) {
                isNull(document.getElementById("deployJavaPlugin")) && mwpdeploy.writePluginTag();
                var n = mwpdeploy.getJREs();
                if (!isNull(n) && n.length > 0) for (var i = 0; i < n.length; i++) t = 1;
                return t < 1 ? 0 : 2
            }
            return t ? navigator.javaEnabled() ? 2 : 1 : 0
        } catch (a) {
            PutToDebugLogException(2, "common: IsJavaInstalled", a)
        }
        return 0
    }

    function EngineIsSupported(e) {
        try {
            e.indexOf("_avail") > 0 && (e = e.substring(0, e.indexOf("_avail")));
            var o = [];
            if (lversion <= 0) {
                if ("Android" === GetOs() || "iOS" === GetOs()) {
                    o.push("D"), o.push("e"), o.push("s"), o.push("k"), o.push("t"), o.push("o"), o.push("p"), o.push(" "), o.push("o"), o.push("n"), o.push("l"), o.push("y");
                    var t = o.join("");
                    return setTimeout(function () {
                        PutToDebugLog(1, "ERROR, " + t)
                    }, 500), 0
                }
                if ("java" !== e) return 0
            } else if (1 === lversion) {
                if (!1 === Glsp()) {
                    o.push("D"), o.push("e"), o.push("s"), o.push("k"), o.push("t"), o.push("o"), o.push("p"), o.push(" "), o.push("o"), o.push("n"), o.push("l"), o.push("y");
                    var t = o.join("");
                    return setTimeout(function () {
                        PutToDebugLog(1, "ERROR, " + t)
                    }, 500), 0
                }
                if ("java" !== e && "webrtc" !== e && "ns" !== e) return 0
            }
            if ("java" === e) {
                var n = CanIUseApplet();
                return PutToDebugLog(2, "EVENT, EngineIsSupported CanIUseApplet returned: " + n.toString()), !0 === n ? 1 : 0
            }
            if ("webrtc" === e) {
                if (CanIUseWebRTC()) {
                    if (!0 === BrowserRequiresHttps(!0) && !1 === IsHttps()) {
                        var i = GetUsemizutlsproxy();
                        return "false" === GetParameter("usemizutlsproxy_userreload") || "2" !== i && ("1" !== i || !0 !== webphone_api.global.usestorage && !Strl(60)) ? (PutToDebugLog(2, "EVENT, CanIUseWebRTC engine maybe supported"), 1) : (PutToDebugLog(2, "EVENT, CanIUseWebRTC engine supported"), 2)
                    }
                    return PutToDebugLog(2, "EVENT, CanIUseWebRTC engine supported"), 2
                }
                return PutToDebugLog(2, "EVENT, CanIUseWebRTC engine not supported"), 0
            }
            if ("ns" === e) return CanIUseService() ? 1 : 0;
            if ("flash" === e) return CanIUseFlash() ? 2 : 0;
            if ("app" === e) {
                var a = GetNativeDialerUrl(GetOs());
                return !isNull(a) && a.length > 5 ? 2 : (PutToDebugLog(2, "ERROR, EngineIsSupported: app engine not supported, because cannot find URL"), 0)
            }
            return "p2p" === e ? GetParameter("p2p").length < 4 ? 0 : 2 : "accessnum" === e ? ("Android" === GetOs() || "iOS" === GetOs()) && GetParameter("accessnumber").length > 2 ? 2 : 0 : "nativedial" === e ? "Android" === GetOs() || "iOS" === GetOs() ? 2 : 0 : "otherbrowser" === e ? ("Windows" === GetOs() || "Mac" === GetOs() || "Linux" === GetOs()) && GetParameterInt("enginepriority_otherbrowser", 2) > 0 && GetParameter("pc_alternatebrowserurl").length > 3 ? 2 : 0 : (PutToDebugLog(2, "ERROR, common: EngineIsSupported invalid engine name: " + e), 0)
        } catch (r) {
            PutToDebugLogException(2, "common: EngineIsSupported", r)
        }
    }

    function EngineIsInstalled(e, o, t) {
        try {
            if (e.indexOf("_avail") > 0) return 2;
            if ("java" !== e && "ns" !== e && "app" !== e && "webrtc" !== e) return 2;
            var n = GetEngine(e);
            if (n.isinstalled_cache >= 0) return n.isinstalled_cache;
            if (o > 0 && 0 === n.asyncreqbegintime && (o = 0), "java" !== e) {
                if (0 === o && 0 !== n.asyncreqbegintime) return 1;
                if (o > 0 && 0 !== n.asyncreqbegintime && GetTickCount() - n.asyncreqbegintime > 3e3) return 0;
                if (0 === n.asyncreqbegintime && (n.asyncreqbegintime = GetTickCount()), o > 0) return -1;
                if ("ns" === e) return PutToDebugLog(2, "EVENT, engine waiting for IsServiceInstalled"), IsServiceInstalled(function (e) {
                    PutToDebugLog(2, "EVENT, engine IsServiceInstalled: " + e);
                    var o = GetEngine("ns");
                    o.isinstalled_cache = e ? 2 : 0, SetEngine("ns", o)
                }, !1), -1;
                if ("app" === e) return 2
            } else {
                if ("java" === e) {
                    if ("Windows" === GetOs() && "Edge" === GetBrowser() || "Chrome" === GetBrowser()) return 0;
                    var i = IsJavaInstalled(), a = GetEngine("java");
                    return a.isinstalled_cache = i, SetEngine("java", a), 1 === i ? -1 : i
                }
                if ("webrtc" === e) return CanIUseWebRTC() ? !0 === BrowserRequiresHttps(!0) ? 1 : 2 : 0
            }
        } catch (r) {
            PutToDebugLogException(2, "common: EngineIsInstalled", r)
        }
        return 0
    }

    function GetServersupport(e, o) {
        try {
            if (e.indexOf("_avail") > 0) return 1;
            if ("webrtc" !== e) return 1;
            var t = GetEngine(e);
            if (t.serversupport_cache >= 0) return t.serversupport_cache;
            if (o > 0 && 0 === t.asyncreqbegintime && (o = 0), 0 === o && 0 !== t.asyncreqbegintime) return 1;
            if (o > 0 && 0 !== t.asyncreqbegintime && GetTickCount() - t.asyncreqbegintime > 3e3) return 0
                ;
            if (0 === t.asyncreqbegintime && (t.asyncreqbegintime = GetTickCount()), o > 0) return -1;
            var n = GetConfig("brandid"), i = GetBrandName(), a = GetConfig("companyname"), r = "";
            GetSipusername().length > 0 && (r = "&username=" + GetSipusername());
            var s = GetLastUsedEngine(), l = GetSelectedEngineName();
            if (isNull(s) || s.length < 1 || "webrtc" === s || "java" !== s && "ns" !== s || "webrtc" === l) {
                DecideWebrtcServer();
                var p = 1;
                if (IsMizuWebRTCGateway()) {
                    webphone_api.global.decideusuk_finished = !1;
                    var c = 8e3;
                    setTimeout(function () {
                        if (!1 === webphone_api.global.decideusuk_finished) {
                            PutToDebugLog(2, "EVENT, decideusuk not yet finihed after delay: " + c.toString());
                            var e = GetWebrtcSrvAddr();
                            (isNull(e) || e.length < 2) && (e = GetWp()), IsUKGateway(e) ? (PutToDebugLog(2, "WARNING, common manually setting UK gateway, because DecideUsUk has not yet finished after delay: " + c.toString()), webphone_api.global.usuk = "uk") : IsUSGateway(e) && (PutToDebugLog(2, "WARNING, common manually setting US gateway, because DecideUsUk has not yet finished after delay: " + c.toString()), webphone_api.global.usuk = "us"), webphone_api.global.decideusuk_finished = !0
                        }
                    }, c);
                    var u = "http://rtc.mizu-voip.com/mvapireq/?authkey=1568108345&apientry=wsload&brandid=" + n + "&brandname=" + i + "&companyname=" + a + "&upperserver=" + GetWebrtcUpperServer() + "&authid=" + r + "&now=415",
                        h = "http://usrtcx.webvoipphone.com/mvapireq/?authkey=1552303117&apientry=wsload&brandid=" + n + "&brandname=" + i + "&companyname=" + a + "&upperserver=" + GetWebrtcUpperServer() + "&authid=" + r + "&now=415";
                    PutToDebugLog(2, "EVENT, DecideUsUk UK_url (UK Websocket connect): " + u), PutToDebugLog(2, "EVENT, DecideUsUk US_url (US Websocket connect): " + h), !0 === BrowserRequiresHttps(!1) && (u = u.replace("http:", "https:"), h = h.replace("http:", "https:"));
                    var m = GetWp("uk"), g = GetWp("us");
                    if (m = m.replace("*", ""), g = g.replace("*", ""), m = m.replace("/mfstwebsock", "/mvstwebsock"), g = g.replace("/mfstwebsock", "/mvstwebsock"), IsLocalServer(!0)) PutToDebugLog(2, "ERROR, wsload decide" + webphone_api.stringres.get("webrtc_local_sipserver") + " (8)"); else try {
                        var d = new WebSocket(m, "api"), b = new WebSocket(g, "api");
                        d.binaryType = "arraybuffer", b.binaryType = "arraybuffer", d.onopen = function () {
                            d.send(u + "\r\n"), PutToDebugLog(2, "EVENT, UK wsload sent (UK Websocket onopen)"), SaveParameter("wseverconnected", "true")
                        }, b.onopen = function () {
                            b.send(h + "\r\n"), PutToDebugLog(2, "EVENT, US wsload sent (US Websocket onopen)"), SaveParameter("wseverconnected", "true")
                        }, d.onclose = function () {
                            d = null
                        }, b.onclose = function () {
                            b = null
                        }, d.onerror = function (e) {
                        }, b.onerror = function (e) {
                        }, d.onmessage = function (e) {
                            var o = null;
                            if (isNull(e) || (o = e.data), isNull(o)) PutToDebugLog(2, "ERROR, UK wsload failed, received data is NULL"); else {
                                HttpResponseHandler(ArrayBufferToString(o), "wrtcload_uk")
                            }
                            d && d.close && d.close()
                        }, b.onmessage = function (e) {
                            var o = null;
                            if (isNull(e) || (o = e.data), isNull(o)) PutToDebugLog(2, "ERROR, US wsload failed, received data is NULL"); else {
                                HttpResponseHandler(ArrayBufferToString(o), "wrtcload_us")
                            }
                            b && b.close && b.close()
                        }
                    } catch (_) {
                        PutToDebugLogException(2, "common: GetServersupport wsload inner", _)
                    }
                    p = 1300
                } else webphone_api.global.decideusuk_finished = !0;
                setTimeout(function () {
                    var e = GetWsloadUrl(GetSipusername());
                    !isNull(e) && e.length > 0 && (PutToDebugLog(5, "EVENT, common: GetServersupport GetWebrtcLoad"), UriParser(e, "", "", "", "", "webrtcload"))
                }, p)
            }
            if (!IsMizuServer()) return t.serversupport_cache = 0, SetEngine(e, t), 0
        } catch (_) {
            PutToDebugLogException(2, "common: GetServersupport", _)
        }
        return 0
    }

    function GetCfgPriority(e) {
        try {
            e.indexOf("_avail") > 0 && (e = e.substring(0, e.indexOf("_avail")));
            var o = 2;
            try {
                o = parseInt(GetParameter2("enginepriority_" + e))
            } catch (n) {
                PutToDebugLogException(2, "common: GetCfgPriority parseint: " + e, n)
            }
            var t = window.location.protocol;
            return "flash" === e && !isNull(t) && t.length > 0 && t.toLowerCase().indexOf("file") >= 0 && (o = 0), o
        } catch (n) {
            PutToDebugLogException(2, "common: GetCfgPriority", n)
        }
        return 2
    }

    function GetCfgOldAvailable(e) {
        try {
            e.indexOf("_avail") > 0 && (e = e.substring(0, e.indexOf("_avail")));
            var o = 1;
            try {
                o = parseInt(GetParameter("engineoldavailable_" + e))
            } catch (t) {
                PutToDebugLogException(2, "common: GetCfgOldAvailable parseint: " + e, t)
            }
            return IsNumber(o) || (o = 1), o
        } catch (t) {
            PutToDebugLogException(2, "common: GetCfgOldAvailable", t)
        }
        return 1
    }

    function SaveCfgOldAvailable(e, o) {
        try {
            if (e.indexOf("_avail") > 0) return;
            SaveParameter("engineoldavailable_" + e, o)
        } catch (t) {
            PutToDebugLogException(2, "common: SaveCfgOldAvailable", t)
        }
    }

    function GetEngineDefPriority(e, o) {
        try {
            e.indexOf("_avail") > 0 && (e = e.substring(0, e.indexOf("_avail")));
            var t = GetConfig("enginedefpriority_" + e);
            if (!isNull(t) && t.length > 0 && IsNumber(t)) return StrToInt(t)
        } catch (n) {
            PutToDebugLogException(2, "common: GetEngineDefPriority", n)
        }
        return o
    }

    function EngineSelect(e, o) {
        try {
            var t;
            if (!1 === o && PutToDebugLog(2, "ERROR, Engine select called with cannot wait"), PutToDebugLog(2, "EVENT, EngineSelect called with stage: " + e), webphone_api.global.engineselecttime = GetTickCount(), webphone_api.global.engineselectstage = e, isNull(engines)) {
                engines = [];
                var n = 30;
                !1 === CanIUseApplet() && (n = .1), t = new Engine, t.name = "java", t.defpriority = GetEngineDefPriority("java", n), engines.push(t), t = new Engine, t.name = "webrtc", t.defpriority = GetEngineDefPriority("webrtc", 26), engines.push(t), t = new Engine, t.name = "flash", t.defpriority = GetEngineDefPriority("flash", 13), engines.push(t), t = new Engine, t.name = "ns", t.defpriority = GetEngineDefPriority("ns", 31), engines.push(t);
                var i = 10;
                "Windows" !== GetOs() && "Mac" !== GetOs() && "Linux" !== GetOs() || (i = .1), t = new Engine, t.name = "app", t.defpriority = GetEngineDefPriority("app", i), engines.push(t), t = new Engine, t.name = "p2p", t.defpriority = GetEngineDefPriority("p2p", 5), engines.push(t), t = new Engine, t.name = "nativedial", t.defpriority = GetEngineDefPriority("nativedial", 3), engines.push(t), t = new Engine, t.name = "otherbrowser", t.defpriority = GetEngineDefPriority("otherbrowser", 2), engines.push(t), t = new Engine, t.name = "java_avail", t.defpriority = GetEngineDefPriority("java_avail", 33), engines.push(t), t = new Engine, t.name = "ns_avail", t.defpriority = GetEngineDefPriority("ns_avail", 31), engines.push(t), t = new Engine, t.name = "app_avail", t.defpriority = GetEngineDefPriority("app_avail", i), engines.push(t);
                for (var a = 0; a < engines.length; a++) t = engines[a], t.pushlevel = -1, t.issupported_cache = -1, t.isinstalled_cache = -1, t.serversupport_cache = -1, t.failed = 0, t.clicked = 0, t.asyncreqbegintime = 0, t.available_old = GetCfgOldAvailable(t.name)
            }
            for (var a = 0; a < engines.length; a++) if (t = engines[a], t.cfg_priority = GetCfgPriority(t.name), e > 0 && !IsNumber(t.cfg_priority) && PutToDebugLog(2, "ERROR,Engineselect priority: " + t.name + " is not a number: " + t.cfg_priority), (t.cfg_priority >= 5 || t.clicked >= 2) && t.name.indexOf("_avail") < 0) return selected_engine = t, selected_engine.pushlevel = 1, recommend_engine = null, PutToDebugLog(2, "Returning forced only engine set by config: " + t.name), "webrtc" === t.name && !1 === getsrvsupportcalled && (getsrvsupportcalled = !0, GetServersupport("webrtc", e)), 1;
            var r = GetWebrtcSrvAddr();
            if (!isNull(r) && r.length > 3 && r.toLowerCase().indexOf("mfstwebsock") < 0) {
                2 === GetParameterInt("enginepriority_webrtc", 1) && (PutToDebugLog(2, "EVENT, enginepriority_webrtc auto increased to: 3"), SaveParameter("enginepriority_webrtc", "3"))
            }
            if (webphone_api.global.lastengine_started_ok = GetLastUsedEngine(), webphone_api.global.lastengine_working_ok = GetLastUsedEngine(), PutToDebugLog(2, "EVENT, EngineSelect at stage: " + e + "; lastusedengine: " + webphone_api.global.lastengine_started_ok), webphone_api.global.lastengine_working_ok.length > 0) for (var a = 0; a < engines.length; a++) if (t = engines[a], t.name === webphone_api.global.lastengine_working_ok && t.failed < 1 && t.name.indexOf("_avail") < 0 && t.defpriority > 0) if ("webrtc" === t.name && (IsMizuWebRTCGateway() || IsMizuWebRTCEmbeddedServer())) avoidjavapopup = 2; else if (("flash" !== t.name || "true" !== GetParameter("java_worked")) && "true" !== GetParameter("ns_worked") && "true" !== GetParameter("webrtc_worked")) {
                selected_engine = t, selected_engine.pushlevel = 1, recommend_engine = null;
                var s = "";
                try {
                    s = selected_engine.name
                } catch (R) {
                }
                return PutToDebugLog(2, "Returning last working ok engine: " + s), 1
            }
            for (var a = 0; a < engines.length; a++) {
                t = engines[a];
                var l = t.issupported_cache;
                "webrtc" === t.name && e > 0 && (l = -1), l < 0 && (l = EngineIsSupported(t.name)), t.issupported_cache = l, 0 === l ? t.available = 0 : 2 === l ? t.available = 3 : webphone_api.global.lastengine_started_ok === t.name || webphone_api.global.lastengine_working_ok === t.name ? t.available = 2 : t.available = 1
            }
            for (var p = 0, c = null, a = 0; a < engines.length; a++) if (t = engines[a], t.available > 2 && t.failed < 1 && t.name.indexOf("_avail") < 0) {
                if (c = t, ++p > 1) {
                    c = null;
                    break
                }
            } else if (t.available > 0) {
                c = null;
                break
            }
            if (!isNull(c)) return selected_engine = c, selected_engine.pushlevel = 1, recommend_engine = null, PutToDebugLog(2, "Returning the only good engine: " + selected_engine.name), 1;
            if (1 === avoidjavapopup) {
                var u = GetEngine("java");
                avoidjavapopup = u.available_old > 2 ? 2 : 0 === u.available_old ? 2 : 0
            }
            for (var a = 0; a < engines.length; a++) if (t = engines[a], !(t.available < 1 || t.available > 2)) if (t.name.indexOf("_avail") > 0) t.available = 3; else if (!((avoidjavapopup > 1 || 0 === e) && "java" === t.name || (avoidflashpopup > 1 || 0 === e) && "flash" === t.name)) {
                var l = t.isinstalled_cache, h = HasUsableEngine(t);
                if (l < 0 && (l = EngineIsInstalled(t.name, e, h)), l < 0) {
                    if (!0 === o) return 0;
                    t.available = 1, l = 1
                } else t.isinstalled_cache = l, 0 === l ? t.available = 0 : 2 === l && (t.available = 3)
            }
            if (IsMizuWebRTCGateway() || !0 === IsMizuServer()) for (var a = 0; a < engines.length; a++) if (t = engines[a], t.serversupport = 1, "webrtc" === t.name) if (t.available < 1) t.serversupport = 2; else if (t.serversupport = t.serversupport_cache, t.serversupport < 0 && (t.serversupport = GetServersupport(t.name, e)), t.serversupport < 0) {
                if (o) return 0;
                t.serversupport = 3
            } else t.serversupport_cache = t.serversupport;
            if (avoidjavapopup > 1 && e > 0) {
                var u = GetEngine("java"), h = HasUsableEngine(u);
                if (u.available_old > 2 ? u.available = u.available_old : 0 === u.available_old && h && (u.available = u.available_old), u.available < 1 || u.available > 2); else {
                    var m = GetEngine("webrtc"), g = GetEngine("ns");
                    if ((1 === u.available || 2 === u.available) && u.cfg_priority <= 2 && (m.available > 2 && m.cfg_priority >= 2 && m.serversupport <= 1 || g.available > 2 && g.cfg_priority >= 2)); else {
                        var l = t.isinstalled_cache;
                        if (l < 0 && (l = EngineIsInstalled(u.name, e, h)), l < 0) return 0;
                        t.isinstalled_cache = l, 0 === l ? u.available = 0 : 2 === l && (u.available = 3)
                    }
                }
            }
            if (avoidflashpopup > 1 && e > 0) {
                var d = GetEngine("flash"), h = HasUsableEngine(d);
                if (d.available_old > 2 ? d.available = d.available_old : 0 == d.available_old && h && (d.available = d.available_old), d.available < 1 || d.available > 2); else {
                    var m = GetEngine("webrtc"), g = GetEngine("service"), u = GetEngine("java");
                    if ((1 == d.available || 2 == d.available) && d.cfg_priority <= 2 && (m.available > 2 && m.cfg_priority >= 2 && m.serversupport <= 1 || g.available > 2 && g.cfg_priority >= 2 || u.available > 2 && u.cfg_priority >= 2)); else {
                        var l = t.isinstalled_cache;
                        if (l < 0 && (l = EngineIsInstalled(d.name, e, h)), l < 0) return 0;
                        t.isinstalled_cache = l, 0 == l ? d.available = 0 : 2 == l && (d.available = 3)
                    }
                }
            }
            for (var a = 0; a < engines.length; a++) if (t = engines[a], e > 0 && t.name.indexOf("_avail") < 0 && (t.available_old = t.available, SaveCfgOldAvailable(t.name, t.available)), t.cfg_priority < 1) t.finalscore = 0; else {
                switch (t.available) {
                    case 0:
                        t.finalscore = 10;
                        break;
                    case 1:
                        t.finalscore = 25;
                        break;
                    case 2:
                        t.finalscore = 35;
                        break;
                    case 3:
                        t.finalscore = 60;
                        break;
                    default:
                        t.finalscore = 25
                }
                switch (!0 === NSMacLinEnabled() || "ns" === t.name && "Windows" !== GetOs() && (t.finalscore = 0), t.cfg_priority) {
                    case 1:
                        t.finalscore *= .75;
                        break;
                    case 3:
                        t.finalscore *= 1.66;
                        break;
                    case 4:
                        t.finalscore *= 2.5
                }
                switch (t.defpriority <= 3 ? t.finalscore *= .1 : t.defpriority <= 4 ? t.finalscore *= .2 : t.defpriority <= 6 ? t.finalscore *= .3 : t.defpriority <= 15 ? t.finalscore *= .4 : t.defpriority <= 25 ? t.finalscore *= .8 : t.defpriority <= 30 ? t.finalscore *= .9 : t.defpriority <= 35 || (t.defpriority <= 45 ? t.finalscore *= 1.2 : t.defpriority <= 55 ? t.finalscore *= 1.35 : t.finalscore *= 1.45), t.serversupport) {
                    case 0:
                        t.finalscore *= 1.1;
                        break;
                    case -1:
                    case 2:
                        t.finalscore *= .7;
                        break;
                    case 3:
                        t.finalscore *= .4;
                        break;
                    case 4:
                        t.finalscore *= .2
                }
                IsMizuWebRTCGateway() || (t.finalscore *= 1.5), t.clicked > 0 && (t.clicked = 0, t.finalscore *= 1.25), webphone_api.global.lastengine_started_ok.length > 0 && webphone_api.global.lastengine_started_ok === t.name && (t.finalscore *= 1.1), t.failed && t.finalscore > 13 && (t.finalscore = 13), lversion < 1 && "java" !== t.name && (t.finalscore *= .8)
            }
            if (e > 0 && !0 === CanIUseService()) {
                var b = GetEngine("ns"), _ = GetEngine("webrtc");
                if (GetParameterInt("enginepriority_ns", 2) >= GetParameterInt("enginepriority_webrtc", 2)) {
                    var f = b.finalscore;
                    if (_.failed > 0 && IsNumber(f)) {
                        for (var a = 0; a < engines.length; a++) t = engines[a], "ns" === t.name || t.name.indexOf("_avail") > 0 || t.finalscore >= f && (f = t.finalscore + 1);
                        b.finalscore = f, SetEngine("ns", b)
                    }
                }
            }
            if (e > 0 && !0 === CanIUseService() && !1 === IsHttps() && !0 === UseTLSReload() && ("Chrome" === GetBrowser() || "Safari" === GetBrowser() || "Firefox" === GetBrowser() && GetBrowserVersion() >= 68)) {
                var b = GetEngine("ns"), _ = GetEngine("webrtc");
                if (GetParameterInt("enginepriority_ns", 2) >= GetParameterInt("enginepriority_webrtc", 2)) {
                    var f = 1.1 * b.finalscore;
                    SetEngine("ns", b), (!0 === webphone_api.global.usestorage || Strl(90)) && !1 === GetParameterBool("reloadalertdisplayed", !0) && (AlertDialog(webphone_api.stringres.get("warning"), webphone_api.stringres.get("chrome_https")), PutToDebugLog(2, "WARNING, " + webphone_api.stringres.get("chrome_https")), SaveParameter("reloadalertdisplayed", "true"))
                }
            }
            var w, v = null;
            w = -1e3;
            for (var a = 0; a < engines.length; a++) t = engines[a], "java_avail" !== t.name && "ns_avail" !== t.name && "app_avail" !== t.name && t.finalscore > w && (w = t.finalscore, v = t);
            if (isNull(v)) return PutToDebugLog(2, "No best engine"), 1;
            if ("webrtc" === v.name && !0 === CanIUseService() && GetEngine("ns").finalscore > 15 && GetParameterInt("enginepriority_ns", 2) > GetParameterInt("enginepriority_webrtc", 2) + 1 && !0 === GetParameterBool("isfirststart", !0)) {
                PutToDebugLog("EVENT, Engineselect switch to NS because it has higher priority");
                for (var E = GetEngine("ns").finalscore, T = GetEngine("webrtc").finalscore, a = 0; a < engines.length; a++) "ns" === engines[a].name && (engines[a].finalscore = T), "webrtc" === engines[a].name && (engines[a].finalscore = E);
                v = GetEngine("ns")
            }
            v.finalscorex = v.finalscore, recommend_engine = null, selected_engine = v, selected_engine.pushlevel = 1;
            var P = null;
            w = -1e3;
            for (var a = 0; a < engines.length; a++) t = engines[a], t.finalscorex = t.finalscore, t !== v && "java_avail" !== t.name && "ns_avail" !== t.name && "app_avail" !== t.name && (!(v.finalscorex > 40) || "ns" !== v.name && "app" !== v.name || "ns" !== t.name && "app" !== t.name) && (!(v.finalscorex > 50) || "java" !== v.name && "ns" !== v.name && "app" !== v.name || "java" !== t.name && "ns" !== t.name && "app" !== t.name || (t.finalscorex = .75 * t.finalscorex), t.finalscorex > w && (w = t.finalscorex, P = t));
            var S = null;
            w = -1e3;
            for (var a = 0; a < engines.length; a++) t = engines[a], "java_avail" !== t.name && "ns_avail" !== t.name && "app_avail" !== t.name || t.name !== v.name + "_avail" && (v.finalscorex > 40 && ("ns" === v.name || "app" === v.name) || (v.finalscorex > 50 && ("java" === v.name || "ns" === v.name || "app" === v.name) && (t.finalscorex = .75 * t.finalscorex), t.finalscorex > w && (w = t.finalscorex, S = t)));
            if ("webrtc" === v.name || "flash" === v.name || "p2p" === v.name || "accessnum" === v.name || "nativedial" === v.name) selected_engine.pushlevel = 1; else switch (v.available) {
                case 0:
                    selected_engine.pushlevel = 5;
                    break;
                case 1:
                    selected_engine.pushlevel = 4;
                    break;
                case 2:
                    selected_engine.pushlevel = 3;
                    break;
                case 3:
                    selected_engine.pushlevel = 1
            }
            var S = null;
            if (w = -1e3, e > 0) try {
                for (var N = "", a = 0; a < engines.length; a++) t = engines[a], t.name.indexOf("_avail") > 0 || (N.length > 0 && (N += "\r\n"), N += "EngineSelectPriority: " + t.name + ": " + t.finalscorex + " available: " + t.available);
                !isNull(N) && N.length > 0 && PutToDebugLog(2, "EVENT\r\n" + N)
            } catch (R) {
            }
            if (isNull(P) && isNull(S)) return PutToDebugLog(2, "recommended engine result: same as selected"), 1;
            if (isNull(P) && !isNull(S) ? P = S : !isNull(P) && isNull(S) || P.finalscorex > 50 || P.finalscorex > .8 * S.finalscorex || (P = S), isNull(P)) return PutToDebugLog(2, "recommended engine result: null"), 1;
            if (v.finalscorex > 60) return PutToDebugLog(2, "recommended engine result: not needed1 " + v.finalscorex + "       " + TestEngineToString(P, !1)), 1;
            if (P.finalscorex < 15 && P.available < 1) return PutToDebugLog(2, "recommended engine result: not needed3 " + v.finalscorex + "       " + TestEngineToString(P, !1)), 1;
            if (v.finalscorex > 22 && P.finalscorex <= 10) return PutToDebugLog(2, "recommended engine result: not needed3 " + v.finalscorex + "       " + TestEngineToString(P, !1)), 1;
            if (v.finalscorex > 30 && v.finalscorex > 1.35 * P.finalscorex) return PutToDebugLog(2, "recommended engine result: not needed2 " + v.finalscorex + " > " + 1.35 * P.finalscorex + "       " + TestEngineToString(P, !1)), 1;
            recommend_engine = P;
            var I = 3;
            if (v.finalscorex < 20 && recommend_engine.finalscorex >= 60 ? I = 6 : v.finalscorex < 30 && recommend_engine.finalscorex > 50 ? I = 5 : v.finalscorex > 60 || v.finalscorex > 50 && recommend_engine.finalscorex < 30 || v.finalscorex > 2 * recommend_engine.finalscorex ? I = 0 : recommend_engine.finalscorex > 15 && recommend_engine.finalscorex > v.finalscorex && (v.finalscorex < 30 || v.finalscorex < 35 && recommend_engine.finalscorex > 45 || recommend_engine.finalscorex > 2 * v.finalscorex || recommend_engine.finalscorex - v.finalscorex > 25) ? I = 4 : v.finalscorex > 55 && v.finalscorex > .9 * recommend_engine.finalscorex && (I = 2), recommend_engine.name.indexOf("_avail") > 0) {
                PutToDebugLog(2, "adjusting from virtual engine " + TestEngineToString(recommend_engine, !1));
                for (var C = recommend_engine.name.substring(0, recommend_engine.name.indexOf("_avail")), a = 0; a < engines.length; a++) if (t = engines[a], t.name === C) {
                    recommend_engine = t;
                    break
                }
            }
            recommend_engine.pushlevel = I, recommend_engine === selected_engine && (recommend_engine = null)
        } catch (y) {
            PutToDebugLogException(2, "common: EngineSelect", y)
        }
        return 1
    }

    function TestEngineToString(e, o) {
        try {
            if (isNull(e)) return "engine not set";
            var t = e.name;
            return o && (t = t.toUpperCase()), t + "> cfgpriority: " + e.cfg_priority + ", available: " + e.available + ", serversupport: " + e.serversupport + ", finalscore: " + e.finalscore + " (" + e.finalscorex + "), pushlevel: " + e.pushlevel + " " + TestPushLevelToString(e.pushlevel)
        } catch (n) {
            PutToDebugLogException(2, "common: TestEngineToString", n)
        }
    }

    function TestPushLevelToString(e) {
        try {
            switch (e) {
                case -1:
                    return "not set";
                case 0:
                    return "no";
                case 1:
                    return "just use";
                case 2:
                    return "barely mention";
                case 3:
                    return "mention on login/settings page";
                case 4:
                    return "offer also after login";
                case 5:
                    return "always ask for";
                case 6:
                    return "force (allow only this)";
                default:
                    return "unknown"
            }
        } catch (o) {
            PutToDebugLogException(2, "common: TestPushLevelToString", o)
        }
    }

    function CheckInternetConnection() {
        try {
            if (0 === GetParameterInt("networkchecks", 1)) return;
            if (!0 === IsLocalServer()) return;
            if (GetParameter("devicetype") !== DEVICE_WEBPHONE()) return;
            isNull(contimer) && (contimer = setInterval(function () {
                if (++ccmaxloop > 100) return isNull(contimer) || clearInterval(contimer), contimer = null, void (ccmaxloop = 0);
                webphone_api.$(".messagePopup").is(":visible") || (isNull(contimer) || clearInterval(contimer), contimer = null, ccmaxloop = 0, "undefined" != typeof navigator.onLine && null !== navigator.onLine ? !1 === navigator.onLine && (ShowToast(webphone_api.stringres.get("connection_msg") + "_2", 5e3), PutToDebugLog(1, "ERROR, " + webphone_api.stringres.get("connection_msg") + "_2"), PutToDebugLog(2, "ERROR, CheckInternetConnection No internet connection is available at this time")) : PutToDebugLog(2, "EVENT, CheckInternetConnection could NOT check"))
            }, 1e3))
        } catch (e) {
            PutToDebugLogException(2, "common: CheckInternetConnection", e)
        }
    }

    function CheckInternetConnectionWS() {
        try {
            if (0 === GetParameterInt("networkchecks", 1)) return;
            if (lastnetsucceded > 0 && GetTickCount() - lastnetsucceded < 6e5) return;
            if (lastgood_set = !1, good_succeded = !1, GetLogLevel() < 2) return void PutToDebugLog(2, "EVENT, skip CheckInternetConnectionWS because loglevel is 1");
            var e = GetParameter("wstestservers");
            if (isNull(e) || e.length < 3 || "null" === e.toLowerCase()) return void PutToDebugLog(2, "EVENT, CheckInternetConnectionWS no websocket addresses");
            if (!0 === IsLocalServer()) return;
            var o = e.split(",");
            if (isNull(o) || o.length < 1) return void PutToDebugLog(2, "ERROR, CheckInternetConnectionWS list is NULL");
            if (!1 === GetParameterBool("wseverconnected", !1)) return void PutToDebugLog(2, "EVENT, skip CheckInternetConnectionWS because no previous sucessfull WebSocket connection");
            var t = GetParameter("lastgood_wstest");
            isNull(t) && (t = "");
            for (var n = 0; n < o.length;) isNull(o[n]) || o[n].length < 3 || o[n] === t ? o.splice(n, 1) : (!0 === BrowserRequiresHttps(!1) && (o[n] = o[n].replace("ws:", "wss:")), n++);
            if (isNull(o) || o.length < 1) return void PutToDebugLog(2, "ERROR, CheckInternetConnectionWS list is NULL after");
            t.length > 0 && o.unshift(t);
            var i = 1;
            webphone_api.global.domloaded_tick > 0 && GetTickCount() - webphone_api.global.domloaded_tick < 2e4 && (i = 2e4 - (GetTickCount() - webphone_api.global.domloaded_tick)) < 1 && (i = 1), isNull(wsconn_timer) || clearTimeout(wsconn_timer), wsconn_timer = null, wsconn_timer = setTimeout(function () {
                try {
                    if (PutToDebugLog(2, "EVENT, CheckInternetConnectionWS start: " + o.length.toString()), o.length > 0) {
                        ws1ok = -1;
                        var e = new WebSocket(o[0]);
                        e.onopen = function () {
                            ws1ok = 1, !1 === lastgood_set && (SaveParameter("lastgood_wstest", o[0]), lastgood_set = !0), good_succeded = !0, PutToDebugLog(2, "EVENT, CheckInternetConnectionWS public Internet connection is available(1)"), e && e.close && e.close(), e = null
                        }, e.onclose = function () {
                            e = null
                        }, e.onerror = function (o) {
                            ws1ok = 0, e = null
                        }
                    }
                    setTimeout(function () {
                        if (!1 === good_succeded) {
                            if (o.length > 1) {
                                ws2ok = -1;
                                var e = new WebSocket(o[1]);
                                e.onopen = function () {
                                    ws2ok = 1, !1 === lastgood_set && (SaveParameter("lastgood_wstest", o[0]), lastgood_set = !0), PutToDebugLog(2, "EVENT, CheckInternetConnectionWS public Internet connection is available(2)"), e && e.close && e.close(), e = null
                                }, e.onclose = function () {
                                    e = null
                                }, e.onerror = function (o) {
                                    ws2ok = 0, e = null
                                }
                            }
                            if (o.length > 2) {
                                ws3ok = -1;
                                var t = new WebSocket(o[2]);
                                t.onopen = function () {
                                    ws3ok = 1, !1 === lastgood_set && (SaveParameter("lastgood_wstest", o[0]), lastgood_set = !0), PutToDebugLog(2, "EVENT, CheckInternetConnectionWS public Internet connection is available(3)"), t && t.close && t.close(), t = null
                                }, t.onclose = function () {
                                    t = null
                                }, t.onerror = function (e) {
                                    ws3ok = 0, t = null
                                }
                            }
                            if (o.length > 3) {
                                ws4ok = -1;
                                var n = new WebSocket(o[2]);
                                n.onopen = function () {
                                    ws4ok = 1, !1 === lastgood_set && (SaveParameter("lastgood_wstest", o[0]), lastgood_set = !0), PutToDebugLog(2, "EVENT, CheckInternetConnectionWS public Internet connection is available(4)"), n && n.close && n.close(), n = null
                                }, n.onclose = function () {
                                    n = null
                                }, n.onerror = function (e) {
                                    ws4ok = 0, n = null
                                }
                            }
                        }
                    }, 1200), isNull(cic_timer) || clearTimeout(cic_timer), cic_timer = null, cic_timer = setTimeout(function () {
                        PutToDebugLog(2, "EVENT, CheckInternetConnectionWS result: con1: " + ws1ok.toString() + "; con2: " + ws2ok.toString() + "; con3: " + ws3ok.toString()), -1 !== ws1ok && 0 !== ws1ok || -1 !== ws2ok && 0 !== ws2ok || -1 !== ws3ok && 0 !== ws3ok || -1 !== ws4ok && 0 !== ws4ok ? lastnetsucceded = GetTickCount() : (ShowToast(webphone_api.stringres.get("connection_msg"), 5e3), PutToDebugLog(1, "ERROR, " + webphone_api.stringres.get("connection_msg")), PutToDebugLog(2, "ERROR, CheckInternetConnectionWS.onerror, public Internet connection NOT available")), lastgood_set = !1
                    }, 3500)
                } catch (t) {
                    PutToDebugLogException(2, "common: CheckInternetConnectionWS inner timer", t)
                }
            }, i)
        } catch (a) {
            PutToDebugLogException(2, "common: CheckInternetConnectionWS", a)
        }
    }

    function GetAvailableCallfunctions() {
        var e = "callforward,conference,transfer,numpad,mute,hold,chat";
        if (!0 === CanIUseVideo() && (e += ",video"), 0 === GetParameterInt("conferencetype", 1) && (e = e.replace("conference,", "")), !1 === Glcf() && (e = e.replace("conference,", "")), !1 === Glvd() && (e = e.replace("video,", ""), e = e.replace(",video", "")), lversion < 2 && (e = "callforward,transfer,numpad,mute,hold,chat"), !1 === Glt() && (e = e.replace("callforward,", ""), e = e.replace("transfer,", "")), GetParameterInt("featureset", 10) < 10 && (e = "numpad,mute,chat"), 5 === GetParameterInt("defmute", 0) && (e = e.replace("mute,", ""), e = e.replace(",mute", ""), e = e.replace("mute", "")), getuseengine() === webphone_api.global.ENGINE_WEBRTC && "Firefox" === GetBrowser() && GetBrowserVersion() >= 63) {
            var o = ParamAsInt(GetParameter2("fasthold"), -1);
            1 === o ? e = e.replace("mute,", "") : -1 === o && getuseengine() === webphone_api.global.ENGINE_WEBRTC && "Firefox" === GetBrowser() && (e = e.replace("mute,", ""))
        } else getuseengine() === webphone_api.global.ENGINE_FLASH && (e = "transfer,numpad,chat", lversion < 1 && (e = e.replace("transfer,", "")));
        var t = e.split(",");
        if (!isNull(t) && t.length > 0) {
            e = "";
            for (var n = 0; n < t.length; n++) isNull(t[n]) || t[n].length < 1 || !1 === HideSettings(t[n], webphone_api.stringres.get("sett_display_name_" + t[n]), t[n], !0) && (e.length > 0 && (e += ","), e += t[n])
        }
        return e
    }

    function UploadAutoprov() {
        try {
            var e = "http://mnt.mizu-voip.com/mmexreqvitserverjrsktt/xautoprovpush", o = "";
            if (isNull(webphone_api.global.settmap2)) return void PutToDebugLog(2, "ERROR, common: UploadAutoprov no settins to be uploaded (1)");
            for (var t in webphone_api.global.settmap2) if (!(isNull(t) || t.length < 1)) {
                var n = webphone_api.global.settmap2[t];
                o.length > 0 && (o += "\r\n"), o = o + t + ";" + n[SETT_VALUE]
            }
            var i = location.href;
            i = decodeURIComponent(i);
            var a = i.indexOf("?");
            if (a > 0 && (i = i.substring(0, a)), a = i.indexOf("#"), a > 0 && (i = i.substring(0, a)), a = i.lastIndexOf("."), a > 0 && i.length - a < 7 && (a = i.lastIndexOf("/")) > 0 && (i = i.substring(0, a)), i += "/webphone_api.js", PutToDebugLog(2, "EVENT, UploadAutoprov pathtowpapi: " + i), o += "\r\n", o = o + "pathtowpapi;" + i, isNull(o) || o.length < 10) return void PutToDebugLog(2, "ERROR, common: UploadAutoprov no settins to be uploaded (2)");
            o = "aenc_10_" + StrEc(o, webphone_api.global.ec_autoprov, !0), o = "WPAUTOPROVSTART" + o + "WPAUTOPROVEND", !0 === IsHttps() && (e = GetTlsProxyUrl(e)), PutToDebugLog(2, "EVENT, UploadAutoprov url: " + e), HttpRequest(e, "wpautoprov", !0, o)
        } catch (r) {
            PutToDebugLogException(2, "common: UploadAutoprov", r)
        }
    }

    function SendLog(e) {
        try {
            if (isNull(e)) return void PutToDebugLog(1, "ERROR, common: SendLog no logs to be sent");
            HttpRequest("http://mnt.mizu-voip.com/mmexreqvitserverjrsktt/xlogpush", "wpsendlog", !0, e)
        } catch (o) {
            PutToDebugLogException(2, "common: SendLog", o)
        }
    }

    function GetColortheme() {
        try {
            var e = GetParameter("theme");
            (isNull(e) || e.length < 1) && (e = GetConfig("colortheme")), isNull(webphone_api.parameters.theme) || (e = webphone_api.parameters.theme), isNull(webphone_api.parameters.colortheme) || (e = webphone_api.parameters.colortheme), (isNull(e) || e.length < 1) && (e = "0");
            var o = 0;
            try {
                o = StrToInt(e)
            } catch (t) {
            }
            return (isNull(o) || o < 0 || o > 100) && (o = 0), o
        } catch (n) {
            PutToDebugLogException(2, "common: GetColortheme", n)
        }
        return 0
    }

    function SetCurrTheme() {
        try {
            if (1 == IsSDK()) return;
            if (isNull(document.getElementById("colortheme"))) {
                webphone_api.$("<style />").appendTo("head").attr("id", "colortheme")
            }
            var e = GetColortheme();
            if (0 === e) {
                webphone_api.$("#colortheme").html("");
                return "MSIE" !== GetBrowser() && "Edge" !== GetBrowser() || webphone_api.$("#colortheme").html("#phone_app_main_container{scrollbar-face-color: #151515;scrollbar-base-color: #1d1d1d;scrollbar-3dlight-color: #1d1d1d;scrollbar-highlight-color: #1d1d1d;scrollbar-track-color: #3c3c3c;scrollbar-arrow-color: #000000;scrollbar-shadow-color: #1d1d1d;scrollbar-dark-shadow-color: #1d1d1d;"), void PutToDebugLog(4, "EVENT, SetCurrTheme, default theme")
            }
            var o = webphone_api.themes.gettheme("theme_" + e);
            if (isNull(o)) return void PutToDebugLog(2, "ERROR, common: SetCurrTheme no available theme");
            var t = o.bgcolorheader, n = o.bgcolor, i = o.scrollbarcolor, a = o.listbgcolor, r = o.listitembgcolor,
                s = o.buttoncolor, l = o.buttonhover, p = o.buttonbordercolor, c = o.tabcolor, u = o.tabselectedcolor,
                h = o.bgdialpadnrfield, m = o.bgdialpadbtn, g = o.bgdialpadfooter, d = o.fontctheme, b = o.fontcwhite,
                _ = o.fontfamily;
            if (isNull(t.match(/^#([0-9a-f]{3}|[0-9a-f]{6})$/i))) return void PutToDebugLog(2, "ERROR, SetCurrTheme invalid bgcolorheader");
            if (isNull(n.match(/^#([0-9a-f]{3}|[0-9a-f]{6})$/i))) return void PutToDebugLog(2, "ERROR, SetCurrTheme invalid bgcolor");
            if (isNull(i.match(/^#([0-9a-f]{3}|[0-9a-f]{6})$/i))) return void PutToDebugLog(2, "ERROR, SetCurrTheme invalid scrollbarcolor");
            if (isNull(a.match(/^#([0-9a-f]{3}|[0-9a-f]{6})$/i))) return void PutToDebugLog(2, "ERROR, SetCurrTheme invalid listbgcolor");
            if (isNull(r.match(/^#([0-9a-f]{3}|[0-9a-f]{6})$/i))) return void PutToDebugLog(2, "ERROR, SetCurrTheme invalid listitembgcolor");
            if (isNull(s.match(/^#([0-9a-f]{3}|[0-9a-f]{6})$/i))) return void PutToDebugLog(2, "ERROR, SetCurrTheme invalid buttoncolor");
            if (isNull(l.match(/^#([0-9a-f]{3}|[0-9a-f]{6})$/i))) return void PutToDebugLog(2, "ERROR, SetCurrTheme invalid buttonhover");
            if (isNull(p.match(/^#([0-9a-f]{3}|[0-9a-f]{6})$/i))) return void PutToDebugLog(2, "ERROR, SetCurrTheme invalid buttonbordercolor");
            if (isNull(c.match(/^#([0-9a-f]{3}|[0-9a-f]{6})$/i))) return void PutToDebugLog(2, "ERROR, SetCurrTheme invalid tabcolor");
            if (isNull(u.match(/^#([0-9a-f]{3}|[0-9a-f]{6})$/i))) return void PutToDebugLog(2, "ERROR, SetCurrTheme invalid tabselectedcolor");
            if (isNull(d.match(/^#([0-9a-f]{3}|[0-9a-f]{6})$/i))) return void PutToDebugLog(2, "ERROR, SetCurrTheme invalid fontctheme");
            if (isNull(b.match(/^#([0-9a-f]{3}|[0-9a-f]{6})$/i))) return void PutToDebugLog(2, "ERROR, SetCurrTheme invalid fontcwhite");
            isNull(_) && (_ = "sans-serif"), PutToDebugLog(4, "EVENT, SetCurrTheme, applying color theme");
            webphone_api.$("#js_not_enabled_settings").css("background-color", n), webphone_api.$("#js_not_enabled_dialpad").css("background-color", n), webphone_api.$("#js_not_enabled").css("background-color", n), webphone_api.$("#choose_engine").css("background-color", n), webphone_api.$("#colortheme").html("");
            var f = "";
            f += ".ui-overlay-b .ui-content, .ui-content, .all_app_pages, .ui-body-b, .ui-page-theme-b .ui-body-inherit, html .ui-bar-b .ui-body-inherit, html .ui-body-b .ui-body-inherit, html body .ui-group-theme-b .ui-body-inherit, html .ui-panel-page-container-b { background-color: " + n + "; }", f += "#phone_app_main_container { background-color: " + n + " !important;}", "MSIE" !== GetBrowser() && "Edge" !== GetBrowser() || (f += "body{scrollbar-face-color: #151515;scrollbar-base-color: " + n + ";scrollbar-3dlight-color: " + n + ";scrollbar-highlight-color: " + n + ";scrollbar-track-color: #3c3c3c;scrollbar-arrow-color: #000000;scrollbar-shadow-color: " + n + ";scrollbar-dark-shadow-color: " + n + ";}"), f += "#phone_app_main_container ::-webkit-scrollbar { background: " + n + "; }#phone_app_main_container ::-webkit-scrollbar-thumb { background: " + i + "; }#phone_app_main_container ::-webkit-scrollbar-corner { background: #000; }", f += "#page_call_content #page_call_additional_info, #page_call_content #page_call_peer_details { color: " + b + "; }", f += ".ui-body-b,.ui-page-theme-b .ui-body-inherit,html .ui-bar-b .ui-body-inherit,html .ui-body-b .ui-body-inherit,html body .ui-group-theme-b .ui-body-inherit,html .ui-panel-page-container-b { background-color: " + a + "; text-shadow:0 0 0; }", f += ".mlistview .mlistitem { background-color: " + r + " !important; text-shadow:0 0 0; }", f += ".mlistview .mlistitem:hover { background-color: " + l + " !important; text-shadow:0 0 0; }", f += ".ui-page-theme-b .ui-btn,html .ui-bar-b .ui-btn,html .ui-body-b .ui-btn,html body .ui-group-theme-b .ui-btn,html head + body .ui-btn.ui-btn-b,.ui-page-theme-b .ui-btn:visited,html .ui-bar-b .ui-btn:visited,html .ui-body-b .ui-btn:visited,html body .ui-group-theme-b .ui-btn:visited,html head + body .ui-btn.ui-btn-b:visited {background-color: " + s + "; border-color: " + p + "; color: " + b + "; text-shadow:0 0 0; }", f += "#page_contactdetails_content .cd_container, #page_callhistorydetails_content .ch_container { border-bottom: .1em solid " + p + "; }", f += ".ui-page-theme-b .ui-btn:hover,html .ui-bar-b .ui-btn:hover,html .ui-body-b .ui-btn:hover,html body .ui-group-theme-b .ui-btn:hover,html head + body .ui-btn.ui-btn-b:hover,.ui-page-theme-b .ui-btn:active,html .ui-bar-b .ui-btn:active,html .ui-body-b .ui-btn:active,html body .ui-group-theme-b .ui-btn:active,html head + body .ui-btn.ui-btn-b:active {background-color: " + l + "; border-color: " + p + "; color: " + b + "; text-shadow:0 0 0; }", f += ".additional_header_left .btn_header_back SPAN { color: " + b + "; }", f += ".ui-bar-b,.ui-page-theme-b .ui-bar-inherit,html .ui-bar-b .ui-bar-inherit,html .ui-body-b .ui-bar-inherit,html body .ui-group-theme-b .ui-bar-inherit {background-color: " + t + "; border-color: " + n + "; color: " + b + ";text-shadow: 0 0 0; }", f += ".navigation_bar .ui-btn {background-color: " + c + " !important; border-color: #125d79;color: " + b + "; text-shadow: 0 0 0; }", f += ".navigation_bar .ui-btn.ui-btn-active {background-color: " + u + " !important; border-color: #125d79;color: " + b + "; text-shadow: 0 0 0; }", f += "#phone_number_container { background: " + h + "; }", f += "#dialpad_btn_grid, #numpad_btn_grid { background: " + m + "; }", f += "#dialpad_call_grid { background: " + g + "; }", f += "#page_dialpad_content #phone_number_container .ui-btn:hover, #dialpad_btn_grid .ui-btn:hover, #dialpad_footer .ui-btn:hover { background: " + l + "; filter: Alpha(Opacity=5); opacity: .5; }", 22 === GetColortheme() ? (f += "#contact_name, #ch_contact_name { background: " + c + "; }",
                f += "#dialpad_btn_grid .ui-btn .number, #numpad_btn_grid .ui-btn .number { font-size: 2.6em; font-family: Courier New, Courier, Helvetica, Lucida Sans Unicode, Trebuchet MS; }", f += "#dialpad_footer #dialpad_call_grid #btn_call .ui-btn:hover { background: " + l + "; }", f += ".navigation_bar .ui-btn.ui-btn-active { background-color: #ffffff !important; }", f += "#page_contactdetails_content .cd_call:hover, #page_contactdetails_content .cd_msg:hover, #page_callhistorydetails_content .ch_call:hover, #page_callhistorydetails_content .ch_msg:hover { background:#e8e8e8 !important; filter: Alpha(Opacity=7) !important; opacity: .7 !important; }") : f += "#contact_name, #ch_contact_name { background: " + g + "; }", f += "#page_call_content #callfunctions_layout { background: " + g + "; }", f += ".page_title, .additional_header_middle, .additional_header_left SPAN, .additional_header_left .page_title_small, #page_dialpad_content .ch_numberonly, #page_dialpad_content .ch_data .ch_name, #page_dialpad_content .ch_ctname, #page_contactdetails_content .cd_number, #page_callhistorylist_content .ch_data .ch_name, #page_callhistorydetails_content .ch_number, UL#settings_list .sett_display_name, .ui-header H1.adialog_title, #page_addeditcontact_content .aec_label, #page_messagelist_content #btn_newmessage, #page_messagelist_content .msg_name, #page_newuser_content SPAN, .notification_list .nt_title { color: " + d + "; }", f += d === m ? "#dialpad_btn_grid .ui-btn SPAN, #numpad_btn_grid .ui-btn SPAN{ color: " + b + "; }" : "#dialpad_btn_grid .ui-btn SPAN, #numpad_btn_grid .ui-btn SPAN{ color: " + d + "; }", f += "#sendtosupport_container #btn_sendlog { background: " + d + "; }", f += ".all_app_pages .notification:hover, #page_contactdetails_content .cd_call:hover, #page_contactdetails_content .cd_msg:hover, #page_callhistorydetails_content .ch_call:hover, #page_callhistorydetails_content .ch_msg:hover, #callfunctions_layout .callfunc_status_on, #callfunctions_layout .ui-btn:hover { background: " + d + "; }", f += ".ui-page .ui-header, .ui-page .ui-bar-b { background-color: " + t + " !important; }", f += ".separator_color_bg { background-color: " + p + " !important; }", f += "#phone_number_container .ui-input-text, #page_contactslist_content .ui-input-search, #contact_name, #page_contactdetails_content .cd_type, #page_contactdetails_content .cd_button, #ch_contact_name, #page_callhistorydetails_content .ch_type { color: " + b + "; }", webphone_api.$("#colortheme").html(f)
        } catch (w) {
            PutToDebugLogException(2, "common: SetCurrTheme", w)
        }
    }

    function NeedRegister() {
        try {
            var e = GetParameter("register");
            if ("0" === e) return !1;
            if ("2" === e) return !0;
            if ("1" === e) {
                var o = GetSipusername(), t = GetParameter("password");
                return o.length > 0 && t.length > 0
            }
        } catch (n) {
            PutToDebugLogException(2, "common: NeedRegister", n)
        }
        return !0
    }

    function IsIPAddrress(e) {
        try {
            if (isNull(e) || e.length < 1) return !1;
            var o = e.indexOf("://");
            return o >= 0 && (e = e.substring(o + 3)), o = e.indexOf("/"), o >= 0 && (e = e.substring(0, o)), e = Trim(e), e = ReplaceAll(e, ".", ""), e = ReplaceAll(e, " ", ""), e = ReplaceAll(e, ":", ""), IsNumber(e)
        } catch (t) {
            PutToDebugLogException(2, "common: IsIPAddrress", t)
        }
        return !1
    }

    function IsLanIP(e) {
        try {
            if (isNull(e) || e.length < 5) return !1;
            if (e = e.toString(), e = e.toLowerCase(), 0 === e.indexOf("192.168.") || 0 === e.indexOf("10.") || 0 === e.indexOf("172.") && (0 === e.indexOf("172.16.") || 0 === e.indexOf("172.17.") || 0 === e.indexOf("172.18.") || 0 === e.indexOf("172.19.") || 0 === e.indexOf("172.20.") || 0 === e.indexOf("172.21.") || 0 === e.indexOf("172.22.") || 0 === e.indexOf("172.23.") || 0 === e.indexOf("172.24.") || 0 === e.indexOf("172.25.") || 0 === e.indexOf("172.26.") || 0 === e.indexOf("172.27.") || 0 === e.indexOf("172.28.") || 0 === e.indexOf("172.29.") || 0 === e.indexOf("172.30.") || 0 === e.indexOf("172.31.")) || 0 === e.indexOf("169.254.") || 0 === e.indexOf("127.") || 0 === e.indexOf("0.") || 0 === e.indexOf("4.3.2.1") || e.indexOf("intranet") >= 0 || e.indexOf("local") >= 0) return PutToDebugLog(3, "EVENT, IsLanIP is local IP address: " + e), !0
        } catch (o) {
            PutToDebugLogException(2, "common: IsLanIP", o)
        }
        return !1
    }

    function IsLocalUpperServer() {
        try {
            var e = GetWsuserUrl(GetSipusername(), GetParameter("password"));
            if (!isNull(e) && e.indexOf("upperserver=") > 0 && (e = e.substring(e.indexOf("upperserver=") + 12), e.indexOf("&") >= 0 && (e = e.substring(0, e.indexOf("&"))), !isNull(e) && e.length > 0 && !0 === IsIPAddrress(e) && !0 === IsLanIP(e))) return !0
        } catch (o) {
            PutToDebugLogException(2, "common: IsLocalUpperServer", o)
        }
        return !1
    }

    function IsLocalServer(e) {
        try {
            (isNull(ils_srv1) || ils_srv1.length < 1) && (ils_srv1 = GetParameter("serveraddress_user")), (isNull(ils_srv2) || ils_srv2.length < 1) && (ils_srv2 = GetParameter("serveraddress_orig")), (isNull(ils_srv3) || ils_srv3.length < 1) && (ils_srv3 = GetParameter("serveraddress"));
            var o = GetConfig("serverip");
            isNull(o) && (o = ""), o = Trim(o);
            var t = GetConfig("server");
            isNull(t) && (t = ""), t = Trim(t);
            var n = GetConfig("knownip");
            if (isNull(n) && (n = ""), n = Trim(n), o.length > 0 || t.length > 0 || n.length > 0) return !!(o.length > 0 && IsIPAddrress(o) && IsLanIP(o)) || (!!(t.length > 0 && IsIPAddrress(t) && IsLanIP(t)) || !!(n.length > 0 && IsIPAddrress(n) && IsLanIP(n)));
            if (!isNull(alsv) && alsv.length > 0) {
                var i = StrDc(alsv, alsvkey), a = i.split(",");
                if (!isNull(a) && a.length > 0) {
                    var r = !0, s = [];
                    s.push("l"), s.push("a"), s.push("n"), s.push("i"), s.push("p");
                    var l = s.join("");
                    s = [], s.push("l"), s.push("o"), s.push("c"), s.push("a"), s.push("l"), s.push("f"), s.push("i"), s.push("l"), s.push("e");
                    var p = s.join("");
                    s = [], s.push("l"), s.push("o"), s.push("c"), s.push("a"), s.push("l");
                    var c = s.join("");
                    s = [], s.push("l"), s.push("o"), s.push("c"), s.push("a"), s.push("l"), s.push("h"), s.push("o"), s.push("s"), s.push("t");
                    for (var u = s.join(""), h = 0; h < a.length; h++) isNull(a[h]) || Trim(a[h]).length < 1 || (a[h] = Trim(a[h]), a[h] !== l && a[h] !== p && a[h] !== c && a[h] !== u && IsIPAddrress(a[h]) && (IsLanIP(a[h]) ? !1 : r = !1));
                    if (!0 === r) return !0
                }
            }
            if (ils_srv1.length > 0 && !IsIPAddrress(ils_srv1) && DomainToIp(ils_srv1, function (e) {
                ils_srv1 = e
            }), ils_srv2.length > 0 && !IsIPAddrress(ils_srv1) && DomainToIp(ils_srv2, function (e) {
                ils_srv2 = e
            }), ils_srv3.length > 0 && !IsIPAddrress(ils_srv3) && DomainToIp(ils_srv3, function (e) {
                ils_srv3 = e
            }), !0 === e) {
                var m = "", g = "", d = "", b = GetParameter("serveraddress_user");
                !isNull(b) && b.length > 0 && (m = DomainToIp(b, function () {
                }), isNull(m) && (m = ""));
                var _ = GetParameter("serveraddress_orig");
                !isNull(_) && _.length > 0 && (g = DomainToIp(_, function () {
                }), isNull(g) && (g = ""));
                var f = GetParameter("serveraddress");
                return !isNull(f) && f.length > 0 && (d = DomainToIp(f, function () {
                }), isNull(d) && (d = "")), !!(b.length > 0 && !0 === IsIPAddrress(b) && IsLanIP(b)) || (!!(_.length > 0 && !0 === IsIPAddrress(_) && IsLanIP(_)) || (!!(f.length > 0 && !0 === IsIPAddrress(f) && IsLanIP(f)) || (!(!(m.length > 0) || !IsLanIP(m) && !1 !== IsIPAddrress(m)) || (!(!(g.length > 0) || !IsLanIP(g) && !1 !== IsIPAddrress(g)) || !(!(d.length > 0) || !IsLanIP(d) && !1 !== IsIPAddrress(d))))))
            }
            var w = GetWebrtcSrvAddr();
            if (w.length < 2) {
                if (ils_srv1.length > 0 && (IsLanIP(ils_srv1) || !1 === IsIPAddrress(ils_srv1))) return !0;
                if (ils_srv2.length > 0 && (IsLanIP(ils_srv2) || !1 === IsIPAddrress(ils_srv1))) return !0;
                if (ils_srv3.length > 0 && (IsLanIP(ils_srv3) || !1 === IsIPAddrress(ils_srv1))) return !0
            } else {
                var v = w.indexOf("://");
                if (v > 0 && (w = w.substring(v + 3)), v = w.indexOf(":"), v > 0 && (w = w.substring(0, v)), v = w.indexOf("/"), v > 0 && (w = w.substring(0, v)), v = w.indexOf("?"), v > 0 && (w = w.substring(0, v)), !isNull(w) && w.length > 0 && !0 === IsLanIP(w)) return !0
            }
        } catch (E) {
            PutToDebugLogException(2, "common: IsLanIP", E)
        }
        return !1
    }

    function GetWebdomain() {
        try {
            var e = window.location.host, o = window.location.protocol;
            return isNull(e) && (e = ""), isNull(o) || o.length < 1 ? o = "" : o += "//", o + e
        } catch (t) {
            PutToDebugLogException(2, "common: GetWebdomain", t)
        }
        return ""
    }

    function GetBrandName() {
        try {
            var e = "";
            return webphone_api.global.usestorage ? (e = GetParameter("brandname"), (isNull(e) || e.length < 1) && (e = GetConfig("brandname")), (isNull(e) || e.length < 1) && (e = IsWindowsSoftphone() ? "Softphone" : "WebPhone")) : (e = GetParameter("brandname"), (isNull(e) || e.length < 1) && (e = GetConfig("brandname")), isNull(e) && (e = "")), e
        } catch (o) {
            PutToDebugLogException(2, "common: GetWebdomain", o)
        }
        return "WebPhone"
    }

    function CanShowLicKeyInput() {
        try {
            if (!IsWindowsSoftphone()) return !1;
            if (!isNull(canshowlickeyinput) && (!0 === canshowlickeyinput || !1 === canshowlickeyinput)) return canshowlickeyinput;
            WinAPI("API_CanShowLicKeyUserInput", function (e) {
                canshowlickeyinput = !(isNull(e) || !0 !== e && "true" != e), SaveParameter("canshowlickeyinput", canshowlickeyinput.toString()), PutToDebugLog(4, "EVENT, common API_CanShow: " + e)
            })
        } catch (e) {
            PutToDebugLogException(2, "common: CanShowLicKeyInput", e)
        }
        return !1
    }

    function BrowserRequiresHttps(e) {
        try {
            if (!0 === PreferWss() || IsHttps()) return !0;
            var o = GetBrowser();
            if (!0 === e) {
                var t = "";
                try {
                    t = window.location.href.toLowerCase()
                } catch (n) {
                    t = ""
                }
                if (isNull(t) && (t = ""), t.toLowerCase().indexOf("file://") >= 0) return !1;
                if (t.indexOf("localhost") < 0 && t.indexOf("127.0.0.1") < 0 && ("Chrome" === o || "Safari" === o || "Firefox" === o && GetBrowserVersion() >= 68)) return !0
            } else if ("Chrome" === o || "Safari" === o || "Firefox" === o && GetBrowserVersion() >= 68) return !0
        } catch (i) {
            PutToDebugLogException(2, "common: BrowserRequiresHttps", i)
        }
        return !1
    }

    function IsHttps() {
        try {
            if (!isNull(is_https)) return is_https;
            if (!0 === PreferWss()) return is_https = null, !0;
            is_https = !1;
            var e = window.location.protocol;
            return isNull(e) && (e = location.href, (isNull(e) || e.length < 2) && (is_https = !1, e = "")), e = e.toLowerCase(), e = Trim(e), (e.indexOf("https") >= 0 && e.indexOf("https") < 10 || e.indexOf("extension") >= 0 && e.indexOf("extension") < 12) && (is_https = !0), is_https
        } catch (o) {
            PutToDebugLogException(2, "common: IsHttps", o)
        }
        return !1
    }

    function PreferWss() {
        var e = !1;
        try {
            return !0 === GetConfig("preferwss") && (e = !0), isNull(webphone_api.parameters.preferwss) || !0 !== webphone_api.parameters.preferwss && !1 !== webphone_api.parameters.preferwss || (e = webphone_api.parameters.preferwss, wsprinted || (wsprinted = !0, PutToDebugLog(3, "EVENT, PreferWss() set manually in webphone_api."))), e
        } catch (o) {
            PutToDebugLogException(2, "common: PreferWss", o)
        }
        return !1
    }

    function MediaStreamPermissionDenied() {
        var e = GetBrandName();
        try {
            e += " " + webphone_api.stringres.get("allowmedia_general"), 1 == IsSDK() ? AlertDialogSDK(webphone_api.stringres.get("allowmedia_title"), e) : AlertDialog(webphone_api.stringres.get("allowmedia_title"), e)
        } catch (o) {
            PutToDebugLogException(2, "common: MediaStreamPermissionDenied", o)
        }
    }

    function GetTransferDirectoryName(e) {
        try {
            var o = GetSipusername(), t = GetParameter("password"), n = GetParameter("serveraddress_user");
            isNull(o) && (o = ""), isNull(t) && (t = ""), isNull(n) && (n = ""), isNull(e) && (e = "");
            return Md5Hash(o + t + n + e + "539249178376")
        } catch (i) {
            PutToDebugLogException(2, "common: GetTransferDirectoryName", i)
        }
        return ""
    }

    function FileTransfer(e) {
        try {
            isNull(e) && (e = ""), e = Trim(e), webphone_api.global.intentfiletransfer[0] = "destination=" + e, webphone_api.$.mobile.changePage("#page_filetransfer", {
                transition: "slide",
                role: "page"
            })
        } catch (o) {
            PutToDebugLogException(2, "common: FileTransfer", o)
        }
    }

    function GetLastUsedEngine() {
        var e = "";
        try {
            var o = GetParameter("enginechecksum"), t = GetNewConfig(), n = Md5Hash(t);
            return o !== n ? (PutToDebugLog(2, "Reset lastusedengine because config changed: " + t), PutToDebugLog(2, "old checksum: " + o + "; new checksum: " + n), SaveParameter("enginechecksum", n), SaveParameter("lastusedengine", ""), "") : (e = GetParameter("lastusedengine"), (isNull(e) || e.length < 1) && (e = webphone_api.global.last_used_engine_cache), isNull(e) && (e = ""), e)
        } catch (i) {
            PutToDebugLogException(2, "common: GetLastUsedEngine", i)
        }
        return ""
    }

    function IsConfigChanged() {
        try {
            if (GetParameter("enginechecksum") !== Md5Hash(GetNewConfig())) return !0
        } catch (e) {
            PutToDebugLogException(2, "common: IsConfigChanged", e)
        }
        return !1
    }

    function GetNewConfig() {
        try {
            var e = location.href;
            isNull(e) && (e = ""), e = decodeURIComponent(e), e = e.toLowerCase();
            var o = e.indexOf("?");
            o >= 0 && (e = e.substring(o + 1)), o = e.indexOf("#"), o >= 0 && (e = e.substring(0, o)), e = Trim(e);
            var t = GetParameter("serveraddress_user");
            (isNull(t) || t.length < 2) && (t = GetParameter("serveraddress")), isNull(t) && (t = ""), t = t.toLowerCase();
            var n = GetWebrtcSrvAddr();
            isNull(n) && (n = ""), n = n.toLowerCase();
            var i = GetProxyaddress(), a = GetParameter("transport"), r = GetParameterInt("enginepriority_java", 2),
                s = GetParameterInt("enginepriority_webrtc", 2), l = GetParameterInt("enginepriority_ns", 2),
                p = GetParameterInt("enginepriority_flash", 2), c = GetParameterInt("enginepriority_app", 2),
                u = GetParameterInt("enginepriority_p2p", 2), h = GetParameterInt("enginepriority_accessnum", 2),
                m = GetParameterInt("enginepriority_nativedial", 2), g = GetParameter("realm");
            isNull(g) && (g = "");
            var d = GetParameter("webphonebasedir");
            isNull(d) && (d = "");
            return e + ":" + t + ":" + n + ":" + r + ":" + s + ":" + l + ":" + p + ":" + c + ":" + u + ":" + h + ":" + m + ":" + g + ":" + d + ":" + i + ":" + a
        } catch (b) {
            PutToDebugLogException(2, "common: GetNewConfig", b)
        }
        return ""
    }

    function SaveLastUsedEngine() {
        try {
            var e = "";
            getuseengine() === webphone_api.global.ENGINE_WEBPHONE ? e = "java" : getuseengine() === webphone_api.global.ENGINE_WEBRTC ? e = "webrtc" : getuseengine() === webphone_api.global.ENGINE_SERVICE ? e = "ns" : getuseengine() === webphone_api.global.ENGINE_FLASH && (e = "flash"), "Windows" === GetOs() && "flash" === e || (SaveParameter("lastusedengine", e), !isNull(e) && e.length > 0 && (webphone_api.global.last_used_engine_cache = e), PutToDebugLog(2, "EVENT, lastusedengine saved: " + e))
        } catch (o) {
            PutToDebugLogException(2, "common: SaveLastUsedEngine", o)
        }
    }

    function IsLocalFileSystem() {
        try {
            var e = location.protocol;
            if (isNull(e) && (e = location.href, e = decodeURIComponent(e), isNull(e) || e.length < 2)) return !1;
            if (e = e.toLowerCase(), e = Trim(e), e.indexOf("file:") >= 0) return !0
        } catch (o) {
            PutToDebugLogException(2, "common: IsLocalFileSystem", o)
        }
        return !1
    }

    function IsLocalFileSys() {
        try {
            var e = location.protocol;
            if (isNull(e) && (e = location.href, e = decodeURIComponent(e), isNull(e) || e.length < 2)) return !1;
            var o = [];
            o.push("f"), o.push("i"), o.push("l"), o.push("e"), o.push(":");
            var t = o.join("");
            if (e = e.toLowerCase(), e = Trim(e), e.indexOf(t) >= 0) return !0
        } catch (n) {
            PutToDebugLogException(2, "common: ilfs", n)
        }
        return !1
    }

    function CallScriptingUrl(e, o, t, n, i, a, r, s, l, p) {
        try {
            if (isNull(e) || Trim(e).length < 4) return;
            isNull(o) && (o = ""), isNull(t) && (t = ""), isNull(n) && (n = ""), isNull(a) && (a = ""), isNull(s) && (s = ""), isNull(l) && (l = ""), isNull(i) && (i = "");
            var c = GetSipusername(), u = GetParameter("password"), h = GetParameter("serveraddress"),
                m = RandomInt(1e4, 9999999).toString(), g = Md5Hash(c + ":" + u), d = Md5Hash(c + ":" + u + ":" + m);
            (isNull(r) || r.length < 1) && (r = "scripting_cb"), e.indexOf("USERNAME") > 0 ? e = e.replace("USERNAME", c) : (e.indexOf("?") < 0 ? e += "?" : e += "&", e = e + "username=" + c), e = e.replace("PASSWORD", u), e = e.replace("CALLEDNUMBER", n), e.indexOf("PEERNUM") > 0 ? e = e.replace("PEERNUM", n) : (e.indexOf("?") < 0 ? e += "?" : e += "&", e = e + "peernumber=" + n), e.indexOf("PEERDETAILS") > 0 ? e = e.replace("PEERDETAILS", i) : (e.indexOf("?") < 0 ? e += "?" : e += "&", e = e + "peerdetails=" + i), e.indexOf("SERVERADDRESS") > 0 ? e = e.replace("SERVERADDRESS", h) : (e.indexOf("?") < 0 ? e += "?" : e += "&", e = e + "server=" + h), e = e.replace("DIRECTION", t), e = e.replace("STATUS", o), e = e.replace("TEXT", a), e = e.replace("CURRENCY", ""), e = e.replace("DEVICEID", GetDeviceId()), e = e.replace("CONNECTTIME", s), e = e.replace("DURATION", l), e = e.replace("MD5SIMPLE", g), e = e.replace("MD5NORMAL", d), e = e.replace("MD5SALT", m), !isNull(p) && p.length > 0 && (e = e + "&cdr=" + encodeURIComponent(p)), PutToDebugLogSpecial(3, "EVENT,CallScriptingUrl: " + e, !1, ""), UriParser(e, "", "", "", "", r)
        } catch (b) {
            PutToDebugLogException(2, "common: CallScriptingUrl", b)
        }
    }

    function ShowOfferSaveContact() {
        try {
            if (webphone_api.global.lastcallduration < 1) return;
            if (!0 === IsCExt()) return;
            if (webphone_api.global.lastcallduration = 0, webphone_api.$(".ui-page-active .ui-popup-active").length > 0) return;
            !1 === webphone_api.global.contactExists && !isNull(webphone_api.global.contactExistsNr) && webphone_api.global.contactExistsNr.length > 0 && "1" === GetParameter("savetocontacts") && (OfferSaveContact(webphone_api.global.contactExistsNr, webphone_api.global.callName), webphone_api.global.contactExists = !0, webphone_api.global.contactExistsNr = "")
        } catch (e) {
            PutToDebugLogException(2, "common: ShowOfferSaveContact", e)
        }
    }

    function OfferSaveContact(e, o, t) {
        try {
            var n = GetDeviceWidth();
            if (n = !isNull(n) && IsNumber(n) && n > 100 ? Math.floor(n / 1.2) : 220, !isNull(webphone_api.global.lastconfroom) && webphone_api.global.lastconfroom.length > 2) {
                var i = " " + e;
                if (webphone_api.global.lastconfroom.indexOf(i) > 0) return
            }
            o = isNull(o) || o === e ? "" : "<br />" + o;
            var a = "";
            a = '<li id="#offer_item_save"><a data-rel="back" style="text-align: center;">' + webphone_api.stringres.get("btn_save_to_contacts_1") + "</a></li>" + ('<li id="#offer_item_cancel"><a data-rel="back" style="text-align: center;">' + webphone_api.stringres.get("btn_cancel") + "</a></li>") + ('<li id="#offer_item_dontask"><a data-rel="back">' + webphone_api.stringres.get("btn_save_to_contacts_dontask") + "</a></li>");
            var r = '<div id="savetocontacts" data-role="popup" class="ui-content messagePopup" data-overlay-theme="a" data-theme="a" style="max-width:' + n + "px; min-width: " + Math.floor(.6 * n) + 'px;"><div data-role="header" data-theme="b"><a href="javascript:;" data-role="button" data-icon="delete" data-iconpos="notext" class="ui-btn-right closePopup">Close</a><h1 class="adialog_title">' + webphone_api.stringres.get("save_to_contacts_title") + '</h1></div><div role="main" class="ui-content adialog_content" style="padding: 0; margin: 0;"><div style="text-align: center; margin-top: .5em; margin-bottom: .5em;">' + webphone_api.stringres.get("save_to_contacts_msg") + "<br />" + e + o + '</div><ul id="savetocontacts_ul" data-role="listview" data-inset="true" data-icon="false" style="margin: 0;">' + a + "</ul></div></div>";
            savectpopup_wasclosed = !1, t = t || function () {
            }, webphone_api.$.mobile.activePage.append(r).trigger("create"), webphone_api.$.mobile.activePage.find(".closePopup").bind("tap", function (e) {
                webphone_api.$.mobile.activePage.find(".messagePopup").popup("close"), savectpopup_wasclosed = !0
            }), webphone_api.$.mobile.activePage.find(".messagePopup").popup().popup("open").bind({
                popupafterclose: function () {
                    savectpopup_wasclosed = !0, webphone_api.$(this).unbind("popupafterclose").remove(), webphone_api.$("#savetocontacts_ul").off("click", "li"), t()
                }
            }), webphone_api.$("#savetocontacts_ul").on("click", "li", function (t) {
                var n = webphone_api.$(this).attr("id");
                webphone_api.$("#savetocontacts").on("popupafterclose", function (t) {
                    savectpopup_wasclosed = !0, "#offer_item_save" === n && (webphone_api.global.intentaddeditct[0] = "action=add", webphone_api.global.intentaddeditct[1] = "numbertoadd=" + e, webphone_api.global.intentaddeditct[2] = "nametoadd=" + o, webphone_api.$.mobile.changePage("#page_addeditcontact", {
                        transition: "pop",
                        role: "page"
                    })), "#offer_item_cancel" === n || "#offer_item_dontask" === n && SaveParameter("savetocontacts", "0")
                })
            }), setTimeout(function () {
                !1 === savectpopup_wasclosed && webphone_api.$.mobile.activePage.find(".messagePopup").popup("close"), savectpopup_wasclosed = !0, webphone_api.global.contactExists = !0, webphone_api.global.contactExistsNr = ""
            }, 15e3)
        } catch (s) {
            PutToDebugLogException(2, "common: OfferSaveContact", s)
        }
    }

    function ContactIsFavorite(e) {
        try {
            if (isNull(webphone_api.global.ctlist) || webphone_api.global.ctlist.length < 1 || isNull(e) || e.length < 1 || !IsNumber(e)) return !1;
            var o = webphone_api.global.ctlist[e];
            if (isNull(o)) return !1;
            var t = o[CT_FAV];
            if (!isNull(t) && "1" === t) return !0
        } catch (n) {
            PutToDebugLogException(2, "common: ContactIsFavorite", n)
        }
        return !1
    }

    function ContactSetFavorite(e, o) {
        try {
            if (isNull(webphone_api.global.ctlist) || webphone_api.global.ctlist.length < 1 || isNull(e) || e.length < 1) return;
            var t = "0";
            isNull(o) || !0 !== o || (t = "1");
            var n = webphone_api.global.ctlist[e];
            if (isNull(n)) return;
            n[CT_FAV] = t, webphone_api.global.ctlist[e] = n, webphone_api.global.wasCtModified = !0
        } catch (i) {
            PutToDebugLogException(2, "common: ContactSetFavorite", i)
        }
    }

    function AudioDevicePopupSDK(e, o, t, n) {
        try {
            if (!isNull(audiomodal)) return void audiomodal.show();
            var i = GetParameter("volumein"), a = GetParameter("volumeout");
            !isNull(i) && IsNumber(i) || (i = "50"), !isNull(a) && IsNumber(a) || (a = "50");
            var r = "";
            getuseengine() !== webphone_api.global.ENGINE_WEBRTC && (r = '<div class="audio_devider" style="float: left; clear: both; background: #cecece; width: 100%; height: .1em;">\x3c!--//--\x3e</div><div class="audio_left_container" style="width: 35%; float: left; font-size: 1.1em;"><label id="audio_ring_label" style="display: inline-block; margin-top: 1.3em;">' + webphone_api.stringres.get("audio_ring") + ':</label></div><div class="audio_right_container" style="width: 60%; float: left; margin: 1em 0em 1em 0em;"><select name="audioselect_ring" id="audioselect_ring" style="margin: 0; width: 100%;">' + t + "</select></div>");
            var s = "";
            !isNull(n) && n.length > 0 && (s = '<div class="audio_devider" style="float: left; clear: both; background: #cecece; width: 100%; height: .1em;">\x3c!--//--\x3e</div><div class="audio_left_container" style="width: 35%; float: left; font-size: 1.1em;"><label id="video_rec_label" style="display: inline-block; margin-top: 1.3em;">' + webphone_api.stringres.get("video_rec") + ':</label></div><div class="audio_right_container" style="width: 60%; float: left; margin: 1em 0em 1em 0em;"><select name="videoselect_rec" id="videoselect_rec" style="margin: 0; width: 100%;">' + n + "</select></div>");
            var l = "";
            !isNull(o) && o.length > 0 && (l = '<div class="audio_devider" style="float: left; clear: both; background: #cecece; width: 100%; height: .1em;">\x3c!--//--\x3e</div><div class="audio_left_container" style="width: 35%; float: left; font-size: 1.1em;"><label id="audio_rec_label" style="display: inline-block; margin-top: 2.3em;">' + webphone_api.stringres.get("audio_rec") + ':</label></div><div class="audio_right_container" style="width: 60%; float: left; margin: 1em 0em 1em 0em;"><select name="audioselect_play" id="audioselect_play" style="margin: 0; width: 100%;">' + o + '</select><span id="audio_volumeout_value" style="background: #ccc; padding: .5em;">' + a + '</span><input name="audio_volumeout" id="audio_volumeout" min="0" max="100" value="' + a + '" type="range" style="margin-top: 1em; width: 80%;"></div>');
            var p = '<span id="audio_volumein_value" style="background: #ccc; padding: .5em;">' + i + '</span><input name="audio_volumein" id="audio_volumein" min="0" max="100" value="' + i + '" type="range" style="margin-top: 1em; width: 80%;">';
            getuseengine() === webphone_api.global.ENGINE_WEBRTC && (p = ""), audiomodal = webphone_api.picoModal({
                content: '<div id="audiodevice_modal" class="pmodal_container"><div id="audiodevice_modal_header" class="pmodal_header">' + webphone_api.stringres.get("audio_title") + '</div><div id="audiodevice_modal_content" class="pmodal_content" style="padding: 1em;"><div class="audio_left_container" style="width: 35%; float: left; font-size: 1.1em;"><label id="audio_mic_label" style="display: inline-block; margin-top: 2.3em;">' + webphone_api.stringres.get("audio_mic") + ':</label></div><div class="audio_right_container" style="width: 60%; float: left; margin: 1em 0em 1em 0em;"><select name="audioselect_rec" id="audioselect_rec" style="margin: 0; width: 100%;">' + e + "</select>" + p + "</div>" + l + r + s + '</div><div id="audiodevice_modal_footer" class="pmodal_footer" style="float: left; width: 100%; margin-top: 1em;"><button id="btn_audiodevice_positive">' + webphone_api.stringres.get("btn_ok") + '</button><button id="btn_audiodevice_negative">' + webphone_api.stringres.get("btn_cancel") + "</button></div></div>",
                overlayStyles: { backgroundColor: "#565656", opacity: .6 },
                modalStyles: { width: "20em" },
                overlayClose: !1,
                closeStyles: {
                    background: "#eeeeee",
                    position: "absolute",
                    top: ".2em",
                    right: ".3em",
                    textAlign: "center",
                    fontSize: "1.2em",
                    fontWeight: "bold",
                    border: ".15em solid #bbb",
                    borderRadius: ".8em",
                    paddingLeft: ".25em",
                    paddingRight: ".25em",
                    cursor: "pointer"
                }
            }).afterCreate(function (e) {
            }).beforeShow(function (e, o) {
            }).afterShow(function (e) {
            }).beforeClose(function (e, o) {
            }).afterClose(function (e) {
                e.destroy(), audiomodal = null, webphone_api.webrtcapi.HideVideoPriview()
            }), audiomodal.show(), webphone_api.$("#audio_volumein").on("change", function () {
                webphone_api.$("#audio_volumein_value").html(webphone_api.$(this).val())
            }), webphone_api.$("#audio_volumeout").on("change", function () {
                webphone_api.$("#audio_volumeout_value").html(webphone_api.$(this).val())
            }), webphone_api.$("#videoselect_rec").on("change", function () {
                var e = webphone_api.$("#videoselect_rec").val();
                webphone_api.webrtcapi.MyCameraPreview(e)
            }), webphone_api.$("#btn_audiodevice_positive").on("click", function () {
                try {
                    PutToDebugLog(5, "EVENT, common AudioDevicePopupSDK OK click");
                    var e = webphone_api.$("#audioselect_rec").val(), o = webphone_api.$("#audioselect_play").val(),
                        t = webphone_api.$("#audioselect_ring").val(), n = "";
                    isNull(document.getElementById("videoselect_rec")) || (n = webphone_api.$("#videoselect_rec").val()), !isNull(arecL) && arecL.length > 0 && (PutToDebugLog(2, "EVENT, mlogic API_SetDevice AudioDevicePopupSDK 0"), webphone_api.setdevice(0, e, 2)), !isNull(aplayL) && aplayL.length > 0 && (PutToDebugLog(2, "EVENT, mlogic API_SetDevice AudioDevicePopupSDK 1"), webphone_api.setdevice(1, o, 2)), !isNull(t) && !isNull(aringL) && aringL.length > 0 && (PutToDebugLog(2, "EVENT, mlogic API_SetDevice AudioDevicePopupSDK 2"), webphone_api.setdevice(2, t, 2)), !isNull(n) && n.length > 0 && !isNull(vrecL) && vrecL.length > 0 && vrecL[0] !== n && (PutToDebugLog(2, "EVENT, mlogic API_SetDevice AudioDevicePopupSDK 3"), webphone_api.setdevice(3, n, 2)), setTimeout(function () {
                        PutToDebugLog(2, "EVENT, mlogic API_GetDevice AudioDevicePopupSDK 0"), webphone_api.getdevice(0, function (e) {
                        }), PutToDebugLog(2, "EVENT, mlogic API_GetDevice AudioDevicePopupSDK 1"), webphone_api.getdevice(1, function (e) {
                        }), PutToDebugLog(2, "EVENT, mlogic API_GetDevice AudioDevicePopupSDK 3"), webphone_api.getdevice(3, function (e) {
                        })
                    }, 300);
                    var i = webphone_api.$("#audio_volumein").val(), a = webphone_api.$("#audio_volumeout").val();
                    !isNull(i) && i.length > 0 && IsNumber(i) && (SaveParameter("volumein", i), PutToDebugLog(2, "EVENT, mlogic API_SetVolume AudioDevicePopupSDK 0"), webphone_api.setvolume(0, i)), !isNull(a) && a.length > 0 && IsNumber(a) && (SaveParameter("volumeout", a), PutToDebugLog(2, "EVENT, mlogic API_SetVolume AudioDevicePopupSDK 1"), webphone_api.setvolume(1, a)), audiomodal.close()
                } catch (r) {
                    PutToDebugLogException(2, "common: AudioDevicePopupSDK OK click", r)
                }
            }), webphone_api.$("#btn_audiodevice_negative").on("click", function () {
                audiomodal.close()
            })
        } catch (c) {
            PutToDebugLogException(2, "common: AudioDevicePopupSDK", c)
        }
    }

    function AudioDevicePopup(e) {
        try {
            var o = GetDeviceWidth();
            o = !isNull(o) && IsNumber(o) && o > 100 ? Math.floor(o / 1.2) : 220, arecL = GetAudioRecList().split("\r\n"), aplayL = GetAudioPlayList().split("\r\n"), aringL = GetAudioRingList().split("\r\n"), getuseengine() === webphone_api.global.ENGINE_WEBRTC && !isNull(GetVideoRecList()) && GetVideoRecList().length > 0 && (vrecL = GetVideoRecList().split("\r\n"));
            var t = '<option value="[VALUE]">[TEXT]</option>', n = "", i = "", a = "", r = "";
            if (!isNull(arecL)) for (var s = 0; s < arecL.length; s++) if (!(isNull(arecL[s]) || arecL[s].length < 1)) {
                var l = !1, p = GetAudioRecDev();
                !isNull(p) && p.length > 0 && (p.indexOf(arecL[s]) >= 0 || arecL[s].indexOf(p) >= 0) && (l = !0, n = t + n), !1 === l && (n += t), n = n.replace("[VALUE]", arecL[s]), n = n.replace("[TEXT]", arecL[s])
            }
            if (!isNull(aplayL)) for (var s = 0; s < aplayL.length; s++) if (!(isNull(aplayL[s]) || aplayL[s].length < 1)) {
                var l = !1, c = GetAudioPlayDev();
                !isNull(c) && c.length > 0 && (c.indexOf(aplayL[s]) >= 0 || aplayL[s].indexOf(c) >= 0) && (l = !0, i = t + i), !1 === l && (i += t), i = i.replace("[VALUE]", aplayL[s]), i = i.replace("[TEXT]", aplayL[s])
            }
            if (!isNull(aringL)) for (var s = 0; s < aringL.length; s++) if (!(isNull(aringL[s]) || aringL[s].length < 1)) {
                var l = !1, u = GetAudioRingDev();
                !isNull(u) && u.length > 0 && (u.indexOf(aringL[s]) >= 0 || aringL[s].indexOf(u) >= 0) && (l = !0, a = t + a), !1 === l && (a += t), a = a.replace("[VALUE]", aringL[s]), a = a.replace("[TEXT]", aringL[s])
            }
            if (!isNull(vrecL)) for (var s = 0; s < vrecL.length; s++) if (!(isNull(vrecL[s]) || vrecL[s].length < 1)) {
                var l = !1;
                !isNull(webphone_api.global.video_rec_curr_device) && webphone_api.global.video_rec_curr_device.length > 0 && (webphone_api.global.video_rec_curr_device.indexOf(vrecL[s]) >= 0 || vrecL[s].indexOf(webphone_api.global.video_rec_curr_device) >= 0) && (l = !0, r = t + r), !1 === l && (r += t), r = r.replace("[VALUE]", vrecL[s]), r = r.replace("[TEXT]", vrecL[s])
            }
            if (!0 === IsSDK()) return void AudioDevicePopupSDK(n, i, a, r);
            var h = GetParameter("volumein"), m = GetParameter("volumeout");
            !isNull(h) && IsNumber(h) || (h = "50"), !isNull(m) && IsNumber(m) || (m = "50");
            var g = "";
            getuseengine() !== webphone_api.global.ENGINE_WEBRTC && (g = '<div class="audio_devider">\x3c!--//--\x3e</div><div class="audio_left_container"><label id="audio_ring_label">' + webphone_api.stringres.get("audio_ring") + ':</label></div><div class="audio_right_container"><select name="audioselect_ring" id="audioselect_ring" style="margin: 0;">' + a + "</select></div>");
            var d = "";
            !isNull(r) && r.length > 0 && (d = '<div class="audio_devider">\x3c!--//--\x3e</div><div class="audio_left_container"><label id="video_rec_label">' + webphone_api.stringres.get("video_rec") + ':</label></div><div class="audio_right_container"><select name="videoselect_rec" id="videoselect_rec" style="margin: 0;">' + r + "</select></div>");
            var b = "";
            !isNull(i) && i.length > 0 && (b = '<div class="audio_devider">\x3c!--//--\x3e</div><div class="audio_left_container"><label id="audio_rec_label">' + webphone_api.stringres.get("audio_rec") + ':</label></div><div class="audio_right_container"><select name="audioselect_play" id="audioselect_play" style="margin: 0;">' + i + '</select><input name="audio_volumeout" id="audio_volumeout" data-highlight="true" data-mini="true" min="0" max="100" value="' + m + '" type="range"></div>');
            var _ = '<input name="audio_volumein" id="audio_volumein" data-highlight="true" data-mini="true" min="0" max="100" value="' + h + '" type="range">';
            getuseengine() === webphone_api.global.ENGINE_WEBRTC && (_ = "");
            var f = '<div id="audiodevice_popup" data-role="popup" class="ui-content messagePopup" data-overlay-theme="a" data-theme="a" style="width:' + o + "px; max-width:" + o + "px; min-width: " + Math.floor(.6 * o) + 'px;"><div data-role="header" data-theme="b"><a href="javascript:;" data-role="button" data-icon="delete" data-iconpos="notext" class="ui-btn-right closePopup">Close</a><h1 class="adialog_title">' + webphone_api.stringres.get("audio_title") + '</h1></div><div role="main" class="ui-content adialog_content" style="padding: 0; margin: 0; width: 100%;"><div class="audio_left_container"><label id="audio_mic_label">' + webphone_api.stringres.get("audio_mic") + ':</label></div><div class="audio_right_container"><select name="audioselect_rec" id="audioselect_rec" style="margin: 0;">' + n + "</select>" + _ + "</div>" + b + g + d + '</div><div data-role="footer" data-theme="b" class="adialog_footer"><a href="javascript:;" id="adialog_positive" class="ui-btn ui-corner-all ui-shadow ui-btn-inline ui-btn-b adialog_2button" data-rel="back" data-transition="flow">' + webphone_api.stringres.get("btn_ok") + '</a><a href="javascript:;" id="adialog_negative" class="ui-btn ui-corner-all ui-shadow ui-btn-inline ui-btn-b adialog_2button" data-rel="back">' + webphone_api.stringres.get("btn_cancel") + "</a></div></div>";
            savectpopup_wasclosed = !1, e = e || function () {
            }, webphone_api.$.mobile.activePage.append(f).trigger("create"), webphone_api.$.mobile.activePage.find(".closePopup").bind("tap", function (e) {
                webphone_api.$.mobile.activePage.find(".messagePopup").popup("close")
            }), webphone_api.$.mobile.activePage.find(".messagePopup").popup().popup("open").bind({
                popupafterclose: function () {
                    webphone_api.$(this).unbind("popupafterclose").remove(), webphone_api.$("#videoselect_rec").off("change"), webphone_api.webrtcapi.HideVideoPriview(), e()
                }
            }), webphone_api.$("#videoselect_rec").on("change", function () {
                var e = webphone_api.$("#videoselect_rec").val();
                webphone_api.webrtcapi.MyCameraPreview(e)
            }), webphone_api.$("#adialog_positive").on("click", function (e) {
                PutToDebugLog(5, "EVENT, common AudioDevicePopup close on click");
                var o = (webphone_api.$(this).attr("id"), webphone_api.$("#audioselect_rec").val()),
                    t = webphone_api.$("#audioselect_play").val(), n = webphone_api.$("#audioselect_ring").val(),
                    i = "";
                isNull(document.getElementById("videoselect_rec")) || (i = webphone_api.$("#videoselect_rec").val()), !isNull(arecL) && arecL.length > 0 && (PutToDebugLog(2, "EVENT, mlogic API_SetDevice AudioDevicePopup 0"), webphone_api.setdevice(0, o, 2)), !isNull(aplayL) && aplayL.length > 0 && (PutToDebugLog(2, "EVENT, mlogic API_SetDevice AudioDevicePopup 1"), webphone_api.setdevice(1, t, 2)), !isNull(n) && !isNull(aringL) && aringL.length > 0 && (PutToDebugLog(2, "EVENT, mlogic API_SetDevice AudioDevicePopup 2"), webphone_api.setdevice(2, n, 2)), !isNull(i) && i.length > 0 && !isNull(vrecL) && vrecL.length > 0 && vrecL[0] !== i && webphone_api.setdevice(3, i, 2), setTimeout(function () {
                    PutToDebugLog(2, "EVENT, mlogic API_GetDevice AudioDevicePopup 0"), webphone_api.getdevice(0, function (e) {
                    })
                }, 200), setTimeout(function () {
                    PutToDebugLog(2, "EVENT, mlogic API_GetDevice AudioDevicePopup 1"),
                        webphone_api.getdevice(1, function (e) {
                        })
                }, 300), setTimeout(function () {
                    PutToDebugLog(2, "EVENT, mlogic API_GetDevice AudioDevicePopup 2"), webphone_api.getdevice(2, function (e) {
                    })
                }, 400), setTimeout(function () {
                    PutToDebugLog(2, "EVENT, mlogic API_GetDevice AudioDevicePopup 3"), webphone_api.getdevice(3, function (e) {
                    })
                }, 500);
                var a = webphone_api.$("#audio_volumein").val(), r = webphone_api.$("#audio_volumeout").val();
                !isNull(a) && a.length > 0 && IsNumber(a) && (SaveParameter("volumein", a), PutToDebugLog(2, "EVENT, mlogic API_SetVolume AudioDevicePopup 0"), webphone_api.setvolume(0, a)), !isNull(r) && r.length > 0 && IsNumber(r) && (SaveParameter("volumeout", r), PutToDebugLog(2, "EVENT, mlogic API_SetVolume AudioDevicePopup 1"), webphone_api.setvolume(1, r))
            })
        } catch (w) {
            PutToDebugLogException(2, "common: AudioDevicePopup", w)
        }
    }

    function IsContactBlocked(e, o) {
        try {
            if ((isNull(e) || e.length < 1) && (isNull(o) || o.length < 1)) return !1;
            var t = GetParameter2("blocked_contacts");
            if (isNull(t) || t.length < 1) return !1;
            t = Trim(t);
            var n = t.split(",");
            if (isNull(n) || n.length < 1) return !1;
            if (!isNull(e) && Trim(e).length > 0) for (var i = 0; i < n.length; i++) if (!(isNull(n[i]) || n[i].length < 1) && n[i] === e) return !0;
            if (!isNull(o) && o.length > 0) for (var i = 0; i < n.length; i++) if (!(isNull(n[i]) || n[i].length < 1)) for (var a = 0; a < o.length; a++) if (!(isNull(o[a]) || [a].length < 1) && n[i] === o[a]) return !0
        } catch (r) {
            PutToDebugLogException(2, "common: IsContactBlocked", r)
        }
        return !1
    }

    function IsNumberBlacklisted(e, o) {
        try {
            if ((isNull(e) || e.length < 1) && (isNull(o) || o.length < 1)) return !1;
            var t = GetParameter2("blacklist");
            if (isNull(t) || t.length < 1) return !1;
            t = Trim(t);
            var n = t.split(",");
            if (isNull(n) || n.length < 1) return !1;
            if (!isNull(e) && Trim(e).length > 0) for (var i = 0; i < n.length; i++) if (!(isNull(n[i]) || n[i].length < 1) && n[i] === e) return !0;
            if (!isNull(o) && o.length > 0) for (var i = 0; i < n.length; i++) if (!(isNull(n[i]) || n[i].length < 1)) for (var a = 0; a < o.length; a++) if (!(isNull(o[a]) || [a].length < 1) && n[i] === o[a]) return !0
        } catch (r) {
            PutToDebugLogException(2, "common: IsNumberBlacklisted", r)
        }
        return !1
    }

    function BlockContact(e, o) {
        try {
            if ((isNull(e) || e.length < 1) && (isNull(o) || o.length < 1)) return;
            var t = GetParameter2("blocked_contacts");
            if (isNull(t) && (t = ""), t = Trim(t), isNull(e) && Trim(e).length > 0 || (t.length > 0 && (t += ","), t += Trim(e)), !(isNull(o) && o.length > 0)) for (var n = 0; n < o.length; n++) isNull(o[n]) || Trim(o[n]).length < 1 || (t.length > 0 && (t += ","), t += Trim(o[n]));
            SaveParameter("blocked_contacts", t)
        } catch (i) {
            PutToDebugLogException(2, "common: BlockContact", i)
        }
    }

    function UnBlockContact(e, o) {
        try {
            if ((isNull(e) || e.length < 1) && (isNull(o) || o.length < 1)) return;
            var t = GetParameter2("blocked_contacts");
            if (isNull(t) || t.length < 1) return;
            t = Trim(t);
            var n = t.split(",");
            if (isNull(n) || n.length < 1) return;
            if (!isNull(e) && Trim(e).length > 0) {
                e = Trim(e);
                for (var i = 0; i < n.length; i++) isNull(n[i]) || n[i].length < 1 || n[i] === e && (n[i] = "")
            }
            if (!isNull(o) && o.length > 0) for (var i = 0; i < n.length; i++) if (!(isNull(n[i]) || n[i].length < 1)) for (var a = 0; a < o.length; a++) isNull(o[a]) || [a].length < 1 || n[i] === o[a] && (n[i] = "");
            t = "";
            for (var i = 0; i < n.length; i++) isNull(n[i]) || n[i].length < 1 || (t.length > 0 && (t += ","), t += n[i]);
            SaveParameter("blocked_contacts", t)
        } catch (r) {
            PutToDebugLogException(2, "common: UnBlockContact", r)
        }
    }

    function GetTlsProxyUrl(e) {
        try {
            if (isNull(e) || e.length < 1) return "";
            var o = RandomInt(1e5, 999999999);
            return "https://rtc.mizu-voip.com:4443/?hsforward=" + StrEc(e, "s7n1k8fnz7ejian4k", !1) + "&nocache=" + o.toString()
        } catch (t) {
            PutToDebugLogException(2, "common: GetTlsProxyUrl", t)
        }
        return ""
    }

    function SetLogFormAction() {
        try {
            if (!0 === IsSDK()) return;
            var e = document.getElementById("xlogpush");
            if (isNull(e)) return void PutToDebugLog(2, "ERROR, log form not found in HTML");
            var o = GetParameter("logform_action");
            (isNull(o) || o.length < 3) && (o = "http://mnt.mizu-voip.com/mmexreqvitserverjrsktt/xlogpush"), o = o.toLowerCase(), o = Trim(o), 0 !== o.indexOf("http") && (o = "http://" + o);
            var t = "";
            t = !0 === IsHttps() ? GetTlsProxyUrl(o) : o, e.action = t, PutToDebugLog(2, "EVENT, SetLogFormAction: " + t.replace("mnt.mizu-voip", "xxx"))
        } catch (n) {
            PutToDebugLogException(2, "common: SetLogFormAction", n)
        }
    }

    function SentWebrtcSignaling(e) {
        isNull(e) || e.length < 1 || 0 !== e.indexOf("INVITE sip") && (e.indexOf("REGISTER sip:") >= 0 || e.indexOf("REGISTER sips:") >= 0) && (webphone_api.global.webrtclastregsent = GetTickCount(), isNull(wrereg_timer) || clearTimeout(wrereg_timer), wrereg_timer = null, GetTickCount() - webphone_api.global.webrtcregtimer_exec > 8e3 && (wrereg_timer = setTimeout(function () {
            webphone_api.global.webrtcregtimer_exec = GetTickCount(), PutToDebugLog(2, "WARNING, Webrtc resend REGISTER because no answer received for previous register"), webphone_api.webrtcapi.ResendRegister()
        }, 6e3)))
    }

    function GetRecentInviteIn() {
        return lastinvite_in
    }

    function GetWebrtcDisplayName() {
        return !isNull(webphone_api.global.sipunicoderewritefrom) && webphone_api.global.sipunicoderewritefrom.length > 0 && !isNull(webphone_api.global.sipunicoderewriteto) && webphone_api.global.sipunicoderewriteto.length > 0 && webphone_api.global.sipunicoderewriteto === displayname ? webphone_api.global.sipunicoderewritefrom : displayname
    }

    function CatchWebrtcSignaling(e, o) {
        try {
            if (isNull(e) || e.length < 1 || isNull(o)) return;
            getuseengine() === webphone_api.global.ENGINE_WEBRTC && (webphone_api.global.iscurrengineworking = !0), webphone_api.iswebrtcengineworking = 1, e = e.toString(), webphone_api.global.failover_gateway = !1;
            try {
                var t = "", n = Trim(e), i = n.indexOf("\r\n");
                i > 0 && (t = n.substring(0, i)), isNull(t) && (t = ""), t = t.toLowerCase()
            } catch (E) {
                PutToDebugLogException(2, "common: CatchWebrtcSignaling inner 1", E)
            }
            if (GetParameterInt("forcereregister", 1) > 0) {
                var a = GetSipHeaderFromMsg(e, "CSeq");
                if (!isNull(a) && a.indexOf("REGISTER") > 0) {
                    var r = e.indexOf("\r\n");
                    if (r > 0) {
                        var s = e.substring(0, i);
                        if (!isNull(s) && (s = Trim(s), (r = s.indexOf(" ")) > 0 && (s = Trim(s.substring(r)), !isNull(s) && (r = s.indexOf(" "), r > 0 && (s = s.substring(0, r)), !isNull(s) && IsNumber(s))))) {
                            var l = StrToInt(s);
                            l >= 200 ? (isNull(wrereg_timer) || clearTimeout(wrereg_timer), wrereg_timer = null) : 200 === l && 1 === GetParameterInt("forcereregister", 1) && webphone_api.webrtcapi.StartReRegister(!0)
                        }
                    }
                }
            }
            if (!isNull(t) && t.indexOf(!1)) try {
                var p = GetSipHeaderFromMsg(e, "X-Sms");
                if (!isNull(p) && p.length > 0 && p.toLowerCase().indexOf("yes") >= 0 && e.indexOf("\r\n\r\n") > 0) {
                    var c = e.substring(e.indexOf("\r\n\r\n") + 4);
                    if (isNull(c) && (c = ""), c = Trim(c), c.length > 0) {
                        var u = GetSipHeaderFromMsg(e, "From");
                        if (!isNull(u) && u.length > 0 && u.indexOf("<") >= 0 && (u = u.substring(u.indexOf("<") + 1), u.indexOf("@") > 0)) {
                            u = u.substring(0, u.indexOf("@")), u = u.replace("sips:", ""), u = u.replace("sip:", "");
                            try {
                                webphone_api.onSmsCb(u, c)
                            } catch (E) {
                                webphone_api.common.PutToDebugLogException(2, "There is an error in onSms() callback", E)
                            }
                        }
                    }
                }
            } catch (E) {
                PutToDebugLogException(2, "common: CatchWebrtcSignaling handle SMS", E)
            }
            if (!isNull(t) && t.indexOf("invite") >= 0) {
                var h = "";
                if (e.indexOf("recv=") >= 0) {
                    var m = e.toLowerCase();
                    (m.indexOf("p-auto-answer:normal") > 0 || m.indexOf("p-auto-answer: normal") > 0 || m.indexOf("answer-mode: auto") > 0 || m.indexOf("answer-mode:auto") > 0 || webphone_api.global.autoacceptsipheader.length > 0 && m.indexOf(webphone_api.global.autoacceptsipheader) > 0) && setTimeout(function () {
                        webphone_api.common.PutToDebugLog(3, "EVENT, autoaccept INVITE sip header: WebRTC accept"), webphone_api.webrtcapi.SipAccept(webphone_api.global.aline, !1)
                    }, 800);
                    var u = GetSipHeaderFromMsg(e, "From");
                    !isNull(u) && u.length > 0 && u.indexOf("<") >= 0 && (u = u.substring(u.indexOf("<") + 1), u.indexOf("@") > 0 && (u = u.substring(0, u.indexOf("@")), u = u.replace("sips:", ""), u = u.replace("sip:", ""), h = Trim(u)))
                } else {
                    var u = GetSipHeaderFromMsg(e, "To");
                    !isNull(u) && u.length > 0 && u.indexOf("<") >= 0 && (u = u.substring(u.indexOf("<") + 1), u.indexOf("@") > 0 && (u = u.substring(0, u.indexOf("@")), u = u.replace("sips:", ""), u = u.replace("sip:", ""), h = Trim(u)))
                }
                if (!isNull(h) && h.length > 0) for (var g = 0; g < webphone_api.global.ep.length; g++) {
                    var d = webphone_api.global.ep[g][EP_DESTNR];
                    if (!isNull(d) && d.length > 0 && d.toLowerCase() === h.toLowerCase()) {
                        webphone_api.global.ep[g][EP_SIPINVITE] = e, webphone_api.global.ep[g][EP_CALLID] = GetSipHeaderFromMsg(e, "Call-ID");
                        break
                    }
                }
            }
            if (!0 === webphone_api.global.redialof && !isNull(e) && e.length > 0) try {
                var b = GetSipHeaderFromMsg(e, "CSeq");
                isNull(b) && (b = ""), b = b.toLowerCase(), b.indexOf("invite") >= 0 && (t.indexOf("100 trying") > 0 || t.indexOf("603 decline") > 0 || t.indexOf("486 busy here") > 0) && (webphone_api.global.redialof = !1)
            } catch (E) {
                PutToDebugLogException(2, "common: CatchWebrtcSignaling inner 2", E)
            }
            t.indexOf("503 ") > 0 && (PutToDebugLog(2, "WARNING,Restating webrtc sipstack because 503 received: " + t), webphone_api.flagrestartwebrtc = !0, webphone_api.webrtcapi.ReStart(5e3, !1));
            var _ = !1;
            switch (o) {
                case SIP_REGISTER:
                    e.length > 10 && (lastreg = e, lastmsg = e);
                    break;
                case SIP_INVITE_IN:
                    e.length > 10 && (lastinvite_in = e, lastmsg = e);
                    break;
                case SIP_INVITE_OUT:
                    e.length > 10 && (lastinvite_out = e, lastmsg = e);
                    break;
                case SIP_UNKNOWN:
                    _ = !0;
                    break;
                default:
                    _ = !0
            }
            if (lastmsg = e, !0 === _) {
                var f = e.toLowerCase();
                if (f.indexOf("invite sip") >= 0 && f.indexOf("invite sip") < 10 && (lastinvite_in = e, e.indexOf("recv=") >= 0)) {
                    var u = GetSipHeaderFromMsg(e, "From");
                    !isNull(u) && u.length > 0 && u.indexOf("<") > 0 && (u = u.substring(0, u.indexOf("<")), isNull(u) && (u = ""), u = ReplaceAll(u, '"', ""), displayname = Trim(u))
                }
            }
            var w = GetSipHeaderFromMsg(e, "X-IMStatus");
            if (!isNull(w) && w.length > 0) {
                var u = GetSipHeaderFromMsg(e, "From");
                isNull(u) && (u = "");
                var v = u.indexOf("<sip:");
                v >= 0 && (u = u.substring(v + 5), v = u.indexOf("@"), v >= 0 && (u = u.substring(0, v)), u = Trim(u)), u !== GetSipusername() && u !== GetCallerid() && SaveReceivedPresence2(u, w)
            }
            GetWebrtcCreditRating(e), GetWebrtcOptions(e), UpdateShCache(lastmsg)
        } catch (E) {
            PutToDebugLogException(2, "common: CatchWebrtcSignaling", E)
        }
    }

    function GetSipHeaderFromMsg(e, o) {
        try {
            if (isNull(e) || e.length < 10 || isNull(o) || o.length < 1) return "";
            var t = "";
            o = Trim(o), o = o.toLowerCase(), 0 === o.indexOf("x-r-") && (o = o.replace("x-r-", ""));
            var n = "\r\n";
            e.indexOf("\r\n") < 0 && e.indexOf("\n") >= 0 && (n = "\n");
            var i = e.split(n);
            if (isNull(i)) return "";
            for (var a = 0, r = 0; r < i.length; r++) if (!(isNull(i[r]) || i[r].indexOf(":") < 1)) {
                a = i[r].indexOf(":");
                var s = Trim(i[r].substring(0, a));
                if (s = s.toLowerCase(), 0 === s.indexOf("x-r-") && (s = s.replace("x-r-", "")), s === o) {
                    t = Trim(i[r].substring(a + 1, i[r].length));
                    break
                }
            }
            return isNull(t) && (t = ""), t
        } catch (l) {
            PutToDebugLogException(2, "common: GetSipHeaderFromMsg", l)
        }
        return ""
    }

    function RewriteSipHeaderInMsg(e, o, t) {
        try {
            if (isNull(e) || e.length < 10 || isNull(o) || o.length < 1 || isNull(t)) return e;
            var n = e;
            o.indexOf(":") < 0 && (o += ":");
            var i = n.indexOf(o);
            if (i < 0) return e;
            var a = n.substring(0, i);
            n = n.substring(i);
            var r = "\r\n";
            n.indexOf("\r\n") < 0 && n.indexOf("\n") >= 0 && (r = "\n"), n = n.substring(n.indexOf(r) + r.length);
            return a + o + " " + t + r + n
        } catch (s) {
            PutToDebugLogException(2, "common: RewriteSipHeaderInMsg", s)
        }
        return e
    }

    function UpdateShCache(e) {
        try {
            if (isNull(e) || e.length < 10) return;
            isNull(shcache) && (shcache = {});
            for (var o in shcache) if (!(isNull(o) || o.length < 1)) {
                var t = GetSipHeaderFromMsg(e, o);
                !isNull(t) && t.length > 0 && (shcache[o] = t)
            }
        } catch (n) {
            PutToDebugLogException(2, "common: UpdateShCache", n)
        }
    }

    function RemoveSipHeadreFromCache(e) {
        try {
            if (isNull(e) || e.length < 1) return !1;
            e = Trim(e), e = e.toLowerCase(), 0 === e.indexOf("x-r-") && (e = e.replace("x-r-", "")), shcache[e] = ""
        } catch (o) {
            PutToDebugLogException(2, "common: RemoveSipHeadreFromCache", o)
        }
    }

    function GetSipHeaderInternal(e) {
        return GetSipHeader(e, !0)
    }

    function GetSipHeader(e, o) {
        try {
            if (isNull(e) || e.length < 1) return PutToDebugLog(2, "ERROR, GetSipHeader header is NULL"), "ERROR, GetSipHeader header is NULL";
            if (e = e.toLowerCase(), e = Trim(e), 0 === e.indexOf("x-r-") && (e = e.replace("x-r-", "")), isNull(shcache) && (shcache = {}), e in shcache) {
                if (t = shcache[e], isNull(t)) {
                    if (!0 === o) return "";
                    PutToDebugLog(3, "WARNING, GetSipHeader header not found"), t = "WARNING: header not found"
                }
                return t
            }
            var t = GetSipHeaderFromMsg(lastmsg, e);
            return isNull(t) && (t = ""), shcache[e] = t, t.length < 1 ? !0 === o ? "" : (PutToDebugLog(3, "WARNING, GetSipHeader no headers available at this moment"), "WARNING: header not found") : t
        } catch (n) {
            PutToDebugLogException(2, "common: GetSipHeader", n)
        }
        return "ERROR, common: GetSipHeader failed"
    }

    function GetSipMessage(e, o, t) {
        try {
            return lastmsg
        } catch (n) {
            PutToDebugLogException(2, "common: GetSipMessage", n)
        }
        return "ERROR, common: GetSipMessage failed"
    }

    function GetWebrtcCreditRating(e) {
        try {
            if (!1 === Glbr()) return;
            if (isNull(e)) return;
            e = e.toString();
            var o = e.indexOf("Credit:");
            if (o > 0) {
                var t = e.substring(o + 7);
                o = t.indexOf("\r\n"), o > 0 && (t = t.substring(0, o)), o = t.indexOf("\n"), o > 0 && (t = t.substring(0, o)), !isNull(t) && t.length > 0 && PutToDebugLog(1, "CREDIT,Credit: " + Trim(t))
            }
            var o = e.indexOf("Rating:");
            if (o > 0) {
                var n = e.substring(o + 7);
                o = e.indexOf("\r\n"), o > 0 && (n = n.substring(0, o)), o = e.indexOf("\n"), o > 0 && (n = n.substring(0, o)), !isNull(n) && n.length > 0 && (webphone_api.global.rating = " (" + Trim(n) + ")", PutToDebugLog(4, "GetWebrtcCreditRating received rating: " + Trim(n)))
            }
        } catch (i) {
            PutToDebugLogException(2, "common: GetWebrtcCreditRating", i)
        }
    }

    function GetWebrtcOptions(e) {
        try {
            if (isNull(e)) return;
            e = e.toString();
            var o = e.indexOf("X-RTCOptions:");
            if (o > 0) {
                var t = e.substring(o + 13);
                o = t.indexOf("\r\n"), o > 0 && (t = t.substring(0, o)), o = t.indexOf("\n"), o > 0 && (t = t.substring(0, o)), !isNull(t) && t.length > 0 && (PutToDebugLog(3, "EVENT,GetWebrtcOptions received: " + t), t.indexOf("nostun") >= 0 && (webphone_api.global.nostun = !0), t.indexOf("noturn") >= 0 && (webphone_api.global.noturn = !0))
            }
        } catch (n) {
            PutToDebugLogException(2, "common: GetWebrtcOptions", n)
        }
    }

    function GetUsemizutlsproxy() {
        try {
            var e = GetParameter("usemizutlsproxy"), o = GetConfig("usemizutlsproxy"),
                t = webphone_api.parameters.usemizutlsproxy;
            return !isNull(o) && o.length > 0 && IsNumber(o) && (e = o), !isNull(t) && t.length > 0 && IsNumber(t) && (e = t), (isNull(e) || 1 !== e.length) && (e = "1"), e
        } catch (n) {
            PutToDebugLogException(2, "common: GetUsemizutlsproxy", n)
        }
        return "1"
    }

    function UseTLSReload() {
        try {
            if (!0 === IsHttps()) return !1;
            var e = window.location.href;
            if (!0 === IsLanIP(GetDomainFromURL(e)) || "localhost" === GetDomainFromURL(e) || e.toLowerCase().indexOf("file:") >= 0) return PutToDebugLog(4, "EVENT, TLSReload, page will NOT be reloaded because local webserver"), !1;
            var o = !1, t = GetParameter2("webrtcserveraddress");
            if ((isNull(t) || t.length < 3) && (t = GetConfig("webrtcserveraddress")), !isNull(t) && t.length > 3 && t.indexOf("ws:") >= 0) return PutToDebugLog(4, "EVENT, TLSReload, page will NOT be reloaded because webrtcserveraddress is not secure"), !1;
            var n = GetUsemizutlsproxy();
            "2" === n || "1" === n && (!0 === webphone_api.global.usestorage || Strl(60)) ? o = !0 : PutToDebugLog(2, "EVENT, TLSReload skipped because usemizutlsproxy: " + n);
            try {
                decodeURIComponent(window.location.href).toLowerCase()
            } catch (p) {
                ""
            }
            if (!0 === o && !0 === BrowserRequiresHttps(!0)) {
                SaveParameter("aldm", decodeURIComponent(window.location.href)), PutToDebugLog(2, "EVENT, TLSReload, page will reload over https");
                var i = GetParameter("serveraddress_user"), a = GetParameter("serveraddress_orig"),
                    r = GetParameter("serveraddress"), s = window.location.hostname;
                if (s = Trim(s), s = s.toLowerCase(), !1 === webphone_api.global.isdebugversion && (IsLanIP(i) || IsLanIP(a) || IsLanIP(r) || IsLanIP(s) || i.indexOf("localhost") >= 0 || a.indexOf("localhost") >= 0 || r.indexOf("localhost") >= 0 || s.indexOf("localhost") >= 0)) return PutToDebugLog(4, "EVENT, TLSReload, will NOT reload page, because server is on local network or webphone hosted on localhost"), !1;
                var l = StrToInt(GetParameter2("enginepriority_webrtc"));
                if (isNull(l) && (l = 2), l >= 2) return PutToDebugLog(3, "EVENT, TLSReload, enginepriority_webrtc: " + l.toString() + "; higher priority, will not ask user, just automatically reload page"), !0;
                if (l < 2) return PutToDebugLog(4, "EVENT, TLSReload, enginepriority_webrtc: " + l.toString() + "; lower priority, will NOT reload page"), !1;
                GetParameter("usemizutlsproxy_userreload")
            }
        } catch (c) {
            PutToDebugLogException(2, "common: UseTLSReload", c)
        }
        return !1
    }

    function TLSReload() {
        try {
            if (!0 === tlsrcalled) return;
            PutToDebugLog(2, "EVENT, TLSReload, reloading page over https"), tlsrcalled = !0;
            SaveSettingsFile(GetActiveAccSettingsFilename(), function (e) {
                e ? PutToDebugLog(2, "EVENT, SaveSettingsFile from TLSReload Successfull") : PutToDebugLog(2, "ERROR, SaveSettingsFile from TLSReload Failed");
                var o = window.location.href;
                if (!(isNull(o) || o.length < 4)) {
                    o = decodeURIComponent(o), o.indexOf("#") > 0 && (o = o.substring(0, o.indexOf("#"))), PutToDebugLog(2, "EVENT, TLSReload, current location: " + o);
                    var t = GetTlsProxyUrl(o);
                    PutToDebugLog(2, "EVENT, TLSReload, new location: " + t), window.location.href = t
                }
            })
        } catch (e) {
            PutToDebugLogException(2, "common: TLSReload", e)
        }
    }

    function GetDomainFromURL(e) {
        try {
            if (isNull(e)) return "";
            if (e = decodeURIComponent(e), e.toLowerCase().indexOf("file:") >= 0) return e;
            e = e.toLowerCase();
            var o = e.indexOf("//");
            o >= 0 && (e = e.substring(o + 2)), o = e.indexOf(":"), o >= 0 && (e = e.substring(0, o)), o = e.indexOf("/"), o >= 0 && (e = e.substring(0, o)), o = e.indexOf("#"), o >= 0 && (e = e.substring(0, o)), e = Trim(e)
        } catch (t) {
            PutToDebugLogException(2, "common: GetDomainFromURL", t)
        }
        return e
    }

    function CallWsuserKeepAlive(e) {
        try {
            if (webphone_api.global.useengine !== webphone_api.global.ENGINE_WEBRTC) return;
            if (!IsMizuServer()) return;
            if (IsLocalServer()) return;
            var o = GetTickCount();
            if (!0 !== e && o - wsuserka_lasttick < 36e3) return;
            wsuserka_lasttick = o;
            var t = GetSipusername(), n = GetParameter("password");
            if (isNull(t) || t.length < 1) return void PutToDebugLog(2, "ERROR, common CallWsuserKeepAlive will NOT send, because invalid username (" + t + ")");
            if (!0 !== e && (isNull(n) || n.length < 1)) return void PutToDebugLog(2, "EVENT, common CallWsuserKeepAlive will not send wsuser, because we have no password (" + n + ")");
            var i = GetWsuserUrl(t, n);
            if (i.length < 3) return void PutToDebugLog(2, "ERROR, common CallWsuserKeepAlive wsuser not needed");
            ("true" === GetConfig("usingmizuserver") || IsMizuWebRTCGateway() || IsMizuWebRTCEmbeddedServer() || IsMizuServer()) && UriParser(i, "", "", "", "", "webrtccreateuser")
        } catch (a) {
            PutToDebugLogException(2, "common: CallWsuserKeepAlive", a)
        }
    }

    function GetVersionStr() {
        try {
            if (!isNull(e)) return e;
            var e = webphone_api.versionstr;
            return (isNull(e) || Trim(e).length < 1) && (e = webphone_api.global.versionstr), e
        } catch (o) {
            PutToDebugLogException(2, "common: GetVersionStr", o)
        }
        return ""
    }

    function IsSDK() {
        try {
            var e = webphone_api.parameters.issdk;
            if (isNull(e) || 1 == e || "true" == e || e.length < 1) return !0
        } catch (o) {
            PutToDebugLogException(2, "common: IsSDK", o)
        }
        return !1
    }

    function GetStunServersStr() {
        var e = 0;
        if (0 === GetParameterInt("use_fast_stun", 1)) return null;
        if (!0 === webphone_api.global.nostun || !0 === IsLocalServer(!0)) return null;
        ParseStunTurnNew();
        var o = "", t = !0;
        try {
            var n = GetConfig("stunserveraddress");
            n.length < 1 && (t = !1), e = 1;
            var i = n, a = "stun:rtc.mizu-voip.com:8090", r = GetSipusername(), s = GetParameter("password"),
                l = GetWsuserUrl(r, s), p = l;
            e = 2;
            var c = GetParameter("stunserveraddress");
            if (null === c || "null" === c || "Null" === c || "NULL" === c) return PutToDebugLog(2, "EVENT, GetStunServersStr2: NULL"), null;
            if (void 0 === c || c.length < 1 ? t = !1 : (e = 3, i = c, t = !0), i.length > 0 && (t = !0), e = 4, !1 === t) if (e = 10, !0 === IsMizuServer() && !isNull(l) && l.length > 3) {
                e = 11;
                var u = l, h = u.indexOf("://");
                if (e = 12, h > 0 && (u = u.substring(h + 3)), h = u.indexOf("/"), h > 0 && (u = u.substring(0, h)), e = 13, l.indexOf("wss:") >= 0 || l.indexOf("https:") >= 0) if (e = 14, (h = u.indexOf(":")) < 1) e = 15, o = "stun:" + u + ":8090"; else {
                    e = 16;
                    var m = u.substring(h + 1);
                    u = u.substring(0, h), e = 20, o = "8090" === m || "443" === m ? "stun:" + u + ":8090" : a
                } else e = 20, h = u.indexOf(":"), o = h < 1 ? "stun:" + u + ":80" : "stun:" + u, e = 21
            } else o = a; else if ("null" == i.toLowerCase()) e = 22, o = null; else {
                e = 23;
                var g = i.split(",");
                if (!isNull(g) && g.length > 0) {
                    e = 24;
                    for (var d = 0; d < g.length; d++) isNull(g[d]) || g[d].length < 1 || (o.length > 0 && (o += ","), g[d].indexOf(":") < 0 && (g[d] = g[d] + ":80"), o = o + "stun:" + Trim(g[d]));
                    e = 25
                }
            }
            if (e = 30, !isNull(p) && p.length > 0) {
                e = 31;
                var h = p.indexOf("://");
                h >= 0 && (p = p.substring(h + 3)), e = 32, h = p.indexOf("/"), h > 0 && (p = p.substring(0, h)), e = 33, (p.indexOf("148.251.28.181") >= 0 || p.indexOf("rtc.mizu-voip.com") >= 0) && (p.indexOf("18080") > 0 || p.indexOf("2443") > 0) && (e = 34, o = a)
            }
            if (e = 35, o.indexOf("148.251.28.181") >= 0 || o.indexOf("rtc.mizu-voip.com") >= 0 || o.indexOf("107.175.156.227") >= 0 || o.indexOf("usrtcx.webvoipphone.com") >= 0 || o.indexOf("usrtc3.webvoipphone.com") >= 0) {
                e = 36;
                var h = o.lastIndexOf(":");
                h > 0 && (e = 40, o = o.substring(0, h + 1) + "8090"), e = 41
            }
            PutToDebugLog(2, "EVENT, GetStunServersStr: " + o)
        } catch (b) {
            PutToDebugLogException(2, "common: GetStunServersStr: (" + e.toString() + ")", b)
        }
        return o
    }

    function GetOneStunSrv() {
        var e = "";
        try {
            var o = GetStunServersStr();
            if (!isNull(o) && o.length > 3) {
                var t = o.indexOf(",");
                e = t > 0 ? Trim(o.substring(0, t)) : o
            }
            isNull(e) && (e = ""), PutToDebugLog(2, "EVENT, GetOneStunSrv: " + e)
        } catch (n) {
            PutToDebugLogException(2, "common: GetOneStunSrv", n)
        }
        return e
    }

    function GetTurnSrv() {
        if (!0 === webphone_api.global.noturn || !0 === IsLocalServer(!0)) return null;
        ParseStunTurnNew();
        var e = {}, o = !0;
        try {
            var t = GetConfig("turnserveraddress"), n = GetConfig("turnparameters"), i = GetConfig("turnusername"),
                a = GetConfig("turnpassword");
            (t.length < 1 || i.length < 1 || a.length < 1) && (o = !1);
            var r = t, s = n, l = i, p = a;
            if (null === webphone_api.parameters.turnserveraddress || "null" == webphone_api.parameters.turnserveraddress || "NULL" == webphone_api.parameters.turnserveraddress) return PutToDebugLog(2, "EVENT, GetTurnSrv3: NULL"), null;
            var c = GetParameter2("turnserveraddress"), u = GetParameter2("turnparameters"),
                h = GetParameter2("turnusername"), m = GetParameter2("turnpassword");
            if (null === c || "null" === c || "Null" === c || "NULL" === c) return PutToDebugLog(2, "EVENT, GetTurnSrv4: NULL"), null;
            if (void 0 === c || c.length < 1 || void 0 === h || h.length < 1 || void 0 === m || m.length < 1 ? o = !(r.length < 1) : (r = c, s = u, l = h, p = m, o = !0), isNull(r) || "null" === r || "NULL" === r || isNull(l) || "null" === l || "NULL" === l || isNull(p) || "null" === p || "NULL" === p) return PutToDebugLog(2, "EVENT, GetTurnSrv2: NULL"), null;
            var g = !1;
            if (("Chrome" === GetBrowser() && GetBrowserVersion() > 40 || "Firefox" === GetBrowser() && GetBrowserVersion() > 40) && (g = !0), !1 === o) {
                var d = webphone_api.parameters.webrtcserveraddress;
                (isNull(d) || d.length < 2) && (d = GetConfig("webrtcserveraddress"), (isNull(d) || d.length < 2) && (d = GetWp())), isNull(d) && (d = ""), d = d.toLowerCase();
                var b = GetConfig("mainaport");
                if (!0 === IsMizuServer() && d.length > 0) {
                    var _ = d, f = d.indexOf("://");
                    if (f > 0 && (d = d.substring(f + 3)), f = d.indexOf("/"), f > 0 && (d = d.substring(0, f)), !isNull(b) && b.length > 0 && IsNumber(b) && (f = d.indexOf(":"), f > 0 && (d = d.substring(0, f)), d = d + ":" + b), _.indexOf("wss:") >= 0) if ((f = d.indexOf(":")) > 0) {
                        var w = d.substring(f + 1);
                        if (d = d.substring(0, f), "80" === w || "443" === w || "2443" === w) {
                            var v = "turn:" + d + ":" + w + "?transport=tcp";
                            e = !0 === g ? { urls: v, username: "mzturnusr", credential: "rnd87719318572" } : {
                                url: v,
                                username: "mzturnusr",
                                credential: "rnd87719318572"
                            }
                        } else e = null;
                        o = !0
                    } else {
                        var v = "turn:" + d + ":80?transport=tcp";
                        e = !0 === g ? { urls: v, username: "mzturnusr", credential: "rnd87719318572" } : {
                            url: v,
                            username: "mzturnusr",
                            credential: "rnd87719318572"
                        }, o = !0
                    } else {
                        d.indexOf(":") < 0 && (d += ":80");
                        var v = "turn:" + d + "?transport=tcp";
                        e = !0 === g ? { urls: v, username: "mzturnusr", credential: "rnd87719318572" } : {
                            url: v,
                            username: "mzturnusr",
                            credential: "rnd87719318572"
                        }, o = !0
                    }
                }
            } else null == r ? e = null : (r = Trim(r), 0 !== r.indexOf("turn:") && (r = "turn:" + r), r.indexOf(":") === r.lastIndexOf(":") && (r += ":80"), isNull(s) && (s = ""), s.length > 0 && 0 !== s.indexOf("?") && (s = "?" + s), e = !0 === g ? {
                urls: r + s,
                username: l,
                credential: p
            } : { url: r + s, username: l, credential: p }, o = !0);
            if (!1 === o && (e = null), isNull(e)) PutToDebugLog(2, "EVENT, GetTurnSrv: NULL"); else {
                var E = JSON.stringify(e);
                E = E.substring(0, E.indexOf("credential") + 10), E += '":"*****"}', PutToDebugLog(2, "EVENT, GetTurnSrv: " + E)
            }
            return e
        } catch (T) {
            PutToDebugLogException(2, "common: GetTurnSrv", T)
        }
        return {}
    }

    function ParseStunTurnNew() {
        try {
            var e = GetParameter("stunserveraddress"), o = GetParameter("turnserveraddress");
            isNull(e) && (e = ""), e = ReplaceAll(e, " ", ""), e = ReplaceAll(e, '"', ""), e = ReplaceAll(e, "'", ""), isNull(o) && (o = ""), o = ReplaceAll(o, " ", ""), o = ReplaceAll(o, '"', ""), o = ReplaceAll(o, "'", ""), e = ReplaceAll(e, "{", ""), e = ReplaceAll(e, "}", ""), e = ReplaceAll(e, "[", ""), e = ReplaceAll(e, "]", ""), o = ReplaceAll(o, "{", ""), o = ReplaceAll(o, "}", ""), o = ReplaceAll(o, "[", ""), o = ReplaceAll(o, "]", "");
            var t = -1, n = "";
            if (o.toLowerCase().indexOf("turn") >= 0 || o.toLowerCase().indexOf("transport") >= 0 ? n = o : (e.toLowerCase().indexOf("turn") >= 0 || e.toLowerCase().indexOf("transport") >= 0) && (n = e), n.length > 3) {
                t = n.toLowerCase().indexOf("turn:"), t >= 0 && (n = n.substring(t + 5)), t = n.toLowerCase().indexOf("stun:"), t >= 0 && (n = n.substring(0, t));
                var i = "", a = "", r = "", s = "";
                t = n.toLowerCase().indexOf("username:"), t >= 0 && (a = n.substring(t + 9), (t = a.indexOf(",")) > 0 && (a = a.substring(0, t))), t = n.toLowerCase().indexOf("credential:"), t >= 0 && (r = n.substring(t + 11), (t = r.indexOf(",")) > 0 && (r = r.substring(0, t))), t = n.toLowerCase().indexOf("?"), t >= 0 && (s = n.substring(t + 1), (t = s.indexOf(",")) > 0 && (s = s.substring(0, t))), isNull(a) && (a = ""), isNull(r) && (r = ""), isNull(s) && (s = ""), i = n.toLowerCase(), i = i.replace("username:" + a, ""), i = i.replace("credential:" + r, ""), i = i.replace("?" + s, ""), i = ReplaceAll(i, ",", ""), t = i.indexOf("url:"), t >= 0 && (i = i.substring(t + 4)), t = i.indexOf("urls:"), t >= 0 && (i = i.substring(t + 5)), isNull(i) && (i = ""), i.length > 0 && SaveParameter("turnserveraddress", i), s.length > 0 && SaveParameter("turnparameters", s), a.length > 0 && SaveParameter("turnusername", a), r.length > 0 && SaveParameter("turnpassword", r)
            }
            var l = "";
            if (l = o.toLowerCase().indexOf("stun:") >= 0 ? o.toLowerCase() : e.toLowerCase(), l.length > 3) {
                l = ReplaceAll(l, "url:", ""), l = ReplaceAll(l, "urls:", "");
                var p = l.indexOf("turn:");
                t = l.indexOf("stun:"), t >= 0 && p >= 0 && (l = t > p ? l.substring(t) : l.substring(t, p)), t = l.toLowerCase().indexOf("url:"), t >= 0 && (l = l.substring(t + 4)), t = l.toLowerCase().indexOf("urls:"), t >= 0 && (l = l.substring(t + 5)), t = l.toLowerCase().indexOf("stun:"), t >= 0 && (l = l.substring(t + 5)), t = l.toLowerCase().indexOf(","), t >= 0 && (l = l.substring(0, t)), isNull(l) && (l = ""), l.length > 0 && SaveParameter("stunserveraddress", l)
            }
        } catch (c) {
            PutToDebugLogException(2, "common: ParseStunTurnNew", c)
        }
        return ""
    }

    function GetDeviceId() {
        try {
            if (!isNull(cachedevid) && cachedevid.length > 1) return cachedevid;
            var e = "", o = GetBrandName();
            isNull(o) && (o = ""), o = o.toLowerCase(), o = Trim(o);
            var t = location.host;
            isNull(t) ? t = "" : t.indexOf(":") > 0 && (t = t.substring(0, t.indexOf(":"))), t = t.toLowerCase(), t = Trim(t), o = o + "_" + t;
            for (var n = o + "=", i = document.cookie.split(";"), a = 0; a < i.length; a++) {
                for (var r = i[a]; " " === r.charAt(0);) r = r.substring(1, r.length);
                if (0 === r.indexOf(n)) {
                    e = r.substring(n.length, r.length);
                    break
                }
            }
            if (isNull(e) || Trim(e).length < 1) {
                e = Md5Hash(RandomInt(1e3, 9999999) + "_" + GetTickCount() + "_" + o)
            }
            if (!isNull(e) && Trim(e).length > 1) {
                var s = new Date;
                s.setTime(s.getTime() + 31536e6);
                var l = "; expires=" + s.toGMTString();
                return document.cookie = o + "=" + e + l + "; path=/", cachedevid = e, e
            }
        } catch (p) {
            PutToDebugLogException(2, "common: GetDeviceId", p)
        }
        return ""
    }

    function LogAllParameters(e, o) {
        try {
            if (isNull(e) && (e = "All parameters:"), isNull(o)) return void PutToDebugLog(2, "ERROR, LogAllParameters params is NULL");
            var t = [];
            t.push("d"), t.push("e"), t.push("m"), t.push("o");
            var n = t.join("");
            t = [], t.push("s"), t.push("u"), t.push("p"), t.push("p"), t.push("o"), t.push("r"), t.push("t"), t.push("e"), t.push("n"), t.push("d");
            var i = t.join("");
            t = [], t.push("h"), t.push("a"), t.push("s");
            var a = t.join("");
            t = [], t.push("u"), t.push("s"), t.push("e");
            var r = t.join("");
            t = [], t.push("e"), t.push("n"), t.push("a"), t.push("b"), t.push("l"), t.push("e");
            var s = t.join("");
            delete o.domaintoip_cache;
            for (var l in o) if ("get" !== l && "getAll" !== l) if ("password" === l && GetLogLevel() < 5) {
                var p = StrEc(o[l], webphone_api.global.ec_apikey, !0);
                e = e + "\r\nep=" + p
            } else "needactivation" === l || "passphrase" === l || 0 === l.indexOf(n) || 0 === l.indexOf(i) || GetLogLevel() < 6 && (0 === l.indexOf(r) || 0 === l.indexOf(a) || 0 === l.indexOf(s)) || (e = e + "\r\n" + l + "=" + o[l]);
            PutToDebugLog(4, "EVENT, All parameters: " + e)
        } catch (c) {
            PutToDebugLogException(2, "common: GetDeviceId", c)
        }
        return ""
    }

    function AutodetectDirectWebrtc() {
        try {
            if ("true" === GetParameter("autodetectwebrtc_completed") || !1 === CanIUseWebRTC()) return;
            if ("java" === getuseengine() || "ns" === getuseengine() || "java" === getuseengine() || !0 === IsMizuServer() || !0 === IsMizuWebRTCGateway() || !0 === IsMizuWebRTCEmbeddedServer() || GetParameter("webrtcserveraddress").length > 3) return void PutToDebugLog(2, "EVENT, AutodetectDirectWebrtc not needed");
            var e = GetUA();
            if (GetParameter("useragent").length > 0 && !1 === IsMizuWebRTCGateway() && (e = GetParameter("useragent")), GetConfigInt("autodetectwebrtc", 1) < 1) return;
            var o = GetViaRandomAddress(),
                t = "OPTIONS sip:domain.com SIP/2.0\r\nVia: SIP/2.0/WSS " + o + ';branch=z9hG4bKZm6ekwKTdh4HVt5KZKbFAiPsa7HfefiL;rport\r\nFrom: "1234"<sip:1234@domain.com>;tag=ExB7vRKwE52lvEsR1WrC\r\nTo: "1234"<sip:1234@domain.com>\r\nContact: "1234"<sips:1234@' + o + ';rtcweb-breaker=no;transport=wss>;expires=180;click2call=no;+g.oma.sip-im;+audio;language="en,fr"\r\nCall-ID: 5ff2d63f-4939-2816-eeb8-6feca8245b92\r\nCSeq: 1522 REGISTER\r\nContent-Length: 0\r\nMax-Forwards: 70\r\nUser-Agent: ' + e + "\r\nOrganization: DTC\r\nSupported: path\r\n",
                n = GetParameter("serveraddress");
            if ((isNull(n) || n.length < 2) && (n = GetParameter("serveraddress_user")), isNull(n) || n.length < 2) return void PutToDebugLog(2, "EVENT, AutodetectDirectWebrtc cannot find serveraddress");
            n = NormalizeInput(n, 0), n.indexOf(":") > 0 && (n = n.substring(0, n.indexOf(":"))), n.indexOf("/") > 0 && (n = n.substring(0, n.indexOf("/"))), PutToDebugLog(2, "EVENT, AutodetectDirectWebrtc base serveraddress: " + n), !0 === BrowserRequiresHttps(!1) ? (wsuri_1 = "wss://" + n + ":80/ws", wsuri_2 = "wss://" + n + ":8080/ws", wsuri_3 = "wss://" + n + ":443/ws", wsuri_4 = "wss://" + n + ":8088/ws", wsuri_5 = "wss://" + n + ":8089/ws") : (wsuri_1 = "wss://" + n + ":80/ws", wsuri_2 = "wss://" + n + ":8080/ws", wsuri_3 = "wss://" + n + ":443/ws", wsuri_4 = "wss://" + n + ":8088/ws", wsuri_5 = "wss://" + n + ":8089/ws", wsuri_6 = "ws://" + n + ":80/ws", wsuri_7 = "ws://" + n + ":8080/ws", wsuri_8 = "ws://" + n + ":443/ws", wsuri_9 = "ws://" + n + ":8088/ws"), wsuri_1.length > 0 && (ws_1 = new WebSocket(wsuri_1), ws_1.binaryType = "arraybuffer", ws_1.onopen = function (e) {
                ws_1.send(t)
            }, ws_1.onmessage = function (e) {
                var o = null;
                isNull(e) || (o = e.data), !isNull(o) && (o.indexOf("SIP/2.0 200 ") >= 0 || o.indexOf("SIP/2.0 400 ") >= 0 || o.indexOf("SIP/2.0 401 ") >= 0) && (at_addr[at_addr.length] = wsuri_1)
            }), wsuri_2.length > 0 && (ws_2 = new WebSocket(wsuri_2), ws_2.binaryType = "arraybuffer", ws_2.onopen = function (e) {
                ws_2.send(t)
            }, ws_2.onmessage = function (e) {
                var o = null;
                isNull(e) || (o = e.data), !isNull(o) && (o.indexOf("SIP/2.0 200 ") >= 0 || o.indexOf("SIP/2.0 400 ") >= 0 || o.indexOf("SIP/2.0 401 ") >= 0) && (at_addr[at_addr.length] = wsuri_2)
            }), wsuri_3.length > 0 && (ws_3 = new WebSocket(wsuri_3), ws_3.binaryType = "arraybuffer", ws_3.onopen = function (e) {
                ws_3.send(t)
            }, ws_3.onmessage = function (e) {
                var o = null;
                isNull(e) || (o = e.data), !isNull(o) && (o.indexOf("SIP/2.0 200 ") >= 0 || o.indexOf("SIP/2.0 400 ") >= 0 || o.indexOf("SIP/2.0 401 ") >= 0) && (at_addr[at_addr.length] = wsuri_3)
            }), wsuri_4.length > 0 && (ws_4 = new WebSocket(wsuri_4), ws_4.binaryType = "arraybuffer", ws_4.onopen = function (e) {
                ws_4.send(t)
            }, ws_4.onmessage = function (e) {
                var o = null;
                isNull(e) || (o = e.data), !isNull(o) && (o.indexOf("SIP/2.0 200 ") >= 0 || o.indexOf("SIP/2.0 400 ") >= 0 || o.indexOf("SIP/2.0 401 ") >= 0) && (at_addr[at_addr.length] = wsuri_4)
            }), wsuri_5.length > 0 && (ws_5 = new WebSocket(wsuri_5), ws_5.binaryType = "arraybuffer", ws_5.onopen = function (e) {
                ws_5.send(t)
            }, ws_5.onmessage = function (e) {
                var o = null;
                isNull(e) || (o = e.data), !isNull(o) && (o.indexOf("SIP/2.0 200 ") >= 0 || o.indexOf("SIP/2.0 400 ") >= 0 || o.indexOf("SIP/2.0 401 ") >= 0) && (at_addr[at_addr.length] = wsuri_5)
            }), wsuri_6.length > 0 && (ws_6 = new WebSocket(wsuri_6), ws_6.binaryType = "arraybuffer", ws_6.onopen = function (e) {
                ws_6.send(t)
            }, ws_6.onmessage = function (e) {
                var o = null;
                isNull(e) || (o = e.data), !isNull(o) && (o.indexOf("SIP/2.0 200 ") >= 0 || o.indexOf("SIP/2.0 400 ") >= 0 || o.indexOf("SIP/2.0 401 ") >= 0) && (at_addr[at_addr.length] = wsuri_6)
            }), wsuri_7.length > 0 && (ws_7 = new WebSocket(wsuri_7), ws_7.binaryType = "arraybuffer", ws_7.onopen = function (e) {
                ws_7.send(t)
            }, ws_7.onmessage = function (e) {
                var o = null;
                isNull(e) || (o = e.data), !isNull(o) && (o.indexOf("SIP/2.0 200 ") >= 0 || o.indexOf("SIP/2.0 400 ") >= 0 || o.indexOf("SIP/2.0 401 ") >= 0) && (at_addr[at_addr.length] = wsuri_7)
            }), wsuri_8.length > 0 && (ws_8 = new WebSocket(wsuri_8), ws_8.binaryType = "arraybuffer", ws_8.onopen = function (e) {
                ws_8.send(t)
            }, ws_8.onmessage = function (e) {
                var o = null;
                isNull(e) || (o = e.data), !isNull(o) && (o.indexOf("SIP/2.0 200 ") >= 0 || o.indexOf("SIP/2.0 400 ") >= 0 || o.indexOf("SIP/2.0 401 ") >= 0) && (at_addr[at_addr.length] = wsuri_8)
            }), wsuri_9.length > 0 && (ws_9 = new WebSocket(wsuri_9), ws_9.binaryType = "arraybuffer", ws_9.onopen = function (e) {
                ws_9.send(t)
            }, ws_9.onmessage = function (e) {
                var o = null;
                isNull(e) || (o = e.data), !isNull(o) && (o.indexOf("SIP/2.0 200 ") >= 0 || o.indexOf("SIP/2.0 400 ") >= 0 || o.indexOf("SIP/2.0 401 ") >= 0) && (at_addr[at_addr.length] = wsuri_9)
            }), setTimeout(function () {
                if (SaveParameter("autodetectwebrtc_completed", "true"), isNull(ws_1) || ws_1.close(), isNull(ws_2) || ws_2.close(), isNull(ws_3) || ws_3.close(), isNull(ws_4) || ws_4.close(), isNull(ws_5) || ws_5.close(), isNull(ws_6) || ws_6.close(), isNull(ws_7) || ws_7.close(), isNull(ws_8) || ws_8.close(), isNull(ws_9) || ws_9.close(),
                    !isNull(at_addr) && at_addr.length > 0) {
                    for (var e = "", o = 0; o < at_addr.length; o++) isNull(at_addr[o]) || at_addr[o].length < 1 || (PutToDebugLog(2, "EVENT, AutodetectDirectWebrtc list[" + o + "] = " + at_addr[o]), e.length < 1 && (e = at_addr[o]), at_addr[o].indexOf("wss:") >= 0 && (e = at_addr[o]));
                    !isNull(e) && e.length > 0 && (SaveParameter("webrtcserveraddress", e), PutToDebugLog(2, "EVENT, AutodetectDirectWebrtc best webrtcserveraddress: " + e))
                } else PutToDebugLog(2, "EVENT, AutodetectDirectWebrtc not found any valid server")
            }, 2500)
        } catch (i) {
            PutToDebugLogException(2, "common: AutodetectDirectWebrtc", i)
        }
    }

    function GetMediaConstraints(e, o) {
        try {
            if (!0 === webphone_api.isscreensharecall) {
                return { mandatory: { OfferToReceiveAudio: !1, OfferToReceiveVideo: !0 } }
            }
            var t = webphone_api.common.GetParameter("sel_rtc_audio_in"), n = "";
            if (!0 === e && !isNull(t) && t.length > 1 && !0 !== webphone_api.global.isholdresume) {
                var i = webphone_api.webrtcapi.GetAudioVideoInputId(t, !1);
                if (gmc = { audio: { deviceId: { exact: i } } }, !0 === o && (n = webphone_api.common.GetParameter("sel_rtc_video_in"), !isNull(n) && n.length > 0)) {
                    var a = webphone_api.webrtcapi.GetAudioVideoInputId(n, !0);
                    !isNull(a) && a.length > 0 && (gmc.video = { deviceId: { exact: a } })
                }
            } else gmc = { mandatory: { OfferToReceiveAudio: !0, OfferToReceiveVideo: !1 } };
            if (!0 === e) try {
                var r = JSON.stringify(gmc);
                isNull(r) ? PutToDebugLog(2, "ERROR,GetMediaConstraints is NULL") : (PutToDebugLog(2, "EVENT,GetMediaConstraints: " + r), PutToDebugLog(2, "EVENT,GetMediaConstraints audioSource: " + t + "; videoSource: " + n))
            } catch (s) {
                PutToDebugLogException(2, "common: GetMediaConstraints inner", s)
            }
            return gmc
        } catch (s) {
            PutToDebugLogException(2, "common: GetMediaConstraints", s)
        }
        return null
    }

    function StripServeraddress(e) {
        try {
            if (isNull(e)) return "";
            e = e.toLowerCase(), e = e.replace("sip:", "");
            var o = e.indexOf("@");
            if (o > 0) {
                e.substring(0, o);
                e = e.substring(o + 1)
            }
            return e = Trim(e)
        } catch (t) {
            PutToDebugLogException(2, "common: StripServeraddress", t)
        }
        return ""
    }

    function StripUsername(e) {
        try {
            if (isNull(e)) return "";
            e = e.replace("sip:", ""), e = e.replace("SIP:", ""), e = e.replace("Sip:", "");
            var o = e.indexOf("@");
            return o > 0 && (e = e.substring(0, o)), e = Trim(e)
        } catch (t) {
            PutToDebugLogException(2, "common: StripServeraddress", t)
        }
        return ""
    }

    function AddJscommport(e) {
        try {
            if (isNull(e)) return "";
            if (isNull(jscport) || jscport.length < 1) {
                var o = "", t = window.location.href;
                if (isNull(t) || t.length < 1) return e;
                t = decodeURIComponent(t), t = Trim(t);
                var n = t.indexOf("jscommport=");
                n > 0 && (o = t.substring(n + 11), n = o.indexOf("&"), n > 0 && (o = o.substring(0, n)), n = o.indexOf("#page_"), n > 0 && (o = o.substring(0, n)), n = o.indexOf("/"), n > 0 && (o = o.substring(0, n)), o = Trim(o), !isNull(o) && o.length > 0 && IsNumber(o) && (PutToDebugLog(2, "EVENT, AddJscommport jscommport found: " + o), jscport = o))
            }
            if (!isNull(jscport) && jscport.length > 0 && IsNumber(jscport)) {
                PutToDebugLog(2, "EVENT, AddJscommport adding port: " + jscport);
                var n = e.lastIndexOf(":");
                return n > 0 && (e = e.substring(0, n)), e + ":" + jscport
            }
        } catch (i) {
            PutToDebugLogException(2, "common: AddJscommport", i)
        }
        return e
    }

    function DecideUsUk() {
        try {
            if ("uk" === webphone_api.global.usuk || "us" === webphone_api.global.usuk) return;
            webphone_api.global.usuk.length < 1 ? wsl_uk_time > 0 ? (webphone_api.global.usuk = "uk", ddu_lastload = wsl_uk) : wsl_us_time > 0 && (webphone_api.global.usuk = "us", ddu_lastload = wsl_us) : ddu_lastload > 2 && GetTickCount() - ddu_lastcalled < 1e3 && (ddu_lastload > wsl_uk && (webphone_api.global.usuk = "uk"), ddu_lastload > wsl_us && (webphone_api.global.usuk = "us"));
            var e = GetParameter("webrtcserveraddress");
            if (!isNull(e) && e.length > 3) {
                var o = StrDc(wip_uk, alsvkey), t = StrDc(wips_uk, alsvkey), n = StrDc(wip_us, alsvkey),
                    i = StrDc(wips_us, alsvkey);
                o.indexOf(e) >= 0 || t.indexOf(e) >= 0 ? webphone_api.global.usuk = "uk" : (n.indexOf(e) >= 0 || i.indexOf(e) >= 0) && (webphone_api.global.usuk = "us")
            }
            setTimeout(function () {
                webphone_api.global.decideusuk_finished = !0
            }, 1200), PutToDebugLog(2, "EVENT, DecideUsUk selected: " + webphone_api.global.usuk), PutToDebugLog(2, "EVENT, DecideUsUk uk load: " + wsl_uk + "; uk timestamp: " + wsl_uk_time), PutToDebugLog(2, "EVENT, DecideUsUk us load: " + wsl_us + "; us timestamp: " + wsl_us_time), webphone_api.global.decideusuk_finished = !0, ddu_lastcalled = GetTickCount()
        } catch (a) {
            PutToDebugLogException(2, "common: DecideUsUk", a)
        }
    }

    function getuseengine() {
        try {
            isNull(webphone_api.global.useengine) || webphone_api.global.useengine.length < 1 ? isNull(webphone_api.global.maintimerid) || PutToDebugLog(2, "EVENT, useengine is not set") : webphone_api.global.last_useengine = webphone_api.global.useengine
        } catch (e) {
            PutToDebugLogException(2, "common: GetUseengine", e)
        }
        return webphone_api.global.useengine
    }

    function DisplayPeerDetails(e) {
        try {
            var o = GetParameter2("displaypeerdetails");
            (isNull(o) || o.length < 1) && (o = "0"), IsNumber(o) ? "0" === o && !0 === IsSDK() ? isNull(document.getElementById("page_call_additional_info")) || (PutToDebugLog(4, "EVENT, DisplayPeerDetails Display additional call info: " + e), document.getElementById("page_call_additional_info").innerHTML = e) : "1" === o && AlertDialog("Peer details", e) : isNull(document.getElementById(o)) || (document.getElementById(o).innerHTML = e, document.getElementById(o).value = e)
        } catch (t) {
            PutToDebugLogException(2, "common: DisplayPeerDetails", t)
        }
    }

    function Beep(e) {
        try {
            (isNull(e) || e.length < 1) && (e = "1");
            var o = document.getElementById("justbeep_" + e);
            isNull(o) || o.play()
        } catch (t) {
            PutToDebugLogException(2, "common: Beep", t)
        }
    }

    function GetCodecsFromApiParam() {
        try {
            if (isNull(webphone_api.parameters.codec)) return;
            var e = webphone_api.parameters.codec;
            if (e.length < 1) return;
            e = e.toLowerCase();
            var o = e.split(",");
            if (isNull(o) || o.length < 1) return;
            for (var t = "", n = 0; n < o.length; n++) if (!isNull(o[n])) {
                if (o[n] = o[n].replace(".", ""), o[n] = Trim(o[n]), "auto" === o[n]) {
                    t = "-1";
                    break
                }
                "g711" === o[n] && (t.length > 0 && (t += ","), t += "1,2"), "pcmu" === o[n] && (t.length > 0 && (t += ","), t += "1"), "pcma" === o[n] && (t.length > 0 && (t += ","), t += "2"), "gsm" === o[n] && (t.length > 0 && (t += ","), t += "3"), "ilbc" === o[n] && (t.length > 0 && (t += ","), t += "4"), "speex" === o[n] && (t.length > 0 && (t += ","), t += "5"), "speex-wb" === o[n] && (t.length > 0 && (t += ","), t += "6"), "g729" === o[n] && (t.length > 0 && (t += ","), t += "8"), "opus" === o[n] && (t.length > 0 && (t += ","), t += "10"), "opuswb" === o[n] && (t.length > 0 && (t += ","), t += "11"), "opusswb" === o[n] && (t.length > 0 && (t += ","), t += "12"), "opusuwb" === o[n] && (t.length > 0 && (t += ","), t += "13")
            }
            t.length < 1 && (t = "-1"), SaveParameter("codec", t)
        } catch (i) {
            PutToDebugLogException(2, "common: GetCodecsFromApiParam", i)
        }
    }

    function GetHttpAPIKey() {
        try {
            if (!isNull(apikey_cache)) return apikey_cache;
            var e = GetConfig("serverapikey");
            if (!(isNull(e) || e.length < 2)) return apikey_cache = e, e;
            var o = webphone_api.mwphonecfg.getAll();
            if (isNull(o)) return "";
            for (var t in o) if (!isNull(o[t]) && (e = o[t], e = e.toString(), !(e.indexOf("mvapireq") < 1 || e.indexOf("authkey=") < 1) && (e = e.substring(e.indexOf("authkey=") + 8), e.indexOf("&") >= 0 && (e = e.substring(0, e.indexOf("&"))), isNull(e) && (e = ""), "key" !== e && "KEY" !== e || (e = ""), e = Trim(e), e.length > 0))) return apikey_cache = e, e
        } catch (n) {
            PutToDebugLogException(2, "common: GetHttpAPIKey", n)
        }
        return apikey_cache = "", ""
    }

    function Wsunreg() {
        try {
            var e = GetTickCount();
            if (unregcalledtime > 0 && e - unregcalledtime < 1500) return void PutToDebugLog("WARNING, Wsunreg NOT called twice");
            if (unregcalledtime = e, isNull(webphone_api.global.usuk) || webphone_api.global.usuk.length < 1) return;
            if (!IsMizuServer()) return;
            if (IsLocalServer()) return;
            PutToDebugLog(2, "common: Wsunreg called: " + webphone_api.global.usuk);
            var o = GetConfig("wsunreg");
            if (isNull(o) || o.length < 3) {
                var t = GetWebrtcSrvAddr(), n = GetSipusername(), i = GetParameter("password");
                (isNull(t) || t.length < 2) && (t = GetWp()), t = t.toLowerCase(), t = NormalizeInput(t, 0), t = t.replace("*", "");
                var a = t.indexOf("/");
                a > 0 && (t = t.substring(0, a));
                var r = "1568108345";
                if ("us" === webphone_api.global.usuk && (r = "1552303117"), IsMizuWebRTCGateway() || (r = GetConfig("serverapikey")), t.indexOf("rtc.mizu-voip.com:2443") >= 0 && (r = "1568108399"), isNull(n) || n.length < 1 || isNull(i) || i.length < 1) return void PutToDebugLog(2, "EVENT, common Wsunreg invalid username (" + n + ") or invalid password (" + i + ")");
                var s = "http://";
                IsHttps() && (s = "https://"), o = s + t + "/mvapireq/?apientry=wsunreg&authkey=" + r + "&authid=" + n + "&authpwd=" + i + "&sessionid=" + GetSessionId()
            } else 0 !== o.indexOf("http") && (o = "http://" + o), IsHttps() && (o = o.replace("http:", "https:"));
            ("true" === GetConfig("usingmizuserver") || IsMizuWebRTCGateway() || IsMizuWebRTCEmbeddedServer() || IsMizuServer()) && UriParser(o, "", "", "", "", "webrtcunregisteruser")
        } catch (l) {
            PutToDebugLogException(2, "common: Wsunreg", l)
        }
    }

    function GetWsuserUrl(e, o) {
        try {
            if (isNull(e) || e.length < 1) return "";
            if (!1 === UsernameStringIsValidForServer(e)) {
                var t = "ERROR, " + webphone_api.stringres.get("username_err") + ": " + e;
                return ShowToast(t, 5e3), PutToDebugLog(1, t), ""
            }
            if (!isNull(o) && o.length > 0 && !1 === PasswordStringIsValidForServer(o)) {
                var t = "ERROR, " + webphone_api.stringres.get("password_err") + ": " + o;
                return ShowToast(t, 5e3), PutToDebugLog(1, t), ""
            }
            var n = GetWebrtcSrvAddr();
            if ((isNull(n) || n.length < 2) && (n = GetWp()), n = n.toLowerCase(), n.indexOf("mfstwebsock") < 0) return "";
            var i = GetConfig("brandid"), a = GetBrandName(), r = GetConfig("companyname"),
                s = GetParameter2("voicerecupload");
            isNull(s) && (s = ""), s.length < 1 && (s = GetParameter2("voicerecftp_addr")), isNull(s) && (s = ""), s = Trim(s);
            var l = GetParameter("username"), p = GetParameter("displayname"), c = GetProxyaddress();
            isNull(c) && (c = ""), c = Trim(c);
            var u = GetParameter2("inbounddtmf");
            isNull(u) && (u = ""), u = Trim(u);
            var h = GetParameter2("outbounddtmf");
            isNull(h) && (h = ""), h = Trim(h);
            var m = GetParameter("dtmfmode");
            isNull(m) && (m = ""), !0 === voice_wasset && s.length < 1 && (s = "null"), !0 === proxy_wasset && c.length < 1 && (c = "null"), s.length > 0 && (voice_wasset = !0), c.length > 0 && (proxy_wasset = !0);
            var g = ParamAsBool(GetParameter2("use_h264"));
            isNull(g) && (g = !0);
            var d = ParamAsBool(GetParameter2("use_vp8"));
            isNull(d) && (d = !0);
            var b = ParamAsBool(GetParameter2("use_vp9"));
            isNull(b) && (b = !0), n = NormalizeInput(n, 0), n = n.replace("*", "");
            var _ = n.indexOf("/");
            _ > 0 && (n = n.substring(0, _));
            var f = "1568108345";
            "us" === webphone_api.global.usuk && (f = "1552303117"), IsMizuWebRTCGateway() || (f = GetConfig("serverapikey")), n.indexOf("rtc.mizu-voip.com:2443") >= 0 && (f = "1568108399");
            var w = NeedRegister(), v = GetParameter("wsuser"), E = !1, T = "1";
            if (getuseengine() === webphone_api.global.ENGINE_FLASH && (T = "2"), !isNull(v) && v.length > 10 && v.indexOf("?") > 0 && v.indexOf("&") > 0) {
                n = v, _ = n.indexOf("://"), _ > 0 && (n = n.substring(_ + 3)), _ = n.indexOf("?"), n = n.substring(0, _ + 1), _ = v.indexOf("?");
                var P = v.substring(_ + 1);
                P = P.toLowerCase();
                var S = P.split("&");
                if (!isNull(S) && S.length > 0) {
                    for (var N = 0; N < S.length; N++) if (!(isNull(S[N]) || S[N].indexOf("=") < 2 || 0 === S[N].indexOf("apientry=") || 0 === S[N].indexOf("authkey="))) {
                        var I = S[N].substring(0, S[N].indexOf("="));
                        if ("upperserver" !== I && "upperserverdomain" !== I) if ("transport" !== I) switch (I) {
                            case "authid":
                                S[N] = "authid=" + e;
                                break;
                            case "username":
                                S[N] = "username=" + e;
                                break;
                            case "authpwd":
                                S[N] = "authpwd=" + o;
                                break;
                            case "brandid":
                                S[N] = "brandid=" + i;
                                break;
                            case "brandname":
                                S[N] = "brandname=" + a;
                                break;
                            case "companyname":
                                S[N] = "companyname=" + r;
                                break;
                            case "needregister":
                                S[N] = "needregister=" + w.toString();
                                break;
                            case "callerid":
                                S[N] = "callerid=" + l;
                                break;
                            case "displayname":
                                S[N] = "displayname=" + p;
                                break;
                            case "voicerecupload":
                                S[N] = "voicerecupload=" + s;
                                break;
                            case "engine":
                                S[N] = "engine=" + T;
                                break;
                            case "proxyaddress":
                                S[N] = "proxyaddress=" + c
                        } else {
                            var C = S[N].substring(S[N].indexOf("=") + 1), R = ParameterIsDefault("transport"),
                                y = GetParameterInt("transport", 0), L = "udp";
                            1 === y ? L = "tcp" : 2 === y && (L = "tls"), isNull(C) || C.length < 1 ? R || (S[N] = I + "=" + L) : S[N] = I + "=" + L
                        } else {
                            var C = S[N].substring(S[N].indexOf("=") + 1);
                            isNull(C) || C.length < 1 ? S[N] = I + "=" + GetWebrtcUpperServer() : "true" === GetParameter("iswebrtcuppersrvfromuser") && (S[N] = I + "=" + GetWebrtcUpperServer())
                        }
                    }
                    P = "";
                    for (var N = 0; N < S.length; N++) isNull(S[N]) || S[N].indexOf("=") < 2 || (P.length > 0 && (P += "&"), P += S[N]);
                    v = "https://" + n + P, u.length > 0 && (v = v + "&inbounddtmf=" + u), h.length > 0 && (v = v + "&outbounddtmf=" + h)
                }
                v.indexOf("authid=") < 0 && (v = v + "&authid=" + e), v.indexOf("authpwd=") < 0 && (v = v + "&authpwd=" + o), v.indexOf("upperserver=") < 0 && (v = v + "&upperserver=" + GetWebrtcUpperServer()), v.indexOf("upperserverdomain=") < 0 && (v = v + "&upperserverdomain=" + GetWebrtcUpperServer()), v.indexOf("voicerecupload=") < 0 && (v = v + "&voicerecupload=" + s), v.indexOf("needregister=") < 0 && (v = v + "&needregister=" + w.toString()), v.indexOf("callerid=") < 0 && (v = v + "&callerid=" + l), v.indexOf("displayname=") < 0 && (v = v + "&displayname=" + p), v.indexOf("proxyaddress=") < 0 && (v = v + "&proxyaddress=" + c), v.indexOf("dtmfmode=") < 0 && (v = v + "&dtmfmode=" + m), v.indexOf("engine=") < 0 && (v = v + "&engine=" + T), E = !0
            }
            if (!1 === E) {
                var D = "&authpwd=" + o;
                !1 === IsMizuWebRTCGateway2() && n.indexOf("rtc.mizu-voip.com:2443") < 0 && (D = "&authmd5=MD5VALUE&authsalt=MD5SALT"), v = "https://" + n + "/mvapireq/?apientry=wsuser&authkey=" + f + "&authid=" + e + D + "&brandid=" + i + "&brandname=" + a + "&companyname=" + r + "&upperserver=" + GetWebrtcUpperServer() + "&needregister=" + w.toString() + "&callerid=" + l + "&displayname=" + p + "&voicerecupload=" + s + "&engine=" + T + "&dtmfmode=" + m + "&proxyaddress=" + c + "&sessionid=" + GetSessionId() + "&now=415", u.length > 0 && (v = v + "&inbounddtmf=" + u), h.length > 0 && (v = v + "&outbounddtmf=" + h)
            }
            if (v.indexOf("appversion=") < 0 && (v = v + "&appversion=" + webphone_api.global.versionstr), v.indexOf("transport=") < 0 && !1 === ParameterIsDefault("transport")) {
                var y = GetParameterInt("transport", 0), L = "udp";
                1 === y ? L = "tcp" : 2 === y && (L = "tls"), v = v + "&transport=" + L
            }
            if (!1 === Glcr() && (_ = v.indexOf("voicerecupload")) > 0) {
                var G = v.substring(0, _), O = "";
                O = v.substring(_), _ = O.indexOf("&"), O = _ > 0 ? O.substring(_ + 1) : "", v = G + O
            }
            return v
        } catch (x) {
            PutToDebugLogException(2, "common: GetWsuserUrl", x)
        }
        return ""
    }

    function GetWsloadUrl(e) {
        try {
            var o = GetWebrtcSrvAddr(), t = GetConfig("brandid"), n = GetBrandName(), i = GetConfig("companyname"),
                a = "http://";
            if (IsHttps() && (a = "https://"), (isNull(o) || o.length < 2) && (o = GetWp()), o = o.toLowerCase(), o.indexOf("mfstwebsock") < 0) return "";
            o = NormalizeInput(o, 0), o = o.replace("*", "");
            var r = o.indexOf("/");
            r > 0 && (o = o.substring(0, r));
            var s = "1568108345";
            "us" === webphone_api.global.usuk && (s = "1552303117"), IsMizuWebRTCGateway() || (s = GetConfig("serverapikey")), o.indexOf("rtc.mizu-voip.com:2443") >= 0 && (s = "1568108399");
            var l = GetConfig("wsload"), p = !1;
            if (!isNull(l) && l.length > 10 && l.indexOf("?") > 0 && l.indexOf("&") > 0) {
                o = l, r = o.indexOf("://"), r > 0 && (o = o.substring(r + 3)), r = o.indexOf("?"), o = o.substring(0, r + 1);
                var c = l.substring(r + 1);
                c = c.toLowerCase();
                var u = c.split("&");
                if (!isNull(u) && u.length > 0) {
                    for (var h = 0; h < u.length; h++) if (!(isNull(u[h]) || u[h].indexOf("=") < 2 || 0 === u[h].indexOf("apientry=") || 0 === u[h].indexOf("authkey="))) {
                        var m = u[h].substring(0, u[h].indexOf("="));
                        switch (m) {
                            case "authid":
                                u[h] = "authid=" + e;
                                break;
                            case "username":
                                u[h] = "username=" + e;
                                break;
                            case "brandid":
                                u[h] = "brandid=" + t;
                                break;
                            case "brandname":
                                u[h] = "brandname=" + n;
                                break;
                            case "companyname":
                                u[h] = "companyname=" + i;
                                break;
                            case "upperserver":
                                u[h] = "upperserver=" + GetWebrtcUpperServer()
                        }
                    }
                    c = "";
                    for (var h = 0; h < u.length; h++) isNull(u[h]) || u[h].indexOf("=") < 2 || (c.length > 0 && (c += "&"), c += u[h]);
                    l = a + o + c
                }
                p = !0
            } else {
                var g = GetConfig("wsuser");
                if (!isNull(g) && g.length > 10) {
                    var d = g;
                    if (r = d.indexOf("://"), r > 0 && (d = d.substring(r + 3)), r = d.indexOf("/"), r > 0 && (d = d.substring(0, r)), r = d.indexOf("?"), r > 0 && (d = d.substring(0, r)), d.length > 0 && (PutToDebugLog(4, "EVENT, GetWsloadUrl guessed domain: " + d), o = d), (r = g.indexOf("authkey=")) > 0) {
                        var b = g.substring(r + 8);
                        r = b.indexOf("&"), r > 0 && (b = b.substring(0, r)), !isNull(b) && b.length > 0 && (PutToDebugLog(4, "EVENT, GetWsloadUrl guessed apikey: " + b), s = b)
                    }
                }
            }
            return !1 === p && (l = a + o + "/mvapireq/?authkey=" + s + "&apientry=wsload&brandid=" + t + "&brandname=" + n + "&companyname=" + i + "&upperserver=" + GetWebrtcUpperServer() + "&authid=" + e + "&now=415"), l
        } catch (_) {
            PutToDebugLogException(2, "common: GetWsloadUrl", _)
        }
        return ""
    }

    function HandleCalldivert() {
        try {
            if (!1 === IsMizuWebRTCGateway() && !1 === IsMizuWebRTCEmbeddedServer()) return;
            var e = GetParameter("calldivertchecksum");
            isNull(e) && (e = "");
            if ("1" === GetParameter("calldivertsuccess")) return;
            var o = GetParameter2("callforwardonbusy"), t = GetParameter2("callforwardonnoanswer"),
                n = GetParameter2("callforwardalways"), i = GetParameter2("callforwardonnoanswertimeout"),
                a = Md5Hash(o + t + n + i);
            if (e === a) return;
            PutToDebugLog(2, "EVENT, HandleCalldivert old checksum: " + e + " ; new checksum: " + a), (isNull(o) || o.length < 1) && (o = "null"), (isNull(t) || t.length < 1) && (t = "null"), (isNull(n) || n.length < 1) && (n = "null"), SaveParameter("calldivertsuccess", "0");
            var r = GetWebrtcSrvAddr(), s = "http://";
            IsHttps() && (s = "https://"), (isNull(r) || r.length < 2) && (r = GetWp()), r = r.toLowerCase(), r = NormalizeInput(r, 0), r = r.replace("*", "");
            var l = r.indexOf("/");
            l > 0 && (r = r.substring(0, l));
            var p = "1568108345";
            "us" === webphone_api.global.usuk && (p = "1552303117"), IsMizuWebRTCGateway() || (p = GetConfig("serverapikey"));
            var c = GetConfig("wsload"), u = GetConfig("wsuser");
            if (!isNull(u) && u.length > 10) {
                var h = u;
                if (l = h.indexOf("://"), l > 0 && (h = h.substring(l + 3)), l = h.indexOf("/"), l > 0 && (h = h.substring(0, l)), l = h.indexOf("?"), l > 0 && (h = h.substring(0, l)), h.length > 0 && (PutToDebugLog(4, "EVENT, GetCalldivertUrl guessed domain: " + h), r = h), (l = u.indexOf("authkey=")) > 0) {
                    var m = u.substring(l + 8);
                    l = m.indexOf("&"), l > 0 && (m = m.substring(0, l)), !isNull(m) && m.length > 0 && (PutToDebugLog(4, "EVENT, GetCalldivertUrl guessed apikey: " + m), p = m)
                }
            }
            c = s + r + "/mvapireq/?authkey=" + p + "&authid=" + GetSipusername() + "&authpwd=" + GetParameter("password") + "&apientry=calldivert&callforwardonbusy=" + o + "&callforwardonnoanswer=" + t + "&callforwardalways=" + n + "&callforwardonnoanswertimeout=" + i + "&now=415", UriParser(c, "", "", "", "", "calldivertapi")
        } catch (g) {
            PutToDebugLogException(2, "common: HandleCalldivert", g)
        }
    }

    function SetVoiceMailNumber(e) {
        try {
            var o = "";
            webphone_api.getsipheader("Server", function (e) {
                !webphone_api.common.isNull(e) && e.length > 0 && (o = e), webphone_api.getsipheader("User-Agent", function (e) {
                    !webphone_api.common.isNull(e) && e.length > 0 && (hua = e), hua.indexOf("Asterisk") >= 0 || hua.indexOf("FPBX") >= 0 || hua.indexOf("FreePBX") >= 0 || hua.indexOf("FreeSWITCH") >= 0 || hua.indexOf("Asterisk") >= 0 || o.indexOf("FPBX") >= 0 || o.indexOf("FreePBX") >= 0 || o.indexOf("FreeSWITCH"), SetVoiceMailNumberDelayed(null, "*97")
                })
            })
        } catch (t) {
            PutToDebugLogException(2, "common: HandleCalldivert", t)
        }
    }

    function SetVoiceMailNumberDelayed(e, o) {
        try {
            var t = GetDeviceWidth();
            t = !isNull(t) && IsNumber(t) && t > 100 ? Math.floor(t / 1.2) : 220, void 0 !== o && null !== o || (o = ""), o = webphone_api.common.Trim(o);
            var n = '<div data-role="popup" class="ui-content messagePopup" data-overlay-theme="a" data-theme="a" style="max-width:' + t + 'px;"><div data-role="header" data-theme="b"><a href="javascript:;" data-role="button" data-icon="delete" data-iconpos="notext" class="ui-btn-right closePopup">Close</a><h1 class="adialog_title">' + webphone_api.stringres.get("voicemail_title") + '</h1></div><div role="main" class="ui-content adialog_content"><span>' + webphone_api.stringres.get("voicemail_msg") + '</span><input type="text" id="voicemail_input" name="setting_item" data-theme="a" autocapitalize="off" value="' + o + '"/></div><div data-role="footer" data-theme="b" class="adialog_footer"><a href="javascript:;" id="adialog_positive" class="ui-btn ui-corner-all ui-shadow ui-btn-inline ui-btn-b adialog_2button" data-rel="back" data-transition="flow">' + webphone_api.stringres.get("btn_ok") + '</a><a href="javascript:;" id="adialog_negative" class="ui-btn ui-corner-all ui-shadow ui-btn-inline ui-btn-b adialog_2button" data-rel="back">' + webphone_api.stringres.get("btn_cancel") + "</a></div></div>";
            webphone_api.$.mobile.activePage.append(n).trigger("create"), webphone_api.$.mobile.activePage.find(".closePopup").bind("tap", function (e) {
                webphone_api.$.mobile.activePage.find(".messagePopup").popup("close")
            }), webphone_api.$.mobile.activePage.find(".messagePopup").popup().popup("open").bind({
                popupafterclose: function () {
                    webphone_api.$(this).unbind("popupafterclose").remove(), webphone_api.$("#adialog_positive").off("click"), webphone_api.$("#adialog_negative").off("click")
                }
            });
            var i = document.getElementById("voicemail_input");
            isNull(i) || i.focus(), webphone_api.$("#adialog_positive").on("click", function (o) {
                PutToDebugLog(5, "EVENT, common SetVoiceMailNumber OK click");
                var t = "";
                isNull(i) || (t = i.value), !isNull(t) && t.length > 0 && (t = Trim(t), SaveParameter("voicemailnum", t)), e && "function" == typeof e && e(t)
            }), webphone_api.$("#adialog_negative").on("click", function (e) {
            })
        } catch (a) {
            PutToDebugLogException(2, "common: SetVoiceMailNumber", a)
        }
    }

    function CreateConferenceRoom(e) {
        var o = "";
        try {
            var t = webphone_api.mwphonecfg.getAll();
            if (!isNull(t) && o.length < 1) for (var n in t) {
                var i = t[n];
                if (!isNull(i) && i.toString().indexOf("/mvapireq/?apientry=") > 0) {
                    var a = i.toString();
                    a.indexOf("authkey=") > 0 && (a = a.substring(a.indexOf("authkey=")), a.indexOf("&") > 0 && (a = a.substring(0, a.indexOf("&")))), o = i.toString(), o = o.substring(0, o.indexOf("?") + 1), o = o + a + "&authid=USERNAME&authmd5=MD5VALUE&authsalt=MD5SALT&apientry=getconfroom";
                    break
                }
            }
            if (o.length < 1) {
                var r = GetConfig("mainaport");
                r = !isNull(r) && r.length > 0 ? ":" + r : "";
                var s = GetParameter("serveraddress");
                if ((isNull(s) || s.length < 1) && (s = GetParameter("serveraddress_user")), !isNull(s) && s.length > 0) {
                    var l = "";
                    GetWebrtcSrvAddr().indexOf("rtc.mizu-voip.com:2443") >= 0 && (l = "1568108399"), (isNull(l) || l.length < 1) && (l = "1568108345", "us" === webphone_api.global.usuk && (l = "1552303117"), s = GetDomainFromURL(GetWsuserUrl(GetSipusername(), GetParameter("password"))));
                    var p = "http://";
                    !0 === IsHttps() && (p = "https://"), o = p + s + r + "/mvapireq/?authkey=" + l + "&authid=USERNAME&authmd5=MD5VALUE&authsalt=MD5SALT&apientry=getconfroom"
                }
            }
            if (o.length > 0) {
                if (!0 !== e) return o;
                !isNull(webphone_api.global.lastconfroom) && webphone_api.global.lastconfroom.length > 2 ? (PutToDebugLog(3, "EVENT, CreateConferenceRoom returning cached conference room: " + webphone_api.global.lastconfroom), ConferenceRoomReceived(webphone_api.global.lastconfroom)) : UriParser(o, "", "", "", "", "getconferenceroom")
            } else PutToDebugLog(1, "ERROR, Cannot create conference room"), PutToDebugLog(2, "ERROR, CreateConferenceRoom invalid uri: " + o)
        } catch (c) {
            PutToDebugLogException(2, "common: CreateConferenceRoom", c)
        }
        return ""
    }

    function ConferenceRoomReceived(e) {
        try {
            if (isNull(e)) return PutToDebugLog(1, "ERROR, Ivalid conference room"), void PutToDebugLog(2, "ERROR, Ivalid conference room: " + e);
            var o = e.toLowerCase().indexOf("error:");
            if (o >= 0) {
                return void PutToDebugLog(1, "ERROR, " + e.substring(o + 6))
            }
            if (e = e.toLowerCase(), (o = e.indexOf("ok:")) >= 0) {
                webphone_api.global.lastconfroom = e;
                var t = e.substring(o + 3);
                o = t.indexOf(":"), o > 0 && (t = t.substring(o + 1)), t = Trim(t), PutToDebugLog(2, "EVENT, Received conference room: " + t), webphone_api.global.confanswer_received = !0;
                var n = GetParameter("received_confrooms");
                isNull(n) && (n = "");
                for (var i = n.split(","), a = !1, r = 0; r < i.length; r++) if (i[r] === t) {
                    a = !0;
                    break
                }
                if (i.length > 10) for (; i.length > 10;) i.shift();
                !1 === a && i.push(t), n = "";
                for (var r = 0; r < i.length; r++) isNull(i[r]) || (n.length > 0 && (n += ","), n += i[r]);
                if (SaveParameter("received_confrooms", n), currconfroom = t, !1 === IsSDK() && !0 === webphone_api.global.isDialpadStarted) InitiateConference(""); else if (GetNrOfActiveCalls() > 0 && (PutToDebugLog(2, "EVENT, ConferenceRoom hangup active call and call conf room number: " + t), PutToDebugLog(2, "EVENT, mlogic API_Hangup ConferenceRoomReceived"), webphone_api.hangup()), PutToDebugLog(2, "EVENT, mlogic API_Call ConferenceRoomReceived"), webphone_api.call(t), !isNull(webphone_api.global.waiting_conf_numbers) && webphone_api.global.waiting_conf_numbers.length > 0) {
                    var s = webphone_api.global.waiting_conf_numbers.split(",");
                    if (!isNull(s) && s.length > 0) for (var r = 0; r < s.length; r++) isNull(s[r]) || Trim(s[r]).length < 1 || SendConferenceInvites(s[r], t)
                }
            } else PutToDebugLog(1, "ERROR, No conference room received: " + e)
        } catch (l) {
            PutToDebugLogException(2, "common: ConferenceRoomReceived", l)
        }
    }

    function InitiateConference(e) {
        try {
            !isNull(e) && e.length > 0 && (conf_ct.length > 0 && (conf_ct += ","), conf_ct += e);
            var o = GetDeviceWidth();
            o = !isNull(o) && IsNumber(o) && o > 100 ? Math.floor(o / 1.2) : 220;
            var t = webphone_api.stringres.get("confroom_msg1") + ": " + currconfroom + "<br /><br />" + webphone_api.stringres.get("confroom_msg2") + ":",
                n = '<div id="conferenceroom_popup" data-role="popup" class="ui-content messagePopup" data-overlay-theme="a" data-theme="a" style="max-width:' + o + 'px;"><div data-role="header" data-theme="b"><a href="javascript:;" data-role="button" data-icon="delete" data-iconpos="notext" class="ui-btn-right closePopup">Close</a><h1 class="adialog_title">' + webphone_api.stringres.get("menu_confrooms") + '</h1></div><div role="main" class="ui-content adialog_content adialog_btn_nexttoinput"><span>' + t + '</span><div style="clear: both;">\x3c!--//--\x3e</div><input type="text" id="conferenceroom_input" name="setting_item" data-theme="a" autocapitalize="off"/><button id="btn_pickct" class="btn_nexttoinput ui-btn ui-btn-corner-all ui-btn-b noshadow"><img src="' + GetElementSource() + 'images/btn_add_contact_txt.png"></button></div><div data-role="footer" data-theme="b" class="adialog_footer"><a href="javascript:;" id="adialog_positive" class="ui-btn ui-corner-all ui-shadow ui-btn-inline ui-btn-b adialog_2button" data-rel="back" data-transition="flow">' + webphone_api.stringres.get("btn_ok") + '</a><a href="javascript:;" id="adialog_negative" class="ui-btn ui-corner-all ui-shadow ui-btn-inline ui-btn-b adialog_2button" data-rel="back">' + webphone_api.stringres.get("btn_cancel") + "</a></div></div>";
            webphone_api.$.mobile.activePage.append(n).trigger("create"), webphone_api.$.mobile.activePage.find(".closePopup").bind("tap", function (e) {
                webphone_api.$.mobile.activePage.find(".messagePopup").popup("close")
            }), webphone_api.$.mobile.activePage.find(".messagePopup").popup().popup("open").bind({
                popupafterclose: function () {
                    webphone_api.$(this).unbind("popupafterclose").remove(), webphone_api.$("#adialog_positive").off("click"), webphone_api.$("#adialog_negative").off("click"), webphone_api.$("#btn_pickct").off("click")
                }
            });
            var i = document.getElementById("conferenceroom_input");
            !isNull(conf_ct) && conf_ct.length > 1 && (i.value = Trim(conf_ct)), isNull(i) || i.focus(), setTimeout(function () {
                webphone_api.common.isNull(i) || i.focus()
            }, 150), webphone_api.$("#adialog_positive").on("click", function (e) {
                PutToDebugLog(5, "EVENT, call Conferenceroom ok onclick");
                var o = Trim(i.value);
                webphone_api.$("#conferenceroom_popup").on("popupafterclose", function (e) {
                    !isNull(o) && o.length > 0 ? (conf_ct = "", SendConferenceInvites(o, currconfroom), 3 !== GetParameterInt("conferencerooms", 1) && (PutToDebugLog(2, "EVENT, mlogic API_Call InitiateConference"), webphone_api.call(currconfroom))) : (ShowToast(webphone_api.stringres.get("err_msg_4")), webphone_api.$.mobile.back())
                })
            }), webphone_api.$("#adialog_negative").on("click", function (e) {
            }), webphone_api.$("#btn_pickct").on("click", function (e) {
                webphone_api.$.mobile.activePage.find(".messagePopup").popup("close"), webphone_api.$("#conferenceroom_popup").on("popupafterclose", function (e) {
                    webphone_api.$("#conferenceroom_popup").off("popupafterclose"), PickContact(InitiateConference)
                })
            })
        } catch (a) {
            PutToDebugLogException(2, "common: InitiateConference", a)
        }
    }

    function SendConferenceInvites(e, o) {
        function t() {
            function e() {
                isNull(cftimer) || clearInterval(cftimer), cftimer = null
            }

            try {
                if (null === cftimer) {
                    var t = 0, n = 0;
                    cftimer = setInterval(function () {
                        if (++cfmaxloop > 90) return void e();
                        t < 1 ? (t = 1, !0 === webphone_api.isincall() && (PutToDebugLog(2, "EVENT, ConfRoom: hangup active call"), PutToDebugLog(2, "EVENT, mlogic API_Hangup HanleConfTransfer"), webphone_api.hangup())) : cfmaxloop > 2 && 1 === t ? (PutToDebugLog(2, "EVENT, ConfRoom: call destination: " + s), PutToDebugLog(2, "EVENT, mlogic API_Call HanleConfTransfer: " + s), webphone_api.call(s), t = 2) : 2 === t ? !0 === webphone_api.global.checkIfCallActive && (PutToDebugLog(2, "EVENT, ConfRoom: destination accepted the call"), t = 3, cfmaxloop > 40 && (cfmaxloop = 10)) : 3 === t ? (PutToDebugLog(2, "EVENT, ConfRoom: transfer call: " + o), PutToDebugLog(2, "EVENT, mlogic API_Transfer HanleConfTransfer: " + o), webphone_api.transfer(o), t = 5, n = cfmaxloop + 5) : 5 === t && n < cfmaxloop && (PutToDebugLog(2, "EVENT, ConfRoom: call conf room: " + o), PutToDebugLog(2, "EVENT, mlogic API_Call HanleConfTransfer 2: " + o), webphone_api.call(o), e())
                    }, 330)
                }
            } catch (i) {
                PutToDebugLogException(2, "common: HanleConfTransfer", i)
            }
        }

        try {
            var n = GetParameterInt("conferencerooms", 1),
                i = "[DONT_START_CHAT_WINDOW][CONFERENCE] You are invited to conference by: " + GetSipusername() + ". Call this number to join the conference: " + o,
                a = e.split(",");
            if (isNull(a) || a.length < 1) return;
            for (var r = 0; r < a.length;) isNull(a[r]) || a[r].length < 1 ? a.splice(r, 1) : r++;
            var s = Trim(a[0]);
            1 === n || -1 === n ? (PutToDebugLog(2, "EVENT, mlogic API_SendCaht SendConferenceInvites"), webphone_api.sendchat(s, i), setTimeout(function () {
                !1 === webphone_api.global.confanswer_received && (PutToDebugLog(2, "EVENT, ConfRoom: answer not received, so handle with transfer"), t()), webphone_api.global.confanswer_received = !1
            }, 3e3)) : 2 === n ? (PutToDebugLog(2, "EVENT, mlogic API_SendCaht SendConferenceInvites 2"), webphone_api.sendchat(s, i)) : 3 === n && t()
        } catch (l) {
            PutToDebugLogException(2, "common: SendConferenceInvites", l)
        }
    }

    function ReceivedConferenceInvite(e, o) {
        try {
            var t = GetDeviceWidth();
            t = !isNull(t) && IsNumber(t) && t > 100 ? Math.floor(t / 1.2) : 220;
            var n = o.lastIndexOf(":");
            n > 0 && (o = o.substring(n + 1));
            var i = Trim(o);
            o = webphone_api.stringres.get("confroom_inv_msg") + ": " + e;
            var a = '<div id="conferenceinvite_popup" data-role="popup" class="ui-content messagePopup" data-overlay-theme="a" data-theme="a" style="max-width:' + t + 'px;"><div data-role="header" data-theme="b"><h1 class="adialog_title">' + webphone_api.stringres.get("confroom_inv_title") + '</h1></div><div role="main" class="ui-content adialog_content"><span>' + o + '</span></div><div data-role="footer" data-theme="b" class="adialog_footer"><a href="javascript:;" id="adialog_positive" class="ui-btn ui-corner-all ui-shadow ui-btn-inline ui-btn-b adialog_2button" data-rel="back" data-transition="flow">' + webphone_api.stringres.get("btn_accept") + '</a><a href="javascript:;" id="adialog_negative" class="ui-btn ui-corner-all ui-shadow ui-btn-inline ui-btn-b adialog_2button" data-rel="back">' + webphone_api.stringres.get("btn_reject") + "</a></div></div>";
            Beep("1"), webphone_api.$.mobile.activePage.append(a).trigger("create"), webphone_api.$.mobile.activePage.find(".messagePopup").bind({
                popupbeforeposition: function () {
                    webphone_api.$(".ui-popup-screen").off(), webphone_api.$(this).unbind("popupbeforeposition")
                }
            }), webphone_api.$.mobile.activePage.find(".messagePopup").popup().popup("open").bind({
                popupafterclose: function () {
                    webphone_api.$(this).unbind("popupafterclose").remove(), webphone_api.$("#adialog_positive").off("click"), webphone_api.$("#adialog_negative").off("click")
                }
            }), 1 === GetParameterInt("conferencerooms", 1) && (PutToDebugLog(2, "EVENT, mlogic API_SendChat ReceivedConferenceInvite"), webphone_api.sendchat(e, "[DONT_START_CHAT_WINDOW][CONFERENCE_ANSWER]")), webphone_api.$("#adialog_positive").on("click", function (e) {
                PutToDebugLog(5, "EVENT, ReceivedConferenceInvite ok onclick"), webphone_api.$("#conferenceinvite_popup").on("popupafterclose", function (e) {
                    webphone_api.global.isconfcall = !0, PutToDebugLog(2, "EVENT, mlogic API_Call ReceivedConferenceInvite: " + i), webphone_api.call(i)
                })
            }), webphone_api.$("#adialog_negative").on("click", function (e) {
            })
        } catch (r) {
            PutToDebugLogException(2, "common: ReceivedConferenceInvite", r)
        }
    }

    function IsServiceUpToDate() {
        try {
            var e = GetParameterInt("autosrvupgrade", 1), o = GetParameterInt("nsupgrademode", 1);
            if ((e < 1 || !0 === serviceupdatechecked || 0 === o) && o < 2) return;
            WinAPI("extcmd_version", function (t) {
                if (isNull(t) || t.indexOf("ERROR:") >= 0) return void PutToDebugLog(2, "ERROR, IsServiceUpToDate: " + t);
                var n = GetMinServiceVersion(), i = 0, a = t, r = a.indexOf("version:");
                if (r > 0 && (a = a.substring(r + 8)), r = a.indexOf("eov"), r > 0 && (a = a.substring(0, r)), a = Trim(a), !isNull(a) && IsNumber(a)) (i = StrToInt(a)) > 0 && SaveParameter("srvupgrade_currversion", i); else if (PutToDebugLog(2, "ERROR, IsServiceUpToDate, received data is ivalid: " + a), o < 2) return;
                var s = GetConfig("confighash");
                isNull(s) && (s = "");
                var l = "";
                WinAPI("API_GetConfigHash", function (t) {
                    if (isNull(t) && (t = ""), l = Trim(t), serviceupdatechecked = !0, n > i || 32 === s.length && 32 === l.length && s !== l) {
                        var a = !0;
                        if (1 === e) {
                            var r = GetParameterInt("srvupgrade_count", 0);
                            r < 3 ? (a = !1, PutToDebugLog(2, "EVENT, native service upgrade skipped because count: " + r.toString()), r++) : r = 0, SaveParameter("srvupgrade_count", r)
                        }
                        var p = GetParameter("srvupgrade_version"), c = i.toString() + "_" + n.toString();
                        p === c && (a = !1), 2 === o && (a = !0), PutToDebugLog(2, "EVENT, native service upgrade sv: " + p + " : " + c), !0 === a && (SaveParameter("srvupgrade_version", c), EngineForcedInstall("ns", webphone_api.stringres.get("service_update")), webphone_api.global.nsupdatepending = !0)
                    }
                })
            })
        } catch (t) {
            PutToDebugLogException(2, "common: IsServiceUpToDate", t)
        }
    }

    function GetMinServiceVersion() {
        try {
            var e = webphone_api.global.minimumserviceversion, o = webphone_api.parameters.minserviceversion
                ;
            return !isNull(o) && IsNumber(o) && (e = StrToInt(o)), o = GetConfig("minserviceversion"), !isNull(o) && IsNumber(o) && StrToInt(o) > e && (e = StrToInt(o)), e
        } catch (t) {
            PutToDebugLogException(2, "common: GetMinServiceVersion", t)
        }
        return 0
    }

    function GetAudioBandwidth() {
        try {
            var e = 64, o = GetParameter2("audio_bandwidth");
            if (!isNull(o) && IsNumber(o)) {
                var t = StrToInt(o);
                t >= 0 && t < 2049 && (e = t)
            }
            return e
        } catch (n) {
            PutToDebugLogException(2, "common: GetAudioBandwidth", n)
        }
        return 0
    }

    function GetVideoBandwidth() {
        try {
            var e = 256, o = GetParameter2("video_bandwidth");
            if (!isNull(o) && IsNumber(o)) {
                var t = StrToInt(o);
                t >= 0 && t < 4e3 && (e = t)
            }
            return e
        } catch (n) {
            PutToDebugLogException(2, "common: GetVideoBandwidth", n)
        }
        return 0
    }

    function GetVideoWidth() {
        try {
            var e = 320, o = GetParameter2("video_width");
            if (!isNull(o) && IsNumber(o)) {
                var t = StrToInt(o);
                t > 0 && t < 4e3 && (e = t)
            }
            return e
        } catch (n) {
            PutToDebugLogException(2, "common: GetVideoWidth", n)
        }
        return 0
    }

    function GetVideoHeight() {
        try {
            var e = 240, o = GetParameter2("video_height");
            if (!isNull(o) && IsNumber(o)) {
                var t = StrToInt(o);
                t > 0 && t < 4e3 && (e = t)
            }
            return e
        } catch (n) {
            PutToDebugLogException(2, "common: GetVideoHeight", n)
        }
        return 0
    }

    function EngineSwitchConference(e, o, t, n) {
        try {
            SaveParameter("conf_engineswitcheoffered", "true"), PutToDebugLog(2, "EVENT, EngineSwitchConference called");
            var i = GetDeviceWidth();
            i = !isNull(i) && IsNumber(i) && i > 100 ? Math.floor(i / 1.2) : 220;
            var a = "Conferencing is not available for WebRTC. If this functionality is important for you, we recommend to use " + GetEngineDisplayName(e) + " engine.<br /><br />Would you like to switch to " + GetEngineDisplayName(e) + " engine ?",
                r = '<div data-role="popup" id="conf_switch_popup" class="ui-content messagePopup" data-overlay-theme="a" data-theme="a" style="max-width:' + i + 'px;"><div data-role="header" data-theme="b"><h1 class="adialog_title">' + webphone_api.stringres.get("switch_engine") + '</h1></div><div role="main" class="ui-content adialog_content adialog_alert"><span> ' + a + ' </span></div><div data-role="footer" data-theme="b" class="adialog_footer"><a href="javascript:;" id="adialog_positive" class="ui-btn ui-corner-all ui-shadow ui-btn-inline ui-btn-b adialog_2button" data-rel="back" data-transition="flow">' + webphone_api.stringres.get("btn_ok") + '</a><a href="javascript:;" id="adialog_negative" class="ui-btn ui-corner-all ui-shadow ui-btn-inline ui-btn-b adialog_2button" data-rel="back">' + webphone_api.stringres.get("btn_cancel") + "</a></div></div>";
            n = n || function () {
            }, webphone_api.$.mobile.activePage.append(r).trigger("create"), webphone_api.$.mobile.activePage.find(".closePopup").bind("tap", function (e) {
                webphone_api.$.mobile.activePage.find(".messagePopup").popup("close")
            }), webphone_api.$.mobile.activePage.find(".messagePopup").bind({
                popupbeforeposition: function () {
                    webphone_api.$(".ui-popup-screen").off(), webphone_api.$(this).unbind("popupbeforeposition");
                    var e = Math.floor(.6 * GetDeviceHeight());
                    webphone_api.$(this).height() > e + 100 && webphone_api.$(".messagePopup .ui-content").height(e)
                }
            }), webphone_api.$.mobile.activePage.find(".messagePopup").popup().popup("open").bind({
                popupafterclose: function () {
                    webphone_api.$(this).unbind("popupafterclose").remove(), n()
                }
            }), webphone_api.$("#adialog_negative").on("click", function (e) {
                PutToDebugLog(5, "EVENT, EngineSwitchConference cancel click"), t(o)
            }), webphone_api.$("#adialog_positive").on("click", function (o) {
                PutToDebugLog(5, "EVENT, EngineSwitchConference ok click, engine: " + e), webphone_api.$("#conf_switch_popup").on("popupafterclose", function (o) {
                    if (PutToDebugLog(2, "EVENT, EngineSwitchConference hangup active call"), !0 === webphone_api.isincall() && (PutToDebugLog(2, "EVENT, mlogic API_Hangup EngineSwitchConference"), webphone_api.hangup()), "java" === e) {
                        webphone_api.flagrestartwebrtc = !1, ResetEngineClicked();
                        var t = GetEngine("java");
                        t.clicked = 2, SetEngine("java", t), OpenSettings(!0, 6), setTimeout(function () {
                            InstallJavaPopup(!1)
                        }, 400)
                    } else {
                        SaveParameter("lastusedengine", "ns"), webphone_api.flagrestartwebrtc = !1, ResetEngineClicked();
                        var t = GetEngine("ns");
                        t.clicked = 2, SetEngine("ns", t), EngineSelect(1), webphone_api.common.EngineForcedInstall("ns", "", function () {
                            webphone_api.startInner()
                        })
                    }
                })
            })
        } catch (s) {
            PutToDebugLogException(2, "common: EngineSwitchConference", s)
        }
    }

    function EngineSwitchTransfer(e, o, t, n) {
        try {
            SaveParameter("transf_engineswitcheoffered", "true"), PutToDebugLog(2, "EVENT, EngineSwitchTransfer called");
            var i = GetDeviceWidth();
            i = !isNull(i) && IsNumber(i) && i > 100 ? Math.floor(i / 1.2) : 220;
            var a = "Transfer with WebRTC works only between WebRTC endpoints. If this functionality is important for you, we recommend to use " + GetEngineDisplayName(e) + " engine.<br /><br />Would you like to switch to " + GetEngineDisplayName(e) + " engine ?",
                r = '<div data-role="popup" id="transf_switch_popup" class="ui-content messagePopup" data-overlay-theme="a" data-theme="a" style="max-width:' + i + 'px;"><div data-role="header" data-theme="b"><h1 class="adialog_title">' + webphone_api.stringres.get("switch_engine") + '</h1></div><div role="main" class="ui-content adialog_content adialog_alert"><span> ' + a + ' </span></div><div data-role="footer" data-theme="b" class="adialog_footer"><a href="javascript:;" id="adialog_positive" class="ui-btn ui-corner-all ui-shadow ui-btn-inline ui-btn-b adialog_2button" data-rel="back" data-transition="flow">' + webphone_api.stringres.get("btn_ok") + '</a><a href="javascript:;" id="adialog_negative" class="ui-btn ui-corner-all ui-shadow ui-btn-inline ui-btn-b adialog_2button" data-rel="back">' + webphone_api.stringres.get("btn_cancel") + "</a></div></div>";
            n = n || function () {
            }, webphone_api.$.mobile.activePage.append(r).trigger("create"), webphone_api.$.mobile.activePage.find(".closePopup").bind("tap", function (e) {
                webphone_api.$.mobile.activePage.find(".messagePopup").popup("close")
            }), webphone_api.$.mobile.activePage.find(".messagePopup").bind({
                popupbeforeposition: function () {
                    webphone_api.$(".ui-popup-screen").off(), webphone_api.$(this).unbind("popupbeforeposition");
                    var e = Math.floor(.6 * GetDeviceHeight());
                    webphone_api.$(this).height() > e + 100 && webphone_api.$(".messagePopup .ui-content").height(e)
                }
            }), webphone_api.$.mobile.activePage.find(".messagePopup").popup().popup("open").bind({
                popupafterclose: function () {
                    webphone_api.$(this).unbind("popupafterclose").remove(), n()
                }
            }), webphone_api.$("#adialog_negative").on("click", function (e) {
                PutToDebugLog(5, "EVENT, EngineSwitchTransfer cancel click"), t(o)
            }), webphone_api.$("#adialog_positive").on("click", function (o) {
                PutToDebugLog(5, "EVENT, EngineSwitchTransfer ok click, engie: " + e), webphone_api.$("#transf_switch_popup").on("popupafterclose", function (o) {
                    if (PutToDebugLog(2, "EVENT, EngineSwitchTransfer hangup active call"), !0 === webphone_api.isincall() && (PutToDebugLog(2, "EVENT, mlogic API_Hangup EngineSwitchTransfer"), webphone_api.hangup()), "java" === e) {
                        webphone_api.flagrestartwebrtc = !1, ResetEngineClicked();
                        var t = GetEngine("java");
                        t.clicked = 2, SetEngine("java", t), OpenSettings(!0, 7), setTimeout(function () {
                            InstallJavaPopup(!1)
                        }, 400)
                    } else {
                        webphone_api.flagrestartwebrtc = !1, ResetEngineClicked();
                        var t = GetEngine("ns");
                        t.clicked = 2, SetEngine("ns", t), setTimeout(function () {
                            NPDownloadAndInstall()
                        }, 400);
                        var n = GetNPLocation();
                        !isNull(n) && n.length > 0 && window.open(n)
                    }
                })
            })
        } catch (s) {
            PutToDebugLogException(2, "common: EngineSwitchTransfer", s)
        }
    }

    function HideSettings(e, o, t, n) {
        try {
            if (isNull(enableoptions)) {
                enableoptions = [];
                var i = "";
                !isNull(webphone_api.parameters.enableoptions) && webphone_api.parameters.enableoptions.length > 0 && (i = webphone_api.parameters.enableoptions), (isNull(i) || i.length < 2) && (i = GetConfig("enableoptions")), !isNull(i) && i.length > 0 && (i = Trim(i), enableoptions = i.split(",")), isNull(enableoptions) && (enableoptions = [])
            }
            if (isNull(disableoptions)) {
                disableoptions = [];
                var i = "";
                !isNull(webphone_api.parameters.disableoptions) && webphone_api.parameters.disableoptions.length > 0 && (i = webphone_api.parameters.disableoptions), (isNull(i) || i.length < 2) && (i = GetConfig("disableoptions")), !isNull(i) && i.length > 0 && (i = Trim(i), disableoptions = i.split(",")), isNull(disableoptions) && (disableoptions = [])
            }
            if (isNull(e) && (e = ""), isNull(o) && (o = ""), isNull(t) && (t = ""), isNull(n) && (n = !1), enableoptions.length > 0 && (e.length > 0 || o.length > 0 || t.length > 0)) {
                e = e.toLowerCase(), o = o.toLowerCase(), t = t.toLowerCase();
                for (var a = 0; a < enableoptions.length; a++) {
                    var r = enableoptions[a];
                    if (!(isNull(r) || r.length < 1) && (r = r.toLowerCase(), e.indexOf(r) >= 0 || r === o || r === t)) return !1
                }
                return !0
            }
            if (disableoptions.length > 0 && (e.length > 0 || o.length > 0 || t.length > 0)) {
                e = e.toLowerCase(), o = o.toLowerCase(), t = t.toLowerCase();
                for (var a = 0; a < disableoptions.length; a++) {
                    var r = disableoptions[a];
                    if (!(isNull(r) || r.length < 1) && (r = r.toLowerCase(), e.indexOf(r) >= 0 || r === o || r === t)) return !0 !== n || !!StrIsUpperCase(disableoptions[a])
                }
            }
        } catch (s) {
            PutToDebugLogException(2, "common: HideSettings", s)
        }
        return !1
    }

    function ShowRatingWhyleType(e) {
        try {
            if (webphone_api.global.showratewhiletype_cache < 1 || isNull(e) || e.length < 1) return;
            webphone_api.$("#disprate_container").html(e)
        } catch (o) {
            PutToDebugLogException(2, "common: ShowRatingWhyleType", o)
        }
    }

    function SetLanguage() {
        try {
            var e = webphone_api.parameters.language;
            if ((isNull(e) || 2 !== e.length) && (e = GetConfig("language")), (isNull(e) || 2 !== e.length) && (e = GetParameter("language")), isNull(e)) return void PutToDebugLog(2, "EVENT, common: SetLanguage invalid language: " + e);
            2 === e.length && (webphone_api.stringres.setlang(e), PutToDebugLog(3, "EVENT, language set to: " + e))
        } catch (o) {
            PutToDebugLogException(2, "common: SetLanguage", o)
        }
    }

    function SetNotCounter(e, o) {
        try {
            if (isNull(e) || e.length < 1) return;
            var t = document.getElementById(e);
            if (isNull(t)) return;
            !isNull(o) && o.length > 0 && IsNumber(o) && "0" != o ? (t.innerHTML = o, t.style.display = "block") : (t.innerHTML = "", t.style.display = "none")
        } catch (n) {
            PutToDebugLogException(2, "common: SetNotCounter", n)
        }
    }

    function WebContactGet(e, o) {
        try {
            if (isNull(webct_url) && (webct_url = GetParameter2("webcontact_url"), (isNull(webct_url) || webct_url.length < 3) && (webct_url = GetConfig("webcontact_url")), isNull(webct_url) && (webct_url = "")), webct_url.length < 3) return;
            if (isNull(e) || e.length < 1) return void PutToDebugLog(3, "WARNING, common WebContactGet invalid number: " + e);
            if (!o || "function" != typeof o) return void PutToDebugLog(3, "ERROR, common WebContactGet callback is NULL");
            var t = webct_url.replace("CALLEDNUMBER", e);
            webct_cb.push(o), UriParser(t, "", "", "", "", "webcontactsearch")
        } catch (n) {
            PutToDebugLogException(2, "common: WebContactGet", n)
        }
    }

    function WebContactReceived(e) {
        try {
            if (isNull(webct_cb) || webct_cb.length < 1) return void PutToDebugLog(3, "ERROR, common WebContactReceived no callback specified");
            var o = webct_cb.shift();
            if (isNull(o) || !o || "function" != typeof o) return void PutToDebugLog(3, "ERROR, common WebContactReceived invalid callback");
            if (isNull(e) || e.length < 2) return void PutToDebugLog(3, "WARNING, common WebContactReceived invalid data: " + e);
            var t = [];
            if (webct_url.toLowerCase().indexOf("tel.search.ch") >= 0) {
                var n = e.split("</entry>");
                if (!isNull(n) && n.length > 0) for (var i = 0, a = 0; a < n.length; a++) if (!((i = n[a].indexOf("<entry>")) < 0)) {
                    var r = n[a].substring(i), s = "", l = "", i = r.indexOf("<tel:name>");
                    i > 0 && (s = r.substring(i + 10), i = s.indexOf("</tel:name>"), i > 0 && (s = s.substring(0, i)), isNull(s) && (s = ""), s = Trim(s)), i = r.indexOf("<tel:phone>"), i > 0 && (l = r.substring(i + 11), i = l.indexOf("</tel:phone>"), i > 0 && (l = l.substring(0, i)), isNull(l) && (l = ""), l = Trim(l)), t.push(s + "," + l)
                }
            }
            t.length < 1 && t.push(e), o(t)
        } catch (p) {
            PutToDebugLogException(2, "common: WebContactReceived", p)
        }
    }

    function IsXML(e) {
        try {
            webphone_api.$.parseXML(e);
            return !0
        } catch (o) {
        }
        return !1
    }

    function GetLastRecInvite() {
        return isNull(saved_lastrecinvite) && (saved_lastrecinvite = ""), saved_lastrecinvite
    }

    function GetLastSentInvite() {
        return isNull(saved_lastsentinvite) && (saved_lastsentinvite = ""), saved_lastsentinvite
    }

    function SaveCallSession(e, o, t, n, i, a, r, s, l, p, c, u, h, m, g) {
        var d = -5;
        try {
            var b = -1;
            null === e || ((void 0 === e || e.length < 1) && (e = webphone_api.global.aline.toString(), e = Trim(e)), StrToInt(e) < 1 && (e = GetBestLine().toString())), isNull(t) && (t = ""), t = Trim(t), (isNull(n) || "1" != n && "2" != n) && (n = ""), n = Trim(n), (isNull(i) || !1 === IsNumber(i)) && (i = -1), (isNull(a) || !1 === IsNumber(a)) && (a = -1), (isNull(r) || !1 === IsNumber(r)) && (r = -1), (isNull(s) || s.length < 1) && (s = ""), s = Trim(s), (isNull(l) || l.length < 1) && (l = ""), l = Trim(l), l = l.toLowerCase(), (isNull(p) || p.length < 1) && (p = ""), (isNull(c) || c.length < 1) && (c = ""), (isNull(h) || "true" !== h && "false" !== h) && (h = ""), (isNull(m) || "true" !== m && "false" !== m) && (m = ""), (isNull(g) || g.length < 10) && (g = ""), !isNull(u) && u.length < 1 && (u = null), g.length > 10 && ("1" === n ? saved_lastsentinvite = g : "2" === n && (saved_lastrecinvite = g));
            for (var _ = 0; _ < webphone_api.global.ep.length; _++) if (isNull(webphone_api.global.ep[_]) || webphone_api.global.ep[_].length < 5) {
                var f = "NULL";
                isNull(webphone_api.global.ep[_]) || (f = webphone_api.global.ep[_].toString()), PutToDebugLog(2, "ERROR, common: SaveCallSession remove invalid endpoint_1: " + f), webphone_api.global.ep.splice(_, 1), _--
            } else {
                var w = webphone_api.global.ep[_][EP_LINE], v = webphone_api.global.ep[_][EP_CALLID];
                if ((null !== e && w == e || !isNull(v) && v.length > 0 && v == l) && !isNull(webphone_api.global.ep[_][EP_SESSION] || getuseengine() !== webphone_api.global.ENGINE_WEBRTC)) {
                    b = _;
                    break
                }
            }
            if (null === e && b < 0 && t.length > 0) for (var _ = 0; _ < webphone_api.global.ep.length; _++) if (isNull(webphone_api.global.ep[_]) || webphone_api.global.ep[_].length < 5) {
                var f = "NULL";
                isNull(webphone_api.global.ep[_]) || (f = webphone_api.global.ep[_].toString()), PutToDebugLog(2, "ERROR, common: SaveCallSession remove invalid endpoint_2: " + f), webphone_api.global.ep.splice(_, 1), _--
            } else {
                var E = webphone_api.global.ep[_][EP_DESTNR];
                if (E == t && !isNull(webphone_api.global.ep[_][EP_SESSION] || getuseengine() !== webphone_api.global.ENGINE_WEBRTC)) {
                    if ("1" != n && "2" != n) {
                        b = _;
                        break
                    }
                    if (n === webphone_api.global.ep[_][EP_INCOMING]) {
                        b = _;
                        break
                    }
                }
            }
            if (b > -1) {
                var T = webphone_api.global.ep[b][EP_LINE];
                if (isNull(T) && (T = ""), T = T.toString(), null !== e && (T.length < 1 || null === StrToInt(T))) {
                    StrToInt(e) > 0 && (webphone_api.global.ep[b][EP_LINE] = e)
                }
                isNull(o) || (webphone_api.global.ep[b][EP_SESSION] = o), t.length > 0 && (webphone_api.global.ep[b][EP_DESTNR] = t), 1 === n.length && (webphone_api.global.ep[b][EP_INCOMING] = n), i > 0 && (webphone_api.global.ep[b][EP_SETUPTIME] = i), (a > 0 || a < -2) && (webphone_api.global.ep[b][EP_CONNECTTIME] = a), (r > 0 || r < -2) && (webphone_api.global.ep[b][EP_DISCONNECTTIME] = r), (s.length > 0 || r < -2) && (webphone_api.global.ep[b][EP_REASON] = s), l.length > 0 && webphone_api.global.ep[b][EP_CALLID].length < 5 && (webphone_api.global.ep[b][EP_CALLID] = l), p.length > 0 && (webphone_api.global.ep[b][EP_SETUPSENT] = p), c.length > 0 && (webphone_api.global.ep[b][EP_FINISHEDSENT] = c), isNull(u) || (webphone_api.global.ep[b][EP_SIPHEADERS] = u), "true" !== h && "false" !== h || (webphone_api.global.ep[b][EP_MUTESTATE] = h), "true" !== m && "false" !== m || (webphone_api.global.ep[b][EP_HOLDSTATE] = m), g.length > 10 && (webphone_api.global.ep[b][EP_SIPINVITE] = g);
                try {
                    ("undefined" == typeof webphone_api.global.ep[b][EP_SESSID] || null === webphone_api.global.ep[b][EP_SESSID] || webphone_api.global.ep[b][EP_SESSID].length < 1) && void 0 !== o && null !== o && "undefined" != typeof o.o_session && null !== o.o_session && "undefined" != typeof o.o_session.__i_session_id && null !== o.o_session.__i_session_id && (webphone_api.global.ep[b][EP_SESSID] = o.o_session.__i_session_id)
                } catch (I) {
                    PutToDebugLogException(2, "common: SaveCallSession inner sessionID 1", I)
                }
                webphone_api.global.ep[b][EP_FLAGDEL] = "false", d = StrToInt(webphone_api.global.ep[b][EP_LINE]), !isNull(d) && IsNumber(d) || (d = -5);
                var P = g;
                P.length > 50 && (P = P.substring(0, 50)), PutToDebugLog(4, "EVENT, common: SaveCallSession endpoint updated, line: " + webphone_api.global.ep[b][EP_LINE] + "; destnr: " + t + "; isincoming: " + n + "; callid: " + l + "; setuptime: " + i + "; connecttime: " + a + "; disctime: " + r + "; setupsent: " + p + "; finishedsent: " + c + "; mutestate: " + h + "; holdstate: " + m + "; sipinvite: " + P)
            } else {
                "true" !== h && "false" !== h && (h = "false"), "true" !== m && "false" !== m && (m = "false"), (isNull(e) || e.length < 1) && (e = webphone_api.global.aline.toString()), StrToInt(e) < 1 && (e = GetBestLine().toString()), d = StrToInt(e);
                var S = "";
                try {
                    void 0 !== o && null !== o && "undefined" != typeof o.o_session && null !== o.o_session && "undefined" != typeof o.o_session.__i_session_id && null !== o.o_session.__i_session_id && (S = o.o_session.__i_session_id)
                } catch (I) {
                    PutToDebugLogException(2, "common: SaveCallSession inner sessionID 2", I)
                }
                var N = [e, o, t, n, i, a, r, s, l, "false", p, c, u, h, m, g, S];
                isNull(webphone_api.global.ep) && (webphone_api.global.ep = []), webphone_api.global.ep.push(N);
                var P = g;
                P.length > 50 && (P = P.substring(0, 50)), PutToDebugLog(4, "EVENT, common: SaveCallSession new endpoint added, line: " + e + "; destnr: " + t + "; isincoming: " + n + "; callid: " + l + "; setuptime: " + i + "; connecttime: " + a + "; disctime: " + r + "; setupsent: " + p + "; finishedsent: " + c + "; mutestate: " + h + "; holdstate: " + m + "; sipinvite: " + P + "; sessionID: " + S)
            }
            !1 === IsSDK() && !0 === webphone_api.global.isCallStarted && webphone_api._call.UpdateLineButtons()
        } catch (C) {
            PutToDebugLogException(2, "common: SaveCallSession", C)
        }
        return d
    }

    function GetCallSession(e, o, t, n, i, a) {
        try {
            if (isNull(webphone_api.global.ep) || webphone_api.global.ep.length < 1) return webphone_api.global.ep = [], !1 === IsSDK() && !0 === webphone_api.global.isCallStarted && webphone_api._call.UpdateLineButtons(), i;
            (isNull(o) || o.length < 1) && (o = webphone_api.global.aline.toString()), o = Trim(o), isNull(t) && (t = ""), t = Trim(t), (isNull(a) || "1" != a && "2" != a) && (a = "1"), a = Trim(a), (isNull(n) || n.length < 1) && (n = ""), n = Trim(n), n = n.toLowerCase();
            for (var r = 0; r < webphone_api.global.ep.length; r++) if (isNull(webphone_api.global.ep[r]) || webphone_api.global.ep[r].length < 5) {
                var s = "NULL";
                isNull(webphone_api.global.ep[r]) || (s = webphone_api.global.ep[r].toString()), PutToDebugLog(2, "ERROR, common: GetCallSession remove invalid endpoint_1: " + s), webphone_api.global.ep.splice(r, 1), r--
            } else {
                var l = webphone_api.global.ep[r][EP_LINE], p = webphone_api.global.ep[r][EP_CALLID];
                if ((l == o || !isNull(p) && p.length > 0 && p == n) && !isNull(webphone_api.global.ep[r][EP_SESSION] || getuseengine() !== webphone_api.global.ENGINE_WEBRTC)) {
                    var c = webphone_api.global.ep[r][EP_SESSION];
                    return e && (webphone_api.global.ep[r][EP_FLAGDEL] = "true"), !1 === IsSDK() && !0 === webphone_api.global.isCallStarted && webphone_api._call.UpdateLineButtons(), FixSessionId(c, webphone_api.global.ep[r][EP_SESSID])
                }
            }
            if (t.length > 0) for (var r = 0; r < webphone_api.global.ep.length; r++) if (isNull(webphone_api.global.ep[r]) || webphone_api.global.ep[r].length < 5) {
                var s = "NULL";
                isNull(webphone_api.global.ep[r]) || (s = webphone_api.global.ep[r].toString()), PutToDebugLog(2, "ERROR, common: GetCallSession remove invalid endpoint_2: " + s), webphone_api.global.ep.splice(r, 1), r--
            } else {
                var u = webphone_api.global.ep[r][EP_DESTNR];
                if (u == t && "true" !== webphone_api.global.ep[r][EP_FLAGDEL] && !isNull(webphone_api.global.ep[r][EP_SESSION] || getuseengine() !== webphone_api.global.ENGINE_WEBRTC)) {
                    var c = webphone_api.global.ep[r][EP_SESSION];
                    return e && (webphone_api.global.ep[r][EP_FLAGDEL] = "true"), !1 === IsSDK() && !0 === webphone_api.global.isCallStarted && webphone_api._call.UpdateLineButtons(), FixSessionId(c, webphone_api.global.ep[r][EP_SESSID])
                }
            }
            PutToDebugLog(2, "WARNING, common: GetCallSession returning guessed session");
            var c = webphone_api.global.ep[0][EP_SESSION];
            return e && (webphone_api.global.ep[0][EP_FLAGDEL] = "true"), !1 === IsSDK() && !0 === webphone_api.global.isCallStarted && webphone_api._call.UpdateLineButtons(), FixSessionId(c, webphone_api.global.ep[0][EP_SESSID])
        } catch (h) {
            PutToDebugLogException(2, "common: GetCallSession", h)
        }
    }

    function FixSessionId(e, o) {
        return e
    }

    function GetEndpoint(e, o, t, n) {
        try {
            if ((isNull(e) || e.length < 1) && (e = webphone_api.global.aline), e = Trim(e), e = e.toString(), isNull(o) && (o = ""), o = Trim(o), (isNull(t) || t.length < 1) && (t = ""), t = Trim(t), t = t.toLowerCase(), isNull(webphone_api.global.ep) || webphone_api.global.ep.length < 1) return !1 === IsSDK() && !0 === webphone_api.global.isCallStarted && webphone_api._call.UpdateLineButtons(), webphone_api.global.aline = 1, null;
            for (var i = 0; i < webphone_api.global.ep.length; i++) if (!(isNull(webphone_api.global.ep[i]) || webphone_api.global.ep[i].length < 5)) {
                var a = webphone_api.global.ep[i][EP_LINE], r = webphone_api.global.ep[i][EP_CALLID];
                if (a == e || !isNull(r) && r.length > 0 && r == t) {
                    var s = webphone_api.global.ep[i];
                    if (!0 === n) {
                        if (webphone_api.global.ep.length < 2 && webphone_api.global.ep[i][EP_DISCONNECTTIME].toString().length < 4) return s;
                        var l = "NULL";
                        isNull(webphone_api.global.ep[i]) || (l = webphone_api.global.ep[i].toString()), !isNull(l) && l.length > 550 && (l = l.substring(0, 550)), PutToDebugLog(2, "EVENT, common: GetEndpoint remove OLD endpoint_1: " + l), webphone_api.global.ep.splice(i, 1)
                    }
                    return !1 === IsSDK() && !0 === webphone_api.global.isCallStarted && webphone_api._call.UpdateLineButtons(), (isNull(webphone_api.global.ep) || webphone_api.global.ep.length < 1) && (webphone_api.global.aline = 1), s
                }
            }
            if (o.length > 0) for (var i = 0; i < webphone_api.global.ep.length; i++) if (!(isNull(webphone_api.global.ep[i]) || webphone_api.global.ep[i].length < 5)) {
                var p = webphone_api.global.ep[i][EP_DESTNR];
                if (p == o) {
                    var s = webphone_api.global.ep[i];
                    if (!0 === n) {
                        if (webphone_api.global.ep.length < 2 && webphone_api.global.ep[i][EP_DISCONNECTTIME].toString().length < 4) return s;
                        var a = webphone_api.global.ep[i][EP_LINE];
                        if (a == e) {
                            var l = "NULL";
                            isNull(webphone_api.global.ep[i]) || (l = webphone_api.global.ep[i].toString()), !isNull(l) && l.length > 550 && (l = l.substring(0, 550)), PutToDebugLog(2, "EVENT, common: GetEndpoint remove OLD endpoint_2: " + l), webphone_api.global.ep.splice(i, 1)
                        }
                    }
                    return !1 === IsSDK() && !0 === webphone_api.global.isCallStarted && webphone_api._call.UpdateLineButtons(), (isNull(webphone_api.global.ep) || webphone_api.global.ep.length < 1) && (webphone_api.global.aline = 1), s
                }
            }
            (isNull(webphone_api.global.ep) || webphone_api.global.ep.length < 1) && (webphone_api.global.aline = 1)
        } catch (c) {
            PutToDebugLogException(2, "common: GetEndpoint", c)
        }
        return null
    }

    function GetFreeLine() {
        try {
            for (var e = [], o = [], t = 0; t < webphone_api.global.ep.length; t++) {
                var n = webphone_api.global.ep[t][EP_LINE];
                if (!isNull(n) && !1 !== IsNumber(n)) {
                    var i = StrToInt(n);
                    i > 0 && (e.push(i), o.push(StrToInt(webphone_api.global.ep[t][EP_SETUPTIME])))
                }
            }
            for (var t = 0; t < e.length; t++) for (var a = t + 1; a < e.length; a++) if (e[t] > e[a]) {
                var r = e[t];
                e[t] = e[a], e[a] = r, r = o[t], o[t] = o[a], o[a] = r
            }
            for (var s = GetTickCount(), l = 1, t = 0; t < e.length; t++) e[t] === l && o[t] > 0 && s - o[t] > 1500 && l++;
            return PutToDebugLog(2, "EVENT, GetFreeLine returned: " + l.toString()), l
        } catch (p) {
            PutToDebugLogException(2, "common: GetFreeLine", p)
        }
        return webphone_api.global.aline + 1
    }

    function IsLineFree(e) {
        try {
            if (e < 1) return !1;
            for (var o = 0; o < webphone_api.global.ep.length; o++) {
                var t = webphone_api.global.ep[o][EP_LINE];
                if (!isNull(t) && !1 !== IsNumber(t)) {
                    var n = StrToInt(t);
                    if (t = t.toString(), e = e.toString(), n > 0 && t === e) return !1
                }
            }
        } catch (i) {
            PutToDebugLogException(2, "common: GetFreeLine", i)
        }
        return !0
    }

    function GetBestLine() {
        var e = -10, o = 0, t = -10;
        try {
            for (var n = 0; n < webphone_api.global.ep.length; n++) {
                var i = webphone_api.global.ep[n];
                if (!(isNull(i) || i.length < 5) && ("false" === i[EP_FLAGDEL] && "true" !== i[EP_FINISHEDSENT] && i[EP_DISCONNECTTIME].toString().length < 4)) {
                    var a = StrToInt(i[EP_LINE]);
                    IsNumber(i[EP_SETUPTIME]) && (o = StrToInt(i[EP_SETUPTIME])), a > 0 && (a === webphone_api.global.aline && (t = a), e > 0 ? 0 >= o && (e = a, o = 0) : (e = a, o = 0))
                }
            }
            if (t > 0) return t;
            if (e > 0) return e
        } catch (r) {
            PutToDebugLogException(2, "common: GetBestLine", r)
        }
        return webphone_api.global.aline
    }

    function GetNrOfActiveCalls() {
        try {
            for (var e = 0, o = 0; o < webphone_api.global.ep.length; o++) {
                var t = webphone_api.global.ep[o][EP_DISCONNECTTIME];
                isNull(t) || (t = t.toString(), t.length < 3 && e++)
            }
            return e
        } catch (n) {
            PutToDebugLogException(2, "common: GetNrOfActiveCalls", n)
        }
        return webphone_api.global.acallcount
    }

    function RefreshInfo() {
        try {
            if (!0 === IsSDK() || !1 === webphone_api.global.isCallStarted) return;
            var e = GetEndpoint(webphone_api.global.aline, "", "", !1);
            if (isNull(e) || e.length < 5) return;
            var o = e[EP_DESTNR], t = "";
            !isNull(o) && o.length > 0 && (t = GetContactNameFromNumber(o), isNull(t) && (t = "")), t === o && (t = ""), t.length > 0 ? webphone_api.$("#calledcaller").html(t + "&nbsp;(" + o + ")&nbsp;") : webphone_api.$("#calledcaller").html(o);
            var n = e[EP_SETUPTIME], i = e[EP_CONNECTTIME];
            "undefined" != typeof webphone_api.notifications && null !== webphone_api.notifications ? isNull(i) || i.length < 3 ? !isNull(n) && n.toString().length > 2 && IsNumber(n) && webphone_api.notifications.SetCallStartTime(StrToInt(n)) : i.toString().length > 2 && IsNumber(i) && webphone_api.notifications.SetCallStartTime(StrToInt(i)) : console && console.log && console.log("ERROR, common RefreshInfo webphone_api.notifications is not defined");
            var a = document.getElementById("mute_status"), r = document.getElementById("hold_status");
            if (isNull(a) || (!0 === GetMuteState(StrToInt(e[EP_LINE])) ? webphone_api.$(a).hasClass("callfunc_status_on") || webphone_api.$(a).addClass("callfunc_status_on") : webphone_api.$(a).hasClass("callfunc_status_on") && webphone_api.$(a).removeClass("callfunc_status_on")), isNull(r) || (!0 === GetHoldState(StrToInt(e[EP_LINE])) ? webphone_api.$(r).hasClass("callfunc_status_on") || webphone_api.$(r).addClass("callfunc_status_on") : webphone_api.$(r).hasClass("callfunc_status_on") && webphone_api.$(r).removeClass("callfunc_status_on")), !isNull(e) && e.length > 4) {
                var s = !0;
                i.toString().length > 2 && IsNumber(i) && (s = !1);
                var l = !1;
                "2" != e[EP_INCOMING] && 2 != e[EP_INCOMING] || (l = !0);
                var p = !1;
                "true" != e[EP_FINISHEDSENT] && 1 != e[EP_FINISHEDSENT] || (p = !0), !0 === l && !0 === s && !1 === p ? (webphone_api.$("#hangup_layout").hide(), webphone_api.$("#callfunctions_layout").hide(), webphone_api.global.ep.length > 1 ? (webphone_api.$("#acceptreject_layout").hide(), webphone_api.$("#mline_layout").show()) : (webphone_api.$("#mline_layout").hide(), webphone_api.$("#acceptreject_layout").show())) : (webphone_api.$("#acceptreject_layout").hide(), webphone_api.$("#mline_layout").hide(), webphone_api.$("#hangup_layout").show(), webphone_api.$("#callfunctions_layout").show())
            }
        } catch (c) {
            PutToDebugLogException(2, "common: RefreshInfo", c)
        }
    }

    function GetReqId() {
        try {
            return reqid_cached > 0 ? reqid_cached += 1 : reqid_cached = RandomInt(5e3, 9999999)
        } catch (e) {
            PutToDebugLogException(2, "common: GetReqId", e)
        }
        return GetTickCount()
    }

    function IsMultiline() {
        try {
            var e = GetParameter2("multilinegui");
            if (isNull(e) || e.length < 1) return -1;
            if (IsNumber(e) && StrToInt(e), "true" === e.toLowerCase() || "1" == e) return 1;
            if ("false" === e.toLowerCase()) return 0
        } catch (o) {
            PutToDebugLogException(2, "common: GetReqId", o)
        }
        return -1
    }

    function GetTelsearchName(e, o) {
        try {
            var t = GetParameter2("telsearchurl");
            if ((isNull(t) || t.length < 3) && (t = webphone_api.parameters.telsearchurl), isNull(t) || t.length < 3) return PutToDebugLog(2, "ERROR, GetTelsearchName invalid search url: " + t), void o("invalid search url: " + t);
            var n = NormalizeNumber(e);
            n = encodeURIComponent(n), t = t.replace("DESTINATION", n), telshearchcb.push(o), UriParser(t, "", "", "", "", "telsearchname")
        } catch (i) {
            PutToDebugLogException(2, "common: GetTelsearchName", i)
        }
    }

    function TelSearchNameReceived(e) {
        try {
            if (isNull(e) || e.length < 10) return void PutToDebugLog(2, "ERROR, TelSearchNameReceived invalid data: " + e);
            PutToDebugLog(5, "EVENT,TelSearchNameReceived: " + e);
            var o = e.indexOf("<tel:name>");
            if (o > 0) {
                e = e.substring(o + 10), o = e.indexOf("</tel:name>"), o > 0 && (e = e.substring(0, o)), isNull(e) && (e = ""), e = Trim(e);
                var t = telshearchcb.shift();
                isNull(t) || "function" != typeof t || (PutToDebugLog(2, "EVENT, TelSearchNameReceived name found: " + e), t(e))
            }
        } catch (n) {
            PutToDebugLogException(2, "common: TelSearchNameReceived", n)
        }
    }

    function GetIceTimeout() {
        try {
            var e = GetParameter("icetimeout");
            if (isNull(webphone_api.parameters.icetimeout) || (e = webphone_api.parameters.icetimeout), !isNull(e) && IsNumber(e)) {
                var o = StrToInt(e);
                if (!isNull(o) && o > 0) return o < 30 && (o *= 1e3), o
            }
        } catch (t) {
            PutToDebugLogException(2, "common: GetIceTimeout", t)
        }
        return 2e3
    }

    function ResetIce() {
        try {
            webphone_api.global.ice_callaccepted = !1, webphone_api.global.icecompleted = !1, isNull(webphone_api.global.ice_timer) || clearInterval(webphone_api.global.ice_timer), webphone_api.global.ice_timer = null
        } catch (e) {
            PutToDebugLogException(2, "common: ResetIce", e)
        }
    }

    function GetNativeDialerUrl(e) {
        var o = "";
        try {
            return isNull(e) || e.length < 1 ? (PutToDebugLog(2, "ERROR, GetNativeDialerUrl invalid OS"), "") : ("iOS" === e ? (o = GetParameter2("ios_nativedialerurl"), (isNull(o) || o.length < 3) && (o = "https://itunes.apple.com/us/app/mizuphone/id483685573")) : (o = GetParameter2("android_nativedialerurl"), (isNull(o) || o.length < 3) && (o = "https://play.google.com/store/apps/details?id=com.mizuvoip.mizudroid.app")), o)
        } catch (t) {
            PutToDebugLogException(2, "common: ResetIce", t)
        }
        return ""
    }

    function GetSessionId() {
        try {
            return isNull(sessionid_cache) ? (sessionid_cache = RandomInt(1e3, 9999999).toString(), sessionid_cache += GetTickCount().toString()) : sessionid_cache
        } catch (e) {
            PutToDebugLogException(2, "common: GetSessionId", e)
        }
        return "1122334455"
    }

    function SetElementsSrc() {
        try {
            if (!0 === IsSDK()) return;
            var e = document.getElementById("phone_app_main_container");
            if (isNull(e)) return void PutToDebugLog(2, "ERROR, common: SetElementsSrc app container is NULL");
            var o = webphone_api.getbasedir2();
            if (isNull(o)) return void PutToDebugLog(2, "ERROR, common: SetElementsSrc base dir is NULL");
            var t = e.getElementsByTagName("img");
            if (isNull(t) || t.length < 1) return void PutToDebugLog(2, "ERROR, common: SetElementsSrc image list is NULL");
            for (var n = 0, i = t.length, a = 0; a < i; a++) if (!isNull(t[a])) {
                var r = t[a].src;
                isNull(r) || r.indexOf("images/") < 0 || (r = r.substring(r.indexOf("images/")), t[a].src = o + r, n++)
            }
            PutToDebugLog(2, "EVENT, common: SetElementsSrc for: " + n.toString() + " images");
            var s = document.getElementById("android_frame");
            isNull(s) || isNull(s.style.background) || (s.style.background = "url(" + o + "images/android_frame.png) no-repeat #ffffff")
        } catch (l) {
            PutToDebugLogException(2, "common: SetElementsSrc", l)
        }
    }

    function GetElementSource() {
        try {
            return isNull(elem_basedir) ? (elem_basedir = webphone_api.getbasedir2(), isNull(elem_basedir) && (elem_basedir = ""), elem_basedir) : elem_basedir
        } catch (e) {
            PutToDebugLogException(2, "common: GetElementSource", e)
        }
        return ""
    }

    function PlayDtmfSound(e) {
        var o = 0;
        try {
            if (isNull(e)) return;
            if (playdtmfsound < 0 && (playdtmfsound = GetParameterInt("playdtmfsound", 1)), playdtmfsound < 1) return;
            e = Trim(e);
            var t = IsWebphoneInIframe();
            if (!0 === t && "Edge" === GetBrowser()) return;
            if (e.length > 1 && playdtmfsound < 2) return;
            if (!window.HTMLAudioElement) return void PutToDebugLog(2, "WARNING, PlayDtmfSound audio html element not supported in this browser: " + GetBrowser());
            if ("*" === e ? e = "x" : "#" === e && (e = "y"), !0 === t) {
                if (isNull(document.getElementById("dtmfsound" + e))) {
                    var n = webphone_api.getbasedir2(), i = e;
                    "y" === i && (i = "diez");
                    var a = '<audio id="dtmfsound' + e + '"><source src="' + n + "sound/DTMF" + i + '.ogg" type="audio/ogg"><source src="' + n + "sound/DTMF" + i + '.mp3" type="audio/mpeg"></audio>';
                    webphone_api.$("body").append(a)
                }
            } else if (isNull(document.getElementById("dtmfsound0"))) {
                var n = webphone_api.getbasedir2(),
                    r = '<audio id="dtmfsound0"><source src="' + n + 'sound/DTMF0.ogg" type="audio/ogg"><source src="' + n + 'sound/DTMF0.mp3" type="audio/mpeg"></audio><audio id="dtmfsound1"><source src="' + n + 'sound/DTMF1.ogg" type="audio/ogg"><source src="' + n + 'sound/DTMF1.mp3" type="audio/mpeg"></audio><audio id="dtmfsound2"><source src="' + n + 'sound/DTMF2.ogg" type="audio/ogg"><source src="' + n + 'sound/DTMF2.mp3" type="audio/mpeg"></audio><audio id="dtmfsound3"><source src="' + n + 'sound/DTMF3.ogg" type="audio/ogg"><source src="' + n + 'sound/DTMF3.mp3" type="audio/mpeg"></audio><audio id="dtmfsound4"><source src="' + n + 'sound/DTMF4.ogg" type="audio/ogg"><source src="' + n + 'sound/DTMF4.mp3" type="audio/mpeg"></audio><audio id="dtmfsound5"><source src="' + n + 'sound/DTMF5.ogg" type="audio/ogg"><source src="' + n + 'sound/DTMF5.mp3" type="audio/mpeg"></audio><audio id="dtmfsound6"><source src="' + n + 'sound/DTMF6.ogg" type="audio/ogg"><source src="' + n + 'sound/DTMF6.mp3" type="audio/mpeg"></audio><audio id="dtmfsound7"><source src="' + n + 'sound/DTMF7.ogg" type="audio/ogg"><source src="' + n + 'sound/DTMF7.mp3" type="audio/mpeg"></audio><audio id="dtmfsound8"><source src="' + n + 'sound/DTMF8.ogg" type="audio/ogg"><source src="' + n + 'sound/DTMF8.mp3" type="audio/mpeg"></audio><audio id="dtmfsound9"><source src="' + n + 'sound/DTMF9.ogg" type="audio/ogg"><source src="' + n + 'sound/DTMF9.mp3" type="audio/mpeg"></audio><audio id="dtmfsoundy"><source src="' + n + 'sound/DTMFdiez.ogg" type="audio/ogg"><source src="' + n + 'sound/DTMFdiez.mp3" type="audio/mpeg"></audio><audio id="dtmfsoundx"><source src="' + n + 'sound/DTMFx.ogg" type="audio/ogg"><source src="' + n + 'sound/DTMFx.mp3" type="audio/mpeg"></audio>';
                webphone_api.$("body").append(r)
            }
            o = 5, e = ReplaceAll(e, " ", "");
            var s = e.split("");
            o = 6, isNull(playtimer) || clearInterval(playtimer), playtimer = null;
            var l = 0;
            o = 7, playtimer = setInterval(function () {
                try {
                    if (o = 8, l >= s.length) return o = 9, isNull(playtimer) || clearInterval(playtimer), void (playtimer = null)
                        ;
                    if (e = s[l], l++, o = 10, isNull(audioElem)) {
                        if (o = 11, audioElem = document.getElementById("dtmfsound" + e), o = 12, isNull(audioElem)) return o = 13, void PutToDebugLog(2, "ERROR, PlayDtmfSound cannot get reference to audio element a");
                        o = 14, audioElem.load(), o = 15, audioElem.play(), o = 16
                    } else {
                        if (o = 20, audioElem.pause(), o = 21, "undefined" != typeof audioElem.currentTime && null !== audioElem.currentTime && (audioElem.currentTime = 0), o = 22, audioElem = document.getElementById("dtmfsound" + e), o = 23, isNull(audioElem)) return o = 24, void PutToDebugLog(2, "ERROR, PlayDtmfSound cannot get reference to audio element b");
                        o = 25, audioElem.load(), o = 26;
                        try {
                            "undefined" != typeof audioElem.currentTime && null !== audioElem.currentTime && (audioElem.currentTime = 0)
                        } catch (t) {
                        }
                        o = 27, audioElem.play(), o = 28
                    }
                } catch (n) {
                    PutToDebugLogException(2, "common: PlayDtmfSound inner Timer (" + o.toString() + ")", n)
                }
            }, 300)
        } catch (p) {
            PutToDebugLogException(2, "common: PlayDtmfSound", p)
        }
    }

    function GetLogLevel() {
        var e = 1;
        try {
            var o = GetParameter("loglevel"), t = webphone_api.parameters.loglevel;
            return !isNull(o) && 1 === o.length && IsNumber(o) || (o = "1"), !isNull(t) && 1 === t.toString().length && IsNumber(t) || (t = "1"), StrToInt(o) > e && (e = StrToInt(o)), (StrToInt(t) > e || 0 === StrToInt(t)) && (e = StrToInt(t)), e
        } catch (n) {
            PutToDebugLogException(2, "common: GetLogLevel", n)
        }
        return 1
    }

    function GetHoldState(e) {
        try {
            e = StrToInt(e), e < 1 && (e = GetBestLine()), e = StrToInt(e);
            for (var o = 0; o < webphone_api.global.ep.length; o++) {
                if (StrToInt(webphone_api.global.ep[o][EP_LINE]) === e) {
                    var t = webphone_api.global.ep[o][EP_HOLDSTATE];
                    return "true" != t && "false" != t && PutToDebugLog(2, "ERROR, GetHoldState invalid state: " + t.toString()), "true" == t
                }
            }
        } catch (n) {
            PutToDebugLogException(2, "common: GetHoldState", n)
        }
        return !1
    }

    function GetMuteState(e) {
        try {
            e = StrToInt(e), e < 1 && (e = GetBestLine()), e = StrToInt(e);
            for (var o = 0; o < webphone_api.global.ep.length; o++) {
                if (StrToInt(webphone_api.global.ep[o][EP_LINE]) === e) {
                    var t = webphone_api.global.ep[o][EP_MUTESTATE];
                    return "true" != t && "false" != t && PutToDebugLog(2, "ERROR, GetMuteState invalid state: " + t.toString()), "true" == t
                }
            }
        } catch (n) {
            PutToDebugLogException(2, "common: GetMuteState", n)
        }
        return !1
    }

    function SetHoldState(e, o) {
        try {
            if (e < 1 && (e = GetBestLine()), e = StrToInt(e), isNull(o) && (o = ""), "true" !== (o = o.toString()) && "false" !== o) return PutToDebugLog(2, "ERROR, SetHoldState invalid state value: " + o), !1;
            for (var t = !1, n = 0; n < webphone_api.global.ep.length; n++) {
                StrToInt(webphone_api.global.ep[n][EP_LINE]) === e && (t = !0, webphone_api.global.ep[n][EP_HOLDSTATE] = o)
            }
            if (!1 === t) return PutToDebugLog(2, "ERROR, SetHoldState cannot find endpoint for line: " + e.toString()), !1
        } catch (i) {
            PutToDebugLogException(2, "common: SetHoldState", i)
        }
        return !0
    }

    function SetMuteState(e, o) {
        try {
            if (e < 1 && (e = GetBestLine()), e = StrToInt(e), isNull(o) && (o = ""), "true" !== (o = o.toString()) && "false" !== o) return PutToDebugLog(2, "ERROR, SetMuteState invalid state value: " + o), !1;
            for (var t = !1, n = 0; n < webphone_api.global.ep.length; n++) {
                StrToInt(webphone_api.global.ep[n][EP_LINE]) === e && (t = !0, webphone_api.global.ep[n][EP_MUTESTATE] = o)
            }
            if (!1 === t) return PutToDebugLog(2, "ERROR, SetMuteState cannot find endpoint for line: " + e.toString()), !1
        } catch (i) {
            PutToDebugLogException(2, "common: SetMuteState", i)
        }
        return !0
    }

    function IsIncomingCall(e) {
        try {
            e = StrToInt(e), e < 1 && (e = GetBestLine()), e = StrToInt(e);
            for (var o = 0; o < webphone_api.global.ep.length; o++) {
                if (StrToInt(webphone_api.global.ep[o][EP_LINE]) === e) {
                    var t = webphone_api.global.ep[o][EP_INCOMING];
                    if ("1" == t) return !1;
                    if ("2" == t) return !0
                }
            }
        } catch (n) {
            PutToDebugLogException(2, "common: IsIncomingCall", n)
        }
        return webphone_api.global.incommingCall
    }

    function GetDiscReasonFromSignaling(e) {
        function o(e) {
            try {
                if (isNull(e)) return "";
                var o = e.indexOf("text=");
                if (o >= 0) return e = Trim(e.substring(o + 5, e.length)), o = e.indexOf('"'), o < 3 && (e = e.substring(o + 1, e.length)), o = e.indexOf('"'), o > 0 && (e = e.substring(0, o)), e = Trim(e);
                if ((o = e.indexOf('"')) >= 0 && (e = e.substring(o + 1, e.length), (o = e.indexOf('"')) !== e.lastIndexOf('"'))) return e = e.substring(o + 1, e.length), o = e.indexOf('"'), o > 0 && (e = e.substring(0, o)), isNull(e) && (e = ""), Trim(e)
            } catch (t) {
                PutToDebugLogException(2, "notifications: GetText", t)
            }
            return ""
        }

        try {
            PutToDebugLog(2, "EVENT, mlogic API_Getsipheader GetDiscReasonFromSignaling 1"), webphone_api.getsipheader("X-reason", function (t) {
                var n = o(t);
                if (n.length > 0) return void e(n);
                PutToDebugLog(2, "EVENT, mlogic API_Getsipheader GetDiscReasonFromSignaling 2"), webphone_api.getsipheader("Reason", function (t) {
                    var n = o(t);
                    if (n.length > 0) return void e(n);
                    PutToDebugLog(2, "EVENT, mlogic API_Getsipheader GetDiscReasonFromSignaling 3"), webphone_api.getsipheader("Warning", function (t) {
                        var n = o(t);
                        e(n)
                    })
                })
            })
        } catch (t) {
            PutToDebugLogException(2, "common: GetDiscReasonFromSignaling", t), e("")
        }
    }

    function onc() {
        try {
            if (!LcAc(!1, !0)) return !1;
            if (Te()) {
                var e = [];
                e.push("T"), e.push("r"), e.push("i"), e.push("a"), e.push("l"), e.push(" "), e.push("e"), e.push("x"), e.push("p"), e.push("i"), e.push("r"), e.push("e"), e.push("d");
                var o = e.join("");
                return setTimeout(function () {
                    PutToDebugLog(1, "ERROR, " + o)
                }, 1050), setTimeout(function () {
                    PutToDebugLog(1, "ERROR, " + o), ShowToast("ERROR, " + o, 15e3)
                }, 2050), !1
            }
            if (GtUct() < 1 && GtUc().length > 0) {
                var e = [];
                e.push("T"), e.push("r"), e.push("i"), e.push("a"), e.push("l"), e.push(" "), e.push("e"), e.push("x"), e.push("p"), e.push("i"), e.push("r"), e.push("e"), e.push("d"), e.push("_"), e.push("8");
                var o = e.join("");
                return setTimeout(function () {
                    PutToDebugLog(1, "ERROR, " + o)
                }, 1010), !1
            }
            return !0
        } catch (t) {
            PutToDebugLogException(2, "common: onc", t)
        }
        return !1
    }

    function HandleScurlSetparameters() {
        try {
            if (!0 === scurlsp_called) return;
            if (scurlsp_called = !0, !isNull(webphone_api) && !isNull(webphone_api.parameters)) var e = webphone_api.parameters.scurl_setparameters;
            !isNull(e) && e.length > 3 && (CallScriptingUrl(webphone_api.parameters.scurl_setparameters, "setParameters", "", "", "", "", "waitforparameters"), setTimeout(function () {
                !1 === webphone_api.global.startendelayed_wascalled && (PutToDebugLog(2, "WARNING, StartEngine: waiting for parameters timeout, start engine anyway"), PutToDebugLog(2, "EVENT, mlogic API_Start HandleScurlSetparameters"), webphone_api.start())
            }, 10500))
        } catch (o) {
            PutToDebugLogException(2, "common: HandleScurlSetparameters", o)
        }
    }

    function ParseSipAccounts() {
        try {
            webphone_api.global.sipaccounts = [];
            var e = GetParameter("extraregisteraccounts");
            if (isNull(e) || e.length < 3) return;
            var o = e.split("#");
            if (!isNull(o) && o.length > 0) {
                for (var t = 0; t < o.length; t++) o[t].length < 1 && (o.splice(t, 1), t--);
                if (isNull(o) || o.length < 1) return;
                if (1 === o.length) {
                    var n = o[0].split(",");
                    if (!isNull(n) && n.length > 3) {
                        var i = GetParameter("serveraddress_user");
                        (isNull(i) || i.length < 1) && (i = GetParameter("serveraddress"));
                        var a = GetSipusername(), r = GetParameter("password"), s = !1;
                        if (!isNull(i) && i.length > 0 && !isNull(n[ACC_SERVER]) && n[ACC_SERVER].length > 0 && i !== n[ACC_SERVER] && "[MAIN]" + i !== n[ACC_SERVER] && (n[ACC_SERVER] = i, s = !0), !isNull(a) && a.length > 0 && !isNull(n[ACC_USER]) && n[ACC_USER].length > 0 && a !== n[ACC_USER] && (n[ACC_USER] = a, s = !0), !isNull(r) && r.length > 0 && !isNull(n[ACC_PASSWORD]) && n[ACC_PASSWORD].length > 0 && r !== n[ACC_PASSWORD] && (n[ACC_PASSWORD] = r, s = !0), !0 === s) return PutToDebugLog(2, "EVENT, ParseSipAccounts handling special case"), e = n.join(","), void SaveParameter("extraregisteraccounts", e)
                    }
                }
                PutToDebugLog(2, "EVENT, ParseSipAccounts extraregisteraccounts: " + e);
                for (var l = !0, p = 0; p < o.length; p++) if (!(isNull(o[p]) || o[p].length < 4)) {
                    var c = o[p].split(",");
                    if (!(isNull(c) || c.length < 4)) {
                        var u = c[ACC_SERVER], h = "", m = "", g = "", d = "";
                        if (c.length > ACC_CALLERID && (h = c[ACC_CALLERID]), c.length > ACC_DISPLAYNAME && (m = c[ACC_DISPLAYNAME]), c.length > ACC_PROXY && (g = c[ACC_PROXY]), c.length > ACC_REALM && (d = c[ACC_REALM]), isNull(h) && (h = ""), isNull(m) && (m = ""), isNull(g) && (g = ""), isNull(d) && (d = ""), !isNull(u) && u.indexOf("[MAIN]") >= 0) {
                            u = u.replace("[MAIN]", ""), l = !0, SaveParameter("serveraddress_user", u);
                            var h = GetParameter("username");
                            GetParameter("sipusername");
                            GetParameter("username").length > 0 && GetParameter("sipusername").length < 1 ? SaveParameter("username", c[ACC_USER]) : SaveParameter("sipusername", c[ACC_USER]), SaveParameter("password", c[ACC_PASSWORD]);
                            for (var t = 0; t < webphone_api.global.sipaccounts.length; t++) webphone_api.global.sipaccounts[t].ismain = !1
                        }
                        var b = new ClassSipAccounts, _ = !0;
                        !isNull(u) && u.indexOf("[DISABLED]") >= 0 ? (u = u.replace("[DISABLED]", ""), _ = !1) : c.length >= ACC_ENABLED && "false" === c[ACC_ENABLED] && (_ = !1), b.enabled = _, b.serveraddress = u, b.username = c[ACC_USER], b.password = c[ACC_PASSWORD];
                        var f = 3600;
                        c.length >= ACC_IVAL && !isNull(c[ACC_IVAL]) && IsNumber(c[ACC_IVAL]) && (f = c[ACC_IVAL]), b.ival = StrToInt(f), b.ismain = !0 === l, l = !1, b.callerid = h, b.displayname = m, b.proxyaddress = g, b.realm = d, webphone_api.global.sipaccounts.push(b)
                    }
                }
            }
            return
        } catch (w) {
            PutToDebugLogException(2, "common: ParseSipAccounts", w)
        }
        webphone_api.global.sipaccounts = []
    }

    function SaveSipAccounts() {
        try {
            if (isNull(webphone_api.global.sipaccounts) || webphone_api.global.sipaccounts.length < 1) return void SaveParameter("extraregisteraccounts", "");
            for (var e = "", o = 0; o < webphone_api.global.sipaccounts.length; o++) {
                var t = webphone_api.global.sipaccounts[o];
                if (!(isNull(t) || t.length < 4)) {
                    if (e.length > 0 && (e += "#"), !0 === t.ismain && (e += "[MAIN]"), !1 === t.enabled && (e += "[DISABLED]"), !0 === t.ismain) {
                        var n = t.serveraddress, i = t.username, a = t.password, r = t.ival, s = t.callerid,
                            l = t.displayname, p = t.proxyaddress, c = t.realm;
                        if (isNull(n) && (n = ""), isNull(i) && (i = ""), isNull(a) && (a = ""), isNull(r) && (r = ""), isNull(s) && (s = ""), isNull(l) && (l = ""), isNull(p) && (p = ""), isNull(c) && (c = ""), n.length > 0 && SaveParameter("serveraddress_user", n), a.length > 0 && SaveParameter("password", a), r.length > 0 && IsNumber(r) && SaveParameter("registerinterval", r), l.length > 0 && SaveParameter("displayname", l), p.length > 0 && SaveParameter("proxyaddress", p), c.length > 0 && SaveParameter("realm", c), i.length > 0) {
                            var u = !1;
                            GetParameter("sipusername").length > 0 && (SaveParameter("sipusername", i), u = !0), GetParameter("username").length > 0 && !isNull(s) && s.length > 0 && (SaveParameter("username", s), u = !0), u || SaveParameter("username", i), s.length > 0 && GetParameter("sipusername").length > 0 && GetParameter("username").length > 0 && SaveParameter("username", s)
                        }
                    }
                    e = e + t.serveraddress + "," + t.username + "," + t.password + "," + t.ival + "," + t.callerid + "," + t.displayname + "," + t.proxyaddress + t.realm
                }
            }
            SaveParameter("extraregisteraccounts", e)
        } catch (h) {
            PutToDebugLogException(2, "common: SaveSipAccounts", h)
        }
    }

    function AddOneAcc(e, o, t, n, i, a, r, s, l, p, c) {
        try {
            if (webphone_api.common.isNull(webphone_api.global.sipaccounts) && (webphone_api.global.sipaccounts = []), isNull(o) || o.length < 1 || isNull(t) || t.length < 1) return void PutToDebugLog(2, "ERROR, AddOneAcc invalid username: " + o + "; or password: " + t);
            if ((isNull(n) || !1 === IsNumber(n)) && (n = "3600"), isNull(s) && (s = ""), isNull(l) && (l = ""), isNull(p) && (p = ""), isNull(c) && (c = ""), !0 === r && 1 === webphone_api.global.sipaccounts.length) {
                webphone_api.global.sipaccounts = [];
                var u = new webphone_api.common.ClassSipAccounts;
                return u.serveraddress = e, u.username = o, u.password = t, u.ival = webphone_api.common.StrToInt(n), u.enabled = i, u.ismain = !0, webphone_api.global.sipaccounts.push(u), void SaveSipAccounts()
            }
            for (var h = !1, m = 0; m < webphone_api.global.sipaccounts.length; m++) if (!webphone_api.common.isNull(webphone_api.global.sipaccounts[m]) && webphone_api.global.sipaccounts[m].username === o && webphone_api.global.sipaccounts[m].password === t) {
                var g = webphone_api.global.sipaccounts[m].serveraddress;
                if (webphone_api.common.isNull(g) && (g = ""), webphone_api.common.isNull(e) && (e = ""), g === e) {
                    webphone_api.global.sipaccounts[m].serveraddress = e, webphone_api.global.sipaccounts[m].ival = n, webphone_api.global.sipaccounts[m].enabled = i, webphone_api.global.sipaccounts[m].ismain = a, webphone_api.global.sipaccounts[m].callerid = s, webphone_api.global.sipaccounts[m].displayname = l, webphone_api.global.sipaccounts[m].proxyaddress = p, webphone_api.global.sipaccounts[m].realm = c, h = !0;
                    break
                }
            }
            if (!0 === h) {
                if (!0 === a) for (var m = 0; m < webphone_api.global.sipaccounts.length; m++) webphone_api.common.isNull(webphone_api.global.sipaccounts[m]) || webphone_api.global.sipaccounts[m].username === o && webphone_api.global.sipaccounts[m].password === t || (webphone_api.global.sipaccounts[m].ismain = !1)
            } else {
                var u = new webphone_api.common.ClassSipAccounts;
                u.serveraddress = e, u.username = o, u.password = t, u.ival = webphone_api.common.StrToInt(n), u.enabled = "true" === i || !0 === i, u.ismain = "true" === a || !0 === a, u.callerid = s, u.displayname = l, u.proxyaddress = p, u.realm = c, webphone_api.global.sipaccounts.push(u), PutToDebugLog(2, "EVENT, AddOneAcc: serveraddress:" + e + " username: " + o + " password: " + t + " regival: " + n + " enabled: " + i + " ismain: " + a)
            }
            SaveSipAccounts()
        } catch (d) {
            PutToDebugLogException(2, "common: AddOneAcc", d)
        }
    }

    function GetOtherPartyName(e, o) {
        e > 1 || (PutToDebugLog(2, "EVENT, mlogic API_Getsipheader GetOtherPartyName"), webphone_api.getsipheader("Contact", function (e) {
            try {
                if (isNull(e) || e.length < 1) return;
                var t = e.indexOf("<");
                t > 0 && (e = e.substring(0, t), e = ReplaceAll(e, '"', ""), e = Trim(e), e.length > 0 && e !== o && e !== GetParameter("displayname") && (webphone_api.global.callName = e))
            } catch (n) {
                PutToDebugLogException(2, "common: GetOtherPartyName", n)
            }
        }))
    }

    function GetMaxLogLevel() {
        try {
            if (!isNull(webphone_api.parameters.maxloglevel) && IsNumber(webphone_api.parameters.maxloglevel)) {
                var e = StrToInt(webphone_api.parameters.maxloglevel);
                return e > 1e3 && (e = 1e3), e < 1 && (e = 1), e
            }
        } catch (o) {
            PutToDebugLogException(2, "common: GetMaxLogLevel", o)
        }
        return 1e3
    }

    function HandleOfflineMessages(e) {
        try {
            if (isNull(e) || e.indexOf("XOFFMESSAGE:") < 0) return;
            var o = e.indexOf("XOFFMESSAGE:");
            e = e.substring(o + 12);
            var t = e.split("XOFFMESSAGE:");
            if (!isNull(t) && t.length > 0) for (var n = 0; n < t.length; n++) if (!(isNull(t[n]) || (o = t[n].indexOf(":")) < 0)) {
                var i = Trim(t[n].substring(0, o)), a = Trim(t[n].substring(o + 1));
                "undefined" != typeof webphone_api.notifications && null !== webphone_api.notifications ? webphone_api.notifications.OnMessageReceived(i, a, -1) : console && console.log && console.log("ERROR, common HandleOfflineMessages webphone_api.notifications is not defined")
            }
        } catch (r) {
            PutToDebugLogException(2, "common: HandleOfflineMessages", r)
        }
    }

    function RequestBrowserNotificationPermission(e, o, t, n) {
        try {
            if (!window.Notification || !Notification.permission) return void PutToDebugLog(2, "WARNING,RequestBrowserNotificationPermission: Notification not supported in this environment, browser: " + GetBrowser() + "; os: " + GetOs());
            "granted" !== Notification.permission ? Notification.requestPermission(function (i) {
                "granted" === i || "default" === i ? (PutToDebugLog(2, "EVENT,RequestBrowserNotificationPermission: granted"), e(o, t, n)) : "denied" === i ? PutToDebugLog(2, "EVENT,RequestBrowserNotificationPermission: denied") : (PutToDebugLog(2, "WARNING,RequestBrowserNotificationPermission: " + Notification.permission), e(o, t, n))
            }) : e(o, t, n)
        } catch (i) {
            PutToDebugLogException(2, "common: RequestBrowserNotificationPermission", i)
        }
    }

    function CanUseIncomingCallNot() {
        try {
            if (!0 === IsWindowsSoftphone()) return !1;
            var e = GetParameterInt("incomingcallpopup", 0);
            if (e < 1) return !1;
            if (1 === e) {
                if (!0 === GetParameterBool("autoaccept", !1)) return !1;
                if (getuseengine() !== webphone_api.global.ENGINE_WEBPHONE && !1 === BrowserWindowIsActive()) return !0
            } else {
                if (2 !== e) return 3 === e || (PutToDebugLog(2, "ERROR, incomingcallpopup invalid value: " + e), !1);
                if (getuseengine() !== webphone_api.global.ENGINE_WEBPHONE) return !0
            }
        } catch (o) {
            PutToDebugLogException(2, "common: CanUseIncomingCallNot", o)
        }
        return !1
    }

    function ShowIncomingCallNotification(e, o, t, n, i) {
        try {
            if (!0 === n) return isNull(callnotification) || callnotification.close(), void (callnotification = null);
            if (!CanUseIncomingCallNot()) return;
            RequestBrowserNotificationPermission(function (e, o, t) {
                window.Notification && Notification.permission && "granted" === Notification.permission && (isNull(e) && (e = ""), isNull(o) && (o = ""), isNull(t) && (t = ""), isNull(i) && (i = ""), isNull(callnotification) || callnotification.close(), callnotification = null, callnotification = new Notification(e, {
                    icon: t,
                    body: o,
                    image: i
                }), callnotification.onclick = function () {
                    window.focus(), isNull(callnotification) || callnotification.close(), callnotification = null
                })
            }, e, o, t)
        } catch (a) {
            PutToDebugLogException(2, "common: ShowIncomingCallNotification", a)
        }
    }

    function WebphoneIsLoaded() {
        try {
            HandleBrowserWindowActive(), GetContacts(function (e) {
                PutToDebugLog(4, "EVENT, common: WebphoneIsLoaded GetContacts: " + e)
            }), webphone_api.global.apistartstate = 0, webphone_api.global.apistarttick = 0, webphone_api.global.wnotstartedsession = !1
        } catch (e) {
            PutToDebugLogException(2, "common: WebphoneIsLoaded", e)
        }
    }

    function BrowserWindowIsActive() {
        return !1 !== browserWindowActive
    }

    function HandleBrowserWindowActive() {
        try {
            webphone_api.$(window).focus(function () {
                browserWindowActive = !0
            }).blur(function () {
                browserWindowActive = !1
            })
        } catch (e) {
            PutToDebugLogException(2, "common: HandleBrowserWindowActive", e)
        }
    }

    function DownloadContacts() {
        try {
            ShowToast(webphone_api.stringres.get("sync_message"), 5e3);
            var e = GetParameter("loadcontacts_url");
            if (isNull(e) || e.length < 3) {
                var o = GetSipusername(), t = GetParameter("serveraddress_user");
                !isNull(t) && t.length > 0 && (o = o + "_" + t), o += ".dat", e = "https://www.mizu-voip.com/G/srvct/" + o
            }
            PutToDebugLog(1, "EVENT, " + webphone_api.stringres.get("sync_contacts_started")), UriParser(e, "", "", "", "", "downloadcontacts"), setTimeout(function () {
                cleartimer = !0
            }, 6e4), reloadtimer = setInterval(function () {
                !0 === cleartimer && (clearInterval(reloadtimer), reloadtimer = null), !0 === webphone_api.global.reloadcontactsaftersync && (clearInterval(reloadtimer), reloadtimer = null, webphone_api.global.reloadcontactsaftersync = !1, !0 === webphone_api.global.isContactslistStarted && webphone_api._contactslist.PopulateList(!1))
            })
        } catch (n) {
            PutToDebugLogException(2, "common: DownloadContacts", n)
        }
    }

    function ArrayBufferToString(e) {
        try {
            if (isNull(e)) return "null";
            if ("string" === typeof e) return e.toString();
            var o = "", t = new Uint8Array(e);
            if (isNull(t)) return "null";
            for (var n = t.byteLength, i = 0; i < n; i++) o += String.fromCharCode(t[i]);
            return isNull(o) ? "null" : o
        } catch (a) {
            PutToDebugLogException(2, "common: ArrayBufferToString", a)
        }
        return "null"
    }

    function Translate(e) {
        try {
            if (isNull(e) || e.lenght < 1) return "";
            if (isNull(o)) {
                var o = webphone_api.parameters.language;
                (isNull(o) || 2 !== o.length) && (o = GetConfig("language")), (isNull(o) || 2 !== o.length) && (o = GetParameter("language")), (isNull(o) || 2 !== o.length) && (o = ""), o = o.toLowerCase()
            }
            if (o.length < 1) return e;
            switch (o) {
                case "ru":
                    return webphone_api.translations.TranslateInnerRus(e);
                case "hu":
                    return webphone_api.translations.TranslateInnerHun(e);
                case "ro":
                    return webphone_api.translations.TranslateInnerRo(e);
                case "de":
                    return webphone_api.translations.TranslateInnerDe(e);
                case "it":
                    return webphone_api.translations.TranslateInnerItalian(e);
                case "es":
                    return webphone_api.translations.TranslateInnerSpanish(e);
                case "tr":
                    return webphone_api.translations.TranslateInnerTr(e);
                case "pr":
                case "pt":
                    return webphone_api.translations.TranslateInnerPr(e);
                case "jp":
                    return webphone_api.translations.TranslateInnerJp(e);
                case "fr":
                    return webphone_api.translations.TranslateInnerFr(e)
            }
        } catch (t) {
            PutToDebugLogException(2, "common: Translate", t)
        }
        return e
    }

    function GetAutostart() {
        try {
            var e = GetParameterInt("autostart", 1);
            return !isNull(webphone_api.parameters.autostart) && webphone_api.parameters.autostart.toString().length > 0 && (e = webphone_api.parameters.autostart.toString(), e = Trim(e), "true" === e || "yes" === e ? e = 1 : "false" !== e && "no" !== e || (e = 0)), e = StrToIntDef(e, 1)
        } catch (o) {
            PutToDebugLogException(2, "common: GetAutostart", o)
        }
        return 1
    }

    function CanIUseVideo() {
        try {
            if (!0 === HideSettings("video", webphone_api.stringres.get("sett_display_name_video"), "video", !0)) return !1;
            if (!1 === Glvd()) return !1;
            if ("1" === GetParameter2("video") || "2" === GetParameter2("video") || "-1" === GetParameter2("video") && (getuseengine() === webphone_api.global.ENGINE_WEBRTC || !0 === CanIUseWebRTC() || !0 === IsWindowsSoftphone())) return !0
        } catch (e) {
            PutToDebugLogException(2, "common: CanIUseVideo", e)
        }
        return !1
    }

    function CanIUseScreensharing() {
        try {
            if (!0 === HideSettings("screensharing", "", "screensharing", !0)) return !1;
            if (!1 === Glss()) return !1;
            if ("Android" === GetOs() || "iOS" === GetOs()) return !1;
            if ("Firefox" === GetBrowser() && !1 === IsHttps()) return !1;
            var e = GetParameter2("screensharing");
            if ("2" === e || "1" === e && (getuseengine() === webphone_api.global.ENGINE_WEBRTC || !0 === CanIUseWebRTC() || !0 === IsWindowsSoftphone())) return !0
        } catch (o) {
            PutToDebugLogException(2, "common: CanIUseScreensharing", o)
        }
        return !1
    }

    function SwitchToEngine(e) {
        try {
            PutToDebugLog(2, "EVENT, common: SwitchToEngine: " + e + "; reset useengine"), webphone_api.global.useengine = "";
            var o = GetEngine(e);
            isNull(o) || (o.clicked = 2, SetEngine(e, o), ChooseEngineLogic2(e), EngineSelect(1)), PutToDebugLog(2, "EVENT, mlogic API_Start SwitchToEngine"), webphone_api.start()
        } catch (t) {
            PutToDebugLogException(2, "common: SwitchToEngine", t)
        }
    }

    function ExitVideoMode(e) {
        try {
            if (!1 === IsWindowsSoftphone()) return;
            PutToDebugLog(2, "EVENT, ExitVideoMode: " + e), SwitchToEngine(webphone_api.global.ENGINE_SERVICE);
            1 === GetParameterInt("videomode", 0) && SaveParameter("videomode", "2");
            WinSoftphoneHttpReq(AddJscommport(webphone_api.global.WIN_SOFTPHONE_URL) + "?extcmd_exitvideo", "GET", "", function (e) {
                PutToDebugLog(2, "EVENT, common: Exit response: " + e)
            })
        } catch (o) {
            PutToDebugLogException(2, "common: ExitVideoMode", o)
        }
    }

    function ClassCustomMenus() {
        this.label, this.action, this.data
    }

    function GetCustomMenus() {
        try {
            var e = GetParameter("menu_url");
            if (isNull(e) || e.length < 3) return;
            var o = GetSipusername(), t = GetParameter("password");
            e = e.replace("[USERNAME]", o), e = e.replace("USERNAME", o), e = e.replace("[PASSWORD]", t), e = e.replace("PASSWORD", t), e = e.replace("PWD", t), e = e.replace("DEVICEID", GetDeviceId()), e = e.replace("BRANDNAME", encodeURIComponent(GetBrandName()));
            var n = "http://";
            IsHttps() && (n = "https://");
            var i = "rtc.mizu-voip.com";
            "us" === webphone_api.global.usuk && (i = "usrtcx.webvoipphone.com");
            var a = GetConfig("mainaport");
            !isNull(a) && a.length > 0 && (i.indexOf(":") > 0 && (i = i.substring(0, i.indexOf(":"))), i += a), PutToDebugLog(4, "EVENT, GetCustomMenus url: " + e);
            var r = decodeURIComponent(e);
            r = encodeURIComponent(r);
            var s = n + i + "/mvapireq/jppget?url=" + r + "&callback=?";
            PutToDebugLog(4, "EVENT, GetCustomMenus url JSONP: " + s), webphone_api.$.getJSON(s, function (e) {
                var o = "";
                isNull(e) ? PutToDebugLog(2, "ERROR, HttpRequest GetCustomMenus response is NULL") : o = e.contents, HttpResponseHandler(o, "get_custom_menu")
            })
        } catch (l) {
            PutToDebugLogException(2, "common: GetCustomMenus", l)
        }
    }

    function ProcessCustomMenu(e) {
        try {
            if (webphone_api.global.custmenusL = null, webphone_api.global.custmenusL = [], isNull(e) || e.length < 5) return;
            var o = -1, t = e;
            if (o = t.indexOf("<ERROR>"), o < 0 && (o = t.indexOf("<Error>")), t.toLowerCase().indexOf("disabled") > 0 && o > 0 && (t = t.substring(o + 7), o = t.indexOf("</ERROR>"), o > 0 && (t = t.substring(0, o)), isNull(t) && (t = ""), t = Trim(t), t.length > 0)) return PutToDebugLog(2, "ERROR, ProcessCustomMenu returned error: " + t), PutToDebugLog(1, "ERROR, " + t), void AlertDialog("ERROR", t);
            if ((o = e.indexOf("<PROTOCOL>")) > 0) {
                var n = e.substring(o + 12);
                o = n.indexOf("</PROTOCOL>"), o > 0 && (n = n.substring(0, o), isNull(n) && (n = ""), n = Trim(n), n.length > 0 && (PutToDebugLog(2, "EVENT, ProcessCustomMenu set custom received transport protocol: " + n), "udp" === n.toLowerCase() ? SaveParameter("transport", "0") : "tcp" === n.toLowerCase() ? SaveParameter("transport", "1") : "tls" === n.toLowerCase() && SaveParameter("transport", "2")))
            }
            if ((o = e.indexOf("<SIP_SERVER>")) > 0) {
                var i = e.substring(o + 12);
                o = i.indexOf("</SIP_SERVER>"), o > 0 && (i = i.substring(0, o), isNull(i) && (i = ""), i = Trim(i), i.length > 0 && (PutToDebugLog(2, "EVENT, ProcessCustomMenu set custom received serveraddress: " + i), SaveParameter("serveraddress_user", i)))
            }
            if ((o = t.indexOf("<BUTTONS>")) < 0) return;
            if (t = t.substring(o + 9), (o = t.indexOf("</BUTTONS>")) < 1) return;
            t = t.substring(0, o), t = Trim(t);
            var a = t.split("<BUTTON");
            if (isNull(a) || a.length < 1) return;
            for (var r = 0; r < a.length; r++) if (null != a[r]) {
                var s = a[r].toString();
                if (!(s.length < 5)) {
                    s = ReplaceAll(s, '="', "=");
                    var l = "", p = "", c = "";
                    if (o = s.indexOf("label="), o >= 0 && (l = s.substring(o + 6), l = Trim(l), o = l.indexOf('"'), o < 0 && (o = l.indexOf(" ")), l = o > 0 ? Trim(l.substring(0, o)) : ""), o = s.indexOf("action="), o >= 0 && (p = s.substring(o + 7), p = Trim(p), o = p.indexOf('"'), o < 0 && (o = p.indexOf(" ")), p = o > 0 ? Trim(p.substring(0, o)) : ""), o = s.indexOf("data="), o >= 0 && (c = s.substring(o + 5), c = Trim(c), o = c.indexOf('"'), o < 0 && (o = c.indexOf(" ")), c = o > 0 ? Trim(c.substring(0, o)) : ""), !isNull(l) && l.length > 0 && !isNull(p) && p.length > 0 && !isNull(c) && c.length > 0) {
                        var u = new ClassCustomMenus;
                        u.label = l, u.action = p, u.data = c, webphone_api.global.custmenusL.push(u)
                    }
                }
            }
        } catch (h) {
            PutToDebugLogException(2, "common: ProcessCustomMenu", h)
        }
    }

    function GetTextLengthThatFits(e, o, t, n, i, a) {
        if (isNull(o) || o.length < 1) return 0;
        var r = o.length;
        try {
            a === undefined && (a = "normal");
            var s = webphone_api.$("<div>").addClass("auxdiv").css({
                position: "absolute",
                height: "auto",
                marginLeft: "-1000px",
                marginTop: "-1000px",
                fontWeight: a,
                width: "auto"
            }).appendTo(webphone_api.$("#" + e)).html(o), l = s.width() + 1, p = o;
            if (l > t) {
                for (var c = 1, u = 1, h = o.length, m = 0; u <= h;) c = u + h >> 1, p = o.slice(0, c), s.html(p), l = s.width() + 1, l <= t ? (m = c, u = c + 1) : h = c - 1;
                p = o.slice(0, m)
            }
            return webphone_api.$(".auxdiv").remove(), s.remove(), p.length
        } catch (g) {
            PutToDebugLogException(2, "common: GetTextLengthThatFits", g)
        }
        return r
    }

    function DomainToIpServer(e, o) {
        function t(e, t) {
            if (!isNull(dreqsrvcache[e])) {
                try {
                    for (var n = dreqsrvcache[e]; n.length > 0;) isNull(n[0]) || "function" != typeof n[0] || n[0](t), n.splice(0, 1)
                } catch (i) {
                    PutToDebugLogException(2, "common: domaintoipServer HanleCallback", i);
                    try {
                        o("")
                    } catch (a) {
                    }
                }
                delete dreqsrvcache[e]
            }
        }

        try {
            if (isNull(e) || e.length < 3) return o(""), "";
            if (!0 === IsLocalUpperServer()) return o(e), e;
            if (e = NormalizeInput(e, 0), !0 === IsIPAddrress(e)) return o(e), e;
            var n = e.lastIndexOf(":");
            if (n > 0 && (e = e.substring(0, n)), n = e.indexOf("?"), n > 0 && (e = e.substring(0, n)), n = e.indexOf("://"), n > 0 && (e = e.substring(n + 3, e.length)), n = e.indexOf("//"), n > 0 && (e = e.substring(n + 2, e.length)), n = e.indexOf("/"), n > 0 && (e = e.substring(0, n)), isNull(dtisrvcache)) {
                dtisrvcache = {};
                var i = null;
                if ((isNull(dtistrSrv) || dtistrSrv.indexOf("mnt.mizu-voip.com") < 0) && (!isNull(dtistrSrv) && dtistrSrv.length > 0 && (dtistrSrv += "##"), dtistrSrv += "www.mizu-voip.com,148.251.28.178##www.webvoipphone.com,159.69.64.139##mnt.mizu-voip.com,148.251.28.180##rtc.mizu-voip.com,148.251.28.181##usrtcx.webvoipphone.com,107.175.156.227##usrtc.webvoipphone.com,107.175.156.227"), !isNull(dtistrSrv) && dtistrSrv.length > 0 && (i = dtistrSrv.split("##")), !isNull(i) && i.length > 0) for (var a = 0; a < i.length; a++) if (!(isNull(i[a]) || i[a].indexOf(",") < 0)) {
                    var r = i[a].substring(0, i[a].indexOf(",")), s = i[a].substring(i[a].indexOf(",") + 1);
                    !isNull(r) && r.length > 0 && !isNull(s) && s.length > 0 && isNull(dtisrvcache[r]) && (dtisrvcache[r] = s)
                }
            }
            var l = "";
            if (!isNull(dtisrvcache[e])) return l = dtisrvcache[e], o(l), l;
            if (!isNull(dreqsrvcache[e])) {
                var p = dreqsrvcache[e];
                return p.push(o), dreqsrvcache[e] = p, ""
            }
            var p = [];
            p.push(o), dreqsrvcache[e] = p;
            var c = "http://mnt.mizu-voip.com/mmexreqvitserverjrsktt/xhosttoip/?host=DOMAIN&now=1";
            !0 === IsHttps() && (c = c.replace("http:", "https:")), c = c.replace("DOMAIN", encodeURIComponent(e)), PutToDebugLog(4, "EVENT, domaintoipServer url: " + c);
            var u = new XMLHttpRequest;
            if ("withCredentials" in u) u.open("GET", c, !0); else {
                if ("undefined" == typeof XDomainRequest) return u = null, PutToDebugLog(2, "ERROR, common: domaintoipServer, CORS not supported"), void o("");
                u = new XDomainRequest, u.open("GET", c)
            }
            u.onload = function () {
                try {
                    if (!1 === webphone_api.global.httpheaderslogged && u.getAllResponseHeaders) {
                        webphone_api.global.httpheaderslogged = !0;
                        PutToDebugLog(5, "EVENT, domaintoipServer HTTP request answer headers 4: " + u.getAllResponseHeaders())
                    }
                    if (isNull(u) || isNull(u.responseText) || u.responseText.length < 1) return PutToDebugLog(2, "ERROR, domaintoipServer response is NULL"), void o("");
                    var n = u.responseText;
                    if (n.indexOf("OK:") >= 0) {
                        n = n.replace("OK:", "");
                        var i = n.indexOf(":");
                        i > 0 && (n = n.substring(i + 1)), isNull(n) && (n = ""), n = Trim(n), PutToDebugLog(4, "EVENT, domaintoipServer response is: " + n), dtisrvcache[e] = n, t(e, n);
                        var a = "";
                        for (var r in dtisrvcache) !isNull(r) && r.length > 0 && !isNull(dtisrvcache[r]) && dtisrvcache[r].length > 0 && (a.length > 0 && (a += "##"), a = a + r + "," + dtisrvcache[r])
                    } else PutToDebugLog(2, "ERROR, domaintoipServer response is: " + n), dtisrvcache[e] = n, t(e, "ERROR: " + n)
                } catch (s) {
                    PutToDebugLogException(2, "common: domaintoipServer.onload inner", s), o("")
                }
            }, u.onerror = function (o) {
                var n = "";
                isNull(o) || (n = o.toString(), isNull(o.target) || (n = isNull(o.target.status) ? n + " " + o.target.toString() : n + " " + o.target.status.toString())), PutToDebugLog(2, "ERROR, domaintoipServer request failed: " + n), t(e, "ERROR, domaintoipServer request failed: " + n)
            }, u.timeout = 2e3, u.ontimeout = function (o) {
                PutToDebugLog(2, "ERROR, domaintoipServer: Timeout"), t(e, "ERROR, domaintoipServer: Timeout")
            }, u.send()
        } catch (h) {
            PutToDebugLogException(2, "common: domaintoipServer", h), o("ERROR, domaintoipServer failed")
        }
    }

    function DomainToIp(e, o) {
        function t(e, o) {
            if (!isNull(dreqcache[e])) {
                var t = dreqcache[e];
                if (o.indexOf("ERROR") < 0) for (; t.length > 0;) isNull(t[0]) || "function" != typeof t[0] || t[0](o), t.splice(0, 1);
                delete dreqcache[e]
            }
        }

        try {
            if (isNull(e) || e.length < 3) return o(""), "";
            if (!0 === IsLocalUpperServer()) return o(e), e;
            if (e = NormalizeInput(e, 0), !0 === IsIPAddrress(e)) return o(e), e;
            var n = e.lastIndexOf(":");
            if (n > 0 && (e = e.substring(0, n)), n = e.indexOf("?"), n > 0 && (e = e.substring(0, n)), n = e.indexOf("://"), n > 0 && (e = e.substring(n + 3, e.length)), n = e.indexOf("//"), n > 0 && (e = e.substring(n + 2, e.length)), n = e.indexOf("/"), n > 0 && (e = e.substring(0, n)), isNull(dticache)) {
                dticache = {};
                var i = GetParameter("domaintoip_cache"), a = null;
                if ((isNull(i) || i.indexOf("mnt.mizu-voip.com") < 0) && (!isNull(i) && i.length > 0 && (i += "##"), i += "www.mizu-voip.com,148.251.28.178##www.webvoipphone.com,159.69.64.139##mnt.mizu-voip.com,148.251.28.180##rtc.mizu-voip.com,148.251.28.181##usrtcx.webvoipphone.com,107.175.156.227##usrtc.webvoipphone.com,107.175.156.227"), !isNull(i) && i.length > 0 && (a = i.split("##")), !isNull(a) && a.length > 0) for (var r = 0; r < a.length; r++) if (!(isNull(a[r]) || a[r].indexOf(",") < 0)) {
                    var s = a[r].substring(0, a[r].indexOf(",")), l = a[r].substring(a[r].indexOf(",") + 1);
                    !isNull(s) && s.length > 0 && !isNull(l) && l.length > 0 && isNull(dticache[s]) && (dticache[s] = l)
                }
            }
            var p = dticache[e];
            if (!isNull(p)) return o(p), t(e, p), p;
            if (!isNull(dreqcache[e])) {
                var c = dreqcache[e];
                return c.push(o), dreqcache[e] = c, ""
            }
            var c = [];
            c.push(o), dreqcache[e] = c;
            var u = "http://mnt.mizu-voip.com/mmexreqvitserverjrsktt/xhosttoip/?host=DOMAIN&now=1";
            !0 === IsHttps() && (u = u.replace("http:", "https:")), u = u.replace("DOMAIN", encodeURIComponent(e)), PutToDebugLog(4, "EVENT, domaintoip url: " + u);
            var h = new XMLHttpRequest;
            if ("withCredentials" in h) h.open("GET", u, !0); else {
                if ("undefined" == typeof XDomainRequest) return h = null, PutToDebugLog(2, "ERROR, common: domaintoip, CORS not supported"), void o("");
                h = new XDomainRequest, h.open("GET", u)
            }
            h.onload = function () {
                try {
                    if (!1 === webphone_api.global.httpheaderslogged && h.getAllResponseHeaders) {
                        webphone_api.global.httpheaderslogged = !0;
                        PutToDebugLog(5, "EVENT, HTTP request answer headers 4: " + h.getAllResponseHeaders())
                    }
                    if (isNull(h) || isNull(h.responseText) || h.responseText.length < 1) return PutToDebugLog(2, "ERROR, domaintoip response is NULL"), void o("");
                    var n = h.responseText;
                    if (n.indexOf("OK:") >= 0) {
                        n = n.replace("OK:", "");
                        var i = n.indexOf(":");
                        i > 0 && (n = n.substring(i + 1)), isNull(n) && (n = ""), n = Trim(n), PutToDebugLog(4, "EVENT, domaintoip response is: " + n), dticache[e] = n, o(n), t(e, n);
                        var a = "";
                        for (var r in dticache) !isNull(r) && r.length > 0 && !isNull(dticache[r]) && dticache[r].length > 0 && (a.length > 0 && (a += "##"), a = a + r + "," + dticache[r]);
                        SaveParameter("domaintoip_cache", a)
                    } else PutToDebugLog(2, "ERROR, domaintoip response is: " + n), o(""), t(e, "ERROR: " + n)
                } catch (s) {
                    PutToDebugLogException(2, "common: domaintoip.onload inner", s), o("")
                }
            }, h.onerror = function (n) {
                var i = "";
                isNull(n) || (i = n.toString(), isNull(n.target) || (i = isNull(n.target.status) ? i + " " + n.target.toString() : i + " " + n.target.status.toString())), PutToDebugLog(2, "ERROR, domaintoip request failed: " + i), o(""), t(e, "ERROR, domaintoip request failed: " + i)
            }, h.timeout = 4e3, h.ontimeout = function (n) {
                PutToDebugLog(2, "ERROR, domaintoip: Timeout"), o(""), t(e, "ERROR, domaintoip: Timeout")
            }, h.send()
        } catch (m) {
            PutToDebugLogException(2, "common: domaintoip", m), o("domaintoip failed")
        }
    }

    function HandleSipProtocol(e) {
        try {
            if (isNull(e) || e.length < 1) return e;
            if (0 !== e.indexOf("REGISTER sip:") && 0 !== e.indexOf("INVITE sip")) return e;
            var o = GetParameterInt("sipprotocol", 0);
            if (0 === o) return e;
            var t = e;
            if (1 === o) return t = ReplaceAll(t, "sips:", "sip:"), t = ReplaceAll(t, "WSS", "WS"), t = ReplaceAll(t, "wss", "ws");
            if (2 === o) return t = ReplaceAll(t, "sip:", "sips:"), t = ReplaceAll(t, "WS", "WSS"), t = ReplaceAll(t, "ws", "wss")
        } catch (n) {
            PutToDebugLogException(2, "common: HandleSipProtocol", n)
        }
        return e
    }

    function HandleOptions(e) {
        try {
            if (isNull(e) || e.length < 1 || e.indexOf("OPTIONS sip") < 0) return !1;
            var o = e, t = GetSipHeaderFromMsg(o, "accept");
            isNull(t) && (t = ""), t = t.toLowerCase()
                ; var n = "\r\n";
            o.indexOf("\r\n") < 0 && o.indexOf("\n") >= 0 && (n = "\n"), o = o.substring(o.indexOf(n) + n.length);
            var i = "SIP/2.0 200 OK" + n + o,
                a = "<sip:" + GetSipusername() + "@" + webphone_api.webrtcapi.GetUDPServerAddress() + ">";
            if (i = i.indexOf("Contact:") > 0 ? RewriteSipHeaderInMsg(i, "Contact", a) : i + "Contact: " + a + n, i = i.indexOf("User-Agent:") > 0 ? RewriteSipHeaderInMsg(i, "User-Agent", "MWWRTC " + webphone_api.global.versionstr) : i + "User-Agent: MWWRTC " + webphone_api.global.versionstr + n, t.indexOf("application") >= 0 && t.indexOf("sdp") >= 0) {
                i.indexOf("Content-Length:") < 0 && (i = i + "Content-Length: 0" + n), i += n;
                var r = "", s = GetParameter("codec");
                if (isNull(s) || s.length < 1 || "-1" == s) r = "v=0" + n + "m=audio 80 UDP/TLS/RTP/SAVPF 111 103 104 9 0 8 106 105 13 126" + n + "a=mid:0" + n + "a=sendrecv" + n + "a=rtcp-mux" + n + "a=rtpmap:111 opus/48000/2" + n + "a=rtcp-fb:111 transport-cc" + n + "a=fmtp:111 minptime=10;useinband" + n + "a=rtpmap:103 ISAC/16000" + n + "a=rtpmap:104 ISAC/32000" + n + "a=rtpmap:9 G722/8000" + n + "a=rtpmap:0 PCMU/8000" + n + "a=rtpmap:8 PCMA/8000" + n + "a=rtpmap:106 CN/32000" + n + "a=rtpmap:105 CN/16000" + n + "a=rtpmap:13 CN/8000" + n + "a=rtpmap:126 telephone-event/8000" + n; else {
                    var l = "m=audio 80 UDP/TLS/RTP/SAVPF";
                    r = "a=mid:0" + n + "a=sendrecv" + n + "a=rtcp-mux" + n;
                    var p = s.split(",");
                    (p.indexOf("10") >= 0 || p.indexOf("11") >= 0 || p.indexOf("13") >= 0) && (l += " 111", r = r + "a=rtpmap:111 opus/48000/2" + n + "a=rtcp-fb:111 transport-cc" + n + "a=fmtp:111 minptime=10;useinband" + n), l += " 103 104 9", r = r + "a=rtpmap:103 ISAC/16000" + n + "a=rtpmap:104 ISAC/32000" + n + "a=rtpmap:9 G722/8000" + n, p.indexOf("1") >= 0 && (l += " 0", r = r + "a=rtpmap:0 PCMU/8000" + n), p.indexOf("2") >= 0 && (l += " 8", r = r + "a=rtpmap:8 PCMA/8000" + n), l += " 106 105 13 126", r = r + "a=rtpmap:106 CN/32000" + n + "a=rtpmap:105 CN/16000" + n + "a=rtpmap:13 CN/8000" + n + "a=rtpmap:126 telephone-event/8000" + n, r = "v=0" + n + l + n + r
                }
                i = i + n + r, i = RewriteSipHeaderInMsg(i, "Content-Length", r.length)
            } else i = i.indexOf("Accept:") > 0 ? RewriteSipHeaderInMsg(i, "Accept", "application/sdp,application/dtmf-relay,text/plain") : i + "Accept: application/sdp,application/dtmf-relay,text/plain" + n, i = i.indexOf("Content-Length:") > 0 ? RewriteSipHeaderInMsg(i, "Content-Length", "0") : i + "Content-Length: 0" + n;
            return webphone_api.common.PutToDebugLog(3, "EVENT, HandleOptions OPTIONS sip handled manually: EVENT, SEND: \r\n" + i), webphone_api.webrtc_socket.send(i), !0
        } catch (c) {
            PutToDebugLogException(2, "common: HandleOptions", c)
        }
        return !1
    }

    function HandleEdgeSdpIP(e) {
        try {
            if (isNull(e) || e.length < 1) return e;
            if ("Edge" !== GetBrowser()) return e;
            if (0 !== e.indexOf("INVITE sip")) return e;
            var o = e, t = o.indexOf("a=candidate:");
            if (t < 0) return e;
            var n = o.substring(t + 12);
            if (n = n.substring(0, n.indexOf("\r\n")), isNull(n) || n.length < 1) return e;
            var i = "";
            if (t = n.lastIndexOf("."), t > 0 && (i = n.substring(t), n = n.substring(0, t + 4), t = n.lastIndexOf(" "), t > n.length - 6 && (n = n.substring(0, t)), n = Trim(n), t = n.lastIndexOf(" "), t > 0 && (n = n.substring(t + 1)), isNull(i) && (i = ""), i = Trim(i), t = i.indexOf(" "), t > 0 && (i = i.substring(t + 1)), t = i.indexOf(" "), t > 0 && (i = i.substring(0, t), !isNull(i) && IsNumber(i) || (i = "")), n = Trim(n), i = Trim(i)), isNull(n) || n.length < 1 || !IsIPAddrress(n)) return e;
            if ((t = o.indexOf("c=")) < 1) return e;
            var a = o.substring(0, t);
            o = o.substring(t), t = o.indexOf("\r\n");
            var r = o.substring(0, t + 2);
            o = o.substring(t + 2);
            var s = r.replace("127.0.0.1", n);
            if (s = s.replace("127.0.0.0", n), o = a + s + o, r = r.replace("\r\n", ""), s = s.replace("\r\n", ""), PutToDebugLog(2, "EVENT, HandleEdgeSdpIP IP addres rewritten in SDP, orig header: " + r + "; rewritten to: " + s), isNull(i) || i.length < 1 || !IsNumber(i)) return o;
            if ((t = o.indexOf("m=audio")) < 1) return o;
            e = o, a = o.substring(0, t + 7), o = o.substring(t + 7), o = Trim(o), t = o.indexOf(" ");
            var l = o.substring(0, t);
            return o = o.substring(t), (isNull(l) && (l = ""), l = Trim(l), l.length < 1 || !IsNumber(l)) ? e : o = a + " " + i + o
        } catch (p) {
            PutToDebugLogException(2, "common: HandleEdgeSdpIP", p)
        }
        return e
    }

    function HandleIncomingSIPSignaling(e) {
        try {
            if (isNull(e) || e.length < 1) return e;
            var o = HandleAmidHeader(e);
            return o = HandleSpecialCharsInHeaders(o)
        } catch (t) {
            PutToDebugLogException(2, "common: HandleIncomingSIPSignaling", t)
        }
        return e
    }

    function HandleSpecialCharsInHeaders(e) {
        try {
            var o = e, t = o.indexOf("\r\n\r\n"), n = -1, i = "";
            t > 0 && (i = o.substring(t), o = o.substring(0, t)), isNull(i) && (i = "");
            var a = o.split("\r\n");
            if (isNull(a) || a.length < 1) return e;
            o = "";
            for (var r = 0; r < a.length; r++) {
                if (isNull(a[r]) && (a[r] = ""), t = a[r].indexOf('"'), n = a[r].lastIndexOf('"'), t >= 0 && n > 0 && t < n) {
                    var s = a[r].substring(t + 1, n), l = RemoveSpecialCharaters(s);
                    s !== l && (PutToDebugLog(2, "EVENT, HandleSpecialCharsInHeaders, rewrite special charaters in header: " + a[r] + "; to: " + l + " because containes invalid charaters"), a[r] = a[r].replace(s, l), (a[r].indexOf("From:") >= 0 || a[r].indexOf("Contact:") >= 0) && (webphone_api.global.sipunicoderewritefrom = s, webphone_api.global.sipunicoderewriteto = l))
                }
                o.length > 0 && (o += "\r\n"), o += a[r]
            }
            if (!isNull(o) && o.length > 10) return o + i
        } catch (p) {
            PutToDebugLogException(2, "common: HandleSpecialCharsInHeaders", p)
        }
        return e
    }

    function RemoveSpecialCharaters(e) {
        try {
            if (isNull(e) || e.length < 1) return e;
            for (var o = "", t = 0; t < e.length; t++) e.charCodeAt(t) > 31 && e.charCodeAt(t) < 255 && (o += e.charAt(t));
            return o
        } catch (n) {
            PutToDebugLogException(2, "common: RemoveSpecialCharaters", n)
        }
        return e
    }

    function HandleAmidHeader(e, o) {
        try {
            if ("Firefox" !== GetBrowser()) return e;
            var t = e, n = t.indexOf("INVITE sip");
            if ((n >= 0 && n < 20 || !1 === o) && (n = t.indexOf("a=mid:")) < 1) if ((n = t.indexOf("m=audio")) > 0) {
                var i = t.substring(0, n);
                t = t.substring(n), n = t.indexOf("\r\n");
                t = i + t.substring(0, n + 2) + "a=mid:1\r\n" + t.substring(n + 2), t = RecalculateContentLength(t)
            } else if ((n = t.indexOf("m=video")) > 0) {
                var i = t.substring(0, n);
                t = t.substring(n), n = t.indexOf("\r\n"), t = i + t.substring(0, n + 2) + "a=mid:2\r\n" + t.substring(n + 2), t = RecalculateContentLength(t)
            }
            return t
        } catch (a) {
            PutToDebugLogException(2, "common: HandleAmidHeader", a)
        }
        return e
    }

    function FixContentLength(e) {
        try {
            if (isNull(e) || e.length < 1) return e;
            var o = e;
            if (o.indexOf("REGISTER sip") < 0) {
                var t = o.indexOf("Call-ID:");
                if (t > 0) {
                    var n = Trim(o.substring(t + 8));
                    n.indexOf("\r\n") > 0 && (n = n.substring(0, n.indexOf("\r\n")), !isNull(n) && n.length > 0 && (o = o.substring(0, t) + "X-C-Call-ID: " + n + "\r\n" + o.substring(t)))
                }
            }
            if (webphone_api.global.fcmIsEnabled > 0 && (t = o.indexOf("REGISTER sip")) >= 0 && t < 20 && !isNull(webphone_api.global.fcmtoken) && webphone_api.global.fcmtoken.length > 3) {
                if (o.indexOf("X-MPUSH:") < 1 && (t = o.indexOf("\r\n\r\n")) > 0) {
                    var i = "w:" + GetFCMPackageName() + ":" + fcmclientid;
                    o = o.substring(0, t) + "\r\nX-MPUSH: " + i + o.substring(t), PutToDebugLog("WARNING, X-MPUSH added at register send")
                }
                if (o.indexOf("X-PIID:") < 1 && (t = o.indexOf("\r\n\r\n")) > 0) {
                    var a = GetSipusername() + ":" + webphone_api.global.mRealm + ":" + GetParameter("password"),
                        r = webphone_api.common.Md5Hash(a);
                    o = o.substring(0, t) + "\r\nX-PIID: " + r + o.substring(t), PutToDebugLog("WARNING, X-PIID added at register send")
                }
            }
            if ((t = o.indexOf("INVITE sip")) >= 0 && t < 20) {
                if (!0 === webphone_api.global.add_recall_header && o.indexOf("X-Autorecall:") < 1 && (t = o.indexOf("\r\n\r\n")) > 0 && (o = o.substring(0, t) + "\r\nX-Autorecall: yes" + o.substring(t)), !0 === webphone_api.global.addauser_header && o.indexOf("X-AUSR:") < 1 && (t = o.indexOf("\r\n\r\n")) > 0 && (o = o.substring(0, t) + "\r\nX-AUSR: " + GetSipusername() + o.substring(t), PutToDebugLog("WARNING, Sipusername added at invite send")), o.indexOf("X-Sy.Upperproxy:") < 1) {
                    var s = GetUpperProxyHeaderForSignaling();
                    !isNull(s) && s.length > 0 && (t = o.indexOf("\r\n\r\n")) > 0 && (o = o.substring(0, t) + "\r\nX-Sy.Upperproxy: " + s + o.substring(t), PutToDebugLog("WARNING, Proxyaddress added at invite send"))
                }
                CatchWebrtcSignaling(o, SIP_UNKNOWN)
            }
            if (t = o.indexOf("INVITE sip"), t >= 0 && (o = o.replace("X-Sy.Uppersrv: rtc.mizu-voip.com:6060\r\n", "")), t >= 0 && t < 20 && o.indexOf("X-Sy.Uppersrv:") < 1) {
                var l = GetWebrtcSyUpperHeader("invite send");
                !isNull(l) && l.length > 0 && (t = o.indexOf("\r\n\r\n")) > 0 && (o = o.substring(0, t) + "\r\nX-Sy.Uppersrv: " + l + o.substring(t), PutToDebugLog("WARNING, Upperserver added at invite send"))
            }
            if (t = o.indexOf("INVITE sip"), t >= 0 && (o = o.replace("X-Sy.Uppersrvd: rtc.mizu-voip.com:6060\r\n", "")), t >= 0 && t < 20) {
                var p = GetWebrtcSyUpperDomainHeader("invite send");
                !isNull(p) && p.length > 0 && o.indexOf("X-Sy.Uppersrv:") < 1 && (t = o.indexOf("\r\n\r\n")) > 0 && (o = o.substring(0, t) + "\r\nX-Sy.Uppersrvd: " + p + o.substring(t), PutToDebugLog("WARNING, Upperserver domain added at invite send"))
            }
            return o = RecalculateContentLength(o)
        } catch (c) {
            PutToDebugLogException(2, "common: FixContentLength", c)
        }
        return e
    }

    function RecalculateContentLength(e) {
        try {
            if (isNull(e) || e.length < 1) return e;
            var o = e, t = o.indexOf("Content-Length:");
            if (t < 1 || o.indexOf("Content-Length: 0") > 0) return o;
            var n = -1, i = -1;
            if (t > 0) {
                var a = o.substring(t + 15);
                if (t = a.indexOf("\r\n"), t > 0 && (a = Trim(a.substring(0, t)), isNull(a) || !0 !== IsNumber(a) || (n = StrToInt(a))), n > 0 && (t = o.indexOf("\r\n\r\n")) > 0 && (i = o.length - t - 4) !== n) return o = o.replace("Content-Length: " + n, "Content-Length: " + i), o = o.replace("Content-Length:" + n, "Content-Length:" + i)
            }
        } catch (r) {
            PutToDebugLogException(2, "common: RecalculateContentLength", r)
        }
        return e
    }

    function RemoveDuplicateHeaders(e) {
        try {
            if (isNull(e) || e.length < 1) return e;
            var o = e, t = o.indexOf("REGISTER sip");
            if (t >= 0 && t < 20) {
                for (var n = [], i = o.split("\r\n"), a = 0; a < i.length; a++) "undefined" != typeof i[a] && null !== i[a] && (i[a].indexOf(":") < 0 ? n.push(i[a]) : n.indexOf(i[a]) < 0 && n.push(i[a]));
                if (!isNull(n) && n.length > 0) {
                    for (var r = "", a = 0; a < n.length; a++) a > 0 ? r = r + "\r\n" + n[a] : r += n[a];
                    return r
                }
            }
        } catch (s) {
            PutToDebugLogException(2, "common: RemoveDuplicateHeaders", s)
        }
        return e
    }

    function AddDtmfConfHeader(e) {
        try {
            if (!0 !== webphone_api.global.isconfdtmf) return e;
            if (isNull(e) || e.length < 1) return e;
            if (e.indexOf("INFO sip:") < 0 && e.indexOf("INFO sips:") < 0) return e;
            var o = e;
            o.indexOf("Signal=#") >= 0 && (webphone_api.global.isconfdtmf = !1);
            var t = o.indexOf("\r\nCall-ID:");
            if (t >= 0 && o.indexOf("X-MDTFM:") < 0) {
                var o = o.substring(0, t) + "\r\nX-MDTFM: y" + o.substring(t);
                return o
            }
        } catch (n) {
            PutToDebugLogException(2, "common: AddDtmfConfHeader", n)
        }
        return e
    }

    function GetViaRandomAddress() {
        try {
            return !isNull(viarandaddr) && viarandaddr.length > 0 ? viarandaddr : viarandaddr = RandomStr(12, !1, !0) + ".invalid"
        } catch (e) {
            PutToDebugLogException(2, "common: FixContentLength", e)
        }
        return "abcdefg12345.invalid"
    }

    function GetPushnotVal(e) {
        var o = GetParameterInt("enablepush", e), t = GetParameterInt("callreceiver", e), n = t;
        return 1 !== t && -1 !== t || (n = 0), o >= 0 && (n = o), n
    }

    function EnableFCM() {
        try {
            var e = GetPushnotVal(-1);
            if (isNull(e) || e < -1) return !1;
            if (0 === e) return !1;
            if (!1 === IsHttps()) return !1;
            if (!1 in navigator) return !1;
            if (!0 === HideSettings("enablepush", webphone_api.stringres.get("sett_display_name_enablepush"), "enablepush", !0)) return !1;
            if (!0 === IsLocalServer(!0) || !0 === IsLocalUpperServer()) return !1;
            if (1 === e || 2 === e || 3 === e) return !0;
            if (-1 === e) {
                if (webphone_api.global.recwsload > 1) return PutToDebugLog(2, "WARNING, EnableFCM returned false, because wsload server load is to high: " + webphone_api.global.recwsload), !1;
                var o = GetParameterInt("lastincalltime", 0), t = GetParameterInt("appinstalltime", 0);
                t < 1 && SaveParameter("appinstalltime", GetTickCount().toString());
                var n = GetTickCount(), i = !1;
                t > 0 && n - t < 7776e6 && (i = !0);
                var a = !1;
                if (o > 0 && n - o < 7776e6 && (a = !0), "undefined" != typeof webphone_api.config && null !== webphone_api.config && "undefined" != typeof webphone_api.config.apiKey && null !== webphone_api.config.apiKey && webphone_api.config.apiKey.length > 3 && (!0 === i || !0 === a)) return !0
            }
        } catch (r) {
            PutToDebugLogException(2, "common EnableFCM", r)
        }
        return !1
    }

    function StartFCM(en) {
        try {
            if (!1 === EnableFCM()) return;
            if (PutToDebugLog(4, "EVENT, exec StartFCM (" + en + ")"), "undefined" == typeof firebase || null === firebase) return PutToDebugLog(2, "ERROR, exec StartFCM firebase scripts were not loaded(firebase.js, firebase-app.js, firebase-messaging.js)"), void console.log(2, "ERROR, exec StartFCM firebase scripts were not loaded(firebase.js, firebase-app.js, firebase-messaging.js)");
            if ("undefined" == typeof webphone_api.config || null === webphone_api.config || "undefined" == typeof webphone_api.config.apiKey || null === webphone_api.config.apiKey || webphone_api.config.apiKey.length < 3) return void PutToDebugLog(2, "ERROR, exec StartFCM firebase config is not set in webphone_api.js");
            webphone_api.global.fcmstate = 0, firebase.apps.length || firebase.initializeApp(webphone_api.config);
            var messaging = firebase.messaging();
            eval('messaging.requestPermission().then(function () { webphone_api.global.fcmstate = 1; console.log("Notification permission granted"); return messaging.getToken(); }).then(function (token){if (isNull(token) || token.length < 3) { PutToDebugLog(2, "ERROR, FCM received token is INVALID: " + token); return; }webphone_api.global.fcmstate = 2; webphone_api.global.fcmtoken = token; PutToDebugLog(4, "EVENT, FCM received token: " + webphone_api.global.fcmtoken); FCMSetToken();}).catch(function (err){if (webphone_api.global.fcmstate === 0) { PutToDebugLog(2, "ERROR, StartFCM user denied permission to show notifications"); ShowToast(webphone_api.stringres.get("fcm_perm_message"));}else { PutToDebugLog(2, "ERROR, exec StartFCM failed to get FCM token"); }});messaging.onMessage(function (payload){if (isNull(payload)) { payload = \'\'; } var data = \'\';try{ data = JSON.stringify(payload); }catch (ein) { data = payload.toString(); } PutToDebugLog(2, "EVENT, FCM onMessage: " + data);});messaging.onTokenRefresh(function() {messaging.getToken().then(function(refreshedToken) {if (isNull(refreshedToken) || refreshedToken.length < 3) { PutToDebugLog(2, "ERROR, FCM received refreshed token is INVALID: " + refreshedToken); return; }webphone_api.global.fcmstate = 2; webphone_api.global.fcmtoken = refreshedToken; PutToDebugLog(4, "EVENT, FCM received refreshed token: " + webphone_api.global.fcmtoken); FCMSetToken();}).catch(function (err) { PutToDebugLogException(2, "ERROR, FCM onTokenRefresh Unable to retrieve refreshed token", err); });});')
        } catch (e) {
            PutToDebugLogException(2, "common StartFCM", e)
        }
    }

    function FCMSetToken() {
        try {
            var e = GetParameterInt("enablefcm", -1);
            if (e < 1 && (e = 1), getuseengine() === webphone_api.global.ENGINE_WEBRTC) webphone_api.global.fcmIsEnabled = 1, webphone_api.webrtcapi.SetPushNotifications(e, webphone_api.global.fcmtoken, "", ""); else if (!0 === IsWindowsSoftphone() || getuseengine() === webphone_api.global.ENGINE_SERVICE) webphone_api.global.fcmIsEnabled = 1, WinAPI("API_SetPushNotifications", null, e, webphone_api.global.fcmtoken, "", ""); else {
                if (getuseengine() !== webphone_api.global.ENGINE_WEBPHONE) return void PutToDebugLog(2, "WARNING, FCM FCMSetToken push notifications are not supported by engine: " + getuseengine());
                webphone_api.global.fcmIsEnabled = 1, webphone_api.webphone.SetPushNotifications(e, webphone_api.global.fcmtoken, "", "")
            }
            PutToDebugLog(2, "EVENT, FCM FCMSetToken push notifications are ENABLED: " + getuseengine())
        } catch (o) {
            PutToDebugLogException(2, "common FCMSetToken", o)
        }
    }

    function UserExists(e) {
        try {
            if (isNull(e)) return !0;
            if (e = e.toLowerCase(), e = Trim(e), e.length < 1) return !0;
            if (e === GetSipusername().toLowerCase()) return !0;
            if (!isNull(webphone_api.global.sipaccounts)) for (var o = 0; o < webphone_api.global.sipaccounts.length; o++) if (!isNull(webphone_api.global.sipaccounts[o].username) && webphone_api.global.sipaccounts[o].username.toLowerCase() === e) return !0;
            return !1
        } catch (t) {
            PutToDebugLogException(2, "common UserExists", t)
        }
        return !0
    }

    function GetSipusername() {
        var e = "";
        try {
            e = GetParameter("sipusername"), (isNull(e) || e.length < 1) && (e = GetParameter("username")), isNull(e) && (e = "")
        } catch (o) {
            PutToDebugLogException(2, "common GetSipusername", o)
        }
        return e
    }

    function GetCallerid() {
        var e = "";
        try {
            e = GetParameter("username"), (isNull(e) || e.length < 1) && (e = GetParameter("sipusername"))
        } catch (o) {
            PutToDebugLogException(2, "common GetCallerid", o)
        }
        return e
    }

    function HandleCallerID() {
        try {
            var e = GetParameter("previous_sipusername"), o = GetParameter("previous_username");
            !isNull(e) && e.length > 0 && e !== GetParameter("sipusername") && !isNull(o) && o.length > 0 && o === GetParameter("username") && GetParameter("username") !== GetParameter("sipusername") && (PutToDebugLog(2, "EVENT, HandleCallerID: callerID is reset; old callerid: " + o), SaveParameter("username", "")), SaveParameter("previous_username", GetParameter("username")), SaveParameter("previous_sipusername", GetParameter("sipusername"))
        } catch (t) {
            webphone_api.common.PutToDebugLogException(2, "common: HandleCallerID", t)
        }
    }

    function GetFCMPackageName() {
        try {
            var e = GetParameter("packagename");
            if (!isNull(e) && Trim(e).length > 0) return e
        } catch (o) {
            PutToDebugLogException(2, "common GetFCMPackageName", o)
        }
        return "com.mizuvoip.mizudroid.app"
    }

    function UniqueArray(e) {
        try {
            if (isNull(e) || e.length < 1) return e;
            for (var o = e, t = 0, n = o.length + 10, i = 0; t < o.length;) {
                if (++i > n) return e;
                var a = o.indexOf(o[t]);
                a >= 0 && a < t ? o.splice(t, 1) : t++
            }
            return o
        } catch (r) {
            PutToDebugLogException(2, "common UniqueArray", r)
        }
        return e
    }

    function IsWebphoneInIframe() {
        try {
            return window.self !== window.top
        } catch (e) {
            return !0
        }
    }

    function GetParentIframeUrl() {
        var e = "";
        try {
            if (!1 === IsWebphoneInIframe()) return "";
            e = document.referrer
        } catch (o) {
            try {
                e = window.parent.location
            } catch (t) {
                e = "ERROR, cannot get iframe parent location"
            }
        }
        return isNull(e) && (e = ""), e
    }

    function IsCExt() {
        try {
            if (iscallerextension >= 0) return iscallerextension;
            var e = window.location.href;
            void 0 !== e && null !== e || (e = ""), e = e.toLowerCase();
            var o = [];
            o.push("c"), o.push("a"), o.push("l"), o.push("l"), o.push("e"), o.push("r"), o.push("e"), o.push("x"), o.push("t"), o.push("e"), o.push("n"), o.push("s"), o.push("i"), o.push("o"), o.push("n"), o.push("="), o.push("3"), o.push("4"), o.push("5");
            var t = o.join("");
            return iscallerextension = e.indexOf(t) > 0 ? 1 : 0
        } catch (n) {
            PutToDebugLogException(2, "common IsCExt", n)
        }
        return 0
    }

    function GetUA() {
        try {
            return "MWWRTC " + webphone_api.global.versionstr
        } catch (e) {
            PutToDebugLogException(2, "common GetUA", e)
        }
        return "MWWRTC 1.0"
    }

    function StripXML(e) {
        try {
            if (isNull(e) || e.length < 1) return "";
            var o = Trim(e), t = o.indexOf("<"), n = o.indexOf(">");
            if (t >= 0 && n >= 0 && t < n) for (var i = 0; t >= 0 && n >= 0 && t < n && i < 100;) i++, o = o.substring(0, t) + o.substring(n + 1), t = o.indexOf("<"), n = o.indexOf(">");
            return o
        } catch (a) {
            PutToDebugLogException(2, "common GetUA", a)
        }
        return e
    }

    function DisplayStartPage(e) {
        try {
            var o = GetParameter("startpage_url");
            isNull(o) && (o = "");
            var t = GetParameter("startpage_text");
            if (isNull(t) && (t = ""), o.length < 2 && t.length < 5) return;
            var n = GetParameter("startpage_title");
            isNull(n) && (n = "");
            var i = GetParameterInt("startpage_type", 0);
            if (o.length > 0) {
                var a = o.indexOf("stitle=");
                if (a > 0) {
                    var r = o.substring(a + 7);
                    a = r.indexOf("&"), a > 0 && (r = r.substring(0, a)), !isNull(r) && r.length > 0 && (n = r)
                }
                if ((a = o.indexOf("stype=")) > 0) {
                    var s = o.substring(a + 6);
                    a = s.indexOf("&"), a > 0 && (s = s.substring(0, a)), !isNull(s) && s.length > 0 && IsNumber(s) && (i = StrToIntDef(s, 0))
                }
            }
            var l = GetParameterInt("startpage_disp_count", 0);
            if (i < 2 && l > 0) return;
            if (2 == i && l > 0 && "Settings" === e) return;
            webphone_api.global.intentstartpage[0] = "url=" + o, webphone_api.global.intentstartpage[1] = "lastpage=" + webphone_api.$.mobile.activePage.attr("id"), webphone_api.global.intentstartpage[2] = "title=" + n, webphone_api.global.intentstartpage[3] = "text=" + t, webphone_api.global.intentstartpage[4] = "type=" + i.toString(), webphone_api.$.mobile.changePage("#page_startpage", {
                transition: "pop",
                role: "page"
            })
        } catch (p) {
            PutToDebugLogException(2, "common DisplayStartPage", p)
        }
    }

    function ParseQRcode(e) {
        try {
            if (isNull(e) || Trim(e).lenght < 1 || e.indexOf(":") < 1) return void PutToDebugLog(2, "ERROR, ParseQRcode invalid QRcode: " + e);
            if (e = ReplaceAll(e, "{", ""), e = ReplaceAll(e, "}", ""), e = ReplaceAll(e, '"', ""), e.indexOf("ERROR") >= 0) return e = e.replace("ERROR,", ""), e = e.replace("ERROR", ""), PutToDebugLog(2, "ERROR, ParseQRcode returned error (show toast to user): " + e), void ShowToast(e);
            for (var o = e.split(","), t = 0; t < o.length; t++) if (!isNull(o[t])) {
                var n = o[t].indexOf(":");
                if (!(n < 1)) {
                    var i = o[t].substring(0, n), a = o[t].substring(n + 1);
                    if (!(isNull(i) || Trim(i).length < 1 || isNull(a))) {
                        i = Trim(i), a = Trim(a), SaveParameter("QRCODE_" + i, a);
                        var r = "";
                        switch (i) {
                            case "user":
                                r = "sipusername";
                                break;
                            case "server":
                                r = "serveraddress_user";
                                break;
                            case "proxy":
                                r = "proxyaddress";
                                break;
                            default:
                                r = i
                        }
                        !isNull(r) && r.length > 0 && (PutToDebugLog(5, "ParseQRcode SaveParameter: " + r + "=" + a), SaveParameter(r, a)), r = ""
                    }
                }
            }
            ShowToast(webphone_api.stringres.get("barcode_success")), setTimeout(function () {
                try {
                    GetSipusername().length > 0 && GetParameter("password").length > 0 && "page_settings" !== webphone_api.$.mobile.activePage.attr("id") && (PutToDebugLog(5, "ParseQRcode autologin because we have received login details"), webphone_api.plhandler.LoginSkin())
                } catch (e) {
                    PutToDebugLogException(2, "ParseQRcode timer inner run", e)
                }
            }, 3e3)
        } catch (s) {
            PutToDebugLogException(2, "common ParseQRcode", s)
        }
    }

    function GetSrvVersions() {
        try {
            if (!0 === IsMacLin() || IsWinMacLinNsTest()) return;
            var e = GetTickCount();
            if (srvVersionMaxLoop > 1 && e - srvVersionLastExec < 5e3) return;
            srvVersionMaxLoop++, srvVersionLastExec = e, WinAPI("API_GetExeVersion", function (e) {
                !isNull(e) && e.length > 0 && e.toLowerCase().indexOf("error") < 0 && (e = e.replace("OK:", ""), e = Trim(e), SaveParameter("srv_exe_version", e))
            }), setTimeout(function () {
                WinAPI("API_GetVersion", function (e) {
                    !isNull(e) && e.length > 0 && e.toLowerCase().indexOf("error") < 0 && (e = e.replace("OK:"), e = Trim(e), SaveParameter("srv_java_version", e))
                })
            }, 500)
        } catch (o) {
            PutToDebugLogException(2, "common GetSrvVersions", o)
        }
    }

    function IsWinMacLinNsTest() {
        try {
            if ("undefined" != typeof webphone_api.parameters.winlinmacnsengine) {
                if (!0 === webphone_api.parameters.winlinmacnsengine || "true" === webphone_api.parameters.winlinmacnsengine) return !0;
                if (!1 === webphone_api.parameters.winlinmacnsengine || "false" === webphone_api.parameters.winlinmacnsengine) return !1
            }
        } catch (e) {
            PutToDebugLogException(2, "common IsWinMacLinNsTest", e)
        }
        return webphone_api.global.winlinmacnsengine
    }

    function IsMacLin() {
        try {
            return isNull(ismaclin_cached) ? ismaclin_cached = "Mac" === GetOs() || "Linux" === GetOs() : ismaclin_cached
        } catch (e) {
            PutToDebugLogException(2, "common IsMacLin", e)
        }
        return !1
    }

    function NSMacLinEnabled() {
        try {
            if (!isNull(maclinenabled_cached)) return maclinenabled_cached;
            if ("undefined" == typeof webphone_api.parameters.linnsengine || !0 !== webphone_api.parameters.linnsengine && !1 !== webphone_api.parameters.linnsengine || (webphone_api.global.linnsengine = webphone_api.parameters.linnsengine), "undefined" == typeof webphone_api.parameters.macnsengine || !0 !== webphone_api.parameters.macnsengine && !1 !== webphone_api.parameters.macnsengine || (webphone_api.global.macnsengine = webphone_api.parameters.macnsengine), !0 === webphone_api.global.linnsengine && "Linux" === GetOs()) return maclinenabled_cached = !0;
            if (!0 === webphone_api.global.macnsengine && "Mac" === GetOs()) return maclinenabled_cached = !0;
            if (!0 === IsWinMacLinNsTest() && (!0 === IsMacLin() || "Windows" === GetOs())) return maclinenabled_cached = !0
        } catch (e) {
            PutToDebugLogException(2, "common NSMacLinEnabled", e)
        }
        return !1
    }

    function TestNSPolling() {
        try {
            return null !== flag_testnspolling_cached ? flag_testnspolling_cached : flag_testnspolling_cached = "undefined" != typeof webphone_api.parameters.flag_testnspolling && !0 === webphone_api.parameters.flag_testnspolling
        } catch (e) {
            PutToDebugLogException(2, "common TestNSPolling", e)
        }
        return !1
    }

    function GetAudioRecList() {
        return !isNull(webphone_api.global.audio_rec_device_list) && webphone_api.global.audio_rec_device_list.length > 0 ? webphone_api.global.audio_rec_device_list : GetParameter("cache_audio_rec_device_list")
    }

    function GetAudioPlayList() {
        return !isNull(webphone_api.global.audio_play_device_list) && webphone_api.global.audio_play_device_list.length > 0 ? webphone_api.global.audio_play_device_list : GetParameter("cache_audio_play_device_list")
    }

    function GetAudioRingList() {
        return !isNull(webphone_api.global.audio_ring_device_list) && webphone_api.global.audio_ring_device_list.length > 0 ? webphone_api.global.audio_ring_device_list : GetParameter("cache_audio_ring_device_list")
    }

    function GetVideoRecList() {
        return !isNull(webphone_api.global.video_rec_device_list) && webphone_api.global.video_rec_device_list.length > 0 ? webphone_api.global.video_rec_device_list : GetParameter("cache_video_rec_device_list")
    }

    function GetAudioRecDev() {
        return !isNull(webphone_api.global.audio_rec_curr_device) && webphone_api.global.audio_rec_curr_device.length > 0 ? webphone_api.global.audio_rec_curr_device : GetParameter("cache_audio_rec_curr_device")
    }

    function GetAudioPlayDev() {
        return !isNull(webphone_api.global.audio_play_curr_device) && webphone_api.global.audio_play_curr_device.length > 0 ? webphone_api.global.audio_play_curr_device : GetParameter("cache_audio_play_curr_device")
    }

    function GetAudioRingDev() {
        return !isNull(webphone_api.global.audio_ring_curr_device) && webphone_api.global.audio_ring_curr_device.length > 0 ? webphone_api.global.audio_ring_curr_device : GetParameter("cache_audio_ring_curr_device")
    }

    function GetVideoRecDev() {
        return !isNull(webphone_api.global.video_rec_curr_device) && webphone_api.global.video_rec_curr_device.length > 0 ? webphone_api.global.video_rec_curr_device : GetParameter("cache_video_rec_curr_device")
    }

    function NuIsWebPage() {
        try {
            if (!webphone_api.common.isNull(webphone_api.global.nuiswebpage)) return webphone_api.global.nuiswebpage;
            var e = webphone_api.common.GetParameter("newuser");
            return webphone_api.common.isNull(e) && (e = ""), e = webphone_api.common.Trim(e), 0 === e.indexOf("*") ? webphone_api.global.nuiswebpage = !1 : webphone_api.global.nuiswebpage = !0, webphone_api.global.nuiswebpage
        } catch (o) {
            webphone_api.common.PutToDebugLogException(2, "common: NuIsWebPage", o)
        }
        return !1
    }

    function GetMinSrvBuildValue() {
        try {
            var e = GetParameterInt("minimumservicebuild", -1);
            if (e > webphone_api.global.minimumservicebuild) return e
        } catch (o) {
            webphone_api.common.PutToDebugLogException(2, "common: GetMinSrvBuildValue", o)
        }
        return webphone_api.global.minimumservicebuild
    }

    function HandleServiceBuildUpgrade() {
        GetMinSrvBuildValue() < 1 || WinAPI("API_GetBuildNumber", function (e) {
            try {
                if (!isNull(e) && IsNumber(e)) {
                    var o = StrToIntDef(e, 0), t = GetMinSrvBuildValue();
                    if (t > 0 && o < t) {
                        GetParameterInt("cancelonnsdownload", 0) < e && (HasUsableEngineFromEngines(GetEngine("ns"), ["java", "ns", "webrtc"]) ? (EngineForcedInstall("ns", webphone_api.stringres.get("service_update"), !0, function (e) {
                            isNull(e) || "cancel" !== e || SaveParameter("cancelonnsdownload", GetMinSrvBuildValue())
                        }), webphone_api.global.nsupdatepending = !0) : (EngineForcedInstall("ns", webphone_api.stringres.get("service_update")), webphone_api.global.nsupdatepending = !0))
                    }
                }
            } catch (n) {
                webphone_api.common.PutToDebugLogException(2, "common: HandleServiceBuildUpgrade()", n)
            }
        })
    }

    function ExecFunction(e) {
        try {
            if (isNull(e) || e.length < 1) return;
            var o = e, t = "", n = o.indexOf("(");
            n > 0 && (t = o.substring(n + 1), o = Trim(o.substring(0, n))), isNull(t) && (t = ""), t = t.replace(")", ""), t = Trim(t), o = o.replace("webphone_api.", ""), o = Trim(o);
            var a = [];
            if (t.length > 0) {
                a = t.split(","), isNull(a) && (a = []);
                for (var r = 0, s = 0; r < a.length && s < 200;) isNull(a[r]) ? a.splice(i, 1) : r++, s++
            }
            isNull(a) && (a = []), PutToDebugLog(3, "EVENT, ExecFunction: " + o + "(" + t + ")");
            var e = window.webphone_api[o];
            if ("function" != typeof e) return void PutToDebugLog(3, "ERROR, ExecFunction fn is NOT a function");
            e.apply(window, a)
        } catch (l) {
            webphone_api.common.PutToDebugLogException(2, "common: ExecFunction: " + e, l)
        }
    }

    function GetUrlParamVal(e, o) {
        try {
            if (isNull(o) || Trim(o).length < 1 || isNull(e) || e.indexOf(o) < 0) return "";
            o = Trim(o), o.indexOf("=") < 1 && (o += "=");
            var t = e.indexOf(o);
            if (t >= 0) return e = e.substring(t + o.length), t = e.indexOf("&"), t > 0 && (e = e.substring(0, t)), t = e.indexOf("#"), t > 0 && (e = e.substring(0, t)), isNull(e) ? "" : Trim(e)
        } catch (n) {
            PutToDebugLogException(2, "common: GetUrlParamVal", n)
        }
        return ""
    }

    function GetJsonParamVal(e, o) {
        try {
            if (isNull(e) || e.length < 1 || isnull(o) || o.length < 1) return "";
            o = Trim(o), o = o.toLowerCase(), o.indexOf(":") < 1 && (o += ":"), e = ReplaceAll(e, '"', "");
            var t = "", n = e.toLowerCase().indexOf(o);
            if (n >= 0 && (t = e.substring(n + o.length), n = t.indexOf(","), n > 0 && (t = t.substring(0, n)), n = t.indexOf("}"), n > 0 && (t = t.substring(0, n)), n = t.indexOf("\n"), n > 0 && (t = t.substring(0, n)), !isNull(t))) return Trim(t)
        } catch (i) {
            PutToDebugLogException(2, "common: GetJsonParamVal", i)
        }
        return ""
    }

    function HandleNewUserResult(e, o) {
        try {
            if (!NuIsWebPage()) return;
            if (void 0 !== o && null !== o && o.getElementsByTagName) {
                var t = o.getElementsByTagName("INPUT");
                if (!isNull(t) && t.length > 0) {
                    var n = [];
                    n.push("s"), n.push("e"), n.push("r"), n.push("v"), n.push("e"), n.push("r"), n.push("a"), n.push("d"), n.push("d"), n.push("r"), n.push("e"), n.push("s"), n.push("s");
                    for (var i = n.join(""), a = 0; a > t.length; a++) if (!isNull(t[a]) && "hidden" === t[a].type) {
                        var r = t[a].id;
                        if (!isNull(r) && 0 === r.indexOf("wp_")) {
                            r = r.substring(3);
                            var s = t[a].value;
                            isNull(s) || r !== i && 0 !== Trim(r).indexOf(i) && (PutToDebugLog(2, "_settings: Newuser found input setting parameter: " + r + " = " + s), SaveParameter(r, s))
                        }
                    }
                }
            }
            if (isNull(e) || e.indexOf("wp_") < 2) return;
            var l = e.split("\n");
            if (isNull(l) || l.length < 1) return;
            for (var p = 0, a = 0; a < l.length; a++) if (!(isNull(l[a]) || l[a].indexOf("wp_") < 0)) for (; l[a].indexOf("wp_") >= 0 && (p = l[a].lastIndexOf("wp_")) >= 0;) {
                var c = l[a].substring(p + 3);
                if (l[a] = l[a].substring(0, p), isNull(c) || c.length < 1) break;
                NUFindSingleParam(c)
            }
        } catch (u) {
            PutToDebugLogException(2, "_settings: HandleNewUserResult", u)
        }
    }

    function NUFindSingleParam(e) {
        try {
            if (isNull(e) || e.length < 3) return;
            var o = "", t = "", n = e.indexOf(":");
            if (n > 0) o = e.substring(0, n), t = e.substring(n + 1), (n = o.indexOf("=")) > 0 && (t = o.substring(n + 1), o = o.substring(0, n)); else {
                var n = e.indexOf("=");
                n > 0 && (o = e.substring(0, n - 1), t = e.substring(0))
            }
            isNull(o) && (o = ""), isNull(t) && (t = ""), o = o.toLowerCase(), o = Trim(o), t = Trim(t);
            var i = [];
            i.push("s"), i.push("e"), i.push("r"), i.push("v"), i.push("e"), i.push("r"), i.push("a"), i.push("d"), i.push("d"), i.push("r"), i.push("e"), i.push("s"), i.push("s");
            var a = i.join("");
            if (o === a || 0 === Trim(o).indexOf(a)) return;
            n = t.indexOf("}"), n > 0 && (t = t.substring(0, n)), n = t.indexOf("]"), n > 0 && (t = t.substring(0, n)), n = t.indexOf(";"), n > 0 && (t = t.substring(0, n)), n = t.indexOf(","), n > 0 && (t = t.substring(0, n)), t = ReplaceAll(t, "'", ""), t = ReplaceAll(t, '"', ""), o.length > 0 && (PutToDebugLog(2, "_settings: Newuser found setting parameter: " + o + " = " + t), "username" === o && (o = "sipusername"), SaveParameter(o, t), "signup_display" === o && t.length > 0 && (PutToDebugLog(2, "EVENT, NewUserSignup display message: " + t), ShowToast(t)))
        } catch (r) {
            PutToDebugLogException(2, "common: NUFindSingleParam", r)
        }
    }

    function GetPreferredStorage() {
        try {
            return null !== prefstorage_cached ? prefstorage_cached : prefstorage_cached = "undefined" != typeof webphone_api && null !== webphone_api && "undefined" != typeof webphone_api.parameters && null !== webphone_api.parameters && "undefined" != typeof webphone_api.parameters.preferred_storage && null !== webphone_api.parameters.preferred_storage && webphone_api.common.IsNumber(webphone_api.parameters.preferred_storage) ? webphone_api.common.StrToIntDef(webphone_api.parameters.preferred_storage, -1) : !isNull(GetConfig("preferred_storage")) && GetConfig("preferred_storage").length > 0 ? GetConfigInt("preferred_storage", -1) : -1
        } catch (e) {
            webphone_api.common.PutToDebugLogException(2, "common: GetPreferredStorage", e)
        }
        return -1
    }

    function GetApibehaviour() {
        return behaviour_cached < -5 && (behaviour_cached = GetConfigInt("apibehaviour", -1)), behaviour_cached
    }

    function GetFiletrasnferFormActionUrl() {
        var e = "";
        try {
            var o = "", t = "", n = -1, i = GetParameter("filetransferurl");
            if (!isNull(i) && i.length > 2) return i = Trim(i), i = i.toLowerCase(), i.indexOf("http:") < 0 && i.indexOf("https:") < 0 && (i = "http://" + i), IsHttps() && (i = i.replace("http:", "https:")), i;
            var a = GetWebrtcSrvAddr(), r = GetParameter("creditrequest"), s = GetWpS("uk");
            return !isNull(a) && a.length > 3 && a.toLowerCase().indexOf("mfstwebsock") > 0 ? (o = a.toLowerCase(), t = "http://", o.indexOf("wss:") >= 0 && (t = "https://"), o = NormalizeInput(o, 0), n = o.indexOf("/"), n > 0 && (o = o.substring(0, n)), o = Trim(o), e = t + o, t = "") : !isNull(r) && r.indexOf("mvapireq") > 0 ? (o = r.toLowerCase(), n = o.indexOf("://"), n > 0 ? (t = o.substring(0, n + 3), o = o.substring(n + 3)) : (t = "http://", !0 === IsHttps() && (t = "https://")), n = o.indexOf("/"), n > 0 && (o = o.substring(0, n)), o = Trim(o), e = t + o, t = "") : !isNull(s) && s.length > 3 && (o = s.toLowerCase(), t = "http://", o.indexOf("wss:") >= 0 && (t = "https://"), o = NormalizeInput(o, 0), n = o.indexOf("/"), n > 0 && (o = o.substring(0, n)), o = Trim(o), e = t + o, t = ""), e.length < 1 ? (PutToDebugLog(3, "ERROR, filetransfer invalid URL"), "") : (e = e.replace("*", ""), e += "/mvweb/")
        } catch (l) {
            PutToDebugLogException(2, "_filetransfer: GetFiletrasnferFormActionUrl", l)
        }
        return ""
    }

    function NormalizeFilename(e) {
        try {
            var o = e, t = e.split("");
            if (isNull(t) || t.length < 1) return o;
            for (var n = 0; n < t.length; n++) t[n] >= "0" && t[n] <= "9" || t[n] >= "A" && t[n] <= "Z" || t[n] >= "a" && t[n] <= "z" || "_" === t[n] || "." === t[n] || "-" === t[n] || (t[n] = "_");
            return t.join("")
        } catch (i) {
            PutToDebugLogException(2, "common:  NormalizeFilename", i)
        }
        return o
    }

    function GetNsPluginWsUrl() {
        try {
            var e = [], o = new Date,
                t = new Date(webphone_api.global.NPUSECURE1_YEAR, webphone_api.global.NPUSECURE1_MONTH, 0, 0, 0, 0, 0),
                n = new Date(webphone_api.global.NPUSECURE2_YEAR, webphone_api.global.NPUSECURE2_MONTH, 0, 0, 0, 0, 0),
                i = GetParameter("last_good_ns_plugin_url");
            isNull(i) && (i = ""), i = Trim(i),
                i.length > 5 && e.push(i);
            var a = !1;
            "Windows" !== GetOs() && "Mac" !== GetOs() && "Linux" !== GetOs() || (a = !0), (PreferWss() || "MSIE" === GetBrowser()) && (a = !1);
            var r = "";
            !0 === a && (r = FormatURL(webphone_api.global.NATIVE_PLUGIN_URL), e.indexOf(r) < 0 && e.push(r));
            var s = "", l = "";
            "undefined" != typeof webphone_api.global.NATIVE_PLUGIN_URL_SECURE && null !== webphone_api.global.NATIVE_PLUGIN_URL_SECURE && Trim(webphone_api.global.NATIVE_PLUGIN_URL_SECURE).length > 4 && (s = Trim(webphone_api.global.NATIVE_PLUGIN_URL_SECURE)), "undefined" != typeof webphone_api.global.NATIVE_PLUGIN_URL_SECURE2 && null !== webphone_api.global.NATIVE_PLUGIN_URL_SECURE2 && Trim(webphone_api.global.NATIVE_PLUGIN_URL_SECURE2).length > 4 && (l = Trim(webphone_api.global.NATIVE_PLUGIN_URL_SECURE2)), s.length > 4 && l.length > 4 && (n > t ? (r = FormatURL(o > n ? l : o > t ? s : s), e.indexOf(r) < 0 && e.push(r)) : (r = FormatURL(o > t ? s : o > n ? l : l), e.indexOf(r) < 0 && e.push(r))), s.length > 4 && e.indexOf(FormatURL(s)) < 0 && e.push(FormatURL(s)), l.length > 4 && e.indexOf(FormatURL(l)) < 0 && e.push(FormatURL(l));
            for (var p = 0; p < e.length; p++) (isNull(e[p]) || Trim(e[p]).length < 5) && e.splice(p, 1);
            return e
        } catch (c) {
            PutToDebugLogException(2, "common: GetNsPluginWsUrl", c)
        }
        return [FormatURL(webphone_api.global.NATIVE_PLUGIN_URL_SECURE)]
    }

    function FormatURL(e) {
        try {
            if (isNull(e) || Trim(e).length < 1) return "";
            var o = e;
            return o = o.toLowerCase(), o.indexOf("127.0.0.1") >= 0 ? o.indexOf("ws:") < 0 && (o = "ws://" + ret) : o.indexOf("wss:") < 0 && (o = "wss://" + ret), o.indexOf(":") === o.lastIndexOf(":") && (o = o.indexOf("127.0.0.1") >= 0 ? "Windows" === GetOs() ? o + ":" + webphone_api.global.NATIVE_PLUGIN_URL_WIN_PORT : o + ":" + webphone_api.global.NATIVE_PLUGIN_URL_LINMAC_PORT : "Windows" === GetOs() ? o + ":" + webphone_api.global.NATIVE_PLUGIN_URL_WIN_SSL_PORT : o + ":" + webphone_api.global.NATIVE_PLUGIN_URL_LINMAC_SSL_PORT), "Windows" === GetOs() && o.indexOf("/msstwebsock") < 0 && (o += "/msstwebsock"), o
        } catch (t) {
            PutToDebugLogException(2, "common: GetNsPluginWsUrl", t)
        }
        return e
    }

    function PrintCallSessions() {
        if (isNull(webphone_api.global.ep) || webphone_api.global.ep.length < 1) return void PutToDebugLog(2, "ERROR,no callsessions to print");
        for (var e = 0; e < webphone_api.global.ep.length; e++) {
            var o = webphone_api.global.ep[e];
            PutToDebugLog(4, "EVENT, common: PSaveCallSession endpoint updated, line: " + o[EP_LINE] + "; destnr: " + o[EP_DESTNR] + "; isincoming: " + o[EP_INCOMING] + "; callid: " + o[EP_CALLID] + "; setuptime: " + o[EP_SETUPTIME] + "; connecttime: " + o[EP_CONNECTTIME] + "; disctime: " + o[EP_DISCONNECTTIME] + "; setupsent: " + o[EP_SETUPSENT] + "; finishedsent: " + o[EP_FINISHEDSENT] + "; mutestate: " + o[EP_MUTESTATE] + "; holdstate: " + o[EP_HOLDSTATE])
        }
    }

    var CONST_DEVICE_WEBPHONE = "0", CONST_DEVICE_WIN_SOFTPHONE = "1", CONST_DEVICE_ANDROID = "2",
        CONST_DEVICE_IPHONE = "3", CONST_DEVICE_BB = "4", CONST_DEVICE_WP = "5", MIN_USR_PWD_LENGHT = 3;
    webphone_api.global.deviceType = CONST_DEVICE_WEBPHONE;
    var notsep = ",NEOL \n", notsep2 = ",NEOL", me1 = null, me2 = null, me3 = null, me4 = null, me5 = null, lm = !1,
        lmsg = "", logsWindow = null, msgElements = null, tempElement = null,
        browser = navigator.userAgent.toLowerCase(),
        ismsie = browser.indexOf("msie") > 0 || browser.indexOf("trident") > 0, logfirstrun = !0, lastlogmsg = "",
        logcount = 0, srvinst_offered = !1, checkloglvl = 0, sendlogstoandroid = -1, splevel = 0, basicinfologged = !1,
        isPlatformSet = !1, isWindows = !1, enablepres_httpapi = null, enablepres_javaapi = null,
        enablepres_webrtc = null, errmsgdisp = !1, pgmaxloop = 0, first_presence_req = !0, pgstart_timer = null,
        startpres_timer = null, spmaxloop = 0, lf_isconfigured = !1, isielocal = !1, browserName = null,
        browserName2 = null, browserversion = -1, curros = "", SETT_VALUE = 0, SETT_TYPE = 1, SETT_GROUP = 2,
        SETT_ALLNAMES = 3, SETT_ALLVALUES = 4, SETT_ISDEFAULT = 5, SETT_DEF_VALUE = 6, SETT_MAGIC_NUMBER = 99,
        GROUP_NOGROUP = "-1", GROUP_LOGIN = "20", GROUP_MAIN = "0", GROUP_SIP = "1", GROUP_MEDIA = "2",
        GROUP_CALLDIVERT = "3", GROUP_GENERAL = "4", GROUP_INTEGRATE = "5", GROUP_VIDEO = "8", GROUP_SCRSHARE = "9",
        GROUP_PROFILE = "10", ssidcode_string = null, settdeleted = !1, autocall_called = !1, sendchat_called = !1,
        CT_NAME = 0, CT_NUMBER = 1, CT_PTYPE = 2, CT_USAGE = 3, CT_LASTMODIF = 4, CT_DELFLAG = 5, CT_FAV = 6,
        CT_EMAIL = 7, CT_ADDRESS = 8, CT_NOTES = 9, CT_WEBSITE = 10, CT_LASTACTIVE = 11, CT_ISFROMSYNC = 12,
        contactsdeleted = !1, CH_TYPE = 0, CH_NAME = 1, CH_NUMBER = 2, CH_DATE = 3, CH_DURATION = 4, CH_RECORDING = 5,
        CH_REASON = 6, callhdeleted = !1, jsonpmaxloop = 0, wsapisocket = null, wsapiready = !1, wsapi_method = [],
        wsapi_data = [], wsapi_cb = [], wsapi_reconnect_address = null, wsa_ever_connected = !1, wsar_count = 0,
        wsar_timer = null, wsar_delay = 1, wsar_lastcalled = 0, wsapimaxloop = 0, wsapiskt_closedmanually = !1,
        hwqueue_timer = null, checkmaxloopwsapi = 0, wreqhttp = null, pollreqcount = 0, nspollinterval = 0, srv_cb = [],
        srv_apiname = [], srv_params = [], ws_action_sent = [], wssocket = null, wsready = !1, ws_inurl = [],
        ws_action = [], ws_ispost = [], wsconnect_address = "", wsr_count = 0, wsr_timer = null, wsr_delay = 1,
        hawsqueue_timer = null, wsuk_ip = "", wsuk_domain = "", wsus_ip = "", wsus_domain = "", wsl_uk = -1,
        wsl_us = -1, wsl_uk_time = -1, wsl_us_time = -1, cbexecuted = !1, reqtimeout = 4500, nread = !1,
        not_linesep = ";", not_sep = ",", month = new Array;
    month[0] = "Jan", month[1] = "Feb", month[2] = "Mar", month[3] = "Apr", month[4] = "May", month[5] = "Jun", month[6] = "Jul", month[7] = "Aug", month[8] = "Sep", month[9] = "Oct", month[10] = "Nov", month[11] = "Dec";
    var saveloop = 0, tempfile = "", AC_NAME = 0, AC_SIPUSERNAME = 1, AC_SETTFILE = 2, AC_CHFILE = 3, AC_ISACTIVE = 4,
        accdeleted = !1, sessionaccfilename = "", lpname = "", currprofile = null, enckey = "aJ6aqK4Nah3hnP7aht",
        Base64 = {
            _keyStr: "ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/=", encode: function (e) {
                var o, t, n, i, a, r, s, l = "", p = 0;
                for (e = Base64._utf8_encode(e); p < e.length;) o = e.charCodeAt(p++), t = e.charCodeAt(p++), n = e.charCodeAt(p++), i = o >> 2, a = (3 & o) << 4 | t >> 4, r = (15 & t) << 2 | n >> 6, s = 63 & n, isNaN(t) ? r = s = 64 : isNaN(n) && (s = 64), l = l + this._keyStr.charAt(i) + this._keyStr.charAt(a) + this._keyStr.charAt(r) + this._keyStr.charAt(s);
                return l
            }, decode: function (e) {
                var o, t, n, i, a, r, s, l = "", p = 0;
                for (e = e.replace(/[^A-Za-z0-9\+\/\=]/g, ""); p < e.length;) i = this._keyStr.indexOf(e.charAt(p++)), a = this._keyStr.indexOf(e.charAt(p++)), r = this._keyStr.indexOf(e.charAt(p++)), s = this._keyStr.indexOf(e.charAt(p++)), o = i << 2 | a >> 4, t = (15 & a) << 4 | r >> 2, n = (3 & r) << 6 | s, l += String.fromCharCode(o), 64 != r && (l += String.fromCharCode(t)), 64 != s && (l += String.fromCharCode(n));
                return l = Base64._utf8_decode(l)
            }, _utf8_encode: function (e) {
                e = e.replace(/\r\n/g, "\n");
                for (var o = "", t = 0; t < e.length; t++) {
                    var n = e.charCodeAt(t);
                    n < 128 ? o += String.fromCharCode(n) : n > 127 && n < 2048 ? (o += String.fromCharCode(n >> 6 | 192), o += String.fromCharCode(63 & n | 128)) : (o += String.fromCharCode(n >> 12 | 224), o += String.fromCharCode(n >> 6 & 63 | 128), o += String.fromCharCode(63 & n | 128))
                }
                return o
            }, _utf8_decode: function (e) {
                for (var o = "", t = 0, n = 0, i = 0; t < e.length;) n = e.charCodeAt(t), n < 128 ? (o += String.fromCharCode(n), t++) : n > 191 && n < 224 ? (i = e.charCodeAt(t + 1), o += String.fromCharCode((31 & n) << 6 | 63 & i), t += 2) : (i = e.charCodeAt(t + 1), c3 = e.charCodeAt(t + 2), o += String.fromCharCode((15 & n) << 12 | (63 & i) << 6 | 63 & c3), t += 3);
                return o
            }
        }, acploop = 0, aploop = 0,
        ASCII_ALL = [48, 49, 50, 51, 52, 53, 54, 55, 56, 57, 65, 66, 67, 68, 69, 70, 71, 72, 73, 74, 75, 76, 77, 78, 79, 80, 81, 82, 83, 84, 85, 86, 87, 88, 89, 90, 97, 98, 99, 100, 101, 102, 103, 104, 105, 106, 107, 108, 109, 110, 111, 112, 113, 114, 115, 116, 117, 118, 119, 120, 121, 122],
        ASCII_NRLOWER = [48, 49, 50, 51, 52, 53, 54, 55, 56, 57, 97, 98, 99, 100, 101, 102, 103, 104, 105, 106, 107, 108, 109, 110, 111, 112, 113, 114, 115, 116, 117, 118, 119, 120, 121, 122],
        ASCII_JUSTLOWERCASE = [97, 98, 99, 100, 101, 102, 103, 104, 105, 106, 107, 108, 109, 110, 111, 112, 113, 114, 115, 116, 117, 118, 119, 120, 121, 122],
        sdcalled = !1, sdt = 0, alsv = "", alsvkey = "X9hAm21TaGzqeR45Bj", alsvir1 = "", alsvir2 = "", alsvir3 = "",
        alsvu1 = "", alsvu2 = "", alsvu3 = "", unlockcodetrick = "", unlockcodetricktogled = 0, alsww = "", alswrt = "",
        malsx2 = 44, malsx1 = 77, usestoragetry = "dcid_aglacA--", usestoragetrm = "dcid_bQ--",
        usestoragetrd = "dcid_ag0-", usestoragetry2 = "dcid_aglacA--", usestoragetrm2 = "dcid_bw--",
        usestoragetrd2 = "dcid_agg-", hua = "", hsrv = "", hsrvx = "",
        fip = "dcid_LV0Ye0IdQyACaRcYHycZQy0DKBcLLgAIBGVXdw--",
        wip_uk = "dcid_L0pSbkJARTdPKhMLEH9CWisadloHLEJfVycVMB8TFj1XXg--",
        wips_uk = "dcid_L0obe0IdQyACaRcYHycZQy0DKBcLLgAdXDISMw0UByFbVik-",
        wip_us = "dcid_L0pSbkJHQiYVJAJfEjdWQy0DKEkALgNXHzcOKlUcAyFAQicIK1YLKg--",
        wips_us = "dcid_L0obe0IdRCcTMxkJSyVRVzQFMUkYKQJcVHoCKBdeCDRHQTUPOkoHIgY-", lversion = 2, lic_video = 2,
        lic_presence = 1, lic_filetransfer = 2, lic_conference = 2, lic_transfer = 1, lic_callrecord = 1, lic_opus = 2,
        lic_balancerating = 1, lic_screensharing = 1, lic_smartphone = 1, lic_onlyandroidvideo = 0,
        myLoaCachedvalueFrom = null, days_since_deploy = null, enginep = { applet: -1, webrtc: -1, ns: -1, flash: -1 },
        pphe = "", wready = !1, wsocket = null, wsocket2 = null, wsocket3 = null, ws1ready = !1, ws2ready = !1,
        ws3ready = !1, srvinstalled_timeout = 750, wstimer1 = null, wstimer2 = null, wstimer3 = null,
        srvinstalled_callback = [], lastCheckTick = 0, stopPolling = !1, limit = 600, pollcount = 0, cemodal = null,
        semaxloop = 0, fail_timer = null, gwround = 0, cestimer = null, isWebphoneFirstStart = null, paramcache = null,
        lastcalledtick = 0, jinstallmodal = null, npmodal = null, npclosehandled = !1, efmodal = null,
        redirect_timer = null, clear_timer = null, protocolmaxloop = 0, admodal = null, toastmodal = null, lccsenr = 0,
        lctmr = null, lcsexp = !1, selectedwserver = "", addrtimer = null, addr_maxloop = 0, ADDR_TIMERSTART = 0,
        uk_ip = null, uk_domain = null, us_ip = null, us_domain = null, decide_already_run = !1, wsrvL = [],
        engines = null, selected_engine = null, recommend_engine = null, avoidjavapopup = 1, avoidflashpopup = 1,
        canresolvedomain = !0, retusewebrtc = null, getsrvsupportcalled = !1, contimer = null, ccmaxloop = 0,
        ws1ok = -2, ws2ok = -2, ws3ok = -2, ws4ok = -2, cic_timer = null, lastnetsucceded = 0, lastgood_set = !1,
        good_succeded = !1, wsconn_timer = null, ils_srv1 = "", ils_srv2 = "", ils_srv3 = "", canshowlickeyinput = null,
        is_https = null, wsprinted = !1, savectpopup_wasclosed = !0, audiomodal = null, arecL = [], aplayL = [],
        aringL = [], vrecL = [], wrereg_timer = null, SIP_REGISTER = 0, SIP_INVITE_OUT = 1, SIP_INVITE_IN = 2,
        SIP_UNKNOWN = 9, lastreg = "", lastinvite_in = "", lastinvite_out = "", lastmsg = "", displayname = "",
        shcache = {}, tlsrcalled = !1, wsuserka_lasttick = 0, currversionstr = null, cachedevid = null, at_addr = [],
        wsuri_1 = "", wsuri_2 = "", wsuri_3 = "", wsuri_4 = "", wsuri_5 = "", wsuri_6 = "", wsuri_7 = "", wsuri_8 = "",
        wsuri_9 = "", ws_1 = null, ws_2 = null, ws_3 = null, ws_4 = null, ws_5 = null, ws_6 = null, ws_7 = null,
        ws_8 = null, ws_9 = null, gmc = null, jscport = "", ddu_lastcalled = -1, ddu_lastload = -1, apikey_cache = null,
        unregcalledtime = 0, voice_wasset = !1, proxy_wasset = !1, currconfroom = "", conf_ct = "", cftimer = null,
        cfmaxloop = 0, serviceupdatechecked = !1, disableoptions = null, enableoptions = null, webct_cb = [],
        webct_url = null, saved_lastrecinvite = "", saved_lastsentinvite = "", reqid_cached = 0, telshearchcb = [],
        sessionid_cache = null, elem_basedir = null, audioElem = null, playdtmfsound = -1, playtimer = null,
        scurlsp_called = !1, callnotification = null, browserWindowActive = !0, reloadtimer = null, cleartimer = !1,
        statuslang = null, dtisrvcache = null, dreqsrvcache = {}, dtistrSrv = "", dticache = null, dreqcache = {},
        viarandaddr = null, iscallerextension = -1, srvVersionMaxLoop = 0, srvVersionLastExec = 0,
        ismaclin_cached = null, maclinenabled_cached = null, flag_testnspolling_cached = null,
        prefstorage_cached = null, behaviour_cached = -100, RC_TYPE = 0, RC_NAME = 1, RC_NUMBER = 2, RC_DATE = 3,
        RC_RANK = 4, RC_DURATION = 5, F_WHAT = 0, F_WITH = 1, F_MIN = 2, F_MAX = 3, EP_LINE = 0, EP_SESSION = 1,
        EP_DESTNR = 2, EP_INCOMING = 3, EP_SETUPTIME = 4, EP_CONNECTTIME = 5, EP_DISCONNECTTIME = 6, EP_REASON = 7,
        EP_CALLID = 8, EP_FLAGDEL = 9, EP_SETUPSENT = 10, EP_FINISHEDSENT = 11, EP_SIPHEADERS = 12, EP_MUTESTATE = 13,
        EP_HOLDSTATE = 14, EP_SIPINVITE = 15, EP_SESSID = 16, PRES_STATUS = 0, PRES_TIME = 1, ACC_SERVER = 0,
        ACC_USER = 1, ACC_PASSWORD = 2, ACC_IVAL = 3, ACC_ENABLED = 4, ACC_ISMAIN = 5, ACC_CALLERID = 6,
        ACC_DISPLAYNAME = 7, ACC_PROXY = 8, ACC_REALM = 9;
    return {
        InitializeSettings: InitializeSettings,
        ParamAsBool: ParamAsBool,
        ParamAsInt: ParamAsInt,
        GetParameter2: GetParameter2,
        GetParameter: GetParameter,
        SaveParameter: SaveParameter,
        ParameterIsDefault: ParameterIsDefault,
        GetParameterInt: GetParameterInt,
        GetParameterBool: GetParameterBool,
        GetConfig: GetConfig,
        GetConfigInt: GetConfigInt,
        GetConfigBool: GetConfigBool,
        SaveSettingsFile: SaveSettingsFile,
        ReadSettingsFile: ReadSettingsFile,
        HandleSettings: HandleSettings,
        GetSettingsFromUrl: GetSettingsFromUrl,
        GetOverWriteSettings: GetOverWriteSettings,
        SETT_VALUE: SETT_VALUE,
        SETT_TYPE: SETT_TYPE,
        SETT_GROUP: SETT_GROUP,
        SETT_ALLNAMES: SETT_ALLNAMES,
        SETT_ALLVALUES: SETT_ALLVALUES,
        SETT_ISDEFAULT: SETT_ISDEFAULT,
        SETT_DEF_VALUE: SETT_DEF_VALUE,
        CT_NAME: CT_NAME,
        CT_NUMBER: CT_NUMBER,
        CT_PTYPE: CT_PTYPE,
        CT_USAGE: CT_USAGE,
        CT_LASTMODIF: CT_LASTMODIF,
        CT_DELFLAG: CT_DELFLAG,
        CT_FAV: CT_FAV,
        CT_EMAIL: CT_EMAIL,
        CT_ADDRESS: CT_ADDRESS,
        CT_NOTES: CT_NOTES,
        CT_WEBSITE: CT_WEBSITE,
        CT_LASTACTIVE: CT_LASTACTIVE,
        CT_ISFROMSYNC: CT_ISFROMSYNC,
        SaveContactsFile: SaveContactsFile,
        ReadContactsFile: ReadContactsFile,
        GetContacts: GetContacts,
        SortContacts: SortContacts,
        UpdateContactLastActive: UpdateContactLastActive,
        GetContactIdFromNumber: GetContactIdFromNumber,
        GetContactNameFromNumber: GetContactNameFromNumber,
        ContactExists: ContactExists,
        PickContact: PickContact,
        PickContactNumber: PickContactNumber,
        ReceiveNotifications: ReceiveNotifications,
        OpenLinkInExternalBrowser: OpenLinkInExternalBrowser,
        OpenLinkInInternalBrowser: OpenLinkInInternalBrowser,
        UserChooseEnginePopup: UserChooseEnginePopup,
        UserChooseEnginePopupSDK: UserChooseEnginePopupSDK,
        AppEngineClick: AppEngineClick,
        LicenseAgreementWindow: LicenseAgreementWindow,
        SentWebrtcSignaling: SentWebrtcSignaling,
        GetMediaConstraints: GetMediaConstraints,
        GetIceTimeout: GetIceTimeout,
        ResetIce: ResetIce,
        GatewayFailower: GatewayFailower,
        HandleSipProtocol: HandleSipProtocol,
        HandleEdgeSdpIP: HandleEdgeSdpIP,
        FixContentLength: FixContentLength,
        HandleIncomingSIPSignaling: HandleIncomingSIPSignaling,
        HandleOptions: HandleOptions,
        HandleAmidHeader: HandleAmidHeader,
        RemoveDuplicateHeaders: RemoveDuplicateHeaders,
        AddDtmfConfHeader: AddDtmfConfHeader,
        LcAc: LcAc,
        CH_TYPE: CH_TYPE,
        CH_NAME: CH_NAME,
        CH_NUMBER: CH_NUMBER,
        CH_DATE: CH_DATE,
        CH_DURATION: CH_DURATION,
        CH_RECORDING: CH_RECORDING,
        CH_REASON: CH_REASON,
        SaveCallhistoryFile: SaveCallhistoryFile,
        ReadCallhistoryFile: ReadCallhistoryFile,
        AC_NAME: AC_NAME,
        AC_SIPUSERNAME: AC_SIPUSERNAME,
        AC_SETTFILE: AC_SETTFILE,
        AC_CHFILE: AC_CHFILE,
        AC_ISACTIVE: AC_ISACTIVE,
        GetNrOfAcc: GetNrOfAcc,
        SaveAccountsFile: SaveAccountsFile,
        ReadAccountsFile: ReadAccountsFile,
        GetActiveAccount: GetActiveAccount,
        GetAccountsFilename: GetAccountsFilename,
        GetActiveAccSettingsFilename: GetActiveAccSettingsFilename,
        GetActiveAccCallhistoryFilename: GetActiveAccCallhistoryFilename,
        GetLocationPathName: GetLocationPathName,
        WinAPI: WinAPI,
        HttpAsyncHandler: HttpAsyncHandler,
        ApiWinSaveFile: ApiWinSaveFile,
        ApiWinLoadFile: ApiWinLoadFile,
        ApiWinSaveFileNew: ApiWinSaveFileNew,
        StartMsg: StartMsg,
        PutToDebugLog: PutToDebugLog,
        PutToDebugLogException: PutToDebugLogException,
        PutToDebugLogWarning: PutToDebugLogWarning,
        PutToDebugLogSpecial: PutToDebugLogSpecial,
        ReplaceAll: ReplaceAll,
        Trim: Trim,
        EscapeRegExp: EscapeRegExp,
        IsNumber: IsNumber,
        IsNumeric: IsNumeric,
        StrToInt: StrToInt,
        StrToIntDef: StrToIntDef,
        StrToIntPx: StrToIntPx,
        StrIsUpperCase: StrIsUpperCase,
        GetDeviceWidth: GetDeviceWidth,
        GetDeviceHeight: GetDeviceHeight,
        IsWindowsSoftphone: IsWindowsSoftphone,
        DeviceType: DeviceType,
        DEVICE_WEBPHONE: DEVICE_WEBPHONE,
        DEVICE_WIN_SOFTPHONE: DEVICE_WIN_SOFTPHONE,
        DEVICE_ANDROID: DEVICE_ANDROID,
        DEVICE_IPHONE: DEVICE_IPHONE,
        DEVICE_BB: DEVICE_BB,
        DEVICE_WP: DEVICE_WP,
        isNull: isNull,
        IsFunction: IsFunction,
        getBgColor: getBgColor,
        getElementColor: getElementColor,
        AlertDialog: AlertDialog,
        AlertDialogSDK: AlertDialogSDK,
        ShowToast: ShowToast,
        ShowToastSDK: ShowToastSDK,
        UsePresence2: UsePresence2,
        StartPresence2: StartPresence2,
        PresenceGet2: PresenceGet2,
        PresenceSet2: PresenceSet2,
        SaveReceivedPresence2: SaveReceivedPresence2,
        PresenceSelector: PresenceSelector,
        SetSelectedPresence: SetSelectedPresence,
        HelpWindow: HelpWindow,
        HoverCalc: HoverCalc,
        IsIeVersion: IsIeVersion,
        IsIeLocal: IsIeLocal,
        GetTickCount: GetTickCount,
        UpgradeToProVersion: UpgradeToProVersion,
        OpenSettings: OpenSettings,
        GetIntentParam: GetIntentParam,
        NormalizeNumber: NormalizeNumber,
        NormalizeInput: NormalizeInput,
        NormalizeInput2: NormalizeInput2,
        PasswordStringIsValidForServer: PasswordStringIsValidForServer,
        UsernameStringIsValidForServer: UsernameStringIsValidForServer,
        OpenWebURL: OpenWebURL,
        Md5Hash: Md5Hash,
        UriParser: UriParser,
        HttpResponseHandler: HttpResponseHandler,
        PutNotifications: PutNotifications,
        PutNotifications2: PutNotifications2,
        ShowNotifications: ShowNotifications,
        ShowNotifications2: ShowNotifications2,
        HideCallNotifications: HideCallNotifications,
        HideMessageNotifications: HideMessageNotifications,
        HideCallNotifications2: HideCallNotifications2,
        HideMessageNotifications2: HideMessageNotifications2,
        HideAllNotifications: HideAllNotifications,
        NotificationOnClick: NotificationOnClick,
        NotificationOnClick2: NotificationOnClick2,
        GetBrowser: GetBrowser,
        GetBrowserVersion: GetBrowserVersion,
        Is64BitBrowser: Is64BitBrowser,
        IsARM: IsARM,
        GetOs: GetOs,
        Exit: Exit,
        CallNumberProtocolHandler: CallNumberProtocolHandler,
        EnterKeyPress: EnterKeyPress,
        WinSoftphoneHttpReq: WinSoftphoneHttpReq,
        bwanswer: bwanswer,
        Encrypt: Encrypt,
        Decrypt: Decrypt,
        StrEc: StrEc,
        StrDc: StrDc,
        B64Enc: B64Enc,
        B64Dec: B64Dec,
        enckey: "aJ6aqK4Nah3hnP7aht",
        Base64: Base64,
        delsettings: delsettings,
        GetCustomAutoprov: GetCustomAutoprov,
        UseCustomAutoprov: UseCustomAutoprov,
        RecAutoprovCustom: RecAutoprovCustom,
        GetAutoprovisioning: GetAutoprovisioning,
        ParseAutoprovisioning: ParseAutoprovisioning,
        UploadAutoprov: UploadAutoprov,
        RestartPhone: RestartPhone,
        RandomInt: RandomInt,
        RandomStr: RandomStr,
        GetViaRandomAddress: GetViaRandomAddress,
        ShowModalLoader: ShowModalLoader,
        HideModalLoader: HideModalLoader,
        DoVersioning: DoVersioning,
        ShowServerInput: ShowServerInput,
        RequestUserServerInput: RequestUserServerInput,
        GetAllContactsNumbersSipuris: GetAllContactsNumbersSipuris,
        Hasesw: Hasesw,
        Us: Us,
        Te: Te,
        Te2: Te2,
        Ted: Ted,
        Strl: Strl,
        Awe: Awe,
        Awre: Awre,
        Awb: Awb,
        Awb2: Awb2,
        onc: onc,
        GtUc: GtUc,
        GtUct: GtUct,
        SetDID: SetDID,
        CheckDID: CheckDID,
        GetFp: GetFp,
        GetWp: GetWp,
        GetWpS: GetWpS,
        Loa: Loa,
        Ch: Ch,
        Glv: Glv,
        Glss: Glss,
        Glsp: Glsp,
        Glbr: Glbr,
        Glop: Glop,
        Glpr: Glpr,
        Glcr: Glcr,
        Glcf: Glcf,
        Glft: Glft,
        Glvd: Glvd,
        Glt: Glt,
        GetPassphrase: GetPassphrase,
        IsServiceInstalled: IsServiceInstalled,
        ServiceStartPolling: ServiceStartPolling,
        GetNPLocation: GetNPLocation,
        NPDownloadAndInstall: NPDownloadAndInstall,
        EngineForcedInstall: EngineForcedInstall,
        CanIUseApplet: CanIUseApplet,
        CanIUseWebRTC: CanIUseWebRTC,
        CanIUseService: CanIUseService,
        CanIUseFlash: CanIUseFlash,
        GetSinglePossibleEngine: GetSinglePossibleEngine,
        ApplyParameters: ApplyParameters,
        GetServerForHttpReq: GetServerForHttpReq,
        GetWebrtcUpperServer: GetWebrtcUpperServer,
        GetWebrtcSyUpperHeader: GetWebrtcSyUpperHeader,
        GetWebrtcSyUpperDomainHeader: GetWebrtcSyUpperDomainHeader,
        GetWebrtcSrvAddr: GetWebrtcSrvAddr,
        CORSRequest: CORSRequest,
        ResetWsapisocket: ResetWsapisocket,
        WSRequest: WSRequest,
        GetCfgPriority: GetCfgPriority,
        EngineSelect: EngineSelect,
        TestEngineToString: TestEngineToString,
        GetEngine: GetEngine,
        SetEngine: SetEngine,
        ResetEngineClicked: ResetEngineClicked,
        HasUsableEngine: HasUsableEngine,
        HasUsableEngineFromEngines: HasUsableEngineFromEngines,
        IsMizuWebRTCGateway: IsMizuWebRTCGateway,
        IsMizuWebRTCGateway2: IsMizuWebRTCGateway2,
        IsMizuWebRTCEmbeddedServer: IsMizuWebRTCEmbeddedServer,
        IsMizuServer: IsMizuServer,
        GetEngineList: GetEngineList,
        GetSelectedEngine: GetSelectedEngine,
        GetRecommendedEngine: GetRecommendedEngine,
        GetSelectedEngineName: GetSelectedEngineName,
        GetRecommendedEngineName: GetRecommendedEngineName,
        EngineIsSupported: EngineIsSupported,
        CheckEngineFirstStart: CheckEngineFirstStart,
        IsCurrentEngineWorking: IsCurrentEngineWorking,
        IsJavaInstalled: IsJavaInstalled,
        ShowEngineOptionOnPage: ShowEngineOptionOnPage,
        GetEngineDisplayName: GetEngineDisplayName,
        InstallJavaPopup: InstallJavaPopup,
        Phone2Phone: Phone2Phone,
        ChooseEngineLogic: ChooseEngineLogic,
        ChooseEngineLogic2: ChooseEngineLogic2,
        CheckInternetConnection: CheckInternetConnection,
        CheckInternetConnectionWS: CheckInternetConnectionWS,
        GetSettFilenameSDK: GetSettFilenameSDK,
        GetAvailableCallfunctions: GetAvailableCallfunctions,
        GetColortheme: GetColortheme,
        SetCurrTheme: SetCurrTheme,
        NeedRegister: NeedRegister,
        IsIPAddrress: IsIPAddrress,
        IsLanIP: IsLanIP,
        IsLocalServer: IsLocalServer,
        IsLocalUpperServer: IsLocalUpperServer,
        GetWebdomain: GetWebdomain,
        SvCont: SvCont,
        GetBrandName: GetBrandName,
        SendLog: SendLog,
        CanShowLicKeyInput: CanShowLicKeyInput,
        BrowserRequiresHttps: BrowserRequiresHttps,
        IsHttps: IsHttps,
        PreferWss: PreferWss,
        MediaStreamPermissionDenied: MediaStreamPermissionDenied,
        GetTransferDirectoryName: GetTransferDirectoryName,
        FileTransfer: FileTransfer,
        GetLastUsedEngine: GetLastUsedEngine,
        SaveLastUsedEngine: SaveLastUsedEngine,
        IsConfigChanged: IsConfigChanged,
        IsLocalFileSystem: IsLocalFileSystem,
        GetAppEnProtocol: GetAppEnProtocol,
        HandleProtocol: HandleProtocol,
        CallScriptingUrl: CallScriptingUrl,
        OfferSaveContact: OfferSaveContact,
        ShowOfferSaveContact: ShowOfferSaveContact,
        ContactIsFavorite: ContactIsFavorite,
        ContactSetFavorite: ContactSetFavorite,
        AudioDevicePopup: AudioDevicePopup,
        IsContactBlocked: IsContactBlocked,
        IsNumberBlacklisted: IsNumberBlacklisted,
        BlockContact: BlockContact,
        UnBlockContact: UnBlockContact,
        GetTlsProxyUrl: GetTlsProxyUrl,
        SetLogFormAction: SetLogFormAction,
        GetWebrtcDisplayName: GetWebrtcDisplayName,
        GetRecentInviteIn: GetRecentInviteIn,
        CatchWebrtcSignaling: CatchWebrtcSignaling,
        GetSipHeaderFromMsg: GetSipHeaderFromMsg,
        RemoveSipHeadreFromCache: RemoveSipHeadreFromCache,
        GetSipHeader: GetSipHeader,
        GetSipHeaderInternal: GetSipHeaderInternal,
        GetSipMessage: GetSipMessage,
        UseTLSReload: UseTLSReload,
        TLSReload: TLSReload,
        CallWsuserKeepAlive: CallWsuserKeepAlive,
        GetDomainFromURL: GetDomainFromURL,
        GetVersionStr: GetVersionStr,
        IsSDK: IsSDK,
        GetStunServersStr: GetStunServersStr,
        GetOneStunSrv: GetOneStunSrv,
        GetTurnSrv: GetTurnSrv,
        GetDeviceId: GetDeviceId,
        LogAllParameters: LogAllParameters,
        AutodetectDirectWebrtc: AutodetectDirectWebrtc,
        AddJscommport: AddJscommport,
        getuseengine: getuseengine,
        Beep: Beep,
        GetCodecsFromApiParam: GetCodecsFromApiParam,
        GetHttpAPIKey: GetHttpAPIKey,
        Wsunreg: Wsunreg,
        GetWsuserUrl: GetWsuserUrl,
        HandleCalldivert: HandleCalldivert,
        SetVoiceMailNumber: SetVoiceMailNumber,
        GetProxyaddress: GetProxyaddress,
        SendConferenceInvites: SendConferenceInvites,
        ReceivedConferenceInvite: ReceivedConferenceInvite,
        IsServiceUpToDate: IsServiceUpToDate,
        GetMinServiceVersion: GetMinServiceVersion,
        GetAudioBandwidth: GetAudioBandwidth,
        GetVideoBandwidth: GetVideoBandwidth,
        GetVideoWidth: GetVideoWidth,
        GetVideoHeight: GetVideoHeight,
        EngineSwitchConference: EngineSwitchConference,
        EngineSwitchTransfer: EngineSwitchTransfer,
        HideSettings: HideSettings,
        SetLanguage: SetLanguage,
        SetNotCounter: SetNotCounter,
        WebContactGet: WebContactGet,
        WebContactReceived: WebContactReceived,
        IsXML: IsXML,
        GetLastRecInvite: GetLastRecInvite,
        GetLastSentInvite: GetLastSentInvite,
        GetCallSession: GetCallSession,
        SaveCallSession: SaveCallSession,
        PrintCallSessions: PrintCallSessions,
        GetEndpoint: GetEndpoint,
        GetFreeLine: GetFreeLine,
        IsLineFree: IsLineFree,
        GetBestLine: GetBestLine,
        GetNrOfActiveCalls: GetNrOfActiveCalls,
        RefreshInfo: RefreshInfo,
        GetReqId: GetReqId,
        IsMultiline: IsMultiline,
        GetTelsearchName: GetTelsearchName,
        SetElementsSrc: SetElementsSrc,
        GetElementSource: GetElementSource,
        PlayDtmfSound: PlayDtmfSound,
        GetLogLevel: GetLogLevel,
        GetHoldState: GetHoldState,
        SetHoldState: SetHoldState,
        GetMuteState: GetMuteState,
        SetMuteState: SetMuteState,
        IsIncomingCall: IsIncomingCall,
        GetDiscReasonFromSignaling: GetDiscReasonFromSignaling,
        HandleScurlSetparameters: HandleScurlSetparameters,
        ClassSipAccounts: ClassSipAccounts,
        ParseSipAccounts: ParseSipAccounts,
        SaveSipAccounts: SaveSipAccounts,
        AddOneAcc: AddOneAcc,
        GetOtherPartyName: GetOtherPartyName,
        CreateConferenceRoom: CreateConferenceRoom,
        InitiateConference: InitiateConference,
        GetMaxLogLevel: GetMaxLogLevel,
        HandleOfflineMessages: HandleOfflineMessages,
        WebphoneIsLoaded: WebphoneIsLoaded,
        BrowserWindowIsActive: BrowserWindowIsActive,
        ShowIncomingCallNotification: ShowIncomingCallNotification,
        DownloadContacts: DownloadContacts,
        ArrayBufferToString: ArrayBufferToString,
        WSAPIReConnect: WSAPIReConnect,
        WSAPIHandleReConnect: WSAPIHandleReConnect,
        Translate: Translate,
        GetLogTimeStamp: GetLogTimeStamp,
        GetAutostart: GetAutostart,
        CanIUseVideo: CanIUseVideo,
        CanIUseScreensharing: CanIUseScreensharing,
        SwitchToEngine: SwitchToEngine,
        ExitVideoMode: ExitVideoMode,
        GetCustomMenus: GetCustomMenus,
        DecideWebrtcServer: DecideWebrtcServer,
        GetTextLengthThatFits: GetTextLengthThatFits,
        DomainToIp: DomainToIp,
        DomainToIpServer: DomainToIpServer,
        AboutWindow: AboutWindow,
        IsUKGateway: IsUKGateway,
        IsUSGateway: IsUSGateway,
        EnableFCM: EnableFCM,
        UserExists: UserExists,
        GetSipusername: GetSipusername,
        GetCallerid: GetCallerid,
        HandleCallerID: HandleCallerID,
        StartFCM: StartFCM,
        WSReConnect: WSReConnect,
        GetFCMPackageName: GetFCMPackageName,
        UniqueArray: UniqueArray,
        IsWebphoneInIframe: IsWebphoneInIframe,
        GetParentIframeUrl: GetParentIframeUrl,
        IsCExt: IsCExt,
        GetUA: GetUA,
        StripXML: StripXML,
        DisplayStartPage: DisplayStartPage,
        ParseQRcode: ParseQRcode,
        GetSrvVersions: GetSrvVersions,
        IsMacLin: IsMacLin,
        NSMacLinEnabled: NSMacLinEnabled,
        PollServiceStatus: PollServiceStatus,
        GetAudioRecList: GetAudioRecList,
        GetAudioPlayList: GetAudioPlayList,
        GetAudioRingList: GetAudioRingList,
        GetVideoRecList: GetVideoRecList,
        GetAudioRecDev: GetAudioRecDev,
        GetAudioPlayDev: GetAudioPlayDev,
        GetAudioRingDev: GetAudioRingDev,
        GetVideoRecDev: GetVideoRecDev,
        NuIsWebPage: NuIsWebPage,
        GetMinSrvBuildValue: GetMinSrvBuildValue,
        HandleServiceBuildUpgrade: HandleServiceBuildUpgrade,
        CanUseIncomingCallNot: CanUseIncomingCallNot,
        RequestBrowserNotificationPermission: RequestBrowserNotificationPermission,
        ExecFunction: ExecFunction,
        StartAppEngine: StartAppEngine,
        GetUrlParamVal: GetUrlParamVal,
        GetJsonParamVal: GetJsonParamVal,
        HandleNewUserResult: HandleNewUserResult,
        GetActiveAccUsername: GetActiveAccUsername,
        GetPreferredStorage: GetPreferredStorage,
        GetApibehaviour: GetApibehaviour,
        GetFiletrasnferFormActionUrl: GetFiletrasnferFormActionUrl,
        NormalizeFilename: NormalizeFilename,
        GetUpperProxyHeaderForSignaling: GetUpperProxyHeaderForSignaling,
        GetNsPluginWsUrl: GetNsPluginWsUrl,
        SIP_REGISTER: SIP_REGISTER,
        SIP_INVITE_OUT: SIP_INVITE_OUT,
        SIP_INVITE_IN: SIP_INVITE_IN,
        SIP_UNKNOWN: SIP_UNKNOWN,
        GROUP_NOGROUP: GROUP_NOGROUP,
        GROUP_LOGIN: GROUP_LOGIN,
        GROUP_MAIN: GROUP_MAIN,
        GROUP_SIP: GROUP_SIP,
        GROUP_MEDIA: GROUP_MEDIA,
        GROUP_CALLDIVERT: GROUP_CALLDIVERT,
        GROUP_GENERAL: GROUP_GENERAL,
        GROUP_INTEGRATE: GROUP_INTEGRATE,
        GROUP_VIDEO: GROUP_VIDEO,
        GROUP_SCRSHARE: GROUP_SCRSHARE,
        GROUP_PROFILE: GROUP_PROFILE,
        RC_TYPE: 0,
        RC_NAME: 1,
        RC_NUMBER: 2,
        RC_DATE: 3,
        RC_RANK: 4,
        RC_DURATION: 5,
        F_WHAT: F_WHAT,
        F_WITH: F_WITH,
        F_MIN: F_MIN,
        F_MAX: F_MAX,
        EP_LINE: EP_LINE,
        EP_SESSION: EP_SESSION,
        EP_DESTNR: EP_DESTNR,
        EP_INCOMING: EP_INCOMING,
        EP_SETUPTIME: EP_SETUPTIME,
        EP_CONNECTTIME: EP_CONNECTTIME,
        EP_DISCONNECTTIME: EP_DISCONNECTTIME,
        EP_REASON: EP_REASON,
        EP_CALLID: EP_CALLID,
        EP_FLAGDEL: EP_FLAGDEL,
        EP_SETUPSENT: EP_SETUPSENT,
        EP_FINISHEDSENT: EP_FINISHEDSENT,
        EP_SIPHEADERS: EP_SIPHEADERS,
        EP_MUTESTATE: EP_MUTESTATE,
        EP_HOLDSTATE: EP_HOLDSTATE,
        EP_SIPINVITE: EP_SIPINVITE,
        EP_SESSID: EP_SESSID,
        PRES_STATUS: PRES_STATUS,
        PRES_TIME: PRES_TIME,
        ACC_SERVER: ACC_SERVER,
        ACC_USER: ACC_USER,
        ACC_PASSWORD: ACC_PASSWORD,
        ACC_IVAL: ACC_IVAL,
        ACC_ENABLED: ACC_ENABLED,
        ACC_ISMAIN: 5,
        ACC_CALLERID: ACC_CALLERID,
        ACC_DISPLAYNAME: ACC_DISPLAYNAME,
        ACC_PROXY: ACC_PROXY,
        MIN_USR_PWD_LENGHT: 3
    }
}(), webphone_api.File = function () {
    function e() {
        try {
            if (!0 === u) return;
            var e = webphone_api.common.GetPreferredStorage();
            -1 === e && "Safari" === webphone_api.common.GetBrowser() && webphone_api.common.GetBrowserVersion() >= 12 && !0 === webphone_api.localforage.supports(webphone_api.localforage.LOCALSTORAGE) && (webphone_api.localforage.setDriver([webphone_api.localforage.LOCALSTORAGE, webphone_api.localforage.INDEXEDDB, webphone_api.localforage.WEBSQL]), webphone_api.common.PutToDebugLogSpecial(1, "EVENT, storage method set to: localStorage (Safari)", !1, "")), e > 0 && (1 === e ? !0 === webphone_api.localforage.supports(webphone_api.localforage.INDEXEDDB) ? (webphone_api.localforage.setDriver([webphone_api.localforage.INDEXEDDB, webphone_api.localforage.LOCALSTORAGE, webphone_api.localforage.WEBSQL]), webphone_api.common.PutToDebugLogSpecial(1, "EVENT, preferred storage method set to: IndexedDB", !1, "")) : webphone_api.common.PutToDebugLogSpecial(1, "WARNING, preferred storage method: IndexedDB is not supported", !1, "") : 2 === e ? !0 === webphone_api.localforage.supports(webphone_api.localforage.LOCALSTORAGE) ? (webphone_api.localforage.setDriver([webphone_api.localforage.LOCALSTORAGE, webphone_api.localforage.INDEXEDDB, webphone_api.localforage.WEBSQL]), webphone_api.common.PutToDebugLogSpecial(1, "EVENT, preferred storage method set to: localStorage", !1, "")) : webphone_api.common.PutToDebugLogSpecial(1, "WARNING, preferred storage method: localStorage is not supported", !1, "") : 3 === e && (!0 === webphone_api.localforage.supports(webphone_api.localforage.WEBSQL) ? (webphone_api.localforage.setDriver([webphone_api.localforage.WEBSQL, webphone_api.localforage.INDEXEDDB, webphone_api.localforage.LOCALSTORAGE]), webphone_api.common.PutToDebugLogSpecial(1, "EVENT, preferred storage method set to: WebSQL", !1, "")) : webphone_api.common.PutToDebugLogSpecial(1, "WARNING, preferred storage method: WebSQL is not supported", !1, ""))), u = !0
        } catch (o) {
            webphone_api.common.PutToDebugLogSpecial(1, "ERROR, file: SetItem", !0, o)
        }
    }

    function o(o, t, n) {
        try {
            if (!n || "function" != typeof n) return void webphone_api.common.PutToDebugLog(2, "ERROR, file: SetItem callback not defined");
            if (e(), webphone_api.common.isNull(o) || webphone_api.common.isNull(t)) return void n(!1);
            webphone_api.global.dispSaveSettMsg < 3 && webphone_api.common.PutToDebugLog(5, "EVENT, file saved to localforage: " + o), webphone_api.localforage.setItem(o, t, function (e, o) {
                return e ? (webphone_api.common.PutToDebugLog(2, "ERROR, file: SetItem localforage returned error: " + e), n(!1), !1) : (n(!0), !0)
            })
        } catch (i) {
            webphone_api.common.PutToDebugLogException(2, "file: SetItem", i)
        }
    }

    function t(o, t) {
        try {
            if (!t || "function" != typeof t) return void webphone_api.common.PutToDebugLog(2, "ERROR, file: GetItem callback not defined");
            if (webphone_api.common.isNull(o)) return webphone_api.common.PutToDebugLog(2, "ERROR, file: GetItem key is NULL"), void t(null);
            e(), webphone_api.common.PutToDebugLog(2, "EVENT, file read from localforage: " + o), webphone_api.localforage.getItem(o, function (e, o) {
                return e ? (webphone_api.common.PutToDebugLog(2, "ERROR, file: GetItem localforage returned error: " + e), t(""), "") : (t(o), o)
            })
        } catch (n) {
            webphone_api.common.PutToDebugLogException(2, "file: GetItem", n), t("")
        }
    }

    function n(o, t) {
        try {
            if (!t || "function" != typeof t) return void webphone_api.common.PutToDebugLog(2, "ERROR, file: DeleteItem callback not defined");
            if (webphone_api.common.isNull(o)) return webphone_api.common.PutToDebugLog(2, "ERROR, file: DeleteItem key is NULL"), void t(!1);
            e(), webphone_api.common.PutToDebugLog(2, "EVENT, file deleted from localforage"), webphone_api.localforage.removeItem(o, function (e) {
                return e ? (webphone_api.common.PutToDebugLog(2, "ERROR, file: DeleteItem localforage returned error: " + e), t(!1), !1) : (t(!0), !0)
            })
        } catch (n) {
            webphone_api.common.PutToDebugLogException(2, "file: DeleteItem", n)
        }
    }

    function i(e, o, t, n) {
        try {
            if (!n || "function" != typeof n) return webphone_api.common.PutToDebugLog(2, "ERROR, file: SetCookie callback not defined"), !1;
            if (webphone_api.common.isNull(e) || webphone_api.common.isNull(o)) return webphone_api.common.PutToDebugLog(2, "ERROR, file: SetCookie key is NULL"), n(!1), !1;
            var i = "";
            if (webphone_api.common.isNull(t)) i = ""; else {
                var a = new Date;
                a.setTime(a.getTime() + 24 * t * 60 * 60 * 1e3), i = "; expires=" + a.toGMTString()
            }
            if (e.indexOf("_backup") >= 0) for (var r = document.cookie.split(";"), s = 0; s < r.length; s++) {
                for (var l = r[s]; " " === l.charAt(0);) l = l.substring(1, l.length);
                if (l.indexOf("_backup=") >= 0) {
                    var p = l.substring(0, l.indexOf("_backup=") + 7), c = new Date;
                    c.setTime(c.getTime() + -864e5);
                    var u = "; expires=" + c.toGMTString();
                    document.cookie = p + "=" + u + "; path=/"
                }
            }
            return document.cookie = e + "=" + o + i + "; path=/", webphone_api.common.isNull(o) || webphone_api.global.dispSaveSettMsg < 3 && webphone_api.common.PutToDebugLog(2, "EVENT, file saved to cookie: " + e), n(!0), !0
        } catch (h) {
            webphone_api.common.PutToDebugLogException(2, "file: SetCookie", h)
        }
        n(!1)
    }

    function a(e, o) {
        try {
            if (!o || "function" != typeof o) return void webphone_api.common.PutToDebugLog(2, "ERROR, file: GetCookie callback not defined");
            if (webphone_api.common.isNull(e)) return webphone_api.common.PutToDebugLog(2, "ERROR, file: GetCookie key is NULL"), void o(null);
            for (var t = e + "=", n = document.cookie.split(";"), i = 0; i < n.length; i++) {
                for (var a = n[i]; " " === a.charAt(0);) a = a.substring(1, a.length);
                if (0 === a.indexOf(t)) {
                    var r = a.substring(t.length, a.length);
                    return webphone_api.common.PutToDebugLog(2, "EVENT, file read from cookie: " + e), void o(r)
                }
            }
        } catch (s) {
            webphone_api.common.PutToDebugLogException(2, "file: GetCookie", s)
        }
        o(null)
    }

    function r() {
        try {
            for (var e = document.cookie.split(";"), o = 0; o < e.length; o++) {
                var t = e[o], n = t.indexOf("="), i = n > -1 ? t.substr(0, n) : t;
                document.cookie = i + "=;expires=Thu, 01 Jan 1970 00:00:00 GMT"
            }
            return !0
        } catch (a) {
            webphone_api.common.PutToDebugLogException(2, "file: DeleteAllCookies", a)
        }
        return !1
    }

    function s(e, o) {
        try {
            if (!o || "function" != typeof o) return void webphone_api.common.PutToDebugLog(2, "ERROR, file: DeleteCookie callback not defined");
            if (webphone_api.common.isNull(e)) return webphone_api.common.PutToDebugLog(2, "ERROR, file: DeleteCookie key is NULL"), void o(!1);
            i(e, "", -1, function (t) {
                webphone_api.common.PutToDebugLog(2, "EVENT, file deleted from cookie: " + e), o(t)
            })
        } catch (t) {
            webphone_api.common.PutToDebugLogException(2, "file: DeleteCookie", t)
        }
    }

    function l(e, t, n, r) {
        try {
            if (!r || "function" != typeof r) return void webphone_api.common.PutToDebugLog(2, "ERROR, file: SaveFile callback not defined");
            if (webphone_api.common.isNull(e)) return webphone_api.common.PutToDebugLog(3, "ERROR, file: SaveFile filename null"), void r(!1);
            if (webphone_api.common.isNull(t)) return webphone_api.common.PutToDebugLog(3, "ERROR, file: SaveFile content is NULL"), void r(!1);
            if ((webphone_api.common.isNull(n) || n < 0 || n > 2) && (n = webphone_api.global.STORAGE_LOCAL), webphone_api.common.IsIeLocal() && (n = webphone_api.global.STORAGE_COOKIE), webphone_api.common.PutToDebugLog(7, "EVENT, file: SaveFile content code"), t = webphone_api.common.Encrypt(t, webphone_api.common.enckey), webphone_api.common.isNull(t) && webphone_api.common.PutToDebugLog(2, "ERROR, file: SaveFile content after code is NULL"), n !== webphone_api.global.STORAGE_LOCAL && webphone_api.common.IsCExt() > 0) return webphone_api.common.PutToDebugLog(4, "EVENT,Not saving data in cookie in webview: " + e), void r(!0);
            if (n === webphone_api.global.STORAGE_LOCAL) o(e, t, function (e) {
                webphone_api.global.dispSaveSettMsg < 3 && webphone_api.common.PutToDebugLog(3, "EVENT, file: SaveFile SetItem callback: " + e), r(e)
            }); else if (n === webphone_api.global.STORAGE_COOKIE) i(e, t, 365, function (e) {
                r(e)
            }); else {
                if (n !== webphone_api.global.STORAGE_AUTO) return webphone_api.common.PutToDebugLog(2, "ERROR, file: SaveFile invalid storagetype"), void r(!1);
                a("notincoockie", function (n) {
                    var a = !1;
                    webphone_api.common.isNull(n) || "true" !== n || (a = !0), !0 === a || t.length > 1e3 ? (o(e, t, function (e) {
                        r(e)
                    }), t.length > 1e3 && i("notincoockie", "true", 365, function () {
                    })) : i(e, t, 365, function (e) {
                        r(e)
                    })
                })
            }
        } catch (s) {
            webphone_api.common.PutToDebugLogException(2, "file: SaveFile", s)
        }
    }

    function p(e, o, n) {
        try {
            if (!n || "function" != typeof n) return void webphone_api.common.PutToDebugLog(2, "ERROR, file: ReadFile callback not defined");
            if ((webphone_api.common.isNull(o) || o < 0 || o > 2) && (o = webphone_api.global.STORAGE_LOCAL), webphone_api.common.IsIeLocal() && (o = webphone_api.global.STORAGE_COOKIE), webphone_api.common.isNull(e)) return webphone_api.common.PutToDebugLog(3, "ERROR, file: ReadFile filename is NULL"), void n(null);
            if (o === webphone_api.global.STORAGE_LOCAL) t(e, function (e) {
                webphone_api.common.isNull(e) || (webphone_api.common.PutToDebugLog(7, "EVENT, file: ReadFile content decode"), e.length > 0 && (e = webphone_api.common.Decrypt(e, webphone_api.common.enckey))), webphone_api.common.isNull(e) && webphone_api.common.PutToDebugLog(3, "EVENT, file: ReadFile content after decode is null"), n(e)
            }); else if (o === webphone_api.global.STORAGE_COOKIE) a(e, function (e) {
                webphone_api.common.isNull(e) || (webphone_api.common.PutToDebugLog(7, "EVENT, file: ReadFile content decode"), e.length > 0 && (e = webphone_api.common.Decrypt(e, webphone_api.common.enckey))), webphone_api.common.isNull(e) && webphone_api.common.PutToDebugLog(3, "EVENT, file: ReadFile content after decode is null"), n(e)
            }); else {
                if (o !== webphone_api.global.STORAGE_AUTO) return webphone_api.common.PutToDebugLog(2, "ERROR, file: ReadFile invalid storagetype"), void n(!1);
                a("notincoockie", function (i) {
                    var r = !1;
                    webphone_api.common.isNull(i) || "true" !== i || (r = !0), o === webphone_api.global.STORAGE_LOCAL || !0 === r ? t(e, function (e) {
                        webphone_api.common.isNull(e) || (webphone_api.common.PutToDebugLog(7, "EVENT, file: ReadFile content decode"), e.length > 0 && (e = webphone_api.common.Decrypt(e, webphone_api.common.enckey))), webphone_api.common.isNull(e) && webphone_api.common.PutToDebugLog(3, "EVENT, file: ReadFile content after decode is null"), n(e)
                    }) : a(e, function (e) {
                        webphone_api.common.isNull(e) || (webphone_api.common.PutToDebugLog(7, "EVENT, file: ReadFile content decode"), e.length > 0 && (e = webphone_api.common.Decrypt(e, webphone_api.common.enckey))), webphone_api.common.isNull(e) && webphone_api.common.PutToDebugLog(3, "EVENT, file: ReadFile content after decode is null"), n(e)
                    })
                })
            }
        } catch (i) {
            webphone_api.common.PutToDebugLogException(2, "file: ReadFile", i)
        }
    }

    function c(e, o) {
        try {
            if (!o || "function" != typeof o) return void webphone_api.common.PutToDebugLog(2, "ERROR, file: DeleteFile callback not defined");
            if (webphone_api.common.isNull(e)) return webphone_api.common.PutToDebugLog(3, "ERROR, file: DeleteFile filename null"), void o(!1);
            var t = !1;
            if (s(e, function (e) {
                t || o(!0), t = !0
            }), webphone_api.common.IsIeLocal()) return;
            n(e, function (e) {
                t || o(!0), t = !0
            })
        } catch (i) {
            webphone_api.common.PutToDebugLogException(2, "file: DeleteFile", i)
        }
    }

    var u = !1;
    return {
        SaveFile: l,
        ReadFile: p,
        DeleteFile: c,
        SetItem: o,
        GetItem: t,
        SetCookie: i,
        GetCookie: a,
        DeleteAllCookies: r
    }
}(), webphone_api.flashapi = function () {
    function e() {
        try {
            webphone_api.common.PutToDebugLog(3, "EVENT, Initializing...");
            var e = I();
            !webphone_api.common.isNull(e) && e.length > 0 && (R.rtmp_url = "rtmp://" + e + "/phone", webphone_api.global.isdebugversion && webphone_api.common.PutToDebugLog(3, "EVENT, Flash RTMP server: " + R.rtmp_url));
            var o = document.getElementById("flashphonehandle");
            if (webphone_api.common.isNull(o)) {
                var t = "https://www.adobe.com/go/getflashplayer",
                    n = "https://www.adobe.com/images/shared/download_buttons/get_flash_player.gif";
                !0 === webphone_api.common.IsHttps() && (t = t.replace("http:", "https:"), n = n.replace("http:", "https:"));
                var i = '<div id="flashphonehandle" style="float: left; visibility: hidden; position: absolute; top: 0; left: 0; z-index: -1;"><span>You need Adobe Flash Player for the softphone to work.</span><p><a href="' + t + '" target="_blank"><img src="' + n + '" alt="Get Adobe Flash player" /></a></p></div>';
                webphone_api.$("body").append(i)
            }
            webphone_api.swfobject.embedSWF("native/flashphone.swf", L, "1", "1", "9.0.0", "native/expressInstall.swf", R, y, [], function (e) {
                webphone_api.common.PutToDebugLog(2, "EVENT, flashapi embedswf: " + e.success), 0 == e.success && webphone_api.common.PutToDebugLog(2, "EVENT, flashapi embed failed, flash player needs to be installed")
            })
        } catch (a) {
            webphone_api.common.PutToDebugLogException(2, "flashapi: Start", a)
        }
    }

    function o() {
        try {
            if (webphone_api.common.isNull(n())) return void webphone_api.common.PutToDebugLog(3, "ERROR, onInit cannot get flash handle!");
            webphone_api.common.PutToDebugLog(3, "EVENT, flash Initialized."), G = !1
        } catch (e) {
            webphone_api.common.PutToDebugLogException(2, "flashapi: onInit", e)
        }
    }

    function t(e) {
        try {
            webphone_api.common.PutToDebugLog(3, "EVENT, Connected to flash server: " + e), webphone_api.global.iscurrengineworking = !0, webphone_api.common.SaveParameter("lastsessionsuccess", "2"), G = !1, webphone_api.global.phonestarted < 2 && (webphone_api.global.phonestarted = 2);
            var o = webphone_api.common.GetSipusername(), t = webphone_api.common.GetParameter("password"), i = I(),
                a = i, r = a.indexOf(":");
            r > 0 && (a = a.substring(0, r)), o = o + "@" + a, D = o;
            var s = webphone_api.common.NeedRegister();
            if (webphone_api.common.PutToDebugLog(3, "Flash connection details:"), webphone_api.common.PutToDebugLog(3, "RTMP server: " + R.rtmp_url), webphone_api.common.PutToDebugLog(3, "username: " + o), webphone_api.common.PutToDebugLog(3, "password: " + t), !0 === s) {
                if (webphone_api.common.PutToDebugLog(1, "STATUS,-1,Register..."), webphone_api.common.isNull(n())) return void webphone_api.common.PutToDebugLog(3, "ERROR, trying to register with SIP account, but cannot get flash handle");
                n().login(o, t)
            }
        } catch (l) {
            webphone_api.common.PutToDebugLogException(2, "flashapi: onConnected", l)
        }
    }

    function n() {
        try {
            if (!webphone_api.common.isNull(webphone_api.$("#" + L)[0]) && "function" == typeof webphone_api.$("#" + L)[0].login) return webphone_api.$("#" + L)[0]
        } catch (e) {
            webphone_api.common.PutToDebugLogException(2, "flashapi: GetHandle", e)
        }
        return null
    }

    function i(e) {
        a(e)
    }

    function a(e) {
        try {
            if (webphone_api.common.isNull(e) || e.length < 1) return;
            var o = e.toLowerCase(), t = "";
            t = o.indexOf("error") >= 0 ? "ERROR, " : o.indexOf("warning") >= 0 ? "WARNING, " : "EVENT, ", webphone_api.common.PutToDebugLog(2, t + "flash, " + e)
        } catch (n) {
            webphone_api.common.PutToDebugLogException(2, "flashapi: onDebug", n)
        }
    }

    function r() {
        try {
            webphone_api.common.PutToDebugLog(3, "WARNING, flashapi onDisconnected: disconnected from flash server"), G = !1, setTimeout(function () {
                if (webphone_api.common.PutToDebugLog(3, "EVENT, onDisconnected: reconnecting to flash server"), webphone_api.common.isNull(n())) return void webphone_api.common.PutToDebugLog(3, "ERROR, Cannot get flash handle onDisconnect!");
                n().connect()
            }, 5e3)
        } catch (e) {
            webphone_api.common.PutToDebugLogException(2, "flashapi: onDisconnected", e)
        }
    }

    function s(e) {
        try {
            if (G = !1, webphone_api.common.isNull(n())) return void webphone_api.common.PutToDebugLog(3, "ERROR, Cannot get flash handle!");
            n().logout(e)
        } catch (o) {
            webphone_api.common.PutToDebugLogException(2, "flashapi: Logout", o)
        }
    }

    function l(e, o, t) {
        try {
            if ("success" != e) webphone_api.common.PutToDebugLog(1, "ERROR,-1,Register failed"), G = !1; else {
                webphone_api.global.iscurrengineworking = !0, webphone_api.common.SaveParameter("lastsessionsuccess", "2"), webphone_api.common.PutToDebugLog(1, "EVENT,EVENT,authenticated successfully"), G = !0, N(), setTimeout(function () {
                    webphone_api.common.PutToDebugLog(1, "STATUS,-1,Registered.")
                }, 1500);
                var i = o + "@" + t;
                if (webphone_api.common.isNull(n())) return void webphone_api.common.PutToDebugLog(3, "ERROR, Cannot get flash handle!");
                n().register(i, "")
            }
        } catch (a) {
            webphone_api.common.PutToDebugLogException(2, "flashapi: onLogin", a)
        }
    }

    function p(e, o) {
        webphone_api.common.PutToDebugLog(1, "STATUS,-1,Unregistered")
    }

    function c(e) {
        try {
            if (webphone_api.common.isNull(n())) return void webphone_api.common.PutToDebugLog(3, "ERROR, Call: cannot get flash handle!");
            W = !1, V = e, webphone_api.common.PutToDebugLog(1, "STATUS,1,CallSetup," + e + "," + webphone_api.common.GetSipusername() + ",1," + e);
            var o = D;
            return webphone_api.common.isNull(o) && (o = ""), webphone_api.common.PutToDebugLog(1, "STATUS,-1,Starting call to " + e), webphone_api.common.PutToDebugLog(1, "STATUS,-1,Call"), n().makeCall(e, o, []), !0
        } catch (t) {
            webphone_api.common.PutToDebugLogException(2, "flashapi: Call", t)
        }
        return !1
    }

    function u() {
        try {
            if (webphone_api.common.isNull(n())) return void webphone_api.common.PutToDebugLog(3, "ERROR, Cannot get flash handle!");
            var e = O;
            return webphone_api.common.isNull(e) && (e = ""), n().hangup(e), !0
        } catch (o) {
            webphone_api.common.PutToDebugLogException(2, "flashapi: Hangup", o)
        }
        return !1
    }

    function h() {
        try {
            if (webphone_api.common.isNull(n())) return void webphone_api.common.PutToDebugLog(3, "ERROR, Cannot get flash handle!");
            var e = O;
            return webphone_api.common.isNull(e) && (e = ""), n().answer(e), !0
        } catch (o) {
            webphone_api.common.PutToDebugLogException(2, "flashapi: Accept", o)
        }
        return !1
    }

    function m(e, o) {
        try {
            return (webphone_api.common.isNull(o) || o.length < 1) && (o = "1500"), webphone_api.common.isNull(n()) ? void webphone_api.common.PutToDebugLog(3, "ERROR, Cannot get flash handle!") : (n().sendDTMF(e, o), !0)
        } catch (t) {
            webphone_api.common.PutToDebugLogException(2, "flashapi: sendDTMF", t)
        }
        return !1
    }

    function g() {
        try {
            if (webphone_api.common.isNull(n())) return void webphone_api.common.PutToDebugLog(3, "ERROR, Cannot get flash handle!");
            var e = O;
            return webphone_api.common.isNull(e) && (e = ""), n().attach(e), !0
        } catch (o) {
            webphone_api.common.PutToDebugLogException(2, "flashapi: Attach", o)
        }
        return !1
    }

    function d(e) {
        try {
            if (webphone_api.common.isNull(n())) return void webphone_api.common.PutToDebugLog(3, "ERROR, Cannot get flash handle!");
            var o = O;
            return webphone_api.common.isNull(o) && (o = ""), n().transfer(o, e), !0
        } catch (t) {
            webphone_api.common.PutToDebugLogException(2, "flashapi: Transfer", t)
        }
        return !1
    }

    function b(e, o) {
        try {
            return webphone_api.common.isNull(n()) ? void webphone_api.common.PutToDebugLog(3, "ERROR, Cannot get flash handle!") : (n().three_way(e, o), !0)
        } catch (t) {
            webphone_api.common.PutToDebugLogException(2, "flashapi: ThreeWay", t)
        }
        return !1
    }

    function _(e, o) {
        try {
            return webphone_api.common.isNull(n()) ? void webphone_api.common.PutToDebugLog(3, "ERROR, Cannot get flash handle!") : (n().join(e, o), !0)
        } catch (t) {
            webphone_api.common.PutToDebugLogException(2, "flashapi: Join", t)
        }
        return !1
    }

    function f(e, o) {
        try {
            if (webphone_api.common.isNull(o) || o.length < 1) return;
            O = e;
            var t = !1;
            switch (o) {
                case "RINGING":
                    t = !0, webphone_api.common.PutToDebugLog(1, "STATUS,-1,Ringing...");
                    var n = "1";
                    W && (n = "2"), webphone_api.common.PutToDebugLog(1, "STATUS,1,Ringing," + V + "," + webphone_api.common.GetSipusername() + "," + n + "," + V), A = webphone_api.common.GetTickCount();
                    break;
                case "ACTIVE":
                    t = !0;
                    var n = "1";
                    W && (n = "2"), webphone_api.common.PutToDebugLog(1, "STATUS,1,CallConnect," + V + "," + webphone_api.common.GetSipusername() + "," + n + "," + V), setTimeout(function () {
                        webphone_api.common.PutToDebugLog(1, "STATUS,-1,InCall"), webphone_api.common.PutToDebugLog(1, "STATUS,-1,Speaking")
                    }, 1300), webphone_api.common.PutToDebugLog(1, "STATUS,-1,Speaking"), k = webphone_api.common.GetTickCount();
                    break;
                case "HANGUP":
                    if (webphone_api.common.GetTickCount() - x < 110) break;
                    t = !0;
                    var n = "1";
                    W && (n = "2"), webphone_api.common.PutToDebugLog(1, "STATUS,1,CallDisconnect," + V + "," + webphone_api.common.GetSipusername() + "," + n + "," + V), webphone_api.common.PutToDebugLog(1, "STATUS,-1,Call Finished"), webphone_api.common.PutToDebugLog(1, "STATUS,1,Finished"), x = webphone_api.common.GetTickCount()
            }
            !0 !== t && webphone_api.common.PutToDebugLog(3, "EVENT, onCallState: " + o + ";  uuid: " + e)
        } catch (i) {
            webphone_api.common.PutToDebugLogException(2, "flashapi: onCallState", i)
        }
    }

    function w(e, o, t, n, i) {
        try {
            O = e, W = !0, V = t, webphone_api.common.PutToDebugLog(1, "STATUS,1,CallSetup," + t + "," + webphone_api.common.GetSipusername() + ",2," + t), webphone_api.common.PutToDebugLog(1, "STATUS,-1,Incoming...");
            var a = webphone_api.common.GetParameter2("autoignore");
            (webphone_api.common.isNull(a) || 1 !== a.length) && (a = "0");
            var r = webphone_api.common.StrToInt(a);
            r > 1 ? (webphone_api.common.PutToDebugLog(3, "EVENT, autoignore Flash hangup(reject)"), Reject()) : 1 === r && (webphone_api.common.PutToDebugLog(3, "EVENT, autoignore Flash silent ignore"), Reject()), !0 === webphone_api.common.GetParameterBool("autoaccept", !1) && (webphone_api.common.PutToDebugLog(3, "EVENT, autoaccept Flash accept"), h());
            var s = webphone_api.common.GetParameter2("calltransferalways");
            !webphone_api.common.isNull(s) && s.length > 1 && (webphone_api.common.PutToDebugLog(3, "EVENT, call transfer Flash calltransferalways: " + s), d(s));
            var l = webphone_api.common.GetParameter2("callforwardonbusy");
            !webphone_api.common.isNull(l) && l.length > 1 && webphone_api.common.PutToDebugLog(3, "EVENT, call foward Flash callforwardonbusy: NOT IMPLEMENTED YET");
            var p = webphone_api.common.GetParameter2("callforwardalways");
            !webphone_api.common.isNull(p) && p.length > 1 && webphone_api.common.PutToDebugLog(3, "EVENT, call foward Flash callforwardalways: NOT IMPLEMENTED YET")
        } catch (c) {
            webphone_api.common.PutToDebugLogException(2, "flashapi: onIncomingCall", c)
        }
    }

    function v(e, o) {
        try {
            webphone_api.common.PutToDebugLog(1, "STATUS,-1,Hangup"), webphone_api.common.PutToDebugLog(3, "EVENT, onHangup reason: " + o + ";  " + e), S(), setTimeout(function () {
                N()
            }, 1500)
        } catch (t) {
            webphone_api.common.PutToDebugLogException(2, "flashapi: onHangup", t)
        }
    }

    function E(e, o, t) {
        try {
            webphone_api.common.PutToDebugLog(1, "EVENT, flashapi onDisplayUpdate, name: " + o + ", number: " + t + ", " + e)
        } catch (n) {
            webphone_api.common.PutToDebugLogException(2, "flashapi: onDisplayUpdate", n)
        }
    }

    function T(e, o, t) {
        webphone_api.common.PutToDebugLog(4, "EVENT, flashapi onMakeCall: " + o)
    }

    function P(e) {
        webphone_api.common.PutToDebugLog(4, "EVENT, flashapi onAttach: " + e)
    }

    function S() {
        try {
            U = webphone_api.common.GetTickCount();
            var e = 0;
            !webphone_api.common.isNull(k) && k > 0 && !webphone_api.common.isNull(U) && U > 0 && (e = U - k), V = webphone_api.common.isNull(V) ? "" : webphone_api.common.Trim(V), webphone_api.common.isNull(k) && (k = 0);
            var o = "", t = "", n = "NA";
            !webphone_api.common.isNull(k) && webphone_api.common.IsNumber(k) && !webphone_api.common.isNull(A) && webphone_api.common.IsNumber(A) && (n = (k - A).toString());
            W ? (o = V, t = webphone_api.common.GetSipusername()) : (o = webphone_api.common.GetSipusername(), t = V);
            var i = "1";
            !0 === W && (i = "2");
            var a = "CDR,1," + V + "," + o + "," + t + ",NA," + n + "," + e.toString() + ",NA,," + i;
            webphone_api.global.lastcallcdr = a, setTimeout(function () {
                webphone_api.common.PutToDebugLog(1, a)
            }, 500), setTimeout(function () {
                N()
            }, 1500), A = 0, k = 0, U = 0, V = "", W = !1
        } catch (r) {
            webphone_api.common.PutToDebugLogException(2, "flashapi: BuildCDR", r)
        }
    }

    function N() {
        G && webphone_api.common.PutToDebugLog(1, "STATUS,-1,Registered.")
    }

    function I() {
        var e = "";
        try {
            if (e = webphone_api.common.GetParameter("rtmpserveraddress"), webphone_api.common.isNull(e) || e.length < 2) {
                if (e = webphone_api.common.GetWpS(), webphone_api.common.IsLocalServer()) return webphone_api.common.PutToDebugLog(1, "ERROR, Cannot use flash server to connect to local network VoIP server"), alert("ERROR, Cannot use flash server to connect to local network VoIP server"), "";
                e = e.toLowerCase(), e = webphone_api.common.NormalizeInput(e, 0);
                var o = e.indexOf("/");
                o > 0 && (e = e.substring(0, o)), o = e.indexOf(":"), o > 0 && (e = e.substring(0, o)), e += ":1939"
            }
            return e
        } catch (t) {
            webphone_api.common.PutToDebugLogException(2, "flashapi: GetFlashServerAddress", t)
        }
        return ""
    }

    function C(e, o) {
    }

    var R = { rtmp_url: "" }, y = { allowScriptAccess: "always" }, L = "flashphonehandle", D = "", G = !1, O = "", x = 0,
        A = 0, k = 0, U = 0, V = "", W = !1;
    return {
        Start: e,
        Call: c,
        Logout: s,
        Hangup: u,
        Accept: h,
        SendDTMF: m,
        Attach: g,
        Transfer: d,
        ThreeWay: b,
        Join: _,
        ShowPermissionRequest: C,
        onInit: o,
        onEvent: i,
        onDebug: a,
        onConnected: t,
        onDisconnected: r,
        onLogin: l,
        onLogout: p,
        onCallState: f,
        onIncomingCall: w,
        onHangup: v,
        onDisplayUpdate: E,
        onMakeCall: T,
        onAttach: P
    }
}(), function () {
    function e() {
        return n ? n.isLoaded ? void n.contentWindow.postMessage({ captureSourceId: !0 }, "*") : void setTimeout(e, 100) : void o(e)
    }

    function o(e) {
        if (n) return void e();
        n = document.createElement("iframe"), n.onload = function () {
            n.isLoaded = !0, e()
        }, n.src = "https://www.webrtc-experiment.com/getSourceId/", n.style.display = "none", (document.body || document.documentElement).appendChild(n)
    }

    function t() {
        return n ? n.isLoaded ? void n.contentWindow.postMessage({ getChromeExtensionStatus: !0 }, "*") : void setTimeout(function () {
            t()
        }, 100) : void o(t)
    }

    webphone_api.getScreenIdWebphone = function (o) {
        function t(e) {
            e.data && (e.data.chromeMediaSourceId && ("PermissionDeniedError" === e.data.chromeMediaSourceId ? o("permission-denied") : o(null, e.data.chromeMediaSourceId, webphone_api.getScreenConstraints(null, e.data.chromeMediaSourceId))), e.data.chromeExtensionStatus && o(e.data.chromeExtensionStatus, null, webphone_api.getScreenConstraints(e.data.chromeExtensionStatus)), window.removeEventListener("message", t))
        }

        if ("Firefox" === webphone_api.GetBrowser()) return void o(null, "firefox", {
            video: {
                mozMediaSource: "window",
                mediaSource: "window"
            }
        });
        window.removeEventListener("message", webphone_api.HandleEventMessage), window.addEventListener("message", t), setTimeout(function () {
            e()
        }, 100)
    };
    var n;
    webphone_api.getScreenConstraints = function (e) {
        o(function () {
            webphone_api.getScreenIdWebphone(function (o, t, n) {
                e(o, n.video)
            })
        })
    }, webphone_api.getChromeExtensionStatus = function (e) {
        function o(t) {
            t.data && (t.data.chromeExtensionStatus && e(t.data.chromeExtensionStatus), window.removeEventListener("message", o))
        }

        if ("Firefox" === webphone_api.GetBrowser()) return void e("installed-enabled");
        window.removeEventListener("message", webphone_api.HandleEventMessage), window.addEventListener("message", o), setTimeout(function () {
            t()
        }, 100)
    }
}(), webphone_api.init = function () {
    function e() {
        webphone_api.$("#loading_bg_txt").hide();
        var e = window.location.href;
        e.indexOf("#page_call") > 0 && (console && console.log && console.log("WARNING, page Call was last started and after browser window reload, go to Settings page"), e = e.replace("#page_call", ""), window.location.href = e)
    }

    function o() {
        if (!0 !== i) {
            if (i = !0, webphone_api.common.SetElementsSrc(), webphone_api.global.domloaded_tick = webphone_api.common.GetTickCount(), webphone_api.common.PutToDebugLog(2, "EVENT, init: initialize start"), webphone_api.common.Glv() < 1) return void (webphone_api.global.webrtcavailable = 0);
            webphone_api.common.IsWindowsSoftphone() || (webphone_api.loadwebrtc_timestamp = webphone_api.common.GetTickCount(), webphone_api.webrtcapi.WebRtcIsSupported(function (e) {
                function o() {
                    if (webphone_api.common.EngineSelect(0), webphone_api.common.SetLanguage(), webphone_api.plhandler.ConfigChanged(), !1 === webphone_api.global.onloaded_called) {
                        webphone_api.global.wploaded = !0, webphone_api.common.PutToDebugLogSpecial(1, "EVENT, init webphone onLoaded", !1, "");
                        try {
                            webphone_api.onAppStateChangeCb("loaded")
                        } catch (e) {
                            webphone_api.common.PutToDebugLogException(2, "init: There is an error in onAppStateChange(loaded) callback", e)
                        }
                        try {
                            webphone_api.onLoadedCb()
                        } catch (e) {
                            webphone_api.common.PutToDebugLogException(2, "init: There is an error in onLoaded() callback", e)
                        }
                        webphone_api.common.CallScriptingUrl(webphone_api.parameters.scurl_onload, "onLoad", "", "", "", ""), webphone_api.global.onloaded_called = !0, setTimeout(function () {
                            webphone_api.global.onloaded_called = !1
                        }, 5e3), webphone_api.webphone_loaded = !0, webphone_api.common.WebphoneIsLoaded()
                    }
                }

                if ("Windows" === webphone_api.common.GetOs() && ("MSIE" === webphone_api.common.GetBrowser() ? e = !1 : "Edge" === webphone_api.common.GetBrowser() && (webphone_api.common.GetBrowserVersion() < 14 ? e = !1 : !1 === e && webphone_api.common.PutToDebugLog(2, "ERROR,Init Edge webrtc is not supported, getusermedia: " + typeof navigator.getUserMedia + "; RTCPeerConnection: " + typeof window.RTCPeerConnection))), "iOS" === webphone_api.common.GetOs() ? (("Safari" === webphone_api.common.GetBrowser() || "iPhone" === webphone_api.common.GetBrowser()) && webphone_api.common.GetBrowserVersion() < 11 && (e = !1), "Firefox" !== webphone_api.common.GetBrowser() || navigator.mozGetUserMedia || navigator.GetUserMedia || (e = !1), "Chrome" !== webphone_api.common.GetBrowser() || navigator.webkitGetUserMedia || navigator.GetUserMedia || (e = !1)) : "Windows" === webphone_api.common.GetOs() && "Safari" === webphone_api.common.GetBrowser() && (e = !1), webphone_api.common.isNull(e) && (e = ""), webphone_api.common.PutToDebugLog(2, "EVENT, init: initialize LoadWebrtc engine: " + e), !0 === e) {
                    webphone_api.global.webrtcavailable = 1, webphone_api.common.PutToDebugLog(2, "webrtc engine available (init)");
                    var t = webphone_api.common.GetEngine("webrtc"),
                        n = webphone_api.common.GetParameter2("serveraddress_user");
                    (webphone_api.common.isNull(n) || n.length < 2) && (n = webphone_api.common.GetParameter2("serveraddress")), (webphone_api.common.isNull(n) || n.length < 2) && (n = webphone_api.common.GetConfig("serveraddress")), webphone_api.common.isNull(n) && (n = ""), webphone_api.common.IsLanIP(webphone_api.common.GetWebrtcUpperServer()) || n.length > 0 && webphone_api.common.IsLanIP(n) ? webphone_api.common.isNull(t) || (t.issupported_cache = 0, t.available = 0) : !0 === webphone_api.common.BrowserRequiresHttps(!0) ? webphone_api.common.isNull(t) || (t.issupported_cache = 1, t.available = 2) : webphone_api.common.isNull(t) || (t.issupported_cache = 2, t.available = 3)
                } else !1 === e && (webphone_api.global.webrtcavailable = 0, webphone_api.common.PutToDebugLog(2, "webrtc engine NOT available"));
                !0 === webphone_api.common.UseCustomAutoprov(!0) ? webphone_api.common.GetCustomAutoprov(function (e) {
                    webphone_api.common.RecAutoprovCustom(e), o()
                }) : o()
            }))
        }
    }

    function t() {
        try {
            webphone_api.global.domloaded = !0, webphone_api.$.mobile.pageContainer = webphone_api.$("#android_frame"), webphone_api.common.PutToDebugLog(3, "EVENT, init: mobileinit"), webphone_api.$("body").on("contextmenu", function (e) {
                if (0 == webphone_api.common.IsSDK()) return n(e)
            })
        } catch (e) {
            webphone_api.common.PutToDebugLogException(2, "init: mobileinit", e)
        }
    }

    function n(e) {
        var o = "";
        try {
            if (o = webphone_api.$.mobile.activePage.attr("id"), webphone_api.common.isNull(o) || o.length < 1) return webphone_api.common.PutToDebugLog(2, "ERROR, init: OpenMenu NO PAGE"), !1;
            o = o.replace("page_", "");
            var t = "#btn_" + o + "_menu";
            if ("settings" === o) return webphone_api.$(t).click(), e.preventDefault(), !1;
            if ("dialpad" === o) return webphone_api.$(t).click(), e.preventDefault(), !1;
            if ("contactslist" === o) return webphone_api.$(t).click(), e.preventDefault(), !1;
            if ("contactdetails" === o) return webphone_api.$(t).click(), e.preventDefault(), !1;
            if ("callhistorylist" === o) return webphone_api.$(t).click(), e.preventDefault(), !1;
            if ("callhistorydetails" === o) return webphone_api.$(t).click(), e.preventDefault(), !1;
            if ("call" === o) return webphone_api.$(t).click(), e.preventDefault(), !1;
            if ("addeditcontact" === o) return webphone_api.$(t).click(), e.preventDefault(), !1;
            if ("messagelist" === o) return webphone_api.$(t).click(), e.preventDefault(), !1;
            if ("message" === o) return webphone_api.$(t).click(), e.preventDefault(), !1;
            if ("internalbrowser" === o) return webphone_api.$(t).click(), e.preventDefault(), !1;
            if ("newuser" === o) return webphone_api.$(t).click(), e.preventDefault(), !1;
            if ("filetransfer" === o) return webphone_api.$(t).click(), e.preventDefault(), !1;
            if ("smscodeverify" === o) return webphone_api.$(t).click(), e.preventDefault(), !1
        } catch (n) {
            webphone_api.common.PutToDebugLogException(2, "init: OpenMenu " + o, n)
        }
    }

    webphone_api.$(document).ready(function () {
        e()
    }), webphone_api.$(document).on("mobileinit", function () {
        t(), webphone_api.$.event.special.tap.emitTapOnTaphold = !1
    });
    var i = !1;
    webphone_api.$(".options_menu").on("popupbeforeposition", function (e, o) {
        webphone_api.$(".all_app_pages").css("overflow", "hidden")
    });
    var a = !1;
    return window.onunload = window.onbeforeunload = function (e) {
        try {
            if (webphone_api.unregisteredcb = null, webphone_api.global.onunload_flag = !0, !0 === a) return;
            webphone_api.stop();
            webphone_api.global.useengine;
            webphone_api.global.useengine = "", webphone_api.common.PutToDebugLog(3, "EVENT, Window.OnUnload close or refresh event detected. reset useengine"), webphone_api.global.wasSettModified && webphone_api.common.SaveSettingsFile(webphone_api.common.GetActiveAccSettingsFilename(), function (e) {
                e ? webphone_api.common.PutToDebugLog(2, "EVENT, SaveSettingsFile on exit Successfull") : webphone_api.common.PutToDebugLog(2, "ERROR, SaveSettingsFile on exit Failed")
            }), webphone_api.global.wasCtModified && webphone_api.common.SaveContactsFile(function (e) {
                e ? webphone_api.common.PutToDebugLog(2, "EVENT, SaveContactsFile on exit Successfull") : webphone_api.common.PutToDebugLog(2, "ERROR, SaveContactsFile on exit Failed")
            }), webphone_api.global.wasChModified && webphone_api.common.SaveCallhistoryFile(function (e) {
                e ? webphone_api.common.PutToDebugLog(2, "EVENT, SaveCallhistoryFile on exit Successfull") : webphone_api.common.PutToDebugLog(2, "ERROR, SaveCallhistoryFile on exit Failed")
            }), a = !0
        } catch (o) {
            webphone_api.common.PutToDebugLogException(2, "init: Window.OnUnload", o)
        }
    }, webphone_api.$(document).on("pagecontainershow", function (e, o) {
        var t = "";
        try {
            var n = webphone_api.$.mobile.pageContainer.pagecontainer("getActivePage");
            t = n[0].id, document.getElementById(t).style.minHeight = "auto"
        } catch (i) {
            webphone_api.common.PutToDebugLogException(2, "init: pagecontainershow " + t, i)
        }
    }), webphone_api.$(document).on("pageinit", '[data-role="page"]', function (e) {
        var o = "";
        try {
            if (o = webphone_api.$(this).attr("id"), webphone_api.common.isNull(o) || o.length < 1) return void webphone_api.common.PutToDebugLog(2, "ERROR, init: pageinit NO PAGE");
            if (o.indexOf("settings") >= 0) return void webphone_api._settings.onCreate(e);
            if (o.indexOf("dialpad") >= 0) return void webphone_api._dialpad.onCreate(e);
            if (o.indexOf("contactslist") >= 0) return void webphone_api._contactslist.onCreate(e);
            if (o.indexOf("contactdetails") >= 0) return void webphone_api._contactdetails.onCreate(e);
            if (o.indexOf("callhistorylist") >= 0) return void webphone_api._callhistorylist.onCreate(e);
            if (o.indexOf("callhistorydetails") >= 0) return void webphone_api._callhistorydetails.onCreate(e);
            if (o.indexOf("call") >= 0) return void webphone_api._call.onCreate(e);
            if (o.indexOf("addeditcontact") >= 0) return void webphone_api._addeditcontact.onCreate(e);
            if (o.indexOf("messagelist") >= 0) return void webphone_api._messagelist.onCreate(e);
            if (o.indexOf("message") >= 0) return void webphone_api._message.onCreate(e);
            if (o.indexOf("internalbrowser") >= 0) return void webphone_api._internalbrowser.onCreate(e);
            if (o.indexOf("startpage") >= 0) return void webphone_api._startpage.onCreate(e);
            if (o.indexOf("logview") >= 0) return void webphone_api._logview.onCreate(e);
            if (o.indexOf("newuser") >= 0) return void webphone_api._newuser.onCreate(e);
            if (o.indexOf("filetransfer") >= 0) return void webphone_api._filetransfer.onCreate(e);
            if (o.indexOf("filters") >= 0) return void webphone_api._filters.onCreate(e);
            if (o.indexOf("accounts") >= 0) return void webphone_api._accounts.onCreate(e);
            if (o.indexOf("smscodeverify") >= 0) return void webphone_api._smscodeverify.onCreate(e);
            if (o.indexOf("extra1") >= 0) return void (webphone_api._extra1 && webphone_api._extra1.onCreate && (webphone_api._extra1.onCreate(e), webphone_api.global.isExtra1Started = !0));
            if (o.indexOf("extra2") >= 0) return void (webphone_api._extra2 && webphone_api._extra2.onCreate && (webphone_api._extra2.onCreate(e), webphone_api.global.isExtra2Started = !0));
            if (o.indexOf("extra3") >= 0) return void (webphone_api._extra3 && webphone_api._extra3.onCreate && (webphone_api._extra3.onCreate(e), webphone_api.global.isExtra3Started = !0));
            if (o.indexOf("extra4") >= 0) return void (webphone_api._extra4 && webphone_api._extra4.onCreate && (webphone_api._extra4.onCreate(e), webphone_api.global.isExtra4Started = !0));
            if (o.indexOf("extra5") >= 0) return void (webphone_api._extra5 && webphone_api._extra5.onCreate && (webphone_api._extra5.onCreate(e), webphone_api.global.isExtra5Started = !0))
        } catch (t) {
            webphone_api.common.isNull(o) && (o = ""), webphone_api.common.PutToDebugLogException(2, "init: pageinit " + o, t)
        }
    }), webphone_api.$(document).on("pageshow", '[data-role="page"]', function (e) {
        var o = "";
        try {
            if (o = webphone_api.$(this).attr("id"), webphone_api.common.isNull(o) || o.length < 1) return void webphone_api.common.PutToDebugLog(2, "ERROR, init: pageshow NO PAGE");
            var t = "#" + o.substring(o.indexOf("_") + 1, o.length) + "_header";
            if (document.getElementById(o).style.background = webphone_api.common.getBgColor(t), o.indexOf("settings") >= 0) return void webphone_api._settings.onStart(e);
            if (o.indexOf("dialpad") >= 0) return void webphone_api._dialpad.onStart(e);
            if (o.indexOf("contactslist") >= 0) return void webphone_api._contactslist.onStart(e);
            if (o.indexOf("contactdetails") >= 0) return void webphone_api._contactdetails.onStart(e);
            if (o.indexOf("callhistorylist") >= 0) return void webphone_api._callhistorylist.onStart(e);
            if (o.indexOf("callhistorydetails") >= 0) return void webphone_api._callhistorydetails.onStart(e);
            if (o.indexOf("call") >= 0) return void webphone_api._call.onStart(e);
            if (o.indexOf("addeditcontact") >= 0) return void webphone_api._addeditcontact.onStart(e);
            if (o.indexOf("messagelist") >= 0) return void webphone_api._messagelist.onStart(e);
            if (o.indexOf("message") >= 0) return void webphone_api._message.onStart(e);
            if (o.indexOf("internalbrowser") >= 0) return void webphone_api._internalbrowser.onStart(e);
            if (o.indexOf("startpage") >= 0) return void webphone_api._startpage.onStart(e);
            if (o.indexOf("logview") >= 0) return void webphone_api._logview.onStart(e);
            if (o.indexOf("newuser") >= 0) return void webphone_api._newuser.onStart(e);
            if (o.indexOf("filetransfer") >= 0) return void webphone_api._filetransfer.onStart(e);
            if (o.indexOf("filters") >= 0) return void webphone_api._filters.onStart(e);
            if (o.indexOf("accounts") >= 0) return void webphone_api._accounts.onStart(e);
            if (o.indexOf("smscodeverify") >= 0) return void webphone_api._smscodeverify.onStart(e);
            if (o.indexOf("extra1") >= 0) return void (webphone_api._extra1 && webphone_api._extra1.onStart && (webphone_api._extra1.onStart(e), webphone_api.global.isExtra1Started = !0));
            if (o.indexOf("extra2") >= 0) return void (webphone_api._extra2 && webphone_api._extra2.onStart && (webphone_api._extra2.onStart(e), webphone_api.global.isExtra2Started = !0));
            if (o.indexOf("extra3") >= 0) return void (webphone_api._extra3 && webphone_api._extra3.onStart && (webphone_api._extra3.onStart(e), webphone_api.global.isExtra3Started = !0));
            if (o.indexOf("extra4") >= 0) return void (webphone_api._extra4 && webphone_api._extra4.onStart && (webphone_api._extra4.onStart(e), webphone_api.global.isExtra4Started = !0));
            if (o.indexOf("extra5") >= 0) return void (webphone_api._extra5 && webphone_api._extra5.onStart && (webphone_api._extra5.onStart(e), webphone_api.global.isExtra5Started = !0))
        } catch (n) {
            webphone_api.common.isNull(o) && (o = ""), webphone_api.common.PutToDebugLogException(2, "init: pageshow " + o, n)
        }
    }), webphone_api.$(document).on("pagebeforehide", '[data-role="page"]', function (e) {
        var o = "";
        try {
            if (o = webphone_api.$(this).attr("id"), webphone_api.common.isNull(o) || o.length < 1) return void webphone_api.common.PutToDebugLog(2, "ERROR, init: pagebeforehide NO PAGE");
            if (o.indexOf("settings") >= 0) return void webphone_api._settings.onStop(e);
            if (o.indexOf("dialpad") >= 0) return void webphone_api._dialpad.onStop(e);
            if (o.indexOf("contactslist") >= 0) return void webphone_api._contactslist.onStop(e);
            if (o.indexOf("contactdetails") >= 0) return void webphone_api._contactdetails.onStop(e);
            if (o.indexOf("callhistorylist") >= 0) return void webphone_api._callhistorylist.onStop(e);
            if (o.indexOf("callhistorydetails") >= 0) return void webphone_api._callhistorydetails.onStop(e);
            if (o.indexOf("call") >= 0) return void webphone_api._call.onStop(e);
            if (o.indexOf("addeditcontact") >= 0) return void webphone_api._addeditcontact.onStop(e);
            if (o.indexOf("messagelist") >= 0) return void webphone_api._messagelist.onStop(e);
            if (o.indexOf("message") >= 0) return void webphone_api._message.onStop(e);
            if (o.indexOf("internalbrowser") >= 0) return void webphone_api._internalbrowser.onStop(e);
            if (o.indexOf("startpage") >= 0) return void webphone_api._startpage.onStop(e);
            if (o.indexOf("logview") >= 0) return void webphone_api._logview.onStop(e);
            if (o.indexOf("newuser") >= 0) return void webphone_api._newuser.onStop(e);
            if (o.indexOf("filetransfer") >= 0) return void webphone_api._filetransfer.onStop(e);
            if (o.indexOf("filters") >= 0) return void webphone_api._filters.onStop(e);
            if (o.indexOf("accounts") >= 0) return void webphone_api._accounts.onStop(e);
            if (o.indexOf("smscodeverify") >= 0) return void webphone_api._smscodeverify.onStop(e);
            if (o.indexOf("extra1") >= 0) return void (webphone_api._extra1 && webphone_api._extra1.onStop && (webphone_api._extra1.onStop(e), webphone_api.global.isExtra1Started = !1));
            if (o.indexOf("extra2") >= 0) return void (webphone_api._extra2 && webphone_api._extra2.onStop && (webphone_api._extra2.onStop(e), webphone_api.global.isExtra2Started = !1));
            if (o.indexOf("extra3") >= 0) return void (webphone_api._extra3 && webphone_api._extra3.onStop && (webphone_api._extra3.onStop(e), webphone_api.global.isExtra3Started = !1));
            if (o.indexOf("extra4") >= 0) return void (webphone_api._extra4 && webphone_api._extra4.onStop && (webphone_api._extra4.onStop(e), webphone_api.global.isExtra4Started = !1));
            if (o.indexOf("extra5") >= 0) return void (webphone_api._extra5 && webphone_api._extra5.onStop && (webphone_api._extra5.onStop(e), webphone_api.global.isExtra5Started = !1))
        } catch (t) {
            webphone_api.common.isNull(o) && (o = ""), webphone_api.common.PutToDebugLogException(2, "init: pagebeforehide " + o, t)
        }
    }), webphone_api.$(document).on("pagehide", '[data-role="page"]', function (e) {
        var o = "";
        try {
            if (o = webphone_api.$(this).attr("id"), webphone_api.common.isNull(o) || o.length < 1) return void webphone_api.common.PutToDebugLog(2, "ERROR, init: pagehide NO PAGE");
            if (o.indexOf("settings") >= 0 && webphone_api._settings.onDestroy) return void webphone_api._settings.onDestroy(e);
            if (o.indexOf("dialpad") >= 0 && webphone_api._dialpad.onDestroy) return void webphone_api._dialpad.onDestroy(e);
            if (o.indexOf("contactslist") >= 0 && webphone_api._contactslist.onDestroy) return void webphone_api._contactslist.onDestroy(e);
            if (o.indexOf("contactdetails") >= 0 && webphone_api._contactdetails.onDestroy) return void webphone_api._contactdetails.onDestroy(e);
            if (o.indexOf("callhistorylist") >= 0 && webphone_api._callhistorylist.onDestroy) return void webphone_api._callhistorylist.onDestroy(e);
            if (o.indexOf("callhistorydetails") >= 0 && webphone_api._callhistorydetails.onDestroy) return void webphone_api._callhistorydetails.onDestroy(e);
            if (o.indexOf("call") >= 0 && webphone_api._call.onDestroy) return void webphone_api._call.onDestroy(e);
            if (o.indexOf("addeditcontact") >= 0 && webphone_api._addeditcontact.onDestroy) return void webphone_api._addeditcontact.onDestroy(e);
            if (o.indexOf("messagelist") >= 0 && webphone_api._messagelist.onDestroy) return void webphone_api._messagelist.onDestroy(e);
            if (o.indexOf("message") >= 0 && webphone_api._message.onDestroy) return void webphone_api._message.onDestroy(e);
            if (o.indexOf("internalbrowser") >= 0 && webphone_api._internalbrowser.onDestroy) return void webphone_api._internalbrowser.onDestroy(e);
            if (o.indexOf("startpage") >= 0 && webphone_api._startpage.onDestroy) return void webphone_api._startpage.onDestroy(e);
            if (o.indexOf("logview") >= 0 && webphone_api._logview.onDestroy) return void webphone_api._logview.onDestroy(e);
            if (o.indexOf("newuser") >= 0 && webphone_api._newuser.onDestroy) return void webphone_api._newuser.onDestroy(e);
            if (o.indexOf("filetransfer") >= 0 && webphone_api._filetransfer.onDestroy) return void webphone_api._filetransfer.onDestroy(e);
            if (o.indexOf("filters") >= 0 && webphone_api._filters.onDestroy) return void webphone_api._filters.onDestroy(e);
            if (o.indexOf("accounts") >= 0 && webphone_api._accounts.onDestroy) return void webphone_api._accounts.onDestroy(e);
            if (o.indexOf("smscodeverify") >= 0 && webphone_api._accounts.onDestroy) return void webphone_api._smscodeverify.onDestroy(e)
        } catch (t) {
            webphone_api.common.isNull(o) && (o = ""), webphone_api.common.PutToDebugLogException(2, "init: pagehide " + o, t)
        }
    }), { initialize: e, mobileinit: t, SkinLoaded: o }
}(), function (e, o, t) {
    1 != webphone_api.parameters.issdk && "true" != webphone_api.parameters.issdk && ("function" == typeof define && define.amd ? define(["jquery"], function (n) {
        return t(n, e, o), n.mobile
    }) : t(e.webphone_api.$, e, o))
}(this, document, function (e, o, t) {
    !function (e) {
        e.mobile = {}
    }(e), function (e) {
        e.extend(e.mobile, {
            version: "1.4.2",
            subPageUrlKey: "ui-page",
            hideUrlBar: !0,
            keepNative: ":jqmData(role='none'), :jqmData(role='nojs')",
            activePageClass: "ui-page-active",
            activeBtnClass: "ui-btn-active",
            focusClass: "ui-focus",
            ajaxEnabled: !0,
            hashListeningEnabled: !0,
            linkBindingEnabled: !0,
            defaultPageTransition: "fade",
            maxTransitionWidth: !1,
            minScrollBack: 0,
            defaultDialogTransition: "pop",
            pageLoadErrorMessage: "Error Loading Page",
            pageLoadErrorMessageTheme: "a",
            phonegapNavigationEnabled: !1,
            autoInitializePage: !0,
            pushStateEnabled: !0,
            ignoreContentEnabled: !1,
            buttonMarkup: { hoverDelay: 200 },
            dynamicBaseEnabled: !0,
            pageContainer: e(),
            allowCrossDomainPages: !1,
            dialogHashKey: "&ui-state=dialog"
        })
    }(e), function (e, o, t) {
        var n = {}, i = e.find, a = /(?:\{[\s\S]*\}|\[[\s\S]*\])$/;
        e.extend(e.mobile, {
            ns: "", getAttribute: function (o, t) {
                var n;
                (o = o.jquery ? o[0] : o) && o.getAttribute && (n = o.getAttribute("data-" + e.mobile.ns + t));
                try {
                    n = "true" === n || "false" !== n && ("null" === n ? null : +n + "" === n ? +n : a.test(n) ? JSON.parse(n) : n)
                } catch (i) {
                }
                return n
            }, nsNormalizeDict: n, nsNormalize: function (o) {
                return n[o] || (n[o] = e.camelCase(e.mobile.ns + o))
            }, closestPageData: function (e) {
                return e.closest(":jqmData(role='page'), :jqmData(role='dialog')").data("mobile-page")
            }
        }), e.fn.jqmData = function (o, t) {
            var n;
            return void 0 !== o && (o && (o = e.mobile.nsNormalize(o)), n = arguments.length < 2 || void 0 === t ? this.data(o) : this.data(o, t)), n
        }, e.jqmData = function (o, t, n) {
            var i;
            return void 0 !== t && (i = e.data(o, t ? e.mobile.nsNormalize(t) : t, n)), i
        }, e.fn.jqmRemoveData = function (o) {
            return this.removeData(e.mobile.nsNormalize(o))
        }, e.jqmRemoveData = function (o, t) {
            return e.removeData(o, e.mobile.nsNormalize(t))
        }, e.find = function (o, t, n, a) {
            return o.indexOf(":jqmData") > -1 && (o = o.replace(/:jqmData\(([^)]*)\)/g, "[data-" + (e.mobile.ns || "") + "$1]")), i.call(this, o, t, n, a)
        }, e.extend(e.find, i)
    }(e), function (e, o) {
        function n(o, t) {
            var n, a, r, s = o.nodeName.toLowerCase();
            return "area" === s ? (n = o.parentNode, a = n.name, !(!o.href || !a || "map" !== n.nodeName.toLowerCase()) && (!!(r = e("img[usemap=#" + a + "]")[0]) && i(r))) : (/input|select|textarea|button|object/.test(s) ? !o.disabled : "a" === s ? o.href || t : t) && i(o)
        }

        function i(o) {
            return e.expr.filters.visible(o) && !e(o).parents().addBack().filter(function () {
                return "hidden" === e.css(this, "visibility")
            }).length
        }

        var a = 0, r = /^ui-id-\d+$/;
        e.ui = e.ui || {}, e.extend(e.ui, {
            version: "c0ab71056b936627e8a7821f03c044aec6280a40",
            keyCode: {
                BACKSPACE: 8,
                COMMA: 188,
                DELETE: 46,
                DOWN: 40,
                END: 35,
                ENTER: 13,
                ESCAPE: 27,
                HOME: 36,
                LEFT: 37,
                PAGE_DOWN: 34,
                PAGE_UP: 33,
                PERIOD: 190,
                RIGHT: 39,
                SPACE: 32,
                TAB: 9,
                UP: 38
            }
        }), e.fn.extend({
            focus: function (o) {
                return function (t, n) {
                    return "number" == typeof t ? this.each(function () {
                        var o = this;
                        setTimeout(function () {
                            e(o).focus(), n && n.call(o)
                        }, t)
                    }) : o.apply(this, arguments)
                }
            }(e.fn.focus), scrollParent: function () {
                var o;
                return o = e.ui.ie && /(static|relative)/.test(this.css("position")) || /absolute/.test(this.css("position")) ? this.parents().filter(function () {
                    return /(relative|absolute|fixed)/.test(e.css(this, "position")) && /(auto|scroll)/.test(e.css(this, "overflow") + e.css(this, "overflow-y") + e.css(this, "overflow-x"))
                }).eq(0) : this.parents().filter(function () {
                    return /(auto|scroll)/.test(e.css(this, "overflow") + e.css(this, "overflow-y") + e.css(this, "overflow-x"))
                }).eq(0), /fixed/.test(this.css("position")) || !o.length ? e(this[0].ownerDocument || t) : o
            }, uniqueId: function () {
                return this.each(function () {
                    this.id || (this.id = "ui-id-" + ++a)
                })
            }, removeUniqueId: function () {
                return this.each(function () {
                    r.test(this.id) && e(this).removeAttr("id")
                })
            }
        }), e.extend(e.expr[":"], {
            data: e.expr.createPseudo ? e.expr.createPseudo(function (o) {
                return function (t) {
                    return !!e.data(t, o)
                }
            }) : function (o, t, n) {
                return !!e.data(o, n[3])
            }, focusable: function (o) {
                return n(o, !isNaN(e.attr(o, "tabindex")))
            }, tabbable: function (o) {
                var t = e.attr(o, "tabindex"), i = isNaN(t);
                return (i || t >= 0) && n(o, !i)
            }
        }), e("<a>").outerWidth(1).jquery || e.each(["Width", "Height"], function (t, n) {
            function i(o, t, n, i) {
                return e.each(a, function () {
                    t -= parseFloat(e.css(o, "padding" + this)) || 0, n && (t -= parseFloat(e.css(o, "border" + this + "Width")) || 0), i && (t -= parseFloat(e.css(o, "margin" + this)) || 0)
                }), t
            }

            var a = "Width" === n ? ["Left", "Right"] : ["Top", "Bottom"], r = n.toLowerCase(), s = {
                innerWidth: e.fn.innerWidth,
                innerHeight: e.fn.innerHeight,
                outerWidth: e.fn.outerWidth,
                outerHeight: e.fn.outerHeight
            };
            e.fn["inner" + n] = function (t) {
                return t === o ? s["inner" + n].call(this) : this.each(function () {
                    e(this).css(r, i(this, t) + "px")
                })
            }, e.fn["outer" + n] = function (o, t) {
                return "number" != typeof o ? s["outer" + n].call(this, o) : this.each(function () {
                    e(this).css(r, i(this, o, !0, t) + "px")
                })
            }
        }), e.fn.addBack || (e.fn.addBack = function (e) {
            return this.add(null == e ? this.prevObject : this.prevObject.filter(e))
        }), e("<a>").data("a-b", "a").removeData("a-b").data("a-b") && (e.fn.removeData = function (o) {
            return function (t) {
                return arguments.length ? o.call(this, e.camelCase(t)) : o.call(this)
            }
        }(e.fn.removeData)), e.ui.ie = !!/msie [\w.]+/.exec(navigator.userAgent.toLowerCase()), e.support.selectstart = "onselectstart" in t.createElement("div"), e.fn.extend({
            disableSelection: function () {
                return this.bind((e.support.selectstart ? "selectstart" : "mousedown") + ".ui-disableSelection", function (e) {
                    e.preventDefault()
                })
            }, enableSelection: function () {
                return this.unbind(".ui-disableSelection")
            }, zIndex: function (n) {
                if (n !== o) return this.css("zIndex", n);
                if (this.length) for (var i, a, r = e(this[0]); r.length && r[0] !== t;) {
                    if (("absolute" === (i = r.css("position")) || "relative" === i || "fixed" === i) && (a = parseInt(r.css("zIndex"), 10), !isNaN(a) && 0 !== a)) return a;
                    r = r.parent()
                }
                return 0
            }
        }), e.ui.plugin = {
            add: function (o, t, n) {
                var i, a = e.ui[o].prototype;
                for (i in n) a.plugins[i] = a.plugins[i] || [], a.plugins[i].push([t, n[i]])
            }, call: function (e, o, t, n) {
                var i, a = e.plugins[o];
                if (a && (n || e.element[0].parentNode && 11 !== e.element[0].parentNode.nodeType)) for (i = 0; i < a.length; i++) e.options[a[i][0]] && a[i][1].apply(e.element, t)
            }
        }
    }(e), function (e, o) {
        var n = function (o, t) {
            var n = o.parent(), i = [], a = n.children(":jqmData(role='header')"),
                r = o.children(":jqmData(role='header')"), s = n.children(":jqmData(role='footer')"),
                l = o.children(":jqmData(role='footer')");
            return 0 === r.length && a.length > 0 && (i = i.concat(a.toArray())), 0 === l.length && s.length > 0 && (i = i.concat(s.toArray())), e.each(i, function (o, n) {
                t -= e(n).outerHeight()
            }), Math.max(0, t)
        };
        e.extend(e.mobile, {
            window: e(o), document: e(t), keyCode: e.ui.keyCode, behaviors: {}, silentScroll: function (t) {
                "number" !== e.type(t) && (t = e.mobile.defaultHomeScroll), e.event.special.scrollstart.enabled = !1, setTimeout(function () {
                    o.scrollTo(0, t), e.mobile.document.trigger("silentscroll", { x: 0, y: t })
                }, 20), setTimeout(function () {
                    e.event.special.scrollstart.enabled = !0
                }, 150)
            }, getClosestBaseUrl: function (o) {
                var t = e(o).closest(".ui-page").jqmData("url"), n = e.mobile.path.documentBase.hrefNoHash;
                return e.mobile.dynamicBaseEnabled && t && e.mobile.path.isPath(t) || (t = n), e.mobile.path.makeUrlAbsolute(t, n)
            }, removeActiveLinkClass: function (o) {
                !e.mobile.activeClickedLink || e.mobile.activeClickedLink.closest("." + e.mobile.activePageClass).length && !o || e.mobile.activeClickedLink.removeClass(e.mobile.activeBtnClass), e.mobile.activeClickedLink = null
            }, getInheritedTheme: function (e, o) {
                for (var t, n, i = e[0], a = "", r = /ui-(bar|body|overlay)-([a-z])\b/; i && !((t = i.className || "") && (n = r.exec(t)) && (a = n[2]));) i = i.parentNode;
                return a || o || "a"
            }, enhanceable: function (e) {
                return this.haveParents(e, "enhance")
            }, hijackable: function (e) {
                return this.haveParents(e, "ajax")
            }, haveParents: function (o, t) {
                if (!e.mobile.ignoreContentEnabled) return o;
                var n, i, a, r, s = o.length, l = e();
                for (r = 0; s > r; r++) {
                    for (i = o.eq(r), a = !1, n = o[r]; n;) {
                        if ("false" === (n.getAttribute ? n.getAttribute("data-" + e.mobile.ns + t) : "")) {
                            a = !0;
                            break
                        }
                        n = n.parentNode
                    }
                    a || (l = l.add(i))
                }
                return l
            }, getScreenHeight: function () {
                return o.innerHeight || e.mobile.window.height()
            }, resetActivePageHeight: function (o) {
                var t = e("." + e.mobile.activePageClass), i = t.height(), a = t.outerHeight(!0);
                o = n(t, "number" == typeof o ? o : e.mobile.getScreenHeight()), t.css("min-height", o - (a - i))
            }, loading: function () {
                var o = this.loading._widget || e(e.mobile.loader.prototype.defaultHtml).loader(),
                    t = o.loader.apply(o, arguments);
                return this.loading._widget = o, t
            }
        }), e.addDependents = function (o, t) {
            var n = e(o), i = n.jqmData("dependents") || e();
            n.jqmData("dependents", e(i).add(t))
        }, e.fn.extend({
            removeWithDependents: function () {
                e.removeWithDependents(this)
            }, enhanceWithin: function () {
                var o, t = {}, n = e.mobile.page.prototype.keepNativeSelector(), i = this;
                e.mobile.nojs && e.mobile.nojs(this), e.mobile.links && e.mobile.links(this), e.mobile.degradeInputsWithin && e.mobile.degradeInputsWithin(this), e.fn.buttonMarkup && this.find(e.fn.buttonMarkup.initSelector).not(n).jqmEnhanceable().buttonMarkup(), e.fn.fieldcontain && this.find(":jqmData(role='fieldcontain')").not(n).jqmEnhanceable().fieldcontain(), e.each(e.mobile.widgets, function (o, a) {
                    if (a.initSelector) {
                        var r = e.mobile.enhanceable(i.find(a.initSelector));
                        r.length > 0 && (r = r.not(n)), r.length > 0 && (t[a.prototype.widgetName] = r)
                    }
                });
                for (o in t) t[o][o]();
                return this
            }, addDependents: function (o) {
                e.addDependents(this, o)
            }, getEncodedText: function () {
                return e("<a>").text(this.text()).html()
            }, jqmEnhanceable: function () {
                return e.mobile.enhanceable(this)
            }, jqmHijackable: function () {
                return e.mobile.hijackable(this)
            }
        }), e.removeWithDependents = function (o) {
            var t = e(o);
            (t.jqmData("dependents") || e()).remove(), t.remove()
        }, e.addDependents = function (o, t) {
            var n = e(o), i = n.jqmData("dependents") || e();
            n.jqmData("dependents", e(i).add(t))
        }, e.find.matches = function (o, t) {
            return e.find(o, null, null, t)
        }, e.find.matchesSelector = function (o, t) {
            return e.find(t, null, null, [o]).length > 0
        }
    }(e, this), function (e, o) {
        var t = 0, n = Array.prototype.slice, i = e.cleanData;
        e.cleanData = function (o) {
            for (var t, n = 0; null != (t = o[n]); n++) try {
                e(t).triggerHandler("remove")
            } catch (a) {
            }
            i(o)
        }, e.widget = function (o, t, n) {
            var i, a, r, s, l = {}, p = o.split(".")[0];
            return o = o.split(".")[1], i = p + "-" + o, n || (n = t, t = e.Widget), e.expr[":"][i.toLowerCase()] = function (o) {
                return !!e.data(o, i)
            }, e[p] = e[p] || {}, a = e[p][o], r = e[p][o] = function (e, o) {
                return this._createWidget ? void (arguments.length && this._createWidget(e, o)) : new r(e, o)
            }, e.extend(r, a, {
                version: n.version,
                _proto: e.extend({}, n),
                _childConstructors: []
            }), s = new t, s.options = e.widget.extend({}, s.options), e.each(n, function (o, n) {
                return e.isFunction(n) ? void (l[o] = function () {
                    var e = function () {
                        return t.prototype[o].apply(this, arguments)
                    }, i = function (e) {
                        return t.prototype[o].apply(this, e)
                    };
                    return function () {
                        var o, t = this._super, a = this._superApply;
                        return this._super = e, this._superApply = i, o = n.apply(this, arguments), this._super = t, this._superApply = a, o
                    }
                }()) : void (l[o] = n)
            }), r.prototype = e.widget.extend(s, { widgetEventPrefix: a ? s.widgetEventPrefix || o : o }, l, {
                constructor: r,
                namespace: p,
                widgetName: o,
                widgetFullName: i
            }), a ? (e.each(a._childConstructors, function (o, t) {
                var n = t.prototype;
                e.widget(n.namespace + "." + n.widgetName, r, t._proto)
            }), delete a._childConstructors) : t._childConstructors.push(r), e.widget.bridge(o, r), r
        }, e.widget.extend = function (t) {
            for (var i, a, r = n.call(arguments, 1), s = 0, l = r.length; l > s; s++) for (i in r[s]) a = r[s][i], r[s].hasOwnProperty(i) && a !== o && (t[i] = e.isPlainObject(a) ? e.isPlainObject(t[i]) ? e.widget.extend({}, t[i], a) : e.widget.extend({}, a) : a);
            return t
        }, e.widget.bridge = function (t, i) {
            var a = i.prototype.widgetFullName || t;
            e.fn[t] = function (r) {
                var s = "string" == typeof r, l = n.call(arguments, 1), p = this;
                return r = !s && l.length ? e.widget.extend.apply(null, [r].concat(l)) : r, this.each(s ? function () {
                    var n, i = e.data(this, a);
                    return "instance" === r ? (p = i, !1) : i ? e.isFunction(i[r]) && "_" !== r.charAt(0) ? (n = i[r].apply(i, l), n !== i && n !== o ? (p = n && n.jquery ? p.pushStack(n.get()) : n, !1) : void 0) : e.error("no such method '" + r + "' for " + t + " widget instance") : e.error("cannot call methods on " + t + " prior to initialization; attempted to call method '" + r + "'")
                } : function () {
                    var o = e.data(this, a);
                    o ? o.option(r || {})._init() : e.data(this, a, new i(r, this))
                }), p
            }
        }, e.Widget = function () {
        }, e.Widget._childConstructors = [], e.Widget.prototype = {
            widgetName: "widget",
            widgetEventPrefix: "",
            defaultElement: "<div>",
            options: { disabled: !1, create: null },
            _createWidget: function (o, n) {
                n = e(n || this.defaultElement || this)[0], this.element = e(n), this.uuid = t++, this.eventNamespace = "." + this.widgetName + this.uuid, this.options = e.widget.extend({}, this.options, this._getCreateOptions(), o), this.bindings = e(), this.hoverable = e(), this.focusable = e(), n !== this && (e.data(n, this.widgetFullName, this), this._on(!0, this.element, {
                    remove: function (e) {
                        e.target === n && this.destroy()
                    }
                }), this.document = e(n.style ? n.ownerDocument : n.document || n), this.window = e(this.document[0].defaultView || this.document[0].parentWindow)), this._create(), this._trigger("create", null, this._getCreateEventData()), this._init()
            },
            _getCreateOptions: e.noop,
            _getCreateEventData: e.noop,
            _create: e.noop,
            _init: e.noop,
            destroy: function () {
                this._destroy(), this.element.unbind(this.eventNamespace).removeData(this.widgetFullName).removeData(e.camelCase(this.widgetFullName)), this.widget().unbind(this.eventNamespace).removeAttr("aria-disabled").removeClass(this.widgetFullName + "-disabled ui-state-disabled"), this.bindings.unbind(this.eventNamespace), this.hoverable.removeClass("ui-state-hover"), this.focusable.removeClass("ui-state-focus")
            },
            _destroy: e.noop,
            widget: function () {
                return this.element
            },
            option: function (t, n) {
                var i, a, r, s = t;
                if (0 === arguments.length) return e.widget.extend({}, this.options);
                if ("string" == typeof t) if (s = {}, i = t.split("."), t = i.shift(), i.length) {
                    for (a = s[t] = e.widget.extend({}, this.options[t]), r = 0; r < i.length - 1; r++) a[i[r]] = a[i[r]] || {}, a = a[i[r]];
                    if (t = i.pop(), n === o) return a[t] === o ? null : a[t];
                    a[t] = n
                } else {
                    if (n === o) return this.options[t] === o ? null : this.options[t];
                    s[t] = n
                }
                return this._setOptions(s), this
            },
            _setOptions: function (e) {
                var o;
                for (o in e) this._setOption(o, e[o]);
                return this
            },
            _setOption: function (e, o) {
                return this.options[e] = o, "disabled" === e && (this.widget().toggleClass(this.widgetFullName + "-disabled", !!o), this.hoverable.removeClass("ui-state-hover"), this.focusable.removeClass("ui-state-focus")), this
            },
            enable: function () {
                return this._setOptions({ disabled: !1 })
            },
            disable: function () {
                return this._setOptions({ disabled: !0 })
            },
            _on: function (o, t, n) {
                var i, a = this;
                "boolean" != typeof o && (n = t, t = o, o = !1), n ? (t = i = e(t), this.bindings = this.bindings.add(t)) : (n = t, t = this.element, i = this.widget()), e.each(n, function (n, r) {
                    function s() {
                        return o || !0 !== a.options.disabled && !e(this).hasClass("ui-state-disabled") ? ("string" == typeof r ? a[r] : r).apply(a, arguments) : void 0
                    }

                    "string" != typeof r && (s.guid = r.guid = r.guid || s.guid || e.guid++);
                    var l = n.match(/^(\w+)\s*(.*)$/), p = l[1] + a.eventNamespace, c = l[2];
                    c ? i.delegate(c, p, s) : t.bind(p, s)
                })
            },
            _off: function (e, o) {
                o = (o || "").split(" ").join(this.eventNamespace + " ") + this.eventNamespace, e.unbind(o).undelegate(o)
            },
            _delay: function (e, o) {
                function t() {
                    return ("string" == typeof e ? n[e] : e).apply(n, arguments)
                }

                var n = this;
                return setTimeout(t, o || 0)
            },
            _hoverable: function (o) {
                this.hoverable = this.hoverable.add(o), this._on(o, {
                    mouseenter: function (o) {
                        e(o.currentTarget).addClass("ui-state-hover")
                    }, mouseleave: function (o) {
                        e(o.currentTarget).removeClass("ui-state-hover")
                    }
                })
            },
            _focusable: function (o) {
                this.focusable = this.focusable.add(o), this._on(o, {
                    focusin: function (o) {
                        e(o.currentTarget).addClass("ui-state-focus")
                    }, focusout: function (o) {
                        e(o.currentTarget).removeClass("ui-state-focus")
                    }
                })
            },
            _trigger: function (o, t, n) {
                var i, a, r = this.options[o];
                if (n = n || {}, t = e.Event(t), t.type = (o === this.widgetEventPrefix ? o : this.widgetEventPrefix + o).toLowerCase(), t.target = this.element[0], a = t.originalEvent) for (i in a) i in t || (t[i] = a[i]);
                return this.element.trigger(t, n), !(e.isFunction(r) && !1 === r.apply(this.element[0], [t].concat(n)) || t.isDefaultPrevented())
            }
        }, e.each({ show: "fadeIn", hide: "fadeOut" }, function (o, t) {
            e.Widget.prototype["_" + o] = function (n, i, a) {
                "string" == typeof i && (i = { effect: i });
                var r, s = i ? !0 === i || "number" == typeof i ? t : i.effect || t : o;
                i = i || {}, "number" == typeof i && (i = { duration: i }), r = !e.isEmptyObject(i), i.complete = a, i.delay && n.delay(i.delay), r && e.effects && e.effects.effect[s] ? n[o](i) : s !== o && n[s] ? n[s](i.duration, i.easing, a) : n.queue(function (t) {
                    e(this)[o](), a && a.call(n[0]), t()
                })
            }
        })
    }(e), function (e) {
        var o = function (e) {
            return "-" + e.toLowerCase()
        };
        e.extend(e.Widget.prototype, {
            _getCreateOptions: function () {
                var t, n, i = this.element[0], a = {};
                if (!e.mobile.getAttribute(i, "defaults")) for (t in this.options) null != (n = e.mobile.getAttribute(i, t.replace(/[A-Z]/g, o))) && (a[t] = n);
                return a
            }
        }), e.mobile.widget = e.Widget
    }(e), function (e) {
        var o = "ui-loader", t = e("html");
        e.widget("mobile.loader", {
            options: { theme: "a", textVisible: !1, html: "", text: "loading" },
            defaultHtml: "<div class='" + o + "'><span class='ui-icon-loading'></span><h1></h1></div>",
            fakeFixLoader: function () {
                var o = e("." + e.mobile.activeBtnClass).first();
                this.element.css({ top: e.support.scrollTop && this.window.scrollTop() + this.window.height() / 2 || o.length && o.offset().top || 100 })
            },
            checkLoaderPosition: function () {
                var o = this.element.offset(), t = this.window.scrollTop(), n = e.mobile.getScreenHeight();
                (o.top < t || o.top - t > n) && (this.element.addClass("ui-loader-fakefix"), this.fakeFixLoader(), this.window.unbind("scroll", this.checkLoaderPosition).bind("scroll", e.proxy(this.fakeFixLoader, this)))
            },
            resetHtml: function () {
                this.element.html(e(this.defaultHtml).html())
            },
            show: function (n, i, a) {
                var r, s, l;
                this.resetHtml(), "object" === e.type(n) ? (l = e.extend({}, this.options, n), n = l.theme) : (l = this.options, n = n || l.theme), s = i || (!1 === l.text ? "" : l.text), t.addClass("ui-loading"), r = l.textVisible, this.element.attr("class", o + " ui-corner-all ui-body-" + n + " ui-loader-" + (r || i || n.text ? "verbose" : "default") + (l.textonly || a ? " ui-loader-textonly" : "")), l.html ? this.element.html(l.html) : this.element.find("h1").text(s), this.element.appendTo(e.mobile.pageContainer), this.checkLoaderPosition(), this.window.bind("scroll", e.proxy(this.checkLoaderPosition, this))
            },
            hide: function () {
                t.removeClass("ui-loading"), this.options.text && this.element.removeClass("ui-loader-fakefix"), e.mobile.window.unbind("scroll", this.fakeFixLoader), e.mobile.window.unbind("scroll", this.checkLoaderPosition)
            }
        })
    }(e), function (e, o, n) {
        "$:nomunge";

        function i(e) {
            return e = e || location.href, "#" + e.replace(/^[^#]*#?(.*)$/, "$1")
        }

        var a, r = "hashchange", s = t, l = e.event.special, p = s.documentMode,
            c = "on" + r in o && (p === n || p > 7);
        e.fn[r] = function (e) {
            return e ? this.bind(r, e) : this.trigger(r)
        }, e.fn[r].delay = 50, l[r] = e.extend(l[r], {
            setup: function () {
                return !c && void e(a.start)
            }, teardown: function () {
                return !c && void e(a.stop)
            }
        }), a = function () {
            function t() {
                var n = i(), s = m(p);
                n !== p ? (h(p = n, s), e(o).trigger(r)) : s !== p && (location.href = location.href.replace(/#.*/, "") + s), a = setTimeout(t, e.fn[r].delay)
            }

            var a, l = {}, p = i(), u = function (e) {
                return e
            }, h = u, m = u;
            return l.start = function () {
                a || t()
            }, l.stop = function () {
                a && clearTimeout(a), a = n
            }, o.attachEvent && !o.addEventListener && !c && function () {
                var o, n;
                l.start = function () {
                    o || (n = e.fn[r].src, n = n && n + i(), o = e('<iframe tabindex="-1" title="empty"/>').hide().one("load", function () {
                        n || h(i()), t()
                    }).attr("src", n || "javascript:0").insertAfter("body")[0].contentWindow, s.onpropertychange = function () {
                        try {
                            "title" === event.propertyName && (o.document.title = s.title)
                        } catch (e) {
                        }
                    })
                }, l.stop = u, m = function () {
                    return i(o.location.href)
                }, h = function (t, n) {
                    var i = o.document, a = e.fn[r].domain;
                    t !== n && (i.title = s.title, i.open(), a && i.write('<script>document.domain="' + a + '"<\/script>'), i.close(), o.location.hash = t)
                }
            }(), l
        }()
    }(e, this), function (e) {
        o.matchMedia = o.matchMedia || function (e) {
            var o, t = e.documentElement, n = t.firstElementChild || t.firstChild, i = e.createElement("body"),
                a = e.createElement("div");
            return a.id = "mq-test-1", a.style.cssText = "position:absolute;top:-100em", i.style.background = "none", i.appendChild(a), function (e) {
                return a.innerHTML = '&shy;<style media="' + e + '"> #mq-test-1 { width: 42px; }</style>', t.insertBefore(i, n), o = 42 === a.offsetWidth, t.removeChild(i), {
                    matches: o,
                    media: e
                }
            }
        }(t), e.mobile.media = function (e) {
            return o.matchMedia(e).matches
        }
    }(e), function (e) {
        var o = { touch: "ontouchend" in t };
        e.mobile.support = e.mobile.support || {}, e.extend(e.support, o), e.extend(e.mobile.support, o)
    }(e), function (e) {
        e.extend(e.support, { orientation: "orientation" in o && "onorientationchange" in o })
    }(e), function (e, n) {
        function i(e) {
            var o, t = e.charAt(0).toUpperCase() + e.substr(1), i = (e + " " + p.join(t + " ") + t).split(" ");
            for (o in i) if (l[i[o]] !== n) return !0
        }

        function a() {
            var t = o,
                n = !(!t.document.createElementNS || !t.document.createElementNS("http://www.w3.org/2000/svg", "svg").createSVGRect || t.opera && -1 === navigator.userAgent.indexOf("Chrome")),
                i = function (o) {
                    o && n || e("html").addClass("ui-nosvg")
                }, a = new t.Image;
            a.onerror = function () {
                i(!1)
            }, a.onload = function () {
                i(1 === a.width && 1 === a.height)
            }, a.src = "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///ywAAAAAAQABAAACAUwAOw=="
        }

        var r, s = e("<body>").prependTo("html"), l = s[0].style, p = ["Webkit", "Moz", "O"],
            c = "palmGetResource" in o, u = o.operamini && "[object OperaMini]" === {}.toString.call(o.operamini),
            h = o.blackberry && !i("-webkit-transform");
        e.extend(e.mobile, { browser: {} }), e.mobile.browser.oldIE = function () {
            var e = 3, o = t.createElement("div"), n = o.all || [];
            do {
                o.innerHTML = "\x3c!--[if gt IE " + ++e + "]><br><![endif]--\x3e"
            } while (n[0]);
            return e > 4 ? e : !e
        }(), e.extend(e.support, {
            pushState: "pushState" in history && "replaceState" in history && !(o.navigator.userAgent.indexOf("Firefox") >= 0 && o.top !== o) && -1 === o.navigator.userAgent.search(/CriOS/),
            mediaquery: e.mobile.media("only all"),
            cssPseudoElement: !!i("content"),
            touchOverflow: !!i("overflowScrolling"),
            cssTransform3d: function () {
                var i, a, r, l = "transform-3d",
                    c = e.mobile.media("(-" + p.join("-" + l + "),(-") + "-" + l + "),(" + l + ")");
                if (c) return !!c;
                i = t.createElement("div"), a = { MozTransform: "-moz-transform", transform: "transform" }, s.append(i);
                for (r in a) i.style[r] !== n && (i.style[r] = "translate3d( 100px, 1px, 1px )", c = o.getComputedStyle(i).getPropertyValue(a[r]));
                return !!c && "none" !== c
            }(),
            boxShadow: !!i("boxShadow") && !h,
            fixedPosition: function () {
                var e = o, t = navigator.userAgent, n = navigator.platform, i = t.match(/AppleWebKit\/([0-9]+)/),
                    a = !!i && i[1], r = t.match(/Fennec\/([0-9]+)/), s = !!r && r[1],
                    l = t.match(/Opera Mobi\/([0-9]+)/), p = !!l && l[1];
                return !((n.indexOf("iPhone") > -1 || n.indexOf("iPad") > -1 || n.indexOf("iPod") > -1) && a && 534 > a || e.operamini && "[object OperaMini]" === {}.toString.call(e.operamini) || l && 7458 > p || t.indexOf("Android") > -1 && a && 533 > a || s && 6 > s || "palmGetResource" in o && a && 534 > a || t.indexOf("MeeGo") > -1 && t.indexOf("NokiaBrowser/8.5.0") > -1)
            }(),
            scrollTop: ("pageXOffset" in o || "scrollTop" in t.documentElement || "scrollTop" in s[0]) && !c && !u,
            dynamicBaseTag: function () {
                var o, t, n = location.protocol + "//" + location.host + location.pathname + "ui-dir/",
                    i = e("head base"), a = null, r = "";
                return i.length ? r = i.attr("href") : i = a = e("<base>", { href: n }).appendTo("head"), o = e("<a href='testurl' />").prependTo(s), t = o[0].href, i[0].href = r || location.pathname, a && a.remove(), 0 === t.indexOf(n)
            }(),
            cssPointerEvents: function () {
                var e, n = t.createElement("x"), i = t.documentElement, a = o.getComputedStyle;
                return "pointerEvents" in n.style && (n.style.pointerEvents = "auto", n.style.pointerEvents = "x", i.appendChild(n), e = a && "auto" === a(n, "").pointerEvents, i.removeChild(n), !!e)
            }(),
            boundingRect: function () {
                return "undefined" != typeof t.createElement("div").getBoundingClientRect
            }(),
            inlineSVG: a
        }), s.remove(), r = function () {
            var e = o.navigator.userAgent;
            return e.indexOf("Nokia") > -1 && (e.indexOf("Symbian/3") > -1 || e.indexOf("Series60/5") > -1) && e.indexOf("AppleWebKit") > -1 && e.match(/(BrowserNG|NokiaBrowser)\/7\.[0-3]/)
        }(), e.mobile.gradeA = function () {
            return (e.support.mediaquery && e.support.cssPseudoElement || e.mobile.browser.oldIE && e.mobile.browser.oldIE >= 8) && (e.support.boundingRect || null !== e.fn.jquery.match(/1\.[0-7+]\.[0-9+]?/))
        }, e.mobile.ajaxBlacklist = o.blackberry && !o.WebKitPoint || u || r, r && e(function () {
            e("head link[rel='stylesheet']").attr("rel", "alternate stylesheet").attr("rel", "stylesheet")
        }), e.support.boxShadow || e("html").addClass("ui-noboxshadow")
    }(e), function (e, o) {
        var t, n = e.mobile.window, i = function () {
        };
        e.event.special.beforenavigate = {
            setup: function () {
                n.on("navigate", i)
            }, teardown: function () {
                n.off("navigate", i)
            }
        }, e.event.special.navigate = t = {
            bound: !1,
            pushStateEnabled: !0,
            originalEventName: void 0,
            isPushStateEnabled: function () {
                return e.support.pushState && !0 === e.mobile.pushStateEnabled && this.isHashChangeEnabled()
            },
            isHashChangeEnabled: function () {
                return !0 === e.mobile.hashListeningEnabled
            },
            popstate: function (o) {
                var t = new e.Event("navigate"), i = new e.Event("beforenavigate"), a = o.originalEvent.state || {};
                i.originalEvent = o, n.trigger(i), i.isDefaultPrevented() || (o.historyState && e.extend(a, o.historyState), t.originalEvent = o, setTimeout(function () {
                    n.trigger(t, { state: a })
                }, 0))
            },
            hashchange: function (o) {
                var t = new e.Event("navigate"), i = new e.Event("beforenavigate");
                i.originalEvent = o, n.trigger(i), i.isDefaultPrevented() || (t.originalEvent = o, n.trigger(t, { state: o.hashchangeState || {} }))
            },
            setup: function () {
                t.bound || (t.bound = !0, t.isPushStateEnabled() ? (t.originalEventName = "popstate", n.bind("popstate.navigate", t.popstate)) : t.isHashChangeEnabled() && (t.originalEventName = "hashchange", n.bind("hashchange.navigate", t.hashchange)))
            }
        }
    }(e), function (e, t) {
        var n, i, a = "&ui-state=dialog";
        e.mobile.path = n = {
            uiStateKey: "&ui-state",
            urlParseRE: /^\s*(((([^:\/#\?]+:)?(?:(\/\/)((?:(([^:@\/#\?]+)(?:\:([^:@\/#\?]+))?)@)?(([^:\/#\?\]\[]+|\[[^\/\]@#?]+\])(?:\:([0-9]+))?))?)?)?((\/?(?:[^\/\?#]+\/+)*)([^\?#]*)))?(\?[^#]+)?)(#.*)?/,
            getLocation: function (e) {
                var o = e ? this.parseUrl(e) : location, t = this.parseUrl(e || location.href).hash;
                return t = "#" === t ? "" : t, o.protocol + "//" + o.host + o.pathname + o.search + t
            },
            getDocumentUrl: function (o) {
                return o ? e.extend({}, n.documentUrl) : n.documentUrl.href
            },
            parseLocation: function () {
                return this.parseUrl(this.getLocation())
            },
            parseUrl: function (o) {
                if ("object" === e.type(o)) return o;
                var t = n.urlParseRE.exec(o || "") || [];
                return {
                    href: t[0] || "",
                    hrefNoHash: t[1] || "",
                    hrefNoSearch: t[2] || "",
                    domain: t[3] || "",
                    protocol: t[4] || "",
                    doubleSlash: t[5] || "",
                    authority: t[6] || "",
                    username: t[8] || "",
                    password: t[9] || "",
                    host: t[10] || "",
                    hostname: t[11] || "",
                    port: t[12] || "",
                    pathname: t[13] || "",
                    directory: t[14] || "",
                    filename: t[15] || "",
                    search: t[16] || "",
                    hash: t[17] || ""
                }
            },
            makePathAbsolute: function (e, o) {
                var t, n, i, a;
                if (e && "/" === e.charAt(0)) return e;
                for (e = e || "", o = o ? o.replace(/^\/|(\/[^\/]*|[^\/]+)$/g, "") : "", t = o ? o.split("/") : [], n = e.split("/"), i = 0; i < n.length; i++) switch (a = n[i]) {
                    case ".":
                        break;
                    case "..":
                        t.length && t.pop();
                        break;
                    default:
                        t.push(a)
                }
                return "/" + t.join("/")
            },
            isSameDomain: function (e, o) {
                return n.parseUrl(e).domain === n.parseUrl(o).domain
            },
            isRelativeUrl: function (e) {
                return "" === n.parseUrl(e).protocol
            },
            isAbsoluteUrl: function (e) {
                return "" !== n.parseUrl(e).protocol
            },
            makeUrlAbsolute: function (e, o) {
                if (!n.isRelativeUrl(e)) return e;
                o === t && (o = this.documentBase);
                var i = n.parseUrl(e), a = n.parseUrl(o), r = i.protocol || a.protocol,
                    s = i.protocol ? i.doubleSlash : i.doubleSlash || a.doubleSlash, l = i.authority || a.authority,
                    p = "" !== i.pathname;
                return r + s + l + n.makePathAbsolute(i.pathname || a.filename, a.pathname) + (i.search || !p && a.search || "") + i.hash
            },
            addSearchParams: function (o, t) {
                var i = n.parseUrl(o), a = "object" == typeof t ? e.param(t) : t, r = i.search || "?";
                return i.hrefNoSearch + r + ("?" !== r.charAt(r.length - 1) ? "&" : "") + a + (i.hash || "")
            },
            convertUrlToDataUrl: function (e) {
                var t = n.parseUrl(e);
                return n.isEmbeddedPage(t) ? t.hash.split(a)[0].replace(/^#/, "").replace(/\?.*$/, "") : n.isSameDomain(t, this.documentBase) ? t.hrefNoHash.replace(this.documentBase.domain, "").split(a)[0] : o.decodeURIComponent(e)
            },
            get: function (e) {
                return e === t && (e = n.parseLocation().hash), n.stripHash(e).replace(/[^\/]*\.[^\/*]+$/, "")
            },
            set: function (e) {
                location.hash = e
            },
            isPath: function (e) {
                return /\//.test(e)
            },
            clean: function (e) {
                return e.replace(this.documentBase.domain, "")
            },
            stripHash: function (e) {
                return e.replace(/^#/, "")
            },
            stripQueryParams: function (e) {
                return e.replace(/\?.*$/, "")
            },
            cleanHash: function (e) {
                return n.stripHash(e.replace(/\?.*$/, "").replace(a, ""))
            },
            isHashValid: function (e) {
                return /^#[^#]+$/.test(e)
            },
            isExternal: function (e) {
                var o = n.parseUrl(e);
                return !(!o.protocol || o.domain === this.documentUrl.domain)
            },
            hasProtocol: function (e) {
                return /^(:?\w+:)/.test(e)
            },
            isEmbeddedPage: function (e) {
                var o = n.parseUrl(e);
                return "" !== o.protocol ? !this.isPath(o.hash) && o.hash && (o.hrefNoHash === this.documentUrl.hrefNoHash || this.documentBaseDiffers && o.hrefNoHash === this.documentBase.hrefNoHash) : /^#/.test(o.href)
            },
            squash: function (e, o) {
                var t, i, a, r, s = this.isPath(e), l = this.parseUrl(e), p = l.hash, c = "";
                return o = o || (n.isPath(e) ? n.getLocation() : n.getDocumentUrl()), i = s ? n.stripHash(e) : e, i = n.isPath(l.hash) ? n.stripHash(l.hash) : i, r = i.indexOf(this.uiStateKey), r > -1 && (c = i.slice(r), i = i.slice(0, r)), t = n.makeUrlAbsolute(i, o), a = this.parseUrl(t).search, s ? ((n.isPath(p) || 0 === p.replace("#", "").indexOf(this.uiStateKey)) && (p = ""), c && -1 === p.indexOf(this.uiStateKey) && (p += c), -1 === p.indexOf("#") && "" !== p && (p = "#" + p), t = n.parseUrl(t), t = t.protocol + "//" + t.host + t.pathname + a + p) : t += t.indexOf("#") > -1 ? c : "#" + c, t
            },
            isPreservableHash: function (e) {
                return 0 === e.replace("#", "").indexOf(this.uiStateKey)
            },
            hashToSelector: function (e) {
                var o = "#" === e.substring(0, 1);
                return o && (e = e.substring(1)), (o ? "#" : "") + e.replace(/([!"#$%&'()*+,.\/:;<=>?@[\]^`{|}~])/g, "\\$1")
            },
            getFilePath: function (o) {
                var t = "&" + e.mobile.subPageUrlKey;
                return o && o.split(t)[0].split(a)[0]
            },
            isFirstPageUrl: function (o) {
                var i = n.parseUrl(n.makeUrlAbsolute(o, this.documentBase)),
                    a = i.hrefNoHash === this.documentUrl.hrefNoHash || this.documentBaseDiffers && i.hrefNoHash === this.documentBase.hrefNoHash,
                    r = e.mobile.firstPage, s = r && r[0] ? r[0].id : t;
                return a && (!i.hash || "#" === i.hash || s && i.hash.replace(/^#/, "") === s)
            },
            isPermittedCrossDomainRequest: function (o, t) {
                return e.mobile.allowCrossDomainPages && ("file:" === o.protocol || "content:" === o.protocol) && -1 !== t.search(/^https?:/)
            }
        }, n.documentUrl = n.parseLocation(), i = e("head").find("base"), n.documentBase = i.length ? n.parseUrl(n.makeUrlAbsolute(i.attr("href"), n.documentUrl.href)) : n.documentUrl, n.documentBaseDiffers = n.documentUrl.hrefNoHash !== n.documentBase.hrefNoHash, n.getDocumentBase = function (o) {
            return o ? e.extend({}, n.documentBase) : n.documentBase.href
        }, e.extend(e.mobile, { getDocumentUrl: n.getDocumentUrl, getDocumentBase: n.getDocumentBase })
    }(e), function (e, o) {
        e.mobile.History = function (e, o) {
            this.stack = e || [], this.activeIndex = o || 0
        }, e.extend(e.mobile.History.prototype, {
            getActive: function () {
                return this.stack[this.activeIndex]
            }, getLast: function () {
                return this.stack[this.previousIndex]
            }, getNext: function () {
                return this.stack[this.activeIndex + 1]
            }, getPrev: function () {
                return this.stack[this.activeIndex - 1]
            }, add: function (e, o) {
                o = o || {}, this.getNext() && this.clearForward(), o.hash && -1 === o.hash.indexOf("#") && (o.hash = "#" + o.hash), o.url = e, this.stack.push(o), this.activeIndex = this.stack.length - 1
            }, clearForward: function () {
                this.stack = this.stack.slice(0, this.activeIndex + 1)
            }, find: function (e, o, t) {
                o = o || this.stack;
                var n, i, a, r = o.length;
                for (i = 0; r > i; i++) if (n = o[i], (decodeURIComponent(e) === decodeURIComponent(n.url) || decodeURIComponent(e) === decodeURIComponent(n.hash)) && (a = i, t)) return a;
                return a
            }, closest: function (e) {
                var t, n = this.activeIndex;
                return t = this.find(e, this.stack.slice(0, n)), t === o && (t = this.find(e, this.stack.slice(n), !0), t = t === o ? t : t + n), t
            }, direct: function (t) {
                var n = this.closest(t.url), i = this.activeIndex;
                n !== o && (this.activeIndex = n, this.previousIndex = i), i > n ? (t.present || t.back || e.noop)(this.getActive(), "back") : n > i ? (t.present || t.forward || e.noop)(this.getActive(), "forward") : n === o && t.missing && t.missing(this.getActive())
            }
        })
    }(e), function (e) {
        var n = e.mobile.path, i = location.href;
        e.mobile.Navigator = function (o) {
            this.history = o, this.ignoreInitialHashChange = !0, e.mobile.window.bind({
                "popstate.history": e.proxy(this.popstate, this),
                "hashchange.history": e.proxy(this.hashchange, this)
            })
        }, e.extend(e.mobile.Navigator.prototype, {
            squash: function (i, a) {
                var r, s, l = n.isPath(i) ? n.stripHash(i) : i;
                return s = n.squash(i), r = e.extend({
                    hash: l,
                    url: s
                }, a), o.history.replaceState(r, r.title || t.title, s), r
            }, hash: function (e, o) {
                var t, i, a, r;
                return t = n.parseUrl(e), i = n.parseLocation(), i.pathname + i.search === t.pathname + t.search ? a = t.hash ? t.hash : t.pathname + t.search : n.isPath(e) ? (r = n.parseUrl(o), a = r.pathname + r.search + (n.isPreservableHash(r.hash) ? r.hash.replace("#", "") : "")) : a = e, a
            }, go: function (i, a, r) {
                var s, l, p, c, u = e.event.special.navigate.isPushStateEnabled();
                l = n.squash(i), p = this.hash(i, l), r && p !== n.stripHash(n.parseLocation().hash) && (this.preventNextHashChange = r), this.preventHashAssignPopState = !0, o.location.hash = p, this.preventHashAssignPopState = !1, s = e.extend({
                    url: l,
                    hash: p,
                    title: t.title
                }, a), u && (c = new e.Event("popstate"), c.originalEvent = {
                    type: "popstate",
                    state: null
                }, this.squash(i, s), r || (this.ignorePopState = !0, e.mobile.window.trigger(c))), this.history.add(s.url, s)
            }, popstate: function (o) {
                var t, a;
                if (e.event.special.navigate.isPushStateEnabled()) return this.preventHashAssignPopState ? (this.preventHashAssignPopState = !1, void o.stopImmediatePropagation()) : this.ignorePopState ? void (this.ignorePopState = !1) : !o.originalEvent.state && 1 === this.history.stack.length && this.ignoreInitialHashChange && (this.ignoreInitialHashChange = !1, location.href === i) ? void o.preventDefault() : (t = n.parseLocation().hash, !o.originalEvent.state && t ? (a = this.squash(t), this.history.add(a.url, a), void (o.historyState = a)) : void this.history.direct({
                    url: (o.originalEvent.state || {}).url || t,
                    present: function (t, n) {
                        o.historyState = e.extend({}, t), o.historyState.direction = n
                    }
                }))
            }, hashchange: function (o) {
                var i, a;
                if (e.event.special.navigate.isHashChangeEnabled() && !e.event.special.navigate.isPushStateEnabled()) {
                    if (this.preventNextHashChange) return this.preventNextHashChange = !1, void o.stopImmediatePropagation();
                    i = this.history, a = n.parseLocation().hash, this.history.direct({
                        url: a,
                        present: function (t, n) {
                            o.hashchangeState = e.extend({}, t), o.hashchangeState.direction = n
                        },
                        missing: function () {
                            i.add(a, { hash: a, title: t.title })
                        }
                    })
                }
            }
        })
    }(e), function (e) {
        e.mobile.navigate = function (o, t, n) {
            e.mobile.navigate.navigator.go(o, t, n)
        }, e.mobile.navigate.history = new e.mobile.History, e.mobile.navigate.navigator = new e.mobile.Navigator(e.mobile.navigate.history);
        var o = e.mobile.path.parseLocation();
        e.mobile.navigate.history.add(o.href, { hash: o.hash })
    }(e), function (e, o) {
        var n = { animation: {}, transition: {} }, i = t.createElement("a"), a = ["", "webkit-", "moz-", "o-"];
        e.each(["animation", "transition"], function (t, r) {
            var s = 0 === t ? r + "-name" : r;
            e.each(a, function (t, a) {
                return i.style[e.camelCase(a + s)] !== o ? (n[r].prefix = a, !1) : void 0
            }), n[r].duration = e.camelCase(n[r].prefix + r + "-duration"), n[r].event = e.camelCase(n[r].prefix + r + "-end"), "" === n[r].prefix && (n[r].event = n[r].event.toLowerCase())
        }), e.support.cssTransitions = n.transition.prefix !== o, e.support.cssAnimations = n.animation.prefix !== o, e(i).remove(), e.fn.animationComplete = function (i, a, r) {
            var s, l, p = this, c = a && "animation" !== a ? "transition" : "animation";
            return e.support.cssTransitions && "transition" === c || e.support.cssAnimations && "animation" === c ? (r === o && (e(this).context !== t && (l = 3e3 * parseFloat(e(this).css(n[c].duration))), (0 === l || l === o || isNaN(l)) && (l = e.fn.animationComplete.defaultDuration)), s = setTimeout(function () {
                e(p).off(n[c].event), i.apply(p)
            }, l), e(this).one(n[c].event, function () {
                clearTimeout(s), i.call(this, arguments)
            })) : (setTimeout(e.proxy(i, this), 0), e(this))
        }, e.fn.animationComplete.defaultDuration = 1e3
    }(e), function (e, o, t, n) {
        function i(e) {
            for (; e && "undefined" != typeof e.originalEvent;) e = e.originalEvent;
            return e
        }

        function a(o, t) {
            var a, r, s, l, p, c, u, h, m, g = o.type;
            if (o = e.Event(o), o.type = t, a = o.originalEvent, r = e.event.props, g.search(/^(mouse|click)/) > -1 && (r = y), a) for (u = r.length, l; u;) l = r[--u], o[l] = a[l];
            if (g.search(/mouse(down|up)|click/) > -1 && !o.which && (o.which = 1), -1 !== g.search(/^touch/) && (s = i(a), g = s.touches, p = s.changedTouches, c = g && g.length ? g[0] : p && p.length ? p[0] : n)) for (h = 0, m = C.length; m > h; h++) l = C[h], o[l] = c[l];
            return o
        }

        function r(o) {
            for (var t, n, i = {}; o;) {
                t = e.data(o, S);
                for (n in t) t[n] && (i[n] = i.hasVirtualBinding = !0);
                o = o.parentNode
            }
            return i
        }

        function s(o, t) {
            for (var n; o;) {
                if ((n = e.data(o, S)) && (!t || n[t])) return o;
                o = o.parentNode
            }
            return null
        }

        function l() {
            U = !1
        }

        function p() {
            U = !0
        }

        function c() {
            F = 0, A.length = 0, k = !1, p()
        }

        function u() {
            l()
        }

        function h() {
            m(), D = setTimeout(function () {
                D = 0, c()
            }, e.vmouse.resetTimerDuration)
        }

        function m() {
            D && (clearTimeout(D), D = 0)
        }

        function g(o, t, n) {
            var i;
            return (n && n[o] || !n && s(t.target, o)) && (i = a(t, o), e(t.target).trigger(i)), i
        }

        function d(o) {
            var t, n = e.data(o.target, N);
            k || F && F === n || (t = g("v" + o.type, o)) && (t.isDefaultPrevented() && o.preventDefault(), t.isPropagationStopped() && o.stopPropagation(), t.isImmediatePropagationStopped() && o.stopImmediatePropagation())
        }

        function b(o) {
            var t, n, a, s = i(o).touches;
            s && 1 === s.length && (t = o.target, n = r(t), n.hasVirtualBinding && (F = M++, e.data(t, N, F), m(), u(), x = !1, a = i(o).touches[0], G = a.pageX, O = a.pageY, g("vmouseover", o, n), g("vmousedown", o, n)))
        }

        function _(e) {
            U || (x || g("vmousecancel", e, r(e.target)), x = !0, h())
        }

        function f(o) {
            if (!U) {
                var t = i(o).touches[0], n = x, a = e.vmouse.moveDistanceThreshold, s = r(o.target);
                x = x || Math.abs(t.pageX - G) > a || Math.abs(t.pageY - O) > a, x && !n && g("vmousecancel", o, s), g("vmousemove", o, s), h()
            }
        }

        function w(e) {
            if (!U) {
                p();
                var o, t, n = r(e.target);
                g("vmouseup", e, n), x || (o = g("vclick", e, n)) && o.isDefaultPrevented() && (t = i(e).changedTouches[0], A.push({
                    touchID: F,
                    x: t.clientX,
                    y: t.clientY
                }), k = !0), g("vmouseout", e, n), x = !1, h()
            }
        }

        function v(o) {
            var t, n = e.data(o, S);
            if (n) for (t in n) if (n[t]) return !0;
            return !1
        }

        function E() {
        }

        var T, P, S = "virtualMouseBindings", N = "virtualTouchID",
            I = "vmouseover vmousedown vmousemove vmouseup vclick vmouseout vmousecancel".split(" "),
            C = "clientX clientY pageX pageY screenX screenY".split(" "),
            R = e.event.mouseHooks ? e.event.mouseHooks.props : [], y = e.event.props.concat(R), L = {}, D = 0, G = 0,
            O = 0, x = !1, A = [], k = !1, U = !1, V = "addEventListener" in t, W = e(t), M = 1, F = 0;
        for (e.vmouse = {
            moveDistanceThreshold: 10,
            clickDistanceThreshold: 10,
            resetTimerDuration: 1500
        }, P = 0; P < I.length; P++) e.event.special[I[P]] = function (o) {
            var t = o.substr(1);
            return {
                setup: function () {
                    v(this) || e.data(this, S, {}), e.data(this, S)[o] = !0, L[o] = (L[o] || 0) + 1, 1 === L[o] && W.bind(t, d), e(this).bind(t, E), V && (L.touchstart = (L.touchstart || 0) + 1, 1 === L.touchstart && W.bind("touchstart", b).bind("touchend", w).bind("touchmove", f).bind("scroll", _))
                }, teardown: function () {
                    --L[o], L[o] || W.unbind(t, d), V && (--L.touchstart || W.unbind("touchstart", b).unbind("touchmove", f).unbind("touchend", w).unbind("scroll", _));
                    var n = e(this), i = e.data(this, S);
                    i && (i[o] = !1), n.unbind(t, E), v(this) || n.removeData(S)
                }
            }
        }(I[P]);
        V && t.addEventListener("click", function (o) {
            var t, n, i, a, r, s = A.length, l = o.target;
            if (s) for (t = o.clientX, n = o.clientY, T = e.vmouse.clickDistanceThreshold, i = l; i;) {
                for (a = 0; s > a; a++) if (r = A[a], 0, i === l && Math.abs(r.x - t) < T && Math.abs(r.y - n) < T || e.data(i, N) === r.touchID) return o.preventDefault(), void o.stopPropagation();
                i = i.parentNode
            }
        }, !0)
    }(e, 0, t), function (e, o, n) {
        function i(o, t, i, a) {
            var r = i.type;
            i.type = t, a ? e.event.trigger(i, n, o) : e.event.dispatch.call(o, i), i.type = r
        }

        var a = e(t), r = e.mobile.support.touch, s = "touchmove scroll", l = r ? "touchstart" : "mousedown",
            p = r ? "touchend" : "mouseup", c = r ? "touchmove" : "mousemove";
        e.each("touchstart touchmove touchend tap taphold swipe swipeleft swiperight scrollstart scrollstop".split(" "), function (o, t) {
            e.fn[t] = function (e) {
                return e ? this.bind(t, e) : this.trigger(t)
            }, e.attrFn && (e.attrFn[t] = !0)
        }), e.event.special.scrollstart = {
            enabled: !0, setup: function () {
                function o(e, o) {
                    t = o, i(a, t ? "scrollstart" : "scrollstop", e)
                }

                var t, n, a = this;
                e(a).bind(s, function (i) {
                    e.event.special.scrollstart.enabled && (t || o(i, !0), clearTimeout(n), n = setTimeout(function () {
                        o(i, !1)
                    }, 50))
                })
            }, teardown: function () {
                e(this).unbind(s)
            }
        }, e.event.special.tap = {
            tapholdThreshold: 750, emitTapOnTaphold: !0, setup: function () {
                var o = this, t = e(o), n = !1;
                t.bind("vmousedown", function (r) {
                    function s() {
                        clearTimeout(c)
                    }

                    function l() {
                        s(), t.unbind("vclick", p).unbind("vmouseup", s), a.unbind("vmousecancel", l)
                    }

                    function p(e) {
                        l(), n || u !== e.target ? n && e.stopPropagation() : i(o, "tap", e)
                    }

                    if (n = !1, r.which && 1 !== r.which) return !1;
                    var c, u = r.target;
                    t.bind("vmouseup", s).bind("vclick", p), a.bind("vmousecancel", l), c = setTimeout(function () {
                        e.event.special.tap.emitTapOnTaphold || (n = !0), i(o, "taphold", e.Event("taphold", { target: u }))
                    }, e.event.special.tap.tapholdThreshold)
                })
            }, teardown: function () {
                e(this).unbind("vmousedown").unbind("vclick").unbind("vmouseup"), a.unbind("vmousecancel")
            }
        }, e.event.special.swipe = {
            scrollSupressionThreshold: 30,
            durationThreshold: 1e3,
            horizontalDistanceThreshold: 30,
            verticalDistanceThreshold: 30,
            getLocation: function (e) {
                var t = o.pageXOffset, n = o.pageYOffset, i = e.clientX, a = e.clientY;
                return 0 === e.pageY && Math.floor(a) > Math.floor(e.pageY) || 0 === e.pageX && Math.floor(i) > Math.floor(e.pageX) ? (i -= t, a -= n) : (a < e.pageY - n || i < e.pageX - t) && (i = e.pageX - t, a = e.pageY - n), {
                    x: i,
                    y: a
                }
            },
            start: function (o) {
                var t = o.originalEvent.touches ? o.originalEvent.touches[0] : o,
                    n = e.event.special.swipe.getLocation(t);
                return { time: (new Date).getTime(), coords: [n.x, n.y], origin: e(o.target) }
            },
            stop: function (o) {
                var t = o.originalEvent.touches ? o.originalEvent.touches[0] : o,
                    n = e.event.special.swipe.getLocation(t);
                return { time: (new Date).getTime(), coords: [n.x, n.y] }
            },
            handleSwipe: function (o, t, n, a) {
                if (t.time - o.time < e.event.special.swipe.durationThreshold && Math.abs(o.coords[0] - t.coords[0]) > e.event.special.swipe.horizontalDistanceThreshold && Math.abs(o.coords[1] - t.coords[1]) < e.event.special.swipe.verticalDistanceThreshold) {
                    var r = o.coords[0] > t.coords[0] ? "swipeleft" : "swiperight";
                    return i(n, "swipe", e.Event("swipe", {
                        target: a,
                        swipestart: o,
                        swipestop: t
                    }), !0), i(n, r, e.Event(r, { target: a, swipestart: o, swipestop: t }), !0), !0
                }
                return !1
            },
            eventInProgress: !1,
            setup: function () {
                var o, t = this, n = e(t), i = {};
                o = e.data(this, "mobile-events"), o || (o = { length: 0 }, e.data(this, "mobile-events", o)), o.length++, o.swipe = i, i.start = function (o) {
                    if (!e.event.special.swipe.eventInProgress) {
                        e.event.special.swipe.eventInProgress = !0;
                        var n, r = e.event.special.swipe.start(o), s = o.target, l = !1;
                        i.move = function (o) {
                            r && (n = e.event.special.swipe.stop(o), l || (l = e.event.special.swipe.handleSwipe(r, n, t, s)) && (e.event.special.swipe.eventInProgress = !1), Math.abs(r.coords[0] - n.coords[0]) > e.event.special.swipe.scrollSupressionThreshold && o.preventDefault())
                        }, i.stop = function () {
                            l = !0, e.event.special.swipe.eventInProgress = !1, a.off(c, i.move), i.move = null
                        }, a.on(c, i.move).one(p, i.stop)
                    }
                }, n.on(l, i.start)
            },
            teardown: function () {
                var o, t;
                o = e.data(this, "mobile-events"), o && (t = o.swipe, delete o.swipe, 0 === --o.length && e.removeData(this, "mobile-events")), t && (t.start && e(this).off(l, t.start), t.move && a.off(c, t.move), t.stop && a.off(p, t.stop))
            }
        }, e.each({
            scrollstop: "scrollstart",
            taphold: "tap",
            swipeleft: "swipe",
            swiperight: "swipe"
        }, function (o, t) {
            e.event.special[o] = {
                setup: function () {
                    e(this).bind(t, e.noop)
                }, teardown: function () {
                    e(this).unbind(t)
                }
            }
        })
    }(e, this), function (e) {
        e.event.special.throttledresize = {
            setup: function () {
                e(this).bind("resize", i)
            }, teardown: function () {
                e(this).unbind("resize", i)
            }
        };
        var o, t, n, i = function () {
            t = (new Date).getTime(), n = t - a, n >= 250 ? (a = t, e(this).trigger("throttledresize")) : (o && clearTimeout(o), o = setTimeout(i, 250 - n))
        }, a = 0
    }(e), function (e, o) {
        function n() {
            var e = i();
            e !== a && (a = e, u.trigger(h))
        }

        var i, a, r, s, l, p, c, u = e(o), h = "orientationchange", m = { 0: !0, 180: !0 };
        e.support.orientation && (l = o.innerWidth || u.width(), p = o.innerHeight || u.height(), c = 50, r = l > p && l - p > c, s = m[o.orientation], (r && s || !r && !s) && (m = {
            "-90": !0,
            90: !0
        })), e.event.special.orientationchange = e.extend({}, e.event.special.orientationchange, {
            setup: function () {
                return !(e.support.orientation && !e.event.special.orientationchange.disabled) && (a = i(), void u.bind("throttledresize", n))
            }, teardown: function () {
                return !(e.support.orientation && !e.event.special.orientationchange.disabled) && void u.unbind("throttledresize", n)
            }, add: function (e) {
                var o = e.handler;
                e.handler = function (e) {
                    return e.orientation = i(), o.apply(this, arguments)
                }
            }
        }), e.event.special.orientationchange.orientation = i = function () {
            var n = !0, i = t.documentElement;
            return n = e.support.orientation ? m[o.orientation] : i && i.clientWidth / i.clientHeight < 1.1, n ? "portrait" : "landscape"
        }, e.fn[h] = function (e) {
            return e ? this.bind(h, e) : this.trigger(h)
        }, e.attrFn && (e.attrFn[h] = !0)
    }(e, this), function (e) {
        var o = e("head").children("base"), t = {
            element: o.length ? o : e("<base>", { href: e.mobile.path.documentBase.hrefNoHash }).prependTo(e("head")),
            linkSelector: "[src], link[href], a[rel='external'], :jqmData(ajax='false'), a[target]",
            set: function (o) {
                e.mobile.dynamicBaseEnabled && e.support.dynamicBaseTag && t.element.attr("href", e.mobile.path.makeUrlAbsolute(o, e.mobile.path.documentBase))
            },
            rewrite: function (o, n) {
                var i = e.mobile.path.get(o);
                n.find(t.linkSelector).each(function (o, t) {
                    var n = e(t).is("[href]") ? "href" : e(t).is("[src]") ? "src" : "action", a = e(t).attr(n);
                    a = a.replace(location.protocol + "//" + location.host + location.pathname, ""), /^(\w+:|#|\/)/.test(a) || e(t).attr(n, i + a)
                })
            },
            reset: function () {
                t.element.attr("href", e.mobile.path.documentBase.hrefNoSearch)
            }
        };
        e.mobile.base = t
    }(e), function (e, o) {
        e.mobile.widgets = {};
        var t = e.widget, n = e.mobile.keepNative;
        e.widget = function (t) {
            return function () {
                var n = t.apply(this, arguments), i = n.prototype.widgetName;
                return n.initSelector = n.prototype.initSelector !== o ? n.prototype.initSelector : ":jqmData(role='" + i + "')", e.mobile.widgets[i] = n, n
            }
        }(e.widget), e.extend(e.widget, t), e.mobile.document.on("create", function (o) {
            e(o.target).enhanceWithin()
        }), e.widget("mobile.page", {
            options: {
                theme: "a",
                domCache: !1,
                keepNativeDefault: e.mobile.keepNative,
                contentTheme: null,
                enhanced: !1
            }, _createWidget: function () {
                e.Widget.prototype._createWidget.apply(this, arguments), this._trigger("init")
            }, _create: function () {
                return !1 !== this._trigger("beforecreate") && (this.options.enhanced || this._enhance(), this._on(this.element, {
                    pagebeforehide: "removeContainerBackground",
                    pagebeforeshow: "_handlePageBeforeShow"
                }), this.element.enhanceWithin(), void ("dialog" === e.mobile.getAttribute(this.element[0], "role") && e.mobile.dialog && this.element.dialog()))
            }, _enhance: function () {
                var t = "data-" + e.mobile.ns, n = this;
                this.options.role && this.element.attr("data-" + e.mobile.ns + "role", this.options.role), this.element.attr("tabindex", "0").addClass("ui-page ui-page-theme-" + this.options.theme), this.element.find("[" + t + "role='content']").each(function () {
                    var i = e(this), a = this.getAttribute(t + "theme") || o;
                    n.options.contentTheme = a || n.options.contentTheme || n.options.dialog && n.options.theme || "dialog" === n.element.jqmData("role") && n.options.theme, i.addClass("ui-content"), n.options.contentTheme && i.addClass("ui-body-" + n.options.contentTheme), i.attr("role", "main").addClass("ui-content")
                })
            }, bindRemove: function (o) {
                var t = this.element;
                !t.data("mobile-page").options.domCache && t.is(":jqmData(external-page='true')") && t.bind("pagehide.remove", o || function (o, t) {
                    if (!t.samePage) {
                        var n = e(this), i = new e.Event("pageremove");
                        n.trigger(i), i.isDefaultPrevented() || n.removeWithDependents()
                    }
                })
            }, _setOptions: function (t) {
                t.theme !== o && this.element.removeClass("ui-page-theme-" + this.options.theme).addClass("ui-page-theme-" + t.theme), t.contentTheme !== o && this.element.find("[data-" + e.mobile.ns + "='content']").removeClass("ui-body-" + this.options.contentTheme).addClass("ui-body-" + t.contentTheme)
            }, _handlePageBeforeShow: function () {
                this.setContainerBackground()
            }, removeContainerBackground: function () {
                this.element.closest(":mobile-pagecontainer").pagecontainer({ theme: "none" })
            }, setContainerBackground: function (e) {
                this.element.parent().pagecontainer({ theme: e || this.options.theme })
            }, keepNativeSelector: function () {
                var o = this.options, t = e.trim(o.keepNative || ""), i = e.trim(e.mobile.keepNative),
                    a = e.trim(o.keepNativeDefault), r = n === i ? "" : i, s = "" === r ? a : "";
                return (t ? [t] : []).concat(r ? [r] : []).concat(s ? [s] : []).join(", ")
            }
        })
    }(e), function (e, n) {
        e.widget("mobile.pagecontainer", {
            options: { theme: "a" },
            initSelector: !1,
            _create: function () {
                this.setLastScrollEnabled = !0, this._on(this.window, {
                    navigate: "_disableRecordScroll",
                    scrollstop: "_delayedRecordScroll"
                }), this._on(this.window, { navigate: "_filterNavigateEvents" }), this._on({ pagechange: "_afterContentChange" }), this.window.one("navigate", e.proxy(function () {
                    this.setLastScrollEnabled = !0
                }, this))
            },
            _setOptions: function (e) {
                e.theme !== n && "none" !== e.theme ? this.element.removeClass("ui-overlay-" + this.options.theme).addClass("ui-overlay-" + e.theme) : e.theme !== n && this.element.removeClass("ui-overlay-" + this.options.theme), this._super(e)
            },
            _disableRecordScroll: function () {
                this.setLastScrollEnabled = !1
            },
            _enableRecordScroll: function () {
                this.setLastScrollEnabled = !0
            },
            _afterContentChange: function () {
                this.setLastScrollEnabled = !0, this._off(this.window, "scrollstop"), this._on(this.window, { scrollstop: "_delayedRecordScroll" })
            },
            _recordScroll: function () {
                if (this.setLastScrollEnabled) {
                    var e, o, t, n = this._getActiveHistory();
                    n && (e = this._getScroll(), o = this._getMinScroll(), t = this._getDefaultScroll(), n.lastScroll = o > e ? t : e)
                }
            },
            _delayedRecordScroll: function () {
                setTimeout(e.proxy(this, "_recordScroll"), 100)
            },
            _getScroll: function () {
                return this.window.scrollTop()
            },
            _getMinScroll: function () {
                return e.mobile.minScrollBack
            },
            _getDefaultScroll: function () {
                return e.mobile.defaultHomeScroll
            },
            _filterNavigateEvents: function (o, t) {
                var n;
                o.originalEvent && o.originalEvent.isDefaultPrevented() || (n = o.originalEvent.type.indexOf("hashchange") > -1 ? t.state.hash : t.state.url, n || (n = this._getHash()), n && "#" !== n && 0 !== n.indexOf("#" + e.mobile.path.uiStateKey) || (n = location.href), this._handleNavigate(n, t.state))
            },
            _getHash: function () {
                return e.mobile.path.parseLocation().hash
            },
            getActivePage: function () {
                return this.activePage
            },
            _getInitialContent: function () {
                return e.mobile.firstPage
            },
            _getHistory: function () {
                return e.mobile.navigate.history
            },
            _getActiveHistory: function () {
                return e.mobile.navigate.history.getActive()
            },
            _getDocumentBase: function () {
                return e.mobile.path.documentBase
            },
            back: function () {
                this.go(-1)
            },
            forward: function () {
                this.go(1)
            },
            go: function (t) {
                if (e.mobile.hashListeningEnabled) o.history.go(t); else {
                    var n = e.mobile.navigate.history.activeIndex, i = n + parseInt(t, 10),
                        a = e.mobile.navigate.history.stack[i].url, r = t >= 1 ? "forward" : "back";
                    e.mobile.navigate.history.activeIndex = i, e.mobile.navigate.history.previousIndex = n, this.change(a, {
                        direction: r,
                        changeHash: !1,
                        fromHashChange: !0
                    })
                }
            },
            _handleDestination: function (o) {
                var t;
                return "string" === e.type(o) && (o = e.mobile.path.stripHash(o)), o && (t = this._getHistory(), (o = e.mobile.path.isPath(o) ? o : e.mobile.path.makeUrlAbsolute("#" + o, this._getDocumentBase())) === e.mobile.path.makeUrlAbsolute("#" + t.initialDst, this._getDocumentBase()) && t.stack.length && t.stack[0].url !== t.initialDst.replace(e.mobile.dialogHashKey, "") && (o = this._getInitialContent())), o || this._getInitialContent()
            },
            _handleDialog: function (o, t) {
                var n, i, a = this.getActivePage();
                return a && !a.hasClass("ui-dialog") ? ("back" === t.direction ? this.back() : this.forward(), !1) : (n = t.pageUrl, i = this._getActiveHistory(), e.extend(o, {
                    role: i.role,
                    transition: i.transition,
                    reverse: "back" === t.direction
                }), n)
            },
            _handleNavigate: function (o, t) {
                var i = e.mobile.path.stripHash(o), a = this._getHistory(), r = 0 === a.stack.length ? "none" : n,
                    s = { changeHash: !1, fromHashChange: !0, reverse: "back" === t.direction };
                e.extend(s, t, { transition: (a.getLast() || {}).transition || r }), a.activeIndex > 0 && i.indexOf(e.mobile.dialogHashKey) > -1 && a.initialDst !== i && !1 === (i = this._handleDialog(s, t)) || this._changeContent(this._handleDestination(i), s)
            },
            _changeContent: function (o, t) {
                e.mobile.changePage(o, t)
            },
            _getBase: function () {
                return e.mobile.base
            },
            _getNs: function () {
                return e.mobile.ns
            },
            _enhance: function (e, o) {
                return e.page({ role: o })
            },
            _include: function (e, o) {
                e.appendTo(this.element), this._enhance(e, o.role), e.page("bindRemove")
            },
            _find: function (o) {
                var t, n = this._createFileUrl(o), i = this._createDataUrl(o), a = this._getInitialContent();
                return t = this.element.children("[data-" + this._getNs() + "url='" + i + "']"), 0 === t.length && i && !e.mobile.path.isPath(i) && (t = this.element.children(e.mobile.path.hashToSelector("#" + i)).attr("data-" + this._getNs() + "url", i).jqmData("url", i)), 0 === t.length && e.mobile.path.isFirstPageUrl(n) && a && a.parent().length && (t = e(a)), t
            },
            _getLoader: function () {
                return e.mobile.loading()
            },
            _showLoading: function (o, t, n, i) {
                this._loadMsg || (this._loadMsg = setTimeout(e.proxy(function () {
                    this._getLoader().loader("show", t, n, i), this._loadMsg = 0
                }, this), o))
            },
            _hideLoading: function () {
                clearTimeout(this._loadMsg), this._loadMsg = 0, this._getLoader().loader("hide")
            },
            _showError: function () {
                this._hideLoading(), this._showLoading(0, e.mobile.pageLoadErrorMessageTheme, e.mobile.pageLoadErrorMessage, !0), setTimeout(e.proxy(this, "_hideLoading"), 1500)
            },
            _parse: function (o, t) {
                var n, i = e("<div></div>");
                return i.get(0).innerHTML = o, n = i.find(":jqmData(role='page'), :jqmData(role='dialog')").first(), n.length || (n = e("<div data-" + this._getNs() + "role='page'>" + (o.split(/<\/?body[^>]*>/gim)[1] || "") + "</div>")), n.attr("data-" + this._getNs() + "url", e.mobile.path.convertUrlToDataUrl(t)).attr("data-" + this._getNs() + "external-page", !0), n
            },
            _setLoadedTitle: function (o, t) {
                var n = t.match(/<title[^>]*>([^<]*)/) && RegExp.$1;
                n && !o.jqmData("title") && (n = e("<div>" + n + "</div>").text(), o.jqmData("title", n))
            },
            _isRewritableBaseTag: function () {
                return e.mobile.dynamicBaseEnabled && !e.support.dynamicBaseTag
            },
            _createDataUrl: function (o) {
                return e.mobile.path.convertUrlToDataUrl(o)
            },
            _createFileUrl: function (o) {
                return e.mobile.path.getFilePath(o)
            },
            _triggerWithDeprecated: function (o, t, n) {
                var i = e.Event("page" + o), a = e.Event(this.widgetName + o);
                return (n || this.element).trigger(i, t), this.element.trigger(a, t), { deprecatedEvent: i, event: a }
            },
            _loadSuccess: function (o, t, i, a) {
                var r = this._createFileUrl(o), s = this._createDataUrl(o);
                return e.proxy(function (l, p, c) {
                    var u, h = new RegExp("(<[^>]+\\bdata-" + this._getNs() + "role=[\"']?page[\"']?[^>]*>)"),
                        m = new RegExp("\\bdata-" + this._getNs() + "url=[\"']?([^\"'>]*)[\"']?");
                    h.test(l) && RegExp.$1 && m.test(RegExp.$1) && RegExp.$1 && (r = e.mobile.path.getFilePath(e("<div>" + RegExp.$1 + "</div>").text())), i.prefetch === n && this._getBase().set(r), u = this._parse(l, r), this._setLoadedTitle(u, l), t.xhr = c, t.textStatus = p, t.page = u, t.content = u, this._trigger("load", n, t) && (this._isRewritableBaseTag() && u && this._getBase().rewrite(r, u), this._include(u, i), o.indexOf("&" + e.mobile.subPageUrlKey) > -1 && (u = this.element.children("[data-" + this._getNs() + "url='" + s + "']")), i.showLoadMsg && this._hideLoading(), this.element.trigger("pageload"), a.resolve(o, i, u))
                }, this)
            },
            _loadDefaults: {
                type: "get",
                data: n,
                reloadPage: !1,
                reload: !1,
                role: n,
                showLoadMsg: !1,
                loadMsgDelay: 50
            },
            load: function (o, t) {
                var i, a, r, s, l = t && t.deferred || e.Deferred(), p = e.extend({}, this._loadDefaults, t), c = null,
                    u = e.mobile.path.makeUrlAbsolute(o, this._findBaseWithDefault());
                return p.reload = p.reloadPage, p.data && "get" === p.type && (u = e.mobile.path.addSearchParams(u, p.data), p.data = n), p.data && "post" === p.type && (p.reload = !0), i = this._createFileUrl(u), a = this._createDataUrl(u), c = this._find(u), 0 === c.length && e.mobile.path.isEmbeddedPage(i) && !e.mobile.path.isFirstPageUrl(i) ? void l.reject(u, p) : (this._getBase().reset(), c.length && !p.reload ? (this._enhance(c, p.role), l.resolve(u, p, c), void (p.prefetch || this._getBase().set(o))) : (s = {
                    url: o,
                    absUrl: u,
                    dataUrl: a,
                    deferred: l,
                    options: p
                }, r = this._triggerWithDeprecated("beforeload", s), r.deprecatedEvent.isDefaultPrevented() || r.event.isDefaultPrevented() ? void 0 : (p.showLoadMsg && this._showLoading(p.loadMsgDelay), p.prefetch === n && this._getBase().reset(), e.mobile.allowCrossDomainPages || e.mobile.path.isSameDomain(e.mobile.path.documentUrl, u) ? void e.ajax({
                    url: i,
                    type: p.type,
                    data: p.data,
                    contentType: p.contentType,
                    dataType: "html",
                    success: this._loadSuccess(u, s, p, l),
                    error: this._loadError(u, s, p, l)
                }) : void l.reject(u, p))))
            },
            _loadError: function (o, t, n, i) {
                return e.proxy(function (a, r, s) {
                    this._getBase().set(e.mobile.path.get()), t.xhr = a, t.textStatus = r, t.errorThrown = s;
                    var l = this._triggerWithDeprecated("loadfailed", t);
                    l.deprecatedEvent.isDefaultPrevented() || l.event.isDefaultPrevented() || (n.showLoadMsg && this._showError(), i.reject(o, n))
                }, this)
            },
            _getTransitionHandler: function (o) {
                return o = e.mobile._maybeDegradeTransition(o), e.mobile.transitionHandlers[o] || e.mobile.defaultTransitionHandler
            },
            _triggerCssTransitionEvents: function (o, t, n) {
                var i = !1;
                n = n || "", t && (o[0] === t[0] && (i = !0), this._triggerWithDeprecated(n + "hide", {
                    nextPage: o,
                    samePage: i
                }, t)), this._triggerWithDeprecated(n + "show", { prevPage: t || e("") }, o)
            },
            _cssTransition: function (o, t, n) {
                var i, a, r = n.transition, s = n.reverse, l = n.deferred;
                this._triggerCssTransitionEvents(o, t, "before"), this._hideLoading(), i = this._getTransitionHandler(r), a = new i(r, s, o, t).transition(), a.done(function () {
                    l.resolve.apply(l, arguments)
                }), a.done(e.proxy(function () {
                    this._triggerCssTransitionEvents(o, t)
                }, this))
            },
            _releaseTransitionLock: function () {
                a = !1, i.length > 0 && e.mobile.changePage.apply(null, i.pop())
            },
            _removeActiveLinkClass: function (o) {
                e.mobile.removeActiveLinkClass(o)
            },
            _loadUrl: function (o, t, n) {
                n.target = o, n.deferred = e.Deferred(), this.load(o, n), n.deferred.done(e.proxy(function (e, o, n) {
                    a = !1, o.absUrl = t.absUrl, this.transition(n, t, o)
                }, this)), n.deferred.fail(e.proxy(function () {
                    this._removeActiveLinkClass(!0), this._releaseTransitionLock(), this._triggerWithDeprecated("changefailed", t)
                }, this))
            },
            _triggerPageBeforeChange: function (o, t, n) {
                var i = new e.Event("pagebeforechange");
                return e.extend(t, {
                    toPage: o,
                    options: n
                }), t.absUrl = "string" === e.type(o) ? e.mobile.path.makeUrlAbsolute(o, this._findBaseWithDefault()) : n.absUrl, this.element.trigger(i, t), !i.isDefaultPrevented()
            },
            change: function (o, t) {
                if (a) return void i.unshift(arguments);
                var n = e.extend({}, e.mobile.changePage.defaults, t), r = {};
                n.fromPage = n.fromPage || this.activePage, this._triggerPageBeforeChange(o, r, n) && (o = r.toPage, "string" === e.type(o) ? (a = !0, this._loadUrl(o, r, n)) : this.transition(o, r, n))
            },
            transition: function (o, r, s) {
                var l, p, c, u, h, m, g, d, b, _, f, w, v;
                if (a) return void i.unshift([o, s]);
                if (this._triggerPageBeforeChange(o, r, s) && (v = this._triggerWithDeprecated("beforetransition", r), !v.deprecatedEvent.isDefaultPrevented() && !v.event.isDefaultPrevented())) {
                    if (a = !0, o[0] !== e.mobile.firstPage[0] || s.dataUrl || (s.dataUrl = e.mobile.path.documentUrl.hrefNoHash), l = s.fromPage, p = s.dataUrl && e.mobile.path.convertUrlToDataUrl(s.dataUrl) || o.jqmData("url"), c = p, e.mobile.path.getFilePath(p), u = e.mobile.navigate.history.getActive(), h = 0 === e.mobile.navigate.history.activeIndex, m = 0, g = t.title, d = ("dialog" === s.role || "dialog" === o.jqmData("role")) && !0 !== o.jqmData("dialog"), l && l[0] === o[0] && !s.allowSamePageTransition) return a = !1, this._triggerWithDeprecated("transition", r), this.element.trigger("pagechange", r), void (s.fromHashChange && e.mobile.navigate.history.direct({ url: p }));
                    o.page({ role: s.role }), s.fromHashChange && (m = "back" === s.direction ? -1 : 1);
                    try {
                        t.activeElement && "body" !== t.activeElement.nodeName.toLowerCase() ? e(t.activeElement).blur() : e("input:focus, textarea:focus, select:focus").blur()
                    } catch (E) {
                    }
                    b = !1, d && u && (u.url && u.url.indexOf(e.mobile.dialogHashKey) > -1 && this.activePage && !this.activePage.hasClass("ui-dialog") && e.mobile.navigate.history.activeIndex > 0 && (s.changeHash = !1, b = !0), p = u.url || "", p += !b && p.indexOf("#") > -1 ? e.mobile.dialogHashKey : "#" + e.mobile.dialogHashKey, 0 === e.mobile.navigate.history.activeIndex && p === e.mobile.navigate.history.initialDst && (p += e.mobile.dialogHashKey)), _ = u ? o.jqmData("title") || o.children(":jqmData(role='header')").find(".ui-title").text() : g, _ && g === t.title && (g = _), o.jqmData("title") || o.jqmData("title", g), s.transition = s.transition || (m && !h ? u.transition : n) || (d ? e.mobile.defaultDialogTransition : e.mobile.defaultPageTransition), !m && b && (e.mobile.navigate.history.getActive().pageUrl = c), p && !s.fromHashChange && (!e.mobile.path.isPath(p) && p.indexOf("#") < 0 && (p = "#" + p), f = {
                        transition: s.transition,
                        title: g,
                        pageUrl: c,
                        role: s.role
                    }, !1 !== s.changeHash && e.mobile.hashListeningEnabled ? e.mobile.navigate(p, f, !0) : o[0] !== e.mobile.firstPage[0] && e.mobile.navigate.history.add(p, f)), t.title = g, e.mobile.activePage = o, this.activePage = o, s.reverse = s.reverse || 0 > m, w = e.Deferred(), this._cssTransition(o, l, {
                        transition: s.transition,
                        reverse: s.reverse,
                        deferred: w
                    }), w.done(e.proxy(function (t, n, i, a, l) {
                        e.mobile.removeActiveLinkClass(), s.duplicateCachedPage && s.duplicateCachedPage.remove(), l || e.mobile.focusPage(o), this._releaseTransitionLock(), this.element.trigger("pagechange", r), this._triggerWithDeprecated("transition", r)
                    }, this))
                }
            },
            _findBaseWithDefault: function () {
                return this.activePage && e.mobile.getClosestBaseUrl(this.activePage) || e.mobile.path.documentBase.hrefNoHash
            }
        }), e.mobile.navreadyDeferred = e.Deferred();
        var i = [], a = !1
    }(e), function (e, t) {
        function n(e) {
            for (; e && ("string" != typeof e.nodeName || "a" !== e.nodeName.toLowerCase());) e = e.parentNode;
            return e
        }

        var i = e.Deferred(), a = e.Deferred(), r = e.mobile.path.documentUrl, s = null;
        e.mobile.loadPage = function (o, t) {
            var n;
            return t = t || {}, n = t.pageContainer || e.mobile.pageContainer, t.deferred = e.Deferred(), n.pagecontainer("load", o, t), t.deferred.promise()
        }, e.mobile.back = function () {
            var t = o.navigator;
            this.phonegapNavigationEnabled && t && t.app && t.app.backHistory ? t.app.backHistory() : e.mobile.pageContainer.pagecontainer("back")
        }, e.mobile.focusPage = function (e) {
            var o = e.find("[autofocus]"), t = e.find(".ui-title:eq(0)");
            return o.length ? void o.focus() : void (t.length ? t.focus() : e.focus())
        }, e.mobile._maybeDegradeTransition = e.mobile._maybeDegradeTransition || function (e) {
            return e
        }, e.mobile.changePage = function (o, t) {
            e.mobile.pageContainer.pagecontainer("change", o, t)
        }, e.mobile.changePage.defaults = {
            transition: t,
            reverse: !1,
            changeHash: !0,
            fromHashChange: !1,
            role: t,
            duplicateCachedPage: t,
            pageContainer: t,
            showLoadMsg: !0,
            dataUrl: t,
            fromPage: t,
            allowSamePageTransition: !1
        }, e.mobile._registerInternalEvents = function () {
            var i = function (o, t) {
                var n, i, a, l, p = !0;
                return !(!e.mobile.ajaxEnabled || o.is(":jqmData(ajax='false')") || !o.jqmHijackable().length || o.attr("target")) && (n = s && s.attr("formaction") || o.attr("action"), l = (o.attr("method") || "get").toLowerCase(), n || (n = e.mobile.getClosestBaseUrl(o), "get" === l && (n = e.mobile.path.parseUrl(n).hrefNoSearch), n === e.mobile.path.documentBase.hrefNoHash && (n = r.hrefNoSearch)), n = e.mobile.path.makeUrlAbsolute(n, e.mobile.getClosestBaseUrl(o)), !(e.mobile.path.isExternal(n) && !e.mobile.path.isPermittedCrossDomainRequest(r, n)) && (t || (i = o.serializeArray(), s && s[0].form === o[0] && (a = s.attr("name")) && (e.each(i, function (e, o) {
                    return o.name === a ? (a = "", !1) : void 0
                }), a && i.push({ name: a, value: s.attr("value") })), p = {
                    url: n,
                    options: {
                        type: l,
                        data: e.param(i),
                        transition: o.jqmData("transition"),
                        reverse: "reverse" === o.jqmData("direction"),
                        reloadPage: !0
                    }
                }), p))
            };
            e.mobile.document.delegate("form", "submit", function (o) {
                var t;
                o.isDefaultPrevented() || (t = i(e(this))) && (e.mobile.changePage(t.url, t.options), o.preventDefault())
            }), e.mobile.document.bind("vclick", function (o) {
                var t, a, r = o.target, l = !1;
                if (!(o.which > 1) && e.mobile.linkBindingEnabled) {
                    if (s = e(r), e.data(r, "mobile-button")) {
                        if (!i(e(r).closest("form"), !0)) return;
                        r.parentNode && (r = r.parentNode)
                    } else {
                        if (!(r = n(r)) || "#" === e.mobile.path.parseUrl(r.getAttribute("href") || "#").hash) return;
                        if (!e(r).jqmHijackable().length) return
                    }
                    ~r.className.indexOf("ui-link-inherit") ? r.parentNode && (a = e.data(r.parentNode, "buttonElements")) : a = e.data(r, "buttonElements"), a ? r = a.outer : l = !0, t = e(r), l && (t = t.closest(".ui-btn")), t.length > 0 && !t.hasClass("ui-state-disabled") && (e.mobile.removeActiveLinkClass(!0), e.mobile.activeClickedLink = t, e.mobile.activeClickedLink.addClass(e.mobile.activeBtnClass))
                }
            }), e.mobile.document.bind("click", function (i) {
                if (e.mobile.linkBindingEnabled && !i.isDefaultPrevented()) {
                    var a, s, l, p, c, u, h = n(i.target), m = e(h), g = function () {
                        o.setTimeout(function () {
                            e.mobile.removeActiveLinkClass(!0)
                        }, 200)
                    };
                    if (e.mobile.activeClickedLink && e.mobile.activeClickedLink[0] === i.target.parentNode && g(), h && !(i.which > 1) && m.jqmHijackable().length) {
                        if (m.is(":jqmData(rel='back')")) return e.mobile.back(), !1;
                        if (a = e.mobile.getClosestBaseUrl(m), s = e.mobile.path.makeUrlAbsolute(m.attr("href") || "#", a), !e.mobile.ajaxEnabled && !e.mobile.path.isEmbeddedPage(s)) return void g();
                        if (-1 !== s.search("#")) {
                            if (!(s = s.replace(/[^#]*#/, ""))) return void i.preventDefault();
                            s = e.mobile.path.isPath(s) ? e.mobile.path.makeUrlAbsolute(s, a) : e.mobile.path.makeUrlAbsolute("#" + s, r.hrefNoHash)
                        }
                        if (l = m.is("[rel='external']") || m.is(":jqmData(ajax='false')") || m.is("[target]"), l || e.mobile.path.isExternal(s) && !e.mobile.path.isPermittedCrossDomainRequest(r, s)) return void g();
                        p = m.jqmData("transition"), c = "reverse" === m.jqmData("direction") || m.jqmData("back"), u = m.attr("data-" + e.mobile.ns + "rel") || t, e.mobile.changePage(s, {
                            transition: p,
                            reverse: c,
                            role: u,
                            link: m
                        }), i.preventDefault()
                    }
                }
            }), e.mobile.document.delegate(".ui-page", "pageshow.prefetch", function () {
                var o = [];
                e(this).find("a:jqmData(prefetch)").each(function () {
                    var t = e(this), n = t.attr("href");
                    n && -1 === e.inArray(n, o) && (o.push(n), e.mobile.loadPage(n, {
                        role: t.attr("data-" + e.mobile.ns + "rel"),
                        prefetch: !0
                    }))
                })
            }), e.mobile.pageContainer.pagecontainer(), e.mobile.document.bind("pageshow", function () {
                a ? a.done(e.mobile.resetActivePageHeight) : e.mobile.resetActivePageHeight()
            }), e.mobile.window.bind("throttledresize", e.mobile.resetActivePageHeight)
        }, e(function () {
            i.resolve()
        }), e.mobile.window.load(function () {
            a.resolve(), a = null
        }), e.when(i, e.mobile.navreadyDeferred).done(function () {
            e.mobile._registerInternalEvents()
        })
    }(e), function (e, o) {
        e.mobile.Transition = function () {
            this.init.apply(this, arguments)
        }, e.extend(e.mobile.Transition.prototype, {
            toPreClass: " ui-page-pre-in", init: function (o, t, n, i) {
                e.extend(this, { name: o, reverse: t, $to: n, $from: i, deferred: new e.Deferred })
            }, cleanFrom: function () {
                this.$from.removeClass(e.mobile.activePageClass + " out in reverse " + this.name).height("")
            }, beforeDoneIn: function () {
            }, beforeDoneOut: function () {
            }, beforeStartOut: function () {
            }, doneIn: function () {
                this.beforeDoneIn(), this.$to.removeClass("out in reverse " + this.name).height(""), this.toggleViewportClass(), e.mobile.window.scrollTop() !== this.toScroll && this.scrollPage(), this.sequential || this.$to.addClass(e.mobile.activePageClass), this.deferred.resolve(this.name, this.reverse, this.$to, this.$from, !0)
            }, doneOut: function (e, o, t, n) {
                this.beforeDoneOut(), this.startIn(e, o, t, n)
            }, hideIn: function (e) {
                this.$to.css("z-index", -10), e.call(this), this.$to.css("z-index", "")
            }, scrollPage: function () {
                e.event.special.scrollstart.enabled = !1, (e.mobile.hideUrlBar || this.toScroll !== e.mobile.defaultHomeScroll) && o.scrollTo(0, this.toScroll), setTimeout(function () {
                    e.event.special.scrollstart.enabled = !0
                }, 150)
            }, startIn: function (o, t, n, i) {
                this.hideIn(function () {
                    this.$to.addClass(e.mobile.activePageClass + this.toPreClass), i || e.mobile.focusPage(this.$to), this.$to.height(o + this.toScroll), n || this.scrollPage()
                }), this.$to.removeClass(this.toPreClass).addClass(this.name + " in " + t), n ? this.doneIn() : this.$to.animationComplete(e.proxy(function () {
                    this.doneIn()
                }, this))
            }, startOut: function (o, t, n) {
                this.beforeStartOut(o, t, n), this.$from.height(o + e.mobile.window.scrollTop()).addClass(this.name + " out" + t)
            }, toggleViewportClass: function () {
                e.mobile.pageContainer.toggleClass("ui-mobile-viewport-transitioning viewport-" + this.name)
            }, transition: function () {
                var o, t = this.reverse ? " reverse" : "", n = e.mobile.getScreenHeight(),
                    i = !1 !== e.mobile.maxTransitionWidth && e.mobile.window.width() > e.mobile.maxTransitionWidth;
                return this.toScroll = e.mobile.navigate.history.getActive().lastScroll || e.mobile.defaultHomeScroll, o = !e.support.cssTransitions || !e.support.cssAnimations || i || !this.name || "none" === this.name || Math.max(e.mobile.window.scrollTop(), this.toScroll) > e.mobile.getMaxScrollForTransition(), this.toggleViewportClass(), this.$from && !o ? this.startOut(n, t, o) : this.doneOut(n, t, o, !0), this.deferred.promise()
            }
        })
    }(e, this), function (e) {
        e.mobile.SerialTransition = function () {
            this.init.apply(this, arguments)
        }, e.extend(e.mobile.SerialTransition.prototype, e.mobile.Transition.prototype, {
            sequential: !0,
            beforeDoneOut: function () {
                this.$from && this.cleanFrom()
            },
            beforeStartOut: function (o, t, n) {
                this.$from.animationComplete(e.proxy(function () {
                    this.doneOut(o, t, n)
                }, this))
            }
        })
    }(e), function (e) {
        e.mobile.ConcurrentTransition = function () {
            this.init.apply(this, arguments)
        }, e.extend(e.mobile.ConcurrentTransition.prototype, e.mobile.Transition.prototype, {
            sequential: !1,
            beforeDoneIn: function () {
                this.$from && this.cleanFrom()
            },
            beforeStartOut: function (e, o, t) {
                this.doneOut(e, o, t)
            }
        })
    }(e), function (e) {
        var o = function () {
            return 3 * e.mobile.getScreenHeight()
        };
        e.mobile.transitionHandlers = {
            sequential: e.mobile.SerialTransition,
            simultaneous: e.mobile.ConcurrentTransition
        }, e.mobile.defaultTransitionHandler = e.mobile.transitionHandlers.sequential, e.mobile.transitionFallbacks = {}, e.mobile._maybeDegradeTransition = function (o) {
            return o && !e.support.cssTransform3d && e.mobile.transitionFallbacks[o] && (o = e.mobile.transitionFallbacks[o]), o
        }, e.mobile.getMaxScrollForTransition = e.mobile.getMaxScrollForTransition || o
    }(e), function (e) {
        e.mobile.transitionFallbacks.flip = "fade"
    }(e), function (e) {
        e.mobile.transitionFallbacks.flow = "fade"
    }(e), function (e) {
        e.mobile.transitionFallbacks.pop = "fade"
    }(e), function (e) {
        e.mobile.transitionHandlers.slide = e.mobile.transitionHandlers.simultaneous, e.mobile.transitionFallbacks.slide = "fade"
    }(e), function (e) {
        e.mobile.transitionFallbacks.slidedown = "fade"
    }(e), function (e) {
        e.mobile.transitionFallbacks.slidefade = "fade"
    }(e), function (e) {
        e.mobile.transitionFallbacks.slideup = "fade"
    }(e), function (e) {
        e.mobile.transitionFallbacks.turn = "fade"
    }(e), function (e) {
        e.mobile.degradeInputs = {
            color: !1,
            date: !1,
            datetime: !1,
            "datetime-local": !1,
            email: !1,
            month: !1,
            number: !1,
            range: "number",
            search: "text",
            tel: !1,
            time: !1,
            url: !1,
            week: !1
        }, e.mobile.page.prototype.options.degradeInputs = e.mobile.degradeInputs, e.mobile.degradeInputsWithin = function (o) {
            o = e(o), o.find("input").not(e.mobile.page.prototype.keepNativeSelector()).each(function () {
                var o, t, n, i, a = e(this), r = this.getAttribute("type"), s = e.mobile.degradeInputs[r] || "text";
                e.mobile.degradeInputs[r] && (o = e("<div>").html(a.clone()).html(), t = o.indexOf(" type=") > -1, n = t ? /\s+type=["']?\w+['"]?/ : /\/?>/, i = ' type="' + s + '" data-' + e.mobile.ns + 'type="' + r + '"' + (t ? "" : ">"), a.replaceWith(o.replace(n, i)))
            })
        }
    }(e), function (e, o, t) {
        e.widget("mobile.page", e.mobile.page, {
            options: { closeBtn: "left", closeBtnText: "Close", overlayTheme: "a", corners: !0, dialog: !1 },
            _create: function () {
                this._super(), this.options.dialog && (e.extend(this, {
                    _inner: this.element.children(),
                    _headerCloseButton: null
                }), this.options.enhanced || this._setCloseBtn(this.options.closeBtn))
            },
            _enhance: function () {
                this._super(), this.options.dialog && this.element.addClass("ui-dialog").wrapInner(e("<div/>", {
                    role: "dialog",
                    "class": "ui-dialog-contain ui-overlay-shadow" + (this.options.corners ? " ui-corner-all" : "")
                }))
            },
            _setOptions: function (o) {
                var n, i, a = this.options;
                o.corners !== t && this._inner.toggleClass("ui-corner-all", !!o.corners), o.overlayTheme !== t && e.mobile.activePage[0] === this.element[0] && (a.overlayTheme = o.overlayTheme, this._handlePageBeforeShow()), o.closeBtnText !== t && (n = a.closeBtn, i = o.closeBtnText), o.closeBtn !== t && (n = o.closeBtn), n && this._setCloseBtn(n, i), this._super(o)
            },
            _handlePageBeforeShow: function () {
                this.options.overlayTheme && this.options.dialog ? (this.removeContainerBackground(), this.setContainerBackground(this.options.overlayTheme)) : this._super()
            },
            _setCloseBtn: function (o, t) {
                var n, i = this._headerCloseButton;
                o = "left" === o ? "left" : "right" === o ? "right" : "none", "none" === o ? i && (i.remove(), i = null) : i ? (i.removeClass("ui-btn-left ui-btn-right").addClass("ui-btn-" + o), t && i.text(t)) : (n = this._inner.find(":jqmData(role='header')").first(), i = e("<a></a>", {
                    href: "#",
                    "class": "ui-btn ui-corner-all ui-icon-delete ui-btn-icon-notext ui-btn-" + o
                }).attr("data-" + e.mobile.ns + "rel", "back").text(t || this.options.closeBtnText || "").prependTo(n)), this._headerCloseButton = i
            }
        })
    }(e), function (e, o, t) {
        e.widget("mobile.dialog", {
            options: { closeBtn: "left", closeBtnText: "Close", overlayTheme: "a", corners: !0 },
            _handlePageBeforeShow: function () {
                this._isCloseable = !0, this.options.overlayTheme && this.element.page("removeContainerBackground").page("setContainerBackground", this.options.overlayTheme)
            },
            _handlePageBeforeHide: function () {
                this._isCloseable = !1
            },
            _handleVClickSubmit: function (o) {
                var t, n = e(o.target).closest("vclick" === o.type ? "a" : "form");
                n.length && !n.jqmData("transition") && (t = {}, t["data-" + e.mobile.ns + "transition"] = (e.mobile.navigate.history.getActive() || {}).transition || e.mobile.defaultDialogTransition, t["data-" + e.mobile.ns + "direction"] = "reverse", n.attr(t))
            },
            _create: function () {
                var o = this.element, t = this.options;
                o.addClass("ui-dialog").wrapInner(e("<div/>", {
                    role: "dialog",
                    "class": "ui-dialog-contain ui-overlay-shadow" + (t.corners ? " ui-corner-all" : "")
                })), e.extend(this, {
                    _isCloseable: !1,
                    _inner: o.children(),
                    _headerCloseButton: null
                }), this._on(o, {
                    vclick: "_handleVClickSubmit",
                    submit: "_handleVClickSubmit",
                    pagebeforeshow: "_handlePageBeforeShow",
                    pagebeforehide: "_handlePageBeforeHide"
                }), this._setCloseBtn(t.closeBtn)
            },
            _setOptions: function (o) {
                var n, i, a = this.options;
                o.corners !== t && this._inner.toggleClass("ui-corner-all", !!o.corners), o.overlayTheme !== t && e.mobile.activePage[0] === this.element[0] && (a.overlayTheme = o.overlayTheme, this._handlePageBeforeShow()), o.closeBtnText !== t && (n = a.closeBtn, i = o.closeBtnText), o.closeBtn !== t && (n = o.closeBtn), n && this._setCloseBtn(n, i), this._super(o)
            },
            _setCloseBtn: function (o, t) {
                var n, i = this._headerCloseButton;
                o = "left" === o ? "left" : "right" === o ? "right" : "none", "none" === o ? i && (i.remove(), i = null) : i ? (i.removeClass("ui-btn-left ui-btn-right").addClass("ui-btn-" + o), t && i.text(t)) : (n = this._inner.find(":jqmData(role='header')").first(), i = e("<a></a>", {
                    role: "button",
                    href: "#",
                    "class": "ui-btn ui-corner-all ui-icon-delete ui-btn-icon-notext ui-btn-" + o
                }).text(t || this.options.closeBtnText || "").prependTo(n), this._on(i, { click: "close" })), this._headerCloseButton = i
            },
            close: function () {
                var o = e.mobile.navigate.history;
                this._isCloseable && (this._isCloseable = !1, e.mobile.hashListeningEnabled && o.activeIndex > 0 ? e.mobile.back() : e.mobile.pageContainer.pagecontainer("back"))
            }
        })
    }(e), function (e, o) {
        var t = function (e) {
            return "ui-btn-icon-" + (null === e ? "left" : e)
        };
        e.widget("mobile.collapsible", {
            options: {
                enhanced: !1,
                expandCueText: null,
                collapseCueText: null,
                collapsed: !0,
                heading: "h1,h2,h3,h4,h5,h6,legend",
                collapsedIcon: null,
                expandedIcon: null,
                iconpos: null,
                theme: null,
                contentTheme: null,
                inset: null,
                corners: null,
                mini: null
            }, _create: function () {
                var o = this.element,
                    t = { accordion: o.closest(":jqmData(role='collapsible-set'),:jqmData(role='collapsibleset')" + (e.mobile.collapsibleset ? ", :mobile-collapsibleset" : "")).addClass("ui-collapsible-set") };
                this._ui = t, this._renderedOptions = this._getOptions(this.options), this.options.enhanced ? (t.heading = e(".ui-collapsible-heading", this.element[0]), t.content = t.heading.next(), t.anchor = e("a", t.heading[0]).first(), t.status = t.anchor.children(".ui-collapsible-heading-status")) : this._enhance(o, t), this._on(t.heading, {
                    tap: function () {
                        t.heading.find("a").first().addClass(e.mobile.activeBtnClass)
                    }, click: function (e) {
                        this._handleExpandCollapse(!t.heading.hasClass("ui-collapsible-heading-collapsed")), e.preventDefault(), e.stopPropagation()
                    }
                })
            }, _getOptions: function (o) {
                var t, n = this._ui.accordion, i = this._ui.accordionWidget;
                o = e.extend({}, o), n.length && !i && (this._ui.accordionWidget = i = n.data("mobile-collapsibleset"));
                for (t in o) o[t] = null != o[t] ? o[t] : i ? i.options[t] : n.length ? e.mobile.getAttribute(n[0], t.replace(/([A-Z])/g, "-$1").toLowerCase()) : null, null == o[t] && (o[t] = e.mobile.collapsible.defaults[t]);
                return o
            }, _themeClassFromOption: function (e, o) {
                return o ? "none" === o ? "" : e + o : ""
            }, _enhance: function (o, n) {
                var i, a = this._renderedOptions, r = this._themeClassFromOption("ui-body-", a.contentTheme);
                return o.addClass("ui-collapsible " + (a.inset ? "ui-collapsible-inset " : "") + (a.inset && a.corners ? "ui-corner-all " : "") + (r ? "ui-collapsible-themed-content " : "")), n.originalHeading = o.children(this.options.heading).first(), n.content = o.wrapInner("<div class='ui-collapsible-content " + r + "'></div>").children(".ui-collapsible-content"), n.heading = n.originalHeading, n.heading.is("legend") && (n.heading = e("<div role='heading'>" + n.heading.html() + "</div>"), n.placeholder = e("<div>\x3c!-- placeholder for legend --\x3e</div>").insertBefore(n.originalHeading), n.originalHeading.remove()), i = a.collapsed ? a.collapsedIcon ? "ui-icon-" + a.collapsedIcon : "" : a.expandedIcon ? "ui-icon-" + a.expandedIcon : "", n.status = e("<span class='ui-collapsible-heading-status'></span>"), n.anchor = n.heading.detach().addClass("ui-collapsible-heading").append(n.status).wrapInner("<a href='#' class='ui-collapsible-heading-toggle'></a>").find("a").first().addClass("ui-btn " + (i ? i + " " : "") + (i ? t(a.iconpos) + " " : "") + this._themeClassFromOption("ui-btn-", a.theme) + " " + (a.mini ? "ui-mini " : "")), n.heading.insertBefore(n.content), this._handleExpandCollapse(this.options.collapsed), n
            }, refresh: function () {
                this._applyOptions(this.options), this._renderedOptions = this._getOptions(this.options)
            }, _applyOptions: function (e) {
                var n, i, a, r, s, l = this.element, p = this._renderedOptions, c = this._ui, u = c.anchor,
                    h = c.status, m = this._getOptions(e);
                e.collapsed !== o && this._handleExpandCollapse(e.collapsed), n = l.hasClass("ui-collapsible-collapsed"), n ? m.expandCueText !== o && h.text(m.expandCueText) : m.collapseCueText !== o && h.text(m.collapseCueText), s = m.collapsedIcon !== o ? !1 !== m.collapsedIcon : !1 !== p.collapsedIcon, (m.iconpos !== o || m.collapsedIcon !== o || m.expandedIcon !== o) && (u.removeClass([t(p.iconpos)].concat(p.expandedIcon ? ["ui-icon-" + p.expandedIcon] : []).concat(p.collapsedIcon ? ["ui-icon-" + p.collapsedIcon] : []).join(" ")), s && u.addClass([t(m.iconpos !== o ? m.iconpos : p.iconpos)].concat(n ? ["ui-icon-" + (m.collapsedIcon !== o ? m.collapsedIcon : p.collapsedIcon)] : ["ui-icon-" + (m.expandedIcon !== o ? m.expandedIcon : p.expandedIcon)]).join(" "))), m.theme !== o && (a = this._themeClassFromOption("ui-btn-", p.theme), i = this._themeClassFromOption("ui-btn-", m.theme), u.removeClass(a).addClass(i)), m.contentTheme !== o && (a = this._themeClassFromOption("ui-body-", p.contentTheme), i = this._themeClassFromOption("ui-body-", m.contentTheme), c.content.removeClass(a).addClass(i)), m.inset !== o && (l.toggleClass("ui-collapsible-inset", m.inset), r = !(!m.inset || !m.corners && !p.corners)), m.corners !== o && (r = !(!m.corners || !m.inset && !p.inset)), r !== o && l.toggleClass("ui-corner-all", r), m.mini !== o && u.toggleClass("ui-mini", m.mini)
            }, _setOptions: function (e) {
                this._applyOptions(e), this._super(e), this._renderedOptions = this._getOptions(this.options)
            }, _handleExpandCollapse: function (o) {
                var t = this._renderedOptions, n = this._ui;
                n.status.text(o ? t.expandCueText : t.collapseCueText), n.heading.toggleClass("ui-collapsible-heading-collapsed", o).find("a").first().toggleClass("ui-icon-" + t.expandedIcon, !o).toggleClass("ui-icon-" + t.collapsedIcon, o || t.expandedIcon === t.collapsedIcon).removeClass(e.mobile.activeBtnClass), this.element.toggleClass("ui-collapsible-collapsed", o), n.content.toggleClass("ui-collapsible-content-collapsed", o).attr("aria-hidden", o).trigger("updatelayout"), this.options.collapsed = o, this._trigger(o ? "collapse" : "expand")
            }, expand: function () {
                this._handleExpandCollapse(!1)
            }, collapse: function () {
                this._handleExpandCollapse(!0)
            }, _destroy: function () {
                var e = this._ui;
                this.options.enhanced || (e.placeholder ? (e.originalHeading.insertBefore(e.placeholder), e.placeholder.remove(), e.heading.remove()) : (e.status.remove(), e.heading.removeClass("ui-collapsible-heading ui-collapsible-heading-collapsed").children().contents().unwrap()), e.anchor.contents().unwrap(), e.content.contents().unwrap(), this.element.removeClass("ui-collapsible ui-collapsible-collapsed ui-collapsible-themed-content ui-collapsible-inset ui-corner-all"))
            }
        }), e.mobile.collapsible.defaults = {
            expandCueText: " click to expand contents",
            collapseCueText: " click to collapse contents",
            collapsedIcon: "plus",
            contentTheme: "inherit",
            expandedIcon: "minus",
            iconpos: "left",
            inset: !0,
            corners: !0,
            theme: "inherit",
            mini: !1
        }
    }(e), function (e) {
        e.mobile.behaviors.addFirstLastClasses = {
            _getVisibles: function (e, o) {
                var t;
                return o ? t = e.not(".ui-screen-hidden") : (t = e.filter(":visible"), 0 === t.length && (t = e.not(".ui-screen-hidden"))), t
            }, _addFirstLastClasses: function (e, o, t) {
                e.removeClass("ui-first-child ui-last-child"), o.eq(0).addClass("ui-first-child").end().last().addClass("ui-last-child"), t || this.element.trigger("updatelayout")
            }, _removeFirstLastClasses: function (e) {
                e.removeClass("ui-first-child ui-last-child")
            }
        }
    }(e), function (e, o) {
        var t = ":mobile-collapsible, " + e.mobile.collapsible.initSelector;
        e.widget("mobile.collapsibleset", e.extend({
            initSelector: ":jqmData(role='collapsible-set'),:jqmData(role='collapsibleset')",
            options: e.extend({ enhanced: !1 }, e.mobile.collapsible.defaults),
            _handleCollapsibleExpand: function (o) {
                var t = e(o.target).closest(".ui-collapsible");
                t.parent().is(":mobile-collapsibleset, :jqmData(role='collapsible-set')") && t.siblings(".ui-collapsible:not(.ui-collapsible-collapsed)").collapsible("collapse")
            },
            _create: function () {
                var o = this.element, t = this.options;
                e.extend(this, { _classes: "" }), t.enhanced || (o.addClass("ui-collapsible-set " + this._themeClassFromOption("ui-group-theme-", t.theme) + " " + (t.corners && t.inset ? "ui-corner-all " : "")), this.element.find(e.mobile.collapsible.initSelector).collapsible()), this._on(o, { collapsibleexpand: "_handleCollapsibleExpand" })
            },
            _themeClassFromOption: function (e, o) {
                return o ? "none" === o ? "" : e + o : ""
            },
            _init: function () {
                this._refresh(!0), this.element.children(t).filter(":jqmData(collapsed='false')").collapsible("expand")
            },
            _setOptions: function (e) {
                var t, n, i = this.element, a = this._themeClassFromOption("ui-group-theme-", e.theme);
                return a && i.removeClass(this._themeClassFromOption("ui-group-theme-", this.options.theme)).addClass(a), e.inset !== o && (n = !(!e.inset || !e.corners && !this.options.corners)), e.corners !== o && (n = !(!e.corners || !e.inset && !this.options.inset)), n !== o && i.toggleClass("ui-corner-all", n), t = this._super(e), this.element.children(":mobile-collapsible").collapsible("refresh"), t
            },
            _destroy: function () {
                var e = this.element;
                this._removeFirstLastClasses(e.children(t)), e.removeClass("ui-collapsible-set ui-corner-all " + this._themeClassFromOption("ui-group-theme-", this.options.theme)).children(":mobile-collapsible").collapsible("destroy")
            },
            _refresh: function (o) {
                var n = this.element.children(t);
                this.element.find(e.mobile.collapsible.initSelector).not(".ui-collapsible").collapsible(), this._addFirstLastClasses(n, this._getVisibles(n, o), o)
            },
            refresh: function () {
                this._refresh(!1)
            }
        }, e.mobile.behaviors.addFirstLastClasses))
    }(e), function (e) {
        e.fn.fieldcontain = function () {
            return this.addClass("ui-field-contain")
        }
    }(e), function (e) {
        e.fn.grid = function (o) {
            return this.each(function () {
                var t, n, i = e(this), a = e.extend({ grid: null }, o), r = i.children(),
                    s = { solo: 1, a: 2, b: 3, c: 4, d: 5 }, l = a.grid;
                if (!l) if (r.length <= 5) for (n in s) s[n] === r.length && (l = n); else l = "a", i.addClass("ui-grid-duo");
                t = s[l], i.addClass("ui-grid-" + l), r.filter(":nth-child(" + t + "n+1)").addClass("ui-block-a"), t > 1 && r.filter(":nth-child(" + t + "n+2)").addClass("ui-block-b"), t > 2 && r.filter(":nth-child(" + t + "n+3)").addClass("ui-block-c"), t > 3 && r.filter(":nth-child(" + t + "n+4)").addClass("ui-block-d"), t > 4 && r.filter(":nth-child(" + t + "n+5)").addClass("ui-block-e")
            })
        }
    }(e), function (e, o) {
        e.widget("mobile.navbar", {
            options: { iconpos: "top", grid: null }, _create: function () {
                var o = this.element, n = o.find("a"),
                    i = n.filter(":jqmData(icon)").length ? this.options.iconpos : void 0;
                o.addClass("ui-navbar").attr("role", "navigation").find("ul").jqmEnhanceable().grid({ grid: this.options.grid }), n.each(function () {
                    var o = e.mobile.getAttribute(this, "icon"), t = e.mobile.getAttribute(this, "theme"), n = "ui-btn";
                    t && (n += " ui-btn-" + t), o && (n += " ui-icon-" + o + " ui-btn-icon-" + i), e(this).addClass(n)
                }), o.delegate("a", "vclick", function () {
                    var o = e(this);
                    o.hasClass("ui-state-disabled") || o.hasClass("ui-disabled") || o.hasClass(e.mobile.activeBtnClass) || (n.removeClass(e.mobile.activeBtnClass), o.addClass(e.mobile.activeBtnClass), e(t).one("pagehide", function () {
                        o.removeClass(e.mobile.activeBtnClass)
                    }))
                }), o.closest(".ui-page").bind("pagebeforeshow", function () {
                    n.filter(".ui-state-persist").addClass(e.mobile.activeBtnClass)
                })
            }
        })
    }(e), function (e) {
        var o = e.mobile.getAttribute;
        e.widget("mobile.listview", e.extend({
            options: {
                theme: null,
                countTheme: null,
                dividerTheme: null,
                icon: "carat-r",
                splitIcon: "carat-r",
                splitTheme: null,
                corners: !0,
                shadow: !0,
                inset: !1
            }, _create: function () {
                var e = this, o = "";
                o += e.options.inset ? " ui-listview-inset" : "", e.options.inset && (o += e.options.corners ? " ui-corner-all" : "", o += e.options.shadow ? " ui-shadow" : ""), e.element.addClass(" ui-listview" + o), e.refresh(!0)
            }, _findFirstElementByTagName: function (e, o, t, n) {
                var i = {};
                for (i[t] = i[n] = !0; e;) {
                    if (i[e.nodeName]) return e;
                    e = e[o]
                }
                return null
            }, _addThumbClasses: function (o) {
                var t, n, i = o.length;
                for (t = 0; i > t; t++) n = e(this._findFirstElementByTagName(o[t].firstChild, "nextSibling", "img", "IMG")), n.length && e(this._findFirstElementByTagName(n[0].parentNode, "parentNode", "li", "LI")).addClass(n.hasClass("ui-li-icon") ? "ui-li-has-icon" : "ui-li-has-thumb")
            }, _getChildrenByTagName: function (o, t, n) {
                var i = [], a = {};
                for (a[t] = a[n] = !0, o = o.firstChild; o;) a[o.nodeName] && i.push(o), o = o.nextSibling;
                return e(i)
            }, _beforeListviewRefresh: e.noop, _afterListviewRefresh: e.noop, refresh: function (t) {
                var n, i, a, r, s, l, p, c, u, h, m, g, d, b, _, f, w, v, E, T, P = this.options, S = this.element,
                    N = !!e.nodeName(S[0], "ol"), I = S.attr("start"), C = {}, R = S.find(".ui-li-count"),
                    y = o(S[0], "counttheme") || this.options.countTheme, L = y ? "ui-body-" + y : "ui-body-inherit";
                for (P.theme && S.addClass("ui-group-theme-" + P.theme), N && (I || 0 === I) && (m = parseInt(I, 10) - 1, S.css("counter-reset", "listnumbering " + m)), this._beforeListviewRefresh(), T = this._getChildrenByTagName(S[0], "li", "LI"), i = 0, a = T.length; a > i; i++) r = T.eq(i), s = "", (t || r[0].className.search(/\bui-li-static\b|\bui-li-divider\b/) < 0) && (u = this._getChildrenByTagName(r[0], "a", "A"), h = "list-divider" === o(r[0], "role"), d = r.attr("value"), l = o(r[0], "theme"), u.length && u[0].className.search(/\bui-btn\b/) < 0 && !h ? (p = o(r[0], "icon"), c = !1 !== p && (p || P.icon), u.removeClass("ui-link"), n = "ui-btn", l && (n += " ui-btn-" + l), u.length > 1 ? (s = "ui-li-has-alt", b = u.last(), _ = o(b[0], "theme") || P.splitTheme || o(r[0], "theme", !0), f = _ ? " ui-btn-" + _ : "", w = o(b[0], "icon") || o(r[0], "icon") || P.splitIcon, v = "ui-btn ui-btn-icon-notext ui-icon-" + w + f, b.attr("title", e.trim(b.getEncodedText())).addClass(v).empty()) : c && (n += " ui-btn-icon-right ui-icon-" + c), u.first().addClass(n)) : h ? (E = o(r[0], "theme") || P.dividerTheme || P.theme, s = "ui-li-divider ui-bar-" + (E || "inherit"), r.attr("role", "heading")) : u.length <= 0 && (s = "ui-li-static ui-body-" + (l || "inherit")), N && d && (g = parseInt(d, 10) - 1, r.css("counter-reset", "listnumbering " + g))), C[s] || (C[s] = []), C[s].push(r[0]);
                for (s in C) e(C[s]).addClass(s);
                R.each(function () {
                    e(this).closest("li").addClass("ui-li-has-count")
                }), L && R.addClass(L), this._addThumbClasses(T), this._addThumbClasses(T.find(".ui-btn")), this._afterListviewRefresh(), this._addFirstLastClasses(T, this._getVisibles(T, t), t)
            }
        }, e.mobile.behaviors.addFirstLastClasses))
    }(e), function (e) {
        function o(o) {
            var t = e.trim(o.text()) || null;
            return t ? t = t.slice(0, 1).toUpperCase() : null
        }

        e.widget("mobile.listview", e.mobile.listview, {
            options: { autodividers: !1, autodividersSelector: o },
            _beforeListviewRefresh: function () {
                this.options.autodividers && (this._replaceDividers(), this._superApply(arguments))
            },
            _replaceDividers: function () {
                var o, n, i, a, r, s = null, l = this.element;
                for (l.children("li:jqmData(role='list-divider')").remove(), n = l.children("li"), o = 0; o < n.length; o++) i = n[o], a = this.options.autodividersSelector(e(i)), a && s !== a && (r = t.createElement("li"), r.appendChild(t.createTextNode(a)), r.setAttribute("data-" + e.mobile.ns + "role", "list-divider"), i.parentNode.insertBefore(r, i)), s = a
            }
        })
    }(e), function (e) {
        e.widget("mobile.listview", e.mobile.listview, {
            options: { hideDividers: !1 },
            _afterListviewRefresh: function () {
                var e, o, t, n = !0;
                if (this._superApply(arguments), this.options.hideDividers) for (e = this._getChildrenByTagName(this.element[0], "li", "LI"), o = e.length - 1; o > -1; o--) t = e[o], t.className.match(/(^|\s)ui-li-divider($|\s)/) ? (n && (t.className = t.className + " ui-screen-hidden"), n = !0) : t.className.match(/(^|\s)ui-screen-hidden($|\s)/) || (n = !1)
            }
        })
    }(e), function (e) {
        e.mobile.nojs = function (o) {
            e(":jqmData(role='nojs')", o).addClass("ui-nojs")
        }
    }(e), function (e) {
        e.mobile.behaviors.formReset = {
            _handleFormReset: function () {
                this._on(this.element.closest("form"), {
                    reset: function () {
                        this._delay("_reset")
                    }
                })
            }
        }
    }(e), function (e, o) {
        var t = e.mobile.path.hashToSelector;
        e.widget("mobile.checkboxradio", e.extend({
            initSelector: "input:not( :jqmData(role='flipswitch' ) )[type='checkbox'],input[type='radio']:not( :jqmData(role='flipswitch' ))",
            options: { theme: "inherit", mini: !1, wrapperClass: null, enhanced: !1, iconpos: "left" },
            _create: function () {
                var o = this.element, n = this.options, i = function (e, o) {
                    return e.jqmData(o) || e.closest("form, fieldset").jqmData(o)
                }, a = o.closest("label"),
                    r = a.length ? a : o.closest("form, fieldset, :jqmData(role='page'), :jqmData(role='dialog')").find("label").filter("[for='" + t(o[0].id) + "']").first(),
                    s = o[0].type, l = "ui-" + s + "-on", p = "ui-" + s + "-off";
                ("checkbox" === s || "radio" === s) && (this.element[0].disabled && (this.options.disabled = !0), n.iconpos = i(o, "iconpos") || r.attr("data-" + e.mobile.ns + "iconpos") || n.iconpos, n.mini = i(o, "mini") || n.mini, e.extend(this, {
                    input: o,
                    label: r,
                    parentLabel: a,
                    inputtype: s,
                    checkedClass: l,
                    uncheckedClass: p
                }), this.options.enhanced || this._enhance(), this._on(r, {
                    vmouseover: "_handleLabelVMouseOver",
                    vclick: "_handleLabelVClick"
                }), this._on(o, {
                    vmousedown: "_cacheVals",
                    vclick: "_handleInputVClick",
                    focus: "_handleInputFocus",
                    blur: "_handleInputBlur"
                }), this._handleFormReset(), this.refresh())
            },
            _enhance: function () {
                this.label.addClass("ui-btn ui-corner-all"), this.parentLabel.length > 0 ? this.input.add(this.label).wrapAll(this._wrapper()) : (this.element.wrap(this._wrapper()), this.element.parent().prepend(this.label)), this._setOptions({
                    theme: this.options.theme,
                    iconpos: this.options.iconpos,
                    mini: this.options.mini
                })
            },
            _wrapper: function () {
                return e("<div class='" + (this.options.wrapperClass ? this.options.wrapperClass : "") + " ui-" + this.inputtype + (this.options.disabled ? " ui-state-disabled" : "") + "' ></div>")
            },
            _handleInputFocus: function () {
                this.label.addClass(e.mobile.focusClass)
            },
            _handleInputBlur: function () {
                this.label.removeClass(e.mobile.focusClass)
            },
            _handleInputVClick: function () {
                this.element.prop("checked", this.element.is(":checked")), this._getInputSet().not(this.element).prop("checked", !1), this._updateAll()
            },
            _handleLabelVMouseOver: function (e) {
                this.label.parent().hasClass("ui-state-disabled") && e.stopPropagation()
            },
            _handleLabelVClick: function (e) {
                var o = this.element;
                return o.is(":disabled") ? void e.preventDefault() : (this._cacheVals(), o.prop("checked", "radio" === this.inputtype && !0 || !o.prop("checked")), o.triggerHandler("click"), this._getInputSet().not(o).prop("checked", !1), this._updateAll(), !1)
            },
            _cacheVals: function () {
                this._getInputSet().each(function () {
                    e(this).attr("data-" + e.mobile.ns + "cacheVal", this.checked)
                })
            },
            _getInputSet: function () {
                var o, n, i = this.element[0], a = i.name, r = i.form, s = this.element.parents().last().get(0),
                    l = this.element;
                return a && "radio" === this.inputtype && s && (o = "input[type='radio'][name='" + t(a) + "']", r ? (n = r.id, n && (l = e(o + "[form='" + t(n) + "']", s)), l = e(r).find(o).filter(function () {
                    return this.form === r
                }).add(l)) : l = e(o, s).filter(function () {
                    return !this.form
                })), l
            },
            _updateAll: function () {
                var o = this;
                this._getInputSet().each(function () {
                    var t = e(this);
                    (this.checked || "checkbox" === o.inputtype) && t.trigger("change")
                }).checkboxradio("refresh")
            },
            _reset: function () {
                this.refresh()
            },
            _hasIcon: function () {
                var o, t, n = e.mobile.controlgroup;
                return !(n && (o = this.element.closest(":mobile-controlgroup," + n.prototype.initSelector), o.length > 0)) || (t = e.data(o[0], "mobile-controlgroup"), "horizontal" !== (t ? t.options.type : o.attr("data-" + e.mobile.ns + "type")))
            },
            refresh: function () {
                var o = this._hasIcon(), t = this.element[0].checked, n = e.mobile.activeBtnClass,
                    i = "ui-btn-icon-" + this.options.iconpos, a = [], r = [];
                o ? (r.push(n), a.push(i)) : (r.push(i), (t ? a : r).push(n)), t ? (a.push(this.checkedClass), r.push(this.uncheckedClass)) : (a.push(this.uncheckedClass), r.push(this.checkedClass)), this.label.addClass(a.join(" ")).removeClass(r.join(" "))
            },
            widget: function () {
                return this.label.parent()
            },
            _setOptions: function (e) {
                var t = this.label, n = this.options, i = this.widget(), a = this._hasIcon();
                e.disabled !== o && (this.input.prop("disabled", !!e.disabled), i.toggleClass("ui-state-disabled", !!e.disabled)), e.mini !== o && i.toggleClass("ui-mini", !!e.mini), e.theme !== o && t.removeClass("ui-btn-" + n.theme).addClass("ui-btn-" + e.theme), e.wrapperClass !== o && i.removeClass(n.wrapperClass).addClass(e.wrapperClass), e.iconpos !== o && a ? t.removeClass("ui-btn-icon-" + n.iconpos).addClass("ui-btn-icon-" + e.iconpos) : a || t.removeClass("ui-btn-icon-" + n.iconpos), this._super(e)
            }
        }, e.mobile.behaviors.formReset))
    }(e), function (e, o) {
        e.widget("mobile.button", {
            initSelector: "input[type='button'], input[type='submit'], input[type='reset']",
            options: {
                theme: null,
                icon: null,
                iconpos: "left",
                iconshadow: !1,
                corners: !0,
                shadow: !0,
                inline: null,
                mini: null,
                wrapperClass: null,
                enhanced: !1
            },
            _create: function () {
                this.element.is(":disabled") && (this.options.disabled = !0), this.options.enhanced || this._enhance(), e.extend(this, { wrapper: this.element.parent() }), this._on({
                    focus: function () {
                        this.widget().addClass(e.mobile.focusClass)
                    }, blur: function () {
                        this.widget().removeClass(e.mobile.focusClass)
                    }
                }),
                    this.refresh(!0)
            },
            _enhance: function () {
                this.element.wrap(this._button())
            },
            _button: function () {
                var o = this.options, t = this._getIconClasses(this.options);
                return e("<div class='ui-btn ui-input-btn" + (o.wrapperClass ? " " + o.wrapperClass : "") + (o.theme ? " ui-btn-" + o.theme : "") + (o.corners ? " ui-corner-all" : "") + (o.shadow ? " ui-shadow" : "") + (o.inline ? " ui-btn-inline" : "") + (o.mini ? " ui-mini" : "") + (o.disabled ? " ui-state-disabled" : "") + (t ? " " + t : "") + "' >" + this.element.val() + "</div>")
            },
            widget: function () {
                return this.wrapper
            },
            _destroy: function () {
                this.element.insertBefore(this.button), this.button.remove()
            },
            _getIconClasses: function (e) {
                return e.icon ? "ui-icon-" + e.icon + (e.iconshadow ? " ui-shadow-icon" : "") + " ui-btn-icon-" + e.iconpos : ""
            },
            _setOptions: function (t) {
                var n = this.widget();
                t.theme !== o && n.removeClass(this.options.theme).addClass("ui-btn-" + t.theme), t.corners !== o && n.toggleClass("ui-corner-all", t.corners), t.shadow !== o && n.toggleClass("ui-shadow", t.shadow), t.inline !== o && n.toggleClass("ui-btn-inline", t.inline), t.mini !== o && n.toggleClass("ui-mini", t.mini), t.disabled !== o && (this.element.prop("disabled", t.disabled), n.toggleClass("ui-state-disabled", t.disabled)), (t.icon !== o || t.iconshadow !== o || t.iconpos !== o) && n.removeClass(this._getIconClasses(this.options)).addClass(this._getIconClasses(e.extend({}, this.options, t))), this._super(t)
            },
            refresh: function (o) {
                var t, n = this.element.prop("disabled");
                this.options.icon && "notext" === this.options.iconpos && this.element.attr("title") && this.element.attr("title", this.element.val()), o || (t = this.element.detach(), e(this.wrapper).text(this.element.val()).append(t)), this.options.disabled !== n && this._setOptions({ disabled: n })
            }
        })
    }(e), function (e) {
        var o = e("meta[name=viewport]"), t = o.attr("content"), n = t + ",maximum-scale=1, user-scalable=no",
            i = t + ",maximum-scale=10, user-scalable=yes",
            a = /(user-scalable[\s]*=[\s]*no)|(maximum-scale[\s]*=[\s]*1)[$,\s]/.test(t);
        e.mobile.zoom = e.extend({}, {
            enabled: !a, locked: !1, disable: function (t) {
                a || e.mobile.zoom.locked || (o.attr("content", n), e.mobile.zoom.enabled = !1, e.mobile.zoom.locked = t || !1)
            }, enable: function (t) {
                a || e.mobile.zoom.locked && !0 !== t || (o.attr("content", i), e.mobile.zoom.enabled = !0, e.mobile.zoom.locked = !1)
            }, restore: function () {
                a || (o.attr("content", t), e.mobile.zoom.enabled = !0)
            }
        })
    }(e), function (e, o) {
        e.widget("mobile.textinput", {
            initSelector: "input[type='text'],input[type='search'],:jqmData(type='search'),input[type='number'],:jqmData(type='number'),input[type='password'],input[type='email'],input[type='url'],input[type='tel'],textarea,input[type='time'],input[type='date'],input[type='month'],input[type='week'],input[type='datetime'],input[type='datetime-local'],input[type='color'],input:not([type]),input[type='file']",
            options: {
                theme: null,
                corners: !0,
                mini: !1,
                preventFocusZoom: /iPhone|iPad|iPod/.test(navigator.platform) && navigator.userAgent.indexOf("AppleWebKit") > -1,
                wrapperClass: "",
                enhanced: !1
            },
            _create: function () {
                var o = this.options, t = this.element.is("[type='search'], :jqmData(type='search')"),
                    n = "TEXTAREA" === this.element[0].tagName,
                    i = this.element.is("[data-" + (e.mobile.ns || "") + "type='range']"),
                    a = (this.element.is("input") || this.element.is("[data-" + (e.mobile.ns || "") + "type='search']")) && !i;
                this.element.prop("disabled") && (o.disabled = !0), e.extend(this, {
                    classes: this._classesFromOptions(),
                    isSearch: t,
                    isTextarea: n,
                    isRange: i,
                    inputNeedsWrap: a
                }), this._autoCorrect(), o.enhanced || this._enhance(), this._on({
                    focus: "_handleFocus",
                    blur: "_handleBlur"
                })
            },
            refresh: function () {
                this.setOptions({ disabled: this.element.is(":disabled") })
            },
            _enhance: function () {
                var e = [];
                this.isTextarea && e.push("ui-input-text"), (this.isTextarea || this.isRange) && e.push("ui-shadow-inset"), this.inputNeedsWrap ? this.element.wrap(this._wrap()) : e = e.concat(this.classes), this.element.addClass(e.join(" "))
            },
            widget: function () {
                return this.inputNeedsWrap ? this.element.parent() : this.element
            },
            _classesFromOptions: function () {
                var e = this.options, o = [];
                return o.push("ui-body-" + (null === e.theme ? "inherit" : e.theme)), e.corners && o.push("ui-corner-all"), e.mini && o.push("ui-mini"), e.disabled && o.push("ui-state-disabled"), e.wrapperClass && o.push(e.wrapperClass), o
            },
            _wrap: function () {
                return e("<div class='" + (this.isSearch ? "ui-input-search " : "ui-input-text ") + this.classes.join(" ") + " ui-shadow-inset'></div>")
            },
            _autoCorrect: function () {
                "undefined" == typeof this.element[0].autocorrect || e.support.touchOverflow || (this.element[0].setAttribute("autocorrect", "off"), this.element[0].setAttribute("autocomplete", "off"))
            },
            _handleBlur: function () {
                this.widget().removeClass(e.mobile.focusClass), this.options.preventFocusZoom && e.mobile.zoom.enable(!0)
            },
            _handleFocus: function () {
                this.options.preventFocusZoom && e.mobile.zoom.disable(!0), this.widget().addClass(e.mobile.focusClass)
            },
            _setOptions: function (e) {
                var t = this.widget();
                this._super(e), (e.disabled !== o || e.mini !== o || e.corners !== o || e.theme !== o || e.wrapperClass !== o) && (t.removeClass(this.classes.join(" ")), this.classes = this._classesFromOptions(), t.addClass(this.classes.join(" "))), e.disabled !== o && this.element.prop("disabled", !!e.disabled)
            },
            _destroy: function () {
                this.options.enhanced || (this.inputNeedsWrap && this.element.unwrap(), this.element.removeClass("ui-input-text " + this.classes.join(" ")))
            }
        })
    }(e), function (e, n) {
        e.widget("mobile.slider", e.extend({
            initSelector: "input[type='range'], :jqmData(type='range'), :jqmData(role='slider')",
            widgetEventPrefix: "slide",
            options: { theme: null, trackTheme: null, corners: !0, mini: !1, highlight: !1 },
            _create: function () {
                var i, a, r, s, l, p, c, u, h, m, g = this, d = this.element,
                    b = this.options.trackTheme || e.mobile.getAttribute(d[0], "theme"),
                    _ = b ? " ui-bar-" + b : " ui-bar-inherit",
                    f = this.options.corners || d.jqmData("corners") ? " ui-corner-all" : "",
                    w = this.options.mini || d.jqmData("mini") ? " ui-mini" : "", v = d[0].nodeName.toLowerCase(),
                    E = "select" === v, T = d.parent().is(":jqmData(role='rangeslider')"),
                    P = E ? "ui-slider-switch" : "", S = d.attr("id"), N = e("[for='" + S + "']"),
                    I = N.attr("id") || S + "-label", C = E ? 0 : parseFloat(d.attr("min")),
                    R = E ? d.find("option").length - 1 : parseFloat(d.attr("max")),
                    y = o.parseFloat(d.attr("step") || 1), L = t.createElement("a"), D = e(L),
                    G = t.createElement("div"), O = e(G), x = !(!this.options.highlight || E) && function () {
                        var o = t.createElement("div");
                        return o.className = "ui-slider-bg " + e.mobile.activeBtnClass, e(o).prependTo(O)
                    }();
                if (N.attr("id", I), this.isToggleSwitch = E, L.setAttribute("href", "#"), G.setAttribute("role", "application"), G.className = [this.isToggleSwitch ? "ui-slider ui-slider-track ui-shadow-inset " : "ui-slider-track ui-shadow-inset ", P, _, f, w].join(""), L.className = "ui-slider-handle", G.appendChild(L), D.attr({
                    role: "slider",
                    "aria-valuemin": C,
                    "aria-valuemax": R,
                    "aria-valuenow": this._value(),
                    "aria-valuetext": this._value(),
                    title: this._value(),
                    "aria-labelledby": I
                }), e.extend(this, {
                    slider: O,
                    handle: D,
                    control: d,
                    type: v,
                    step: y,
                    max: R,
                    min: C,
                    valuebg: x,
                    isRangeslider: T,
                    dragging: !1,
                    beforeStart: null,
                    userModified: !1,
                    mouseMoved: !1
                }), E) {
                    for (c = d.attr("tabindex"), c && D.attr("tabindex", c), d.attr("tabindex", "-1").focus(function () {
                        e(this).blur(), D.focus()
                    }), a = t.createElement("div"), a.className = "ui-slider-inneroffset", r = 0, s = G.childNodes.length; s > r; r++) a.appendChild(G.childNodes[r]);
                    for (G.appendChild(a), D.addClass("ui-slider-handle-snapping"), i = d.find("option"), l = 0, p = i.length; p > l; l++) u = l ? "a" : "b", h = l ? " " + e.mobile.activeBtnClass : "", m = t.createElement("span"), m.className = ["ui-slider-label ui-slider-label-", u, h].join(""), m.setAttribute("role", "img"), m.appendChild(t.createTextNode(i[l].innerHTML)), e(m).prependTo(O);
                    g._labels = e(".ui-slider-label", O)
                }
                d.addClass(E ? "ui-slider-switch" : "ui-slider-input"), this._on(d, {
                    change: "_controlChange",
                    keyup: "_controlKeyup",
                    blur: "_controlBlur",
                    vmouseup: "_controlVMouseUp"
                }), O.bind("vmousedown", e.proxy(this._sliderVMouseDown, this)).bind("vclick", !1), this._on(t, { vmousemove: "_preventDocumentDrag" }), this._on(O.add(t), { vmouseup: "_sliderVMouseUp" }), O.insertAfter(d), E || T || (a = this.options.mini ? "<div class='ui-slider ui-mini'>" : "<div class='ui-slider'>", d.add(O).wrapAll(a)), this._on(this.handle, {
                    vmousedown: "_handleVMouseDown",
                    keydown: "_handleKeydown",
                    keyup: "_handleKeyup"
                }), this.handle.bind("vclick", !1), this._handleFormReset(), this.refresh(n, n, !0)
            },
            _setOptions: function (e) {
                e.theme !== n && this._setTheme(e.theme), e.trackTheme !== n && this._setTrackTheme(e.trackTheme), e.corners !== n && this._setCorners(e.corners), e.mini !== n && this._setMini(e.mini), e.highlight !== n && this._setHighlight(e.highlight), e.disabled !== n && this._setDisabled(e.disabled), this._super(e)
            },
            _controlChange: function (e) {
                return !1 !== this._trigger("controlchange", e) && void (this.mouseMoved || this.refresh(this._value(), !0))
            },
            _controlKeyup: function () {
                this.refresh(this._value(), !0, !0)
            },
            _controlBlur: function () {
                this.refresh(this._value(), !0)
            },
            _controlVMouseUp: function () {
                this._checkedRefresh()
            },
            _handleVMouseDown: function () {
                this.handle.focus()
            },
            _handleKeydown: function (o) {
                var t = this._value();
                if (!this.options.disabled) {
                    switch (o.keyCode) {
                        case e.mobile.keyCode.HOME:
                        case e.mobile.keyCode.END:
                        case e.mobile.keyCode.PAGE_UP:
                        case e.mobile.keyCode.PAGE_DOWN:
                        case e.mobile.keyCode.UP:
                        case e.mobile.keyCode.RIGHT:
                        case e.mobile.keyCode.DOWN:
                        case e.mobile.keyCode.LEFT:
                            o.preventDefault(), this._keySliding || (this._keySliding = !0, this.handle.addClass("ui-state-active"))
                    }
                    switch (o.keyCode) {
                        case e.mobile.keyCode.HOME:
                            this.refresh(this.min);
                            break;
                        case e.mobile.keyCode.END:
                            this.refresh(this.max);
                            break;
                        case e.mobile.keyCode.PAGE_UP:
                        case e.mobile.keyCode.UP:
                        case e.mobile.keyCode.RIGHT:
                            this.refresh(t + this.step);
                            break;
                        case e.mobile.keyCode.PAGE_DOWN:
                        case e.mobile.keyCode.DOWN:
                        case e.mobile.keyCode.LEFT:
                            this.refresh(t - this.step)
                    }
                }
            },
            _handleKeyup: function () {
                this._keySliding && (this._keySliding = !1, this.handle.removeClass("ui-state-active"))
            },
            _sliderVMouseDown: function (e) {
                return !(this.options.disabled || 1 !== e.which && 0 !== e.which && e.which !== n) && (!1 !== this._trigger("beforestart", e) && (this.dragging = !0, this.userModified = !1, this.mouseMoved = !1, this.isToggleSwitch && (this.beforeStart = this.element[0].selectedIndex), this.refresh(e), this._trigger("start"), !1))
            },
            _sliderVMouseUp: function () {
                return this.dragging ? (this.dragging = !1, this.isToggleSwitch && (this.handle.addClass("ui-slider-handle-snapping"), this.refresh(this.mouseMoved ? this.userModified ? 0 === this.beforeStart ? 1 : 0 : this.beforeStart : 0 === this.beforeStart ? 1 : 0)), this.mouseMoved = !1, this._trigger("stop"), !1) : void 0
            },
            _preventDocumentDrag: function (e) {
                return !1 !== this._trigger("drag", e) && (this.dragging && !this.options.disabled ? (this.mouseMoved = !0, this.isToggleSwitch && this.handle.removeClass("ui-slider-handle-snapping"), this.refresh(e), this.userModified = this.beforeStart !== this.element[0].selectedIndex, !1) : void 0)
            },
            _checkedRefresh: function () {
                this.value !== this._value() && this.refresh(this._value())
            },
            _value: function () {
                return this.isToggleSwitch ? this.element[0].selectedIndex : parseFloat(this.element.val())
            },
            _reset: function () {
                this.refresh(n, !1, !0)
            },
            refresh: function (o, n, i) {
                var a, r, s, l, p, c, u, h, m, g, d, b, _, f, w, v, E, T, P, S, N = this,
                    I = e.mobile.getAttribute(this.element[0], "theme"), C = this.options.theme || I,
                    R = C ? " ui-btn-" + C : "", y = this.options.trackTheme || I,
                    L = y ? " ui-bar-" + y : " ui-bar-inherit", D = this.options.corners ? " ui-corner-all" : "",
                    G = this.options.mini ? " ui-mini" : "";
                if (N.slider[0].className = [this.isToggleSwitch ? "ui-slider ui-slider-switch ui-slider-track ui-shadow-inset" : "ui-slider-track ui-shadow-inset", L, D, G].join(""), (this.options.disabled || this.element.prop("disabled")) && this.disable(), this.value = this._value(), this.options.highlight && !this.isToggleSwitch && 0 === this.slider.find(".ui-slider-bg").length && (this.valuebg = function () {
                    var o = t.createElement("div");
                    return o.className = "ui-slider-bg " + e.mobile.activeBtnClass, e(o).prependTo(N.slider)
                }()), this.handle.addClass("ui-btn" + R + " ui-shadow"), u = this.element, h = !this.isToggleSwitch, m = h ? [] : u.find("option"), g = h ? parseFloat(u.attr("min")) : 0, d = h ? parseFloat(u.attr("max")) : m.length - 1, b = h && parseFloat(u.attr("step")) > 0 ? parseFloat(u.attr("step")) : 1, "object" == typeof o) {
                    if (s = o, l = 8, a = this.slider.offset().left, r = this.slider.width(), p = r / ((d - g) / b), !this.dragging || s.pageX < a - l || s.pageX > a + r + l) return;
                    c = p > 1 ? (s.pageX - a) / r * 100 : Math.round((s.pageX - a) / r * 100)
                } else null == o && (o = h ? parseFloat(u.val() || 0) : u[0].selectedIndex), c = (parseFloat(o) - g) / (d - g) * 100;
                if (!isNaN(c) && (_ = c / 100 * (d - g) + g, f = (_ - g) % b, w = _ - f, 2 * Math.abs(f) >= b && (w += f > 0 ? b : -b), v = 100 / ((d - g) / b), _ = parseFloat(w.toFixed(5)), void 0 === p && (p = r / ((d - g) / b)), p > 1 && h && (c = (_ - g) * v * (1 / b)), 0 > c && (c = 0), c > 100 && (c = 100), g > _ && (_ = g), _ > d && (_ = d), this.handle.css("left", c + "%"), this.handle[0].setAttribute("aria-valuenow", h ? _ : m.eq(_).attr("value")), this.handle[0].setAttribute("aria-valuetext", h ? _ : m.eq(_).getEncodedText()), this.handle[0].setAttribute("title", h ? _ : m.eq(_).getEncodedText()), this.valuebg && this.valuebg.css("width", c + "%"), this._labels && (E = this.handle.width() / this.slider.width() * 100, T = c && E + (100 - E) * c / 100, P = 100 === c ? 0 : Math.min(E + 100 - T, 100), this._labels.each(function () {
                    var o = e(this).hasClass("ui-slider-label-a");
                    e(this).width((o ? T : P) + "%")
                })), !i)) {
                    if (S = !1, h ? (S = u.val() !== _, u.val(_)) : (S = u[0].selectedIndex !== _, u[0].selectedIndex = _), !1 === this._trigger("beforechange", o)) return !1;
                    !n && S && u.trigger("change")
                }
            },
            _setHighlight: function (e) {
                e = !!e, e ? (this.options.highlight = !!e, this.refresh()) : this.valuebg && (this.valuebg.remove(), this.valuebg = !1)
            },
            _setTheme: function (e) {
                this.handle.removeClass("ui-btn-" + this.options.theme).addClass("ui-btn-" + e);
                var o = this.options.theme ? this.options.theme : "inherit", t = e || "inherit";
                this.control.removeClass("ui-body-" + o).addClass("ui-body-" + t)
            },
            _setTrackTheme: function (e) {
                var o = this.options.trackTheme ? this.options.trackTheme : "inherit", t = e || "inherit";
                this.slider.removeClass("ui-body-" + o).addClass("ui-body-" + t)
            },
            _setMini: function (e) {
                e = !!e, this.isToggleSwitch || this.isRangeslider || (this.slider.parent().toggleClass("ui-mini", e), this.element.toggleClass("ui-mini", e)), this.slider.toggleClass("ui-mini", e)
            },
            _setCorners: function (e) {
                this.slider.toggleClass("ui-corner-all", e), this.isToggleSwitch || this.control.toggleClass("ui-corner-all", e)
            },
            _setDisabled: function (e) {
                e = !!e, this.element.prop("disabled", e), this.slider.toggleClass("ui-state-disabled", e).attr("aria-disabled", e)
            }
        }, e.mobile.behaviors.formReset))
    }(e), function (e) {
        function o() {
            return t || (t = e("<div></div>", { "class": "ui-slider-popup ui-shadow ui-corner-all" })), t.clone()
        }

        var t;
        e.widget("mobile.slider", e.mobile.slider, {
            options: { popupEnabled: !1, showValue: !1 }, _create: function () {
                this._super(), e.extend(this, {
                    _currentValue: null,
                    _popup: null,
                    _popupVisible: !1
                }), this._setOption("popupEnabled", this.options.popupEnabled), this._on(this.handle, { vmousedown: "_showPopup" }), this._on(this.slider.add(this.document), { vmouseup: "_hidePopup" }), this._refresh()
            }, _positionPopup: function () {
                var e = this.handle.offset();
                this._popup.offset({
                    left: e.left + (this.handle.width() - this._popup.width()) / 2,
                    top: e.top - this._popup.outerHeight() - 5
                })
            }, _setOption: function (e, t) {
                this._super(e, t), "showValue" === e ? this.handle.html(t && !this.options.mini ? this._value() : "") : "popupEnabled" === e && t && !this._popup && (this._popup = o().addClass("ui-body-" + (this.options.theme || "a")).hide().insertBefore(this.element))
            }, refresh: function () {
                this._super.apply(this, arguments), this._refresh()
            }, _refresh: function () {
                var e, o = this.options;
                o.popupEnabled && this.handle.removeAttr("title"), (e = this._value()) !== this._currentValue && (this._currentValue = e, o.popupEnabled && this._popup ? (this._positionPopup(), this._popup.html(e)) : o.showValue && !this.options.mini && this.handle.html(e))
            }, _showPopup: function () {
                this.options.popupEnabled && !this._popupVisible && (this.handle.html(""), this._popup.show(), this._positionPopup(), this._popupVisible = !0)
            }, _hidePopup: function () {
                var e = this.options;
                e.popupEnabled && this._popupVisible && (e.showValue && !e.mini && this.handle.html(this._value()), this._popup.hide(), this._popupVisible = !1)
            }
        })
    }(e), function (e, o) {
        e.widget("mobile.flipswitch", e.extend({
            options: {
                onText: "On",
                offText: "Off",
                theme: null,
                enhanced: !1,
                wrapperClass: null,
                corners: !0,
                mini: !1
            }, _create: function () {
                this.options.enhanced ? e.extend(this, {
                    flipswitch: this.element.parent(),
                    on: this.element.find(".ui-flipswitch-on").eq(0),
                    off: this.element.find(".ui-flipswitch-off").eq(0),
                    type: this.element.get(0).tagName
                }) : this._enhance(), this._handleFormReset(), this._originalTabIndex = this.element.attr("tabindex"), null != this._originalTabIndex && this.on.attr("tabindex", this._originalTabIndex), this.element.attr("tabindex", "-1"), this._on({ focus: "_handleInputFocus" }), this.element.is(":disabled") && this._setOptions({ disabled: !0 }), this._on(this.flipswitch, {
                    click: "_toggle",
                    swipeleft: "_left",
                    swiperight: "_right"
                }), this._on(this.on, { keydown: "_keydown" }), this._on({ change: "refresh" })
            }, _handleInputFocus: function () {
                this.on.focus()
            }, widget: function () {
                return this.flipswitch
            }, _left: function () {
                this.flipswitch.removeClass("ui-flipswitch-active"), "SELECT" === this.type ? this.element.get(0).selectedIndex = 0 : this.element.prop("checked", !1), this.element.trigger("change")
            }, _right: function () {
                this.flipswitch.addClass("ui-flipswitch-active"), "SELECT" === this.type ? this.element.get(0).selectedIndex = 1 : this.element.prop("checked", !0), this.element.trigger("change")
            }, _enhance: function () {
                var o = e("<div>"), t = this.options, n = this.element, i = t.theme ? t.theme : "inherit",
                    a = e("<a></a>", { href: "#" }), r = e("<span></span>"), s = n.get(0).tagName,
                    l = "INPUT" === s ? t.onText : n.find("option").eq(1).text(),
                    p = "INPUT" === s ? t.offText : n.find("option").eq(0).text();
                a.addClass("ui-flipswitch-on ui-btn ui-shadow ui-btn-inherit").text(l), r.addClass("ui-flipswitch-off").text(p), o.addClass("ui-flipswitch ui-shadow-inset ui-bar-" + i + " " + (t.wrapperClass ? t.wrapperClass : "") + " " + (n.is(":checked") || n.find("option").eq(1).is(":selected") ? "ui-flipswitch-active" : "") + (n.is(":disabled") ? " ui-state-disabled" : "") + (t.corners ? " ui-corner-all" : "") + (t.mini ? " ui-mini" : "")).append(a, r), n.addClass("ui-flipswitch-input").after(o).appendTo(o), e.extend(this, {
                    flipswitch: o,
                    on: a,
                    off: r,
                    type: s
                })
            }, _reset: function () {
                this.refresh()
            }, refresh: function () {
                var e, o = this.flipswitch.hasClass("ui-flipswitch-active") ? "_right" : "_left";
                (e = "SELECT" === this.type ? this.element.get(0).selectedIndex > 0 ? "_right" : "_left" : this.element.prop("checked") ? "_right" : "_left") !== o && this[e]()
            }, _toggle: function () {
                this[this.flipswitch.hasClass("ui-flipswitch-active") ? "_left" : "_right"]()
            }, _keydown: function (o) {
                o.which === e.mobile.keyCode.LEFT ? this._left() : o.which === e.mobile.keyCode.RIGHT ? this._right() : o.which === e.mobile.keyCode.SPACE && (this._toggle(), o.preventDefault())
            }, _setOptions: function (e) {
                if (e.theme !== o) {
                    var t = e.theme ? e.theme : "inherit", n = e.theme ? e.theme : "inherit";
                    this.widget().removeClass("ui-bar-" + t).addClass("ui-bar-" + n)
                }
                e.onText !== o && this.on.text(e.onText), e.offText !== o && this.off.text(e.offText), e.disabled !== o && this.widget().toggleClass("ui-state-disabled", e.disabled), e.mini !== o && this.widget().toggleClass("ui-mini", e.mini), e.corners !== o && this.widget().toggleClass("ui-corner-all", e.corners), this._super(e)
            }, _destroy: function () {
                this.options.enhanced || (null != this._originalTabIndex ? this.element.attr("tabindex", this._originalTabIndex) : this.element.removeAttr("tabindex"), this.on.remove(), this.off.remove(), this.element.unwrap(), this.flipswitch.remove(), this.removeClass("ui-flipswitch-input"))
            }
        }, e.mobile.behaviors.formReset))
    }(e), function (e, o) {
        e.widget("mobile.rangeslider", e.extend({
            options: { theme: null, trackTheme: null, corners: !0, mini: !1, highlight: !0 }, _create: function () {
                var o = this.element, t = this.options.mini ? "ui-rangeslider ui-mini" : "ui-rangeslider",
                    n = o.find("input").first(), i = o.find("input").last(), a = o.find("label").first(),
                    r = e.data(n.get(0), "mobile-slider") || e.data(n.slider().get(0), "mobile-slider"),
                    s = e.data(i.get(0), "mobile-slider") || e.data(i.slider().get(0), "mobile-slider"), l = r.slider,
                    p = s.slider, c = r.handle, u = e("<div class='ui-rangeslider-sliders' />").appendTo(o);
                n.addClass("ui-rangeslider-first"), i.addClass("ui-rangeslider-last"), o.addClass(t), l.appendTo(u), p.appendTo(u), a.insertBefore(o), c.prependTo(p), e.extend(this, {
                    _inputFirst: n,
                    _inputLast: i,
                    _sliderFirst: l,
                    _sliderLast: p,
                    _label: a,
                    _targetVal: null,
                    _sliderTarget: !1,
                    _sliders: u,
                    _proxy: !1
                }), this.refresh(), this._on(this.element.find("input.ui-slider-input"), {
                    slidebeforestart: "_slidebeforestart",
                    slidestop: "_slidestop",
                    slidedrag: "_slidedrag",
                    slidebeforechange: "_change",
                    blur: "_change",
                    keyup: "_change"
                }), this._on({ mousedown: "_change" }), this._on(this.element.closest("form"), { reset: "_handleReset" }), this._on(c, { vmousedown: "_dragFirstHandle" })
            }, _handleReset: function () {
                var e = this;
                setTimeout(function () {
                    e._updateHighlight()
                }, 0)
            }, _dragFirstHandle: function (o) {
                return e.data(this._inputFirst.get(0), "mobile-slider").dragging = !0, e.data(this._inputFirst.get(0), "mobile-slider").refresh(o), !1
            }, _slidedrag: function (o) {
                var t = e(o.target).is(this._inputFirst), n = t ? this._inputLast : this._inputFirst;
                return this._sliderTarget = !1, "first" === this._proxy && t || "last" === this._proxy && !t ? (e.data(n.get(0), "mobile-slider").dragging = !0, e.data(n.get(0), "mobile-slider").refresh(o), !1) : void 0
            }, _slidestop: function (o) {
                var t = e(o.target).is(this._inputFirst);
                this._proxy = !1, this.element.find("input").trigger("vmouseup"), this._sliderFirst.css("z-index", t ? 1 : "")
            }, _slidebeforestart: function (o) {
                this._sliderTarget = !1, e(o.originalEvent.target).hasClass("ui-slider-track") && (this._sliderTarget = !0, this._targetVal = e(o.target).val())
            }, _setOptions: function (e) {
                e.theme !== o && this._setTheme(e.theme), e.trackTheme !== o && this._setTrackTheme(e.trackTheme), e.mini !== o && this._setMini(e.mini), e.highlight !== o && this._setHighlight(e.highlight), this._super(e), this.refresh()
            }, refresh: function () {
                var e = this.element, o = this.options;
                (this._inputFirst.is(":disabled") || this._inputLast.is(":disabled")) && (this.options.disabled = !0), e.find("input").slider({
                    theme: o.theme,
                    trackTheme: o.trackTheme,
                    disabled: o.disabled,
                    corners: o.corners,
                    mini: o.mini,
                    highlight: o.highlight
                }).slider("refresh"), this._updateHighlight()
            }, _change: function (o) {
                if ("keyup" === o.type) return this._updateHighlight(), !1;
                var t = this, n = parseFloat(this._inputFirst.val(), 10), i = parseFloat(this._inputLast.val(), 10),
                    a = e(o.target).hasClass("ui-rangeslider-first"), r = a ? this._inputFirst : this._inputLast,
                    s = a ? this._inputLast : this._inputFirst;
                if (this._inputFirst.val() > this._inputLast.val() && "mousedown" === o.type && !e(o.target).hasClass("ui-slider-handle")) r.blur(); else if ("mousedown" === o.type) return;
                return n > i && !this._sliderTarget ? (r.val(a ? i : n).slider("refresh"), this._trigger("normalize")) : n > i && (r.val(this._targetVal).slider("refresh"), setTimeout(function () {
                    s.val(a ? n : i).slider("refresh"), e.data(s.get(0), "mobile-slider").handle.focus(), t._sliderFirst.css("z-index", a ? "" : 1), t._trigger("normalize")
                }, 0), this._proxy = a ? "first" : "last"), n === i ? (e.data(r.get(0), "mobile-slider").handle.css("z-index", 1), e.data(s.get(0), "mobile-slider").handle.css("z-index", 0)) : (e.data(s.get(0), "mobile-slider").handle.css("z-index", ""), e.data(r.get(0), "mobile-slider").handle.css("z-index", "")), this._updateHighlight(), !(n >= i) && void 0
            }, _updateHighlight: function () {
                var o = parseInt(e.data(this._inputFirst.get(0), "mobile-slider").handle.get(0).style.left, 10),
                    t = parseInt(e.data(this._inputLast.get(0), "mobile-slider").handle.get(0).style.left, 10),
                    n = t - o;
                this.element.find(".ui-slider-bg").css({ "margin-left": o + "%", width: n + "%" })
            }, _setTheme: function (e) {
                this._inputFirst.slider("option", "theme", e), this._inputLast.slider("option", "theme", e)
            }, _setTrackTheme: function (e) {
                this._inputFirst.slider("option", "trackTheme", e), this._inputLast.slider("option", "trackTheme", e)
            }, _setMini: function (e) {
                this._inputFirst.slider("option", "mini", e), this._inputLast.slider("option", "mini", e), this.element.toggleClass("ui-mini", !!e)
            }, _setHighlight: function (e) {
                this._inputFirst.slider("option", "highlight", e), this._inputLast.slider("option", "highlight", e)
            }, _destroy: function () {
                this._label.prependTo(this.element), this.element.removeClass("ui-rangeslider ui-mini"), this._inputFirst.after(this._sliderFirst), this._inputLast.after(this._sliderLast), this._sliders.remove(), this.element.find("input").removeClass("ui-rangeslider-first ui-rangeslider-last").slider("destroy")
            }
        }, e.mobile.behaviors.formReset))
    }(e), function (e, o) {
        e.widget("mobile.textinput", e.mobile.textinput, {
            options: { clearBtn: !1, clearBtnText: "Clear text" }, _create: function () {
                this._super(), (this.options.clearBtn || this.isSearch) && this._addClearBtn()
            }, clearButton: function () {
                return e("<a href='#' class='ui-input-clear ui-btn ui-icon-delete ui-btn-icon-notext ui-corner-all' title='" + this.options.clearBtnText + "'>" + this.options.clearBtnText + "</a>")
            }, _clearBtnClick: function (e) {
                this.element.val("").focus().trigger("change"), this._clearBtn.addClass("ui-input-clear-hidden"), e.preventDefault()
            }, _addClearBtn: function () {
                this.options.enhanced || this._enhanceClear(), e.extend(this, { _clearBtn: this.widget().find("a.ui-input-clear") }), this._bindClearEvents(), this._toggleClear()
            }, _enhanceClear: function () {
                this.clearButton().appendTo(this.widget()), this.widget().addClass("ui-input-has-clear")
            }, _bindClearEvents: function () {
                this._on(this._clearBtn, { click: "_clearBtnClick" }), this._on({
                    keyup: "_toggleClear",
                    change: "_toggleClear",
                    input: "_toggleClear",
                    focus: "_toggleClear",
                    blur: "_toggleClear",
                    cut: "_toggleClear",
                    paste: "_toggleClear"
                })
            }, _unbindClear: function () {
                this._off(this._clearBtn, "click"), this._off(this.element, "keyup change input focus blur cut paste")
            }, _setOptions: function (e) {
                this._super(e), e.clearBtn === o || this.element.is("textarea, :jqmData(type='range')") || (e.clearBtn ? this._addClearBtn() : this._destroyClear()), e.clearBtnText !== o && this._clearBtn !== o && this._clearBtn.text(e.clearBtnText).attr("title", e.clearBtnText)
            }, _toggleClear: function () {
                this._delay("_toggleClearClass", 0)
            }, _toggleClearClass: function () {
                this._clearBtn.toggleClass("ui-input-clear-hidden", !this.element.val())
            }, _destroyClear: function () {
                this.widget().removeClass("ui-input-has-clear"), this._unbindClear(), this._clearBtn.remove()
            }, _destroy: function () {
                this._super(), this._destroyClear()
            }
        })
    }(e), function (e, o) {
        e.widget("mobile.textinput", e.mobile.textinput, {
            options: { autogrow: !0, keyupTimeoutBuffer: 100 }, _create: function () {
                this._super(), this.options.autogrow && this.isTextarea && this._autogrow()
            }, _autogrow: function () {
                this.element.addClass("ui-textinput-autogrow"), this._on({
                    keyup: "_timeout",
                    change: "_timeout",
                    input: "_timeout",
                    paste: "_timeout"
                }), this._on(!0, this.document, {
                    pageshow: "_handleShow",
                    popupbeforeposition: "_handleShow",
                    updatelayout: "_handleShow",
                    panelopen: "_handleShow"
                })
            }, _handleShow: function (o) {
                e.contains(o.target, this.element[0]) && this.element.is(":visible") && ("popupbeforeposition" !== o.type && this.element.addClass("ui-textinput-autogrow-resize").animationComplete(e.proxy(function () {
                    this.element.removeClass("ui-textinput-autogrow-resize")
                }, this), "transition"), this._timeout())
            }, _unbindAutogrow: function () {
                this.element.removeClass("ui-textinput-autogrow"), this._off(this.element, "keyup change input paste"), this._off(this.document, "pageshow popupbeforeposition updatelayout panelopen")
            }, keyupTimeout: null, _prepareHeightUpdate: function (e) {
                this.keyupTimeout && clearTimeout(this.keyupTimeout), e === o ? this._updateHeight() : this.keyupTimeout = this._delay("_updateHeight", e)
            }, _timeout: function () {
                this._prepareHeightUpdate(this.options.keyupTimeoutBuffer)
            }, _updateHeight: function () {
                var e, o, t, n, i, a, r, s, l, p = this.window.scrollTop();
                this.keyupTimeout = 0, "onpage" in this.element[0] || this.element.css({
                    height: 0,
                    "min-height": 0,
                    "max-height": 0
                }), n = this.element[0].scrollHeight, i = this.element[0].clientHeight, a = parseFloat(this.element.css("border-top-width")), r = parseFloat(this.element.css("border-bottom-width")), s = a + r, l = n + s + 15, 0 === i && (e = parseFloat(this.element.css("padding-top")), o = parseFloat(this.element.css("padding-bottom")), t = e + o, l += t), this.element.css({
                    height: l,
                    "min-height": "",
                    "max-height": ""
                }), this.window.scrollTop(p)
            }, refresh: function () {
                this.options.autogrow && this.isTextarea && this._updateHeight()
            }, _setOptions: function (e) {
                this._super(e), e.autogrow !== o && this.isTextarea && (e.autogrow ? this._autogrow() : this._unbindAutogrow())
            }
        })
    }(e), function (e) {
        e.widget("mobile.selectmenu", e.extend({
            initSelector: "select:not( :jqmData(role='slider')):not( :jqmData(role='flipswitch') )",
            options: {
                theme: null,
                icon: "carat-d",
                iconpos: "right",
                inline: !1,
                corners: !0,
                shadow: !0,
                iconshadow: !1,
                overlayTheme: null,
                dividerTheme: null,
                hidePlaceholderMenuItems: !0,
                closeText: "Close",
                nativeMenu: !0,
                preventFocusZoom: /iPhone|iPad|iPod/.test(navigator.platform) && navigator.userAgent.indexOf("AppleWebKit") > -1,
                mini: !1
            },
            _button: function () {
                return e("<div/>")
            },
            _setDisabled: function (e) {
                return this.element.attr("disabled", e), this.button.attr("aria-disabled", e), this._setOption("disabled", e)
            },
            _focusButton: function () {
                var e = this;
                setTimeout(function () {
                    e.button.focus()
                }, 40)
            },
            _selectOptions: function () {
                return this.select.find("option")
            },
            _preExtension: function () {
                var o = this.options.inline || this.element.jqmData("inline"),
                    t = this.options.mini || this.element.jqmData("mini"), n = "";
                ~this.element[0].className.indexOf("ui-btn-left") && (n = " ui-btn-left"), ~this.element[0].className.indexOf("ui-btn-right") && (n = " ui-btn-right"), o && (n += " ui-btn-inline"), t && (n += " ui-mini"), this.select = this.element.removeClass("ui-btn-left ui-btn-right").wrap("<div class='ui-select" + n + "'>"), this.selectId = this.select.attr("id") || "select-" + this.uuid, this.buttonId = this.selectId + "-button", this.label = e("label[for='" + this.selectId + "']"), this.isMultiple = this.select[0].multiple
            },
            _destroy: function () {
                var e = this.element.parents(".ui-select");
                e.length > 0 && (e.is(".ui-btn-left, .ui-btn-right") && this.element.addClass(e.hasClass("ui-btn-left") ? "ui-btn-left" : "ui-btn-right"), this.element.insertAfter(e), e.remove())
            },
            _create: function () {
                this._preExtension(), this.button = this._button();
                var t = this, n = this.options, i = !!n.icon && (n.iconpos || this.select.jqmData("iconpos")),
                    a = this.button.insertBefore(this.select).attr("id", this.buttonId).addClass("ui-btn" + (n.icon ? " ui-icon-" + n.icon + " ui-btn-icon-" + i + (n.iconshadow ? " ui-shadow-icon" : "") : "") + (n.theme ? " ui-btn-" + n.theme : "") + (n.corners ? " ui-corner-all" : "") + (n.shadow ? " ui-shadow" : ""));
                this.setButtonText(), n.nativeMenu && o.opera && o.opera.version && a.addClass("ui-select-nativeonly"), this.isMultiple && (this.buttonCount = e("<span>").addClass("ui-li-count ui-body-inherit").hide().appendTo(a.addClass("ui-li-has-count"))), (n.disabled || this.element.attr("disabled")) && this.disable(), this.select.change(function () {
                    t.refresh(), n.nativeMenu && this.blur()
                }), this._handleFormReset(), this._on(this.button, { keydown: "_handleKeydown" }), this.build()
            },
            build: function () {
                var o = this;
                this.select.appendTo(o.button).bind("vmousedown", function () {
                    o.button.addClass(e.mobile.activeBtnClass)
                }).bind("focus", function () {
                    o.button.addClass(e.mobile.focusClass)
                }).bind("blur", function () {
                    o.button.removeClass(e.mobile.focusClass)
                }).bind("focus vmouseover", function () {
                    o.button.trigger("vmouseover")
                }).bind("vmousemove", function () {
                    o.button.removeClass(e.mobile.activeBtnClass)
                }).bind("change blur vmouseout", function () {
                    o.button.trigger("vmouseout").removeClass(e.mobile.activeBtnClass)
                }), o.button.bind("vmousedown", function () {
                    o.options.preventFocusZoom && e.mobile.zoom.disable(!0)
                }), o.label.bind("click focus", function () {
                    o.options.preventFocusZoom && e.mobile.zoom.disable(!0)
                }), o.select.bind("focus", function () {
                    o.options.preventFocusZoom && e.mobile.zoom.disable(!0)
                }), o.button.bind("mouseup", function () {
                    o.options.preventFocusZoom && setTimeout(function () {
                        e.mobile.zoom.enable(!0)
                    }, 0)
                }), o.select.bind("blur", function () {
                    o.options.preventFocusZoom && e.mobile.zoom.enable(!0)
                })
            },
            selected: function () {
                return this._selectOptions().filter(":selected")
            },
            selectedIndices: function () {
                var e = this;
                return this.selected().map(function () {
                    return e._selectOptions().index(this)
                }).get()
            },
            setButtonText: function () {
                var o = this, n = this.selected(), i = this.placeholder, a = e(t.createElement("span"));
                this.button.children("span").not(".ui-li-count").remove().end().end().prepend(function () {
                    return i = n.length ? n.map(function () {
                        return e(this).text()
                    }).get().join(", ") : o.placeholder, i ? a.text(i) : a.html("&#160;"), a.addClass(o.select.attr("class")).addClass(n.attr("class")).removeClass("ui-screen-hidden")
                }())
            },
            setButtonCount: function () {
                var e = this.selected();
                this.isMultiple && this.buttonCount[e.length > 1 ? "show" : "hide"]().text(e.length)
            },
            _handleKeydown: function () {
                this._delay("_refreshButton")
            },
            _reset: function () {
                this.refresh()
            },
            _refreshButton: function () {
                this.setButtonText(), this.setButtonCount()
            },
            refresh: function () {
                this._refreshButton()
            },
            open: e.noop,
            close: e.noop,
            disable: function () {
                this._setDisabled(!0),
                    this.button.addClass("ui-state-disabled")
            },
            enable: function () {
                this._setDisabled(!1), this.button.removeClass("ui-state-disabled")
            }
        }, e.mobile.behaviors.formReset))
    }(e), function (e) {
        e.mobile.links = function (o) {
            e(o).find("a").jqmEnhanceable().filter(":jqmData(rel='popup')[href][href!='']").each(function () {
                var e = this, o = e.getAttribute("href").substring(1);
                o && (e.setAttribute("aria-haspopup", !0), e.setAttribute("aria-owns", o), e.setAttribute("aria-expanded", !1))
            }).end().not(".ui-btn, :jqmData(role='none'), :jqmData(role='nojs')").addClass("ui-link")
        }
    }(e), function (e, t) {
        function n(e, o, t, n) {
            return o > e ? t + (e - o) / 2 : Math.min(Math.max(t, n - o / 2), t + e - o)
        }

        function i(e) {
            return {
                x: e.scrollLeft(),
                y: e.scrollTop(),
                cx: e[0].innerWidth || e.width(),
                cy: e[0].innerHeight || e.height()
            }
        }

        e.widget("mobile.popup", {
            options: {
                wrapperClass: null,
                theme: null,
                overlayTheme: null,
                shadow: !0,
                corners: !0,
                transition: "none",
                positionTo: "origin",
                tolerance: null,
                closeLinkSelector: "a:jqmData(rel='back')",
                closeLinkEvents: "click.popup",
                navigateEvents: "navigate.popup",
                closeEvents: "navigate.popup pagebeforechange.popup",
                dismissible: !0,
                enhanced: !1,
                history: !e.mobile.browser.oldIE
            }, _create: function () {
                var o = this.element, t = o.attr("id"), n = this.options;
                n.history = n.history && e.mobile.ajaxEnabled && e.mobile.hashListeningEnabled, e.extend(this, {
                    _scrollTop: 0,
                    _page: o.closest(".ui-page"),
                    _ui: null,
                    _fallbackTransition: "",
                    _currentTransition: !1,
                    _prerequisites: null,
                    _isOpen: !1,
                    _tolerance: null,
                    _resizeData: null,
                    _ignoreResizeTo: 0,
                    _orientationchangeInProgress: !1
                }), 0 === this._page.length && (this._page = e("body")), n.enhanced ? this._ui = {
                    container: o.parent(),
                    screen: o.parent().prev(),
                    placeholder: e(this.document[0].getElementById(t + "-placeholder"))
                } : (this._ui = this._enhance(o, t), this._applyTransition(n.transition)), this._setTolerance(n.tolerance)._ui.focusElement = this._ui.container, this._on(this._ui.screen, { vclick: "_eatEventAndClose" }), this._on(this.window, {
                    orientationchange: e.proxy(this, "_handleWindowOrientationchange"),
                    resize: e.proxy(this, "_handleWindowResize"),
                    keyup: e.proxy(this, "_handleWindowKeyUp")
                }), this._on(this.document, { focusin: "_handleDocumentFocusIn" })
            }, _enhance: function (o, t) {
                var n = this.options, i = n.wrapperClass, a = {
                    screen: e("<div class='ui-screen-hidden ui-popup-screen " + this._themeClassFromOption("ui-overlay-", n.overlayTheme) + "'></div>"),
                    placeholder: e("<div style='display: none;'>\x3c!-- placeholder --\x3e</div>"),
                    container: e("<div class='ui-popup-container ui-popup-hidden ui-popup-truncate" + (i ? " " + i : "") + "'></div>")
                }, r = this.document[0].createDocumentFragment();
                return r.appendChild(a.screen[0]), r.appendChild(a.container[0]), t && (a.screen.attr("id", t + "-screen"), a.container.attr("id", t + "-popup"), a.placeholder.attr("id", t + "-placeholder").html("\x3c!-- placeholder for " + t + " --\x3e")), this._page[0].appendChild(r), a.placeholder.insertAfter(o), o.detach().addClass("ui-popup " + this._themeClassFromOption("ui-body-", n.theme) + " " + (n.shadow ? "ui-overlay-shadow " : "") + (n.corners ? "ui-corner-all " : "")).appendTo(a.container), a
            }, _eatEventAndClose: function (e) {
                return e.preventDefault(), e.stopImmediatePropagation(), this.options.dismissible && this.close(), !1
            }, _resizeScreen: function () {
                var e = this._ui.screen, o = this._ui.container.outerHeight(!0), t = e.removeAttr("style").height(),
                    n = this.document.height() - 1;
                n > t ? e.height(n) : o > t && e.height(o)
            }, _handleWindowKeyUp: function (o) {
                return this._isOpen && o.keyCode === e.mobile.keyCode.ESCAPE ? this._eatEventAndClose(o) : void 0
            }, _expectResizeEvent: function () {
                var e = i(this.window);
                if (this._resizeData) {
                    if (e.x === this._resizeData.windowCoordinates.x && e.y === this._resizeData.windowCoordinates.y && e.cx === this._resizeData.windowCoordinates.cx && e.cy === this._resizeData.windowCoordinates.cy) return !1;
                    clearTimeout(this._resizeData.timeoutId)
                }
                return this._resizeData = { timeoutId: this._delay("_resizeTimeout", 200), windowCoordinates: e }, !0
            }, _resizeTimeout: function () {
                this._isOpen ? this._expectResizeEvent() || (this._ui.container.hasClass("ui-popup-hidden") && (this._ui.container.removeClass("ui-popup-hidden ui-popup-truncate"), this.reposition({ positionTo: "window" }), this._ignoreResizeEvents()), this._resizeScreen(), this._resizeData = null, this._orientationchangeInProgress = !1) : (this._resizeData = null, this._orientationchangeInProgress = !1)
            }, _stopIgnoringResizeEvents: function () {
                this._ignoreResizeTo = 0
            }, _ignoreResizeEvents: function () {
                this._ignoreResizeTo && clearTimeout(this._ignoreResizeTo), this._ignoreResizeTo = this._delay("_stopIgnoringResizeEvents", 1e3)
            }, _handleWindowResize: function () {
                this._isOpen && 0 === this._ignoreResizeTo && (!this._expectResizeEvent() && !this._orientationchangeInProgress || this._ui.container.hasClass("ui-popup-hidden") || this._ui.container.addClass("ui-popup-hidden ui-popup-truncate").removeAttr("style"))
            }, _handleWindowOrientationchange: function () {
                !this._orientationchangeInProgress && this._isOpen && 0 === this._ignoreResizeTo && (this._expectResizeEvent(), this._orientationchangeInProgress = !0)
            }, _handleDocumentFocusIn: function (o) {
                var t, n = o.target, i = this._ui;
                if (this._isOpen) {
                    if (n !== i.container[0]) {
                        if (t = e(n), 0 === t.parents().filter(i.container[0]).length) return e(this.document[0].activeElement).one("focus", function () {
                            t.blur()
                        }), i.focusElement.focus(), o.preventDefault(), o.stopImmediatePropagation(), !1;
                        i.focusElement[0] === i.container[0] && (i.focusElement = t)
                    }
                    this._ignoreResizeEvents()
                }
            }, _themeClassFromOption: function (e, o) {
                return o ? "none" === o ? "" : e + o : e + "inherit"
            }, _applyTransition: function (o) {
                return o && (this._ui.container.removeClass(this._fallbackTransition), "none" !== o && (this._fallbackTransition = e.mobile._maybeDegradeTransition(o), "none" === this._fallbackTransition && (this._fallbackTransition = ""), this._ui.container.addClass(this._fallbackTransition))), this
            }, _setOptions: function (e) {
                var o = this.options, n = this.element, i = this._ui.screen;
                return e.wrapperClass !== t && this._ui.container.removeClass(o.wrapperClass).addClass(e.wrapperClass), e.theme !== t && n.removeClass(this._themeClassFromOption("ui-body-", o.theme)).addClass(this._themeClassFromOption("ui-body-", e.theme)), e.overlayTheme !== t && (i.removeClass(this._themeClassFromOption("ui-overlay-", o.overlayTheme)).addClass(this._themeClassFromOption("ui-overlay-", e.overlayTheme)), this._isOpen && i.addClass("in")), e.shadow !== t && n.toggleClass("ui-overlay-shadow", e.shadow), e.corners !== t && n.toggleClass("ui-corner-all", e.corners), e.transition !== t && (this._currentTransition || this._applyTransition(e.transition)), e.tolerance !== t && this._setTolerance(e.tolerance), e.disabled !== t && e.disabled && this.close(), this._super(e)
            }, _setTolerance: function (o) {
                var n, i = { t: 30, r: 15, b: 30, l: 15 };
                if (o !== t) switch (n = String(o).split(","), e.each(n, function (e, o) {
                    n[e] = parseInt(o, 10)
                }), n.length) {
                        case 1:
                            isNaN(n[0]) || (i.t = i.r = i.b = i.l = n[0]);
                            break;
                        case 2:
                            isNaN(n[0]) || (i.t = i.b = n[0]), isNaN(n[1]) || (i.l = i.r = n[1]);
                            break;
                        case 4:
                            isNaN(n[0]) || (i.t = n[0]), isNaN(n[1]) || (i.r = n[1]), isNaN(n[2]) || (i.b = n[2]), isNaN(n[3]) || (i.l = n[3])
                    }
                return this._tolerance = i, this
            }, _clampPopupWidth: function (e) {
                var o, t = i(this.window), n = {
                    x: this._tolerance.l,
                    y: t.y + this._tolerance.t,
                    cx: t.cx - this._tolerance.l - this._tolerance.r,
                    cy: t.cy - this._tolerance.t - this._tolerance.b
                };
                return e || this._ui.container.css("max-width", n.cx), o = {
                    cx: this._ui.container.outerWidth(!0),
                    cy: this._ui.container.outerHeight(!0)
                }, { rc: n, menuSize: o }
            }, _calculateFinalLocation: function (e, o) {
                var t, i = o.rc, a = o.menuSize;
                return t = {
                    left: n(i.cx, a.cx, i.x, e.x),
                    top: n(i.cy, a.cy, i.y, e.y)
                }, t.top = Math.max(0, t.top), t.top -= Math.min(t.top, Math.max(0, t.top + a.cy - this.document.height())), t
            }, _placementCoords: function (e) {
                return this._calculateFinalLocation(e, this._clampPopupWidth())
            }, _createPrerequisites: function (o, t, n) {
                var i, a = this;
                i = { screen: e.Deferred(), container: e.Deferred() }, i.screen.then(function () {
                    i === a._prerequisites && o()
                }), i.container.then(function () {
                    i === a._prerequisites && t()
                }), e.when(i.screen, i.container).done(function () {
                    i === a._prerequisites && (a._prerequisites = null, n())
                }), a._prerequisites = i
            }, _animate: function (o) {
                return this._ui.screen.removeClass(o.classToRemove).addClass(o.screenClassToAdd), o.prerequisites.screen.resolve(), o.transition && "none" !== o.transition && (o.applyTransition && this._applyTransition(o.transition), this._fallbackTransition) ? void this._ui.container.addClass(o.containerClassToAdd).removeClass(o.classToRemove).animationComplete(e.proxy(o.prerequisites.container, "resolve")) : (this._ui.container.removeClass(o.classToRemove), void o.prerequisites.container.resolve())
            }, _desiredCoords: function (o) {
                var t, n = null, a = i(this.window), r = o.x, s = o.y, l = o.positionTo;
                if (l && "origin" !== l) if ("window" === l) r = a.cx / 2 + a.x, s = a.cy / 2 + a.y; else {
                    try {
                        n = e(l)
                    } catch (p) {
                        n = null
                    }
                    n && (n.filter(":visible"), 0 === n.length && (n = null))
                }
                return n && (t = n.offset(), r = t.left + n.outerWidth() / 2, s = t.top + n.outerHeight() / 2), ("number" !== e.type(r) || isNaN(r)) && (r = a.cx / 2 + a.x), ("number" !== e.type(s) || isNaN(s)) && (s = a.cy / 2 + a.y), {
                    x: r,
                    y: s
                }
            }, _reposition: function (e) {
                e = {
                    x: e.x,
                    y: e.y,
                    positionTo: e.positionTo
                }, this._trigger("beforeposition", t, e), this._ui.container.offset(this._placementCoords(this._desiredCoords(e)))
            }, reposition: function (e) {
                this._isOpen && this._reposition(e)
            }, _openPrerequisitesComplete: function () {
                var e = this.element.attr("id");
                this._ui.container.addClass("ui-popup-active"), this._isOpen = !0, this._resizeScreen(), this._ui.container.attr("tabindex", "0").focus(), this._ignoreResizeEvents(), e && this.document.find("[aria-haspopup='true'][aria-owns='" + e + "']").attr("aria-expanded", !0), this._trigger("afteropen")
            }, _open: function (o) {
                var t = e.extend({}, this.options, o), n = function () {
                    var e = navigator.userAgent, o = e.match(/AppleWebKit\/([0-9\.]+)/), t = !!o && o[1],
                        n = e.match(/Android (\d+(?:\.\d+))/), i = !!n && n[1], a = e.indexOf("Chrome") > -1;
                    return !(!(null !== n && "4.0" === i && t && t > 534.13) || a)
                }();
                this._createPrerequisites(e.noop, e.noop, e.proxy(this, "_openPrerequisitesComplete")), this._currentTransition = t.transition, this._applyTransition(t.transition), this._ui.screen.removeClass("ui-screen-hidden"), this._ui.container.removeClass("ui-popup-truncate"), this._reposition(t), this._ui.container.removeClass("ui-popup-hidden"), this.options.overlayTheme && n && this.element.closest(".ui-page").addClass("ui-popup-open"), this._animate({
                    additionalCondition: !0,
                    transition: t.transition,
                    classToRemove: "",
                    screenClassToAdd: "in",
                    containerClassToAdd: "in",
                    applyTransition: !1,
                    prerequisites: this._prerequisites
                })
            }, _closePrerequisiteScreen: function () {
                this._ui.screen.removeClass("out").addClass("ui-screen-hidden")
            }, _closePrerequisiteContainer: function () {
                this._ui.container.removeClass("reverse out").addClass("ui-popup-hidden ui-popup-truncate").removeAttr("style")
            }, _closePrerequisitesDone: function () {
                var o = this._ui.container, n = this.element.attr("id");
                o.removeAttr("tabindex"), e.mobile.popup.active = t, e(":focus", o[0]).add(o[0]).blur(), n && this.document.find("[aria-haspopup='true'][aria-owns='" + n + "']").attr("aria-expanded", !1), this._trigger("afterclose")
            }, _close: function (o) {
                this._ui.container.removeClass("ui-popup-active"), this._page.removeClass("ui-popup-open"), this._isOpen = !1, this._createPrerequisites(e.proxy(this, "_closePrerequisiteScreen"), e.proxy(this, "_closePrerequisiteContainer"), e.proxy(this, "_closePrerequisitesDone")), this._animate({
                    additionalCondition: this._ui.screen.hasClass("in"),
                    transition: o ? "none" : this._currentTransition,
                    classToRemove: "in",
                    screenClassToAdd: "out",
                    containerClassToAdd: "reverse out",
                    applyTransition: !0,
                    prerequisites: this._prerequisites
                })
            }, _unenhance: function () {
                this.options.enhanced || (this._setOptions({ theme: e.mobile.popup.prototype.options.theme }), this.element.detach().insertAfter(this._ui.placeholder).removeClass("ui-popup ui-overlay-shadow ui-corner-all ui-body-inherit"), this._ui.screen.remove(), this._ui.container.remove(), this._ui.placeholder.remove())
            }, _destroy: function () {
                return e.mobile.popup.active === this ? (this.element.one("popupafterclose", e.proxy(this, "_unenhance")), this.close()) : this._unenhance(), this
            }, _closePopup: function (t, n) {
                var i, a, r = this.options, s = !1;
                t && t.isDefaultPrevented() || e.mobile.popup.active !== this || (o.scrollTo(0, this._scrollTop), t && "pagebeforechange" === t.type && n && (i = "string" == typeof n.toPage ? n.toPage : n.toPage.jqmData("url"), i = e.mobile.path.parseUrl(i), a = i.pathname + i.search + i.hash, this._myUrl !== e.mobile.path.makeUrlAbsolute(a) ? s = !0 : t.preventDefault()), this.window.off(r.closeEvents), this.element.undelegate(r.closeLinkSelector, r.closeLinkEvents), this._close(s))
            }, _bindContainerClose: function () {
                this.window.on(this.options.closeEvents, e.proxy(this, "_closePopup"))
            }, widget: function () {
                return this._ui.container
            }, open: function (o) {
                var t, n, i, a, r, s = this, l = this.options;
                return e.mobile.popup.active || l.disabled ? this : (e.mobile.popup.active = this, this._scrollTop = this.window.scrollTop(), l.history ? (r = e.mobile.navigate.history, n = e.mobile.dialogHashKey, i = e.mobile.activePage, a = !!i && i.hasClass("ui-dialog"), this._myUrl = t = r.getActive().url, t.indexOf(n) > -1 && !a && r.activeIndex > 0 ? (s._open(o), s._bindContainerClose(), this) : (-1 !== t.indexOf(n) || a ? t = e.mobile.path.parseLocation().hash + n : t += t.indexOf("#") > -1 ? n : "#" + n, 0 === r.activeIndex && t === r.initialDst && (t += n), this.window.one("beforenavigate", function (e) {
                    e.preventDefault(), s._open(o), s._bindContainerClose()
                }), this.urlAltered = !0, e.mobile.navigate(t, { role: "dialog" }), this)) : (s._open(o), s._bindContainerClose(), s.element.delegate(l.closeLinkSelector, l.closeLinkEvents, function (e) {
                    s.close(), e.preventDefault()
                }), this))
            }, close: function () {
                return e.mobile.popup.active !== this ? this : (this._scrollTop = this.window.scrollTop(), this.options.history && this.urlAltered ? (e.mobile.back(), this.urlAltered = !1) : this._closePopup(), this)
            }
        }), e.mobile.popup.handleLink = function (o) {
            var t, n = e.mobile.path, i = e(n.hashToSelector(n.parseUrl(o.attr("href")).hash)).first();
            i.length > 0 && i.data("mobile-popup") && (t = o.offset(), i.popup("open", {
                x: t.left + o.outerWidth() / 2,
                y: t.top + o.outerHeight() / 2,
                transition: o.jqmData("transition"),
                positionTo: o.jqmData("position-to")
            })), setTimeout(function () {
                o.removeClass(e.mobile.activeBtnClass)
            }, 300)
        }, e.mobile.document.on("pagebeforechange", function (o, t) {
            "popup" === t.options.role && (e.mobile.popup.handleLink(t.options.link), o.preventDefault())
        })
    }(e), function (e, o) {
        var n = ".ui-disabled,.ui-state-disabled,.ui-li-divider,.ui-screen-hidden,:jqmData(role='placeholder')",
            i = function (e, o, t) {
                var i = e[t + "All"]().not(n).first();
                i.length && (o.blur().attr("tabindex", "-1"), i.find("a").first().focus())
            };
        e.widget("mobile.selectmenu", e.mobile.selectmenu, {
            _create: function () {
                var e = this.options;
                return e.nativeMenu = e.nativeMenu || this.element.parents(":jqmData(role='popup'),:mobile-popup").length > 0, this._super()
            }, _handleSelectFocus: function () {
                this.element.blur(), this.button.focus()
            }, _handleKeydown: function (e) {
                this._super(e), this._handleButtonVclickKeydown(e)
            }, _handleButtonVclickKeydown: function (o) {
                this.options.disabled || this.isOpen || ("vclick" === o.type || o.keyCode && (o.keyCode === e.mobile.keyCode.ENTER || o.keyCode === e.mobile.keyCode.SPACE)) && (this._decideFormat(), "overlay" === this.menuType ? this.button.attr("href", "#" + this.popupId).attr("data-" + (e.mobile.ns || "") + "rel", "popup") : this.button.attr("href", "#" + this.dialogId).attr("data-" + (e.mobile.ns || "") + "rel", "dialog"), this.isOpen = !0)
            }, _handleListFocus: function (o) {
                var t = "focusin" === o.type ? { tabindex: "0", event: "vmouseover" } : {
                    tabindex: "-1",
                    event: "vmouseout"
                };
                e(o.target).attr("tabindex", t.tabindex).trigger(t.event)
            }, _handleListKeydown: function (o) {
                var t = e(o.target), n = t.closest("li");
                switch (o.keyCode) {
                    case 38:
                        return i(n, t, "prev"), !1;
                    case 40:
                        return i(n, t, "next"), !1;
                    case 13:
                    case 32:
                        return t.trigger("click"), !1
                }
            }, _handleMenuPageHide: function () {
                this.thisPage.page("bindRemove")
            }, _handleHeaderCloseClick: function () {
                return "overlay" === this.menuType ? (this.close(), !1) : void 0
            }, build: function () {
                var t, n, i, a, r, s, l, p, c, u, h, m, g, d, b, _, f, w, v = this.options;
                return v.nativeMenu ? this._super() : (w = this, t = this.selectId, n = t + "-listbox", i = t + "-dialog", a = this.label, r = this.element.closest(".ui-page"), s = this.element[0].multiple, l = t + "-menu", p = v.theme ? " data-" + e.mobile.ns + "theme='" + v.theme + "'" : "", c = v.overlayTheme || v.theme || null, u = c ? " data-" + e.mobile.ns + "overlay-theme='" + c + "'" : "", h = v.dividerTheme && s ? " data-" + e.mobile.ns + "divider-theme='" + v.dividerTheme + "'" : "", m = e("<div data-" + e.mobile.ns + "role='dialog' class='ui-selectmenu' id='" + i + "'" + p + u + "><div data-" + e.mobile.ns + "role='header'><div class='ui-title'>" + a.getEncodedText() + "</div></div><div data-" + e.mobile.ns + "role='content'></div></div>"), g = e("<div id='" + n + "' class='ui-selectmenu'></div>").insertAfter(this.select).popup({ theme: v.overlayTheme }), d = e("<ul class='ui-selectmenu-list' id='" + l + "' role='listbox' aria-labelledby='" + this.buttonId + "'" + p + h + "></ul>").appendTo(g), b = e("<div class='ui-header ui-bar-" + (v.theme ? v.theme : "inherit") + "'></div>").prependTo(g), _ = e("<h1 class='ui-title'></h1>").appendTo(b), this.isMultiple && (f = e("<a>", {
                    role: "button",
                    text: v.closeText,
                    href: "#",
                    "class": "ui-btn ui-corner-all ui-btn-left ui-btn-icon-notext ui-icon-delete"
                }).appendTo(b)), e.extend(this, {
                    selectId: t,
                    menuId: l,
                    popupId: n,
                    dialogId: i,
                    thisPage: r,
                    menuPage: m,
                    label: a,
                    isMultiple: s,
                    theme: v.theme,
                    listbox: g,
                    list: d,
                    header: b,
                    headerTitle: _,
                    headerClose: f,
                    menuPageContent: void 0,
                    menuPageClose: void 0,
                    placeholder: ""
                }), this.refresh(), this._origTabIndex === o && (this._origTabIndex = null !== this.select[0].getAttribute("tabindex") && this.select.attr("tabindex")), this.select.attr("tabindex", "-1"), this._on(this.select, { focus: "_handleSelectFocus" }), this._on(this.button, { vclick: "_handleButtonVclickKeydown" }), this.list.attr("role", "listbox"), this._on(this.list, {
                    focusin: "_handleListFocus",
                    focusout: "_handleListFocus",
                    keydown: "_handleListKeydown"
                }), this.list.delegate("li:not(.ui-disabled,.ui-state-disabled,.ui-li-divider)", "click", function (o) {
                    var t = w.select[0].selectedIndex, n = e.mobile.getAttribute(this, "option-index"),
                        i = w._selectOptions().eq(n)[0];
                    i.selected = !w.isMultiple || !i.selected, w.isMultiple && e(this).find("a").toggleClass("ui-checkbox-on", i.selected).toggleClass("ui-checkbox-off", !i.selected), (w.isMultiple || t !== n) && w.select.trigger("change"), w.isMultiple ? w.list.find("li:not(.ui-li-divider)").eq(n).find("a").first().focus() : w.close(), o.preventDefault()
                }), this._on(this.menuPage, { pagehide: "_handleMenuPageHide" }), this._on(this.listbox, { popupafterclose: "close" }), this.isMultiple && this._on(this.headerClose, { click: "_handleHeaderCloseClick" }), this)
            }, _isRebuildRequired: function () {
                var e = this.list.find("li");
                return this._selectOptions().not(".ui-screen-hidden").text() !== e.text()
            }, selected: function () {
                return this._selectOptions().filter(":selected:not( :jqmData(placeholder='true') )")
            }, refresh: function (o) {
                var t, n;
                return this.options.nativeMenu ? this._super(o) : (t = this, (o || this._isRebuildRequired()) && t._buildList(), n = this.selectedIndices(), t.setButtonText(), t.setButtonCount(), void t.list.find("li:not(.ui-li-divider)").find("a").removeClass(e.mobile.activeBtnClass).end().attr("aria-selected", !1).each(function (o) {
                    if (e.inArray(o, n) > -1) {
                        var i = e(this);
                        i.attr("aria-selected", !0), t.isMultiple ? i.find("a").removeClass("ui-checkbox-off").addClass("ui-checkbox-on") : i.hasClass("ui-screen-hidden") ? i.next().find("a").addClass(e.mobile.activeBtnClass) : i.find("a").addClass(e.mobile.activeBtnClass)
                    }
                }))
            }, close: function () {
                if (!this.options.disabled && this.isOpen) {
                    var e = this;
                    "page" === e.menuType ? (e.menuPage.dialog("close"), e.list.appendTo(e.listbox)) : e.listbox.popup("close"), e._focusButton(), e.isOpen = !1
                }
            }, open: function () {
                this.button.click()
            }, _focusMenuItem: function () {
                var o = this.list.find("a." + e.mobile.activeBtnClass);
                0 === o.length && (o = this.list.find("li:not(" + n + ") a.ui-btn")), o.first().focus()
            }, _decideFormat: function () {
                var o = this, t = this.window, n = o.list.parent(), i = n.outerHeight(), a = t.scrollTop(),
                    r = o.button.offset().top, s = t.height();
                i > s - 80 || !e.support.scrollTop ? (o.menuPage.appendTo(e.mobile.pageContainer).page(), o.menuPageContent = o.menuPage.find(".ui-content"), o.menuPageClose = o.menuPage.find(".ui-header a"), o.thisPage.unbind("pagehide.remove"), 0 === a && r > s && o.thisPage.one("pagehide", function () {
                    e(this).jqmData("lastScroll", r)
                }), o.menuPage.one({
                    pageshow: e.proxy(this, "_focusMenuItem"),
                    pagehide: e.proxy(this, "close")
                }), o.menuType = "page", o.menuPageContent.append(o.list), o.menuPage.find("div .ui-title").text(o.label.text())) : (o.menuType = "overlay", o.listbox.one({ popupafteropen: e.proxy(this, "_focusMenuItem") }))
            }, _buildList: function () {
                var o, n, i, a, r, s, l, p, c, u, h, m, g, d, b = this, _ = this.options, f = this.placeholder, w = !0,
                    v = "data-" + e.mobile.ns, E = v + "option-index", T = v + "icon", P = v + "role",
                    S = v + "placeholder", N = t.createDocumentFragment(), I = !1;
                for (b.list.empty().filter(".ui-listview").listview("destroy"), o = this._selectOptions(), n = o.length, i = this.select[0], r = 0; n > r; r++, I = !1) s = o[r], l = e(s), l.hasClass("ui-screen-hidden") || (p = s.parentNode, c = l.text(), u = t.createElement("a"), h = [], u.setAttribute("href", "#"), u.appendChild(t.createTextNode(c)), p !== i && "optgroup" === p.nodeName.toLowerCase() && (m = p.getAttribute("label")) !== a && (g = t.createElement("li"), g.setAttribute(P, "list-divider"), g.setAttribute("role", "option"), g.setAttribute("tabindex", "-1"), g.appendChild(t.createTextNode(m)), N.appendChild(g), a = m), !w || s.getAttribute("value") && 0 !== c.length && !l.jqmData("placeholder") || (w = !1, I = !0, null === s.getAttribute(S) && (this._removePlaceholderAttr = !0), s.setAttribute(S, !0), _.hidePlaceholderMenuItems && h.push("ui-screen-hidden"), f !== c && (f = b.placeholder = c)), d = t.createElement("li"), s.disabled && (h.push("ui-state-disabled"), d.setAttribute("aria-disabled", !0)), d.setAttribute(E, r), d.setAttribute(T, "false"), I && d.setAttribute(S, !0), d.className = h.join(" "), d.setAttribute("role", "option"), u.setAttribute("tabindex", "-1"), this.isMultiple && e(u).addClass("ui-btn ui-checkbox-off ui-btn-icon-right"), d.appendChild(u), N.appendChild(d));
                b.list[0].appendChild(N), this.isMultiple || f.length ? this.headerTitle.text(this.placeholder) : this.header.addClass("ui-screen-hidden"), b.list.listview()
            }, _button: function () {
                return this.options.nativeMenu ? this._super() : e("<a>", {
                    href: "#",
                    role: "button",
                    id: this.buttonId,
                    "aria-haspopup": "true",
                    "aria-owns": this.menuId
                })
            }, _destroy: function () {
                this.options.nativeMenu || (this.close(), this._origTabIndex !== o && (!1 !== this._origTabIndex ? this.select.attr("tabindex", this._origTabIndex) : this.select.removeAttr("tabindex")), this._removePlaceholderAttr && this._selectOptions().removeAttr("data-" + e.mobile.ns + "placeholder"), this.listbox.remove(), this.menuPage.remove()), this._super()
            }
        })
    }(e), function (e, o) {
        function t(e, o) {
            var t = o || [];
            return t.push("ui-btn"), e.theme && t.push("ui-btn-" + e.theme), e.icon && (t = t.concat(["ui-icon-" + e.icon, "ui-btn-icon-" + e.iconpos]), e.iconshadow && t.push("ui-shadow-icon")), e.inline && t.push("ui-btn-inline"), e.shadow && t.push("ui-shadow"), e.corners && t.push("ui-corner-all"), e.mini && t.push("ui-mini"), t
        }

        function n(e) {
            var t, n, i, r = !1, s = !0, l = { icon: "", inline: !1, shadow: !1, corners: !1, iconshadow: !1, mini: !1 },
                p = [];
            for (e = e.split(" "), t = 0; t < e.length; t++) i = !0, n = a[e[t]], n !== o ? (i = !1, l[n] = !0) : 0 === e[t].indexOf("ui-btn-icon-") ? (i = !1, s = !1, l.iconpos = e[t].substring(12)) : 0 === e[t].indexOf("ui-icon-") ? (i = !1, l.icon = e[t].substring(8)) : 0 === e[t].indexOf("ui-btn-") && 8 === e[t].length ? (i = !1, l.theme = e[t].substring(7)) : "ui-btn" === e[t] && (i = !1, r = !0), i && p.push(e[t]);
            return s && (l.icon = ""), { options: l, unknownClasses: p, alreadyEnhanced: r }
        }

        function i(e) {
            return "-" + e.toLowerCase()
        }

        var a = {
            "ui-shadow": "shadow",
            "ui-corner-all": "corners",
            "ui-btn-inline": "inline",
            "ui-shadow-icon": "iconshadow",
            "ui-mini": "mini"
        }, r = function () {
            var t = e.mobile.getAttribute.apply(this, arguments);
            return null == t ? o : t
        };
        e.fn.buttonMarkup = function (a, s) {
            var l, p, c, u, h, m = e.fn.buttonMarkup.defaults;
            for (l = 0; l < this.length; l++) {
                if (c = this[l], p = s ? {
                    alreadyEnhanced: !1,
                    unknownClasses: []
                } : n(c.className), u = e.extend({}, p.alreadyEnhanced ? p.options : {}, a), !p.alreadyEnhanced) for (h in m) u[h] === o && (u[h] = r(c, h.replace(/[A-Z]/g, i)));
                c.className = t(e.extend({}, m, u), p.unknownClasses).join(" "), "button" !== c.tagName.toLowerCase() && c.setAttribute("role", "button")
            }
            return this
        }, e.fn.buttonMarkup.defaults = {
            icon: "",
            iconpos: "left",
            theme: null,
            inline: !1,
            shadow: !0,
            corners: !0,
            iconshadow: !1,
            mini: !1
        }, e.extend(e.fn.buttonMarkup, { initSelector: "a:jqmData(role='button'), .ui-bar > a, .ui-bar > :jqmData(role='controlgroup') > a, button" })
    }(e), function (e, o) {
        e.widget("mobile.controlgroup", e.extend({
            options: {
                enhanced: !1,
                theme: null,
                shadow: !1,
                corners: !0,
                excludeInvisible: !0,
                type: "vertical",
                mini: !1
            }, _create: function () {
                var o = this.element, t = this.options;
                e.fn.buttonMarkup && this.element.find(e.fn.buttonMarkup.initSelector).buttonMarkup(), e.each(this._childWidgets, e.proxy(function (o, t) {
                    e.mobile[t] && this.element.find(e.mobile[t].initSelector).not(e.mobile.page.prototype.keepNativeSelector())[t]()
                }, this)), e.extend(this, {
                    _ui: null,
                    _initialRefresh: !0
                }), this._ui = t.enhanced ? {
                    groupLegend: o.children(".ui-controlgroup-label").children(),
                    childWrapper: o.children(".ui-controlgroup-controls")
                } : this._enhance()
            }, _childWidgets: ["checkboxradio", "selectmenu", "button"], _themeClassFromOption: function (e) {
                return e ? "none" === e ? "" : "ui-group-theme-" + e : ""
            }, _enhance: function () {
                var o = this.element, t = this.options, n = {
                    groupLegend: o.children("legend"),
                    childWrapper: o.addClass("ui-controlgroup ui-controlgroup-" + ("horizontal" === t.type ? "horizontal" : "vertical") + " " + this._themeClassFromOption(t.theme) + " " + (t.corners ? "ui-corner-all " : "") + (t.mini ? "ui-mini " : "")).wrapInner("<div class='ui-controlgroup-controls " + (!0 === t.shadow ? "ui-shadow" : "") + "'></div>").children()
                };
                return n.groupLegend.length > 0 && e("<div role='heading' class='ui-controlgroup-label'></div>").append(n.groupLegend).prependTo(o), n
            }, _init: function () {
                this.refresh()
            }, _setOptions: function (e) {
                var t, n, i = this.element;
                return e.type !== o && (i.removeClass("ui-controlgroup-horizontal ui-controlgroup-vertical").addClass("ui-controlgroup-" + ("horizontal" === e.type ? "horizontal" : "vertical")), t = !0), e.theme !== o && i.removeClass(this._themeClassFromOption(this.options.theme)).addClass(this._themeClassFromOption(e.theme)), e.corners !== o && i.toggleClass("ui-corner-all", e.corners), e.mini !== o && i.toggleClass("ui-mini", e.mini), e.shadow !== o && this._ui.childWrapper.toggleClass("ui-shadow", e.shadow), e.excludeInvisible !== o && (this.options.excludeInvisible = e.excludeInvisible, t = !0), n = this._super(e), t && this.refresh(), n
            }, container: function () {
                return this._ui.childWrapper
            }, refresh: function () {
                var o = this.container(), t = o.find(".ui-btn").not(".ui-slider-handle"), n = this._initialRefresh;
                e.mobile.checkboxradio && o.find(":mobile-checkboxradio").checkboxradio("refresh"), this._addFirstLastClasses(t, this.options.excludeInvisible ? this._getVisibles(t, n) : t, n), this._initialRefresh = !1
            }, _destroy: function () {
                var e, o, t = this.options;
                return t.enhanced ? this : (e = this._ui, o = this.element.removeClass("ui-controlgroup ui-controlgroup-horizontal ui-controlgroup-vertical ui-corner-all ui-mini " + this._themeClassFromOption(t.theme)).find(".ui-btn").not(".ui-slider-handle"), this._removeFirstLastClasses(o), e.groupLegend.unwrap(), void e.childWrapper.children().unwrap())
            }
        }, e.mobile.behaviors.addFirstLastClasses))
    }(e), function (e, o) {
        e.widget("mobile.toolbar", {
            initSelector: ":jqmData(role='footer'), :jqmData(role='header')",
            options: { theme: null, addBackBtn: !1, backBtnTheme: null, backBtnText: "Back" },
            _create: function () {
                var o = this.element.is(":jqmData(role='header')") ? "header" : "footer",
                    t = this.element.closest(".ui-page");
                0 === t.length && (t = !1, this._on(this.document, { pageshow: "refresh" })), e.extend(this, {
                    role: o,
                    page: t,
                    leftbtn: void 0,
                    rightbtn: void 0
                }), this.element.attr("role", "header" === o ? "banner" : "contentinfo").addClass("ui-" + o), this.refresh(), this._setOptions(this.options)
            },
            _setOptions: function (t) {
                if (t.addBackBtn !== o && (this.options.addBackBtn && "header" === this.role && e(".ui-page").length > 1 && this.page[0].getAttribute("data-" + e.mobile.ns + "url") !== e.mobile.path.stripHash(location.hash) && !this.leftbtn ? this._addBackButton() : this.element.find(".ui-toolbar-back-btn").remove()), null != t.backBtnTheme && this.element.find(".ui-toolbar-back-btn").addClass("ui-btn ui-btn-" + t.backBtnTheme), t.backBtnText !== o && this.element.find(".ui-toolbar-back-btn .ui-btn-text").text(t.backBtnText), t.theme !== o) {
                    var n = this.options.theme ? this.options.theme : "inherit", i = t.theme ? t.theme : "inherit";
                    this.element.removeClass("ui-bar-" + n).addClass("ui-bar-" + i)
                }
                this._super(t)
            },
            refresh: function () {
                "header" === this.role && this._addHeaderButtonClasses(), this.page || (this._setRelative(), "footer" === this.role && this.element.appendTo("body")), this._addHeadingClasses(), this._btnMarkup()
            },
            _setRelative: function () {
                e("[data-" + e.mobile.ns + "role='page']").css({ position: "relative" })
            },
            _btnMarkup: function () {
                this.element.children("a").filter(":not([data-" + e.mobile.ns + "role='none'])").attr("data-" + e.mobile.ns + "role", "button"), this.element.trigger("create")
            },
            _addHeaderButtonClasses: function () {
                var e = this.element.children("a, button");
                this.leftbtn = e.hasClass("ui-btn-left"), this.rightbtn = e.hasClass("ui-btn-right"), this.leftbtn = this.leftbtn || e.eq(0).not(".ui-btn-right").addClass("ui-btn-left").length, this.rightbtn = this.rightbtn || e.eq(1).addClass("ui-btn-right").length
            },
            _addBackButton: function () {
                var o = this.options, t = o.backBtnTheme || o.theme;
                e("<a role='button' href='javascript:void(0);' class='ui-btn ui-corner-all ui-shadow ui-btn-left " + (t ? "ui-btn-" + t + " " : "") + "ui-toolbar-back-btn ui-icon-carat-l ui-btn-icon-left' data-" + e.mobile.ns + "rel='back'>" + o.backBtnText + "</a>").prependTo(this.element)
            },
            _addHeadingClasses: function () {
                this.element.children("h1, h2, h3, h4, h5, h6").addClass("ui-title").attr({
                    role: "heading",
                    "aria-level": "1"
                })
            }
        })
    }(e), function (e, o) {
        e.widget("mobile.toolbar", e.mobile.toolbar, {
            options: {
                position: null,
                visibleOnPageShow: !0,
                disablePageZoom: !0,
                transition: "slide",
                fullscreen: !1,
                tapToggle: !0,
                tapToggleBlacklist: "a, button, input, select, textarea, .ui-header-fixed, .ui-footer-fixed, .ui-flipswitch, .ui-popup, .ui-panel, .ui-panel-dismiss-open",
                hideDuringFocus: "input, textarea, select",
                updatePagePadding: !0,
                trackPersistentToolbars: !0,
                supportBlacklist: function () {
                    return !e.support.fixedPosition
                }
            }, _create: function () {
                this._super(), "fixed" !== this.options.position || this.options.supportBlacklist() || this._makeFixed()
            }, _makeFixed: function () {
                this.element.addClass("ui-" + this.role + "-fixed"), this.updatePagePadding(), this._addTransitionClass(), this._bindPageEvents(), this._bindToggleHandlers()
            }, _setOptions: function (t) {
                if ("fixed" === t.position && "fixed" !== this.options.position && this._makeFixed(), "fixed" === this.options.position && !this.options.supportBlacklist()) {
                    var n = this.page ? this.page : e(".ui-page-active").length > 0 ? e(".ui-page-active") : e(".ui-page").eq(0);
                    t.fullscreen !== o && (t.fullscreen ? (this.element.addClass("ui-" + this.role + "-fullscreen"), n.addClass("ui-page-" + this.role + "-fullscreen")) : (this.element.removeClass("ui-" + this.role + "-fullscreen"), n.removeClass("ui-page-" + this.role + "-fullscreen").addClass("ui-page-" + this.role + "-fixed")))
                }
                this._super(t)
            }, _addTransitionClass: function () {
                var e = this.options.transition;
                e && "none" !== e && ("slide" === e && (e = this.element.hasClass("ui-header") ? "slidedown" : "slideup"), this.element.addClass(e))
            }, _bindPageEvents: function () {
                var e = this.page ? this.element.closest(".ui-page") : this.document;
                this._on(e, {
                    pagebeforeshow: "_handlePageBeforeShow",
                    webkitAnimationStart: "_handleAnimationStart",
                    animationstart: "_handleAnimationStart",
                    updatelayout: "_handleAnimationStart",
                    pageshow: "_handlePageShow",
                    pagebeforehide: "_handlePageBeforeHide"
                })
            }, _handlePageBeforeShow: function () {
                var o = this.options;
                o.disablePageZoom && e.mobile.zoom.disable(!0), o.visibleOnPageShow || this.hide(!0)
            }, _handleAnimationStart: function () {
                this.options.updatePagePadding && this.updatePagePadding(this.page ? this.page : ".ui-page-active")
            }, _handlePageShow: function () {
                this.updatePagePadding(this.page ? this.page : ".ui-page-active"), this.options.updatePagePadding && this._on(this.window, { throttledresize: "updatePagePadding" })
            }, _handlePageBeforeHide: function (o, t) {
                var n, i, a, r, s = this.options;
                s.disablePageZoom && e.mobile.zoom.enable(!0), s.updatePagePadding && this._off(this.window, "throttledresize"), s.trackPersistentToolbars && (n = e(".ui-footer-fixed:jqmData(id)", this.page), i = e(".ui-header-fixed:jqmData(id)", this.page), a = n.length && t.nextPage && e(".ui-footer-fixed:jqmData(id='" + n.jqmData("id") + "')", t.nextPage) || e(), r = i.length && t.nextPage && e(".ui-header-fixed:jqmData(id='" + i.jqmData("id") + "')", t.nextPage) || e(), (a.length || r.length) && (a.add(r).appendTo(e.mobile.pageContainer), t.nextPage.one("pageshow", function () {
                    r.prependTo(this), a.appendTo(this)
                })))
            }, _visible: !0, updatePagePadding: function (t) {
                var n = this.element, i = "header" === this.role, a = parseFloat(n.css(i ? "top" : "bottom"));
                this.options.fullscreen || (t = t && t.type === o && t || this.page || n.closest(".ui-page"), t = this.page ? this.page : ".ui-page-active", e(t).css("padding-" + (i ? "top" : "bottom"), n.outerHeight() + a))
            }, _useTransition: function (o) {
                var t = this.window, n = this.element, i = t.scrollTop(), a = n.height(),
                    r = this.page ? n.closest(".ui-page").height() : e(".ui-page-active").height(),
                    s = e.mobile.getScreenHeight();
                return !o && (this.options.transition && "none" !== this.options.transition && ("header" === this.role && !this.options.fullscreen && i > a || "footer" === this.role && !this.options.fullscreen && r - a > i + s) || this.options.fullscreen)
            }, show: function (e) {
                var o = "ui-fixed-hidden", t = this.element;
                this._useTransition(e) ? t.removeClass("out " + o).addClass("in").animationComplete(function () {
                    t.removeClass("in")
                }) : t.removeClass(o), this._visible = !0
            }, hide: function (e) {
                var o = "ui-fixed-hidden", t = this.element,
                    n = "out" + ("slide" === this.options.transition ? " reverse" : "");
                this._useTransition(e) ? t.addClass(n).removeClass("in").animationComplete(function () {
                    t.addClass(o).removeClass(n)
                }) : t.addClass(o).removeClass(n), this._visible = !1
            }, toggle: function () {
                this[this._visible ? "hide" : "show"]()
            }, _bindToggleHandlers: function () {
                var o, t, n = this, i = n.options, a = !0;
                (this.page ? this.page : e(".ui-page")).bind("vclick", function (o) {
                    i.tapToggle && !e(o.target).closest(i.tapToggleBlacklist).length && n.toggle()
                }).bind("focusin focusout", function (r) {
                    screen.width < 1025 && e(r.target).is(i.hideDuringFocus) && !e(r.target).closest(".ui-header-fixed, .ui-footer-fixed").length && ("focusout" !== r.type || a ? "focusin" === r.type && a && (clearTimeout(o), a = !1, t = setTimeout(function () {
                        n.hide()
                    }, 0)) : (a = !0, clearTimeout(t), o = setTimeout(function () {
                        n.show()
                    }, 0)))
                })
            }, _setRelative: function () {
                "fixed" !== this.options.position && e("[data-" + e.mobile.ns + "role='page']").css({ position: "relative" })
            }, _destroy: function () {
                var e = this.element, o = e.hasClass("ui-header");
                e.closest(".ui-page").css("padding-" + (o ? "top" : "bottom"), ""), e.removeClass("ui-header-fixed ui-footer-fixed ui-header-fullscreen ui-footer-fullscreen in out fade slidedown slideup ui-fixed-hidden"), e.closest(".ui-page").removeClass("ui-page-header-fixed ui-page-footer-fixed ui-page-header-fullscreen ui-page-footer-fullscreen")
            }
        })
    }(e), function (e) {
        e.widget("mobile.toolbar", e.mobile.toolbar, {
            _makeFixed: function () {
                this._super(), this._workarounds()
            }, _workarounds: function () {
                var e = navigator.userAgent, o = navigator.platform, t = e.match(/AppleWebKit\/([0-9]+)/),
                    n = !!t && t[1], i = null, a = this;
                if (o.indexOf("iPhone") > -1 || o.indexOf("iPad") > -1 || o.indexOf("iPod") > -1) i = "ios"; else {
                    if (!(e.indexOf("Android") > -1)) return;
                    i = "android"
                }
                if ("ios" === i) a._bindScrollWorkaround(); else {
                    if (!("android" === i && n && 534 > n)) return;
                    a._bindScrollWorkaround(), a._bindListThumbWorkaround()
                }
            }, _viewportOffset: function () {
                var e = this.element, o = e.hasClass("ui-header"),
                    t = Math.abs(e.offset().top - this.window.scrollTop());
                return o || (t = Math.round(t - this.window.height() + e.outerHeight()) - 60), t
            }, _bindScrollWorkaround: function () {
                var e = this;
                this._on(this.window, {
                    scrollstop: function () {
                        e._viewportOffset() > 2 && e._visible && e._triggerRedraw()
                    }
                })
            }, _bindListThumbWorkaround: function () {
                this.element.closest(".ui-page").addClass("ui-android-2x-fixed")
            }, _triggerRedraw: function () {
                var o = parseFloat(e(".ui-page-active").css("padding-bottom"));
                e(".ui-page-active").css("padding-bottom", o + 1 + "px"), setTimeout(function () {
                    e(".ui-page-active").css("padding-bottom", o + "px")
                }, 0)
            }, destroy: function () {
                this._super(), this.element.closest(".ui-page-active").removeClass("ui-android-2x-fix")
            }
        })
    }(e), function (e, o) {
        function t() {
            var e = i.clone(), o = e.eq(0), t = e.eq(1), n = t.children();
            return { arEls: t.add(o), gd: o, ct: t, ar: n }
        }

        var n = e.mobile.browser.oldIE && e.mobile.browser.oldIE <= 8,
            i = e("<div class='ui-popup-arrow-guide'></div><div class='ui-popup-arrow-container" + (n ? " ie" : "") + "'><div class='ui-popup-arrow'></div></div>");
        e.widget("mobile.popup", e.mobile.popup, {
            options: { arrow: "" }, _create: function () {
                var e = this._super();
                return this.options.arrow && (this._ui.arrow = this._addArrow()), e
            }, _addArrow: function () {
                var e, o = this.options, n = t();
                return e = this._themeClassFromOption("ui-body-", o.theme), n.ar.addClass(e + (o.shadow ? " ui-overlay-shadow" : "")), n.arEls.hide().appendTo(this.element), n
            }, _unenhance: function () {
                var e = this._ui.arrow;
                return e && e.arEls.remove(), this._super()
            }, _tryAnArrow: function (e, o, t, n, i) {
                var a, r, s, l = {}, p = {};
                return n.arFull[e.dimKey] > n.guideDims[e.dimKey] ? i : (l[e.fst] = t[e.fst] + (n.arHalf[e.oDimKey] + n.menuHalf[e.oDimKey]) * e.offsetFactor - n.contentBox[e.fst] + (n.clampInfo.menuSize[e.oDimKey] - n.contentBox[e.oDimKey]) * e.arrowOffsetFactor, l[e.snd] = t[e.snd], a = n.result || this._calculateFinalLocation(l, n.clampInfo), r = {
                    x: a.left,
                    y: a.top
                }, p[e.fst] = r[e.fst] + n.contentBox[e.fst] + e.tipOffset, p[e.snd] = Math.max(a[e.prop] + n.guideOffset[e.prop] + n.arHalf[e.dimKey], Math.min(a[e.prop] + n.guideOffset[e.prop] + n.guideDims[e.dimKey] - n.arHalf[e.dimKey], t[e.snd])), s = Math.abs(t.x - p.x) + Math.abs(t.y - p.y), (!i || s < i.diff) && (p[e.snd] -= n.arHalf[e.dimKey] + a[e.prop] + n.contentBox[e.snd], i = {
                    dir: o,
                    diff: s,
                    result: a,
                    posProp: e.prop,
                    posVal: p[e.snd]
                }), i)
            }, _getPlacementState: function (e) {
                var o, t, n = this._ui.arrow, i = {
                    clampInfo: this._clampPopupWidth(!e),
                    arFull: { cx: n.ct.width(), cy: n.ct.height() },
                    guideDims: { cx: n.gd.width(), cy: n.gd.height() },
                    guideOffset: n.gd.offset()
                };
                return o = this.element.offset(), n.gd.css({
                    left: 0,
                    top: 0,
                    right: 0,
                    bottom: 0
                }), t = n.gd.offset(), i.contentBox = {
                    x: t.left - o.left,
                    y: t.top - o.top,
                    cx: n.gd.width(),
                    cy: n.gd.height()
                }, n.gd.removeAttr("style"), i.guideOffset = {
                    left: i.guideOffset.left - o.left,
                    top: i.guideOffset.top - o.top
                }, i.arHalf = { cx: i.arFull.cx / 2, cy: i.arFull.cy / 2 }, i.menuHalf = {
                    cx: i.clampInfo.menuSize.cx / 2,
                    cy: i.clampInfo.menuSize.cy / 2
                }, i
            }, _placementCoords: function (o) {
                var t, i, a, r, s, l = this.options.arrow, p = this._ui.arrow;
                return p ? (p.arEls.show(), s = {}, t = this._getPlacementState(!0), a = {
                    l: {
                        fst: "x",
                        snd: "y",
                        prop: "top",
                        dimKey: "cy",
                        oDimKey: "cx",
                        offsetFactor: 1,
                        tipOffset: -t.arHalf.cx,
                        arrowOffsetFactor: 0
                    },
                    r: {
                        fst: "x",
                        snd: "y",
                        prop: "top",
                        dimKey: "cy",
                        oDimKey: "cx",
                        offsetFactor: -1,
                        tipOffset: t.arHalf.cx + t.contentBox.cx,
                        arrowOffsetFactor: 1
                    },
                    b: {
                        fst: "y",
                        snd: "x",
                        prop: "left",
                        dimKey: "cx",
                        oDimKey: "cy",
                        offsetFactor: -1,
                        tipOffset: t.arHalf.cy + t.contentBox.cy,
                        arrowOffsetFactor: 1
                    },
                    t: {
                        fst: "y",
                        snd: "x",
                        prop: "left",
                        dimKey: "cx",
                        oDimKey: "cy",
                        offsetFactor: 1,
                        tipOffset: -t.arHalf.cy,
                        arrowOffsetFactor: 0
                    }
                }, e.each((!0 === l ? "l,t,r,b" : l).split(","), e.proxy(function (e, n) {
                    i = this._tryAnArrow(a[n], n, o, t, i)
                }, this)), i ? (p.ct.removeClass("ui-popup-arrow-l ui-popup-arrow-t ui-popup-arrow-r ui-popup-arrow-b").addClass("ui-popup-arrow-" + i.dir).removeAttr("style").css(i.posProp, i.posVal).show(), n || (r = this.element.offset(), s[a[i.dir].fst] = p.ct.offset(), s[a[i.dir].snd] = {
                    left: r.left + t.contentBox.x,
                    top: r.top + t.contentBox.y
                }), i.result) : (p.arEls.hide(), this._super(o))) : this._super(o)
            }, _setOptions: function (e) {
                var t, n = this.options.theme, i = this._ui.arrow, a = this._super(e);
                if (e.arrow !== o) {
                    if (!i && e.arrow) return void (this._ui.arrow = this._addArrow());
                    i && !e.arrow && (i.arEls.remove(), this._ui.arrow = null)
                }
                return i = this._ui.arrow, i && (e.theme !== o && (n = this._themeClassFromOption("ui-body-", n), t = this._themeClassFromOption("ui-body-", e.theme), i.ar.removeClass(n).addClass(t)), e.shadow !== o && i.ar.toggleClass("ui-overlay-shadow", e.shadow)), a
            }, _destroy: function () {
                var e = this._ui.arrow;
                return e && e.arEls.remove(), this._super()
            }
        })
    }(e), function (e, t) {
        e.widget("mobile.panel", {
            options: {
                classes: {
                    panel: "ui-panel",
                    panelOpen: "ui-panel-open",
                    panelClosed: "ui-panel-closed",
                    panelFixed: "ui-panel-fixed",
                    panelInner: "ui-panel-inner",
                    modal: "ui-panel-dismiss",
                    modalOpen: "ui-panel-dismiss-open",
                    pageContainer: "ui-panel-page-container",
                    pageWrapper: "ui-panel-wrapper",
                    pageFixedToolbar: "ui-panel-fixed-toolbar",
                    pageContentPrefix: "ui-panel-page-content",
                    animate: "ui-panel-animate"
                },
                animate: !0,
                theme: null,
                position: "left",
                dismissible: !0,
                display: "reveal",
                swipeClose: !0,
                positionFixed: !1
            },
            _closeLink: null,
            _parentPage: null,
            _page: null,
            _modal: null,
            _panelInner: null,
            _wrapper: null,
            _fixedToolbars: null,
            _create: function () {
                var o = this.element, t = o.closest(".ui-page, :jqmData(role='page')");
                e.extend(this, {
                    _closeLink: o.find(":jqmData(rel='close')"),
                    _parentPage: t.length > 0 && t,
                    _openedPage: null,
                    _page: this._getPage,
                    _panelInner: this._getPanelInner(),
                    _fixedToolbars: this._getFixedToolbars
                }), "overlay" !== this.options.display && this._getWrapper(), this._addPanelClasses(), e.support.cssTransform3d && this.options.animate && this.element.addClass(this.options.classes.animate), this._bindUpdateLayout(), this._bindCloseEvents(), this._bindLinkListeners(), this._bindPageEvents(), this.options.dismissible && this._createModal(), this._bindSwipeEvents()
            },
            _getPanelInner: function () {
                var e = this.element.find("." + this.options.classes.panelInner);
                return 0 === e.length && (e = this.element.children().wrapAll("<div class='" + this.options.classes.panelInner + "' />").parent()), e
            },
            _createModal: function () {
                var o = this, t = o._parentPage ? o._parentPage.parent() : o.element.parent();
                o._modal = e("<div class='" + o.options.classes.modal + "'></div>").on("mousedown", function () {
                    o.close()
                }).appendTo(t)
            },
            _getPage: function () {
                return this._openedPage || this._parentPage || e("." + e.mobile.activePageClass)
            },
            _getWrapper: function () {
                var e = this._page().find("." + this.options.classes.pageWrapper);
                0 === e.length && (e = this._page().children(".ui-header:not(.ui-header-fixed), .ui-content:not(.ui-popup), .ui-footer:not(.ui-footer-fixed)").wrapAll("<div class='" + this.options.classes.pageWrapper + "'></div>").parent()), this._wrapper = e
            },
            _getFixedToolbars: function () {
                var o = e("body").children(".ui-header-fixed, .ui-footer-fixed"),
                    t = this._page().find(".ui-header-fixed, .ui-footer-fixed");
                return o.add(t).addClass(this.options.classes.pageFixedToolbar)
            },
            _getPosDisplayClasses: function (e) {
                return e + "-position-" + this.options.position + " " + e + "-display-" + this.options.display
            },
            _getPanelClasses: function () {
                var e = this.options.classes.panel + " " + this._getPosDisplayClasses(this.options.classes.panel) + " " + this.options.classes.panelClosed + " ui-body-" + (this.options.theme ? this.options.theme : "inherit");
                return this.options.positionFixed && (e += " " + this.options.classes.panelFixed), e
            },
            _addPanelClasses: function () {
                this.element.addClass(this._getPanelClasses())
            },
            _handleCloseClickAndEatEvent: function (e) {
                return e.isDefaultPrevented() ? void 0 : (e.preventDefault(), this.close(), !1)
            },
            _handleCloseClick: function (e) {
                e.isDefaultPrevented() || this.close()
            },
            _bindCloseEvents: function () {
                this._on(this._closeLink, { click: "_handleCloseClick" }), this._on({ "click a:jqmData(ajax='false')": "_handleCloseClick" })
            },
            _positionPanel: function (o) {
                var t = this, n = t._panelInner.outerHeight(), i = n > e.mobile.getScreenHeight();
                i || !t.options.positionFixed ? (i && (t._unfixPanel(), e.mobile.resetActivePageHeight(n)), o && this.window[0].scrollTo(0, e.mobile.defaultHomeScroll)) : t._fixPanel()
            },
            _bindFixListener: function () {
                this._on(e(o), { throttledresize: "_positionPanel" })
            },
            _unbindFixListener: function () {
                this._off(e(o), "throttledresize")
            },
            _unfixPanel: function () {
                this.options.positionFixed && e.support.fixedPosition && this.element.removeClass(this.options.classes.panelFixed)
            },
            _fixPanel: function () {
                this.options.positionFixed && e.support.fixedPosition && this.element.addClass(this.options.classes.panelFixed)
            },
            _bindUpdateLayout: function () {
                var e = this;
                e.element.on("updatelayout", function () {
                    e._open && e._positionPanel()
                })
            },
            _bindLinkListeners: function () {
                this._on("body", { "click a": "_handleClick" })
            },
            _handleClick: function (o) {
                var t, n = this.element.attr("id");
                return o.currentTarget.href.split("#")[1] === n && void 0 !== n ? (o.preventDefault(), t = e(o.target), t.hasClass("ui-btn") && (t.addClass(e.mobile.activeBtnClass), this.element.one("panelopen panelclose", function () {
                    t.removeClass(e.mobile.activeBtnClass)
                })), this.toggle(), !1) : void 0
            },
            _bindSwipeEvents: function () {
                var e = this, o = e._modal ? e.element.add(e._modal) : e.element;
                e.options.swipeClose && ("left" === e.options.position ? o.on("swipeleft.panel", function () {
                    e.close()
                }) : o.on("swiperight.panel", function () {
                    e.close()
                }))
            },
            _bindPageEvents: function () {
                var e = this;
                this.document.on("panelbeforeopen", function (o) {
                    e._open && o.target !== e.element[0] && e.close()
                }).on("keyup.panel", function (o) {
                    27 === o.keyCode && e._open && e.close()
                }), this._parentPage || "overlay" === this.options.display || this._on(this.document, { pageshow: "_getWrapper" }), e._parentPage ? this.document.on("pagehide", ":jqmData(role='page')", function () {
                    e._open && e.close(!0)
                }) : this.document.on("pagebeforehide", function () {
                    e._open && e.close(!0)
                })
            },
            _open: !1,
            _pageContentOpenClasses: null,
            _modalOpenClasses: null,
            open: function (o) {
                if (!this._open) {
                    var t = this, n = t.options, i = function () {
                        t.document.off("panelclose"), t._page().jqmData("panel", "open"), e.support.cssTransform3d && n.animate && "overlay" !== n.display && (t._wrapper.addClass(n.classes.animate), t._fixedToolbars().addClass(n.classes.animate)), !o && e.support.cssTransform3d && n.animate ? t.element.animationComplete(a, "transition") : setTimeout(a, 0), n.theme && "overlay" !== n.display && t._page().parent().addClass(n.classes.pageContainer + "-themed " + n.classes.pageContainer + "-" + n.theme), t.element.removeClass(n.classes.panelClosed).addClass(n.classes.panelOpen), t._positionPanel(!0), t._pageContentOpenClasses = t._getPosDisplayClasses(n.classes.pageContentPrefix), "overlay" !== n.display && (t._page().parent().addClass(n.classes.pageContainer), t._wrapper.addClass(t._pageContentOpenClasses), t._fixedToolbars().addClass(t._pageContentOpenClasses)), t._modalOpenClasses = t._getPosDisplayClasses(n.classes.modal) + " " + n.classes.modalOpen, t._modal && t._modal.addClass(t._modalOpenClasses).height(Math.max(t._modal.height(), t.document.height()))
                    }, a = function () {
                        "overlay" !== n.display && (t._wrapper.addClass(n.classes.pageContentPrefix + "-open"), t._fixedToolbars().addClass(n.classes.pageContentPrefix + "-open")), t._bindFixListener(), t._trigger("open"), t._openedPage = t._page()
                    };
                    t._trigger("beforeopen"), "open" === t._page().jqmData("panel") ? t.document.on("panelclose", function () {
                        i()
                    }) : i(), t._open = !0
                }
            },
            close: function (o) {
                if (this._open) {
                    var t = this, n = this.options, i = function () {
                        n.theme && "overlay" !== n.display && t._page().parent().removeClass(n.classes.pageContainer + "-themed " + n.classes.pageContainer + "-" + n.theme), t.element.addClass(n.classes.panelClosed), "overlay" !== n.display && (t._page().parent().removeClass(n.classes.pageContainer), t._wrapper.removeClass(n.classes.pageContentPrefix + "-open"), t._fixedToolbars().removeClass(n.classes.pageContentPrefix + "-open")), e.support.cssTransform3d && n.animate && "overlay" !== n.display && (t._wrapper.removeClass(n.classes.animate), t._fixedToolbars().removeClass(n.classes.animate)), t._fixPanel(), t._unbindFixListener(), e.mobile.resetActivePageHeight(), t._page().jqmRemoveData("panel"), t._trigger("close"), t._openedPage = null
                    };
                    t._trigger("beforeclose"), function () {
                        t.element.removeClass(n.classes.panelOpen), "overlay" !== n.display && (t._wrapper.removeClass(t._pageContentOpenClasses), t._fixedToolbars().removeClass(t._pageContentOpenClasses)), !o && e.support.cssTransform3d && n.animate ? t.element.animationComplete(i, "transition") : setTimeout(i, 0), t._modal && t._modal.removeClass(t._modalOpenClasses)
                    }(), t._open = !1
                }
            },
            toggle: function () {
                this[this._open ? "close" : "open"]()
            },
            _destroy: function () {
                var o, t = this.options,
                    n = e("body > :mobile-panel").length + e.mobile.activePage.find(":mobile-panel").length > 1;
                "overlay" !== t.display && (o = e("body > :mobile-panel").add(e.mobile.activePage.find(":mobile-panel")), 0 === o.not(".ui-panel-display-overlay").not(this.element).length && this._wrapper.children().unwrap(), this._open && (this._fixedToolbars().removeClass(t.classes.pageContentPrefix + "-open"), e.support.cssTransform3d && t.animate && this._fixedToolbars().removeClass(t.classes.animate), this._page().parent().removeClass(t.classes.pageContainer), t.theme && this._page().parent().removeClass(t.classes.pageContainer + "-themed " + t.classes.pageContainer + "-" + t.theme))), n || this.document.off("panelopen panelclose"), this._open && this._page().jqmRemoveData("panel"), this._panelInner.children().unwrap(), this.element.removeClass([this._getPanelClasses(), t.classes.panelOpen, t.classes.animate].join(" ")).off("swipeleft.panel swiperight.panel").off("panelbeforeopen").off("panelhide").off("keyup.panel").off("updatelayout"), this._modal && this._modal.remove()
            }
        })
    }(e), function (e, o) {
        e.widget("mobile.table", {
            options: { classes: { table: "ui-table" }, enhanced: !1 }, _create: function () {
                this.options.enhanced || this.element.addClass(this.options.classes.table), e.extend(this, {
                    headers: o,
                    allHeaders: o
                }), this._refresh(!0)
            }, _setHeaders: function () {
                var e = this.element.find("thead tr");
                this.headers = this.element.find("tr:eq(0)").children(), this.allHeaders = this.headers.add(e.children())
            }, refresh: function () {
                this._refresh()
            }, rebuild: e.noop, _refresh: function () {
                var o = this.element, t = o.find("thead tr");
                this._setHeaders(), t.each(function () {
                    var n = 0;
                    e(this).children().each(function () {
                        var i, a = parseInt(this.getAttribute("colspan"), 10), r = ":nth-child(" + (n + 1) + ")";
                        if (this.setAttribute("data-" + e.mobile.ns + "colstart", n + 1), a) for (i = 0; a - 1 > i; i++) n++, r += ", :nth-child(" + (n + 1) + ")";
                        e(this).jqmData("cells", o.find("tr").not(t.eq(0)).not(this).children(r)), n++
                    })
                })
            }
        })
    }(e), function (e) {
        e.widget("mobile.table", e.mobile.table, {
            options: {
                mode: "columntoggle",
                columnBtnTheme: null,
                columnPopupTheme: null,
                columnBtnText: "Columns...",
                classes: e.extend(e.mobile.table.prototype.options.classes, {
                    popup: "ui-table-columntoggle-popup",
                    columnBtn: "ui-table-columntoggle-btn",
                    priorityPrefix: "ui-table-priority-",
                    columnToggleTable: "ui-table-columntoggle"
                })
            }, _create: function () {
                this._super(), "columntoggle" === this.options.mode && (e.extend(this, { _menu: null }), this.options.enhanced ? (this._menu = e(this.document[0].getElementById(this._id() + "-popup")).children().first(), this._addToggles(this._menu, !0)) : (this._menu = this._enhanceColToggle(), this.element.addClass(this.options.classes.columnToggleTable)), this._setupEvents(), this._setToggleState())
            }, _id: function () {
                return this.element.attr("id") || this.widgetName + this.uuid
            }, _setupEvents: function () {
                this._on(this.window, { throttledresize: "_setToggleState" }), this._on(this._menu, { "change input": "_menuInputChange" })
            }, _addToggles: function (o, t) {
                var n, i = 0, a = this.options, r = o.controlgroup("container");
                t ? n = o.find("input") : r.empty(), this.headers.not("td").each(function () {
                    var o = e(this), s = e.mobile.getAttribute(this, "priority"), l = o.add(o.jqmData("cells"));
                    s && (l.addClass(a.classes.priorityPrefix + s), (t ? n.eq(i++) : e("<label><input type='checkbox' checked />" + (o.children("abbr").first().attr("title") || o.text()) + "</label>").appendTo(r).children(0).checkboxradio({ theme: a.columnPopupTheme })).jqmData("cells", l))
                }), t || o.controlgroup("refresh")
            }, _menuInputChange: function (o) {
                var t = e(o.target), n = t[0].checked;
                t.jqmData("cells").toggleClass("ui-table-cell-hidden", !n).toggleClass("ui-table-cell-visible", n), t[0].getAttribute("locked") ? (t.removeAttr("locked"), this._unlockCells(t.jqmData("cells"))) : t.attr("locked", !0)
            }, _unlockCells: function (e) {
                e.removeClass("ui-table-cell-hidden ui-table-cell-visible")
            }, _enhanceColToggle: function () {
                var o, t, n, i, a = this.element, r = this.options, s = e.mobile.ns,
                    l = this.document[0].createDocumentFragment();
                return o = this._id() + "-popup", t = e("<a href='#" + o + "' class='" + r.classes.columnBtn + " ui-btn ui-btn-" + (r.columnBtnTheme || "a") + " ui-corner-all ui-shadow ui-mini' data-" + s + "rel='popup'>" + r.columnBtnText + "</a>"), n = e("<div class='" + r.classes.popup + "' id='" + o + "'></div>"), i = e("<fieldset></fieldset>").controlgroup(), this._addToggles(i, !1), i.appendTo(n), l.appendChild(n[0]), l.appendChild(t[0]), a.before(l), n.popup(), i
            }, rebuild: function () {
                this._super(), "columntoggle" === this.options.mode && this._refresh(!1)
            }, _refresh: function (e) {
                this._super(e), e || "columntoggle" !== this.options.mode || (this._unlockCells(this.element.find(".ui-table-cell-hidden, .ui-table-cell-visible")), this._addToggles(this._menu, e), this._setToggleState())
            }, _setToggleState: function () {
                this._menu.find("input").each(function () {
                    var o = e(this);
                    this.checked = "table-cell" === o.jqmData("cells").eq(0).css("display"), o.checkboxradio("refresh")
                })
            }, _destroy: function () {
                this._super()
            }
        })
    }(e), function (e) {
        e.widget("mobile.table", e.mobile.table, {
            options: {
                mode: "reflow",
                classes: e.extend(e.mobile.table.prototype.options.classes, {
                    reflowTable: "ui-table-reflow",
                    cellLabels: "ui-table-cell-label"
                })
            }, _create: function () {
                this._super(), "reflow" === this.options.mode && (this.options.enhanced || (this.element.addClass(this.options.classes.reflowTable), this._updateReflow()))
            }, rebuild: function () {
                this._super(), "reflow" === this.options.mode && this._refresh(!1)
            }, _refresh: function (e) {
                this._super(e), e || "reflow" !== this.options.mode || this._updateReflow()
            }, _updateReflow: function () {
                var o = this, t = this.options;
                e(o.allHeaders.get().reverse()).each(function () {
                    var n, i, a = e(this).jqmData("cells"), r = e.mobile.getAttribute(this, "colstart"),
                        s = a.not(this).filter("thead th").length && " ui-table-cell-label-top", l = e(this).text();
                    "" !== l && (s ? (n = parseInt(this.getAttribute("colspan"), 10), i = "", n && (i = "td:nth-child(" + n + "n + " + r + ")"), o._addLabels(a.filter(i), t.classes.cellLabels + s, l)) : o._addLabels(a, t.classes.cellLabels, l))
                })
            }, _addLabels: function (e, o, t) {
                e.not(":has(b." + o + ")").prepend("<b class='" + o + "'>" + t + "</b>")
            }
        })
    }(e), function (e, t) {
        var n = function (o, t) {
            return -1 === ("" + (e.mobile.getAttribute(this, "filtertext") || e(this).text())).toLowerCase().indexOf(t)
        };
        e.widget("mobile.filterable", {
            initSelector: ":jqmData(filter='true')",
            options: {
                filterReveal: !1,
                filterCallback: n,
                enhanced: !1,
                input: null,
                children: "> li, > option, > optgroup option, > tbody tr, > .ui-controlgroup-controls > .ui-btn, > .ui-controlgroup-controls > .ui-checkbox, > .ui-controlgroup-controls > .ui-radio"
            },
            _create: function () {
                var o = this.options;
                e.extend(this, {
                    _search: null,
                    _timer: 0
                }), this._setInput(o.input), o.enhanced || this._filterItems((this._search && this._search.val() || "").toLowerCase())
            },
            _onKeyUp: function () {
                var t, n, i = this._search;
                if (i) {
                    if (t = i.val().toLowerCase(), (n = e.mobile.getAttribute(i[0], "lastval") + "") && n === t) return;
                    this._timer && (o.clearTimeout(this._timer), this._timer = 0), this._timer = this._delay(function () {
                        this._trigger("beforefilter", null, { input: i }), i[0].setAttribute("data-" + e.mobile.ns + "lastval", t), this._filterItems(t), this._timer = 0
                    }, 250)
                }
            },
            _getFilterableItems: function () {
                var o = this.element, t = this.options.children,
                    n = t ? e.isFunction(t) ? t() : t.nodeName ? e(t) : t.jquery ? t : this.element.find(t) : { length: 0 };
                return 0 === n.length && (n = o.children()), n
            },
            _filterItems: function (o) {
                var t, i, a, r, s = [], l = [], p = this.options, c = this._getFilterableItems();
                if (null != o) for (i = p.filterCallback || n, a = c.length, t = 0; a > t; t++) r = i.call(c[t], t, o) ? l : s, r.push(c[t]);
                0 === l.length ? c[p.filterReveal ? "addClass" : "removeClass"]("ui-screen-hidden") : (e(l).addClass("ui-screen-hidden"), e(s).removeClass("ui-screen-hidden")), this._refreshChildWidget(), this._trigger("filter", null, { items: c })
            },
            _refreshChildWidget: function () {
                var o, t, n = ["collapsibleset", "selectmenu", "controlgroup", "listview"];
                for (t = n.length - 1; t > -1; t--) o = n[t], e.mobile[o] && (o = this.element.data("mobile-" + o)) && e.isFunction(o.refresh) && o.refresh()
            },
            _setInput: function (t) {
                var n = this._search;
                this._timer && (o.clearTimeout(this._timer), this._timer = 0), n && (this._off(n, "keyup change input"), n = null), t && (n = t.jquery ? t : t.nodeName ? e(t) : this.document.find(t), this._on(n, {
                    keyup: "_onKeyUp",
                    change: "_onKeyUp",
                    input: "_onKeyUp"
                })), this._search = n
            },
            _setOptions: function (e) {
                var o = !(e.filterReveal === t && e.filterCallback === t && e.children === t);
                this._super(e), e.input !== t && (this._setInput(e.input), o = !0), o && this.refresh()
            },
            _destroy: function () {
                var e = this.options, o = this._getFilterableItems();
                e.enhanced ? o.toggleClass("ui-screen-hidden", e.filterReveal) : o.removeClass("ui-screen-hidden")
            },
            refresh: function () {
                this._timer && (o.clearTimeout(this._timer), this._timer = 0), this._filterItems((this._search && this._search.val() || "").toLowerCase())
            }
        })
    }(e), function (e, o) {
        var t = function (e, o) {
            return function (t) {
                o.call(this, t), e._syncTextInputOptions(t)
            }
        }, n = e.mobile.filterable.prototype.options.filterCallback;
        e.mobile.filterable.prototype.options.filterCallback = function (e, o) {
            return !this.className.match(/(^|\s)ui-li-divider(\s|$)/) && n.call(this, e, o)
        }, e.widget("mobile.filterable", e.mobile.filterable, {
            options: { filterPlaceholder: "Filter items...", filterTheme: null }, _create: function () {
                var o, t, n = this.element, i = ["collapsibleset", "selectmenu", "controlgroup", "listview"], a = {};
                for (this._super(), e.extend(this, { _widget: null }), o = i.length - 1; o > -1; o--) if (t = i[o], e.mobile[t]) {
                    if (this._setWidget(n.data("mobile-" + t))) break;
                    a[t + "create"] = "_handleCreate"
                }
                this._widget || this._on(n, a)
            }, _handleCreate: function (e) {
                this._setWidget(this.element.data("mobile-" + e.type.substring(0, e.type.length - 6)))
            }, _trigger: function (e, o, t) {
                this._widget && "mobile-listview" === this._widget.widgetFullName && "beforefilter" === e && this._widget._trigger("beforefilter", o, t), this._super(e, o, t)
            }, _setWidget: function (e) {
                return !this._widget && e && (this._widget = e, this._widget._setOptions = t(this, this._widget._setOptions)), this._widget && (this._syncTextInputOptions(this._widget.options), "listview" === this._widget.widgetName && (this._widget.options.hideDividers = !0, this._widget.element.listview("refresh"))), !!this._widget
            }, _isSearchInternal: function () {
                return this._search && this._search.jqmData("ui-filterable-" + this.uuid + "-internal")
            }, _setInput: function (o) {
                var t = this.options, n = !0, i = {};
                if (!o) {
                    if (this._isSearchInternal()) return;
                    n = !1, o = e("<input data-" + e.mobile.ns + "type='search' placeholder='" + t.filterPlaceholder + "'></input>").jqmData("ui-filterable-" + this.uuid + "-internal", !0), e("<form class='ui-filterable'></form>").append(o).submit(function (e) {
                        e.preventDefault(), o.blur()
                    }).insertBefore(this.element), e.mobile.textinput && (null != this.options.filterTheme && (i.theme = t.filterTheme), o.textinput(i))
                }
                this._super(o), this._isSearchInternal() && n && this._search.attr("placeholder", this.options.filterPlaceholder)
            }, _setOptions: function (t) {
                var n = this._super(t);
                return t.filterPlaceholder !== o && this._isSearchInternal() && this._search.attr("placeholder", t.filterPlaceholder), t.filterTheme !== o && this._search && e.mobile.textinput && this._search.textinput("option", "theme", t.filterTheme), n
            }, _destroy: function () {
                this._isSearchInternal() && this._search.remove(), this._super()
            }, _syncTextInputOptions: function (t) {
                var n, i = {};
                if (this._isSearchInternal() && e.mobile.textinput) {
                    for (n in e.mobile.textinput.prototype.options) t[n] !== o && (i[n] = "theme" === n && null != this.options.filterTheme ? this.options.filterTheme : t[n]);
                    this._search.textinput("option", i)
                }
            }
        })
    }(e), function (e, o) {
        function t() {
            return ++i
        }

        function n(e) {
            return e.hash.length > 1 && decodeURIComponent(e.href.replace(a, "")) === decodeURIComponent(location.href.replace(a, ""))
        }

        var i = 0, a = /#.*$/;
        e.widget("ui.tabs", {
            version: "fadf2b312a05040436451c64bbfaf4814bc62c56",
            delay: 300,
            options: {
                active: null,
                collapsible: !1,
                event: "click",
                heightStyle: "content",
                hide: null,
                show: null,
                activate: null,
                beforeActivate: null,
                beforeLoad: null,
                load: null
            },
            _create: function () {
                var o = this, t = this.options;
                this.running = !1, this.element.addClass("ui-tabs ui-widget ui-widget-content ui-corner-all").toggleClass("ui-tabs-collapsible", t.collapsible).delegate(".ui-tabs-nav > li", "mousedown" + this.eventNamespace, function (o) {
                    e(this).is(".ui-state-disabled") && o.preventDefault()
                }).delegate(".ui-tabs-anchor", "focus" + this.eventNamespace, function () {
                    e(this).closest("li").is(".ui-state-disabled") && this.blur()
                }), this._processTabs(), t.active = this._initialActive(), e.isArray(t.disabled) && (t.disabled = e.unique(t.disabled.concat(e.map(this.tabs.filter(".ui-state-disabled"), function (e) {
                    return o.tabs.index(e)
                }))).sort()), this.active = !1 !== this.options.active && this.anchors.length ? this._findActive(t.active) : e(), this._refresh(), this.active.length && this.load(t.active)
            },
            _initialActive: function () {
                var o = this.options.active, t = this.options.collapsible, n = location.hash.substring(1);
                return null === o && (n && this.tabs.each(function (t, i) {
                    return e(i).attr("aria-controls") === n ? (o = t, !1) : void 0
                }), null === o && (o = this.tabs.index(this.tabs.filter(".ui-tabs-active"))), (null === o || -1 === o) && (o = !!this.tabs.length && 0)), !1 !== o && -1 === (o = this.tabs.index(this.tabs.eq(o))) && (o = !t && 0), !t && !1 === o && this.anchors.length && (o = 0), o
            },
            _getCreateEventData: function () {
                return { tab: this.active, panel: this.active.length ? this._getPanelForTab(this.active) : e() }
            },
            _tabKeydown: function (o) {
                var t = e(this.document[0].activeElement).closest("li"), n = this.tabs.index(t), i = !0;
                if (!this._handlePageNav(o)) {
                    switch (o.keyCode) {
                        case e.ui.keyCode.RIGHT:
                        case e.ui.keyCode.DOWN:
                            n++;
                            break;
                        case e.ui.keyCode.UP:
                        case e.ui.keyCode.LEFT:
                            i = !1, n--;
                            break;
                        case e.ui.keyCode.END:
                            n = this.anchors.length - 1;
                            break;
                        case e.ui.keyCode.HOME:
                            n = 0;
                            break;
                        case e.ui.keyCode.SPACE:
                            return o.preventDefault(), clearTimeout(this.activating), void this._activate(n);
                        case e.ui.keyCode.ENTER:
                            return o.preventDefault(), clearTimeout(this.activating), void this._activate(n !== this.options.active && n);
                        default:
                            return
                    }
                    o.preventDefault(), clearTimeout(this.activating), n = this._focusNextTab(n, i), o.ctrlKey || (t.attr("aria-selected", "false"), this.tabs.eq(n).attr("aria-selected", "true"), this.activating = this._delay(function () {
                        this.option("active", n)
                    }, this.delay))
                }
            },
            _panelKeydown: function (o) {
                this._handlePageNav(o) || o.ctrlKey && o.keyCode === e.ui.keyCode.UP && (o.preventDefault(), this.active.focus())
            },
            _handlePageNav: function (o) {
                return o.altKey && o.keyCode === e.ui.keyCode.PAGE_UP ? (this._activate(this._focusNextTab(this.options.active - 1, !1)), !0) : o.altKey && o.keyCode === e.ui.keyCode.PAGE_DOWN ? (this._activate(this._focusNextTab(this.options.active + 1, !0)), !0) : void 0
            },
            _findNextTab: function (o, t) {
                for (var n = this.tabs.length - 1; -1 !== e.inArray(function () {
                    return o > n && (o = 0), 0 > o && (o = n), o
                }(), this.options.disabled);) o = t ? o + 1 : o - 1;
                return o
            },
            _focusNextTab: function (e, o) {
                return e = this._findNextTab(e, o), this.tabs.eq(e).focus(), e
            },
            _setOption: function (e, o) {
                return "active" === e ? void this._activate(o) : "disabled" === e ? void this._setupDisabled(o) : (this._super(e, o), "collapsible" === e && (this.element.toggleClass("ui-tabs-collapsible", o), o || !1 !== this.options.active || this._activate(0)), "event" === e && this._setupEvents(o), void ("heightStyle" === e && this._setupHeightStyle(o)))
            },
            _tabId: function (e) {
                return e.attr("aria-controls") || "ui-tabs-" + t()
            },
            _sanitizeSelector: function (e) {
                return e ? e.replace(/[!"$%&'()*+,.\/:;<=>?@\[\]\^`{|}~]/g, "\\$&") : ""
            },
            refresh: function () {
                var o = this.options, t = this.tablist.children(":has(a[href])");
                o.disabled = e.map(t.filter(".ui-state-disabled"), function (e) {
                    return t.index(e)
                }), this._processTabs(), !1 !== o.active && this.anchors.length ? this.active.length && !e.contains(this.tablist[0], this.active[0]) ? this.tabs.length === o.disabled.length ? (o.active = !1, this.active = e()) : this._activate(this._findNextTab(Math.max(0, o.active - 1), !1)) : o.active = this.tabs.index(this.active) : (o.active = !1, this.active = e()), this._refresh()
            },
            _refresh: function () {
                this._setupDisabled(this.options.disabled), this._setupEvents(this.options.event), this._setupHeightStyle(this.options.heightStyle), this.tabs.not(this.active).attr({
                    "aria-selected": "false",
                    tabIndex: -1
                }), this.panels.not(this._getPanelForTab(this.active)).hide().attr({
                    "aria-expanded": "false",
                    "aria-hidden": "true"
                }), this.active.length ? (this.active.addClass("ui-tabs-active ui-state-active").attr({
                    "aria-selected": "true",
                    tabIndex: 0
                }), this._getPanelForTab(this.active).show().attr({
                    "aria-expanded": "true",
                    "aria-hidden": "false"
                })) : this.tabs.eq(0).attr("tabIndex", 0)
            },
            _processTabs: function () {
                var o = this;
                this.tablist = this._getList().addClass("ui-tabs-nav ui-helper-reset ui-helper-clearfix ui-widget-header ui-corner-all").attr("role", "tablist"), this.tabs = this.tablist.find("> li:has(a[href])").addClass("ui-state-default ui-corner-top").attr({
                    role: "tab",
                    tabIndex: -1
                }), this.anchors = this.tabs.map(function () {
                    return e("a", this)[0]
                }).addClass("ui-tabs-anchor").attr({
                    role: "presentation",
                    tabIndex: -1
                }), this.panels = e(), this.anchors.each(function (t, i) {
                    var a, r, s, l = e(i).uniqueId().attr("id"), p = e(i).closest("li"), c = p.attr("aria-controls");
                    n(i) ? (a = i.hash, r = o.element.find(o._sanitizeSelector(a))) : (s = o._tabId(p), a = "#" + s, r = o.element.find(a), r.length || (r = o._createPanel(s), r.insertAfter(o.panels[t - 1] || o.tablist)), r.attr("aria-live", "polite")), r.length && (o.panels = o.panels.add(r)), c && p.data("ui-tabs-aria-controls", c), p.attr({
                        "aria-controls": a.substring(1),
                        "aria-labelledby": l
                    }), r.attr("aria-labelledby", l)
                }), this.panels.addClass("ui-tabs-panel ui-widget-content ui-corner-bottom").attr("role", "tabpanel")
            },
            _getList: function () {
                return this.element.find("ol,ul").eq(0)
            },
            _createPanel: function (o) {
                return e("<div>").attr("id", o).addClass("ui-tabs-panel ui-widget-content ui-corner-bottom").data("ui-tabs-destroy", !0)
            },
            _setupDisabled: function (o) {
                e.isArray(o) && (o.length ? o.length === this.anchors.length && (o = !0) : o = !1);
                for (var t, n = 0; t = this.tabs[n]; n++) !0 === o || -1 !== e.inArray(n, o) ? e(t).addClass("ui-state-disabled").attr("aria-disabled", "true") : e(t).removeClass("ui-state-disabled").removeAttr("aria-disabled");
                this.options.disabled = o
            },
            _setupEvents: function (o) {
                var t = {
                    click: function (e) {
                        e.preventDefault()
                    }
                };
                o && e.each(o.split(" "), function (e, o) {
                    t[o] = "_eventHandler"
                }), this._off(this.anchors.add(this.tabs).add(this.panels)), this._on(this.anchors, t), this._on(this.tabs, { keydown: "_tabKeydown" }), this._on(this.panels, { keydown: "_panelKeydown" }), this._focusable(this.tabs), this._hoverable(this.tabs)
            },
            _setupHeightStyle: function (o) {
                var t, n = this.element.parent();
                "fill" === o ? (t = n.height(), t -= this.element.outerHeight() - this.element.height(), this.element.siblings(":visible").each(function () {
                    var o = e(this), n = o.css("position");
                    "absolute" !== n && "fixed" !== n && (t -= o.outerHeight(!0))
                }), this.element.children().not(this.panels).each(function () {
                    t -= e(this).outerHeight(!0)
                }), this.panels.each(function () {
                    e(this).height(Math.max(0, t - e(this).innerHeight() + e(this).height()))
                }).css("overflow", "auto")) : "auto" === o && (t = 0, this.panels.each(function () {
                    t = Math.max(t, e(this).height("").height())
                }).height(t))
            },
            _eventHandler: function (o) {
                var t = this.options, n = this.active, i = e(o.currentTarget), a = i.closest("li"), r = a[0] === n[0],
                    s = r && t.collapsible, l = s ? e() : this._getPanelForTab(a),
                    p = n.length ? this._getPanelForTab(n) : e(),
                    c = { oldTab: n, oldPanel: p, newTab: s ? e() : a, newPanel: l };
                o.preventDefault(), a.hasClass("ui-state-disabled") || a.hasClass("ui-tabs-loading") || this.running || r && !t.collapsible || !1 === this._trigger("beforeActivate", o, c) || (t.active = !s && this.tabs.index(a), this.active = r ? e() : a, this.xhr && this.xhr.abort(), p.length || l.length || e.error("jQuery UI Tabs: Mismatching fragment identifier."), l.length && this.load(this.tabs.index(a), o), this._toggle(o, c))
            },
            _toggle: function (o, t) {
                function n() {
                    a.running = !1, a._trigger("activate", o, t)
                }

                function i() {
                    t.newTab.closest("li").addClass("ui-tabs-active ui-state-active"), r.length && a.options.show ? a._show(r, a.options.show, n) : (r.show(), n())
                }

                var a = this, r = t.newPanel, s = t.oldPanel;
                this.running = !0, s.length && this.options.hide ? this._hide(s, this.options.hide, function () {
                    t.oldTab.closest("li").removeClass("ui-tabs-active ui-state-active"), i()
                }) : (t.oldTab.closest("li").removeClass("ui-tabs-active ui-state-active"), s.hide(), i()), s.attr({
                    "aria-expanded": "false",
                    "aria-hidden": "true"
                }), t.oldTab.attr("aria-selected", "false"), r.length && s.length ? t.oldTab.attr("tabIndex", -1) : r.length && this.tabs.filter(function () {
                    return 0 === e(this).attr("tabIndex")
                }).attr("tabIndex", -1), r.attr({
                    "aria-expanded": "true",
                    "aria-hidden": "false"
                }), t.newTab.attr({ "aria-selected": "true", tabIndex: 0 })
            },
            _activate: function (o) {
                var t, n = this._findActive(o);
                n[0] !== this.active[0] && (n.length || (n = this.active), t = n.find(".ui-tabs-anchor")[0], this._eventHandler({
                    target: t,
                    currentTarget: t,
                    preventDefault: e.noop
                }))
            },
            _findActive: function (o) {
                return !1 === o ? e() : this.tabs.eq(o)
            },
            _getIndex: function (e) {
                return "string" == typeof e && (e = this.anchors.index(this.anchors.filter("[href$='" + e + "']"))), e
            },
            _destroy: function () {
                this.xhr && this.xhr.abort(), this.element.removeClass("ui-tabs ui-widget ui-widget-content ui-corner-all ui-tabs-collapsible"), this.tablist.removeClass("ui-tabs-nav ui-helper-reset ui-helper-clearfix ui-widget-header ui-corner-all").removeAttr("role"), this.anchors.removeClass("ui-tabs-anchor").removeAttr("role").removeAttr("tabIndex").removeUniqueId(), this.tabs.add(this.panels).each(function () {
                    e.data(this, "ui-tabs-destroy") ? e(this).remove() : e(this).removeClass("ui-state-default ui-state-active ui-state-disabled ui-corner-top ui-corner-bottom ui-widget-content ui-tabs-active ui-tabs-panel").removeAttr("tabIndex").removeAttr("aria-live").removeAttr("aria-busy").removeAttr("aria-selected").removeAttr("aria-labelledby").removeAttr("aria-hidden").removeAttr("aria-expanded").removeAttr("role")
                }), this.tabs.each(function () {
                    var o = e(this), t = o.data("ui-tabs-aria-controls");
                    t ? o.attr("aria-controls", t).removeData("ui-tabs-aria-controls") : o.removeAttr("aria-controls")
                }), this.panels.show(), "content" !== this.options.heightStyle && this.panels.css("height", "")
            },
            enable: function (t) {
                var n = this.options.disabled;
                !1 !== n && (t === o ? n = !1 : (t = this._getIndex(t), n = e.isArray(n) ? e.map(n, function (e) {
                    return e !== t ? e : null
                }) : e.map(this.tabs, function (e, o) {
                    return o !== t ? o : null
                })), this._setupDisabled(n))
            },
            disable: function (t) {
                var n = this.options.disabled;
                if (!0 !== n) {
                    if (t === o) n = !0; else {
                        if (t = this._getIndex(t), -1 !== e.inArray(t, n)) return;
                        n = e.isArray(n) ? e.merge([t], n).sort() : [t]
                    }
                    this._setupDisabled(n)
                }
            },
            load: function (o, t) {
                o = this._getIndex(o);
                var i = this, a = this.tabs.eq(o), r = a.find(".ui-tabs-anchor"), s = this._getPanelForTab(a),
                    l = { tab: a, panel: s };
                n(r[0]) || (this.xhr = e.ajax(this._ajaxSettings(r, t, l)), this.xhr && "canceled" !== this.xhr.statusText && (a.addClass("ui-tabs-loading"), s.attr("aria-busy", "true"), this.xhr.success(function (e) {
                    setTimeout(function () {
                        s.html(e), i._trigger("load", t, l)
                    }, 1)
                }).complete(function (e, o) {
                    setTimeout(function () {
                        "abort" === o && i.panels.stop(!1, !0), a.removeClass("ui-tabs-loading"), s.removeAttr("aria-busy"), e === i.xhr && delete i.xhr
                    }, 1)
                })))
            },
            _ajaxSettings: function (o, t, n) {
                var i = this;
                return {
                    url: o.attr("href"), beforeSend: function (o, a) {
                        return i._trigger("beforeLoad", t, e.extend({ jqXHR: o, ajaxSettings: a }, n))
                    }
                }
            },
            _getPanelForTab: function (o) {
                var t = e(o).attr("aria-controls");
                return this.element.find(this._sanitizeSelector("#" + t))
            }
        })
    }(e), function (e, o) {
        function t(e) {
            i = e.originalEvent, l = i.accelerationIncludingGravity, a = Math.abs(l.x), r = Math.abs(l.y), s = Math.abs(l.z), !o.orientation && (a > 7 || (s > 6 && 8 > r || 8 > s && r > 6) && a > 5) ? n.enabled && n.disable() : n.enabled || n.enable()
        }

        e.mobile.iosorientationfixEnabled = !0;
        var n, i, a, r, s, l, p = navigator.userAgent;
        /iPhone|iPad|iPod/.test(navigator.platform) && /OS [1-5]_[0-9_]* like Mac OS X/i.test(p) && p.indexOf("AppleWebKit") > -1 ? (n = e.mobile.zoom, e.mobile.document.on("mobileinit", function () {
            e.mobile.iosorientationfixEnabled && e.mobile.window.bind("orientationchange.iosorientationfix", n.enable).bind("devicemotion.iosorientationfix", t)
        })) : e.mobile.iosorientationfixEnabled = !1
    }(e, this), function (e, o) {
        function n() {
            i.removeClass("ui-mobile-rendering")
        }

        var i = e("html"), a = e.mobile.window;
        e(o.document).trigger("mobileinit"), e.mobile.gradeA() && (e.mobile.ajaxBlacklist && (e.mobile.ajaxEnabled = !1), i.addClass("ui-mobile ui-mobile-rendering"), setTimeout(n, 5e3), e.extend(e.mobile, {
            initializePage: function () {
                var o = e.mobile.path, i = e(":jqmData(role='page'), :jqmData(role='dialog')"),
                    r = o.stripHash(o.stripQueryParams(o.parseLocation().hash));
                r && r.length > 0 && (h = t.getElementById(r)), i.length || (i = e("body").wrapInner("<div data-" + e.mobile.ns + "role='page'></div>").children(0)), i.each(function () {
                    var o = e(this);
                    o[0].getAttribute("data-" + e.mobile.ns + "url") || o.attr("data-" + e.mobile.ns + "url", o.attr("id") || location.pathname + location.search)
                }), e.mobile.firstPage = i.first(), e.mobile.pageContainer = e.mobile.firstPage.parent().addClass("ui-mobile-viewport").pagecontainer(), e.mobile.navreadyDeferred.resolve(), a.trigger("pagecontainercreate"), e.mobile.loading("show"), n(), e.mobile.hashListeningEnabled && e.mobile.path.isHashValid(location.hash) && (e(h).is(":jqmData(role='page')") || e.mobile.path.isPath(r) || r === e.mobile.dialogHashKey) ? e.event.special.navigate.isPushStateEnabled() ? (e.mobile.navigate.history.stack = [], e.mobile.navigate(e.mobile.path.isPath(location.hash) ? location.hash : location.href)) : a.trigger("hashchange", [!0]) : (e.mobile.path.isHashValid(location.hash) && (e.mobile.navigate.history.initialDst = r.replace("#", "")), e.event.special.navigate.isPushStateEnabled() && e.mobile.navigate.navigator.squash(o.parseLocation().href), e.mobile.changePage(e.mobile.firstPage, {
                    transition: "none",
                    reverse: !0,
                    changeHash: !1,
                    fromHashChange: !0
                }))
            }
        }), e(function () {
            e.support.inlineSVG(), e.mobile.hideUrlBar && o.scrollTo(0, 1), e.mobile.defaultHomeScroll = e.support.scrollTop && 1 !== e.mobile.window.scrollTop() ? 1 : 0, e.mobile.autoInitializePage && e.mobile.initializePage(), e.mobile.hideUrlBar && a.load(e.mobile.silentScroll), e.support.cssPointerEvents || e.mobile.document.delegate(".ui-state-disabled,.ui-disabled", "vclick", function (e) {
                e.preventDefault(), e.stopImmediatePropagation()
            })
        }))
    }(e, this)
}), webphone_api.webrtcapi = function () {
    function JsObjecSniffer(e, o, t) {
        if (void 0 === e) return void console.log("josniffer obj is undefine");
        if (null === e) return void console.log("josniffer obj is NULL");
        console.log("=========== JsObjecSniffer ============="), void 0 !== o && null !== o || (o = 0), -1 === o && (o = 100);
        var n = e;
        for (var i in n) {
            !0 === t && "function" == typeof n[i] || console.log("[josniffer] " + i + ": " + n[i]);
            var a = "", r = "", s = "", l = "", p = "", c = "", u = "", h = "", m = "", g = "", d = "", b = "", _ = "",
                f = "", w = "", v = null, E = null, T = null, P = null, S = null, N = null, I = null, C = null,
                R = null, y = null, L = null, D = null, G = null, O = null, x = null;
            if (null !== n && "undefined" != typeof n[i] && null !== n[i] && (v = n[i], o > 0 && null !== v && "object" == typeof v)) for (var a in v) if (!0 === t && "function" == typeof v[a] || console.log("[josniffer] " + i + " - " + a + ": " + v[a]), null !== v && "undefined" != typeof v[a] && null !== v[a] && (E = v[a], o > 1 && null !== E && "object" == typeof E)) for (var r in E) if (!0 === t && "function" == typeof E[r] || console.log("[josniffer] " + i + " - " + a + " - " + r + ": " + E[r]), null !== E && "undefined" != typeof E[r] && null !== E[r] && (T = E[r], o > 2 && null !== T && "object" == typeof T)) for (var s in T) if (!0 === t && "function" == typeof T[s] || console.log("[josniffer] " + i + " - " + a + " - " + r + " - " + s + ": " + T[s]), null !== T && "undefined" != typeof T[s] && null !== T[s] && (P = T[s], o > 3 && null !== P && "object" == typeof P)) for (var l in P) if (!0 === t && "function" == typeof P[l] || console.log("[josniffer] " + i + " - " + a + " - " + r + " - " + s + " - " + l + ": " + P[l]), null !== P && "undefined" != typeof P[l] && null !== P[l] && (S = P[l], o > 4 && null !== S && "object" == typeof S)) for (var p in S) if (!0 === t && "function" == typeof S[p] || console.log("[josniffer] " + i + " - " + a + " - " + r + " - " + s + " - " + l + " - " + p + ": " + S[p]), null !== S && "undefined" != typeof S[p] && null !== S[p] && (N = S[p], o > 5 && null !== N && "object" == typeof N)) for (var c in N) if (!0 === t && "function" == typeof N[c] || console.log("[josniffer] " + i + " - " + a + " - " + r + " - " + s + " - " + l + " - " + p + " - " + c + ": " + N[c]), null !== N && "undefined" != typeof N[c] && null !== N[c] && (I = N[c], o > 6 && null !== I && "object" == typeof I)) for (var u in I) if (!0 === t && "function" == typeof I[u] || console.log("[josniffer] " + i + " - " + a + " - " + r + " - " + s + " - " + l + " - " + p + " - " + c + " - " + u + ": " + I[u]), null !== I && "undefined" != typeof I[u] && null !== I[u] && (C = I[u], o > 7 && null !== C && "object" == typeof C)) for (var h in C) if (!0 === t && "function" == typeof C[h] || console.log("[josniffer] " + i + " - " + a + " - " + r + " - " + s + " - " + l + " - " + p + " - " + c + " - " + u + " - " + h + ": " + C[h]), null !== C && "undefined" != typeof C[h] && null !== C[h] && (R = C[h], o > 8 && null !== R && "object" == typeof R)) for (var m in R) if (!0 === t && "function" == typeof R[m] || console.log("[josniffer] " + i + " - " + a + " - " + r + " - " + s + " - " + l + " - " + p + " - " + c + " - " + u + " - " + h + " - " + m + ": " + R[m]), null !== R && "undefined" != typeof R[m] && null !== R[m] && (y = R[m], o > 9 && null !== y && "object" == typeof y)) for (var g in y) if (console.log("[josniffer] " + i + " - " + a + " - " + r + " - " + s + " - " + l + " - " + p + " - " + c + " - " + u + " - " + h + " - " + m + " - " + g + ": " + y[g]), null !== y && "undefined" != typeof y[g] && null !== y[g] && (L = y[g], o > 10 && null !== L && "object" == typeof L)) for (var d in L) if (console.log("[josniffer] " + i + " - " + a + " - " + r + " - " + s + " - " + l + " - " + p + " - " + c + " - " + u + " - " + h + " - " + m + " - " + g + " - " + d + ": " + L[d]), null !== L && "undefined" != typeof L[d] && null !== L[d] && (D = L[d], o > 11 && null !== D && "object" == typeof D)) for (var b in D) if (console.log("[josniffer] " + i + " - " + a + " - " + r + " - " + s + " - " + l + " - " + p + " - " + c + " - " + u + " - " + h + " - " + m + " - " + g + " - " + d + " - " + b + ": " + D[b]), null !== D && "undefined" != typeof D[b] && null !== D[b] && (G = D[b], o > 12 && null !== G && "object" == typeof G)) for (var _ in G) if (console.log("[josniffer] " + i + " - " + a + " - " + r + " - " + a + " - " + l + " - " + p + " - " + c + " - " + u + " - " + h + " - " + m + " - " + g + " - " + d + " - " + b + " - " + _ + ": " + G[_]), null !== G && "undefined" != typeof G[_] && null !== G[_] && (O = G[_], o > 13 && null !== O && "object" == typeof O)) for (var f in O) if (console.log("[josniffer] " + i + " - " + a + " - " + r + " - " + s + " - " + l + " - " + p + " - " + c + " - " + u + " - " + h + " - " + m + " - " + g + " - " + d + " - " + b + " - " + _ + " - " + f + ": " + O[f]), null !== O && "undefined" != typeof O[f] && null !== O[f] && (x = O[f], o > 14 && null !== x && "object" == typeof x)) for (var w in x) console.log("[josniffer] " + i + " - " + a + " - " + r + " - " + s + " - " + l + " - " + p + " - " + c + " - " + u + " - " + h + " - " + m + " - " + g + " - " + d + " - " + b + " - " + _ + " - " + f + " - " + w + ": " + x[w])
        }
        console.log("=========== End JsObjecSniffer =============")
    }

    function WebRtcIsSupported(e) {
        try {
            if (!e || "function" != typeof e) return void webphone_api.common.PutToDebugLog(2, "ERROR, webrtcapi: WebRtcIsSupported callback is NULL");
            var o = document.getElementById("dtmfTone"), t = document.getElementById("justbeep_1");
            webphone_api.common.isNull(o) && webphone_api.$(document.body).append('<audio id="dtmfTone" src="' + webphone_api.getbasedir2() + 'sound/rtc_dtmf.wav" ></audio>'), webphone_api.common.isNull(t) && webphone_api.$(document.body).append('<audio id="justbeep_1" src="' + webphone_api.getbasedir2() + 'sound/beep-01.wav" ></audio>');
            var n = !1;
            window.WebSocket && (n = !0);
            var i = !1;
            (navigator.getUserMedia || navigator.webkitGetUserMedia || navigator.mozGetUserMedia || navigator.msGetUserMedia) && (i = !0);
            var a = !1;
            return window.RTCPeerConnection && (a = !0), !0 === n && !0 === i && !0 === a ? (e(!0), !0) : (webphone_api.common.PutToDebugLog(2, "EVENT, WebRtcIsSupported: WebRTC not supported: wssuport: " + n + "; gumSupport: " + i + "; peerconSupport: " + a), e(!1), !1)
        } catch (r) {
            webphone_api.common.PutToDebugLogException(2, "webrtcapi: WebRtcIsSupported", r);
            try {
                e(!1)
            } catch (r) {
            }
        }
    }

    function LoadScript(e, o, t) {
        try {
            if (!o || "function" != typeof o) return void webphone_api.common.PutToDebugLog(2, "ERROR, webrtcapi: LoadScript success callback NOT set");
            if (!t || "function" != typeof t) return void webphone_api.common.PutToDebugLog(2, "ERROR, webrtcapi: LoadScript error callback NOT set");
            "undefined" != typeof webphone_api.jscodeversion && null !== webphone_api.jscodeversion && webphone_api.jscodeversion.length > 0 && e.indexOf("jscodeversion=") < 0 && (e = e.indexOf("?") > 0 ? e + "&jscodeversion=" + webphone_api.jscodeversion.toString() : e + "?jscodeversion=" + webphone_api.jscodeversion.toString()), webphone_api.$.ajax({
                url: e,
                dataType: "script",
                method: "GET",
                timeout: 8e3,
                success: o,
                error: t,
                async: !0
            })
        } catch (n) {
            webphone_api.common.PutToDebugLogException(2, "webrtcapi: LoadScript", n)
        }
    }

    function LoadWebrtc(e) {
        try {
            if (initcallback = e, !e || "function" != typeof e) return void webphone_api.common.PutToDebugLog(2, "ERROR, webrtcapi: CheckIfSupported callback is NULL");
            if ("undefined" == typeof webphone_api.webrtcstack || null === webphone_api.webrtcstack || "undefined" == typeof webphone_api.webrtcstack.SIPml || null === webphone_api.webrtcstack.SIPml) {
                var o = webphone_api.getbasedir2() + "js/lib/wen.js";
                webphone_api.common.PutToDebugLog(2, "EVENT, Loading WebRTC engine script: " + o), LoadScript(o, function () {
                    LoadWebrtcInner(initcallback)
                }, function (e, o, t) {
                    webphone_api.common.isNull(o) && (o = "");
                    var n = "";
                    void 0 !== t && null !== t && ("undefined" != typeof t.message && null !== t.message && t.message.length > 0 && (n = n + " (" + t.message + ") "), "undefined" != typeof t.fileName && null !== t.fileName && t.fileName.length > 0 && (n = n + " class: " + t.fileName), "undefined" != typeof t.lineNumber && null !== t.lineNumber && t.fileName.lineNumber > 0 && (n = n + ": " + t.lineNumber)), webphone_api.common.PutToDebugLog(2, "ERROR, LoadWebrtc: failed to load script; status: " + o + "; trace: " + n + "; exception: " + t), LoadWebrtcInner(initcallback)
                })
            } else LoadWebrtcInner(e)
        } catch (t) {
            webphone_api.common.PutToDebugLogException(2, "webrtcapi: LoadWebrtc", t), e(!1)
        }
    }

    function LoadWebrtcInner(e) {
        try {
            webphone_api.$(document.body).append('<audio id="audio_remote" autoplay="autoplay" ></audio>'), webphone_api.$(document.body).append('<audio id="ringtone" loop src="' + webphone_api.getbasedir2() + 'sound/rtc_ringtone.wav" onloadeddata="webphone_api.rt_loaded = true;" oncanplaythrough="webphone_api.rt_canplay = true;" ></audio>'), webphone_api.$(document.body).append('<audio id="ringbacktone" loop src="' + webphone_api.getbasedir2() + 'sound/rtc_ringbacktone.wav" onloadeddata="webphone_api.rbt_loaded = true;" oncanplaythrough="webphone_api.rbt_canplay = true;" ></audio>'), webphone_api.$(document.body).append('<audio id="dtmfTone" src="' + webphone_api.getbasedir2() + 'sound/rtc_dtmf.wav" ></audio>'), webphone_api.$(document.body).append('<audio id="justbeep_1" src="' + webphone_api.getbasedir2() + 'sound/beep-01.wav" ></audio>'), webphone_api.common.PutToDebugLog(2, "EVENT, LoadWebrtc audio files loaded form url: " + webphone_api.getbasedir2() + "/sound/"), AddVideoElemnts(!1), setTimeout(function () {
                AddVideoElemnts(!0);
                var e = document.getElementById("ringtone"), o = document.getElementById("ringbacktone");
                !webphone_api.common.isNull(e) && !webphone_api.common.isNull(o) && !0 === webphone_api.rt_loaded && !0 === webphone_api.rt_canplay && !0 === webphone_api.rbt_loaded && !0 === webphone_api.rbt_canplay && e.play && o.play || (webphone_api.$(document.body).append('<audio id="audio_remote" autoplay="autoplay" ></audio>'), webphone_api.$(document.body).append('<audio id="ringtone" loop src="' + webphone_api.getbasedir2() + 'sound/rtc_ringtone.wav" onloadeddata="webphone_api.rt_loaded = true;" oncanplaythrough="webphone_api.rt_canplay = true;" ></audio>'), webphone_api.$(document.body).append('<audio id="ringbacktone" loop src="' + webphone_api.getbasedir2() + 'sound/rtc_ringbacktone.wav" onloadeddata="webphone_api.rbt_loaded = true;" oncanplaythrough="webphone_api.rbt_canplay = true;" ></audio>'), webphone_api.$(document.body).append('<audio id="dtmfTone" src="' + webphone_api.getbasedir2() + 'sound/rtc_dtmf.wav" ></audio>'), webphone_api.$(document.body).append('<audio id="justbeep_1" src="' + webphone_api.getbasedir2() + 'sound/beep-01.wav" ></audio>'), webphone_api.common.PutToDebugLog(2, "EVENT, LoadWebrtc audio files loaded again after document ready form url: " + webphone_api.getbasedir2() + "/sound/"))
            }, 5e3), document.onkeyup = onKeyUp, document.body.onkeyup = onKeyUp;
            var o = "error";
            webphone_api.common.GetLogLevel() > 1 && (o = "info"), webphone_api.webrtcstack.SIPml.setDebugLevel(o);
            var t = function (e) {
                for (var o = window.location.search.substring(1), t = o.split("&"), n = 0; n < t.length; n++) {
                    var i = t[n].split("=");
                    if (decodeURIComponent(i[0]) === e) return decodeURIComponent(i[1])
                }
                return null
            }, n = function () {
                var o = t("wt"), n = t("fps"), i = t("mvs"), a = t("mbwu"), r = t("mbwd"), s = t("za"), l = t("ndb");
                if (webphone_api.webrtcstack.SIPml.isInitialized()) return void e(!0);
                o && webphone_api.webrtcstack.SIPml.setWebRtcType(o), webphone_api.webrtcstack.SIPml.init(CheckIfSupported, function (o) {
                    webphone_api.common.PutToDebugLogException(2, "webrtc: preinit SIPml.init", o), webphone_api.common.PutToDebugLog(2, "EVENT, WebRTC CheckIfSupported false (10)"), e(!1)
                }), n && webphone_api.webrtcstack.SIPml.setFps(parseFloat(n)), i && webphone_api.webrtcstack.SIPml.setMaxVideoSize(i), a && webphone_api.webrtcstack.SIPml.setMaxBandwidthUp(parseFloat(a)), r && webphone_api.webrtcstack.SIPml.setMaxBandwidthDown(parseFloat(r)), s && webphone_api.webrtcstack.SIPml.setZeroArtifacts("true" === s), "true" == l && webphone_api.webrtcstack.SIPml.startNativeDebug()
            };
            webphone_api.common.isNull(oReadyStateTimer) || clearInterval(oReadyStateTimer);
            var i = (webphone_api.common.GetTickCount(), 0);
            oReadyStateTimer = setInterval(function () {
                i++, webphone_api.common.GetTickCount() - webphone_api.loadwebrtc_timestamp > 25e3 && "Edge" === webphone_api.common.GetBrowser() && (webphone_api.common.PutToDebugLog(2, "ERROR, reload webphone because window.onload, document.readyState did not fire after 11 sec"), console.log("ERROR, reload webphone because window.onload, document.readyState did not fire after 11 sec"), window.location.reload()), "complete" !== document.readyState && !0 !== webphone_api.document_loaded || (clearInterval(oReadyStateTimer), n())
            }, 50)
        } catch (a) {
            webphone_api.common.PutToDebugLogException(2, "webrtcapi: LoadWebrtc inner", a), e(!1)
        }
    }

    function CheckIfSupported() {
        var e = 0;
        try {
            return webphone_api.webrtcstack.SIPml.isWebRtcSupported() ? (e = 5, webphone_api.webrtcstack.SIPml.isWebSocketSupported() ? (e = 10, viewVideoLocal = videoLocal, viewVideoRemote = videoRemote, e = 11, webphone_api.webrtcstack.SIPml.isWebRtcSupported() ? (e = 16, postInit(), e = 17, webphone_api.common.isNull(initcallback) || (e = 18, initcallback(!0), e = 19), e = 20, !0) : (e = 12, webphone_api.common.PutToDebugLog(2, "EVENT, WebRTC CheckIfSupported false (3)"), webphone_api.common.isNull(initcallback) || (e = 13, initcallback(!1), e = 14), e = 15, !1)) : (e = 6, webphone_api.common.PutToDebugLog(2, "EVENT, WebRTC CheckIfSupported false (2)"), webphone_api.common.isNull(initcallback) || (e = 7, initcallback(!1), e = 8), e = 9, !1)) : (e = 1, webphone_api.common.PutToDebugLog(2, "EVENT, WebRTC CheckIfSupported false (1)"), webphone_api.common.isNull(initcallback) || (e = 2, initcallback(!1), e = 3), e = 4, !1)
        } catch (o) {
            return webphone_api.common.PutToDebugLog(2, "EVENT, WebRTC CheckIfSupported false (4)"), webphone_api.common.PutToDebugLogException(2, "webrtcapi: CheckIfSupported (" + e + ")", o), webphone_api.common.isNull(initcallback) || initcallback(!1), !1
        }
    }

    function postInit() {
        try {
            isregistered = !1, webphone_api.common.isNull(audioRemote) && webphone_api.common.PutToDebugLog(2, "ERROR, Cannot find audio_remote html element (incoming audio will not work without this element!!)"), callsipheaders = RemoveDuplicateHeader(callsipheaders), oConfigCall = {
                audio_remote: audioRemote,
                video_local: viewVideoLocal,
                video_remote: viewVideoRemote,
                screencast_window_id: 0,
                bandwidth: { audio: 0, video: undefined },
                video_size: null,
                events_listener: { events: "*", listener: onSipEventSession },
                sip_caps: [{ name: "+g.oma.sip-im" }],
                sip_headers: callsipheaders
            }, oConfigMessage = {
                events_listener: {
                    events: "*",
                    listener: onSipEventSession
                }
            }, oConfigSms = {
                events_listener: { events: "*", listener: onSipEventSession },
                sip_headers: [{ name: "P-Sms", value: "Yes" }]
            }
        } catch (e) {
            webphone_api.common.PutToDebugLogException(2, "webrtcapi: postInit", e)
        }
    }

    function SetSipHeader(e, o) {
        try {
            var t = !1;
            !0 !== webphone_api.common.IsMizuWebRTCGateway() && !0 !== webphone_api.common.IsMizuWebRTCEmbeddedServer() && !0 !== webphone_api.common.IsMizuServer() || (t = !0);
            var n = webphone_api.common.GetParameter("customsipheader");
            if (!webphone_api.common.isNull(n) && n.length > 0) {
                var i = null;
                if (i = n.indexOf(";") > 0 ? n.split(";") : n.indexOf("\r\n") > 0 ? n.split("\r\n") : n.split("\n"), !webphone_api.common.isNull(i) && i.length > 0) for (var a = 0; a < i.length; a++) if (!(webphone_api.common.isNull(i[a]) || webphone_api.common.Trim(i[a]).length < 1 || i[a].indexOf(":") < 1)) {
                    var r = webphone_api.common.Trim(i[a].substring(0, i[a].indexOf(":"))),
                        s = webphone_api.common.Trim(i[a].substring(i[a].indexOf(":") + 1, i[a].length));
                    webphone_api.common.isNull(r) || r.length < 1 || (webphone_api.common.isNull(s) && (s = ""), !0 === t && 0 !== r.indexOf("X-") && (r = "X-R-" + r), AddSipHeader(sipheaders, r, s), AddSipHeader(callsipheaders, r, s))
                }
            }
            if (webphone_api.common.isNull(o)) return;
            o = webphone_api.common.Trim(o);
            var l;
            if (l = o.indexOf(";") > 0 ? o.split(";") : o.indexOf("\r\n") > 0 ? o.split("\r\n") : o.split("\n"), webphone_api.common.isNull(l) || l.length < 1) return;
            if (-1 === e && (e = webphone_api.common.GetBestLine()), o.length < 1) if (-2 === e || !1 === webphone_api.global.checkIfInCall) {
                for (var a = 0; a < sipheaders.length; a++) {
                    var p = sipheaders[a].name;
                    "User-Agent" !== p && "Organization" !== p && p.indexOf("Webdomain") < 0 && "P-Sms" !== p && "Sy.Uppersrv" !== p && "X-Sy.Uppersrv" !== p && "Sy.Upperproxy" !== p && "X-Sy.Upperproxy" !== p && "X-IMStatus" !== p && "X-P2P" !== p && "X-AUSR" !== p && "X-Sy.Uppersrvd" !== p && "X-P2P" !== p && (sipheaders.splice(a, 1), a--)
                }
                oSipSessionRegister && (sipheaders = RemoveDuplicateHeader(sipheaders), oSipSessionRegister.setConfiguration({ sip_headers: sipheaders }));
                for (var a = 0; a < webphone_api.global.ep.length; a++) try {
                    var c = webphone_api.global.ep[a][webphone_api.common.EP_SIPHEADERS];
                    if (webphone_api.common.isNull(c) || c.length < 1) continue;
                    for (var u = 0; u < c.length; u++) {
                        var p = c[u].name;
                        "User-Agent" !== p && "Organization" !== p && p.indexOf("Webdomain") < 0 && "P-Sms" !== p && "Sy.Uppersrv" !== p && "X-Sy.Uppersrv" !== p && "Sy.Upperproxy" !== p && "X-Sy.Upperproxy" !== p && "X-IMStatus" !== p && "X-P2P" !== p && "X-AUSR" !== p && "X-Sy.Uppersrvd" !== p && "X-P2P" !== p && (c.splice(u, 1), u--)
                    }
                    webphone_api.global.ep[a][webphone_api.common.EP_SIPHEADERS] = c;
                    var h = webphone_api.global.ep[a][webphone_api.common.EP_SESSION];
                    webphone_api.common.isNull(h) || (c = RemoveDuplicateHeader(c), h.setConfiguration({ sip_headers: c }))
                } catch (_) {
                    webphone_api.common.PutToDebugLogException(2, "webrtcapi: SetSipHeader remove from callseesions", _)
                }
            } else if (e > 0) {
                for (var m = -1, a = 0; a < webphone_api.global.ep.length; a++) {
                    var g = webphone_api.global.ep[webphone_api.common.EP_LINE];
                    if (g === e) {
                        m = a;
                        break
                    }
                }
                if (m > -1) {
                    var c = webphone_api.global.ep[m][webphone_api.common.EP_SIPHEADERS];
                    if (!webphone_api.common.isNull(c) && c.length > 0) {
                        for (var u = 0; u < c.length; u++) {
                            var p = c[u].name;
                            "User-Agent" !== p && "Organization" !== p && p.indexOf("Webdomain") < 0 && "P-Sms" !== p && "Sy.Uppersrv" !== p && "X-Sy.Uppersrv" !== p && "Sy.Upperproxy" !== p && "X-Sy.Upperproxy" !== p && "X-IMStatus" !== p && "X-P2P" !== p && "X-AUSR" !== p && "X-Sy.Uppersrvd" !== p && "X-P2P" !== p && (c.splice(u, 1), u--)
                        }
                        webphone_api.global.ep[m][webphone_api.common.EP_SIPHEADERS] = c;
                        var h = webphone_api.global.ep[m][webphone_api.common.EP_SESSION];
                        webphone_api.common.isNull(h) || (c = RemoveDuplicateHeader(c), h.setConfiguration({ sip_headers: c }))
                    }
                }
            }
            for (var a = 0; a < l.length; a++) if (!(webphone_api.common.isNull(l[a]) || l[a].indexOf(":") < 1)) {
                var r = l[a].substring(0, l[a].indexOf(":")), d = l[a].substring(l[a].indexOf(":") + 1);
                if (webphone_api.common.isNull(d) && (d = ""), !0 === t && 0 !== r.indexOf("X-") && (r = "X-R-" + r), -2 === e || !1 === webphone_api.global.checkIfInCall) {
                    AddSipHeader(sipheaders, r, d), oSipSessionRegister && (sipheaders = RemoveDuplicateHeader(sipheaders), oSipSessionRegister.setConfiguration({ sip_headers: sipheaders }));
                    for (var u = 0; u < webphone_api.global.ep.length; u++) try {
                        var c = webphone_api.global.ep[u][webphone_api.common.EP_SIPHEADERS];
                        if (webphone_api.common.isNull(c) || c.length < 1) continue;
                        AddSipHeader(c, r, d), webphone_api.global.ep[u][webphone_api.common.EP_SIPHEADERS] = c;
                        var h = webphone_api.global.ep[u][webphone_api.common.EP_SESSION];
                        webphone_api.common.isNull(h) || (c = RemoveDuplicateHeader(c), h.setConfiguration({ sip_headers: c }))
                    } catch (_) {
                        webphone_api.common.PutToDebugLogException(2, "webrtcapi: SetSipHeader add OR remove from callseesions", _)
                    }
                    AddSipHeader(callsipheaders, r, d)
                } else if (e > 0) {
                    for (var m = -1, b = 0; b < webphone_api.global.ep.length; b++) {
                        var g = webphone_api.global.ep[webphone_api.common.EP_LINE];
                        if (g === e) {
                            m = b;
                            break
                        }
                    }
                    if (m > -1) {
                        var c = webphone_api.global.ep[m][webphone_api.common.EP_SIPHEADERS];
                        if (!webphone_api.common.isNull(c) && c.length > 0) {
                            AddSipHeader(c, r, d), webphone_api.global.ep[m][webphone_api.common.EP_SIPHEADERS] = c;
                            var h = webphone_api.global.ep[m][webphone_api.common.EP_SESSION];
                            webphone_api.common.isNull(h) || (c = RemoveDuplicateHeader(c), h.setConfiguration({ sip_headers: c }))
                        }
                    }
                }
            }
        } catch (_) {
            webphone_api.common.PutToDebugLogException(2, "webrtcapi: SetSipHeader", _)
        }
    }

    function AddSipHeader(e, o, t) {
        try {
            if (webphone_api.common.isNull(e) && (e = []), webphone_api.common.isNull(o) || o.length < 1) return;
            webphone_api.common.isNull(t) && (t = ""), webphone_api.common.PutToDebugLog(4, "EVENT, AddSipHeader: " + o + ": " + t);
            for (var n = o.toLowerCase(), i = !1, a = 0; a < e.length; a++) {
                var r = e[a].name;
                if (!(webphone_api.common.isNull(r) || r.length < 1) && (r = r.toLowerCase(), n === r)) {
                    "User-Agent" !== o && "Organization" !== o && o.indexOf("Webdomain") < 0 && "P-Sms" !== o && "Sy.Uppersrv" !== o && "X-Sy.Uppersrv" !== o && "Sy.Upperproxy" !== o && "X-Sy.Upperproxy" !== o && "X-P2P" !== o && "X-AUSR" !== o && "X-Sy.Uppersrvd" !== o && "X-P2P" !== o && (o.length < 1 ? e[a].splice(a, 1) : e[a].value = t), i = !0;
                    break
                }
            }
            !1 === i && o.length > 0 && (e[e.length] = {}, e[e.length - 1].name = o, e[e.length - 1].value = t), e = RemoveDuplicateHeader(e)
        } catch (s) {
            webphone_api.common.PutToDebugLogException(2, "webrtcapi: AddSipHeader", s)
        }
    }

    function RemoveDuplicateHeader(e) {
        try {
            var o = e, t = [];
            if (webphone_api.common.isNull(o) || o.length < 1) return e;
            for (var n = o.length - 1; n >= 0; n--) if (!webphone_api.common.isNull(o[n])) {
                for (var i = !1, a = 0; a < t.length; a++) if (t[a].name === o[n].name) {
                    i = !0;
                    break
                }
                !1 === i && t.push(o[n])
            }
            if (!webphone_api.common.isNull(t)) return t
        } catch (r) {
            webphone_api.common.PutToDebugLogException(2, "webrtcapi: RemoveDuplicateHeader", r)
        }
        return e
    }

    function ReStart(e, o) {
        try {
            if (webphone_api.common.isNull(te2) && (te2 = webphone_api.common.Te2()), te2) return;
            if (webphone_api.common.PutToDebugLog(2, "EVENT, webrtcapi restart flag: " + webphone_api.flagrestartwebrtc.toString()), !1 === webphone_api.flagrestartwebrtc) return;
            if (!0 === o) return webphone_api.common.PutToDebugLog(2, "EVENT, restarting webrtc sipstack: forced"), restartdelay = 2e3, webphone_api.common.CallWsuserKeepAlive(!0), void Start();
            var t = webphone_api.common.GetTickCount();
            if (!webphone_api.common.isNull(e) && webphone_api.common.IsNumber(e) && (restartdelay = webphone_api.common.StrToInt(e)), t <= lastrestarttick + restartdelay) return;
            t - lastrestarttick > 8e5 && restartdelay > 2e3 && (restartdelay = 2e3), t > lastrestarttick + restartdelay && t - lastrestarttick < 512e3 && (restartdelay *= 2), lastrestarttick = t;
            var n = new Date(lastrestarttick), i = n.getHours(), a = n.getMinutes(), r = n.getSeconds();
            a < 10 && (a = "0" + a), r < 10 && (r = "0" + r), restarttimestr = i + ":" + a + ":" + r, setTimeout(function () {
                webphone_api.common.PutToDebugLog(2, "EVENT, restarting webrtc sipstack: " + restarttimestr), webphone_api.common.CallWsuserKeepAlive(!0), Start()
            }, restartdelay)
        } catch (s) {
            webphone_api.common.PutToDebugLogException(2, "webrtcapi: ReStart", s)
        }
    }

    function Start() {
        try {
            LoadWebrtc(function (e) {
                webphone_api.common.PutToDebugLog(2, "EVENT, webrtcapi: LoadWebrtc returned: " + e), StartInner()
            })
        } catch (e) {
            webphone_api.common.PutToDebugLogException(2, "webrtcapi: Start", e)
        }
    }

    function StartInner() {
        try {
            webphone_api.common.PutToDebugLog(2, "EVENT, webrtcapi start"), webphone_api.flagrestartwebrtc = !0, StartGetDevices(), webphone_api.common.PutToDebugLog(2, "EVENT, mlogic API_Setvolume on WebRTC start"), webphone_api.setvolume(1, webphone_api.common.GetParameter("volumeout"));
            var chsptr = webphone_api.common.GetParameter2("changesptoring");
            (webphone_api.common.isNull(chsptr) || chsptr.length < 1 || !1 === webphone_api.common.IsNumber(chsptr)) && (chsptr = 2), changesptoring = webphone_api.common.StrToInt(chsptr);
            var remonco = webphone_api.common.GetParameter2("recheckmediaonconnect");
            (webphone_api.common.isNull(remonco) || remonco.length < 1 || !1 === webphone_api.common.IsNumber(remonco)) && (remonco = 2), recheckmediaonconnect = webphone_api.common.StrToInt(remonco), (recheckmediaonconnect < 0 || recheckmediaonconnect > 3) && (recheckmediaonconnect = 2), webphone_api.global.autoacceptsipheader = webphone_api.common.GetParameter("autoacceptsipheader");
            var sipusername = webphone_api.common.GetSipusername(),
                password = webphone_api.common.GetParameter("password"),
                callerid = webphone_api.common.GetParameter("username");
            (webphone_api.common.isNull(callerid) || webphone_api.common.Trim(callerid).length < 1) && (callerid = sipusername);
            var udpaddr = GetUDPServerAddress(), wsaddr = webphone_api.common.GetWebrtcSrvAddr(),
                displayname = webphone_api.common.GetParameter("displayname");
            if ((webphone_api.common.isNull(displayname) || displayname.length < 1) && sipusername !== callerid && (displayname = sipusername), !0 === webphone_api.common.GetParameterBool("hidemyidentity", !1) && (displayname = ""), 2 === webphone_api.common.GetConfigInt("usemizuwebrtcgateway", 1) && (wsaddr = ""), webphone_api.common.isNull(wsaddr) || wsaddr.length < 2) {
                wsaddr = webphone_api.common.GetWp();
                var wstmp = wsaddr;
                wstmp.indexOf("//") >= 0 && (wstmp = wstmp.substring(wstmp.indexOf("//") + 2, wstmp.length)), wstmp.indexOf(":") > 0 && (wstmp = wstmp.substring(0, wstmp.indexOf(":")))
            } else wsaddr = webphone_api.common.Trim(wsaddr.toLowerCase());
            wsaddr = wsaddr.replace("*", ""), wsaddr = wsaddr.toLowerCase(), wsaddr = wsaddr.replace("udp://", ""), wsaddr = wsaddr.replace("tcp://", ""), wsaddr = wsaddr.replace("http://", ""), wsaddr = wsaddr.replace("https://", "");
            var sipaddress = udpaddr;
            sipaddress.indexOf("udp:") < 0 && (sipaddress = "udp://" + sipaddress);
            var proxyaddress = webphone_api.common.GetProxyaddress();
            if (webphone_api.common.isNull(proxyaddress) && (proxyaddress = ""), !0 === webphone_api.common.IsMizuServer() && proxyaddress.length < 1 && (proxyaddress = sipaddress), proxyaddress = webphone_api.common.GetProxyaddress(proxyaddress), proxyaddress.length > 0) if (!0 === webphone_api.common.IsMizuServer() || !0 === webphone_api.common.IsMizuWebRTCGateway() || !0 === webphone_api.common.IsMizuWebRTCEmbeddedServer()) proxyaddress = "udp://" + proxyaddress; else {
                var transport = webphone_api.common.GetParameterInt("transport", 0), transpStr = "udp";
                1 === transport ? transpStr = "tcp" : 2 === transport && (transpStr = "tls"), transpStr.indexOf(":") < 0 && (transpStr += "://"), proxyaddress = transpStr + proxyaddress
            }
            var wsaddress = wsaddr;
            wsaddress.indexOf("ws:") < 0 && wsaddress.indexOf("wss:") < 0 && (wsaddress = "ws://" + wsaddress);
            var hostmp = location.host.toLowerCase();
            !1 !== webphone_api.common.IsIPAddrress(wsaddress) && !0 !== webphone_api.common.BrowserRequiresHttps(!0) || (wsaddress = wsaddress.replace("ws:", "wss:")), !1 === webphone_api.global.decideusuk_finished && (!0 === webphone_api.common.IsUKGateway(wsaddress) ? (webphone_api.global.usuk = "uk", webphone_api.global.decideusuk_finished = !0) : !0 === webphone_api.common.IsUSGateway(wsaddress) && (webphone_api.global.usuk = "us", webphone_api.global.decideusuk_finished = !0));
            var publicsipaddress = webphone_api.common.GetConfig("publicsipaddress");
            webphone_api.common.isNull(publicsipaddress) && (publicsipaddress = ""), publicsipaddress.length > 0 && webphone_api.common.PutToDebugLog(2, "EVENT, WebRTC publicsipaddress is set to: " + publicsipaddress);
            var realm = publicsipaddress;
            realm.length < 2 && (realm = webphone_api.common.GetParameter("realm"), (webphone_api.common.isNull(realm) || realm.length < 2) && (realm = udpaddr)), realm = webphone_api.common.NormalizeInput(realm, 0), realm.indexOf(":") > 0 && (realm = realm.substring(0, realm.indexOf(":"))), realm = webphone_api.common.Trim(realm), webphone_api.global.mRealm = realm;
            var sipuri = callerid;
            if (sipuri.indexOf("sip:") < 0 && (sipuri = "sip:" + callerid), sipuri.indexOf("@") < 0) if (sipuri += "@", publicsipaddress.length > 1) sipuri += publicsipaddress; else if (realm.indexOf(".") > 0) sipuri += realm; else {
                var tmpsrv = sipaddress;
                tmpsrv = tmpsrv.toLowerCase(), tmpsrv = webphone_api.common.NormalizeInput(tmpsrv, 0), tmpsrv.indexOf(":") > 0 && (tmpsrv = tmpsrv.substring(0, tmpsrv.indexOf(":"))), tmpsrv.indexOf("/") > 0 && (tmpsrv = tmpsrv.substring(0, tmpsrv.indexOf("/"))), sipuri += tmpsrv
            }
            if (!webphone_api.common.isNull(sipuri) && sipuri.indexOf("@") > 0) {
                var addrtmp = sipuri.substr(sipuri.indexOf("@") + 1);
                if (!webphone_api.common.isNull(addrtmp) && (addrtmp.indexOf(":") > 0 && (addrtmp = addrtmp.substring(0, addrtmp.indexOf(":"))), !webphone_api.common.isNull(addrtmp) && addrtmp.length > 0 && webphone_api.common.IsLanIP(addrtmp) && webphone_api.common.GetWebrtcSrvAddr().length < 2)) return webphone_api.common.PutToDebugLog(1, "ERROR, " + webphone_api.stringres.get("webrtc_local_sipserver") + " (2)"), (!0 === webphone_api.global.usestorage || webphone_api.common.Strl(60)) && alert("ERROR, " + webphone_api.stringres.get("webrtc_local_sipserver") + "\n\n" + webphone_api.stringres.get("all_demo_msg") + " (2)"), !1
            }
            var enableRTCWebBreaker = !0;
            enableRTCWebBreaker = !(!webphone_api.common.isNull(webphone_api.parameters.rtcbreaker) && 0 === webphone_api.parameters.rtcbreaker) && (!webphone_api.common.isNull(webphone_api.parameters.rtcbreaker) && 1 === webphone_api.parameters.rtcbreaker || !1 === webphone_api.common.IsMizuWebRTCGateway() && !1 === webphone_api.common.IsMizuWebRTCEmbeddedServer()), webphone_api.common.PutToDebugLog(2, "EVENT, webrtcapi: Start rtcbreaker: " + enableRTCWebBreaker.toString());
            var organization = webphone_api.common.GetConfig("companyname");
            (webphone_api.common.isNull(organization) || organization.length < 1) && (organization = webphone_api.common.GetConfig("brandname"), (webphone_api.common.isNull(organization) || organization.length < 1) && (organization = "Mizutech"));
            var ua = webphone_api.common.GetUA();
            webphone_api.common.GetParameter("useragent").length > 0 && !1 === webphone_api.common.IsMizuWebRTCGateway() && (ua = webphone_api.common.GetParameter("useragent")), sipheaders = [{
                name: "User-Agent",
                value: ua
            }, { name: "Organization", value: organization }, {
                name: "X-Webdomain",
                value: webphone_api.common.GetWebdomain()
            }];
            var xhval = "1";
            !0 === webphone_api.common.Hasesw() ? xhval = "2" : !0 === webphone_api.common.Us() && (xhval = "0"), sipheaders[sipheaders.length] = {}, sipheaders[sipheaders.length - 1].name = "X-LS", sipheaders[sipheaders.length - 1].value = xhval, SetSipHeader(0);
            var company = webphone_api.common.GetParameter("companyname");
            !webphone_api.common.isNull(company) && company.length > 0 && (sipheaders[sipheaders.length] = {}, sipheaders[sipheaders.length - 1].name = "X-Company", sipheaders[sipheaders.length - 1].value = company);
            var brand = webphone_api.common.GetParameter("brandname");
            !webphone_api.common.isNull(brand) && brand.length > 0 && (sipheaders[sipheaders.length] = {}, sipheaders[sipheaders.length - 1].name = "X-Brand", sipheaders[sipheaders.length - 1].value = brand);
            var uppsrv = webphone_api.common.GetWebrtcSyUpperHeader("start");
            uppsrv.length > 0 && (sipheaders[sipheaders.length] = {}, sipheaders[sipheaders.length - 1].name = "X-Sy.Uppersrv", sipheaders[sipheaders.length - 1].value = uppsrv);
            var uppsrvd = webphone_api.common.GetWebrtcSyUpperDomainHeader("start");
            uppsrvd.length > 0 && (sipheaders[sipheaders.length] = {}, sipheaders[sipheaders.length - 1].name = "X-Sy.Uppersrvd", sipheaders[sipheaders.length - 1].value = uppsrvd);
            var xp2p = webphone_api.common.GetConfig("p2p");
            !webphone_api.common.isNull(xp2p) && xp2p.length > 0 && (sipheaders[sipheaders.length] = {}, sipheaders[sipheaders.length - 1].name = "X-P2P", sipheaders[sipheaders.length - 1].value = xp2p), webphone_api.global.addauser_header = !1, !webphone_api.common.isNull(sipusername) && sipusername.length > 0 && !webphone_api.common.isNull(callerid) && callerid.length > 0 && sipusername !== callerid && (webphone_api.global.addauser_header = !0, sipheaders[sipheaders.length] = {}, sipheaders[sipheaders.length - 1].name = "X-AUSR", sipheaders[sipheaders.length - 1].value = sipusername);
            var prxy = webphone_api.common.GetUpperProxyHeaderForSignaling();
            !webphone_api.common.isNull(prxy) && prxy.length > 0 && (sipheaders[sipheaders.length] = {}, sipheaders[sipheaders.length - 1].name = "X-Sy.Upperproxy", sipheaders[sipheaders.length - 1].value = prxy), webphone_api.common.UsePresence2(), sipheaders[sipheaders.length] = {}, sipheaders[sipheaders.length - 1].name = "X-IMStatus", sipheaders[sipheaders.length - 1].value = "Online";
            var p2psignaling = webphone_api.common.GetParameterInt("p2psignaling", 1);
            if (1 !== p2psignaling) {
                var valTmp = "no";
                2 === p2psignaling ? valTmp = "proxy" : 2 === p2psignaling && (valTmp = "process"), sipheaders[sipheaders.length] = {}, sipheaders[sipheaders.length - 1].name = "X-P2P", sipheaders[sipheaders.length - 1].value = valTmp
            }
            sipheaders = RemoveDuplicateHeader(sipheaders);
            var loglevel = "error";
            webphone_api.common.GetLogLevel() > 1 && (loglevel = "info"), webphone_api.webrtcstack.SIPml.setDebugLevel(loglevel), window.webkitNotifications && 0 != window.webkitNotifications.checkPermission() && window.webkitNotifications.requestPermission(), (webphone_api.common.isNull(sipusername) || sipusername.length < 1) && (webphone_api.common.PutToDebugLog(2, "ERROR, WebRTC invalid username: " + sipusername), webphone_api.common.PutToDebugLog(1, "ERROR, Invalid username")), (webphone_api.common.isNull(password) || password.length < 1) && (webphone_api.common.PutToDebugLog(2, "ERROR, WebRTC invalid password: " + password), webphone_api.common.PutToDebugLog(1, "ERROR, Invalid password")), (webphone_api.common.isNull(sipuri) || sipuri.length < 2 || sipuri.indexOf("@") < 1 || sipuri.indexOf(".") < 1) && webphone_api.common.PutToDebugLog(2, "ERROR, WebRTC invalid sipuri: " + sipuri);
            var stun_turn = [], stun = webphone_api.common.GetStunServersStr(), turn = webphone_api.common.GetTurnSrv();
            if (!webphone_api.common.isNull(stun) && stun.length > 2) {
                var sarr = stun.split(","), useurls = !1;
                if (("Chrome" === webphone_api.common.GetBrowser() && webphone_api.common.GetBrowserVersion() > 40 || "Firefox" === webphone_api.common.GetBrowser() && webphone_api.common.GetBrowserVersion() > 40) && (useurls = !0), !webphone_api.common.isNull(sarr)) for (var i = 0; i < sarr.length; i++) if (!(webphone_api.common.isNull(sarr[i]) || sarr[i].length < 1)) if (!0 === useurls) {
                    var obj = { urls: sarr[i] };
                    stun_turn.push(obj)
                } else {
                    var obj = { url: sarr[i] };
                    stun_turn.push(obj)
                }
            }
            webphone_api.common.isNull(turn) || webphone_api.common.IsLocalServer() || stun_turn.push(turn);
            var logparams = {};
            if (!webphone_api.common.isNull(webphone_api.global.settmap2)) {
                for (var key in webphone_api.global.settmap2) {
                    var value = webphone_api.global.settmap2[key];
                    webphone_api.common.isNull(value) || (key.indexOf("server") < 0 && key.indexOf("username") < 0 && key.indexOf("password") < 0 && "1" === value[webphone_api.common.SETT_ISDEFAULT] || (logparams[key] = value[webphone_api.common.SETT_VALUE]))
                }
                var extraoption = webphone_api.common.GetParameter("extraoption");
                if (!webphone_api.common.isNull(extraoption) && extraoption.length > 0) {
                    extraoption = webphone_api.common.Trim(extraoption);
                    var optionlist = extraoption.split(";");
                    if (!webphone_api.common.isNull(optionlist) && optionlist.length > 0) for (var i = 0; i < optionlist.length; i++) if (!(webphone_api.common.isNull(optionlist[i]) || optionlist[i].length < 1 || optionlist[i].indexOf("=") < 1)) {
                        var key = webphone_api.common.Trim(optionlist[i].substring(0, optionlist[i].indexOf("="))),
                            value = webphone_api.common.Trim(optionlist[i].substring(optionlist[i].indexOf("=") + 1));
                        !webphone_api.common.isNull(key) && key.length > 0 && !webphone_api.common.isNull(value) && (logparams[key] = value)
                    }
                }
            }
            if (webphone_api.common.IsCExt() > 0 && (webphone_api.global.add_recall_header = !0), webphone_api.common.LogAllParameters("WebRTC all parameters (just informative):", logparams), webphone_api.common.PutToDebugLog(3, "Webrtc connection details:"), webphone_api.common.PutToDebugLog(3, "sipusername: " + sipusername), (webphone_api.common.GetLogLevel() > 1 || !0 === webphone_api.global.isdebugversion) && webphone_api.common.PutToDebugLog(3, "password: " + password), webphone_api.common.PutToDebugLog(3, "sipuri: " + sipuri), webphone_api.common.PutToDebugLog(3, "displayname: " + displayname), webphone_api.common.PutToDebugLog(3, "wsaddress: " + wsaddress), webphone_api.common.PutToDebugLog(3, "proxyaddress: " + proxyaddress), webphone_api.common.PutToDebugLog(3, "realm: " + realm), (webphone_api.common.isNull(webphone_api.global.usuk) || webphone_api.global.usuk.length < 1) && (webphone_api.common.IsUKGateway(wsaddress) ? (webphone_api.common.PutToDebugLog(2, "WARNING, webrtcapi Start manually setting UK gateway, because DecideUsUk has not yet finished"), webphone_api.global.usuk = "uk") : webphone_api.common.IsUSGateway(wsaddress) && (webphone_api.common.PutToDebugLog(2, "WARNING, webrtcapi Start manually setting US gateway, because DecideUsUk has not yet finished"), webphone_api.global.usuk = "us")), mSipuri = sipuri, mDisplayname = displayname, !webphone_api.common.isNull(stun_turn) && stun_turn.length > 0) {
                for (var i = 0; i < stun_turn.length; i++) if (!webphone_api.common.isNull(stun_turn[i])) {
                    var sobj = stun_turn[i];
                    for (var key in sobj) {
                        var msgtmp = "turn server";
                        !webphone_api.common.isNull(sobj[key]) && sobj[key].toString().indexOf("stun") >= 0 && (msgtmp = "stun server"), webphone_api.common.PutToDebugLog(3, msgtmp + "[" + i + "]: " + key + ": " + sobj[key])
                    }
                }
            } else webphone_api.common.PutToDebugLog(3, "stun server: NOT set");
            var iceobj = null, icestr = webphone_api.common.GetParameter("ice");
            if (!webphone_api.common.isNull(icestr) && icestr.length > 0) try {
                iceobj = eval(icestr)
            } catch (eice) {
                iceobj = null, webphone_api.common.PutToDebugLogException(2, "ERROR, webrtcapi parse ICE servers", eice)
            }
            if (!webphone_api.common.isNull(iceobj)) {
                try {
                    webphone_api.common.PutToDebugLog(2, "EVENT, webrtcapi found ICE (STUN/TURN) server: " + JSON.stringify(iceobj))
                } catch (eice2) {
                }
                stun_turn = iceobj
            }
            var earlymediaint = webphone_api.common.GetParameterInt("earlymedia", 2), earlymedia = !0;
            earlymediaint < 1 && (earlymedia = !1), webphone_api.common.isNull(te2) && (te2 = webphone_api.common.Te2()), te2 && (stun_turn = null), webphone_api.webrtcMicVolume = GetVolume(0) / 100, webphone_api.global.minten = !1;
            try {
                sipheaders = RemoveDuplicateHeader(sipheaders), oSipStack = new webphone_api.webrtcstack.SIPml.Stack({
                    realm: realm,
                    impi: sipusername,
                    impu: sipuri,
                    password: password,
                    display_name: displayname,
                    websocket_proxy_url: wsaddress,
                    outbound_proxy_url: proxyaddress,
                    ice_servers: stun_turn,
                    enable_rtcweb_breaker: enableRTCWebBreaker,
                    events_listener: { events: "*", listener: onSipEventStack },
                    enable_early_ims: earlymedia,
                    enable_media_stream_cache: !0,
                    bandwidth: null,
                    video_size: null,
                    sip_headers: sipheaders
                })
            } catch (err_reg) {
                var reason = "";
                webphone_api.common.isNull(err_reg) || (reason = err_reg.toString()), !webphone_api.common.isNull(reason) && reason.indexOf("is not valid as SIP Uri") >= 0 && (reason = webphone_api.common.NormalizeInput2(sipusername, 1) !== sipusername ? "invalid SIP Uri because username contains special characters: " + sipusername : "invalid serveraddress: " + realm), !webphone_api.common.isNull(reason) && reason.length > 0 && (lastregfailreason = reason, webphone_api.common.PutToDebugLog(1, "ERROR, Register failed: " + reason));
                try {
                    webphone_api.onRegStateChangeCb("failed", reason)
                } catch (errin) {
                    webphone_api.common.PutToDebugLogException(2, "webrtcapi: Start: There is an error in onRegisterFailed(failed) callback", errin)
                }
                try {
                    webphone_api.onRegisterFailedCb(reason)
                } catch (errin) {
                    webphone_api.common.PutToDebugLogException(2, "webrtcapi: Start: There is an error in onRegisterFailed() callback", errin)
                }
                webphone_api.common.PutToDebugLogException(2, "webrtcapi: Start failed to create SIPstack", err_reg)
            }
            return webphone_api.common.GetParameterInt("forcereregister", 1) > 1 && StartReRegister(!0), webphone_api.global.webrtc_regstate = 0, webphone_api.common.CallWsuserKeepAlive(!1), setTimeout(function () {
                if (!webphone_api.common.isNull(webphone_api.global.sipaccounts) && webphone_api.global.sipaccounts.length > 1) for (var e = 0; e < webphone_api.global.sipaccounts.length; e++) if ("true" !== webphone_api.global.sipaccounts[e].ismain.toString()) {
                    var o = webphone_api.global.sipaccounts[e].serveraddress + "," + webphone_api.global.sipaccounts[e].username + "," + webphone_api.global.sipaccounts[e].password + "," + webphone_api.global.sipaccounts[e].ival;
                    RegisterEx(o)
                }
            }, 2500), 0 != oSipStack.start() ? (webphone_api.common.PutToDebugLog(2, "ERROR, webrtcapi: Start, Failed to start the SIP stack"), !1) : (setTimeout(function () {
                webphone_api.global.phonestarted < 2 && (webphone_api.global.phonestarted = 2)
            }, 500), !0)
        } catch (err) {
            webphone_api.common.PutToDebugLogException(2, "webrtcapi: StartInner", err)
        }
        return !1
    }

    function GetUDPServerAddress() {
        try {
            var e = "";
            if ((webphone_api.common.isNull(e) || e.length < 3) && (e = webphone_api.common.GetConfig("serverdomain")), (webphone_api.common.isNull(e) || e.length < 3) && (e = webphone_api.common.GetConfig("serveraddress")), (webphone_api.common.isNull(e) || e.length < 3) && (e = webphone_api.common.GetConfig("server")), (webphone_api.common.isNull(e) || e.length < 3) && (e = webphone_api.common.GetConfig("serverip")), !webphone_api.common.isNull(e) && e.length > 2 && e.indexOf(":") < 1) {
                var o = webphone_api.common.GetConfig("serverport");
                !webphone_api.common.isNull(o) && o.length > 0 && "5060" !== o && (e = e + ":" + o)
            }
            return (webphone_api.common.isNull(e) || e.length < 3) && (e = webphone_api.common.GetParameter("serveraddress_user")), (webphone_api.common.isNull(e) || e.length < 3 || e.indexOf(".") < 1) && (e = webphone_api.common.GetParameter("upperserver")), (webphone_api.common.isNull(e) || e.length < 3) && (e = webphone_api.common.GetFp()), e = e.toLowerCase(), e = e.replace("udp://", ""), e = e.replace("tcp://", ""), e = e.replace("http://", ""), e = e.replace("https://", "")
        } catch (t) {
            webphone_api.common.PutToDebugLogException(2, "webrtcapi: GetUDPServerAddress", t)
        }
        return ""
    }

    function SipUnRegister() {
        try {
            if (oSipSessionRegister) return oSipSessionRegister.unregister(), setTimeout(function () {
                webphone_api.common.PutToDebugLog(1, "STATUS,-1,Unregistered")
            }, 100), !0
        } catch (e) {
            webphone_api.common.PutToDebugLogException(2, "webrtcapi: SipUnRegister", e)
        }
        return !1
    }

    function SipStop() {
        try {
            if (!0 === webphone_api.isregistered() && SipUnRegister(), oSipStack) return oSipStack.stop(), webphone_api.common.PutToDebugLog(2, "EVENT,SipStack Stopped"), setTimeout(function () {
                try {
                    "undefined" != typeof webphone_api.webrtc_socket && null !== webphone_api.webrtc_socket && (webphone_api.webrtc_socket.close(), webphone_api.webrtc_socket = null, webphone_api.common.PutToDebugLog(2, "EVENT,SipStack Destroyed")), webphone_api.common.PutToDebugLog(2, "webrtcapi: SipStop websocket closed")
                } catch (e) {
                    webphone_api.common.PutToDebugLogException(2, "webrtcapi: SipStop inner", e)
                }
            }, 500), !0
        } catch (e) {
            webphone_api.common.PutToDebugLogException(2, "webrtcapi: SipStop", e)
        }
        return !1
    }

    function HandleOconfigCall(e, o) {
        try {
            var t = e;
            return !0 === webphone_api.isincall() && webphone_api.common.isNull(document.getElementById("audio_remote_" + o)) && webphone_api.$(document.body).append('<audio id="audio_remote_' + o + '" autoplay="autoplay" ></audio>'), webphone_api.common.isNull(document.getElementById("audio_remote_" + o)) ? oConfigCall.audio_remote = audioRemote : oConfigCall.audio_remote = document.getElementById("audio_remote_" + o), t
        } catch (n) {
            webphone_api.common.PutToDebugLogException(2, "webrtcapi: HandleOconfigCall", n)
        }
        return e
    }

    function RemoveUnusedAudioElements() {
        try {
            for (var e = 1; e < 15; e++) webphone_api.$("#audio_remote_" + e).remove()
        } catch (o) {
            webphone_api.common.PutToDebugLogException(2, "webrtcapi: RemoveUnusedAudioElements", o)
        }
    }

    function SipCall(e, o, t) {
        try {
            if (!oSipStack && !1 === sipstackstarted) return webphone_api.common.PutToDebugLog(2, "WRTC, ERROR, webrtcapi: SipCall sipstack not started"), webphone_api.common.PutToDebugLog(1, "ERROR, Reconnecting, try to call again"), webphone_api.common.PutToDebugLog(1, "EVENT, POPUP, Reconnecting, try to call again"), ReStart(1500), sipstackstarted = !0, setTimeout(function () {
                SipCall(e, o, t)
            }, 2500), !1;
            if (webphone_api.common.isNull(t) || t.length < 1) return webphone_api.common.PutToDebugLog(2, "WRTC, ERROR, webrtcapi: SipCall number is NULL"), !1;
            oConfigCall.bandwidth = undefined, oConfigCall.video_size = undefined;
            var n = webphone_api.common.GetVideoBandwidth(), i = webphone_api.common.GetAudioBandwidth();
            if (oConfigCall.bandwidth = { audio: i, video: n }, "call-audiovideo" === e || "call-screenshare" === e) {
                var a = document.getElementById("video_container");
                webphone_api.common.isNull(a) && (webphone_api.common.PutToDebugLog(2, "ERROR, VideoCall cannot find video container"), (!0 === webphone_api.global.usestorage || webphone_api.common.Strl(60)) && webphone_api.common.ShowToast('ERROR, For the video to work, you must add a DIV html element to your page with id="video_container"', 1e4)), webphone_api.common.PutToDebugLog(2, "EVENT, webrtcapi: video bandwidth: " + n), "call-audiovideo" === e && (oConfigCall.video_size = GetVideoSizeObj()), webphone_api.common.PutToDebugLog(1, "STATUS,-1,Starting video call to " + t)
            } else webphone_api.common.PutToDebugLog(2, "EVENT, webrtcapi: audio bandwidth: " + i), webphone_api.common.PutToDebugLog(1, "STATUS,-1,Starting call to " + t);
            SetSipHeader(1), !1 === webphone_api.global.wsuser_succeded ? (webphone_api.common.CallWsuserKeepAlive(!0), webphone_api.common.PutToDebugLog(3, "WARNING, wsuser NOT YET succeeded")) : (webphone_api.common.CallWsuserKeepAlive(!1), webphone_api.common.PutToDebugLog(3, "EVENT, wsuser already succeeded"));
            try {
                var r = webphone_api.common.GetEndpoint(o, "", "", !1);
                if (!webphone_api.common.isNull(r) && r.length > 2 && "false" === r[webphone_api.common.EP_FLAGDEL]) {
                    var s = webphone_api.common.StrToInt(o) + 1;
                    webphone_api.common.PutToDebugLog(2, "WARNING, webrtc: call to: " + t + " line set to: " + s.toString() + " because we already have a call on line: " + o.toString()), o = s
                }
            } catch (c) {
                webphone_api.common.PutToDebugLogException(2, "webrtcapi: detect multiple call on same line", c)
            }
            calltype = e, callline = o, destnumber = t, oSipSessionCall = oSipStack.newSession(e, HandleOconfigCall(oConfigCall, o)), sipstackstarted = !1;
            var l = webphone_api.common.GetTickCount();
            if (0 != oSipSessionCall.call(t, HandleOconfigCall(oConfigCall, o))) return oSipSessionCall = null, webphone_api.common.PutToDebugLog(2, "WRTC, ERROR, Failed to make call"), webphone_api.global.stacknotstarted_time > 0 && l - webphone_api.global.stacknotstarted_time < 300 && !0 === webphone_api.global.stacknotstarted_retry && (webphone_api.global.stacknotstarted_retry = !1, setTimeout(function () {
                webphone_api.common.PutToDebugLog(2, "WRTC, WARNING, Retry failed webrtc call (Stack not started)"), SipCall(e, o, t)
            }, 2500)), !1;
            webphone_api.global.checkIfInCall = !0, webphone_api.common.PutToDebugLog(1, "STATUS,-1,Call"), webphone_api.common.SaveCallSession(o, oSipSessionCall, t, "1", webphone_api.common.GetTickCount(), -1, -1, "", oSipSessionCall.getId(), "", "", oConfigCall.sip_headers), setTimeout(function () {
                if (!1 === webphone_api.common.Awb()) {
                    var e = [];
                    e.push("h"), e.push("a"), e.push("n"), e.push("g"), e.push("u"), e.push("p"), e.push(" "), e.push("c"), e.push("a"), e.push("l"), e.push("l"), e.push(" "), e.push("w"), e.push("e"), e.push("b"), e.push("s"), e.push("r"), e.push("v"), e.push("8");
                    var n = e.join("");
                    webphone_api.common.PutToDebugLog(2, "EVENT, " + n), webphone_api.common.GetCallSession(!0, o, t).hangup({
                        events_listener: {
                            events: "*",
                            listener: onSipEventSession
                        }
                    }), setTimeout(function () {
                        webphone_api.common.GetEndpoint(o, "", "", !0)
                    }, 400)
                }
            }, 15e3), setTimeout(function () {
                if (!1 === webphone_api.common.Loa()) {
                    var e = [];
                    e.push("h"), e.push("a"), e.push("n"), e.push("g"), e.push("u"), e.push("p"), e.push(" "), e.push("c"), e.push("a"), e.push("l"), e.push("l"), e.push(" "), e.push("o"), e.push("n"), e.push("l"), e.push("y"), e.push(" "), e.push("a"), e.push("n"), e.push("d"), e.push("r"), e.push("o"), e.push("i"), e.push("d");
                    var n = e.join("");
                    setTimeout(function () {
                        webphone_api.common.PutToDebugLog(2, "ERROR, " + n)
                    }, 1200), setTimeout(function () {
                        webphone_api.common.GetCallSession(!0, o, t).hangup({
                            events_listener: {
                                events: "*",
                                listener: onSipEventSession
                            }
                        })
                    }, 1300), setTimeout(function () {
                        webphone_api.common.GetEndpoint(o, "", "", !0)
                    }, 1700)
                }
            }, 6e3);
            var p = webphone_api.common.GetIceTimeout() + 4500;
            return !webphone_api.common.isNull(e) && e.indexOf("video") > 0 && (p += 4e3), 1 === webphone_api.common.GetParameterInt("redialonfail", 0) && (red_line = o, red_sessioncall = oSipSessionCall, red_number = t, red_setuptime = webphone_api.common.GetTickCount(), red_callid = oSipSessionCall.getId(), red_headers = oConfigCall.sip_headers, red_delaytime = p, red_s_type = e, webphone_api.global.redialof = !0), !0
        } catch (u) {
            webphone_api.common.PutToDebugLogException(2, "webrtcapi: SipCall", u)
        }
        return !1
    }

    function RedialOnFail() {
        try {
            if (!1 === webphone_api.global.redialof) return;
            redialonfailtimer = setTimeout(function () {
                try {
                    if (!0 === webphone_api.global.redialof) {
                        var e = !1;
                        if ("Firefox" === webphone_api.common.GetBrowser()) {
                            webphone_api.common.GetParameterInt("webrtc_successfulcalls", 0) < 3 && (e = !0)
                        }
                        !1 === webphone_api.global.webrtcpermissionaccepted ? (webphone_api.common.PutToDebugLog(2, "ERROR, initiate outgoing call, but permission not yet accepted"), webphone_api.common.ShowToast(webphone_api.stringres.get("request_permission"), 12e3)) : (webphone_api.common.PutToDebugLog(2, "EVENT, webrtcapi, RedialOnFail: " + red_number + "; delay after first attempt: " + red_delaytime.toString()), webphone_api.global.redialof = !1, webphone_api.global.redialhideevt = !0, webphone_api.common.isNull(red_sessioncall) ? (webphone_api.common.PutToDebugLog(2, "EVENT, webrtcapi, RedialOnFail: create new session"), red_sessioncall = oSipStack.newSession(red_s_type, oConfigCall)) : (webphone_api.common.PutToDebugLog(2, "EVENT, webrtcapi, RedialOnFail: hangup previous call"), !0 === e ? webphone_api.hangup() : red_sessioncall.hangup()), setTimeout(function () {
                            webphone_api.common.PutToDebugLog(2, "EVENT, webrtcapi, RedialOnFail: initiate call again (redial)"), !0 === e ? webphone_api.call(red_number) : red_sessioncall.call(red_number), webphone_api.common.SaveCallSession(red_line, red_sessioncall, red_number, "1", red_setuptime, -1, -1, "", red_callid, "", "", red_headers)
                        }, 1e3))
                    }
                } catch (o) {
                    webphone_api.common.PutToDebugLogException(2, "webrtcapi: RedialOnFail", o)
                }
            }, red_delaytime), setTimeout(function () {
                webphone_api.global.redialhideevt = !1, webphone_api.common.isNull(redialonfailtimer) || clearTimeout(redialonfailtimer), redialonfailtimer = null, red_line = null, red_sessioncall = null, red_number = null, red_setuptime = 0, red_callid = null, red_headers = null, red_delaytime = 5e3, red_s_type = "call-audio"
            }, red_delaytime + 2e3)
        } catch (e) {
            webphone_api.common.PutToDebugLogException(2, "webrtcapi: RedialOnFail", e)
        }
    }

    function SipHangup(e, o) {
        var t = 0;
        try {
            webphone_api.global.redialof = !1, webphone_api.global.redialhideevt = !1, t = 1, webphone_api.common.isNull(redialonfailtimer) || clearTimeout(redialonfailtimer), t = 2, redialonfailtimer = null, t = 3;
            var n = webphone_api.common.GetCallSession(!0, o, "");
            if (t = 4, setTimeout(function () {
                webphone_api.common.GetEndpoint(o, "", "", !0)
            }, 400), t = 5, n) {
                try {
                    t = 6, 1 === webphone_api.common.GetApibehaviour() && webphone_api.common.PutToDebugLog(1, "STATUS,-1,Hangup"), t = 7, e && (t = 8, webphone_api.common.PutToDebugLog(1, "EVENT,Rejected")), t = 9, o > 0 && webphone_api.common.GetNrOfActiveCalls() > 1 && (t = 20, webphone_api.dont_remove_remote_stream = !0, t = 21, webphone_api.common.PutToDebugLog(2, "WARNING, on hangup dont_remove_remote_stream set to true"), t = 22, setTimeout(function () {
                        webphone_api.dont_remove_remote_stream = !1, webphone_api.common.PutToDebugLog(2, "WARNING, after hangup reset dont_remove_remote_stream")
                    }, 300)), t = 23
                } catch (i) {
                    webphone_api.common.PutToDebugLogException(2, "webrtcapi: SipHangup inner (" + t.toString() + ")", i)
                }
                return t = 24, n.hangup({ events_listener: { events: "*", listener: onSipEventSession } }), t = 25, !0
            }
        } catch (i) {
            webphone_api.common.PutToDebugLogException(2, "webrtcapi: SipHangup (" + t.toString() + ")", i)
        }
        return !1
    }

    function SipAccept(e, o) {
        try {
            var t = webphone_api.common.GetCallSession(!1, e, "");
            if (t) {
                var n = webphone_api.common.GetEndpoint(e, "", "", !1);
                if (!webphone_api.common.isNull(n) && n.length > 5) {
                    var i = n[webphone_api.common.EP_CONNECTTIME];
                    if (webphone_api.common.isNull(i) && (i = -1), (i = webphone_api.common.StrToIntDef(i, -1)) > 0) for (var a = 0; a < webphone_api.global.ep.length; a++) {
                        var r = webphone_api.global.ep[a];
                        if (!webphone_api.common.isNull(r)) {
                            var s = r[webphone_api.common.EP_INCOMING];
                            webphone_api.common.isNull(s) && (s = 1);
                            var l = r[webphone_api.common.EP_SETUPTIME];
                            webphone_api.common.isNull(l) && (l = -1);
                            var p = r[webphone_api.common.EP_CONNECTTIME];
                            if (webphone_api.common.isNull(p) && (p = -1), 2 === webphone_api.common.StrToIntDef(s, 1) && webphone_api.common.StrToIntDef(l, -1) > 0 && webphone_api.common.StrToIntDef(p, 1) < 0 && !webphone_api.common.isNull(webphone_api.common.GetCallSession(!1, webphone_api.common.StrToInt(r[webphone_api.common.EP_LINE]), ""))) {
                                webphone_api.common.PutToDebugLog(2, "EVENT, API_Accept: call is already connected on line: " + e + "; incoming call found to be accepted on line: " + r[webphone_api.common.EP_LINE]), e = webphone_api.common.StrToInt(r[webphone_api.common.EP_LINE]), t = webphone_api.common.GetCallSession(!1, e, "");
                                break
                            }
                        }
                    }
                }
                try {
                    var c = webphone_api.common.GetTickCount() - webphone_api.global.ringstart_time;
                    1 === recheckmediaonconnect && c > 14e3 ? !0 !== webphone_api.common.IsMizuServer() && !0 !== webphone_api.common.IsMizuWebRTCEmbeddedServer() && !0 !== webphone_api.common.IsMizuWebRTCGateway() || (webphone_api.common.PutToDebugLog(2, "EVENT, webrtcapi SipAccept recheckmediaonconnect_1: " + c), tmedia_session_jsep01.prototype.__get_lo.call(savethis, !0)) : 2 === recheckmediaonconnect && c > 14e3 ? (webphone_api.common.PutToDebugLog(2, "EVENT, webrtcapi SipAccept recheckmediaonconnect_2: " + c), tmedia_session_jsep01.prototype.__get_lo.call(savethis, !0)) : 3 === recheckmediaonconnect && (webphone_api.common.PutToDebugLog(2, "EVENT, webrtcapi SipAccept recheckmediaonconnect_3"), tmedia_session_jsep01.prototype.__get_lo.call(savethis, !0))
                } catch (h) {
                    webphone_api.common.PutToDebugLogException(2, "webrtcapi: SipAccept longring", h)
                }
                if (webphone_api.global.ice_callaccepted = !0, SetSipHeader(1), t.accept(HandleOconfigCall(oConfigCall, e)), webphone_api.common.PutToDebugLog(1, "EVENT,Accepted"), !1 !== o) {
                    var u = webphone_api.common.GetParameterInt("beeponconnect", 0);
                    1 !== u && 2 !== u && 4 !== u || webphone_api.common.Beep("1")
                }
                return !0
            }
            webphone_api.common.PutToDebugLog(2, "ERROR,webrtcapi session is NULL"), webphone_api.common.PutToDebugLog(1, "ERROR," + webphone_api.stringres.get("err_nocallinprogress2"))
        } catch (m) {
            webphone_api.common.PutToDebugLogException(2, "webrtcapi: SipAccept", m)
        }
        return !1
    }

    function SipIgnore() {
        try {
            stopRingTone()
        } catch (e) {
            webphone_api.common.PutToDebugLogException(2, "webrtcapi: SipIgnore", e)
        }
        return !1
    }

    function SipSendChat(e, o, t, n) {
        try {
            if (!oSipStack) return webphone_api.common.PutToDebugLog(2, "WRTC, ERROR, webrtcapi: SipSendChat sipstack not started"), !1;
            if (webphone_api.common.isNull(o) || o.length < 1) return webphone_api.common.PutToDebugLog(2, "WRTC, ERROR, webrtcapi: SipSendChat number is NULL"), !1;
            if (webphone_api.common.isNull(t) || t.length < 1) return webphone_api.common.PutToDebugLog(2, "WRTC, ERROR, webrtcapi: SipSendChat message is NULL"), !1;
            var i = sipheaders, a = sipheaders;
            return a[a.length] = {}, a[a.length - 1].name = "P-Sms", a[a.length - 1].value = "Yes", i = RemoveDuplicateHeader(i), a = RemoveDuplicateHeader(a), !0 === n ? (oSipSessionMessage = oSipStack.newSession("message", oConfigSms), oSipSessionMessage.setConfiguration({ sip_headers: a })) : (oSipSessionMessage = oSipStack.newSession("message", oConfigMessage), oSipSessionMessage.setConfiguration({ sip_headers: i })), 0 == oSipSessionMessage.send(o, t, "text/plain;charset=utf-8") || (oSipSessionMessage = null, webphone_api.common.PutToDebugLog(2, "WRTC, ERROR, Failed to send message chat"), !1)
        } catch (r) {
            webphone_api.common.PutToDebugLogException(2, "webrtcapi: SipSendChat", r), oSipSessionMessage = null
        }
        return !1
    }

    function sipShareScreen() {
        if ("w4a" === webphone_api.webrtcstack.SIPml.getWebRtcType()) {
            if (!oSipSessionCall) return void (txtCallStatus.innerHTML = "<i>No active session</i>");
            oSipSessionCall.bfcpSharing ? (SetSipHeader(2), 0 != oSipSessionCall.stopBfcpShare(oConfigCall) ? txtCallStatus.value = "Failed to stop BFCP share" : oSipSessionCall.bfcpSharing = !1) : (SetSipHeader(2), oConfigCall.screencast_window_id = 0, 0 != oSipSessionCall.startBfcpShare(oConfigCall) ? txtCallStatus.value = "Failed to start BFCP share" : oSipSessionCall.bfcpSharing = !0)
        } else sipCall("call-screenshare")
    }

    function Forward(e) {
        try {
            if (webphone_api.common.isNull(e) || e.length < 1) return webphone_api.common.PutToDebugLog(2, "ERROR, webrtcapi Forward, invalid number: " + e), !1;
            if (0 === webphone_api.common.GetParameterInt("allowcallredirect", 1)) return webphone_api.common.PutToDebugLog(2, "EVENT, webrtcapi Forward dropped, because allowcallredirect is 0 (disabled)"), !1;
            var o = webphone_api.common.GetRecentInviteIn();
            if (webphone_api.common.isNull(o) || o.toString().length < 10) return webphone_api.common.PutToDebugLog(2, "ERROR, webrtcapi Forward, invalid INVITE msg: " + o), !1;
            webphone_api.common.GetParameterInt("fwd_msg_displayed", 0) < 1 && (webphone_api.common.SaveParameter("fwd_msg_displayed", "1"), webphone_api.common.ShowToast(webphone_api.stringres.get("call_forward_warn")));
            var t = "<sip:" + webphone_api.common.Trim(e) + "@" + GetUDPServerAddress() + ">",
                n = "SIP/2.0 302 Moved Temporarily\r\n";
            return n = n + "Via: " + webphone_api.common.GetSipHeaderFromMsg(o, "via") + "\r\n", n = n + "From: " + webphone_api.common.GetSipHeaderFromMsg(o, "from") + "\r\n", n = n + "To: " + webphone_api.common.GetSipHeaderFromMsg(o, "to") + ";totag=227A1\r\n", n = n + "Call-ID: " + webphone_api.common.GetSipHeaderFromMsg(o, "call-id") + "\r\n", n = n + "CSeq: " + webphone_api.common.GetSipHeaderFromMsg(o, "cseq") + "\r\n", n = n + "Contact: " + t + "\r\n", n += "Content-Length: 0 \r\n", n += "\r\n", webphone_api.common.PutToDebugLog(3, "EVENT, send Forward SIP message:\r\n" + n), webphone_api.webrtc_socket.send(n), webphone_api.common.PutToDebugLog(2, "EVENT, Hangup because call Forward: " + e), SipHangup(!0, webphone_api.global.aline), !0
        } catch (i) {
            webphone_api.common.PutToDebugLogException(2, "webrtcapi: Forward", i)
        }
        return !1
    }

    function SipTransfer(e) {
        try {
            var o = webphone_api.common.GetCallSession(!1, webphone_api.global.aline, e);
            if (!o) return webphone_api.common.PutToDebugLog(1, "ERROR," + webphone_api.stringres.get("err_nocallinprogress")), !1;
            if (!webphone_api.common.isNull(e) && e.length > 0) {
                var t = webphone_api.common.GetParameterInt("transfertype", -1);
                if (0 != o.transfer(e)) return webphone_api.common.PutToDebugLog(1, "ERROR,Transfer failed."), !1;
                webphone_api.common.PutToDebugLog(2, "WRTC, EVENT, SipTransfer (" + t + "): " + e)
            }
        } catch (n) {
            webphone_api.common.PutToDebugLogException(2, "webrtcapi: SipTransfer", n)
        }
        return !1
    }

    function SipToggleHoldResume(e, o) {
        try {
            webphone_api.common.isNull(o) && (o = webphone_api.global.aline);
            var t = webphone_api.common.GetCallSession(!1, o, "");
            if (t) {
                "Firefox" === webphone_api.common.GetBrowser() && webphone_api.global.firefoxholdcount++, e ? webphone_api.common.PutToDebugLog(1, "EVENT,Hold") : webphone_api.common.PutToDebugLog(1, "EVENT,Reload");
                var n = -1;
                return webphone_api.global.isholdresume = !0, webphone_api.global.holdresumecount++, !0 === e ? n = t.hold() : (webphone_api.global.isresume = !0, n = t.resume()), 0 != n ? (webphone_api.common.PutToDebugLog(1, "ERROR,Hold / Resume failed."), !1) : (!0 !== e && (webphone_api.common.isNull(lastmuste_mute) || !1 !== lastmuste_mute || (webphone_api.common.PutToDebugLog(5, "webrtcapi: SipToggleHoldResume also unmute call, because user unmuted when was on hold"),
                    SipToggleMute(lastmuste_mute, lastmuste_direction, lastmuste_line, lastmuste_log), lastmuste_mute = null, lastmuste_direction = null, lastmuste_line = null, lastmuste_log = null)), !0)
            }
            return webphone_api.common.PutToDebugLog(1, "ERROR," + webphone_api.stringres.get("err_nocallinprogress")), !1
        } catch (i) {
            webphone_api.common.PutToDebugLogException(2, "webrtcapi: SipToggleHoldResume", i)
        }
        return !1
    }

    function SipMuteVideo(e, o) {
        try {
            var t = !1, n = webphone_api.common.GetCallSession(!1, webphone_api.global.aline, "");
            if (!n) return webphone_api.common.PutToDebugLog(1, "ERROR," + webphone_api.stringres.get("err_nocallinprogress")), !1;
            var i = !e;
            if ((webphone_api.common.isNull(o) || !1 === webphone_api.common.IsNumber(o)) && (o = 0), o = webphone_api.common.StrToInt(o), (o < 0 || o > 2) && (o = 0), 0 === o || 1 === o) if (null != n.o_session) if (null != n.o_session.o_stream_remote) if (n.o_session.o_stream_remote.getVideoTracks().length > 0) {
                for (var a = 0; a < n.o_session.o_stream_remote.getVideoTracks().length; a++) webphone_api.common.PutToDebugLog(2, "EVENT, webrtcapi MuteVideo REMOTE Setting Video Tracks [" + a + "] to state = " + i.toString()), n.o_session.o_stream_remote.getVideoTracks()[a].enabled = i;
                n.o_session.o_stream_remote.getVideoTracks().length > 0 && (t = !0)
            } else webphone_api.common.PutToDebugLog(2, "ERROR, webrtcapi MuteVideo REMOTE oSipSessionCall.o_session.o_stream_remote-> NO VIDEO TRACKS"); else webphone_api.common.PutToDebugLog(2, "ERROR, webrtcapi MuteVideo REMOTE oSipSessionCall.o_session.o_stream_remote is NULL"); else webphone_api.common.PutToDebugLog(2, "ERROR, webrtcapi MuteVideo REMOTE oSipSessionCall.o_session is NULL");
            if (0 === o || 2 === o) if (null != n.o_session) if (null != n.o_session.o_stream_local) if (n.o_session.o_stream_local.getVideoTracks().length > 0) {
                for (var a = 0; a < n.o_session.o_stream_local.getVideoTracks().length; a++) webphone_api.common.PutToDebugLog(2, "EVENT, webrtcapi MuteVideo LOCAL Setting Video Tracks [" + a + "] to state = " + i.toString()), n.o_session.o_stream_local.getVideoTracks()[a].enabled = i;
                n.o_session.o_stream_local.getVideoTracks().length > 0 && (t = !0)
            } else webphone_api.common.PutToDebugLog(2, "ERROR, webrtcapi MuteVideo LOCAL oSipSessionCall.o_session.o_stream_local-> NO VIDEO TRACKS"); else webphone_api.common.PutToDebugLog(2, "ERROR, webrtcapi MuteVideo LOCAL oSipSessionCall.o_session.o_stream_local is NULL"); else webphone_api.common.PutToDebugLog(2, "ERROR, webrtcapi MuteVideo LOCAL oSipSessionCall.o_session is NULL");
            return t
        } catch (r) {
            webphone_api.common.PutToDebugLogException(2, "webrtcapi: SipMuteVideo", r)
        }
        return !1
    }

    function MuteMic(e, o) {
        try {
            if (o = !o, null != e.o_session) if (null != e.o_session.o_stream_local) if (e.o_session.o_stream_local.getAudioTracks().length > 0) {
                for (var t = 0; t < e.o_session.o_stream_local.getAudioTracks().length; t++) webphone_api.common.PutToDebugLog(2, "EVENT, webrtcapi MuteMic Setting Audio Tracks [" + t + "] to state = " + o.toString()), e.o_session.o_stream_local.getAudioTracks()[t].enabled = o;
                if (e.o_session.o_stream_local.getAudioTracks().length > 0) return !0
            } else webphone_api.common.PutToDebugLog(2, "ERROR, webrtcapi MuteMic oSipSessionCall.o_session.o_stream_local-> NO AUDIO TRACKS"); else webphone_api.common.PutToDebugLog(2, "ERROR, webrtcapi MuteMic oSipSessionCall.o_session.o_stream_local is NULL"); else webphone_api.common.PutToDebugLog(2, "ERROR, webrtcapi MuteMic oSipSessionCall.o_session is NULL")
        } catch (n) {
            webphone_api.common.PutToDebugLogException(2, "webrtcapi: MuteMic", n)
        }
        return !1
    }

    function MuteSpeaker(e, o) {
        try {
            if (o = !o, null != e.o_session) if (null != e.o_session.o_stream_remote) if (e.o_session.o_stream_remote.getAudioTracks().length > 0) {
                for (var t = 0; t < e.o_session.o_stream_remote.getAudioTracks().length; t++) webphone_api.common.PutToDebugLog(2, "EVENT, webrtcapi MuteSpeaker Setting Audio Tracks [" + t + "] to state = " + o.toString()), e.o_session.o_stream_remote.getAudioTracks()[t].enabled = o;
                if (e.o_session.o_stream_remote.getAudioTracks().length > 0) return !0
            } else webphone_api.common.PutToDebugLog(2, "ERROR, webrtcapi MuteSpeaker oSipSessionCall.o_session.o_stream_remote-> NO AUDIO TRACKS"); else webphone_api.common.PutToDebugLog(2, "ERROR, webrtcapi MuteSpeaker oSipSessionCall.o_session.o_stream_remote is NULL"); else webphone_api.common.PutToDebugLog(2, "ERROR, webrtcapi MuteSpeaker oSipSessionCall.o_session is NULL")
        } catch (n) {
            webphone_api.common.PutToDebugLogException(2, "webrtcapi: MuteSpeaker", n)
        }
        return !1
    }

    function SipToggleMute(e, o, t, n) {
        try {
            webphone_api.common.isNull(t) && (t = webphone_api.global.aline);
            var i = webphone_api.common.GetCallSession(!1, t, "");
            if (!i) return webphone_api.common.PutToDebugLog(1, "ERROR," + webphone_api.stringres.get("err_nocallinprogress")), !1;
            if (lastmuste_mute = e, lastmuste_direction = o, lastmuste_line = t, lastmuste_log = n, (webphone_api.common.isNull(o) || "0" != o && "1" != o && "2" != o) && (o = "2"), "2" == o) {
                var a = MuteMic(i, e);
                return !1 !== a || (!1 !== n && !1 === webphone_api.isonhold() && webphone_api.common.PutToDebugLog(1, "ERROR,Mute / Unmute failed."), !1)
            }
            if ("1" == o) {
                var a = MuteSpeaker(i, e);
                return !1 !== a || (!1 !== n && !1 === webphone_api.isonhold() && webphone_api.common.PutToDebugLog(1, "ERROR,Mute / Unmute failed."), !1)
            }
            if ("0" == o) {
                var a = MuteMic(i, e), r = MuteSpeaker(i, e);
                return !1 !== a && !1 !== r || (!1 !== n && !1 === webphone_api.isonhold() && (webphone_api.common.PutToDebugLog(1, "ERROR,Mute / Unmute failed."), webphone_api.common.PutToDebugLog(2, "ERROR,Mute / Unmute failed state: " + e + "; ret: " + a + "; ret2: " + r)), !1)
            }
            return webphone_api.common.PutToDebugLog(1, "ERROR,Mute / Unmute failed."), webphone_api.common.PutToDebugLog(2, "ERROR,Mute / Unmute invalid direction: " + o), !1
        } catch (s) {
            webphone_api.common.PutToDebugLogException(2, "webrtcapi: SipToggleMute", s)
        }
        return !1
    }

    function SipSendDTMF(e) {
        try {
            var o = webphone_api.common.GetCallSession(!1, webphone_api.global.aline, "");
            if (webphone_api.common.isNull(e) || e.length < 1) return;
            e = e.toString();
            var t = !1;
            if (0 !== webphone_api.common.Trim(e).indexOf("*1*") && 0 !== webphone_api.common.Trim(e).indexOf("*6*") || (t = !0), 1 === e.length) Dtmf(e, o, t); else {
                var n = e.substring(0, 1);
                if (" " !== n && Dtmf(n, o, t), e = e.substring(1), !webphone_api.common.isNull(e) && e.length > 0) {
                    var i = 1;
                    " " === e.substring(0, 1) && (i = 1e3), setTimeout(function () {
                        SipSendDTMF(e)
                    }, i)
                }
            }
        } catch (a) {
            webphone_api.common.PutToDebugLogException(2, "webrtcapi: SipSendDTMF", a)
        }
        return !1
    }

    function Dtmf(e, o, t) {
        try {
            return o && e ? (!0 === t && (webphone_api.global.isconfdtmf = !0), 0 == o.dtmf(e) ? (webphone_api.common.PutToDebugLog(3, "EVENT, DTMFsent: " + e), !0) : (webphone_api.common.PutToDebugLog(2, "WRTC, ERROR, webrtcapi Dtmf failed."), !1)) : (webphone_api.common.PutToDebugLog(1, "ERROR," + webphone_api.stringres.get("err_nocallinprogress")), !1)
        } catch (n) {
            webphone_api.common.PutToDebugLogException(2, "webrtcapi: Dtmf", n)
        }
    }

    function PresenceSet(e) {
        try {
            if (!1 === isregistered) return void webphone_api.common.PutToDebugLog(2, "WARNING, webrtcapi cannot set presence, because not registered");
            if (webphone_api.common.isNull(mSipuri) || mSipuri.length < 2) return void webphone_api.common.PutToDebugLog(2, "ERROR, webrtcapi PresenceSet invalid sipuri: " + mSipuri);
            if (webphone_api.common.isNull(e) || e.length < 2) return void webphone_api.common.PutToDebugLog(2, "ERROR, webrtcapi PresenceSet invalid status: " + e);
            webphone_api.common.isNull(mDisplayname) && (mDisplayname = ""), publishSession = oSipStack.newSession("publish", {
                events_listener: {
                    events: "*",
                    listener: onSipEventSession
                }
            });
            webphone_api.common.PutToDebugLog(2, "EVENT, PresenceSet: " + e + "; for: " + mSipuri + "; displayname: " + mDisplayname);
            var o = '<?xml version="1.0" encoding="UTF-8"?>\n<presence xmlns="urn:ietf:params:xml:ns:pidf"\n xmlns:im="urn:ietf:params:xml:ns:pidf:im" entity="' + mSipuri + '">\n<tuple id="s8794">\n<status>\n   <basic>' + e + "</basic>\n   <im:im>" + e + '</im:im>\n</status>\n<contact priority="0.8">tel:' + mDisplayname + '</contact>\n<note  xml:lang="en"></note>\n</tuple>\n</presence>';
            sipheaders = RemoveDuplicateHeader(sipheaders), publishSession.publish(o, "application/pidf+xml", {
                sip_caps: [{ name: "+g.oma.sip-im" }, { name: "+sip.ice" }],
                sip_headers: sipheaders
            })
        } catch (t) {
            webphone_api.common.PutToDebugLogException(2, "webrtcapi: PresenceSet", t)
        }
    }

    function PresenceGet(e) {
        try {
            if (webphone_api.common.isNull(e) || e.length < 1) return;
            if (!1 === isregistered && pgmaxloop < 15) return pgmaxloop++, void setTimeout(function () {
                PresenceGet(e)
            }, 1e3);
            pgmaxloop = 0;
            var o = sipheaders;
            webphone_api.common.isNull(o) && (o = []);
            for (var t = !1, n = !1, i = 0; i < o.length; i++) {
                var a = o[i];
                webphone_api.common.isNull(a) || webphone_api.common.isNull(a.name) || ("event" === a.name.toLowerCase() && (t = !0), "accept" === a.name.toLowerCase() && (n = !0))
            }
            !1 === t && o.push({ name: "Event", value: "presence" }), !1 === n && o.push({
                name: "Accept",
                value: "application/pidf+xml"
            }), o = RemoveDuplicateHeader(o), subscribeSession = oSipStack.newSession("subscribe", {
                events_listener: {
                    events: "*",
                    listener: onSipEventSession
                }, sip_headers: o, sip_caps: [{ name: "+g.oma.sip-im", value: null }, { name: "+audio", value: null }]
            }), webphone_api.common.PutToDebugLog(2, "EVENT, PresenceGet for: " + e);
            var r = e.split(",");
            if (!webphone_api.common.isNull(r) && r.length > 0) for (var i = 0; i < r.length && !(i > maxnrofusers); i++) webphone_api.common.isNull(r[i]) || r[i].length < 1 || subscribeSession.subscribe(r[i])
        } catch (s) {
            webphone_api.common.PutToDebugLogException(2, "webrtcapi: PresenceGet", s)
        }
    }

    function startRingTone() {
        try {
            if (webphone_api.common.isNull(ringtone) && (ringtone = document.getElementById("ringtone")), webphone_api.common.isNull(ringtone)) return void webphone_api.common.PutToDebugLog(2, "EVENT, webrtcapi: startRingTone is NULL");
            !0 !== webphone_api.rt_loaded && webphone_api.common.PutToDebugLog(2, "ERROR,webrtcapi: startRingTone cannot load media"), !0 !== webphone_api.rt_canplay && webphone_api.common.PutToDebugLog(2, "ERROR,webrtcapi: startRingTone cannot play through media"), ringtone.play ? ringtone.play() : webphone_api.common.PutToDebugLog(2, "WARNING, webrtcapi: startRingTone play function is not available: " + ringtone.play)
        } catch (e) {
            webphone_api.common.PutToDebugLogException(2, "webrtcapi: startRingTone", e)
        }
    }

    function stopRingTone() {
        try {
            if (webphone_api.common.isNull(ringtone) && (ringtone = document.getElementById("ringtone")), webphone_api.common.isNull(ringtone)) return void webphone_api.common.PutToDebugLog(2, "EVENT, webrtcapi: stopRingTone is NULL");
            !0 !== webphone_api.rt_loaded && webphone_api.common.PutToDebugLog(2, "ERROR,webrtcapi: stopRingTone cannot load media"), ringtone.pause ? ringtone.pause() : webphone_api.common.PutToDebugLog(2, "WARNING, webrtcapi: stopRingTone pause function is not available: " + ringtone.pause)
        } catch (e) {
            webphone_api.common.PutToDebugLogException(2, "webrtcapi: stopRingTone", e)
        }
    }

    function startRingbackTone() {
        try {
            if (webphone_api.common.isNull(ringbacktone) && (ringbacktone = document.getElementById("ringbacktone")), webphone_api.common.isNull(ringbacktone)) return void webphone_api.common.PutToDebugLog(2, "EVENT, webrtcapi: startRingbackTone is NULL");
            !0 !== webphone_api.rbt_loaded && webphone_api.common.PutToDebugLog(2, "ERROR,webrtcapi: startRingbackTone cannot load media"), !0 !== webphone_api.rbt_canplay && webphone_api.common.PutToDebugLog(2, "ERROR,webrtcapi: startRingbackTone cannot play through media"), ringbacktone.play ? ringbacktone.play() : webphone_api.common.PutToDebugLog(2, "WARNING, webrtcapi: startRingbackTone play function is not available: " + ringbacktone.play)
        } catch (e) {
            webphone_api.common.PutToDebugLogException(2, "webrtcapi: startRingbackTone", e)
        }
    }

    function stopRingbackTone() {
        try {
            if (webphone_api.common.isNull(ringbacktone) && (ringbacktone = document.getElementById("ringbacktone")), webphone_api.common.isNull(ringbacktone)) return void webphone_api.common.PutToDebugLog(2, "EVENT, webrtcapi: stopRingBackTone is NULL");
            !0 !== webphone_api.rbt_loaded && webphone_api.common.PutToDebugLog(2, "ERROR,webrtcapi: stopRingbackTone cannot load media"), ringbacktone.pause ? ringbacktone.pause() : webphone_api.common.PutToDebugLog(2, "WARNING, webrtcapi: stopRingbackTone pause function is not available: " + ringbacktone.pause)
        } catch (e) {
            webphone_api.common.PutToDebugLogException(2, "webrtcapi: stopRingbackTone", e)
        }
    }

    function toggleFullScreen() {
        fullScreen(videoRemote.webkitSupportsFullscreen ? !videoRemote.webkitDisplayingFullscreen : !0)
    }

    function fullScreen(e) {
        function o() {
            try {
                document.exitFullscreen && (document.fullscreenElement || document.webkitFullscreenElement || document.mozFullScreenElement) && document.exitFullscreen()
            } catch (e) {
                webphone_api.common.PutToDebugLogException(2, "webrtcapi: ExitFullScreen", e)
            }
        }

        if (bFullScreen = e, void 0 !== videoRemote && null !== videoRemote) if (webphone_api.webrtcstack.tsk_utils_have_webrtc4native() && bFullScreen && videoRemote.webkitSupportsFullscreen) {
            if (webphone_api.common.isNull(videoRemote)) return !1;
            bFullScreen ? videoRemote.webkitEnterFullScreen() : videoRemote.webkitExitFullscreen()
        } else videoRemote.requestFullscreen ? bFullScreen ? videoRemote.requestFullscreen() : o() : videoRemote.mozRequestFullScreen ? bFullScreen ? videoRemote.mozRequestFullScreen() : o() : videoRemote.webkitRequestFullscreen && (bFullScreen ? videoRemote.webkitRequestFullscreen() : o()); else if (webphone_api.webrtcstack.tsk_utils_have_webrtc4npapi()) try {
            window.__o_display_remote && window.__o_display_remote.setFullScreen(e)
        } catch (t) {
            webphone_api.common.isNull(divVideo) || divVideo.setAttribute("class", e ? "full-screen" : "normal-screen")
        } else webphone_api.common.isNull(divVideo) || divVideo.setAttribute("class", e ? "full-screen" : "normal-screen")
    }

    function showNotifICall(e) {
        window.webkitNotifications && 0 == window.webkitNotifications.checkPermission() && (oNotifICall && oNotifICall.cancel(), oNotifICall = window.webkitNotifications.createNotification(webphone_api.common.GetElementSource() + "images/sipml-34x39.png", "Incaming call", "Incoming call from " + e), oNotifICall.onclose = function () {
            oNotifICall = null
        }, oNotifICall.show())
    }

    function onKeyUp(e) {
        e = e || window.event, 27 == e.keyCode ? fullScreen(!1) : e.ctrlKey && e.shiftKey && (65 != e.keyCode && 86 != e.keyCode || (bDisableVideo = 65 == e.keyCode, txtCallStatus.innerHTML = "<i>Video " + (bDisableVideo ? "disabled" : "enabled") + "</i>", window.localStorage.setItem("org.doubango.expert.disable_video", bDisableVideo)))
    }

    function onDivCallCtrlMouseMove(e) {
        try {
            webphone_api.webrtcstack.tsk_utils_have_stream() && (btnCall.disabled = !webphone_api.webrtcstack.tsk_utils_have_stream() || !oSipSessionRegister || !oSipSessionRegister.is_connected(), document.getElementById("divCallCtrl").onmousemove = null)
        } catch (o) {
        }
    }

    function uiOnConnectionEvent(e, o) {
    }

    function uiVideoDisplayEvent(e, o) {
        if (!1 === webphone_api.common.CanIUseVideo()) return void webphone_api.common.PutToDebugLog(5, "EVENT, uiDisplayEvent ret");
        if (webphone_api.common.isNull(videoRemote)) return void webphone_api.common.PutToDebugLog(2, "EVENT, webrtcapi uiVideoDisplayEvent videoRemote is NULL");
        var t = e ? videoLocal : videoRemote;
        o ? (t.style.opacity = 1, uiVideoDisplayShowHide(!0)) : (t.style.opacity = 0, fullScreen(!1))
    }

    function uiVideoDisplayShowHide(e) {
        webphone_api.common.isNull(divVideo) || (e ? (divVideo.style.height = "Microsoft Internet Explorer" == navigator.appName ? "100%" : "340px", webphone_api.$("#contact_details").hide(), webphone_api.$("#video_container").show(), 1 === webphone_api.common.GetParameterInt("softphonevideomode", 0) && webphone_api.$("#div_video_fullscreen_button").hide(), webphone_api.common.PutToDebugLog(2, "EVENT, webrtcapi uiVideoDisplayShowHide video container displayed")) : (divVideo.style.height = "0px", webphone_api.$("#contact_details").show(), webphone_api.$("#video_container").hide()))
    }

    function uiBtnCallSetText(e) {
        switch (e) {
            case "Call":
                var o = window.localStorage && "true" == window.localStorage.getItem("org.doubango.expert.disable_callbtn_options");
                btnCall.value = btnCall.innerHTML = o ? "Call" : 'Call <span id="spanCaret" class="caret">', btnCall.setAttribute("class", o ? "btn btn-primary" : "btn btn-primary dropdown-toggle"), btnCall.onclick = o ? function () {
                    sipCall(bDisableVideo ? "call-audio" : "call-audiovideo")
                } : null, ulCallOptions.style.visibility = o ? "hidden" : "visible", o || ulCallOptions.parentNode == divBtnCallGroup ? o && ulCallOptions.parentNode == divBtnCallGroup && document.body.appendChild(ulCallOptions) : divBtnCallGroup.appendChild(ulCallOptions);
                break;
            default:
                btnCall.value = btnCall.innerHTML = e, btnCall.setAttribute("class", "btn btn-primary"), btnCall.onclick = function () {
                    sipCall(bDisableVideo ? "call-audio" : "call-audiovideo")
                }, ulCallOptions.style.visibility = "hidden", ulCallOptions.parentNode == divBtnCallGroup && document.body.appendChild(ulCallOptions)
        }
    }

    function uiCallTerminated(e, o) {
        webphone_api.global.restartice_time = 0, oSipSessionCall = null, stopRingbackTone(), stopRingTone(), uiVideoDisplayShowHide(!1), oNotifICall && (oNotifICall.cancel(), oNotifICall = null), uiVideoDisplayEvent(!1, !1), uiVideoDisplayEvent(!0, !1);
        var t = webphone_api.global.aline;
        void 0 !== o && null !== o && webphone_api.common.IsNumber(o) && webphone_api.common.StrToIntDef(o, -5) > 0 && (t = o), webphone_api.common.PutToDebugLog(1, "STATUS,-1," + e), "Call Finished" === e && webphone_api.common.PutToDebugLog(1, "STATUS," + t.toString() + ",Finished")
    }

    function GetRegisterivalWebRTC() {
        try {
            var e = webphone_api.common.GetParameter2("registerinterval");
            return (webphone_api.common.isNull(e) || e.length < 1 || !webphone_api.common.IsNumber(e)) && (e = 0), e < 5 && (e = webphone_api.common.GetConfigInt("registerinterval", 0)), e < 5 && (e = 200), webphone_api.global.recwsload > 1 && e < 400 && (e = 600), e
        } catch (o) {
            webphone_api.common.PutToDebugLogException(2, "webrtcapi: GetRegisterivalWebRTC", o)
        }
        return 200
    }

    function RegisterEx(accounts) {
        function onSEventStack(e) {
            function o(o) {
                webphone_api.common.PutToDebugLog(5, "EVENT, ExSessionEvent_" + username + ": " + e.type + ", " + e.description)
            }

            try {
                if (webphone_api.common.PutToDebugLog(5, "EVENT, ExStackEvent_" + username + ": " + e.type + ", " + e.description), "started" === e.type && !0 === webphone_api.common.NeedRegister()) {
                    var t = 200;
                    !webphone_api.common.isNull(aival) && webphone_api.common.IsNumber(aival) && (t = aival);
                    this.newSession("register", {
                        expires: t,
                        events_listener: { events: "*", listener: o },
                        sip_caps: [{ name: "+g.oma.sip-im", value: null }, { name: "+audio", value: null }]
                    }).register()
                }
            } catch (n) {
                webphone_api.common.PutToDebugLogException(2, "webrtcapi: ExEventStack_" + username, n)
            }
        }

        try {
            if (webphone_api.common.isNull(accounts) || accounts.length < 5) return;
            for (var accarr = accounts.split("#"), i = 0; i < accarr.length; i++) if (!(webphone_api.common.isNull(accarr[i]) || accarr[i].length < 5)) {
                var oneacc = accarr[i].split(",");
                if (!(webphone_api.common.isNull(oneacc) || oneacc.length < 4)) {
                    webphone_api.common.PutToDebugLog(2, "EVENT, RegisterEx: " + accarr[i]);
                    var asrv = oneacc[0], ausr = oneacc[1], apwd = oneacc[2], aival = oneacc[3];
                    if (webphone_api.common.isNull(ausr) || ausr.length < 1 || webphone_api.common.isNull(apwd) || apwd.length < 1 || webphone_api.common.isNull(aival) || aival.length < 1) webphone_api.common.PutToDebugLog(2, "ERROR, RegisterEx invalid account"); else {
                        var username = ausr, password = apwd, callerid = ausr, udpaddr = asrv;
                        (webphone_api.common.isNull(udpaddr) || udpaddr.length < 1) && (udpaddr = GetUDPServerAddress());
                        var wsaddr = webphone_api.common.GetWebrtcSrvAddr(), displayname = "";
                        if (2 === webphone_api.common.GetConfigInt("usemizuwebrtcgateway", 1) && (wsaddr = ""), webphone_api.common.isNull(wsaddr) || wsaddr.length < 2) {
                            wsaddr = webphone_api.common.GetWp();
                            var wstmp = wsaddr;
                            wstmp.indexOf("//") >= 0 && (wstmp = wstmp.substring(wstmp.indexOf("//") + 2, wstmp.length)), wstmp.indexOf(":") > 0 && (wstmp = wstmp.substring(0, wstmp.indexOf(":")))
                        } else wsaddr = webphone_api.common.Trim(wsaddr.toLowerCase());
                        wsaddr = wsaddr.replace("*", ""), wsaddr = wsaddr.toLowerCase(), wsaddr = wsaddr.replace("udp://", ""), wsaddr = wsaddr.replace("tcp://", ""), wsaddr = wsaddr.replace("http://", ""), wsaddr = wsaddr.replace("https://", "");
                        var sipaddress = udpaddr;
                        sipaddress.indexOf("udp:") < 0 && (sipaddress = "udp://" + sipaddress);
                        var proxyaddress = sipaddress, wsaddress = wsaddr;
                        wsaddress.indexOf("ws:") < 0 && wsaddress.indexOf("wss:") < 0 && (wsaddress = "ws://" + wsaddress);
                        var hostmp = location.host.toLowerCase();
                        !1 !== webphone_api.common.IsIPAddrress(wsaddress) && !0 !== webphone_api.common.BrowserRequiresHttps(!0) || (wsaddress = wsaddress.replace("ws:", "wss:"));
                        var publicsipaddress = webphone_api.common.GetConfig("publicsipaddress");
                        webphone_api.common.isNull(publicsipaddress) && (publicsipaddress = "");
                        var realm = udpaddr;
                        realm = webphone_api.common.NormalizeInput(realm, 0), realm.indexOf(":") > 0 && (realm = realm.substring(0, realm.indexOf(":"))), realm = webphone_api.common.Trim(realm);
                        var sipuri = username;
                        sipuri.indexOf("sip:") < 0 && (sipuri = "sip:" + username), sipuri.indexOf("@") < 0 && (sipuri = sipuri + "@" + realm);
                        var enableRTCWebBreaker = !0;
                        enableRTCWebBreaker = !(!webphone_api.common.isNull(webphone_api.parameters.rtcbreaker) && 0 === webphone_api.parameters.rtcbreaker) && (!webphone_api.common.isNull(webphone_api.parameters.rtcbreaker) && 1 === webphone_api.parameters.rtcbreaker || !1 === webphone_api.common.IsMizuWebRTCGateway() && !1 === webphone_api.common.IsMizuWebRTCEmbeddedServer());
                        var organization = webphone_api.common.GetConfig("companyname");
                        (webphone_api.common.isNull(organization) || organization.length < 1) && (organization = webphone_api.common.GetConfig("brandname"), (webphone_api.common.isNull(organization) || organization.length < 1) && (organization = "Mizutech"));
                        var ua = webphone_api.common.GetUA();
                        webphone_api.common.GetParameter("useragent").length > 0 && !1 === webphone_api.common.IsMizuWebRTCGateway() && (ua = webphone_api.common.GetParameter("useragent"));
                        var sheaders = [{ name: "User-Agent", value: ua }, {
                            name: "Organization",
                            value: organization
                        }, { name: "X-Webdomain", value: webphone_api.common.GetWebdomain() }], xhval = "1";
                        !0 === webphone_api.common.Hasesw() ? xhval = "2" : !0 === webphone_api.common.Us() && (xhval = "0"), sipheaders[sipheaders.length] = {}, sipheaders[sipheaders.length - 1].name = "X-LS", sipheaders[sipheaders.length - 1].value = xhval;
                        var company = webphone_api.common.GetParameter("companyname");
                        !webphone_api.common.isNull(company) && company.length > 0 && (sheaders[sheaders.length] = {}, sheaders[sheaders.length - 1].name = "X-Company", sheaders[sheaders.length - 1].value = company);
                        var brand = webphone_api.common.GetParameter("brandname");
                        !webphone_api.common.isNull(brand) && brand.length > 0 && (sheaders[sheaders.length] = {}, sheaders[sheaders.length - 1].name = "X-Brand", sheaders[sheaders.length - 1].value = brand);
                        var uppsrv = webphone_api.common.GetWebrtcSyUpperHeader("RegisterEx");
                        uppsrv.length > 0 && (sheaders[sheaders.length] = {}, sheaders[sheaders.length - 1].name = "X-Sy.Uppersrv", sheaders[sheaders.length - 1].value = uppsrv);
                        var uppsrvd = webphone_api.common.GetWebrtcSyUpperDomainHeader("RegisterEx");
                        uppsrvd.length > 0 && (sheaders[sheaders.length] = {}, sheaders[sheaders.length - 1].name = "X-Sy.Uppersrvd", sheaders[sheaders.length - 1].value = uppsrvd);
                        var xp2p = webphone_api.common.GetConfig("p2p");
                        !webphone_api.common.isNull(xp2p) && xp2p.length > 0 && (sheaders[sheaders.length] = {}, sheaders[sheaders.length - 1].name = "X-P2P", sheaders[sheaders.length - 1].value = xp2p), sheaders = RemoveDuplicateHeader(sheaders), (webphone_api.common.isNull(username) || username.length < 1) && webphone_api.common.PutToDebugLog(2, "ERROR, WebRTC RegisterEx invalid username: " + username), (webphone_api.common.isNull(password) || password.length < 1) && webphone_api.common.PutToDebugLog(2, "ERROR, WebRTC RegisterEx invalid password: " + password), (webphone_api.common.isNull(sipuri) || sipuri.length < 2 || sipuri.indexOf("@") < 1 || sipuri.indexOf(".") < 1) && webphone_api.common.PutToDebugLog(2, "ERROR, WebRTC RegisterEx invalid sipuri: " + sipuri);
                        var stun_turn = [], stun = webphone_api.common.GetStunServersStr(),
                            turn = webphone_api.common.GetTurnSrv();
                        if (!webphone_api.common.isNull(stun) && stun.length > 2) {
                            var sarr = stun.split(","), useurls = !1;
                            if (("Chrome" === webphone_api.common.GetBrowser() && webphone_api.common.GetBrowserVersion() > 40 || "Firefox" === webphone_api.common.GetBrowser() && webphone_api.common.GetBrowserVersion() > 40) && (useurls = !0), !webphone_api.common.isNull(sarr)) for (var i = 0; i < sarr.length; i++) if (!(webphone_api.common.isNull(sarr[i]) || sarr[i].length < 1)) if (!0 === useurls) {
                                var obj = { urls: sarr[i] };
                                stun_turn.push(obj)
                            } else {
                                var obj = { url: sarr[i] };
                                stun_turn.push(obj)
                            }
                        }
                        if (webphone_api.common.isNull(turn) || webphone_api.common.IsLocalServer() || stun_turn.push(turn), webphone_api.common.PutToDebugLog(3, "Webrtc RegisterEx connection details:"), webphone_api.common.PutToDebugLog(3, "RegisterEx username: " + username), (webphone_api.common.GetLogLevel() > 1 || !0 === webphone_api.global.isdebugversion) && webphone_api.common.PutToDebugLog(3, "RegisterEx password: " + password), webphone_api.common.PutToDebugLog(3, "RegisterEx sipuri: " + sipuri), webphone_api.common.PutToDebugLog(3, "RegisterEx displayname: "), webphone_api.common.PutToDebugLog(3, "RegisterEx wsaddress: " + wsaddress), webphone_api.common.PutToDebugLog(3, "RegisterEx proxyaddress: " + proxyaddress), webphone_api.common.PutToDebugLog(3, "RegisterEx realm: " + realm), (webphone_api.common.isNull(webphone_api.global.usuk) || webphone_api.global.usuk.length < 1) && (webphone_api.common.IsUKGateway(wsaddress) ? (webphone_api.common.PutToDebugLog(2, "WARNING, RegisterEx webrtcapi Start manually setting UK gateway, because DecideUsUk has not yet finished"), webphone_api.global.usuk = "uk") : webphone_api.common.IsUSGateway(wsaddress) && (webphone_api.common.PutToDebugLog(2, "WARNING, RegisterEx webrtcapi Start manually setting US gateway, because DecideUsUk has not yet finished"), webphone_api.global.usuk = "us")), !webphone_api.common.isNull(stun_turn) && stun_turn.length > 0) {
                            for (var i = 0; i < stun_turn.length; i++) if (!webphone_api.common.isNull(stun_turn[i])) {
                                var sobj = stun_turn[i];
                                for (var key in sobj) {
                                    var msgtmp = "RegisterEx turn server";
                                    !webphone_api.common.isNull(sobj[key]) && sobj[key].toString().indexOf("stun") >= 0 && (msgtmp = "RegisterEx stun server"), webphone_api.common.PutToDebugLog(3, msgtmp + "[" + i + "]: " + key + ": " + sobj[key])
                                }
                            }
                        } else webphone_api.common.PutToDebugLog(3, "RegisterEx stun server: NOT set");
                        var iceobj = null, icestr = webphone_api.common.GetParameter("ice");
                        if (!webphone_api.common.isNull(icestr) && icestr.length > 0) try {
                            iceobj = eval(icestr)
                        } catch (eice) {
                            iceobj = null, webphone_api.common.PutToDebugLogException(2, "ERROR, RegisterEx webrtcapi parse ICE servers", eice)
                        }
                        if (!webphone_api.common.isNull(iceobj)) {
                            try {
                                webphone_api.common.PutToDebugLog(2, "EVENT, RegisterEx webrtcapi found ICE (STUN/TURN) server: " + JSON.stringify(iceobj))
                            } catch (eice2) {
                            }
                            stun_turn = iceobj
                        }
                        var earlymediaint = webphone_api.common.GetParameterInt("earlymedia", 2), earlymedia = !0;
                        earlymediaint < 1 && (earlymedia = !1);
                        var sStack = new webphone_api.webrtcstack.SIPml.Stack({
                            realm: realm,
                            impi: username,
                            impu: sipuri,
                            password: password,
                            display_name: "",
                            websocket_proxy_url: wsaddress,
                            outbound_proxy_url: proxyaddress,
                            ice_servers: stun_turn,
                            enable_rtcweb_breaker: enableRTCWebBreaker,
                            events_listener: { events: "*", listener: onSEventStack },
                            enable_early_ims: earlymedia,
                            enable_media_stream_cache: !0,
                            bandwidth: null,
                            video_size: null,
                            sip_headers: sheaders
                        })
                    }
                }
            }
        } catch (err) {
            webphone_api.common.PutToDebugLogException(2, "webrtcapi: RegisterEx", err)
        }
    }

    function ResendRegister() {
        try {
            oSipSessionRegister && oSipSessionRegister.register ? (webphone_api.common.PutToDebugLog(2, "EVENT, ResendRegister resending..."), sipheaders = RemoveDuplicateHeader(sipheaders), oSipSessionRegister.setConfiguration({ sip_headers: sipheaders }), oSipSessionRegister.register()) : webphone_api.common.PutToDebugLog(2, "ERROR, ResendRegister failed, invalid register session"), webphone_api.common.isNull(check_reg_timer) || clearTimeout(check_reg_timer), check_reg_timer = null, check_reg_timer = setTimeout(function () {
                try {
                    if (webphone_api.common.GetTickCount() - webphone_api.global.webrtclastregsent > 3e3) {
                        if (webphone_api.common.PutToDebugLog(2, "WARNING, ResendRegister: restart SipStack, because REGISTER was not resent"), !0 === webphone_api.isincall()) return void webphone_api.common.PutToDebugLog(2, "WARNING, ResendRegister: skip SipStack restart, because a call is in progress");
                        ReStart(1, !0)
                    }
                } catch (e) {
                    webphone_api.common.PutToDebugLogException(2, "webrtcapi: ResendRegister inner timer", e)
                }
            }, 2900)
        } catch (e) {
            webphone_api.common.PutToDebugLogException(2, "webrtcapi: ResendRegister", e)
        }
    }

    function StartReRegister(e) {
        try {
            if (webphone_api.common.GetParameterInt("forcereregister", 1) < 1) return;
            if (!0 === e && !0 === reregstarted) return;
            if (webphone_api.global.phonestarted < 1) return void (reregstarted = !1);
            reregstarted = !0, webphone_api.common.isNull(rereg_timer) || clearTimeout(rereg_timer), rereg_timer = null, rereg_timer = setTimeout(function () {
                if (webphone_api.global.phonestarted < 1) return webphone_api.common.isNull(rereg_timer) || clearTimeout(rereg_timer), rereg_timer = null, reregstarted = !1, rereg_ival = 1e4, void (webphone_api.global.webrtc_regstate = -1);
                if (1 === webphone_api.global.webrtc_regstate) return void StartReRegister(!1);
                if (0 === webphone_api.global.webrtc_regstate) {
                    rereg_ival < 12e4 ? rereg_ival *= 2 : rereg_ival = 1e4;
                    var e = webphone_api.common.GetParameterInt("forcereregister", 1);
                    0 === rereg_action && oSipSessionRegister && oSipSessionRegister.register ? (webphone_api.common.PutToDebugLog(2, "ERROR, ReRegister new session (forcereregister: " + e.toString() + ")"), rereg_action = 1, ResendRegister()) : (webphone_api.common.PutToDebugLog(2, "ERROR, ReRegister restart SipStack (forcereregister: " + e.toString() + ")"), rereg_action = 0, ReStart(1, !0)), StartReRegister(!1)
                }
            }, rereg_ival)
        } catch (o) {
            webphone_api.common.PutToDebugLogException(2, "webrtcapi: StartReRegister", o)
        }
    }

    function onSipEventStack(e) {
        switch (webphone_api.global.isdebugversionwebrtc && console.log("WRTCEVENT_STACK: " + e.type + ", " + e.description), webphone_api.common.PutToDebugLog(2, "==stack event = " + e.type), e.type) {
            case "started":
                webphone_api.common.getuseengine() === webphone_api.global.ENGINE_WEBRTC && (webphone_api.global.iscurrengineworking = !0), webphone_api.common.SaveParameter("lastsessionsuccess", "2");
                try {
                    !0 === webphone_api.common.NeedRegister() ? (oSipSessionRegister = this.newSession("register", {
                        expires: GetRegisterivalWebRTC(),
                        events_listener: { events: "*", listener: onSipEventSession },
                        sip_caps: [{ name: "+g.oma.sip-im", value: null }, { name: "+audio", value: null }]
                    }), oSipSessionRegister && (sipheaders = RemoveDuplicateHeader(sipheaders), oSipSessionRegister.setConfiguration({ sip_headers: sipheaders })), oSipSessionRegister.register()) : webphone_api.common.PutToDebugLog(1, "STATUS,-1,Ready.")
                } catch (e) {
                    webphone_api.common.PutToDebugLog(2, "ERROR, webrtcapi: onSipEventStack register")
                }
                break;
            case "stopping":
            case "stopped":
            case "failed_to_start":
            case "failed_to_stop":
                "failed_to_start" == e.type || e.type;
                oSipStack = null, oSipSessionRegister = null, oSipSessionCall = null, uiOnConnectionEvent(!1, !1), stopRingbackTone(), stopRingTone(), uiVideoDisplayShowHide(!1), "failed_to_start" == e.type ? (webphone_api.common.PutToDebugLog(1, "ERROR,-1,Register failed"), webphone_api.common.PutToDebugLog(2, "ERROR, webrtcapi: onSipEventStack failed_to_start"), webphone_api.common.CheckInternetConnection(), webphone_api.common.CheckInternetConnectionWS(), webphone_api.common.getuseengine() === webphone_api.global.ENGINE_WEBRTC && (webphone_api.global.iscurrengineworking = !1), ReStart()) : "failed_to_stop" == e.type ? (webphone_api.common.PutToDebugLog(1, "ERROR,-1,UnRegister failed"), webphone_api.common.PutToDebugLog(2, "ERROR, webrtcapi: onSipEventStack failed_to_stop")) : "stopping" == e.type ? webphone_api.common.PutToDebugLog(2, "EVENT, WebRTC sipstack stopping") : "stopped" == e.type && (webphone_api.common.PutToDebugLog(2, "EVENT, WebRTC sipstack stopped"), webphone_api.common.CheckInternetConnection(), webphone_api.common.CheckInternetConnectionWS(), ReStart()), webphone_api.global.webrtc_regstate = 0;
                break;
            case "i_new_call":
                if (webphone_api.common.RemoveSipHeadreFromCache("X-reason"), webphone_api.common.RemoveSipHeadreFromCache("Reason"), webphone_api.common.RemoveSipHeadreFromCache("Warning"), webphone_api.common.getuseengine() === webphone_api.global.ENGINE_WEBRTC && (webphone_api.global.iscurrengineworking = !0), !0 === webphone_api.global.dontSendSignaling && webphone_api.global.dontSendSignalingTimer > 0 && webphone_api.common.GetTickCount() - webphone_api.global.dontSendSignalingTimer < 200) return e.newSession.hangup(), void webphone_api.common.PutToDebugLog(2, "WARNING, webrtcapi, API_Hangup call because retring with optimized SDP");
                if (!webphone_api.common.onc()) {
                    var o = [];
                    o.push("h"), o.push("a"), o.push("n"), o.push("g"), o.push("u"), o.push("p"), o.push(" "), o.push("5"), o.push(" ");
                    var t = o.join("");
                    return webphone_api.common.PutToDebugLog(2, "EVENT, " + t), SipHangup(!0, -2), void e.newSession.hangup()
                }
                if (webphone_api.common.SaveParameter("lastsessionsuccess", "2"), !0 === webphone_api.common.UsePresence2() && "dnd" === webphone_api.common.GetParameter("presencestatus").toLowerCase()) return webphone_api.common.PutToDebugLog(2, "EVENT, webrtcapi hangup incoming call, because presence is DND"), e.newSession.hangup(), setTimeout(function () {
                    SendRegisteredStatus()
                }, 500), setTimeout(function () {
                    SendRegisteredStatus()
                }, 1e3), void (webphone_api.global.webrtc_regstate = 1);
                if (webphone_api.common.GetNrOfActiveCalls() > 0) {
                    var n = "";
                    if (oSipSessionCall && null !== oSipSessionCall && (n = oSipSessionCall.getRemoteFriendlyName()), webphone_api.common.isNull(n) && (n = ""), n = webphone_api.common.Trim(n), n.length > 0 && n === webphone_api.global.currcallnumber) {
                        var i = webphone_api.common.GetParameterInt("dropsameoldcall", 0);
                        if (1 === i) {
                            var a = webphone_api.common.GetSipHeaderInternal("X-Autorecall");
                            webphone_api.common.isNull(a) && (a = ""), a = webphone_api.common.Trim(a), a = a.toLowerCase(), "yes" === a && (webphone_api.common.PutToDebugLog(2, "EVENT, webrtcapi hangup incoming call, dropsameoldcall(1) from: " + n), e.newSession.hangup())
                        } else if (2 === i) {
                            var a = webphone_api.common.GetSipHeaderInternal("X-Autorecall");
                            webphone_api.common.isNull(a) && (a = ""), a = webphone_api.common.Trim(a), a = a.toLowerCase(), !0 === webphone_api.global.isvideocall && "yes" === a && (webphone_api.common.PutToDebugLog(2, "EVENT, webrtcapi hangup incoming call, dropsameoldcall(2) from: " + n), e.newSession.hangup())
                        } else 3 === i && (webphone_api.common.PutToDebugLog(2, "EVENT, webrtcapi hangup incoming call, dropsameoldcall(3) from: " + n), e.newSession.hangup())
                    }
                }
                if (webphone_api.common.GetNrOfActiveCalls() > 0 && 1 !== webphone_api.common.IsMultiline()) {
                    var r = webphone_api.common.GetParameter2("rejectonbusy");
                    if ("false" !== r) {
                        webphone_api.common.PutToDebugLog(2, "EVENT, webrtcapi hangup incoming call, because rejectonbusy is: " + r), e.newSession.hangup();
                        var n = "";
                        oSipSessionCall && null !== oSipSessionCall && (n = oSipSessionCall.getRemoteFriendlyName()), webphone_api.common.isNull(n) && (n = ""), "undefined" != typeof webphone_api.notifications && null !== webphone_api.notifications ? webphone_api.notifications.AddToCallLog(n, "2", "recfile", 0, webphone_api.global.aline, "Rejected busy") : console && console.log && console.log("ERROR, webrtcapi onSipEventStack webphone_api.notifications is not defined")
                    }
                } else {
                    webphone_api.common.GetNrOfActiveCalls() > 0 && (webphone_api.global.aline = webphone_api.common.GetFreeLine()), webphone_api.global.restartice_time = webphone_api.common.GetTickCount(), oSipSessionCall = e.newSession, SetSipHeader(1), oSipSessionCall.setConfiguration(HandleOconfigCall(oConfigCall, webphone_api.global.aline)), startRingTone();
                    var n = "";
                    oSipSessionCall && null !== oSipSessionCall && (n = oSipSessionCall.getRemoteFriendlyName()), showNotifICall(n);
                    var s = webphone_api.global.aline.toString();
                    webphone_api.common.StrToInt(s) < 1 && (webphone_api.global.aline = webphone_api.common.GetFreeLine());
                    var l = null;
                    oSipSessionCall.o_session && oSipSessionCall.o_session && oSipSessionCall.o_session.o_stack && oSipSessionCall.o_session.o_stack.ao_headers && oSipSessionCall.o_session.o_stack.ao_headers.length > 0 && (l = oSipSessionCall.o_session.o_stack.ao_headers), webphone_api.common.SaveCallSession(webphone_api.global.aline, oSipSessionCall, n, "2", webphone_api.common.GetTickCount(), -1, -1, "", oSipSessionCall.getId(), "true", "", l);
                    try {
                        var p = "recv=\n" + e.o_event.o_message;
                        webphone_api.common.CatchWebrtcSignaling(p, webphone_api.common.SIP_REGISTER)
                    } catch (E) {
                        webphone_api.common.PutToDebugLogException(2, "webrtcapi: onSipEventStack i_new_call CatchWebrtcSignaling", E)
                    }
                    var c = webphone_api.common.GetEndpoint(-1, n, oSipSessionCall.getId(), !1), u = "";
                    webphone_api.common.isNull(c) || (u = c[webphone_api.common.EP_CALLID]), webphone_api.common.PutToDebugLog(1, "STATUS," + webphone_api.global.aline.toString() + ",CallSetup," + n + "," + webphone_api.common.GetSipusername() + ",2," + n + ",[" + u + "],,,,,"), 1 === webphone_api.common.GetApibehaviour() && webphone_api.common.PutToDebugLog(1, "STATUS,-1,Ringing..."), webphone_api.common.PutToDebugLog(1, "STATUS," + webphone_api.global.aline.toString() + ",Ringing," + n + "," + webphone_api.common.GetSipusername() + ",2," + n + ",[" + u + "]"), webphone_api.common.PutToDebugLog(1, "STATUS,-1,Incoming..."), istypeincoming = !0;
                    var h = webphone_api.common.GetParameter2("autoignore");
                    (webphone_api.common.isNull(h) || 1 !== h.length) && (h = "0");
                    var m = webphone_api.common.StrToInt(h);
                    if (m > 1 ? (webphone_api.common.PutToDebugLog(3, "EVENT, autoignore WebRTC hangup(reject)"), SipHangup(!0, webphone_api.global.aline)) : 1 === m && (webphone_api.common.PutToDebugLog(3, "EVENT, autoignore WebRTC silent ignore"), stopRingTone()), !0 === webphone_api.common.GetParameterBool("autoaccept", !1)) {
                        var g = webphone_api.common.GetParameterInt("beeponconnect", 0);
                        1 !== g && 2 !== g && 4 !== g || webphone_api.common.Beep("1"), webphone_api.common.PutToDebugLog(3, "EVENT, autoaccept WebRTC accept"), SipAccept(webphone_api.global.aline, !1)
                    }
                    var d = webphone_api.common.GetParameter2("calltransferalways");
                    !webphone_api.common.isNull(d) && d.length > 1 && (webphone_api.common.PutToDebugLog(3, "EVENT, call transfer WebRTC calltransferalways: " + d), SipTransfer(d));
                    var b = webphone_api.common.GetParameter2("callforwardonbusy");
                    !webphone_api.common.isNull(b) && b.length > 1 && Forward(b);
                    var _ = webphone_api.common.GetParameter2("callforwardalways");
                    !webphone_api.common.isNull(_) && _.length > 1 && Forward(_)
                }
                break;
            case "i_new_message":
                webphone_api.common.getuseengine() === webphone_api.global.ENGINE_WEBRTC && (webphone_api.global.iscurrengineworking = !0), webphone_api.common.SaveParameter("lastsessionsuccess", "2"), e.newSession.accept();
                var f = e.newSession.getRemoteFriendlyName(), o = e.getContentString();
                if (webphone_api.common.isNull(f) || f.length < 1) return void webphone_api.common.PutToDebugLog(2, "ERROR, webrtcapi: onSipEventStack chat received, from is NULL");
                if (webphone_api.common.isNull(o) || o.length < 1) return void webphone_api.common.PutToDebugLog(2, "ERROR, webrtcapi: onSipEventStack chat received, from: " + f + "; message is NULL");
                webphone_api.common.PutToDebugLog(1, "CHAT,-1," + f + "," + o);
                break;
            case "m_permission_requested":
                webphone_api.common.PutToDebugLog(5, "EVENT, webrtcapi: permission requested"), webphone_api.global.lastpermreq = webphone_api.common.GetTickCount(), last_event = webphone_api.global.last_event, webphone_api.common.PutToDebugLog(1, "STATUS," + webphone_api.global.aline.toString() + ",Waiting for permission"), setTimeout(function () {
                    !1 === webphone_api.global.webrtcpermissionaccepted && webphone_api.common.PutToDebugLog(1, "STATUS," + webphone_api.global.aline.toString() + ",Waiting for permission")
                }, 3500);
                break;
            case "m_permission_accepted":
                if (webphone_api.common.PutToDebugLog(5, "EVENT, webrtcapi: MediaStream permission granted"), webphone_api.common.PutToDebugLog(1, "EVENT," + last_event), webphone_api.global.webrtcpermissionaccepted = !0, RedialOnFail(), !0 === webphone_api.global.incommingCall) {
                    var w = webphone_api.common.GetTickCount(),
                        v = webphone_api.common.GetParameterInt("acceptcall_onsharedevice", 1);
                    2 === v ? (webphone_api.common.PutToDebugLog(5, "EVENT, webrtcapi: Accept Call on MediaStream permission granted_1"), SipAccept(webphone_api.global.aline)) : 1 === v && ("Firefox" === webphone_api.common.GetBrowser() && !1 === webphone_api.common.IsHttps() ? (webphone_api.common.PutToDebugLog(5, "EVENT, webrtcapi: Accept Call on MediaStream permission granted_2"), SipAccept(webphone_api.global.aline)) : "Chrome" === webphone_api.common.GetBrowser() && !0 === webphone_api.common.IsLocalFileSystem() ? (webphone_api.common.PutToDebugLog(5, "EVENT, webrtcapi: Accept Call on MediaStream permission granted_3"), SipAccept(webphone_api.global.aline)) : webphone_api.global.lastpermreq > 0 && w - webphone_api.global.lastpermreq > 8e3 && (webphone_api.common.PutToDebugLog(5, "EVENT, webrtcapi: Accept Call on MediaStream permission granted_4"), SipAccept(webphone_api.global.aline)))
                }
                break;
            case "m_permission_refused":
                if ("m_permission_refused" == e.type) {
                    if (webphone_api.global.webrtcpermissionaccepted = !1, webphone_api.common.PutToDebugLog(5, "EVENT, webrtcapi: MediaStream permission denied"), uiCallTerminated("Media stream permission denied"), !webphone_api.common.isNull(destnumber) && destnumber.length > 0 && "call-audiovideo" === calltype) return webphone_api.common.PutToDebugLog(2, "WARNING, MediaStream permission denied, retry audio call with no video: " + destnumber), void SipCall("call-audio", callline, destnumber);
                    webphone_api.common.PutToDebugLog(2, "EVENT, Hangup incoming call, because MediaStream permission denied: " + destnumber), SipHangup(!0, webphone_api.global.aline), setTimeout(function () {
                        webphone_api.common.MediaStreamPermissionDenied()
                    }, 150)
                }
        }
    }

    function onSipEventSession(e) {
        switch (webphone_api.global.isdebugversionwebrtc && console.log("WRTCEVENT_SESSION: " + e.type + ", " + e.description), webphone_api.common.isNull(e.session.o_session) || webphone_api.common.isNull(e.session.o_session.s_type), webphone_api.common.SaveParameter("lastsessionsuccess", "2"), webphone_api.common.PutToDebugLog(2, "==session event = " + e.type), e.type) {
            case "connecting":
            case "connected":
                var o = "connected" == e.type;
                if (e.session == oSipSessionRegister) "connecting" == e.type && webphone_api.common.PutToDebugLog(1, "STATUS,-1,Registering..."), "connected" == e.type && (webphone_api.common.getuseengine() === webphone_api.global.ENGINE_WEBRTC && (webphone_api.global.iscurrengineworking = !0), isregistered = !0, SendRegisteredStatus(), webphone_api.global.webrtc_regstate = 1); else if (e.session == oSipSessionMessage); else if (e.session == oSipSessionTransferCall); else if (e.session instanceof webphone_api.webrtcstack.SIPml.Session.Call) {
                    var t = !1;
                    if (e.session == oSipSessionCall && (t = !0), !1 === t && !webphone_api.common.isNull(webphone_api.global.ep)) for (var n = 0; n < webphone_api.global.ep.length; n++) {
                        var i = webphone_api.global.ep[n][webphone_api.common.EP_SESSION];
                        if (!webphone_api.common.isNull(i) && e.session == i) {
                            t = !0;
                            break
                        }
                    }
                    if (!0 === t) {
                        var a = "unknown";
                        e && null !== e && e.session && null !== e.session && (a = e.session.getRemoteFriendlyName());
                        var r = "1";
                        istypeincoming && (r = "2");
                        try {
                            if ("undefined" != typeof e.session.o_session && null !== e.session.o_session && "undefined" != typeof e.session.o_session.o_uri_from && null !== e.session.o_session.o_uri_from && "undefined" != typeof e.session.o_session.o_uri_from.s_user_name && null !== e.session.o_session.o_uri_from.s_user_name && e.session.o_session.o_uri_from.s_user_name.length > 0) {
                                var s = e.session.o_session.o_uri_from.s_user_name;
                                !webphone_api.common.isNull(s) && s.length > 0 && (r = webphone_api.common.GetSipusername().toLowerCase() === s.toLowerCase() ? "1" : "2")
                            }
                        } catch (N) {
                            webphone_api.common.PutToDebugLogException(2, "webrtcapi: onSipEventSession: connecting or connected", N)
                        }
                        if (o) {
                            stopRingbackTone(), stopRingTone(), oNotifICall && (oNotifICall.cancel(), oNotifICall = null);
                            var l = webphone_api.common.GetEndpoint(-1, a, e.session.getId(), !1), p = "";
                            webphone_api.common.isNull(l) || (p = l[webphone_api.common.EP_CALLID]), webphone_api.common.PutToDebugLog(1, "STATUS," + webphone_api.global.aline.toString() + ",CallConnect," + a + "," + webphone_api.common.GetSipusername() + "," + r + "," + a + ",,,,,,[" + p + "]"), webphone_api.common.SaveCallSession(webphone_api.global.aline, e.session, a, r, -1, webphone_api.common.GetTickCount(), -1, "", e.session.getId(), "", ""), setTimeout(function () {
                                webphone_api.common.PutToDebugLog(1, "STATUS,-1,In Call"), webphone_api.common.PutToDebugLog(1, "STATUS," + webphone_api.global.aline.toString() + ",Speaking," + a + "," + webphone_api.common.GetSipusername() + "," + r + "," + a)
                            }, 1100), webphone_api.common.PutToDebugLog(1, "STATUS,-1,Speaking"), "2" === r && webphone_api.common.PutToDebugLog(1, "STATUS," + webphone_api.global.aline.toString() + ",InCall," + a + "," + webphone_api.common.GetSipusername() + "," + r + "," + a)
                        } else webphone_api.common.PutToDebugLog(1, "STATUS," + webphone_api.global.aline.toString() + "," + e.description), webphone_api.common.SaveCallSession(webphone_api.global.aline, e.session, a, r, webphone_api.common.GetTickCount(), -1, -1, "", e.session.getId(), "", "", null);
                        webphone_api.webrtcstack.SIPml.isWebRtc4AllSupported() && (webphone_api.common.PutToDebugLog(2, "EVENT, webrtc4all supported connect uiVideoDisplayEvent"), uiVideoDisplayEvent(!1, !0), uiVideoDisplayEvent(!0, !0))
                    }
                }
                break;
            case "terminating":
            case "terminated":
                if (e.session == oSipSessionRegister) if (uiOnConnectionEvent(!1, !1), oSipSessionCall = null, oSipSessionRegister = null, isregistered = !1, webphone_api.global.webrtc_regstate = 0, !0 === webphone_api.global.onunregistered_flag || !1 === webphone_api.flagrestartwebrtc); else {
                    webphone_api.common.PutToDebugLog(2, "ERROR,register failed with reason: " + e.description), webphone_api.common.PutToDebugLog(1, "STATUS,-1,Register failed: " + e.description), !webphone_api.common.isNull(e.description) && e.description.length > 0 && (lastregfailreason = e.description);
                    try {
                        webphone_api.onRegStateChangeCb("failed", e.description)
                    } catch (N) {
                        webphone_api.common.PutToDebugLogException(2, "webrtcapi: There is an error in onRegStateChangeCb(failed) callback", N)
                    }
                    try {
                        webphone_api.onRegisterFailedCb(e.description)
                    } catch (N) {
                        webphone_api.common.PutToDebugLogException(2, "webrtcapi: There is an error in onRegisterFailed() callback", N)
                    }
                    webphone_api.common.CheckInternetConnection(), webphone_api.common.CheckInternetConnectionWS()
                } else if (e.session == oSipSessionMessage) webphone_api.common.PutToDebugLog(2, "EVENT,EventSession message: " + e.type); else if (e.session == oSipSessionTransferCall) webphone_api.common.PutToDebugLog(2, "EVENT,EventSession call transfer: " + e.type); else if (e.session instanceof webphone_api.webrtcstack.SIPml.Session.Call) {
                    if (webphone_api.common.PutToDebugLog(2, "EVENT,EventSession call: " + e.type), e.session === lastsession) return void webphone_api.common.PutToDebugLog(2, "EVENT, webrtcap: skip because duplicate session received");
                    lastsession = e.session;
                    var a = "unknown";
                    e && null !== e && e.session && null !== e.session && (a = e.session.getRemoteFriendlyName());
                    var r = "1";
                    istypeincoming && (r = "2"), setTimeout(function () {
                        calltype = "", callline = 1, destnumber = ""
                    }, 200);
                    var l = webphone_api.common.GetEndpoint(webphone_api.global.aline, a, e.session.getId(), !1),
                        p = "";
                    if (webphone_api.common.isNull(l) || (p = l[webphone_api.common.EP_CALLID]), !webphone_api.common.isNull(l) && "true" === l[webphone_api.common.EP_FINISHEDSENT] || lastsessionid === e.session.getId()) webphone_api.common.PutToDebugLog(3, "EVENT, webrtc finished status already sent for this session"); else {
                        var c = webphone_api.global.aline;
                        lastsessionid = e.session.getId(), setTimeout(function () {
                            lastsessionid = -1e3
                        }, 150), !1 === webphone_api.global.calltransf_completed && (c = webphone_api.common.SaveCallSession(null, e.session, a, r, -1, -1, webphone_api.common.GetTickCount(), "", e.session.getId(), "", "true", null)), c < -4 && (c = webphone_api.global.aline), webphone_api.common.PutToDebugLog(1, "STATUS," + c.toString() + ",CallDisconnect," + a + "," + webphone_api.common.GetSipusername() + "," + r + "," + a + ",,,,,,[" + p + "]"), uiCallTerminated("Call Finished", c), BuildCDR(c, a, e.session.getId(), e.description)
                    }
                }
                break;
            case "i_notify":
                if (webphone_api.common.PutToDebugLog(4, "EVENT, NOTIFY content-type: " + e.getContentType()), webphone_api.common.PutToDebugLog(4, "EVENT, NOTIFY content: " + e.getContentString()), "application/pidf+xml" == e.getContentType() && window.DOMParser) {
                    var u = new DOMParser, h = u ? u.parseFromString(e.getContentString(), "text/xml") : null,
                        m = h ? h.getElementsByTagName("presence")[0] : null;
                    if (m) {
                        var g = m.getAttribute("entity"), d = m.getElementsByTagName("tuple")[0];
                        if (g && d) {
                            var b = d.getElementsByTagName("status")[0];
                            if (b) {
                                var _ = b.getElementsByTagName("basic")[0];
                                if (_) {
                                    var f = g, w = _.textContent;
                                    f = f.toLowerCase(), f = f.replace("sip:", "");
                                    var v = f.indexOf("@");
                                    v > 0 && (f = f.substring(0, v));
                                    var E = webphone_api.common.SaveReceivedPresence2(f, w);
                                    webphone_api.common.PutToDebugLog(4, "EVENT, Presence notification: number: " + f + " status: " + w), !1 === webphone_api.common.IsSDK() && webphone_api._dialpad.PopulateListRecents(), !0 === webphone_api.global.isContactdetailsStarted && !1 === webphone_api.common.IsSDK() && webphone_api._contactdetails.PopulateData(), !0 === webphone_api.global.isMessageStarted && webphone_api._message.DisplayPresence(E)
                                }
                            }
                        }
                    }
                }
                break;
            case "m_stream_video_local_added":
                webphone_api.common.PutToDebugLog(2, "EVENT, local video stream added"), e.session instanceof webphone_api.webrtcstack.SIPml.Session.Call && uiVideoDisplayEvent(!0, !0);
                break;
            case "m_stream_video_local_removed":
                webphone_api.common.PutToDebugLog(2, "EVENT, local video stream removed"), e.session instanceof webphone_api.webrtcstack.SIPml.Session.Call && uiVideoDisplayEvent(!0, !1);
                break;
            case "m_stream_video_remote_added":
                webphone_api.common.PutToDebugLog(2, "EVENT, remote video stream added"), e.session instanceof webphone_api.webrtcstack.SIPml.Session.Call && uiVideoDisplayEvent(!1, !0);
                break;
            case "m_stream_video_remote_removed":
                webphone_api.common.PutToDebugLog(2, "EVENT, remote video stream removed"), e.session instanceof webphone_api.webrtcstack.SIPml.Session.Call && uiVideoDisplayEvent(!1, !1);
                break;
            case "m_stream_audio_local_added":
                webphone_api.common.PutToDebugLog(2, "EVENT, local audio stream added");
            case "m_stream_audio_local_removed":
                webphone_api.common.PutToDebugLog(2, "EVENT, local audio stream removed");
            case "m_stream_audio_remote_added":
                webphone_api.common.PutToDebugLog(2, "EVENT, remote audio stream added");
            case "m_stream_audio_remote_removed":
                webphone_api.common.PutToDebugLog(2, "EVENT, remote audio stream removed");
                break;
            case "i_ect_new_call":
                oSipSessionTransferCall = e.session;
                break;
            case "i_ao_request":
                if (e.session instanceof webphone_api.webrtcstack.SIPml.Session.Call) {
                    var T = webphone_api.global.aline.toString(), P = webphone_api.common.StrToInt(T);
                    P < 1 && (webphone_api.global.aline = webphone_api.common.GetFreeLine());
                    var a = "unknown";
                    e && null !== e && e.session && null !== e.session && (a = e.session.getRemoteFriendlyName());
                    var l = webphone_api.common.GetEndpoint(-1, a, e.session.getId(), !1), p = "";
                    webphone_api.common.isNull(l) || (p = l[webphone_api.common.EP_CALLID]), !webphone_api.common.isNull(l) && l.length > webphone_api.common.EP_SETUPSENT && "true" === l[webphone_api.common.EP_SETUPSENT] || (1 === webphone_api.common.GetApibehaviour() && (webphone_api.common.PutToDebugLog(1, "STATUS,-1,Call Initiated"), webphone_api.common.PutToDebugLog(1, "STATUS,-1,Calling...")), webphone_api.common.PutToDebugLog(1, "STATUS," + webphone_api.global.aline.toString() + ",CallSetup," + a + "," + webphone_api.common.GetSipusername() + ",1," + a + ",[" + p + "],,,,,"), webphone_api.common.SaveCallSession(webphone_api.global.aline, e.session, a, "1", webphone_api.common.GetTickCount(), -1, -1, "", e.session.getId(), "true", "", null));
                    var S = e.getSipResponseCode();
                    180 == S || 183 == S ? (istypeincoming = !1, webphone_api.common.PutToDebugLog(1, "STATUS,-1,Ringing..."), webphone_api.common.PutToDebugLog(1, "STATUS," + webphone_api.global.aline.toString() + ",Ringing," + a + "," + webphone_api.common.GetSipusername() + ",1," + a + ",[" + p + "]"), 0 === changesptoring ? 180 == S && startRingbackTone() : 2 !== changesptoring && 5 !== changesptoring || startRingbackTone()) : 100 == S && webphone_api.common.PutToDebugLog(1, "STATUS," + webphone_api.global.aline.toString() + ",InProgress," + a + "," + webphone_api.common.GetSipusername() + ",1," + a + ",[" + p + "]")
                }
                break;
            case "m_early_media":
                e.session instanceof webphone_api.webrtcstack.SIPml.Session.Call && (5 !== changesptoring && setTimeout(function () {
                    stopRingbackTone(), stopRingTone()
                }, 100), webphone_api.common.PutToDebugLog(1, "STATUS,-1,Early media started"));
                break;
            case "m_local_hold_ok":
                e.session instanceof webphone_api.webrtcstack.SIPml.Session.Call && (e.session.bTransfering && (e.session.bTransfering = !1), e.session.bHeld = !0);
                break;
            case "m_local_hold_nok":
                e.session instanceof webphone_api.webrtcstack.SIPml.Session.Call && (e.session.bTransfering = !1);
                break;
            case "m_local_resume_ok":
                e.session instanceof webphone_api.webrtcstack.SIPml.Session.Call && (e.session.bTransfering = !1, e.session.bHeld = !1, webphone_api.webrtcstack.SIPml.isWebRtc4AllSupported() && (uiVideoDisplayEvent(!1, !0), uiVideoDisplayEvent(!0, !0)));
                break;
            case "m_local_resume_nok":
                e.session instanceof webphone_api.webrtcstack.SIPml.Session.Call && (e.session.bTransfering = !1, webphone_api.common.PutToDebugLog(1, "STATUS,-1,Failed to unhold call"));
                break;
            case "m_remote_hold":
                e.session instanceof webphone_api.webrtcstack.SIPml.Session.Call && webphone_api.common.PutToDebugLog(1, "STATUS,-1,Placed on hold by remote party");
                break;
            case "m_remote_resume":
                e.session instanceof webphone_api.webrtcstack.SIPml.Session.Call && webphone_api.common.PutToDebugLog(1, "STATUS,-1,Taken off hold by remote party");
                break;
            case "m_bfcp_info":
                e.session instanceof webphone_api.webrtcstack.SIPml.Session.Call && webphone_api.common.PutToDebugLog(1, "STATUS,-1,BFCP Info: " + e.description);
                break;
            case "o_ect_trying":
                e.session instanceof webphone_api.webrtcstack.SIPml.Session.Call && (webphone_api.common.PutToDebugLog(1, "EVENT,transfer initiated successfully"), 1 === webphone_api.common.GetApibehaviour() && webphone_api.common.PutToDebugLog(1, "STATUS,-1,Transfer"), webphone_api.common.PutToDebugLog(1, "STATUS," + webphone_api.global.aline + ",Call transfer in progress..._"));
                break;
            case "o_ect_accepted":
                e.session instanceof webphone_api.webrtcstack.SIPml.Session.Call && webphone_api.common.PutToDebugLog(1, "STATUS," + webphone_api.global.aline + ",Call transfer accepted");
                break;
            case "o_ect_completed":
                if (e.session instanceof webphone_api.webrtcstack.SIPml.Session.Call) {
                    var a = "";
                    e && null !== e && e.session && null !== e.session && (a = e.session.getRemoteFriendlyName());
                    var l = webphone_api.common.GetEndpoint(-1, a, e.session.getId(), !1), p = "";
                    webphone_api.common.isNull(l) || (p = l[webphone_api.common.EP_CALLID]), webphone_api.common.PutToDebugLog(1, "STATUS," + webphone_api.global.aline.toString() + ",Midcall," + a + "," + webphone_api.common.GetSipusername() + ",1," + a + ",[" + p + "],,,,,")
                }
            case "i_ect_completed":
                if (e.session instanceof webphone_api.webrtcstack.SIPml.Session.Call) {
                    webphone_api.global.calltransf_completed = !0, setTimeout(function () {
                        webphone_api.global.calltransf_completed = !1, webphone_api.common.RefreshInfo()
                    }, 3e3), webphone_api.common.PutToDebugLog(1, "STATUS," + webphone_api.global.aline + ",Call transfer completed"), oSipSessionTransferCall && (oSipSessionCall = oSipSessionTransferCall), oSipSessionTransferCall = null;
                    var a = "";
                    e && null !== e && e.session && null !== e.session && (a = e.session.getRemoteFriendlyName());
                    var l = webphone_api.common.GetEndpoint(-1, a, e.session.getId(), !1), p = "";
                    webphone_api.common.isNull(l) || (p = l[webphone_api.common.EP_CALLID]), webphone_api.common.PutToDebugLog(1, "STATUS," + webphone_api.global.aline.toString() + ",Midcall," + a + "," + webphone_api.common.GetSipusername() + ",1," + a + ",[" + p + "],,,,,")
                }
                break;
            case "o_ect_failed":
                webphone_api.common.PutToDebugLog(1, "ERROR," + webphone_api.global.aline + ",Call transfer failed");
            case "i_ect_failed":
                e.session instanceof webphone_api.webrtcstack.SIPml.Session.Call && webphone_api.common.PutToDebugLog(1, "STATUS," + webphone_api.global.aline + ",Call transfer failed");
                break;
            case "o_ect_notify":
                webphone_api.common.PutToDebugLog(1, "EVENT,transfer initiated"), webphone_api.common.PutToDebugLog(2, "STATUS," + webphone_api.global.aline + ",Call Transfer: " + e.getSipResponseCode() + " " + e.description + "_o");
            case "i_ect_notify":
                e.session instanceof webphone_api.webrtcstack.SIPml.Session.Call && (webphone_api.common.PutToDebugLog(1, "EVENT,transfer initiated"), webphone_api.common.PutToDebugLog(1, "STATUS," + webphone_api.global.aline + ",Call Transfer: " + e.getSipResponseCode() + " " + e.description), e.getSipResponseCode() >= 300 && e.session.bHeld && e.session.resume(), 1 === webphone_api.common.GetApibehaviour() && webphone_api.common.PutToDebugLog(1, "STATUS,-1,Transfer"));
                break;
            case "i_ect_requested":
                if (e.session instanceof webphone_api.webrtcstack.SIPml.Session.Call) {
                    if (0 === webphone_api.common.GetParameterInt("transfertype", -1)) webphone_api.common.PutToDebugLog(2, "EVENT, incoming SIP REFER transfer rejected."), e.session.rejectTransfer(); else {
                        webphone_api.common.PutToDebugLog(1, "STATUS," + webphone_api.global.aline + ",Call transfer in progress...");
                        var T = webphone_api.global.aline.toString(), P = webphone_api.common.StrToInt(T);
                        P < 1 && (webphone_api.global.aline = webphone_api.common.GetFreeLine());
                        var a = "unknown";
                        e && null !== e && e.session && null !== e.session && (a = e.session.getRemoteFriendlyName());
                        var l = webphone_api.common.GetEndpoint(-1, a, e.session.getId(), !1), p = "";
                        webphone_api.common.isNull(l) || (p = l[webphone_api.common.EP_CALLID]), !webphone_api.common.isNull(l) && l.length > webphone_api.common.EP_SETUPSENT && "true" === l[webphone_api.common.EP_SETUPSENT] || (webphone_api.common.PutToDebugLog(1, "STATUS," + webphone_api.global.aline.toString() + ",CallSetup," + a + "," + webphone_api.common.GetSipusername() + ",1," + a + ",[" + p + "],,,,,"), webphone_api.common.SaveCallSession(webphone_api.global.aline, e.session, a, "1", webphone_api.common.GetTickCount(), -5, -5, "", e.session.getId(), "true", "", null));
                        var S = e.getSipResponseCode();
                        e.session.acceptTransfer()
                    }
                }
        }
    }

    function BuildCDR(e, o, t, n) {
        try {
            2 === webphone_api.common.GetParameterInt("androidspeaker", 1) && !1 === adev_hack_called && "Android" === webphone_api.common.GetOs() && (webphone_api.common.isNull(audioinput_id) || audioinput_id.length < 1 || audioinput_name[0].toLowerCase().indexOf("microphone") >= 0 && audioinput_name[0].indexOf("1") >= 0) && (adev_hack_called = !0, StartGetDevices(), setTimeout(function () {
                webphone_api.plhandler.GetAudioDevicesForMenu(0, !0)
            }, 200));
            var i = !0;
            !0 === webphone_api.global.calltransf_completed && (i = !1);
            var a = webphone_api.common.GetEndpoint(e, o, t, i);
            if (webphone_api.common.isNull(a) || a.length < 5) return void webphone_api.common.PutToDebugLog(2, "ERROR, webrtcapi: BuildCDR invalid endpoint");
            var r = 0, s = 0, l = 0, p = "", c = !1;
            !webphone_api.common.isNull(a[webphone_api.common.EP_SETUPTIME]) && webphone_api.common.IsNumber(a[webphone_api.common.EP_SETUPTIME]) && (r = webphone_api.common.StrToInt(a[webphone_api.common.EP_SETUPTIME])), !webphone_api.common.isNull(a[webphone_api.common.EP_CONNECTTIME]) && webphone_api.common.IsNumber(a[webphone_api.common.EP_CONNECTTIME]) && (s = webphone_api.common.StrToInt(a[webphone_api.common.EP_CONNECTTIME])), !webphone_api.common.isNull(a[webphone_api.common.EP_DESTNR]) && a[webphone_api.common.EP_DESTNR].length > 0 && (p = a[webphone_api.common.EP_DESTNR]), webphone_api.common.isNull(a[webphone_api.common.EP_INCOMING]) || 1 !== a[webphone_api.common.EP_INCOMING].length || "2" === a[webphone_api.common.EP_INCOMING] && (c = !0), l = webphone_api.common.GetTickCount();
            var u = 0;
            !webphone_api.common.isNull(s) && s > 0 && !webphone_api.common.isNull(l) && l > 0 && (u = l - s), p = webphone_api.common.isNull(p) ? "" : webphone_api.common.Trim(p), webphone_api.common.isNull(s) && (s = 0);
            var h = "", m = "", g = "NA";
            !webphone_api.common.isNull(s) && webphone_api.common.IsNumber(s) && !webphone_api.common.isNull(r) && webphone_api.common.IsNumber(r) && (g = (s - r).toString());
            c ? (h = p, m = webphone_api.common.GetSipusername()) : (h = webphone_api.common.GetSipusername(), m = p), webphone_api.common.isNull(n) && (n = "");
            var d = a[webphone_api.common.EP_CALLID];
            (webphone_api.common.isNull(t) || t.length < 1) && (d = t), webphone_api.common.GetDiscReasonFromSignaling(function (o) {
                !webphone_api.common.isNull(o) && o.length > 0 && (n = o);
                var t = "CDR," + e + "," + p + "," + h + "," + m + ",NA," + g + "," + u.toString() + ",NA," + n + "," + d;
                webphone_api.global.lastcallcdr = t, setTimeout(function () {
                    webphone_api.common.PutToDebugLog(1, t)
                }, 500), setTimeout(function () {
                    SendRegisteredStatus()
                }, 1500)
            })
        } catch (b) {
            webphone_api.common.PutToDebugLogException(2, "webrtcapi: BuildCDR", b)
        }
    }

    function SendRegisteredStatus() {
        isregistered && webphone_api.common.PutToDebugLog(1, "STATUS,-1,Registered.")
    }

    function GetWebrtcStats() {
        try {
            return
        } catch (e) {
            webphone_api.common.PutToDebugLogException(2, "webrtcapi: GetWebrtcStats", e)
        }
    }

    function DumpStats(e) {
        try {
            var o = "";
            return Object.keys(e).forEach(function (t, n) {
                var i = e[t];
                o += "<h3>Report ", o += n, o += "</h3>\n", o += "time " + i.timestamp + "<br>\n", o += "type " + i.type + "<br>\n", Object.keys(i).forEach(function (e) {
                    "timestamp" !== e && "type" !== e && (o += e + ": " + i[e] + "<br>\n")
                })
            }), o
        } catch (t) {
            webphone_api.common.PutToDebugLogException(2, "webrtcapi: DumpStats", t)
        }
        return ""
    }

    function SetVolume(e, o) {
        try {
            if (webphone_api.common.isNull(o) || !webphone_api.common.IsNumber(o)) return void webphone_api.common.PutToDebugLog(2, "ERROR, webrtcapi: SetVolume is NULL: " + o);
            var t = webphone_api.common.StrToInt(o);
            if (t < 0 || t > 100) return void webphone_api.common.PutToDebugLog(2, "ERROR, webrtcapi: SetVolume invalid value. Accepted varulue range is from 0 - 100: " + t);
            var n = document.getElementById("audio_remote");
            if (webphone_api.common.isNull(n)) return webphone_api.common.PutToDebugLog(2, "ERROR, webrtcapi: SetVolume cannot find audio element"), !1;
            0 == e || "0" == e ? (t > 100 && (t = 100), t < 0 && (t = 0), t /= 100, webphone_api.webrtcMicVolume = t) : 2 == e && "2" == e ? (t > 100 && (t = 100), webphone_api.$("#ringtone").prop("volvalueforgetvolume", t), webphone_api.$("#ringbacktone").prop("volvalueforgetvolume", t), t = t / 100 * 2, t > 1 && (t = 1), webphone_api.$("#ringtone").prop("volume", t), webphone_api.$("#ringbacktone").prop("volume", t)) : 0 != e && "0" != e && (t > 100 && (t = 100), webphone_api.$("#audio_remote").prop("volvalueforgetvolume", t), t = t / 100 * 2, t > 1 && (t = 1), webphone_api.$("#audio_remote").prop("volume", t), webphone_api.$("#video_remote").prop("volume", t))
        } catch (i) {
            webphone_api.common.PutToDebugLogException(2, "webrtcapi: SetVolume", i)
        }
    }

    function GetVolume(e) {
        try {
            if (0 == e || "0" == e) {
                return webphone_api.common.GetParameterInt("volumein", 50)
            }
            if (0 != e) {
                var o = webphone_api.$("#audio_remote").prop("volume");
                o = 100 * o / 2;
                var t = webphone_api.$("#audio_remote").prop("volvalueforgetvolume");
                return !webphone_api.common.isNull(t) && webphone_api.common.IsNumber(t) && (o = webphone_api.common.StrToInt(t)), webphone_api.common.PutToDebugLog(2, "webrtcapi: GetVolume returned: " + o.toString()), o
            }
        } catch (n) {
            webphone_api.common.PutToDebugLogException(2, "webrtcapi: GetVolume", n)
        }
    }

    function GetAudioDeviceList(e) {
        try {
            var o = [];
            o = 0 == e ? audioinput_name : 1 === e || 2 === e ? audiooutput_name : videoinput_name;
            var t = "";
            if (!webphone_api.common.isNull(o) && o.length > 0) for (var n = 0; n < o.length; n++) t.length > 0 && (t += "\r\n"), t += o[n];
            return t
        } catch (i) {
            webphone_api.common.PutToDebugLogException(2, "webrtcapi: GetAudioDeviceList", i)
        }
        return ""
    }

    function GetAudioDevice(e) {
        try {
            var o = "";
            if (0 == e) {
                o = audioinput_name[0];
                var t = webphone_api.common.GetParameter("sel_rtc_audio_in");
                if (!webphone_api.common.isNull(t) && t.length > 0) for (var n = 0; n < audioinput_name.length; n++) if (t === audioinput_name[n]) {
                    o = t;
                    break
                }
                (webphone_api.common.isNull(o) || o.length < 1) && (o = t), webphone_api.common.SaveParameter("sel_rtc_audio_in", o)
            } else if (1 == e || 2 == e) {
                o = audiooutput_name[0];
                var t = webphone_api.common.GetParameter("sel_rtc_audio_out");
                if (!webphone_api.common.isNull(t) && t.length > 0) for (var n = 0; n < audiooutput_name.length; n++) if (t === audiooutput_name[n]) {
                    o = t;
                    break
                }
                (webphone_api.common.isNull(o) || o.length < 1) && (o = t), webphone_api.common.SaveParameter("sel_rtc_audio_out", o)
            }
            if (3 == e) {
                o = videoinput_name[0];
                var t = webphone_api.common.GetParameter("sel_rtc_video_in");
                if (!webphone_api.common.isNull(t) && t.length > 0) for (var n = 0; n < videoinput_name.length; n++) if (t === videoinput_name[n]) {
                    o = t;
                    break
                }
                (webphone_api.common.isNull(o) || o.length < 1) && (o = t), webphone_api.common.SaveParameter("sel_rtc_video_in", o)
            }
            return o
        } catch (i) {
            webphone_api.common.PutToDebugLogException(2, "webrtcapi: GetAudioDevice", i)
        }
        return ""
    }

    function SetAudioDevice(e, o, t) {
        try {
            var n = !1;
            if (webphone_api.common.isNull(o) || o.length < 0) return void webphone_api.common.PutToDebugLog(2, "ERROR, webrtcapi SetAudioDevice: invalid devicename: " + o);
            if (webphone_api.common.PutToDebugLog(3, "EVENT, webrtcapi SetAudioDevice: device: " + e + ", devicename: " + o), o = o.toLowerCase(), 0 === e) {
                for (var i = 0; i < audioinput_name.length; i++) if (!webphone_api.common.isNull(audioinput_name[i]) && audioinput_name[i].toLowerCase() === o) {
                    webphone_api.common.SaveParameter("sel_rtc_audio_in", audioinput_name[i]), GetSetDevices(audioinput_id[i], "", t), n = !0;
                    break
                }
            } else if (1 === e || 2 === e) {
                for (var i = 0; i < audiooutput_name.length; i++) if (!webphone_api.common.isNull(audiooutput_name[i]) && audiooutput_name[i].toLowerCase() === o) {
                    var a = audiooutput_name[i];
                    webphone_api.common.SaveParameter("sel_rtc_audio_out", a.toString()), webphone_api.common.isNull(videoElement) ? webphone_api.common.PutToDebugLog(2, "WARNING, webrtcapi SetAudioDevice videoElement is NULL") : attachSinkId(videoElement, audiooutput_id[i], "audio output_v"), attachSinkId(audioRemoteElement, audiooutput_id[i], "audio output"), n = !0;
                    break
                }
            } else for (var i = 0; i < videoinput_name.length; i++) if (!webphone_api.common.isNull(videoinput_name[i]) && videoinput_name[i].toLowerCase() === o) {
                webphone_api.common.SaveParameter("sel_rtc_video_in", videoinput_name[i]), !0 === t && (webphone_api.common.isNull(videoElement) ? webphone_api.common.PutToDebugLog(2, "WARNING, webrtcapi SetAudioDevice for video videoElement is NULL") : attachSinkId(videoElement, videoinput_id[i], "video")), n = !0;
                break
            }
            !1 === n && webphone_api.common.PutToDebugLog(2, "ERROR, webrtcapi SetAudioDevice device not found")
        } catch (r) {
            webphone_api.common.PutToDebugLogException(2, "webrtcapi: SetAudioDevice", r)
        }
    }

    function StartGetDevices() {
        try {
            videoElement = document.getElementById("video_remote"), audioRemoteElement = document.getElementById("audio_remote"),
                webphone_api.common.isNull(navigator.mediaDevices) || webphone_api.common.isNull(navigator.mediaDevices.enumerateDevices) || eval("navigator.mediaDevices.enumerateDevices().then(gotDevices).catch(errorCallback);")
        } catch (err) {
            webphone_api.common.PutToDebugLogException(2, "webrtcapi: StartGetDevices", err)
        }
    }

    function GetSetDevices(audioSource, videoSource, setalsovideo, vid_prev_elem) {
        try {
            window.stream && window.stream.getTracks().forEach(function (e) {
                e.stop()
            });
            var constraints = null;
            constraints = !0 === setalsovideo ? {
                audio: { deviceId: audioSource ? { exact: audioSource } : undefined },
                video: { deviceId: videoSource ? { exact: videoSource } : undefined }
            } : { audio: { deviceId: audioSource ? { exact: audioSource } : undefined } }, webphone_api.common.isNull(navigator.mediaDevices) || webphone_api.common.isNull(navigator.mediaDevices.getUserMedia) || eval("navigator.mediaDevices.getUserMedia(constraints).then(function(stream){window.stream = stream;if(typeof(vid_prev_elem) !== 'undefined' && vid_prev_elem !== null) { attachMediaStream(vid_prev_elem, stream); }}).then(gotDevices).catch(errorCallback);")
        } catch (err) {
            webphone_api.common.PutToDebugLogException(2, "webrtcapi: GetSetDevices", err)
        }
    }

    function SwitchOffAndroidSpeaker(callback) {
        function GUMHandleSuccess(stream) {
            function ENUMgotdevices(e) {
                try {
                    if (!webphone_api.common.isNull(e) && e.length > 0) {
                        audioinput_name = [], audioinput_id = [], audiooutput_name = [], audiooutput_id = [], videoinput_name = [], videoinput_id = [];
                        for (var o = 0; o !== e.length; ++o) {
                            var t = e[o], n = t.deviceId;
                            if ("audioinput" === t.kind) {
                                var i = t.label || "microphone " + (audioinput_name.length + 1);
                                audioinput_name.push(i), audioinput_id.push(n)
                            } else if ("audiooutput" === t.kind) {
                                var i = t.label || "speaker " + (audiooutput_name.length + 1);
                                audiooutput_name.push(i), audiooutput_id.push(n)
                            } else if ("videoinput" === t.kind) {
                                var i = t.label || "camera " + (videoinput_name.length + 1);
                                videoinput_name.push(i), videoinput_id.push(n)
                            } else webphone_api.common.PutToDebugLog(3, "EVENT, webrtcapi GUMgotdevices: Some other kind of source/device: ", t)
                        }
                        webphone_api.common.PutToDebugLog(2, "EVENT, mlogic API_GetDevicelist WebRTC 0"), webphone_api.getdevicelist(0, function () {
                        }), webphone_api.common.PutToDebugLog(2, "EVENT, mlogic API_GetDevicelist WebRTC 1"), webphone_api.getdevicelist(1, function () {
                        }), webphone_api.common.PutToDebugLog(2, "EVENT, mlogic API_GetDevicelist WebRTC 3"), webphone_api.getdevicelist(3, function () {
                        }), webphone_api.common.PutToDebugLog(3, "EVENT, webrtcapi SwitchOffAndroidSpeaker GUMgotdevices executed successfully"), callback()
                    } else webphone_api.common.PutToDebugLog(2, "WARNING, webrtrcapi GUMgotdevices: no devices found"), callback()
                } catch (a) {
                    webphone_api.common.PutToDebugLogException(2, "webrtcapi: ENUMgotdevices", a), callback()
                }
            }

            function ENUMerrorCallback(e) {
                webphone_api.common.PutToDebugLog(2, "ERROR, GUMerrorCallback webrtcapi navigator.getUserMedia: " + e), callback()
            }

            try {
                eval("navigator.mediaDevices.enumerateDevices().then(ENUMgotdevices).catch(ENUMerrorCallback);")
            } catch (err) {
                webphone_api.common.PutToDebugLogException(2, "webrtcapi: GUMHandleSuccess", err), callback()
            }
        }

        function GUMHandleError(e) {
            try {
                webphone_api.common.PutToDebugLog(2, "ERROR, GUMHandleError webrtcapi navigator.getUserMedia: " + e), callback()
            } catch (o) {
                webphone_api.common.PutToDebugLogException(2, "webrtcapi: GUMHandleError", o), callback()
            }
        }

        try {
            if (callback && "function" == typeof callback || (callback = function () {
            }), "MSIE" === webphone_api.common.GetBrowser()) return void callback();
            if (!0 === switchas_called || "Android" !== webphone_api.common.GetOs()) return void callback();
            var as = webphone_api.common.GetParameterInt("androidspeaker", 1);
            if (as < 1) return void callback();
            switchas_called = !0;
            var constraints = { audio: !0, video: !1 };
            eval("navigator.mediaDevices.getUserMedia(constraints).then(GUMHandleSuccess).catch(GUMHandleError);")
        } catch (err) {
            webphone_api.common.PutToDebugLogException(2, "webrtcapi: SwitchOffAndroidSpeaker", err), callback()
        }
    }

    function MyCameraPreview(e) {
        try {
            if (webphone_api.common.GetParameterInt("displayvideodevice", 0) < 1) return;
            webphone_api.common.PutToDebugLog(2, "EVENT, webrtcapi MyCameraPreview: " + e);
            var o = '<div id="preview_div_video_local" class="previewvideo"><video class="video" width="100%" height="100%" id="preview_video_local" autoplay="autoplay" muted="true"></video><button id="preview_btn_close">' + webphone_api.stringres.get("btn_close") + "</button></div>";
            if (!1 === webphone_api.common.IsSDK()) {
                var t = webphone_api.$.mobile.activePage.attr("id");
                webphone_api.$("#" + t).append(o)
            } else webphone_api.$("body").append(o);
            var n = document.getElementById("preview_video_local");
            if (webphone_api.common.isNull(n)) return void webphone_api.common.PutToDebugLog(2, "EVENT, MyCameraPreview video element is NULL");
            webphone_api.$("#preview_btn_close").on("click", function () {
                HideVideoPriview()
            });
            GetSetDevices(GetAudioVideoInputId(webphone_api.common.GetParameter("sel_rtc_audio_in"), !1), GetAudioVideoInputId(webphone_api.common.GetParameter("sel_rtc_video_in"), !0), !0, n), setTimeout(function () {
                HideVideoPriview()
            }, 1e4)
        } catch (i) {
            webphone_api.common.PutToDebugLogException(2, "webrtcapi: MyCameraPreview", i)
        }
    }

    function HideVideoPriview() {
        try {
            var e = document.getElementById("preview_video_local");
            if (webphone_api.common.isNull(e)) return;
            "undefined" != typeof URL.revokeObjectURL && URL.revokeObjectURL(e.src), e.src && (e.src = null), webphone_api.$("#preview_div_video_local").remove()
        } catch (o) {
            webphone_api.common.PutToDebugLogException(2, "webrtcapi: HideVideoPriview", o)
        }
    }

    function PrintWebRTCAudioDevices() {
        try {
            if (!0 === webphone_api.global.printwad_called) return;
            webphone_api.global.printwad_called = !0, webphone_api.common.isNull(audioinput_name) || webphone_api.common.isNull(audioinput_id) || webphone_api.common.PutToDebugLog(2, "EVENT, webrtcdevices: audio input devices name: " + audioinput_name.toString() + "; ids: " + audioinput_id.toString()), webphone_api.common.isNull(audiooutput_name) || webphone_api.common.isNull(audiooutput_id) || webphone_api.common.PutToDebugLog(2, "EVENT, webrtcdevices: audio output devices name: " + audiooutput_name.toString() + "; ids: " + audiooutput_id.toString()), webphone_api.common.isNull(videoinput_name) || webphone_api.common.isNull(videoinput_id) || webphone_api.common.PutToDebugLog(2, "EVENT, webrtcdevices: video input devices name: " + videoinput_name.toString() + "; ids: " + videoinput_id.toString())
        } catch (e) {
            webphone_api.common.PutToDebugLogException(2, "webrtcapi: PrintWebRTCAudioDevices", e)
        }
    }

    function GetAudioVideoInputId(e, o) {
        try {
            if (webphone_api.common.isNull(e) || e.length < 1) return e;
            if (!0 === o) {
                if (webphone_api.common.isNull(videoinput_name) || videoinput_name.length < 1 || webphone_api.common.isNull(videoinput_id) || videoinput_id.length < 1) return e;
                for (var t = 0; t < videoinput_name.length; t++) if (e === videoinput_name[t]) return videoinput_id[t]
            } else {
                if (webphone_api.common.isNull(audioinput_name) || audioinput_name.length < 1 || webphone_api.common.isNull(audioinput_id) || audioinput_id.length < 1) return e;
                for (var t = 0; t < audioinput_name.length; t++) if (e === audioinput_name[t]) return audioinput_id[t]
            }
        } catch (n) {
            webphone_api.common.PutToDebugLogException(2, "webrtcapi: GetAudioInputId", n)
        }
        return e
    }

    function gotDevices(e) {
        try {
            if (!webphone_api.common.isNull(e) && e.length > 0) {
                audioinput_name = [], audioinput_id = [], audiooutput_name = [], audiooutput_id = [], videoinput_name = [], videoinput_id = [];
                for (var o = 0; o !== e.length; ++o) {
                    var t = e[o], n = t.deviceId;
                    if ("audioinput" === t.kind) {
                        var i = t.label || "microphone " + (audioinput_name.length + 1);
                        audioinput_name.push(i), audioinput_id.push(n)
                    } else if ("audiooutput" === t.kind) {
                        var i = t.label || "speaker " + (audiooutput_name.length + 1);
                        audiooutput_name.push(i), audiooutput_id.push(n)
                    } else if ("videoinput" === t.kind) {
                        var i = t.label || "camera " + (videoinput_name.length + 1);
                        videoinput_name.push(i), videoinput_id.push(n)
                    } else webphone_api.common.PutToDebugLog(3, "EVENT, webrtcapi gotDevices: Some other kind of source/device: ", t)
                }
                PrintWebRTCAudioDevices()
            } else webphone_api.common.PutToDebugLog(2, "WARNING, webrtrcapi gotDevices: no devices found")
        } catch (a) {
            webphone_api.common.PutToDebugLogException(2, "webrtcapi: gotDevices", a)
        }
    }

    function attachSinkId(element, sinkId, msg) {
        try {
            "undefined" != typeof element.sinkId ? eval("element.setSinkId(sinkId).then(function(){webphone_api.common.PutToDebugLog(3, 'EVENT, webrtcapi attachSinkId: Success, ' + msg + ' device: ' + element.toString() + '; attached: ' + sinkId);}).catch(function(error){var errorMessage = error;if (error.name === 'SecurityError'){errorMessage = 'You need to use HTTPS for selecting audio output device: ' + error;}webphone_api.common.PutToDebugLog(2, 'ERROR, webrtcapi attachSinkId to: ' + element.toString() + '; sinkId: ' + sinkId + ' error: ' + errorMessage);});") : webphone_api.common.PutToDebugLog(2, "WARNING, webrtcapi attachSinkId: Browser does not support output device selection.")
        } catch (err) {
            webphone_api.common.PutToDebugLogException(2, "webrtcapi: attachSinkId", err)
        }
    }

    function errorCallback(e) {
        webphone_api.common.PutToDebugLog(2, "ERROR, webrtcapi navigator.getUserMedia: " + e)
    }

    function AddVideoElemnts(e) {
        try {
            var o = '<div id="div_video"><div id="div_video_remote"><video class="video" width="100%" height="100%" id="video_remote" autoplay="autoplay"></video></div><div id="div_video_local_wrapper"><iframe allow="microphone; camera" class="previewvideo"> </iframe><div id="div_video_local" class="previewvideo"><video class="video" width="100%" height="100%" id="video_local" autoplay="autoplay" muted="true"></video></div></div><div id="div_video_fullscreen_button"><button id="btn_video_fullscreen" class="ui-btn ui-btn-corner-all ui-btn-b noshadow">' + webphone_api.stringres.get("btn_video_fullscreen") + "</button></div></div>";
            videocontainer = document.getElementById("video_container"), webphone_api.common.isNull(videocontainer) ? !0 === e ? webphone_api.common.PutToDebugLog(2, "WARNING, AddVideoElemnts cannot find video_container DIV") : webphone_api.common.PutToDebugLog(2, "EVENT, AddVideoElemnts cannot find video_container DIV") : webphone_api.common.isNull(divVideo) && (webphone_api.common.PutToDebugLog(2, "EVENT, AddVideoElemnts video elements added"), videocontainer.innerHTML = o), divVideo = document.getElementById("div_video"), videoLocal = document.getElementById("video_local"), videoRemote = document.getElementById("video_remote"), audioRemote = document.getElementById("audio_remote"), webphone_api.$("#btn_video_fullscreen").off("click"), webphone_api.$("#btn_video_fullscreen").on("click", function () {
                toggleFullScreen()
            })
        } catch (t) {
            webphone_api.common.PutToDebugLogException(2, "webrtcapi: AddVideoElemnts", t)
        }
    }

    function GetVideoSizeObj() {
        var e = undefined;
        try {
            var o = webphone_api.common.GetParameter2("video_min_width"),
                t = webphone_api.common.GetParameter2("video_min_height"),
                n = webphone_api.common.GetParameter2("video_max_width"),
                i = webphone_api.common.GetParameter2("video_max_height"),
                a = webphone_api.common.GetParameter2("video_width"),
                r = webphone_api.common.GetParameter2("video_height"), s = 0, l = 0, p = 0, c = 0, u = 0, h = 0;
            s = !webphone_api.common.isNull(o) && o.length > 0 && webphone_api.common.IsNumber(o) ? webphone_api.common.StrToInt(o) : 100, l = !webphone_api.common.isNull(t) && t.length > 0 && webphone_api.common.IsNumber(t) ? webphone_api.common.StrToInt(t) : 80, p = !webphone_api.common.isNull(n) && n.length > 0 && webphone_api.common.IsNumber(n) ? webphone_api.common.StrToInt(n) : 1920, c = !webphone_api.common.isNull(i) && i.length > 0 && webphone_api.common.IsNumber(i) ? webphone_api.common.StrToInt(i) : 1080, u = !webphone_api.common.isNull(a) && a.length > 0 && webphone_api.common.IsNumber(a) ? webphone_api.common.StrToInt(a) : 960, h = !webphone_api.common.isNull(r) && r.length > 0 && webphone_api.common.IsNumber(r) ? webphone_api.common.StrToInt(r) : 540, 71 === webphone_api.common.GetConfigInt("brandid", -1) && (u > 0 && (s = u), h > 0 && (l = h)), s > 0 && l > 0 && p > 0 && c > 0 && (webphone_api.common.PutToDebugLog(2, "EVENT, webrtcapi: video minw: " + s + "; minh: " + l + "; maxw: " + p + "; maxh: " + c), e = {
                minWidth: s,
                minHeight: l,
                maxWidth: p,
                maxHeight: c,
                width: u,
                height: h
            })
        } catch (m) {
            webphone_api.common.PutToDebugLogException(2, "webrtcapi: GetVideoSizeObj", m)
        }
        return e
    }

    function GetRegFailReason() {
        return webphone_api.common.isNull(lastregfailreason) && (lastregfailreason = ""), lastregfailreason
    }

    function SetPushNotifications(e, o, t, n) {
        try {
            if (webphone_api.common.isNull(o) || o.length < 3) return void webphone_api.common.PutToDebugLog(2, "ERROR, webrtcapi SetPushNotifications invalid TOKEN: " + o);
            webphone_api.common.isNull(t) && (t = ""), webphone_api.common.isNull(n) && (n = "");
            var i = "X-MPUSH: w:" + webphone_api.common.GetFCMPackageName() + ":" + o,
                a = webphone_api.common.GetSipusername() + ":" + webphone_api.global.mRealm + ":" + webphone_api.common.GetParameter("password"),
                r = "X-PIID: " + webphone_api.common.Md5Hash(a);
            SetSipHeader(0, i), SetSipHeader(0, r), webphone_api.global.phonestarted > 2 && ResendRegister()
        } catch (s) {
            webphone_api.common.PutToDebugLogException(2, "webrtcapi: SetPushNotifications", s)
        }
    }

    function PlaySound(e, o, t, n) {
        try {
            return !webphone_api.common.isNull(ps_audio) && ps_audio.pause && ps_audio.pause(), ps_audio = null, 1 == e && !webphone_api.common.isNull(o) && o.length > 0 && (ps_audio = new Audio(o), !0 === t && ps_audio.addEventListener("ended", function () {
                this.currentTime = 0, this.play()
            }, !1), ps_audio.play()), !0
        } catch (i) {
            webphone_api.common.PutToDebugLogException(2, "webrtcapi: PlaySound", i)
        }
        return !1
    }

    function LineToCallID(e) {
        try {
            var o = webphone_api.common.StrToInt(e);
            if (webphone_api.common.isNull(webphone_api.global.ep) || webphone_api.global.ep.length < 1) return "";
            for (var t = 0; t < webphone_api.global.ep.length; t++) {
                var n = webphone_api.global.ep[t];
                if (!(webphone_api.common.isNull(n) || n.length < 9) && n[webphone_api.common.EP_LINE] == o) return n[webphone_api.common.EP_CALLID]
            }
        } catch (i) {
            webphone_api.common.PutToDebugLogException(2, "webrtcapi: LineToCallID", i)
        }
        return ""
    }

    function CallIDToLine(e) {
        try {
            if (e = e.toString(), e.length < 1) return -10;
            if (webphone_api.common.isNull(webphone_api.global.ep) || webphone_api.global.ep.length < 1) return "";
            for (var o = 0; o < webphone_api.global.ep.length; o++) {
                var t = webphone_api.global.ep[o];
                if (!(webphone_api.common.isNull(t) || t.length < 9) && t[webphone_api.common.EP_CALLID] == e) return t[webphone_api.common.EP_LINE]
            }
        } catch (n) {
            webphone_api.common.PutToDebugLogException(2, "webrtcapi: CallIDToLine", n)
        }
        return -10
    }

    var sTransferNumber, oRingTone, oRingbackTone, oSipStack, oSipSessionRegister, oSipSessionCall, oSipSessionMessage,
        oSipSessionTransferCall, videoRemote, videoLocal, audioRemote, divVideo, bFullScreen = !1, oNotifICall,
        bDisableVideo = !1, viewVideoLocal, viewVideoRemote, viewLocalScreencast, oConfigCall, oConfigMessage,
        oConfigSms, oReadyStateTimer, isregistered = !1, sipheaders = [], callsipheaders = [], mSipuri = "",
        mDisplayname = "", changesptoring = 2, recheckmediaonconnect = 2, lastregfailreason = "",
        C = { divKeyPadWidth: 220 }, initcallback = null, lastrestarttick = 0, restartdelay = 2e3, restarttimestr = "",
        te2 = null, sipstackstarted = !1, redialonfailtimer = null, calltype = "", callline = 1, destnumber = "",
        last_vid_device = "", red_line = null, red_sessioncall = null, red_number = null, red_setuptime = 0,
        red_callid = null, red_headers = null, red_delaytime = 6e3, red_s_type = "call-audio", lastmuste_mute = null,
        lastmuste_direction = null, lastmuste_line = null, lastmuste_log = null, publishSession, subscribeSession,
        maxnrofusers = 25, pgmaxloop = 0, check_reg_timer = null, reregstarted = !1, rereg_timer = null,
        rereg_ival = 1e4, rereg_action = 0, last_event = "", lastsession = null, lastsessionid = -1e3,
        istypeincoming = !1, adev_hack_called = !1, videoElement = null, audioRemoteElement = null,
        switchas_called = !1, audioinput_name = [], audioinput_id = [], audiooutput_name = [], audiooutput_id = [],
        videoinput_name = [], videoinput_id = [], videocontainer = null, ps_audio = null;
    return {
        WebRtcIsSupported: WebRtcIsSupported,
        Start: Start,
        RegisterEx: RegisterEx,
        SipUnRegister: SipUnRegister,
        SipStop: SipStop,
        SipCall: SipCall,
        SipHangup: SipHangup,
        SipAccept: SipAccept,
        SipIgnore: SipIgnore,
        SipSendChat: SipSendChat,
        Forward: Forward,
        SipTransfer: SipTransfer,
        SipMuteVideo: SipMuteVideo,
        SipToggleHoldResume: SipToggleHoldResume,
        SipToggleMute: SipToggleMute,
        SipSendDTMF: SipSendDTMF,
        PresenceSet: PresenceSet,
        PresenceGet: PresenceGet,
        SetSipHeader: SetSipHeader,
        GetRegFailReason: GetRegFailReason,
        SetVolume: SetVolume,
        GetVolume: GetVolume,
        GetAudioDeviceList: GetAudioDeviceList,
        GetAudioDevice: GetAudioDevice,
        SetAudioDevice: SetAudioDevice,
        SwitchOffAndroidSpeaker: SwitchOffAndroidSpeaker,
        PlaySound: PlaySound,
        LineToCallID: LineToCallID,
        CallIDToLine: CallIDToLine,
        GetUDPServerAddress: GetUDPServerAddress,
        ReStart: ReStart,
        GetWebrtcStats: GetWebrtcStats,
        GetAudioVideoInputId: GetAudioVideoInputId,
        MyCameraPreview: MyCameraPreview,
        HideVideoPriview: HideVideoPriview,
        RemoveUnusedAudioElements: RemoveUnusedAudioElements,
        JsObjecSniffer: JsObjecSniffer,
        ResendRegister: ResendRegister,
        StartReRegister: StartReRegister,
        GetVideoSizeObj: GetVideoSizeObj,
        SetPushNotifications: SetPushNotifications
    }
}(), webphone_api.plhandler = function () {
    function e(o, i) {
        try {
            Vo("Start");
            var a = webphone_api.common.GetTickCount(), r = a - webphone_api.global.laststarttick;
            if (webphone_api.global.laststarttick > 0 && r < 250) return webphone_api.common.PutToDebugLog(3, "EVENT, plhandler start already called"), !1;
            webphone_api.common.HandleCallerID(), webphone_api.global.laststarttick = a, webphone_api.global.pres_set_at_start = !1, webphone_api.global.pingpong = 0, webphone_api.global.ever_received_pong = !1, webphone_api.common.GetCustomMenus(), webphone_api.global.nuiswebpage = null, webphone_api.global.phonestarttick < 0 && (webphone_api.global.phonestarttick = webphone_api.common.GetTickCount());
            var s = webphone_api.common.GetAutostart();
            if (!1 === i && 0 === s) return webphone_api.common.PutToDebugLog(3, "EVENT, plhandler autologin disabled because autostart is FALSE"), !1;
            webphone_api.global.colorizelog = webphone_api.common.GetParameterInt("colorizelog", 0), webphone_api.global.authenticated_displayed = !1, webphone_api.global.applet_started = !1, Xo = o, webphone_api.global.lastengine_working_ok = "", webphone_api.common.PutToDebugLog(3, "EVENT, plhandler onstart"), webphone_api.common.PutToDebugLog(1, "STATUS,-1," + webphone_api.stringres.get("initializing"));
            var l = webphone_api.common.GetParameter("serveraddress_user");
            (webphone_api.common.isNull(l) || l.length < 2) && (l = webphone_api.common.GetParameter("serveraddress")), (webphone_api.common.isNull(l) || l.length < 2) && webphone_api.common.PutToDebugLog(2, "EVENT, plhandler start serveraddress not set");
            var p = !0;
            if (!1 === webphone_api.global.usestorage && !webphone_api.common.CheckDID(l, !1)) if (!webphone_api.common.IsIPAddrress(l) && l.indexOf(".") > 0) {
                var c = webphone_api.common.DomainToIp(l, function () {
                });
                if (webphone_api.common.isNull(c) || !(c.length > 0) || !0 !== webphone_api.common.IsIPAddrress(c)) return Qo = o, Zo = i, void webphone_api.common.DomainToIp(l, function (o) {
                    !webphone_api.common.isNull(o) && o.length > 0 && !0 === webphone_api.common.IsIPAddrress(o) && (webphone_api.common.CheckDID(o, !1) || (p = !1)), e(Qo, Zo)
                });
                webphone_api.common.CheckDID(c, !1) || (p = !1)
            } else p = !1;
            if (!1 === p) {
                var u = [];
                u.push("E"), u.push("R"), u.push("R"), u.push("O"), u.push("R"), u.push(","), u.push("S"), u.push("e"), u.push("r"), u.push("v"), u.push("e"), u.push("r"), u.push(" "), u.push("n"), u.push("o"), u.push("t"), u.push(" "), u.push("a"), u.push("l"), u.push("l"), u.push("o"), u.push("w"), u.push("e"), u.push("d"), u.push("_");
                var h = u.join("");
                return setTimeout(function () {
                    webphone_api.common.PutToDebugLog(1, h + " " + l)
                }, 851), !1
            }
            Ko = !0, webphone_api.common.isNull(zo) || clearTimeout(zo), zo = setTimeout(function () {
                Ko = !1
            }, 2e3), webphone_api.common.PutToDebugLog(2, "EVENT, plhandler onstart reset useengine"), webphone_api.global.useengine = "", webphone_api.global.readcallhistoryforrecents = !0, webphone_api.common.IsWindowsSoftphone() ? webphone_api.common.SaveParameter("devicetype", webphone_api.common.DEVICE_WIN_SOFTPHONE()) : webphone_api.common.SaveParameter("devicetype", webphone_api.common.DEVICE_WEBPHONE());
            var m = window.location.href;
            webphone_api.common.isNull(m) && (m = "");
            var g = m.indexOf("#");
            if (g > 0 && (m = m.substring(0, g)), g = m.indexOf("?"), g > 0 && (m = m.substring(0, g)), webphone_api.common.SaveParameter("wphoneappurl", m), !webphone_api.common.Glsp()) {
                Jo--;
                var u = [];
                u.push("E"), u.push("R"), u.push("R"), u.push("O"), u.push("R"), u.push(","), u.push(" "), u.push("U"), u.push("s"), u.push("a"), u.push("g"), u.push("e"), u.push(" "), u.push("o"), u.push("n"), u.push(" "), u.push("t"), u.push("h"), u.push("i"), u.push("s"), u.push(" "), u.push("o"), u.push("p"), u.push("e"), u.push("r"), u.push("a"), u.push("t"), u.push("i"), u.push("n"), u.push("g"), u.push(" "), u.push("s"), u.push("y"), u.push("s"), u.push("t"), u.push("e"), u.push("m"), u.push(" "), u.push("i"), u.push("s"), u.push(" "), u.push("n"), u.push("o"), u.push("t"), u.push(" "), u.push("p"), u.push("e"), u.push("r"), u.push("m"), u.push("i"), u.push("t"), u.push("t"), u.push("e"), u.push("d"), u.push(" "), u.push("b"), u.push("y"), u.push(" "), u.push("t"), u.push("h"), u.push("i"), u.push("s"), u.push(" "), u.push("l"), u.push("i"), u.push("c"), u.push("e"), u.push("n"), u.push("s"), u.push("e"), u.push("."), u.push(" "), u.push("U"), u.push("p"), u.push("g"), u.push("r"), u.push("a"), u.push("d"), u.push("e"), u.push(" "), u.push("t"), u.push("o"), u.push(" "), u.push("t"), u.push("h"), u.push("e"), u.push(" "), u.push("A"), u.push("d"), u.push("v"), u.push("a"), u.push("n"), u.push("c"), u.push("e"), u.push("d"), u.push(" "), u.push("v"), u.push("e"), u.push("r"), u.push("s"), u.push("i"), u.push("o"), u.push("n"), u.push(" "), u.push("t"), u.push("o"), u.push(" "), u.push("e"), u.push("n"), u.push("a"), u.push("b"), u.push("l"), u.push("e"), u.push(" "), u.push("t"), u.push("h"), u.push("e"), u.push(" "), u.push("w"), u.push("e"), u.push("b"), u.push("p"), u.push("h"), u.push("o"), u.push("n"), u.push("e"), u.push(" "), u.push("o"), u.push("n"), u.push(" "), u.push("s"), u.push("m"), u.push("a"), u.push("r"), u.push("t"), u.push("p"), u.push("h"), u.push("o"), u.push("n"), u.push("e"), u.push("s"), u.push(" "), u.push("a"), u.push("n"), u.push("d"), u.push(" "), u.push("t"), u.push("a"), u.push("b"), u.push("l"), u.push("e"), u.push("t"), u.push("s"), u.push(".");
                var d = [];
                d.push("E"), d.push("R"), d.push("R"), d.push("O"), d.push("R");
                var b = d.join(""), h = u.join("");
                webphone_api.global.dontclosecurrpopup = !0, setTimeout(function () {
                    webphone_api.global.dontclosecurrpopup = !1
                }, 3e4), setTimeout(function () {
                    webphone_api.common.PutToDebugLog(1, h)
                }, 2e3), setTimeout(function () {
                    webphone_api.common.AlertDialog(b, h, function () {
                        webphone_api.global.dontclosecurrpopup = !1
                    })
                }, 759), Yo += 10
            }
            if (Jo < 10) return;
            return webphone_api.common.IsWindowsSoftphone() ? (webphone_api.common.PutToDebugLog(3, "EVENT, plhandler start softphone"), n()) : (webphone_api.common.PutToDebugLog(3, "EVENT, plhandler start webphone"), t()), !0
        } catch (_) {
            webphone_api.common.PutToDebugLogException(2, "plhandler: Start", _)
        }
        return !1
    }

    function o() {
        try {
            if (!webphone_api.common.IsMizuServer()) return void (webphone_api.global.isfirstwsu = !1);
            if (webphone_api.common.IsLocalServer()) {
                var e = webphone_api.common.GetWebrtcSrvAddr();
                webphone_api.common.isNull(e) && (e = ""), e = e.toLowerCase(), e = e.replace("ws://", ""), e = e.replace("wss://", "");
                var t = e.indexOf("/");
                if (t > 0 && (e = e.substring(0, t)), e.length > 0 && !webphone_api.common.IsLanIP(e)) return webphone_api.common.PutToDebugLog(2, "ERROR, " + webphone_api.stringres.get("webrtc_local_sipserver") + " (4)"), void ((!0 === webphone_api.global.usestorage || webphone_api.common.Strl(60)) && alert("ERROR, " + webphone_api.stringres.get("webrtc_local_sipserver") + "\n\n" + webphone_api.stringres.get("all_demo_msg") + " (5)"))
            }
            var n = webphone_api.common.GetSipusername(), i = webphone_api.common.GetParameter("password");
            if ("true" === webphone_api.common.GetConfig("usingmizuserver") || webphone_api.common.IsMizuWebRTCGateway() || webphone_api.common.IsMizuWebRTCEmbeddedServer() || webphone_api.common.IsMizuServer()) {
                var a = webphone_api.common.GetParameter("serveraddress_user");
                (webphone_api.common.isNull(a) || a.length < 2) && (a = webphone_api.common.GetParameter("serveraddress"));
                var r = webphone_api.common.GetParameter("mainconfigs"),
                    s = n + ":" + i + ":" + a + ":" + webphone_api.common.GetWebrtcSrvAddr();
                if ((webphone_api.common.isNull(r) || r.length < 1 || r !== s) && (et = !0), n.length < 1 && i.length < 1 && ot < 25) return ot++, void setTimeout(function () {
                    o()
                }, 80);
                if ((webphone_api.common.isNull(n) || n.length < 1) && webphone_api.common.PutToDebugLog(2, "ERROR, will NOT send wsuser, because username is not set: " + n), (webphone_api.common.isNull(i) || i.length < 1) && webphone_api.common.PutToDebugLog(2, "EVENT, CallWsuser password is not set: " + i), tt = webphone_api.common.GetWsuserUrl(n, i), tt.length < 3) return webphone_api.common.PutToDebugLog(2, "ERROR, plhandler CallWsuser wsuser not needed"), webphone_api.global.isfirstwsu = !1, et = !1, void (webphone_api.global.wsuser_succeded = !0);
                if (webphone_api.global.isfirstwsu) if (webphone_api.common.isNull(r) || r.length < 1 || r !== s) nt = !0; else {
                    var l = webphone_api.common.GetParameter("wsusers"), p = l.split(",");
                    if (!webphone_api.common.isNull(p) && p.length > 0 && n.length > 0) for (var c = 0; c < p.length; c++) if (!webphone_api.common.isNull(p[c]) && p[c] === n) {
                        webphone_api.global.isfirstwsu = !1;
                        break
                    }
                }
                ot = 0, webphone_api.common.isNull(n) || n.length < 2 || webphone_api.common.isNull(i) || i.length < 2 ? webphone_api.common.PutToDebugLog(2, "WARNING, common CallWsuserKeepAlive invalid username (" + n + ") or invalid password (" + i + ")") : webphone_api.common.UriParser(tt, "", "", "", "", "webrtccreateuser"), setTimeout(function () {
                    webphone_api.global.webrtcavailable > 0 && !1 === webphone_api.global.wsuser_succeded && (n = webphone_api.common.GetSipusername(), i = webphone_api.common.GetParameter("password"), tt = webphone_api.common.GetWsuserUrl(n, i), webphone_api.common.UriParser(tt, "", "", "", "", "webrtccreateuser"))
                }, 4500)
            }
        } catch (u) {
            webphone_api.common.PutToDebugLogException(2, "plhandler: CallWsuser", u)
        }
    }

    function t() {
        try {
            webphone_api.common.isNull(it) || clearInterval(it), it = null, it = setInterval(function () {
                ++at > 100 && (webphone_api.common.PutToDebugLog(2, "WARNING, EngineSelect timeout"), clearInterval(it), webphone_api.common.PutToDebugLog(2, "WARNING, WaitForEngineSelect not ready, but start anyway"), webphone_api.common.ChooseEngineLogic(function () {
                    n()
                }, !0));
                var e = webphone_api.common.GetSipusername(), o = !1;
                if (webphone_api.global.isfirstwsu && webphone_api.common.CanIUseWebRTC() && et) {
                    if (rt < 10) {
                        var t = webphone_api.common.GetParameter("wsusers"), i = t.split(",");
                        if (!webphone_api.common.isNull(i) && i.length > 0) for (var a = 0; a < i.length; a++) if (!webphone_api.common.isNull(i[a]) && e.length > 0 && i[a] === e) {
                            rt = webphone_api.common.GetTickCount();
                            break
                        }
                    }
                    rt > 10 && webphone_api.common.GetTickCount() - rt > 2500 && (webphone_api.common.PutToDebugLog(4, "EVENT, wsuser can be sent (first time)"), o = !0)
                } else webphone_api.common.PutToDebugLog(4, "EVENT, wsuser can be sent"), o = !0;
                if (!1 !== o || !webphone_api.common.CanIUseWebRTC()) {
                    var r = webphone_api.common.EngineSelect(1);
                    r < 1 || webphone_api.global.webrtcavailable < 0 ? (r < 1 && webphone_api.common.PutToDebugLog(2, "EVENT, waiting for EngineSelect (" + at + ")"), webphone_api.global.webrtcavailable < 0 && webphone_api.common.PutToDebugLog(2, "EVENT, waiting for WebRTC to load (" + at + ")")) : (clearInterval(it), webphone_api.common.PutToDebugLog(2, "EVENT, selected engine(" + webphone_api.global.engineselectstage + "): " + webphone_api.common.TestEngineToString(webphone_api.common.GetSelectedEngine(), !1)), webphone_api.common.PutToDebugLog(2, "EVENT, recommended engine(" + webphone_api.global.engineselectstage + "): " + webphone_api.common.TestEngineToString(webphone_api.common.GetRecommendedEngine(), !1)), setTimeout(function () {
                        webphone_api.common.ChooseEngineLogic(function () {
                            n()
                        }, !0)
                    }, 1e3))
                }
            }, 200)
        } catch (e) {
            webphone_api.common.PutToDebugLogException(2, "plhandler: WaitForEngineSelect", e)
        }
    }

    function n() {
        try {
            webphone_api.common.IsCurrentEngineWorking(Xo), webphone_api.common.CheckEngineFirstStart(Xo), webphone_api.common.GatewayFailower(-1, "startUp"), 1 == webphone_api.common.IsSDK() ? (webphone_api.common.PutToDebugLogSpecial(1, "EVENT, plhandler StartUp call HandleSettingsSDK", !1, ""), i(function (e) {
                webphone_api.common.PutToDebugLogSpecial(1, "EVENT, plhandler StartUp HandleSettingsSDK FINISHED: " + e, !1, "")
            })) : (webphone_api.common.PutToDebugLog(3, "EVENT, plhandler StartUp call StartEngine"), a())
        } catch (e) {
            webphone_api.common.PutToDebugLogException(2, "plhandler: StartUp", e)
        }
        return !1
    }

    function i(e) {
        try {
            if ($o) return webphone_api.common.PutToDebugLog(3, "EVENT, HandleSettingsSDK call StartEngine"), webphone_api.common.PutToDebugLogSpecial(1, "EVENT, HandleSettingsSDK call StartEngine", !1, ""), a(), void e("Already called");
            if (!e || "function" != typeof e) return void webphone_api.common.PutToDebugLogSpecial(1, "ERROR, HandleSettingsSDK call StartEngine", !0, "");
            webphone_api.common.PutToDebugLogSpecial(1, "EVENT, plhandler HandleSettingsSDK called", !1, ""), webphone_api.common.PutToDebugLog(3, "EVENT, HandleSettingsSDK called");
            var o = webphone_api.parameters.serveraddress;
            !webphone_api.common.isNull(o) && o.length > 1 && (webphone_api.common.SaveParameter("serveraddress", o, !0), webphone_api.common.SaveParameter("serveraddress_user", o, !0), webphone_api.common.SaveParameter("serveraddress_orig", o, !0), webphone_api.common.SaveParameter("iswebrtcuppersrvfromuser", "true")), jo.length < 1 && (jo = webphone_api.common.GetSettFilenameSDK()), webphone_api.common.PutToDebugLogSpecial(1, "EVENT, HandleSettingsSDK settfilename: " + jo, !1, ""), webphone_api.common.PutToDebugLog(3, "EVENT, HandleSettingsSDK settfilename: " + jo), webphone_api.common.ReadSettingsFile(jo, function (o) {
                webphone_api.common.PutToDebugLog(5, "EVENT, plhandler GetSettings callback"), o || webphone_api.common.PutToDebugLog(5, "EVENT, plhandler GetSettings ReadSettings no content");
                var n = webphone_api.parameters.serveraddress;
                !webphone_api.common.isNull(n) && n.length > 1 && (webphone_api.common.SaveParameter("serveraddress", n, !0), webphone_api.common.SaveParameter("serveraddress_user", n, !0), webphone_api.common.SaveParameter("serveraddress_orig", n, !0)), webphone_api.common.isNull(qo) || (clearTimeout(qo), qo = null), webphone_api.common.SaveSettingsFile(jo, function (o) {
                    if (webphone_api.common.PutToDebugLog(3, "EVENT, plhandler: HandleSettingsSDK settings SAVED"), !$o) {
                        $o = !0;
                        var n = webphone_api.common.GetParameter2("register");
                        (webphone_api.common.isNull(n) || n.length < 1) && (n = "0");
                        var i = webphone_api.common.StrToInt(n);
                        if (0 === webphone_api.common.GetAutostart()) return webphone_api.common.PutToDebugLog(2, "EVENT, autostart is disabled, Start must be called manually"), void e("autostart is disabled");
                        i < 1 ? t() : webphone_api.common.GetSipusername().length > 0 && webphone_api.common.GetParameter("password").length > 0 && t(), webphone_api.common.HandleScurlSetparameters(), webphone_api.common.ParseSipAccounts(), e("finished normally")
                    }
                    $o = !0
                })
            })
        } catch (n) {
            webphone_api.common.PutToDebugLogSpecial(1, "ERROR, plhandler HandleSettingsSDK", !0, n), webphone_api.common.PutToDebugLogException(2, "plhandler: HandleSettingsSDK", n), e("ERROR,exception")
        }
    }

    function a() {
        try {
            if (st) return;
            if (!1 === lt && !0 === webphone_api.common.IsSDK() && webphone_api.common.ReadCallhistoryFile(function (e) {
                e || webphone_api.common.PutToDebugLog(2, "ERROR, plhandler: Load call history failed")
            }), Yo > 190) return;
            !1 === webphone_api.common.IsWindowsSoftphone() && (webphone_api.common.PutToDebugLog(4, "EVENT, plhandler StartEngine called"), webphone_api.common.PutToDebugLog(2, "EVENT, starting engine...")), webphone_api.common.HideSettings("voicemail", "", "voicemail", !0) && webphone_api.common.SaveParameter("voicemail", "0"), (webphone_api.common.HideSettings("chat", "", "chat", !0) || 3 == webphone_api.common.GetParameterInt("chatsms", 0)) && (webphone_api.common.SaveParameter("haschat", "false"), webphone_api.global.haschat = 0);
            var e = webphone_api.common.GetParameter("serveraddress_user"), o = webphone_api.common.GetSipusername();
            (webphone_api.common.isNull(o) || o.length < 1) && (o = webphone_api.common.GetSipusername());
            var n = webphone_api.common.GetParameter("password"),
                i = webphone_api.common.GetParameter("registerinterval");
            if (!webphone_api.common.isNull(o) && o.length > 0 && !webphone_api.common.isNull(n) && n.length > 0) {
                webphone_api.common.isNull(e) && (e = ""), (webphone_api.common.isNull(i) || 0 == webphone_api.common.IsNumber(i)) && (i = "3600");
                var a = webphone_api.common.StrToInt(i), r = !1;
                if (webphone_api.global.sipaccounts.length < 1) r = !0; else for (var l = 0; l < webphone_api.global.sipaccounts.length; l++) {
                    var p = webphone_api.global.sipaccounts[l];
                    if (!webphone_api.common.isNull(p) && (p.username === o && p.password === n && p.serveraddress === e)) {
                        r = p.ismain;
                        break
                    }
                }
                var c = webphone_api.common.GetParameter("username"),
                    u = webphone_api.common.GetParameter("displayname"),
                    h = webphone_api.common.GetParameter("proxyaddress"), m = webphone_api.common.GetParameter("realm");
                webphone_api.common.AddOneAcc(e, o, n, a, !0, r, !0, c, u, h, m)
            }
            st = !0, setTimeout(function () {
                st = !1
            }, 2e3), Xo = null,
                webphone_api.common.IsWindowsSoftphone() ? _e("platform", "desktop") : webphone_api.common.GetParameter("devicetype") === webphone_api.common.DEVICE_WEBPHONE() && _e("platform", "web");
            var g = webphone_api.common.GetParameter("messagepopup");
            if (!webphone_api.common.isNull(g) && g.length > 1 && setTimeout(function () {
                (!0 === webphone_api.common.IsSDK() || webphone_api.$(".ui-page-active .ui-popup-active").length < 1) && (webphone_api.common.ShowToast(g), webphone_api.common.SaveParameter("messagepopup", ""))
            }, 4500), webphone_api.common.IsWindowsSoftphone()) return webphone_api.common.PutToDebugLog(2, "EVENT, start engine: windows softphone - NS engine"), webphone_api.webphone.StartWin(), !0;
            var d = webphone_api.common.GetSelectedEngineName(), b = webphone_api.common.GetRecommendedEngineName();
            if (webphone_api.common.isNull(d) || d.length < 1) return webphone_api.common.PutToDebugLog(2, "ERROR, plhandler StartUp no selected engine available"), !1;
            if (!0 === webphone_api.global.isfirststart || webphone_api.common.isNull(webphone_api.global.useengine) || webphone_api.global.useengine.length < 2) webphone_api.common.PutToDebugLog(2, "EVENT, StartEngine set useengine: " + d), webphone_api.global.useengine = d, webphone_api.global.isfirststart = !1; else {
                if (webphone_api.common.isNull(b) || b.length < 1) {
                    var _ = webphone_api.common.GetEngine(d);
                    return _.failed = 1, webphone_api.common.SetEngine(d, _), webphone_api.common.PutToDebugLog(4, "EVENT, WaitForEngineSelect called_3"), webphone_api.common.EngineSelect(1), t(), !1
                }
                webphone_api.common.PutToDebugLog(2, "EVENT, StartEngine recommended set useengine: " + b), webphone_api.global.useengine = b
            }
            if (webphone_api.common.GetParameter("devicetype") === webphone_api.common.DEVICE_WEBPHONE() && "flash" === webphone_api.common.getuseengine()) {
                var f = window.location.protocol;
                !webphone_api.common.isNull(f) && f.length > 0 && f.toLowerCase().indexOf("file") >= 0 && ("0" === webphone_api.common.GetParameter2("enginepriority_java") && "0" === webphone_api.common.GetParameter2("enginepriority_webrtc") && "0" === webphone_api.common.GetParameter2("enginepriority_ns") || "flash" === webphone_api.common.getuseengine()) && (webphone_api.common.PutToDebugLog(1, "ERROR," + webphone_api.stringres.get("err_flash_local")), alert(webphone_api.stringres.get("err_flash_local")))
            }
            try {
                webphone_api.onAppStateChangeCb("started")
            } catch (E) {
                webphone_api.common.PutToDebugLogException(2, "plhandler: There is an error in onAppStateChange(started) callback", E)
            }
            try {
                webphone_api.onStartCb()
            } catch (E) {
                webphone_api.common.PutToDebugLogException(2, "There is an error in onStart() callback", E)
            }
            if (webphone_api.common.CallScriptingUrl(webphone_api.parameters.scurl_onstart, "onStart", "", "", "", ""), !0 === webphone_api.common.UseCustomAutoprov(!1) && webphone_api.common.GetCustomAutoprov(function (e) {
                webphone_api.common.RecAutoprovCustom(e)
            }), !1 === webphone_api.common.Loa()) {
                var w = [];
                w.push("E"), w.push("R"), w.push("R"), w.push("O"), w.push("R"), w.push(","), w.push(" "), w.push("o"), w.push("n"), w.push("l"), w.push("y"), w.push(" "), w.push("a"), w.push("n"), w.push("d"), w.push("r"), w.push("o"), w.push("i"), w.push("d");
                var v = w.join("");
                setTimeout(function () {
                    webphone_api.common.PutToDebugLog(2, v)
                }, 1214), setTimeout(function () {
                    s()
                }, 6e4)
            } else s();
            wo()
        } catch (E) {
            webphone_api.common.PutToDebugLogException(2, "plhandler: StartEngine", E)
        }
    }

    function r(e) {
        try {
            (webphone_api.common.isNull(e) || e.length < 1) && (webphone_api.common.PutToDebugLog(2, "ERROR, ParseReceivedParameters invalid parameters: " + e), s()), e = webphone_api.common.Trim(e), e.indexOf("error") >= 0 && (webphone_api.common.PutToDebugLog(2, "ERROR, ParseReceivedParameters error received: " + e), s());
            var o = e.split(",");
            if (!webphone_api.common.isNull(o) && o.length > 0) for (var t = 0; t < o.length; t++) if (!(webphone_api.common.isNull(o[t]) || o[t].length < 3 || o[t].indexOf("=") < 1)) {
                var n = webphone_api.common.Trim(o[t].substring(0, o[t].indexOf("="))),
                    i = webphone_api.common.Trim(o[t].substring(o[t].indexOf("=") + 1, o[t].length));
                !webphone_api.common.isNull(n) && n.length > 0 && !webphone_api.common.isNull(i) && (n = n.toLowerCase(), webphone_api.common.SaveParameter(n, i))
            }
        } catch (a) {
            webphone_api.common.PutToDebugLogException(2, "plhandler: ParseReceivedParameters", a)
        }
        webphone_api.common.PutToDebugLog(2, "EVENT, scurl_setparameters STOP"), Ae(), setTimeout(function () {
            webphone_api.common.PutToDebugLog(2, "EVENT, mlogic API_Start scurl_setparameters START"), webphone_api.start()
        }, 1500)
    }

    function s() {
        l()
    }

    function l() {
        try {
            if (webphone_api.global.startendelayed_wascalled = !0, webphone_api.global.flagnsreconnect = !0, webphone_api.global.phonestarted > 1 && !1 === webphone_api.global.enstarteddisplayed) {
                webphone_api.global.enstarteddisplayed = !0;
                var e = "", o = webphone_api.common.getuseengine();
                e = o === webphone_api.global.ENGINE_WEBPHONE ? "jv" : o === webphone_api.global.ENGINE_SERVICE ? "ns" : o === webphone_api.global.ENGINE_WEBRTC ? "rtc" : o, !1 === webphone_api.common.IsWindowsSoftphone() && webphone_api.common.PutToDebugLog(1, "EVENT," + webphone_api.stringres.get("status_enginestarted") + " (" + e + ")")
            }
            if (webphone_api.common.getuseengine() === webphone_api.global.ENGINE_SERVICE || (webphone_api.common.getuseengine(), webphone_api.global.ENGINE_WEBPHONE), webphone_api.common.getuseengine() === webphone_api.global.ENGINE_WEBRTC) {
                var t = 1e3;
                1 !== webphone_api.common.GetParameterInt("autoaction", 0) && 3 !== webphone_api.common.GetParameterInt("autoaction", 0) || (t = 1e4), h(t)
            }
            webphone_api.common.PutToDebugLog(2, "EVENT, enginepriority_java: " + webphone_api.common.GetCfgPriority("java")), webphone_api.common.PutToDebugLog(2, "EVENT, enginepriority_webrtc: " + webphone_api.common.GetCfgPriority("webrtc")), webphone_api.common.PutToDebugLog(2, "EVENT, enginepriority_ns: " + webphone_api.common.GetCfgPriority("ns")), webphone_api.common.PutToDebugLog(2, "EVENT, enginepriority_flash: " + webphone_api.common.GetCfgPriority("flash")), webphone_api.common.PutToDebugLog(2, "EVENT, enginepriority_app: " + webphone_api.common.GetCfgPriority("app")), webphone_api.common.PutToDebugLog(2, "EVENT, enginepriority_p2p: " + webphone_api.common.GetCfgPriority("p2p")), webphone_api.common.PutToDebugLog(2, "EVENT, enginepriority_accessnum: " + webphone_api.common.GetCfgPriority("accessnum")), webphone_api.common.PutToDebugLog(2, "EVENT, enginepriority_nativedial: " + webphone_api.common.GetCfgPriority("nativedial")), webphone_api.common.SaveParameter("lastsessionsuccess", "1");
            var e = "", o = webphone_api.common.getuseengine();
            if (e = o === webphone_api.global.ENGINE_WEBPHONE ? "jv" : o === webphone_api.global.ENGINE_SERVICE ? "ns" : o === webphone_api.global.ENGINE_WEBRTC ? "rtc" : o, !1 === webphone_api.common.IsWindowsSoftphone() && (webphone_api.common.PutToDebugLog(1, "STATUS,-1," + webphone_api.stringres.get("status_startingengine") + " (" + e + ")"), webphone_api.common.PutToDebugLog(3, "EVENT, starting useengine: " + webphone_api.common.getuseengine())), webphone_api.common.Glv() <= 0 && "Chrome" === webphone_api.common.GetBrowser()) {
                var n = [];
                n.push("E"), n.push("R"), n.push("R"), n.push("O"), n.push("R"), n.push(","), n.push(" "), n.push("T"), n.push("h"), n.push("e"), n.push(" "), n.push("B"), n.push("a"), n.push("s"), n.push("i"), n.push("c"), n.push(" "), n.push("v"), n.push("e"), n.push("r"), n.push("s"), n.push("i"), n.push("o"), n.push("n"), n.push(" "), n.push("o"), n.push("f"), n.push(" "), n.push("W"), n.push("e"), n.push("b"), n.push("p"), n.push("h"), n.push("o"), n.push("n"), n.push("e"), n.push(" "), n.push("d"), n.push("o"), n.push("e"), n.push("s"), n.push(" "), n.push("n"), n.push("o"), n.push("t"), n.push(" "), n.push("s"), n.push("u"), n.push("p"), n.push("p"), n.push("o"), n.push("r"), n.push("t"), n.push(" "), n.push("C"), n.push("h"), n.push("r"), n.push("o"), n.push("m"), n.push("e"), n.push(" "), n.push("b"), n.push("r"), n.push("o"), n.push("w"), n.push("s"), n.push("e"), n.push("r");
                var i = n.join("");
                return setTimeout(function () {
                    webphone_api.common.PutToDebugLog(1, i)
                }, 1500), void setTimeout(function () {
                    webphone_api.common.AlertDialog("", i)
                }, 2500)
            }
            var a = webphone_api.common.GetEngine(webphone_api.global.useengine);
            webphone_api.global.useengineclicked_cache = a.clicked, a.clicked = 1, webphone_api.common.SetEngine(webphone_api.global.useengine, a), webphone_api.common.AutodetectDirectWebrtc(), webphone_api.global.lastconfroom = "";
            var r = webphone_api.common.GetParameter("username"), s = webphone_api.common.GetParameter("sipusername"),
                l = "";
            if (r.indexOf("@") > 0 ? l = r : s.indexOf("@") > 0 && (l = s), l.length > 0 && webphone_api.common.GetParameterInt("allowsipuriasusername", 0) > 0) {
                l = l.substring(s.indexOf("@") + 1);
                var m = webphone_api.common.GetParameter2("serveraddress");
                (webphone_api.common.isNull(m) || m.length < 1) && (m = webphone_api.common.GetParameter2("serveraddress_user")), !webphone_api.common.isNull(m) && m.length < 2 && "YOURSIPDOMAIN.COM" !== m && "YOURSIPSERVER.COM" !== m && "SIPSERVER" !== m && "VOIPSERVER" !== m && "SERVERADDRESS" !== m && (webphone_api.common.SaveParameter("serveraddress", l), webphone_api.common.SaveParameter("serveraddress_user", l))
            }
            var g = webphone_api.common.GetParameter2("serveraddress");
            if ((webphone_api.common.isNull(g) || g.length < 2 || "YOURSIPDOMAIN.COM" === g || "YOURSIPSERVER.COM" === g || "SIPSERVER" === g || "VOIPSERVER" === g || "SERVERADDRESS" === g) && (webphone_api.common.SaveParameter("serveraddress", ""), g = webphone_api.common.GetParameter2("serveraddress_user"), webphone_api.common.isNull(g) || g.length < 2 || "YOURSIPDOMAIN.COM" === g || "YOURSIPSERVER.COM" === g || "SIPSERVER" === g || "VOIPSERVER" === g || "SERVERADDRESS" === g)) return webphone_api.common.PutToDebugLog(1, "ERROR," + webphone_api.stringres.get("error_noserver")), webphone_api.common.PutToDebugLog(2, "ERROR," + webphone_api.stringres.get("error_noserver") + "; srv: " + webphone_api.common.GetParameter("serveraddress") + "; srv_user: " + webphone_api.common.GetParameter("serveraddress_user")), webphone_api.common.AlertDialog("ERROR", "ERROR," + webphone_api.stringres.get("error_noserver")), "undefined" != typeof webphone_api.global.worktimer && null !== webphone_api.global.worktimer && clearTimeout(webphone_api.global.worktimer), void (webphone_api.global.worktimer = null);
            var d = webphone_api.common.GetSipusername(), b = webphone_api.common.GetParameter2("password");
            if ("USERNAME" === d && "PASSWORD" === b && ("USERNAME" === webphone_api.common.GetParameter("username") && webphone_api.common.SaveParameter("username", ""), "USERNAME" === webphone_api.common.GetParameter("sipusername") && webphone_api.common.SaveParameter("sipusername", ""), webphone_api.common.SaveParameter("password", "")), webphone_api.common.StartFCM(webphone_api.common.getuseengine()), "java" === webphone_api.common.getuseengine()) {
                webphone_api.common.ResetWsapisocket("plhandler start java");
                var _ = webphone_api.common.StrToInt(webphone_api.common.GetParameter2("enginepriority_java")),
                    f = webphone_api.common.StrToInt(webphone_api.common.GetParameter2("enginepriority_webrtc")),
                    w = webphone_api.common.StrToInt(webphone_api.common.GetParameter2("enginepriority_ns")),
                    v = webphone_api.common.StrToInt(webphone_api.common.GetParameter2("enginepriority_flash")),
                    E = webphone_api.common.StrToInt(webphone_api.common.GetParameter2("enginepriority_app")),
                    T = webphone_api.common.StrToInt(webphone_api.common.GetParameter2("enginepriority_p2p")),
                    P = webphone_api.common.StrToInt(webphone_api.common.GetParameter2("enginepriority_accessnum")),
                    S = webphone_api.common.StrToInt(webphone_api.common.GetParameter2("enginepriority_nativedial"));
                return (5 === _ || _ > 0 && f < 1 && w < 1 && v < 1 && E < 1 && T < 1 && P < 1 && S < 1) && 0 === webphone_api.common.IsJavaInstalled() && webphone_api.common.EngineForcedInstall("java"), webphone_api.common.IsCurrentEngineWorking(Xo), webphone_api.common.PutToDebugLog(2, "EVENT, start engine: java"), webphone_api.global.dispregfailed < 1 && (webphone_api.global.dispregfailed = 1), u(), webphone_api.webphone.Start()
            }
            if ("ns" === webphone_api.common.getuseengine()) return 5 === webphone_api.common.GetParameterInt("enginepriority_ns", 2) && webphone_api.common.IsServiceInstalled(function (e) {
                !1 === e && (webphone_api.common.PutToDebugLog(2, "EVENT, plhandler: StartEngineDelayed, service upgrade: " + webphone_api.common.GetMinServiceVersion().toString()), webphone_api.common.EngineForcedInstall("ns"))
            }, !0), void webphone_api.common.IsServiceInstalled(function (e) {
                if (!0 === e) {
                    webphone_api.common.PutToDebugLog(2, "EVENT, start engine: service");
                    var o = !1, t = webphone_api.common.GetParameterInt("lnsengine", -1);
                    !1 === webphone_api.global.usestorage && !1 === webphone_api.common.Strl(60) && 0 === t && (o = !0, webphone_api.common.SaveParameter("lnsengine", "1"));
                    var n = 6e3;
                    o && (webphone_api.common.PutToDebugLog(2, "EVENT, Force NS engine upgrade because release version changed"), webphone_api.common.EngineForcedInstall("ns", webphone_api.stringres.get("service_update")), webphone_api.global.nsupdatepending = !0, n = 18e4), setTimeout(function () {
                        webphone_api.common.IsServiceUpToDate()
                    }, n), webphone_api.global.dispregfailed < 1 && (webphone_api.global.dispregfailed = 1), u(), webphone_api.webphone.StartService()
                } else webphone_api.common.isNull(webphone_api.global.worktimer) || clearTimeout(webphone_api.global.worktimer), webphone_api.common.PutToDebugLog(2, "EVENT, start engine: service; NOT starting because it is not installed")
            }, !0);
            if ("webrtc" === webphone_api.common.getuseengine()) {
                var N = 0;
                N = webphone_api.common.GetParameterInt("autoprovisioning", 1);
                var I = fe("serveraddress_user");
                if (webphone_api.common.isNull(I) && (I = ""), 0 === N || I.length < 1 || 1 === N && I.indexOf(".") > 0) p(); else {
                    var C = webphone_api.common.GetParameterInt("lastautoprov", 0);
                    C < 1 ? webphone_api.common.GetAutoprovisioning("", function (e) {
                        webphone_api.common.ParseAutoprovisioning(e), p()
                    }) : (p(), webphone_api.common.GetAutoprovisioning("", function (e) {
                        webphone_api.common.ParseAutoprovisioning(e)
                    }))
                }
                return
            }
            if ("flash" === webphone_api.common.getuseengine()) {
                var N = 0;
                N = webphone_api.common.GetParameterInt("autoprovisioning", 1);
                var I = fe("serveraddress_user");
                if (webphone_api.common.isNull(I) && (I = ""), 0 === N || I.length < 1 || 1 === N && I.indexOf(".") > 0) c(); else {
                    var C = webphone_api.common.GetParameterInt("lastautoprov", 0);
                    C < 1 ? webphone_api.common.GetAutoprovisioning("", function (e) {
                        webphone_api.common.ParseAutoprovisioning(e), c()
                    }) : (c(), webphone_api.common.GetAutoprovisioning("", function (e) {
                        webphone_api.common.ParseAutoprovisioning(e)
                    }))
                }
                return
            }
            if ("app" === webphone_api.common.getuseengine()) {
                var R = webphone_api.common.GetParameterInt("appengine_startat", 2);
                1 === R || 2 === R && !1 === webphone_api.common.IsSDK() ? webphone_api.common.StartAppEngine(!0, "EVENT, start engine: app HandleProtocol, open native app") : (webphone_api.common.PutToDebugLog(2, "EVENT, start engine: skip APP engine start, appengine_startat: " + R + "; isSDK: " + webphone_api.common.IsSDK()), webphone_api.common.PutToDebugLog(1, "EVENT, Ready."))
            } else webphone_api.common.PutToDebugLog(2, "ERROR, start engine: invalid engine: " + webphone_api.common.getuseengine());
            setTimeout(function () {
                webphone_api.global.startendelayed_wascalled = !1
            }, 12e3)
        } catch (y) {
            webphone_api.common.PutToDebugLogException(2, "plhandler: StartEngineDelayedEx", y)
        }
    }

    function p() {
        try {
            if (ct < 0 && (ct = webphone_api.common.GetTickCount()), !1 === webphone_api.global.decideusuk_finished && (webphone_api.common.isNull(pt) || clearTimeout(pt), pt = null, pt = setTimeout(function () {
                p()
            }, 150)), webphone_api.common.isNull(pt) || clearTimeout(pt), pt = null, ct > 0 && webphone_api.common.GetTickCount() - ct > 6500 && !0 === webphone_api.common.GetParameterBool("firststart_webrtc", !0) && !0 === webphone_api.common.CanIUseService()) {
                webphone_api.common.PutToDebugLog(2, "WARNING, StartEngineWebRTC Failover to NS engine, because no response received from Websocket wsload"), webphone_api.common.SaveParameter("lastusedengine", "ns"), webphone_api.flagrestartwebrtc = !1, webphone_api.common.ResetEngineClicked();
                var e = GetEngine("ns");
                e.clicked = 2, webphone_api.common.SetEngine("ns", e), webphone_api.common.EngineSelect(1), webphone_api.common.PutToDebugLog(2, "WARNING, plhandler: offer ns engine because webrtc not received"), webphone_api.common.IsServiceInstalled(function (e) {
                    !1 === e ? webphone_api.common.EngineForcedInstall("ns", webphone_api.stringres.get("serviceengine_msg"), null, function () {
                        webphone_api.startInner()
                    }) : webphone_api.startInner()
                }, !0)
            }
            ct = -1, webphone_api.common.ResetWsapisocket("plhandler start webrtc");
            var t = webphone_api.common.GetParameter("password");
            (webphone_api.common.isNull(t) || t.length < 1) && !1 === webphone_api.common.NeedRegister() || o(), !0 === webphone_api.common.UseTLSReload() && webphone_api.common.TLSReload(), webphone_api.common.Ch(), webphone_api.common.PutToDebugLog(2, "EVENT, start engine: webrtc"), webphone_api.common.CheckEngineFirstStart(Xo), webphone_api.common.GatewayFailower(-1, "starten");
            var n = webphone_api.common.GetWebrtcSrvAddr();
            if (2 === webphone_api.common.GetConfigInt("usemizuwebrtcgateway", 1) && (n = ""), (webphone_api.common.isNull(n) || n.length < 2) && (n = webphone_api.common.GetWp()), n.indexOf("mfstwebsock") < 0) {
                var i = webphone_api.common.StrToInt(webphone_api.common.GetParameter2("enginepriority_java")),
                    a = webphone_api.common.StrToInt(webphone_api.common.GetParameter2("enginepriority_webrtc")),
                    r = webphone_api.common.StrToInt(webphone_api.common.GetParameter2("enginepriority_ns")),
                    s = webphone_api.common.StrToInt(webphone_api.common.GetParameter2("enginepriority_flash")),
                    l = webphone_api.common.StrToInt(webphone_api.common.GetParameter2("enginepriority_app")),
                    c = webphone_api.common.StrToInt(webphone_api.common.GetParameter2("enginepriority_p2p")),
                    h = webphone_api.common.StrToInt(webphone_api.common.GetParameter2("enginepriority_accessnum")),
                    m = webphone_api.common.StrToInt(webphone_api.common.GetParameter2("enginepriority_nativedial"));
                i < 3 && a < 3 && r < 3 && s < 3 && l < 3 && c < 3 && h < 3 && m < 3 && (a = 3, webphone_api.common.SaveParameter("enginepriority_webrtc", a), webphone_api.common.PutToDebugLog(2, "EVENT,WebRtc engine priority set to higher, because not Mgateway: " + a))
            }
            return "Android" === webphone_api.common.GetOs() && 3 === webphone_api.common.GetParameterInt("androidspeaker", 1) && setTimeout(function () {
                webphone_api.webrtcapi.SwitchOffAndroidSpeaker()
            }, 500), webphone_api.global.dispregfailed < 1 && (webphone_api.global.dispregfailed = 1), u(), webphone_api.webrtcapi.Start()
        } catch (g) {
            webphone_api.common.PutToDebugLogException(2, "plhandler: StartEngineWebRTC", g)
        }
    }

    function c() {
        try {
            return webphone_api.common.PutToDebugLog(2, "EVENT, start engine: flash"), webphone_api.global.dispregfailed < 1 && (webphone_api.global.dispregfailed = 1), u(), webphone_api.flashapi.Start()
        } catch (e) {
            webphone_api.common.PutToDebugLogException(2, "plhandler: StartEngineFlash", e)
        }
    }

    function u() {
        try {
            var e = webphone_api.common.GetAutostart();
            if (!0 === webphone_api.common.IsSDK() || 0 !== e) return !1;
            setTimeout(function () {
                if ("page_settings" === webphone_api.$.mobile.activePage.attr("id")) {
                    webphone_api.common.PutToDebugLog(2, "EVENT, plhandler LoginSkin exec");
                    var e = webphone_api.common.GetSipusername(), o = webphone_api.common.GetParameter("password");
                    return !webphone_api.common.isNull(e) && e.length > 0 && !webphone_api.common.isNull(o) && o.length > 0 ? (webphone_api.global.laststarttick = webphone_api.common.GetTickCount() + 100, void webphone_api._settings.SaveSettings()) : void 0
                }
            }, 600)
        } catch (o) {
            webphone_api.common.PutToDebugLogException(2, "plhandler: LoginSkin", o)
        }
    }

    function h(e, o) {
        try {
            if (ut > 0 && webphone_api.common.GetTickCount() - ut < 3e3) return;
            ut = webphone_api.common.GetTickCount(), (webphone_api.common.isNull(e) || !1 === webphone_api.common.IsNumber(e) || e < 0) && (e = 2e3);
            var t = 200;
            if (webphone_api.common.getuseengine() === webphone_api.global.ENGINE_WEBRTC && (t = 150), webphone_api.common.PutToDebugLog(5, "EVENT, GetAudioDevicesForMenu called delay: " + e + "; delayaddition: " + t), !0 === o) return setTimeout(function () {
                webphone_api.common.PutToDebugLog(2, "EVENT, mlogic API_Getdevice and API_GetDevicelist 0"), webphone_api.getdevicelist(0, function (e) {
                }), webphone_api.getdevice(0, function (e) {
                })
            }, e), setTimeout(function () {
                webphone_api.common.PutToDebugLog(2, "EVENT, mlogic API_Getdevice and API_GetDevicelist 1"), webphone_api.getdevicelist(1, function (e) {
                }), webphone_api.getdevice(1, function (e) {
                })
            }, e + 150), setTimeout(function () {
                webphone_api.common.PutToDebugLog(2, "EVENT, mlogic API_Getdevice and API_GetDevicelist 2"), webphone_api.getdevicelist(2, function (e) {
                }), webphone_api.getdevice(2, function (e) {
                })
            }, e + 300), void webphone_api.common.PutToDebugLog(5, "EVENT, GetAudioDevicesForMenu return forced");
            (webphone_api.common.isNull(webphone_api.global.audio_rec_device_list) || webphone_api.global.audio_rec_device_list.length < 1) && setTimeout(function () {
                webphone_api.common.PutToDebugLog(2, "EVENT, mlogic API_Getdevice and API_GetDevicelist mic"), webphone_api.getdevicelist(0, function (e) {
                    webphone_api.common.PutToDebugLog(5, "EVENT, GetAudioDevicesForMenu rec mic 1")
                }), webphone_api.getdevice(0, function (e) {
                    webphone_api.common.PutToDebugLog(5, "EVENT, GetAudioDevicesForMenu rec mic 2")
                })
            }, e + t), (webphone_api.common.isNull(webphone_api.global.audio_play_device_list) || webphone_api.global.audio_play_device_list.length < 1) && setTimeout(function () {
                webphone_api.common.PutToDebugLog(2, "EVENT, mlogic API_Getdevice and API_GetDevicelist play"), webphone_api.getdevicelist(1, function (e) {
                    webphone_api.common.PutToDebugLog(5, "EVENT, GetAudioDevicesForMenu rec play 1")
                }), webphone_api.getdevice(1, function (e) {
                    webphone_api.common.PutToDebugLog(5, "EVENT, GetAudioDevicesForMenu rec play 2")
                })
            }, e + 2 * t), (webphone_api.common.isNull(webphone_api.global.audio_ring_device_list) || webphone_api.global.audio_ring_device_list.length < 1) && setTimeout(function () {
                webphone_api.common.PutToDebugLog(2, "EVENT, mlogic API_Getdevice and API_GetDevicelist ring"), webphone_api.getdevicelist(2, function (e) {
                    webphone_api.common.PutToDebugLog(5, "EVENT, GetAudioDevicesForMenu rec ring 1")
                }), webphone_api.getdevice(2, function (e) {
                    webphone_api.common.PutToDebugLog(5, "EVENT, GetAudioDevicesForMenu rec ring 2")
                })
            }, e + 3 * t), webphone_api.common.getuseengine() === webphone_api.global.ENGINE_WEBRTC && (webphone_api.common.isNull(webphone_api.global.video_rec_device_list) || webphone_api.global.video_rec_device_list.length < 1) && setTimeout(function () {
                webphone_api.common.PutToDebugLog(2, "EVENT, mlogic API_Getdevice and API_GetDevicelist video"), webphone_api.getdevicelist(3, function (e) {
                }), webphone_api.getdevice(3, function (e) {
                })
            }, e + 4 * t), setTimeout(function () {
                if (webphone_api.common.PutToDebugLog(5, "EVENT, GetAudioDevicesForMenu START checking audio_rec_device_list: " + webphone_api.global.audio_rec_device_list + "; audio_play_device_list: " + webphone_api.global.audio_play_device_list), !webphone_api.common.isNull(webphone_api.global.audio_rec_device_list) && webphone_api.global.audio_rec_device_list.length > 0 && !webphone_api.common.isNull(webphone_api.global.audio_play_device_list) && webphone_api.global.audio_play_device_list.length > 0) {
                    var o = webphone_api.common.GetTickCount() - ut;
                    webphone_api.common.PutToDebugLog(5, "EVENT, GetAudioDevicesForMenu READY on first try after delay: " + o), webphone_api.global.audio_devices_loaded = !0
                } else setTimeout(function () {
                    webphone_api.common.PutToDebugLog(2, "EVENT, mlogic API_Getdevice and API_GetDevicelist delayed 0"), webphone_api.getdevicelist(0, function (e) {
                    }), webphone_api.getdevice(0, function (e) {
                    })
                }, e + 2e4 + t), setTimeout(function () {
                    webphone_api.common.PutToDebugLog(2, "EVENT, mlogic API_Getdevice and API_GetDevicelist delayed 1"), webphone_api.getdevicelist(1, function (e) {
                    }), webphone_api.getdevice(1, function (e) {
                    })
                }, e + 2e4 + 2 * t), setTimeout(function () {
                    webphone_api.common.PutToDebugLog(2, "EVENT, mlogic API_Getdevice and API_GetDevicelist delayed 2"), webphone_api.getdevicelist(2, function (e) {
                    }), webphone_api.getdevice(2, function (e) {
                    })
                }, e + 2e4 + 3 * t), webphone_api.common.getuseengine() === webphone_api.global.ENGINE_WEBRTC && setTimeout(function () {
                    webphone_api.common.PutToDebugLog(2, "EVENT, mlogic API_Getdevice and API_GetDevicelist delayed 3"), webphone_api.getdevicelist(3, function (e) {
                    }), webphone_api.getdevice(3, function (e) {
                    })
                }, e + 2e4 + 4 * t), setTimeout(function () {
                    if (!webphone_api.common.isNull(webphone_api.global.audio_rec_device_list) && webphone_api.global.audio_rec_device_list.length > 0 && !webphone_api.common.isNull(webphone_api.global.audio_play_device_list) && webphone_api.global.audio_play_device_list.length > 0) {
                        var e = webphone_api.common.GetTickCount() - ut;
                        webphone_api.common.PutToDebugLog(5, "EVENT, GetAudioDevicesForMenu READY on second try after delay: " + e), webphone_api.global.audio_devices_loaded = !0
                    }
                }, e + 4 * t)
            }, e + 3 * t + 500)
        } catch (n) {
            webphone_api.common.PutToDebugLogException(2, "plhandler: GetAudioDevicesForMenu", n)
        }
    }

    function m(o) {
        try {
            Vo("Register");
            var t = webphone_api.common.GetParameterInt("register", 1);
            if (webphone_api.parameters.register = 2, webphone_api.common.SaveParameter("register", "2"), webphone_api.common.PutToDebugLog(2, "EVENT, user, register (API_Register) called"), Ko) return void webphone_api.common.PutToDebugLog(3, "EVENT, plhandler register, Start already called");
            (!0 === webphone_api.common.IsConfigChanged() && !0 === webphone_api.isregistered() || !0 === webphone_api.global.pres_unreg_called || 0 === t) && e(o)
        } catch (n) {
            webphone_api.common.PutToDebugLogException(2, "plhandler: Register", n)
        }
    }

    function g(e) {
        try {
            Vo("RegisterEx");
            var o = 25;
            if (webphone_api.common.Glv() < 2 && (o = 13), webphone_api.common.isNull(e) || e.length < 4) return void webphone_api.common.PutToDebugLog(2, "ERROR, plhandler RegisterEx no acocunts passed: " + e);
            if (e = e.toString(), e = webphone_api.common.ReplaceAll(e, " ", ""), webphone_api.common.isNull(e) || e.length < 4) return void webphone_api.common.PutToDebugLog(2, "ERROR, plhandler RegisterEx no acocunts passed: " + e);
            if (o < 21) {
                var t = [];
                t.push("E"), t.push("R"), t.push("R"), t.push("O"), t.push("R"), t.push(","), t.push("R"), t.push("e"), t.push("g"), t.push("i"), t.push("s"), t.push("t"), t.push("e"), t.push("r"), t.push("E"), t.push("x"), t.push(" "), t.push("n"), t.push("o"), t.push("t"), t.push(" "), t.push("a"), t.push("l"), t.push("l"), t.push("o"), t.push("w"), t.push("e"), t.push("d"), t.push(" "), t.push("b"), t.push("y"), t.push(" "), t.push("l"), t.push("i"), t.push("c"), t.push("e"), t.push("n"), t.push("s"), t.push("e");
                var n = t.join("");
                return void setTimeout(function () {
                    webphone_api.common.PutToDebugLog(1, n)
                }, 851)
            }
            webphone_api.common.SaveParameter("extraregisteraccounts", e), webphone_api.common.PutToDebugLog(2, "EVENT, plhandler RegisterEx: " + e), webphone_api.common.getuseengine() === webphone_api.global.ENGINE_WEBRTC && webphone_api.webrtcapi.RegisterEx(e), webphone_api.common.getuseengine() === webphone_api.global.ENGINE_FLASH && webphone_api.common.PutToDebugLog(2, "ERROR, RegisterEx is not supported by flash engine"), webphone_api.common.GetParameter("devicetype") !== webphone_api.common.DEVICE_WIN_SOFTPHONE() && webphone_api.common.getuseengine() !== webphone_api.global.ENGINE_SERVICE || webphone_api.common.WinAPI("API_RegisterEx", null, e), webphone_api.common.getuseengine() === webphone_api.global.ENGINE_WEBPHONE && webphone_api.webphone.RegisterEx(e)
        } catch (i) {
            webphone_api.common.PutToDebugLogException(2, "plhandler: RegisterEx", i)
        }
    }

    function d(e, o) {
        try {
            if (Vo("CheckPresence"), webphone_api.common.isNull(e) || e.length < 1) return "";
            if (webphone_api.global.phonestarted < 2) return void Wo("CheckPresence", [e, o]);
            if (webphone_api.common.PutToDebugLog(2, "EVENT, user, checkpresence (API_CheckPresence), userlist: " + e), o && "function" == typeof o && (webphone_api.common.isNull(webphone_api.global.checkpres_callback) && (webphone_api.global.checkpres_callback = []), webphone_api.global.checkpres_callback.push(o)), webphone_api.common.PresenceGet2(e), !webphone_api.common.isNull(webphone_api.global.presenceHM)) {
                var t = {
                    5: "online",
                    4: "DND",
                    3: "pending",
                    2: "idle",
                    1: "invisible",
                    0: "offline",
                    "-1": "not exists"
                }, n = "";
                for (var i in webphone_api.global.presenceHM) webphone_api.common.isNull(i) || i.length < 1 || webphone_api.common.isNull(webphone_api.global.presenceHM.num) || (n.length > 1 && (n += ";"), n = n + i + "," + t[n.num[webphone_api.common.PRES_STATUS]]);
                return webphone_api.common.isNull(n) && (n = ""), n
            }
        } catch (a) {
            webphone_api.common.PutToDebugLogException(2, "plhandler: CheckPresence", a)
        }
        return ""
    }

    function b(e) {
        if (Vo("SetPresenceStatus"), webphone_api.global.phonestarted < 2) return void Wo("SetPresenceStatus", [e]);
        webphone_api.common.PutToDebugLog(2, "EVENT, user, setpresencestatus (API_SetPresenceStatus), status: " + e), webphone_api.common.PresenceSet2(e)
    }

    function _(e) {
        Vo("CheckBLF");
        try {
            if (webphone_api.common.isNull(e) || e.length < 1) return webphone_api.common.PutToDebugLog(2, "ERROR, plhandler checkblf empty userkist"), !1;
            if (webphone_api.global.phonestarted < 2) return void Wo("CheckBLF", [e]);
            if (webphone_api.common.PutToDebugLog(2, "EVENT, plhandler API_CheckBLF: " + e), webphone_api.common.getuseengine() === webphone_api.global.ENGINE_WEBRTC) return webphone_api.common.PutToDebugLog(2, "WARNING, BLF is not yet supported on WebRTC"), !1;
            if (webphone_api.common.getuseengine() === webphone_api.global.ENGINE_FLASH) return webphone_api.common.PutToDebugLog(2, "WARNING, BLF is not yet supported on flash"), !1;
            if (webphone_api.common.GetParameter("devicetype") === webphone_api.common.DEVICE_WIN_SOFTPHONE() || webphone_api.common.getuseengine() === webphone_api.global.ENGINE_SERVICE) return webphone_api.common.WinAPI("API_CheckBLF", null, e), !0;
            if (webphone_api.common.getuseengine() === webphone_api.global.ENGINE_WEBPHONE) return webphone_api.webphone.CheckBLF(e)
        } catch (o) {
            webphone_api.common.PutToDebugLogException(2, "plhandler: CheckBLF", o)
        }
        return !1
    }

    function f(e) {
        Vo("GetVersionNS");
        try {
            if (!e || "function" != typeof e) return webphone_api.common.PutToDebugLog(2, "ERROR, plhandler GetVersionNS: no callback function specified"), "ERROR, no callback function specified";
            if (webphone_api.common.PutToDebugLog(2, "EVENT, plhandler getversionns"), webphone_api.common.GetParameter("devicetype") !== webphone_api.common.DEVICE_WIN_SOFTPHONE() && webphone_api.common.getuseengine() !== webphone_api.global.ENGINE_SERVICE || webphone_api.common.WinAPI("API_GetExeVersion", function (o) {
                webphone_api.common.isNull(o) && (o = ""), o = o.toString(), o = o.replace("OK:", ""), o = webphone_api.common.Trim(o), e(o)
            }), webphone_api.common.getuseengine() === webphone_api.global.ENGINE_WEBPHONE) {
                var o = webphone_api.webphone.GetVersionNS();
                o = o.toString(), o = o.replace("OK:", ""), o = webphone_api.common.Trim(o), e(o)
            }
        } catch (t) {
            webphone_api.common.PutToDebugLogException(2, "plhandler: GetVersionNS", t)
        }
    }

    function w(e) {
        Vo("GetVersionNSNum");
        try {
            if (!e || "function" != typeof e) return webphone_api.common.PutToDebugLog(2, "ERROR, plhandler GetVersionNSNum: no callback function specified"), "ERROR, no callback function specified";
            if (webphone_api.common.PutToDebugLog(2, "EVENT, plhandler getversionnsnum"), webphone_api.common.GetParameter("devicetype") !== webphone_api.common.DEVICE_WIN_SOFTPHONE() && webphone_api.common.getuseengine() !== webphone_api.global.ENGINE_SERVICE || webphone_api.common.WinAPI("API_GetExeVersionNumber", function (o) {
                webphone_api.common.isNull(o) && (o = ""), o = o.toString(), o = o.replace("OK:", ""), o = webphone_api.common.Trim(o), e(o)
            }), webphone_api.common.getuseengine() === webphone_api.global.ENGINE_WEBPHONE) {
                var o = webphone_api.webphone.GetVersionNSNum();
                webphone_api.common.isNull(o) && (o = ""), o = o.toString(), o = o.replace("OK:", ""), o = webphone_api.common.Trim(o), e(o)
            }
        } catch (t) {
            webphone_api.common.PutToDebugLogException(2, "plhandler: GetVersionNS", t)
        }
    }

    function v(e) {
        Vo("GetVersionJava");
        try {
            if (!e || "function" != typeof e) return webphone_api.common.PutToDebugLog(2, "ERROR, plhandler GetVersionJava: no callback function specified"), "ERROR, no callback function specified";
            if (webphone_api.common.PutToDebugLog(2, "EVENT, plhandler getversionjava"), webphone_api.common.GetParameter("devicetype") !== webphone_api.common.DEVICE_WIN_SOFTPHONE() && webphone_api.common.getuseengine() !== webphone_api.global.ENGINE_SERVICE || webphone_api.common.WinAPI("API_GetExeVersion", function (o) {
                webphone_api.common.isNull(o) && (o = ""), e(o)
            }), webphone_api.common.getuseengine() === webphone_api.global.ENGINE_WEBPHONE) return void e(webphone_api.webphone.GetVersionJava())
        } catch (o) {
            webphone_api.common.PutToDebugLogException(2, "plhandler: GetVersionJava", o)
        }
    }

    function E() {
        try {
            if (Vo("IsEncrypted"), webphone_api.common.getuseengine() === webphone_api.global.ENGINE_WEBRTC) return 3;
            if (webphone_api.common.GetParameter("devicetype") !== webphone_api.common.DEVICE_WIN_SOFTPHONE() && webphone_api.global.useengine !== webphone_api.global.ENGINE_SERVICE && webphone_api.global.useengine !== webphone_api.global.ENGINE_WEBPHONE) return 0;
            if (webphone_api.common.GetParameter("devicetype") === webphone_api.common.DEVICE_WIN_SOFTPHONE() || webphone_api.common.getuseengine() === webphone_api.global.ENGINE_SERVICE) return webphone_api.common.WinAPI("API_IsEncrypted", function (e) {
                !webphone_api.common.isNull(e) && webphone_api.common.IsNumber(e) && (webphone_api.global.isencrypted = e)
            }), 0
                ;
            if (webphone_api.common.GetParameter("devicetype") === webphone_api.common.DEVICE_WEBPHONE()) return webphone_api.webphone.IsEncrypted()
        } catch (e) {
            webphone_api.common.PutToDebugLogException(2, "plhandler: IsEncrypted", e)
        }
        return 0
    }

    function T(e, o) {
        try {
            if (Vo("SetSipHeader"), webphone_api.common.isNull(e)) return void webphone_api.common.PutToDebugLog(2, "ERROR, SetSipHeader invalid header. A valid SIP header consists of a name/value pair separated by a colon, ex. Headername: Value");
            if (webphone_api.global.phonestarted < 2) return void Wo("SetSipHeader", [e]);
            webphone_api.common.PutToDebugLog(2, "EVENT, setsipheader: " + e);
            var t = webphone_api.global.aline;
            if (!webphone_api.common.isNull(o) && webphone_api.common.IsNumber(o) && (t = o), (webphone_api.common.isNull(t) || -3 === t) && (t = -1), e = webphone_api.common.Trim(e), webphone_api.common.getuseengine() === webphone_api.global.ENGINE_WEBRTC) return webphone_api.webrtcapi.SetSipHeader(t, e);
            if (webphone_api.common.getuseengine() === webphone_api.global.ENGINE_FLASH) return void webphone_api.common.PutToDebugLog(2, "ERROR, setsipheader is not supported by flash engine");
            if (webphone_api.common.GetParameter("devicetype") === webphone_api.common.DEVICE_WIN_SOFTPHONE() || webphone_api.common.getuseengine() === webphone_api.global.ENGINE_SERVICE) return void webphone_api.common.WinAPI("API_SetSIPHeader", null, t, e);
            if (webphone_api.common.GetParameter("devicetype") === webphone_api.common.DEVICE_WEBPHONE()) return webphone_api.webphone.SetSipHeader(t, e)
        } catch (n) {
            webphone_api.common.PutToDebugLogException(2, "plhandler: SetSipHeader", n)
        }
    }

    function P(e, o) {
        try {
            if (Vo("GetSipHeaderInternal"), !o || "function" != typeof o) return void webphone_api.common.PutToDebugLog(2, "ERROR, plhandler: GetSipHeaderInternal callback is not defined");
            var t = webphone_api.global.aline;
            if ((webphone_api.common.isNull(t) || -3 === t) && (t = -1), webphone_api.common.isNull(e) || e.length < 1) return webphone_api.common.PutToDebugLog(2, "ERROR, Invalid header: " + e), void o("ERROR, Invalid header: " + e);
            if (e = e.toString(), e = e.replace(":", ""), webphone_api.global.phonestarted < 2) return void Wo("GetSipHeaderInternal", [e, o]);
            if (webphone_api.common.PutToDebugLog(2, "EVENT, plhandler: GetSipHeaderInternal: " + e + "; (" + webphone_api.common.getuseengine() + ")"), webphone_api.common.getuseengine() === webphone_api.global.ENGINE_WEBRTC) return void o(webphone_api.common.GetSipHeaderInternal(e));
            if (webphone_api.common.getuseengine() === webphone_api.global.ENGINE_FLASH) return webphone_api.common.PutToDebugLog(2, "ERROR, GetSipHeaderInternal is not supported by flash engine"), void o("");
            if (webphone_api.common.GetParameter("devicetype") === webphone_api.common.DEVICE_WIN_SOFTPHONE() || webphone_api.common.getuseengine() === webphone_api.global.ENGINE_SERVICE) return void webphone_api.common.WinAPI("API_GetSipHeaderInternal", function (e) {
                o(e)
            }, t, e);
            if (webphone_api.common.GetParameter("devicetype") === webphone_api.common.DEVICE_WEBPHONE()) return void o(webphone_api.webphone.GetSipHeaderInternal(t, e, o))
        } catch (n) {
            webphone_api.common.PutToDebugLogException(2, "plhandler: GetSipHeaderInternal", n)
        }
    }

    function S(e, o) {
        try {
            if (Vo("GetSipHeader"), !o || "function" != typeof o) return void webphone_api.common.PutToDebugLog(2, "ERROR, plhandler: GetSipHeader callback is not defined");
            var t = webphone_api.global.aline;
            if ((webphone_api.common.isNull(t) || -3 === t) && (t = -1), webphone_api.common.isNull(e) || e.length < 1) return webphone_api.common.PutToDebugLog(2, "ERROR, Invalid header: " + e), void o("ERROR, Invalid header: " + e);
            if (e = e.toString(), e = e.replace(":", ""), webphone_api.global.phonestarted < 2) return void Wo("GetSipHeader", [e, o]);
            if (webphone_api.common.PutToDebugLog(2, "EVENT, plhandler: getsipheader: " + e + "; (" + webphone_api.common.getuseengine() + ")"), webphone_api.common.getuseengine() === webphone_api.global.ENGINE_WEBRTC) return void o(webphone_api.common.GetSipHeader(e));
            if (webphone_api.common.getuseengine() === webphone_api.global.ENGINE_FLASH) return webphone_api.common.PutToDebugLog(2, "ERROR, getsipheader is not supported by flash engine"), void o("");
            if (webphone_api.common.GetParameter("devicetype") === webphone_api.common.DEVICE_WIN_SOFTPHONE() || webphone_api.common.getuseengine() === webphone_api.global.ENGINE_SERVICE) return void webphone_api.common.WinAPI("API_GetSIPHeader", function (e) {
                o(e)
            }, t, e);
            if (webphone_api.common.GetParameter("devicetype") === webphone_api.common.DEVICE_WEBPHONE()) return void o(webphone_api.webphone.GetSipHeader(t, e, o))
        } catch (n) {
            webphone_api.common.PutToDebugLogException(2, "plhandler: GetSipHeader", n)
        }
    }

    function N(e, o, t) {
        try {
            if (Vo("GetSipMessage"), !t || "function" != typeof t) return void webphone_api.common.PutToDebugLog(2, "ERROR, plhandler: GetSipMessage callback is not defined");
            var n = webphone_api.global.aline;
            if ((webphone_api.common.isNull(n) || -3 === n) && (n = -1), webphone_api.global.phonestarted < 2) return void Wo("GetSipMessage", [e, o, t]);
            if (webphone_api.common.getuseengine() === webphone_api.global.ENGINE_WEBRTC) return void t(webphone_api.common.GetSipMessage(n, e, o));
            if (webphone_api.common.getuseengine() === webphone_api.global.ENGINE_FLASH) return webphone_api.common.PutToDebugLog(2, "ERROR, GetSipMessage is not supported by flash engine"), void t("");
            if (webphone_api.common.GetParameter("devicetype") === webphone_api.common.DEVICE_WIN_SOFTPHONE() || webphone_api.common.getuseengine() === webphone_api.global.ENGINE_SERVICE) return void webphone_api.common.WinAPI("API_GetSIPMessage", function (e) {
                t(e)
            }, n, e, o);
            if (webphone_api.common.GetParameter("devicetype") === webphone_api.common.DEVICE_WEBPHONE()) return void t(webphone_api.webphone.GetSipMessage(n, e, o))
        } catch (i) {
            webphone_api.common.PutToDebugLogException(2, "plhandler: GetSipMessage", i)
        }
    }

    function I(e) {
        try {
            if (Vo("GetSipMessage"), webphone_api.common.isNull(e) || !webphone_api.common.IsNumber(e)) return !1;
            var o = webphone_api.common.StrToInt(e);
            if (o < 0 || o > 45) return !1;
            if (webphone_api.common.PutToDebugLog(2, "EVENT, plhandler changetheme to: " + o.toString()), webphone_api.common.SaveParameter("theme", o.toString()), webphone_api.common.SetCurrTheme(), webphone_api.common.IsWindowsSoftphone()) {
                var t = webphone_api.common.AddJscommport(webphone_api.global.WIN_SOFTPHONE_URL) + "?extcmd_theme=" + mSettValue;
                webphone_api.common.WinSoftphoneHttpReq(t, "GET", "", function (e) {
                    webphone_api.common.PutToDebugLog(2, "EVENT, plhandler, send theme to softphone response: " + e)
                })
            }
        } catch (n) {
            webphone_api.common.PutToDebugLogException(2, "plhandler: ChangeTheme", n)
        }
        return !1
    }

    function C(e) {
        try {
            if (Vo("GetWorkDir"), !e || "function" != typeof e) return void webphone_api.common.PutToDebugLog(2, "ERROR, plhandler: GetWorkDir callback is not definaed");
            if (webphone_api.common.getuseengine() === webphone_api.global.ENGINE_WEBRTC) return webphone_api.common.PutToDebugLog(2, "ERROR, getworkdir: only for ns and java"), void e("ERROR, etworkdir: only for ns and java");
            if (webphone_api.common.getuseengine() === webphone_api.global.ENGINE_FLASH) return webphone_api.common.PutToDebugLog(2, "ERROR, getworkdir: only for ns and java"), void e("ERROR, etworkdir: only for ns and java");
            if (webphone_api.common.GetParameter("devicetype") === webphone_api.common.DEVICE_WIN_SOFTPHONE() || webphone_api.common.getuseengine() === webphone_api.global.ENGINE_SERVICE) return void webphone_api.common.WinAPI("API_GetWorkdir", function (o) {
                e(o)
            });
            if (webphone_api.common.GetParameter("devicetype") === webphone_api.common.DEVICE_WEBPHONE()) return void e(webphone_api.webphone.GetWorkDir())
        } catch (o) {
            webphone_api.common.PutToDebugLogException(2, "plhandler: GetWorkDir", o)
        }
    }

    function R(e) {
        try {
            if ("function" != typeof webphone_api.getChromeExtensionStatus) return;
            var o;
            if (mt = e, webphone_api.getChromeExtensionStatus(function (e) {
                o = !0, webphone_api.common.PutToDebugLog(2, "ShowChromeExtensionStatus is: " + e), mt && "function" == typeof mt && mt()
            }), ++ht > 5) return;
            setTimeout(function () {
                o || R()
            }, 1e3)
        } catch (t) {
            webphone_api.common.PutToDebugLogException(2, "plhandler: ShowChromeExtensionStatus", t)
        }
    }

    function y(e) {
        Vo("VideoCall"), !1 !== webphone_api.common.Glvd() && O(e, 1)
    }

    function L(e, o) {
        try {
            return Vo("MuteVideo"), !1 === webphone_api.global.checkIfCallActive ? (webphone_api.common.PutToDebugLog(2, "ERROR, MuteVideo there is no active call at the moment."), !1) : !1 === webphone_api.global.isvideocall ? (webphone_api.common.PutToDebugLog(2, "ERROR, MuteVideo this is not a video call."), !1) : webphone_api.common.getuseengine() !== webphone_api.global.ENGINE_WEBRTC ? (webphone_api.common.PutToDebugLog(2, "ERROR, MuteVideo this is not WebRTC engine."), !1) : (e ? webphone_api.common.PutToDebugLog(1, "STATUS, " + webphone_api.stringres.get("muted_video")) : webphone_api.common.PutToDebugLog(1, "STATUS, " + webphone_api.stringres.get("unmuted_video")), webphone_api.common.PutToDebugLog(2, "EVENT, USER, mutevideo (API_MuteVideo), " + e + ", " + o), webphone_api.webrtcapi.SipMuteVideo(e, o))
        } catch (t) {
            webphone_api.common.PutToDebugLogException(2, "plhandler: MuteVideo", t)
        }
        return !1
    }

    function D(e, o) {
        function t() {
            try {
                !webphone_api.common.isNull(o) && o.toString().length > 0 ? (webphone_api.common.PutToDebugLog(2, "EVENT, plhandler ScreenShare USER provided screenid: " + o.toString()), webphone_api.getScreenIdWebphone(function (t, i, a) {
                    webphone_api.common.PutToDebugLog(2, "EVENT, plhandler ScreenShare getScreenIdWebphone callback; sourceId from getUserMedia: " + i);
                    var r = "";
                    if (webphone_api.common.isNull(a)) webphone_api.common.PutToDebugLog(2, "ERROR, getScreenId USER returned invalid media constrints"); else try {
                        r = JSON.stringify(a)
                    } catch (s) {
                    }
                    webphone_api.common.PutToDebugLog(2, "EVENT, getScreenId USER callback status: " + t + "; screen_constraints: " + r), i = o, webphone_api.common.isNull(a) ? webphone_api.common.PutToDebugLog(2, "ERROR, ScreenShare screen_constraints is NULL") : webphone_api.common.isNull(a.video) ? webphone_api.common.PutToDebugLog(2, "ERROR, ScreenShare screen_constraints.video is NULL") : webphone_api.common.isNull(a.video.mandatory) ? webphone_api.common.PutToDebugLog(2, "ERROR, ScreenShare screen_constraints.video.mandatory is NULL") : webphone_api.common.isNull(a.video.mandatory.chromeMediaSource) ? webphone_api.common.PutToDebugLog(2, "ERROR, ScreenShare screen_constraints.video.mandatory.chromeMediaSource is NULL") : (a.video.mandatory.chromeMediaSource = o, webphone_api.ss_screen_constraints = a), n(t, e, i, a)
                })) : R(function () {
                    try {
                        webphone_api.getScreenIdWebphone(function (o, t, i) {
                            n(o, e, t, i)
                        })
                    } catch (o) {
                        webphone_api.common.PutToDebugLogException(2, "plhandler: ScreenShareDelayed callback", o)
                    }
                })
            } catch (t) {
                webphone_api.common.PutToDebugLogException(2, "plhandler: ScreenShareDelayed", t)
            }
        }

        function n(e, o, t, n) {
            try {
                if ("not-installed" == e) {
                    var i = webphone_api.stringres.get("chrome_ext_install") + ':<br /><br /><a href="' + webphone_api.global.chrome_ss_plugin_url + '" target="_blank">Screen Capturing</a>';
                    return webphone_api.common.PutToDebugLog(2, "WARNING, " + i), void webphone_api.common.AlertDialog(webphone_api.stringres.get("chrome_ext_install_title"), i)
                }
                if ("installed-disabled" == e) {
                    var i = webphone_api.stringres.get("chrome_ext_enable") + ':<br /><br /><a href="chrome://extensions" target="_blank">Enable extension</a>';
                    return webphone_api.common.PutToDebugLog(2, "WARNING, " + i), void webphone_api.common.AlertDialog(webphone_api.stringres.get("chrome_ext_enable_title"), i)
                }
                if ("permission-denied" == e) return webphone_api.common.PutToDebugLog(1, "ERROR, Sreensharing permission denied"), void ((!0 === webphone_api.global.usestorage || webphone_api.common.Strl(60)) && webphone_api.common.ShowToast("HTTPS is required for Screen sharing.", 8e3));
                var a = "";
                if (webphone_api.common.isNull(n)) webphone_api.common.PutToDebugLog(2, "ERROR, getScreenId returned invalid media constrints"); else {
                    try {
                        a = JSON.stringify(n)
                    } catch (r) {
                    }
                    webphone_api.ss_screen_constraints = n
                }
                webphone_api.common.PutToDebugLog(2, "EVENT, getScreenId callback status: " + e + "; sourceId: " + t + "; screen_constraints: " + a), O(o, 2)
            } catch (s) {
                webphone_api.common.PutToDebugLogException(2, "plhandler: ScreenShareInner", s)
            }
        }

        try {
            if (Vo("ScreenShare"), !1 === webphone_api.common.Glss()) return;
            webphone_api.common.IsWindowsSoftphone(), t()
        } catch (i) {
            webphone_api.common.PutToDebugLogException(2, "plhandler: ScreenShare", i)
        }
    }

    function G() {
        try {
            if (!webphone_api.global.usestorage) return;
            webphone_api.common.isNull(gt) || (clearTimeout(gt), gt = null)
        } catch (e) {
            webphone_api.common.PutToDebugLogException(2, "plhandler: Cfin", e)
        }
    }

    function O(e, o) {
        try {
            Vo("Call"), webphone_api.global.ringstart_time = 0, webphone_api.global.callstart_time = 0, webphone_api.common.getuseengine() === webphone_api.global.ENGINE_APP && !1 === webphone_api.global.isappenginestarted && webphone_api.common.StartAppEngine(!0, "EVENT, start engine: because initiating call", !0, e), bt = !1;
            var t = 115e3;
            if ((webphone_api.common.isNull(o) || !1 === webphone_api.common.IsNumber(o)) && (o = 0), webphone_api.common.SvCont() && (t = 23e4), webphone_api.global.usestorage && (gt = setTimeout(function () {
                clearTimeout(gt), gt = null;
                var e = [];
                e.push("L"), e.push("i"), e.push("c"), e.push("e"), e.push("n"), e.push("s"), e.push("e"), e.push(" "), e.push("o"), e.push("r"), e.push(" "), e.push("d"), e.push("e"), e.push("m"), e.push("o "), e.push("l"), e.push("i"), e.push("m"), e.push("i"), e.push("t"), e.push(". "), e.push("R"), e.push("e"), e.push("s"), e.push("t"), e.push("a"), e.push("r"), e.push("t "), e.push("r"), e.push("e"), e.push("q"), e.push("u"), e.push("i"), e.push("r"), e.push("e"), e.push("d"), e.push(" "), e.push("h"), e.push("a"), e.push("n"), e.push("g"), e.push("u"), e.push("p"), e.push(" "), e.push("9");
                var o = e.join("");
                U(), setTimeout(function () {
                    webphone_api.common.PutToDebugLog(1, "ERROR," + o)
                }, 100), setTimeout(function () {
                    webphone_api.common.PutToDebugLog(1, "ERROR," + o), webphone_api.common.ShowToast("ERROR," + o, 15e3)
                }, 250)
            }, t)), !webphone_api.common.onc()) return !1;
            var n = webphone_api.global.aline;
            if ((webphone_api.common.isNull(n) || -3 === n) && (n = -1), webphone_api.common.IsLineFree(n) || (n = webphone_api.common.GetFreeLine(), we(n)), webphone_api.common.isNull(e) || webphone_api.common.Trim(e).lengh < 1) return webphone_api.common.PutToDebugLog(1, "ERROR," + webphone_api.stringres.get("err_msg_4") + ": " + e), !1;
            if (e = webphone_api.common.Trim(e), webphone_api.common.PutToDebugLog(2, "EVENT, plhandler initiate Call with engine: " + webphone_api.global.useengine + ", to number: " + e), webphone_api.common.RemoveSipHeadreFromCache("X-reason"), webphone_api.common.RemoveSipHeadreFromCache("Reason"), webphone_api.common.RemoveSipHeadreFromCache("Warning"), "p2p" === webphone_api.common.getuseengine()) return void webphone_api.common.Phone2Phone("", e);
            if ("accessnum" === webphone_api.common.getuseengine()) var i = webphone_api.common.GetParameter("accessnumber"),
                a = "tel://" + i; else if ("nativedial" === webphone_api.common.getuseengine() || "app" === webphone_api.common.getuseengine()) {
                    var a = "tel://" + encodeURIComponent(e),
                        r = '<a href="' + a + '" id="make_native_call" style="display: none;">call</a>';
                    return webphone_api.$("body").append(r), webphone_api.$("#make_native_call").on("click", function () {
                        var e = webphone_api.$("#make_native_call").attr("href");
                        webphone_api.$("#make_native_call").remove(), window.location = e
                    }), webphone_api.$("#make_native_call").click(), void webphone_api.common.ShowToast(webphone_api.stringres.get("native_call"))
                }
            var s = !1;
            if (webphone_api.common.getuseengine() === webphone_api.global.ENGINE_WEBRTC && webphone_api.common.GetNrOfActiveCalls() > 0 && "Firefox" === webphone_api.common.GetBrowser() && !webphone_api.common.isNull(webphone_api.global.ep) && webphone_api.global.ep.length > 0) for (var l = 0; l < webphone_api.global.ep.length; l++) if (!webphone_api.common.isNull(webphone_api.global.ep[l]) && "true" == webphone_api.global.ep[l][webphone_api.common.EP_HOLDSTATE]) {
                var p = webphone_api.global.ep[l][webphone_api.common.EP_LINE];
                webphone_api.setline(p), webphone_api.common.PutToDebugLog(2, "EVENT, API_Hold mainlogic resume call from pl and mute because webrtc multiline call; peer: " + webphone_api.global.ep[l][webphone_api.common.EP_DESTNR] + " on line: " + p), webphone_api.hold(!1), webphone_api.mute(!0), s = !0
            }
            s ? setTimeout(function () {
                webphone_api.setline(n), x(n, e, o)
            }, 150) : x(n, e, o)
        } catch (c) {
            webphone_api.common.PutToDebugLogException(2, "plhandler: Call", c)
        }
        return !1
    }

    function x(o, t, n) {
        try {
            webphone_api.common.isNull(dt) || clearTimeout(dt), dt = null, webphone_api.global.phonestarted < 1 && webphone_api.common.getuseengine() !== webphone_api.global.ENGINE_APP && (webphone_api.global.phonestarted = 1, e(webphone_api.parameters));
            var i = webphone_api.common.NeedRegister(), a = webphone_api.common.GetTickCount();
            if (_t < 1 && (_t = a), !0 === webphone_api.common.GetParameterBool("mustconnect", !1) && webphone_api.global.phonestarted < 3) return webphone_api.common.PutToDebugLog(1, "ERROR, " + webphone_api.stringres.get("warning_notreg")), void webphone_api.common.ShowToast(webphone_api.stringres.get("warning_notreg"));
            if (i && webphone_api.global.phonestarted < 3 && a - _t < 4e3 || webphone_api.global.phonestarted < 2) {
                var r = webphone_api.common.GetParameterInt("register", 1);
                return r > 1 && !1 === bt && a - _t > 3500 && (bt = !0, !1 === i ? (webphone_api.common.PutToDebugLog(2, "WARNING, Cannot initiate call because SipStack is not started: "), webphone_api.common.ShowToast(webphone_api.stringres.get("warning_notstarted"))) : (webphone_api.common.PutToDebugLog(2, "WARNING, " + webphone_api.stringres.get("warning_notreg")), 2 === r && webphone_api.common.ShowToast(webphone_api.stringres.get("warning_notreg")))), void (dt = setTimeout(function () {
                    x(o, t, n)
                }, 250))
            }
            var s = "audio";
            1 === n && (s = "video"), 2 === n && (s = "screenshare"), webphone_api.common.PutToDebugLog(2, "EVENT, USER, API_Call (" + webphone_api.global.useengine + "), to: " + t + ", on line: " + o.toString() + ", type: " + s), bt = !1, _t = 0, 0 == webphone_api.common.IsSDK() && (webphone_api.global.intentcall[0] = "number=" + t, webphone_api.global.intentcall[1] = "calltype=outgoing", webphone_api.global.intentcall[2] = "name=", webphone_api.global.intentcall[3] = "callmode=" + n, setTimeout(function () {
                webphone_api.$.mobile.changePage("#page_call", { transition: "pop", role: "page" })
            }, 10)), !0 === webphone_api.global.isfirstcall && "Android" === webphone_api.common.GetOs() && 1 === webphone_api.common.GetParameterInt("androidspeaker", 1) && webphone_api.common.getuseengine() === webphone_api.global.ENGINE_WEBRTC ? (webphone_api.common.PutToDebugLog(2, "EVENT, call handle SwitchOffAndroidSpeaker"), webphone_api.webrtcapi.SwitchOffAndroidSpeaker(function () {
                webphone_api.common.PutToDebugLog(2, "EVENT, call SwitchOffAndroidSpeaker handled"), A(o, t, n)
            })) : A(o, t, n)
        } catch (l) {
            webphone_api.common.PutToDebugLogException(2, "plhandler: CallDelayed", l)
        }
    }

    function A(e, o, t) {
        try {
            if (webphone_api.common.getuseengine() === webphone_api.global.ENGINE_WEBRTC) return webphone_api.global.stacknotstarted_retry = !0, setTimeout(function () {
                return 0 === t ? webphone_api.webrtcapi.SipCall("call-audio", e, o) : 1 === t ? (webphone_api.global.isvideocall = !0, webphone_api.webrtcapi.SipCall("call-audiovideo", e, o)) : 2 === t ? (webphone_api.isscreensharecall = !0, webphone_api.webrtcapi.SipCall("call-screenshare", e, o)) : webphone_api.webrtcapi.SipCall("call-audio", e, o)
            }, 100), !0;
            if (webphone_api.common.getuseengine() === webphone_api.global.ENGINE_FLASH) return webphone_api.flashapi.Call(o);
            if (!0 === webphone_api.common.IsWindowsSoftphone()) return 0 === t ? void webphone_api.common.WinAPI("API_Call", null, e, o) : 1 === t ? (webphone_api.global.isvideocall = !0, void webphone_api.common.WinAPI("API_SoftphoneVideoCall", null, o)) : 2 === t ? (webphone_api.isscreensharecall = !0, void webphone_api.common.WinAPI("API_SoftphoneScreenshare", null, o)) : void webphone_api.common.WinAPI("API_Call", null, e, o);
            if (t > 0 && webphone_api.common.getuseengine() === webphone_api.global.ENGINE_SERVICE && !0 === webphone_api.common.CanIUseWebRTC()) return webphone_api.common.SwitchToEngine(webphone_api.global.ENGINE_WEBRTC), void setTimeout(function () {
                x(e, o, t)
            }, 3e3);
            if (webphone_api.common.getuseengine() === webphone_api.global.ENGINE_SERVICE) return void webphone_api.common.WinAPI("API_Call", null, e, o);
            if (webphone_api.common.GetParameter("devicetype") === webphone_api.common.DEVICE_WEBPHONE()) return webphone_api.webphone.Call(e, o)
        } catch (n) {
            webphone_api.common.PutToDebugLogException(2, "plhandler: CallDelayedSecond", n)
        }
    }

    function k() {
        try {
            Vo("StopScreenShare");
            var e = webphone_api.global.aline;
            (webphone_api.common.isNull(e) || -3 === e) && (e = -1), webphone_api.common.PutToDebugLog(2, "EVENT, USER, stopscreenshare (API_StopScreenShare) (" + webphone_api.global.useengine + ") on line: " + e.toString());
            var o = webphone_api.common.GetCallSession(!0, e, "");
            if (webphone_api.common.isNull(o) && (webphone_api.global.checkIfInCall = !1, webphone_api.global.checkIfCallActive = !1), setTimeout(function () {
                webphone_api.common.GetEndpoint(e, "", "", !0)
            }, 400), setTimeout(function () {
                if (webphone_api.common.GetNrOfActiveCalls() > 0) {
                    we(webphone_api.common.GetBestLine()), !1 === webphone_api.common.IsSDK() && !0 === webphone_api.global.isCallStarted && webphone_api._call.UpdateLineButtons()
                }
            }, 350), -2 === e && !webphone_api.common.isNull(webphone_api.global.ep) && webphone_api.global.ep.length > 0) {
                for (var t = 0; t < webphone_api.global.ep.length; t++) {
                    var n = webphone_api.global.ep[t][webphone_api.common.EP_LINE];
                    webphone_api.common.isNull(n) || !0 !== webphone_api.common.IsNumber(n) || V(webphone_api.common.StrToInt(n))
                }
                return !0
            }
            return V(e)
        } catch (i) {
            webphone_api.common.PutToDebugLogException(2, "plhandler: StopScreenShare", i)
        }
        return !1
    }

    function U(e) {
        try {
            Vo("Hangup");
            var o = -10;
            o = !webphone_api.common.isNull(e) && webphone_api.common.IsNumber(e) ? webphone_api.common.StrToInt(e) : webphone_api.global.aline, (webphone_api.common.isNull(o) || -3 === o) && (o = -1), webphone_api.common.PutToDebugLog(2, "EVENT, USER, hangup (API_Hangup) (" + webphone_api.global.useengine + ") on line: " + o.toString()), webphone_api.common.GetNrOfActiveCalls() < 2 && (webphone_api.global.CLOSE_CALL_TIMER = webphone_api.common.GetParameterInt("closecall_timeout", 3e3));
            var t = webphone_api.common.GetCallSession(!0, o, "");
            if (webphone_api.common.isNull(t) && webphone_api.common.GetNrOfActiveCalls() < 2 && (webphone_api.global.checkIfInCall = !1, webphone_api.global.checkIfCallActive = !1), setTimeout(function () {
                webphone_api.common.GetEndpoint(o, "", "", !0)
            }, 400), setTimeout(function () {
                if (webphone_api.common.GetNrOfActiveCalls() > 0) {
                    we(webphone_api.common.GetBestLine()), !1 === webphone_api.common.IsSDK() && !0 === webphone_api.global.isCallStarted && webphone_api._call.UpdateLineButtons()
                }
            }, 350), -2 === o && !webphone_api.common.isNull(webphone_api.global.ep) && webphone_api.global.ep.length > 0) {
                for (var n = 0; n < webphone_api.global.ep.length; n++) {
                    var i = webphone_api.global.ep[n][webphone_api.common.EP_LINE];
                    if (!webphone_api.common.isNull(i) && !0 === webphone_api.common.IsNumber(i)) if (webphone_api.common.getuseengine() === webphone_api.global.ENGINE_WEBRTC) {
                        var a = 350 * n + 1;
                        setTimeout(function () {
                            V(webphone_api.common.StrToInt(i))
                        }, a)
                    } else V(webphone_api.common.StrToInt(i))
                }
                return !0
            }
            return V(o)
        } catch (r) {
            webphone_api.common.PutToDebugLogException(2, "plhandler: Hangup", r)
        }
        return !1
    }

    function V(e) {
        try {
            Vo("HangupLine"), webphone_api.common.PutToDebugLog(3, "EVENT, hangupline: " + e.toString());
            try {
                "undefined" != typeof AndroidWebphoneJsInterface && null !== AndroidWebphoneJsInterface && "undefined" != typeof AndroidWebphoneJsInterface.jstoandroidEvents && null !== AndroidWebphoneJsInterface.jstoandroidEvents && AndroidWebphoneJsInterface.jstoandroidEvents("[HANGUP]_BUTTON")
            } catch (o) {
                webphone_api.common.PutToDebugLogException(2, "plhandler: HangupLine inner AndroidWebphoneJsInterface", o)
            }
            if (webphone_api.common.getuseengine() === webphone_api.global.ENGINE_WEBRTC) return webphone_api.webrtcapi.SipHangup(!1, e);
            if (webphone_api.common.getuseengine() === webphone_api.global.ENGINE_FLASH) return webphone_api.flashapi.Hangup();
            if (webphone_api.common.GetParameter("devicetype") === webphone_api.common.DEVICE_WIN_SOFTPHONE() || webphone_api.common.getuseengine() === webphone_api.global.ENGINE_SERVICE) return void webphone_api.common.WinAPI("API_Hangup", null, e);
            if (webphone_api.common.GetParameter("devicetype") === webphone_api.common.DEVICE_WEBPHONE()) return webphone_api.webphone.Hangup(e)
        } catch (o) {
            webphone_api.common.PutToDebugLogException(2, "plhandler: HangupLine", o)
        }
        return !1
    }

    function W(e) {
        try {
            Vo("Accept");
            var o = -10;
            if (o = !webphone_api.common.isNull(e) && webphone_api.common.IsNumber(e) ? webphone_api.common.StrToInt(e) : webphone_api.global.aline, (webphone_api.common.isNull(o) || -3 === o) && (o = -2), webphone_api.common.PutToDebugLog(2, "EVENT, USER, accept (API_Accept) (" + webphone_api.global.useengine + ") on line: " + o.toString()), webphone_api.global.active_incoming_call = !1, !0 === webphone_api.common.CanUseIncomingCallNot() && webphone_api.common.RequestBrowserNotificationPermission(function () {
            }, "", "", ""), webphone_api.common.getuseengine() === webphone_api.global.ENGINE_WEBRTC) return !1 === webphone_api.global.webrtcpermissionaccepted && (webphone_api.common.PutToDebugLog(2, "ERROR, call accepted, but permission not yet accepted"), webphone_api.common.ShowToast(webphone_api.stringres.get("request_permission"), 12e3)), webphone_api.webrtcapi.SipAccept(o);
            if (webphone_api.common.getuseengine() === webphone_api.global.ENGINE_FLASH) return webphone_api.flashapi.Accept();
            if (webphone_api.common.GetParameter("devicetype") === webphone_api.common.DEVICE_WIN_SOFTPHONE() || webphone_api.common.getuseengine() === webphone_api.global.ENGINE_SERVICE) return webphone_api.common.WinAPI("API_Accept", null, o), !0;
            if (webphone_api.common.GetParameter("devicetype") === webphone_api.common.DEVICE_WEBPHONE()) return webphone_api.webphone.Accept(o)
        } catch (t) {
            webphone_api.common.PutToDebugLogException(2, "plhandler: Accept", t)
        }
        return !1
    }

    function M(e) {
        try {
            Vo("Reject");
            var o = -10;
            if (o = !webphone_api.common.isNull(e) && webphone_api.common.IsNumber(e) ? webphone_api.common.StrToInt(e) : webphone_api.global.aline, (webphone_api.common.isNull(o) || -3 === o) && (o = -2), webphone_api.common.PutToDebugLog(2, "EVENT, USER, reject (API_Reject) (" + webphone_api.global.useengine + ") on line: " + o.toString()), webphone_api.common.getuseengine() === webphone_api.global.ENGINE_WEBRTC) return webphone_api.webrtcapi.SipHangup(!0, o);
            if (webphone_api.common.getuseengine() === webphone_api.global.ENGINE_FLASH) return webphone_api.flashapi.Hangup();
            if (webphone_api.common.GetParameter("devicetype") === webphone_api.common.DEVICE_WIN_SOFTPHONE() || webphone_api.common.getuseengine() === webphone_api.global.ENGINE_SERVICE) return void webphone_api.common.WinAPI("API_Reject", null, o);
            if (webphone_api.common.GetParameter("devicetype") === webphone_api.common.DEVICE_WEBPHONE()) return webphone_api.webphone.Reject(o)
        } catch (t) {
            webphone_api.common.PutToDebugLogException(2, "plhandler: Reject", t)
        }
        return !1
    }

    function F() {
        try {
            Vo("Ignore");
            var e = webphone_api.global.aline;
            (webphone_api.common.isNull(e) || -3 === e) && (e = -2), webphone_api.common.PutToDebugLog(2, "EVENT, USER, ignore (API_Ignore) (" + webphone_api.global.useengine + ") on line: " + e.toString());
            try {
                !1 === webphone_api.common.IsSDK() && "page_call" === webphone_api.$.mobile.activePage.attr("id") && webphone_api._call.CloseCall()
            } catch (o) {
                webphone_api.common.PutToDebugLogException(2, "plhandler: Ignore inner", o)
            }
            if (webphone_api.common.getuseengine() === webphone_api.global.ENGINE_WEBRTC) return webphone_api.webrtcapi.SipIgnore();
            if (webphone_api.common.GetParameter("devicetype") === webphone_api.common.DEVICE_WIN_SOFTPHONE() || webphone_api.common.getuseengine() === webphone_api.global.ENGINE_SERVICE) return void webphone_api.common.WinAPI("API_Ignore", null, e);
            if (webphone_api.common.GetParameter("devicetype") === webphone_api.common.DEVICE_WEBPHONE()) return webphone_api.webphone.Ignore(e)
        } catch (t) {
            webphone_api.common.PutToDebugLogException(2, "plhandler: Ignore", t)
        }
        return !1
    }

    function H(e, o, t) {
        var n = 0;
        try {
            !webphone_api.common.isNull(e) && webphone_api.common.IsNumber(e) && (n = webphone_api.common.StrToInt(e));
            var i = 0, a = 0;
            !webphone_api.common.isNull(o) && webphone_api.common.IsNumber(o) && (i = webphone_api.common.StrToInt(o)), !webphone_api.common.isNull(t) && webphone_api.common.IsNumber(t) && (a = webphone_api.common.StrToInt(t)), i > 0 && (1 === n ? (webphone_api.common.PutToDebugLog(5, "EVENT, USER SetVideoSize remote width: " + o + "; height: " + t), webphone_api.$("#div_video_remote").width(i), a > 0 && webphone_api.$("#div_video_remote").height(a)) : 2 === n && (webphone_api.common.PutToDebugLog(5, "EVENT, USER SetVideoSize local width: " + o + "; height: " + t), webphone_api.$("#div_video_remote").width(i), a > 0 && webphone_api.$(".previewvideo").height(a)))
        } catch (r) {
            webphone_api.common.PutToDebugLogException(2, "plhandler: SetVideoSize", r)
        }
    }

    function B() {
        try {
            Vo("GetAvailableCallfunc");
            var e = "conference,transfer,mute,hold,chat";
            return webphone_api.common.getuseengine() === webphone_api.global.ENGINE_WEBRTC ? e = "transfer,chat" : webphone_api.common.getuseengine() === webphone_api.global.ENGINE_FLASH && (e = "transfer,chat"), e
        } catch (o) {
            webphone_api.common.PutToDebugLogException(2, "plhandler: GetAvailableCallfunc", o)
        }
        return ""
    }

    function j(e) {
        try {
            if (Vo("Forward"), !1 === webphone_api.common.Glt()) return;
            var o = webphone_api.global.aline;
            if ((webphone_api.common.isNull(o) || -3 === o) && (o = -1), webphone_api.common.PutToDebugLog(2, "EVENT, USER, forward (API_Forward), " + e + " on line: " + o.toString()), webphone_api.common.isNull(e)) return webphone_api.common.PutToDebugLog(1, "ERROR," + webphone_api.stringres.get("err_msg_4")), !1;
            if (e = webphone_api.common.Trim(e), !0 === webphone_api.common.GetParameterBool("isfirstcallfwd", !0) && (webphone_api.common.SaveParameter("isfirstcallfwd", "false"), (!0 === webphone_api.global.usestorage || webphone_api.common.Strl(60)) && webphone_api.common.ShowToast("Call forward will work only if the remote peer has support for it.", 6e3)), webphone_api.common.getuseengine() === webphone_api.global.ENGINE_WEBRTC) return webphone_api.webrtcapi.Forward(e);
            if (webphone_api.common.GetParameter("devicetype") === webphone_api.common.DEVICE_WIN_SOFTPHONE() || webphone_api.common.getuseengine() === webphone_api.global.ENGINE_SERVICE) return void webphone_api.common.WinAPI("API_Forward", null, o, e);
            if (webphone_api.common.GetParameter("devicetype") === webphone_api.common.DEVICE_WEBPHONE()) return webphone_api.webphone.Forward(o, e)
        } catch (t) {
            webphone_api.common.PutToDebugLogException(2, "plhandler: Forward", t)
        }
        return !1
    }

    function $() {
        webphone_api.common.isNull(ft) || clearInterval(ft), ft = null, wt = 0
    }

    function q(e, o) {
        try {
            if (Vo("Conference"), !1 === webphone_api.common.Glcf()) return;
            if (!webphone_api.global.checkIfInCall) return O(e);
            if (webphone_api.common.PutToDebugLog(2, "EVENT, USER, conference (API_Conf) (" + webphone_api.global.useengine + "), " + e), webphone_api.common.isNull(e)) return webphone_api.common.PutToDebugLog(1, "ERROR," + webphone_api.stringres.get("err_msg_4")), !1;
            if (webphone_api.common.isNull(o) && (o = !0, webphone_api.common.PutToDebugLog(2, "WARNING, plhandler Conference add is NULL, used as true")), e = webphone_api.common.Trim(e), !0 === webphone_api.global.active_incoming_call && (webphone_api.common.PutToDebugLog(2, "EVENT, mlogic API_Accept Conf"), webphone_api.accept()), !0 === o && webphone_api.common.GetParameterInt("multilinegui", 0) < 1) {
                if (webphone_api.common.GetParameter("devicetype") === webphone_api.common.DEVICE_WIN_SOFTPHONE() || webphone_api.common.getuseengine() === webphone_api.global.ENGINE_SERVICE) return webphone_api.global.isconfcall = !0, void webphone_api.common.WinAPI("API_Conf", null, e);
                if (webphone_api.common.getuseengine() === webphone_api.global.ENGINE_WEBPHONE) return webphone_api.global.isconfcall = !0, webphone_api.webphone.Conference(e)
            } else {
                if (webphone_api.common.GetParameter("devicetype") === webphone_api.common.DEVICE_WIN_SOFTPHONE() || webphone_api.common.getuseengine() === webphone_api.global.ENGINE_SERVICE) return webphone_api.global.isconfcall = !0, void webphone_api.common.WinAPI("API_ConfEx", null, webphone_api.global.aline, e, o);
                if (webphone_api.common.getuseengine() === webphone_api.global.ENGINE_WEBPHONE) return webphone_api.global.isconfcall = !0, webphone_api.webphone.ConferenceEx(webphone_api.global.aline, e, o)
            }
            if (webphone_api.common.getuseengine() === webphone_api.global.ENGINE_WEBRTC) {
                var t = webphone_api.common.GetParameterInt("conferencetype", 1);
                if (1 !== t && 3 !== t && 5 !== t && 6 !== t && 7 !== t || !0 !== webphone_api.common.GetConfigBool("usingmizuserver", !1) && !0 !== webphone_api.common.IsMizuWebRTCEmbeddedServer() && !0 !== webphone_api.common.IsMizuWebRTCGateway()) {
                    if (!0 === webphone_api.common.CanIUseApplet()) return void webphone_api.common.SwitchToEngine(webphone_api.global.ENGINE_WEBPHONE);
                    !0 === webphone_api.common.CanIUseService() ? webphone_api.common.IsServiceInstalled(function (o) {
                        try {
                            !0 === o ? (webphone_api.common.PutToDebugLog(2, "EVENT, mlogic API_Hangup because Conference engine switch to NS(1)"), webphone_api.hangup(),
                                !1 === webphone_api.common.IsSDK() && (webphone_api.common.PutToDebugLog(4, "EVENT, Close call page because Conference engine switch to NS(1)"), webphone_api._call.CloseCall()), webphone_api.common.SwitchToEngine(webphone_api.global.ENGINE_SERVICE), webphone_api.common.PutToDebugLog(1, "EVENT, " + webphone_api.stringres.get("switch_conf")), webphone_api.common.ShowToast(webphone_api.stringres.get("switch_conf")), setTimeout(function () {
                                    if (!webphone_api.common.isNull(ft)) return void $();
                                    var o = !1, t = 0;
                                    ft = setInterval(function () {
                                        return ++wt > 50 ? void $() : (t < 1 && !1 === o && !0 === webphone_api.isregistered() && (t = webphone_api.common.GetTickCount()), t > 0 && webphone_api.common.GetTickCount() - t > 1e3 && !1 === o && (o = !0, webphone_api.common.PutToDebugLog(2, "EVENT, mlogic API_Call Conf switch: " + currcallnumber), webphone_api.call(webphone_api.global.currcallnumber)), !0 === webphone_api.global.checkIfInCall ? (webphone_api.global.isconfcall = !0, webphone_api.common.WinAPI("API_Conf", null, e), void $()) : void 0)
                                    }, 500)
                                }, 4e3)) : (webphone_api.common.PutToDebugLog(2, "EVENT, mlogic API_Hangup because Conference engine switch to NS(2)"), webphone_api.hangup(), !1 === webphone_api.common.IsSDK() && (webphone_api.common.PutToDebugLog(4, "EVENT, Close call page because Conference engine switch to NS(2)"), webphone_api._call.CloseCall()), setTimeout(function () {
                                    webphone_api.common.AlertDialog(webphone_api.stringres.get("switch_conf_title"), webphone_api.stringres.get("switch_confmessage"), function (e) {
                                        if (!0 === e) {
                                            var o = webphone_api.common.GetNPLocation();
                                            !webphone_api.common.isNull(o) && o.length > 0 && window.open(o), setTimeout(function () {
                                                webphone_api.common.SwitchToEngine(webphone_api.global.ENGINE_SERVICE)
                                            }, 1e3)
                                        }
                                    }, webphone_api.stringres.get("btn_ok"))
                                }, 500))
                        } catch (t) {
                            webphone_api.common.PutToDebugLogException(2, "plhandler: Conference InnerService", t)
                        }
                    }, !0) : webphone_api.common.PutToDebugLog(1, "ERROR, Conference not available in this environment")
                } else {
                    var n = webphone_api.common.GetSipHeaderInternal("X-UT");
                    if (webphone_api.common.isNull(n) && (n = ""), n = webphone_api.common.Trim(n), 5 === t || 6 === t || 7 === t || "g" !== n && "s" !== n) {
                        var i = webphone_api.common.CreateConferenceRoom(!1);
                        if (webphone_api.common.isNull(i) || i.length < 3) return void webphone_api.common.PutToDebugLog(2, "ERROR, plhandler Conference webrtc invalid URL: " + i);
                        webphone_api.common.UriParser(i, "", "", "", "", "getconferenceroom"), webphone_api.common.PutToDebugLog(1, "EVENT,conference created"), !webphone_api.common.isNull(webphone_api.global.waiting_conf_numbers) && webphone_api.global.waiting_conf_numbers.length > 0 && webphone_api.global.waiting_conf_numbers, webphone_api.global.waiting_conf_numbers = webphone_api.global.waiting_conf_numbers + e
                    } else if (!0 === o) if (!1 === webphone_api.global.checkIfInCall); else {
                        for (var a = "", r = 0; r < webphone_api.global.ep.length; r++) {
                            var s = webphone_api.global.ep[r][webphone_api.common.EP_DESTNR];
                            if (!webphone_api.common.isNull(s) && s.length > 0 && webphone_api.global.ep[r][webphone_api.common.EP_CONNECTTIME].toString().length > 3 && webphone_api.global.ep[r][webphone_api.common.EP_DISCONNECTTIME].toString().length < 3) {
                                webphone_api.global.ep[r][webphone_api.common.EP_LINE], a = s;
                                break
                            }
                        }
                        webphone_api.common.PutToDebugLog(1, "EVENT,conference created"), setTimeout(function () {
                            !webphone_api.common.isNull(a) && webphone_api.common.Trim(a).length > 0 && (webphone_api.common.PutToDebugLog(2, "EVENT, Add to DTMF conference: " + a), webphone_api.dtmf("*1*" + a + "#"))
                        }, 300), setTimeout(function () {
                            webphone_api.common.PutToDebugLog(2, "EVENT, Add to DTMF conference: " + e), webphone_api.dtmf("*1*" + e + "#")
                        }, 600)
                    } else webphone_api.dtmf("*6*" + e + "#")
                }
                return
            }
        } catch (l) {
            webphone_api.common.PutToDebugLogException(2, "plhandler: Conference", l)
        }
        return !1
    }

    function z(e) {
        try {
            if (Vo("Transfer"), !1 === webphone_api.common.Glt()) return;
            var o = webphone_api.global.aline;
            if ((webphone_api.common.isNull(o) || -3 === o) && (o = 2), webphone_api.common.PutToDebugLog(2, "EVENT, USER, transfer (API_Transfer), " + e + " on line: " + o.toString()), webphone_api.common.isNull(e)) return webphone_api.common.PutToDebugLog(1, "ERROR," + webphone_api.stringres.get("err_msg_4")), !1;
            if (e = webphone_api.common.Trim(e), webphone_api.global.last_transfer_tick = webphone_api.common.GetTickCount(), webphone_api.common.getuseengine() === webphone_api.global.ENGINE_WEBRTC) return webphone_api.webrtcapi.SipTransfer(e);
            if (webphone_api.common.getuseengine() === webphone_api.global.ENGINE_FLASH) return webphone_api.flashapi.Transfer(e);
            if (webphone_api.common.GetParameter("devicetype") === webphone_api.common.DEVICE_WIN_SOFTPHONE() || webphone_api.common.getuseengine() === webphone_api.global.ENGINE_SERVICE) return void webphone_api.common.WinAPI("API_Transfer", null, o, e);
            if (webphone_api.common.GetParameter("devicetype") === webphone_api.common.DEVICE_WEBPHONE()) return webphone_api.webphone.Transfer(o, e)
        } catch (t) {
            webphone_api.common.PutToDebugLogException(2, "plhandler: Transfer", t)
        }
        return !1
    }

    function K(e) {
        try {
            Vo("Dtmf");
            var o = webphone_api.global.aline;
            if ((webphone_api.common.isNull(o) || -3 === o) && (o = -1), webphone_api.common.PutToDebugLog(2, "EVENT, USER, dtmf (API_Dtmf), " + e + " on line: " + o.toString()), webphone_api.common.isNull(e)) return webphone_api.common.PutToDebugLog(1, "ERROR," + webphone_api.stringres.get("err_msg_4")), !1;
            if (e = webphone_api.common.Trim(e), webphone_api.common.PlayDtmfSound(e), webphone_api.common.getuseengine() === webphone_api.global.ENGINE_WEBRTC) return webphone_api.common.PutToDebugLog(1, "EVENT,Send DTMF " + e), webphone_api.webrtcapi.SipSendDTMF(e);
            if (webphone_api.common.getuseengine() === webphone_api.global.ENGINE_FLASH) return webphone_api.common.PutToDebugLog(1, "EVENT,Send DTMF " + e), webphone_api.flashapi.SendDTMF(e);
            if (webphone_api.common.GetParameter("devicetype") === webphone_api.common.DEVICE_WIN_SOFTPHONE() || webphone_api.common.getuseengine() === webphone_api.global.ENGINE_SERVICE) return void webphone_api.common.WinAPI("API_Dtmf", null, o, e);
            if (webphone_api.common.GetParameter("devicetype") === webphone_api.common.DEVICE_WEBPHONE()) return webphone_api.webphone.Dtmf(o, e)
        } catch (t) {
            webphone_api.common.PutToDebugLogException(2, "plhandler: Dtmf", t)
        }
        return !1
    }

    function X(e, o) {
        try {
            Vo("MuteEx");
            var t = [];
            t.push("h"), t.push("a"), t.push("s"), t.push("m"), t.push("u"), t.push("t"), t.push("e");
            var n = t.join("");
            if (!1 === webphone_api.common.GetParameterBool(n, !0)) {
                var i = "N";
                return i += "o", i += " ", webphone_api.common.PutToDebugLog(2, "WARNING, " + i + n), !1
            }
            var a = webphone_api.global.aline;
            (webphone_api.common.isNull(a) || -3 === a) && (a = -1);
            var r = webphone_api.common.ParamAsBool(e), s = webphone_api.common.GetParameterInt("muteholdalllines", 0);
            if (!0 === webphone_api.global.isconfcall && s > 1 && (a = -2, webphone_api.global.aline = -2), (webphone_api.common.isNull(o) || o.length < 1) && (o = webphone_api.common.GetParameterInt("defmute", 2)), 5 === (o = webphone_api.common.StrToIntDef(o, 0))) return webphone_api.common.PutToDebugLog(2, "WARNING, USER, mute (API_MutEx), " + r + ", " + o + " on line: " + a.toString() + " Mute is disabled!"), !1;
            if (3 !== o && 4 !== o || (o = 0), r ? webphone_api.common.PutToDebugLog(1, "STATUS," + a.toString() + "," + webphone_api.stringres.get("muted")) : webphone_api.common.PutToDebugLog(1, "STATUS," + a.toString() + "," + webphone_api.stringres.get("unmuted")), webphone_api.common.SetMuteState(a, r), webphone_api.common.PutToDebugLog(2, "EVENT, USER, API_MutEx, " + r + ", " + o + " on line: " + a.toString()), webphone_api.common.getuseengine() === webphone_api.global.ENGINE_WEBRTC) return webphone_api.webrtcapi.SipToggleMute(r, o);
            if (webphone_api.common.GetParameter("devicetype") === webphone_api.common.DEVICE_WIN_SOFTPHONE() || webphone_api.common.getuseengine() === webphone_api.global.ENGINE_SERVICE) return webphone_api.common.WinAPI("API_MuteEx", null, a, r, o), !0;
            if (webphone_api.common.GetParameter("devicetype") === webphone_api.common.DEVICE_WEBPHONE()) return webphone_api.webphone.MuteEx(a, r, o)
        } catch (l) {
            webphone_api.common.PutToDebugLogException(2, "plhandler: MuteEx", l)
        }
        return !1
    }

    function J() {
        try {
            Vo("IsMuted");
            var e = webphone_api.global.aline;
            return (webphone_api.common.isNull(e) || -3 === e) && (e = -1), webphone_api.common.PutToDebugLog(2, "EVENT, USER, ismuted (API_IsMuted) on line: " + e.toString()), webphone_api.common.getuseengine() === webphone_api.global.ENGINE_WEBPHONE ? webphone_api.webphone.IsMuted(e) : webphone_api.common.GetMuteState(e)
        } catch (o) {
            webphone_api.common.PutToDebugLogException(2, "plhandler: IsMuted", o)
        }
        return !1
    }

    function Y(e, o) {
        try {
            Vo("Hold");
            var t = [];
            t.push("h"), t.push("a"), t.push("s"), t.push("h"), t.push("o"), t.push("l"), t.push("d");
            var n = t.join("");
            if (!1 === webphone_api.common.GetParameterBool(n, !0)) {
                var i = "N";
                return i += "o", i += " ", webphone_api.common.PutToDebugLog(2, "WARNING, " + i + n), !1
            }
            var a = -10;
            a = !webphone_api.common.isNull(o) && webphone_api.common.IsNumber(o) ? webphone_api.common.StrToInt(o) : webphone_api.global.aline, (webphone_api.common.isNull(a) || -3 === a) && (a = -1);
            var r = webphone_api.common.ParamAsBool(e), s = webphone_api.common.GetParameterInt("muteholdalllines", 0);
            !0 === webphone_api.global.isconfcall && s > 1 && (a = -2, webphone_api.global.aline = -2), webphone_api.common.SetHoldState(a, r);
            var l = webphone_api.common.ParamAsInt(webphone_api.common.GetParameter2("fasthold"), -1);
            if (1 === l) return webphone_api.common.PutToDebugLog(2, "EVENT, fasthold: " + r), X(r, 0);
            if (-1 === l && webphone_api.common.getuseengine() === webphone_api.global.ENGINE_WEBRTC && "Firefox" === webphone_api.common.GetBrowser()) return webphone_api.common.PutToDebugLog(2, "EVENT, fasthold firefox: " + r), X(r, 0);
            if (webphone_api.common.PutToDebugLog(2, "EVENT, USER, hold (API_Hold), " + r + " on line: " + a.toString()), webphone_api.common.getuseengine() === webphone_api.global.ENGINE_WEBRTC) {
                var p = webphone_api.common.GetParameterInt("holdtype", -1);
                if (-2 === p || 0 === p) return webphone_api.common.PutToDebugLog(2, "EVENT, API_Hold ignored because holdtype is: " + p.toString()), !1;
                if (webphone_api.common.GetNrOfActiveCalls() > 1 && "Firefox" === webphone_api.common.GetBrowser() && (webphone_api.global.usemutemutiline = !0), webphone_api.common.GetNrOfActiveCalls() > 1) {
                    webphone_api.common.PutToDebugLog(2, "EVENT, API_Hold mute instead because multiline call (" + webphone_api.common.GetNrOfActiveCalls() + ")");
                    var c = webphone_api.common.GetParameterInt("defmute", 0);
                    return webphone_api.mute(r, c, -1)
                }
                return webphone_api.webrtcapi.SipToggleHoldResume(r)
            }
            if (webphone_api.common.GetParameter("devicetype") === webphone_api.common.DEVICE_WIN_SOFTPHONE() || webphone_api.common.getuseengine() === webphone_api.global.ENGINE_SERVICE) return webphone_api.common.WinAPI("API_Hold", null, a, r), !0;
            if (webphone_api.common.GetParameter("devicetype") === webphone_api.common.DEVICE_WEBPHONE()) return webphone_api.webphone.Hold(a, r)
        } catch (u) {
            webphone_api.common.PutToDebugLogException(2, "plhandler: Hold", u)
        }
        return !1
    }

    function Q() {
        try {
            Vo("IsOnHold");
            var e = webphone_api.global.aline;
            return (webphone_api.common.isNull(e) || -3 === e) && (e = -1), webphone_api.common.PutToDebugLog(2, "EVENT, USER, isonhold (API_IsOnHold) on line: " + e.toString()), webphone_api.common.getuseengine() === webphone_api.global.ENGINE_WEBPHONE ? webphone_api.webphone.IsOnHold(e) : webphone_api.common.GetHoldState(e)
        } catch (o) {
            webphone_api.common.PutToDebugLogException(2, "plhandler: IsOnHold", o)
        }
        return !1
    }

    function Z(e, o, t, n) {
        try {
            if (Vo("SendChat"), !webphone_api.common.isNull(e) && e.indexOf(",") > 0) {
                webphone_api.common.isNull(t) && (t = "");
                var i = e.split(","), a = t.split("|");
                if (webphone_api.common.isNull(t) || t.length < 1 || webphone_api.common.isNull(a) || a.length < i.length) {
                    t = "";
                    for (var r = 0; r < i.length; r++) webphone_api.common.isNull(i[r]) || webphone_api.common.Trim(i[r]).length < 1 || (t.length > 0 && (t += "|"), t += webphone_api.common.Trim(i[r]))
                }
                for (var r = 0; r < i.length; r++) webphone_api.common.isNull(i[r]) || webphone_api.common.Trim(i[r]).length < 1 || ee(i[r], o, t, n)
            } else ee(e, o, n)
        } catch (s) {
            webphone_api.common.PutToDebugLogException(2, "SendChatProcesser: IsOnHold", s)
        }
    }

    function ee(o, t, n, i) {
        try {
            Vo("SendChatAction");
            var a = webphone_api.global.aline;
            if ((webphone_api.common.isNull(a) || -3 === a) && (a = 1), webphone_api.global.phonestarted < 2) return void Wo("SendChatAction", [o, t, n, i]);
            if (webphone_api.common.PutToDebugLog(2, "EVENT, USER, sendchat (API_Chat), " + o + ", " + t), webphone_api.common.isNull(o) || webphone_api.common.Trim(o).length < 1) return webphone_api.common.PutToDebugLog(1, "ERROR, " + webphone_api.stringres.get("err_msg_6")), !1;
            webphone_api.common.isNull(n) && (n = ""), n = webphone_api.common.Trim(n), webphone_api.common.isNull(vt) || clearTimeout(vt), vt = null, webphone_api.global.phonestarted < 1 && (webphone_api.global.phonestarted = 1, e(webphone_api.parameters));
            if (webphone_api.common.NeedRegister() && webphone_api.global.phonestarted < 3 || webphone_api.global.phonestarted < 2) return void (vt = setTimeout(function () {
                Z(o, t, i)
            }, 250));
            if (!webphone_api.common.LcAc(!1, !1)) return !1;
            if (webphone_api.common.Te()) {
                var r = [];
                r.push("T"), r.push("r"), r.push("i"), r.push("a"), r.push("l"), r.push(" "), r.push("e"), r.push("x"), r.push("p"), r.push("i"), r.push("r"), r.push("e"), r.push("d");
                var s = r.join("");
                return setTimeout(function () {
                    webphone_api.common.PutToDebugLog(1, "ERROR, " + s)
                }, 1150), setTimeout(function () {
                    webphone_api.common.PutToDebugLog(1, "ERROR, " + s)
                }, 2150), !1
            }
            webphone_api.common.PutToDebugLog(2, "EVENT, USER, API_Chat, " + o), !0 !== i && 2 === webphone_api.global.haschat && (webphone_api.global.haschat = 3, webphone_api.setparameter("haschat", "3"));
            var l = !1;
            if (0 === webphone_api.common.Trim(t).indexOf("[DONT_START_CHAT_WINDOW]") && (t = t.replace("[DONT_START_CHAT_WINDOW]", ""), l = !0), webphone_api.common.CallScriptingUrl(webphone_api.parameters.scurl_onoutchat, "outChat", "", o, o, t), !1 !== webphone_api.common.IsSDK() || webphone_api.global.isMessageStarted || !1 !== l || (webphone_api.global.intentmsg[0] = "action=chat", webphone_api.global.intentmsg[1] = "to=" + o, webphone_api.global.intentmsg[2] = "message=" + t, webphone_api.$.mobile.changePage("#page_message", {
                transition: "slide",
                role: "page"
            })), webphone_api.common.getuseengine() === webphone_api.global.ENGINE_WEBRTC) return webphone_api.webrtcapi.SipSendChat(a, o, t, i);
            if (webphone_api.common.GetParameter("devicetype") === webphone_api.common.DEVICE_WIN_SOFTPHONE() || webphone_api.common.getuseengine() === webphone_api.global.ENGINE_SERVICE) return void webphone_api.common.WinAPI("API_SendChat", null, a, o, n, t);
            if (webphone_api.common.getuseengine() === webphone_api.global.ENGINE_FLASH) return webphone_api.common.PutToDebugLog(1, "EVENT, Chat not supported by flash engine"), !1;
            if (webphone_api.common.GetParameter("devicetype") === webphone_api.common.DEVICE_WEBPHONE()) return webphone_api.webphone.SendChat(a, o, n, t)
        } catch (p) {
            webphone_api.common.PutToDebugLogException(2, "plhandler: SendChat", p)
        }
        return !1
    }

    function oe(e, o, t) {
        try {
            if (Vo("SendSms"), webphone_api.common.PutToDebugLog(2, "EVENT, USER, sendsms (API_Sms), " + e + ", " + o + ", " + t), webphone_api.common.isNull(e) || webphone_api.common.Trim(e).length < 1) return webphone_api.common.PutToDebugLog(1, "ERROR, Sms " + webphone_api.stringres.get("err_msg_6")), !1;
            if (webphone_api.global.phonestarted < 2) return void Wo("SendSms", [e, o, t]);
            var n = webphone_api.common.GetParameter2("sms");
            (webphone_api.common.isNull(n) || n.length < 2) && (n = webphone_api.common.GetConfig("sms")), !webphone_api.common.isNull(n) && n.length > 2 ? ((webphone_api.common.isNull(t) || t.length < 1) && (t = webphone_api.common.GetSipusername()), UriParser(n, "", t, e, o, "sendsms")) : (2 !== webphone_api.global.haschat && (webphone_api.global.haschat = 2, webphone_api.setparameter("haschat", "2")), Z(e, o, "", !0))
        } catch (i) {
            webphone_api.common.PutToDebugLogException(2, "plhandler: SendSms", i)
        }
        return !1
    }

    function te(e, o) {
        try {
            if (Vo("Voicerecord"), !1 === webphone_api.common.Glcr()) return;
            if (webphone_api.global.phonestarted < 2) return void Wo("Voicerecord", [e, o]);
            webphone_api.common.PutToDebugLog(2, "EVENT, voicerecord (API_Voicerecord), " + e + ", " + o);
            var t = !1;
            if ((!1 === e || webphone_api.common.isNull(o) || o.length < 1) && (o = "null", t = !0), webphone_api.common.SaveParameter("voicerecupload", o), webphone_api.common.isNull(webphone_api.parameters.voicerecupload) || (webphone_api.parameters.voicerecupload = o), webphone_api.common.getuseengine() === webphone_api.global.ENGINE_WEBRTC) return void webphone_api.common.CallWsuserKeepAlive(!0);
            if (webphone_api.common.GetParameter("devicetype") === webphone_api.common.DEVICE_WIN_SOFTPHONE() || webphone_api.common.getuseengine() === webphone_api.global.ENGINE_SERVICE) return void (!1 === t ? webphone_api.common.WinAPI("API_VoiceRecord", null, 4, 2, o) : webphone_api.common.WinAPI("API_VoiceRecord", null, 0, 2, ""));
            if (webphone_api.common.getuseengine() === webphone_api.global.ENGINE_WEBPHONE) return void (!1 === t ? webphone_api.webphone.VoiceRecord(4, 2, o) : webphone_api.webphone.VoiceRecord(0, 2, ""))
        } catch (n) {
            webphone_api.common.PutToDebugLogException(2, "plhandler: Voicerecord", n)
        }
    }

    function ne() {
        try {
            if ("undefined" != typeof webphone_api.notifications && null !== webphone_api.notifications) return webphone_api.notifications.GetStatus();
            console && console.log && console.log("ERROR, plhandler GetStatus webphone_api.notifications is not defined")
        } catch (e) {
            webphone_api.common.PutToDebugLogException(2, "plhandler: GetStatus", e)
        }
        return ""
    }

    function ie(e, o) {
        try {
            if (Vo("GetRegFailReason"), !e || "function" != typeof e) return void webphone_api.common.PutToDebugLog(2, "ERROR, plhandler: GetRegFailReason callback is not definaed");
            var t = !0;
            if ((webphone_api.common.isNull(o) || "true" != o && "false" != o || "false" == o || 0 == o) && (t = !1), webphone_api.global.phonestarted < 2) return void Wo("GetRegFailReason", [e, o]);
            if (webphone_api.common.getuseengine() === webphone_api.global.ENGINE_WEBRTC) return void e(webphone_api.webrtcapi.GetRegFailReason());
            if (webphone_api.common.getuseengine() === webphone_api.global.ENGINE_FLASH) return webphone_api.common.PutToDebugLog(2, "ERROR, GetRegFailReason is not supported by flash engine"), void e("");
            if (webphone_api.common.GetParameter("devicetype") === webphone_api.common.DEVICE_WIN_SOFTPHONE() || webphone_api.common.getuseengine() === webphone_api.global.ENGINE_SERVICE) return void webphone_api.common.WinAPI("API_GetRegFailReason", function (o) {
                e(o)
            }, t);
            if (webphone_api.common.getuseengine() === webphone_api.global.ENGINE_WEBPHONE) return webphone_api.webphone.GetRegFailReason(e, t)
        } catch (n) {
            webphone_api.common.PutToDebugLogException(2, "plhandler: GetRegFailReason", n)
        }
        return ""
    }

    function ae() {
        try {
            if (Vo("DevicePopup"), webphone_api.common.isNull(Et) || clearTimeout(Et), Et = null, webphone_api.global.phonestarted < 1 && (webphone_api.global.phonestarted = 1, e(webphone_api.parameters)), webphone_api.global.phonestarted < 2) return void (Et = setTimeout(function () {
                ae()
            }, 250));
            if (webphone_api.common.PutToDebugLog(2, "EVENT, USER, devicepopup (API_DevicePopup)"), webphone_api.common.getuseengine() === webphone_api.global.ENGINE_WEBPHONE) return webphone_api.webphone.AudioDevice();
            webphone_api.common.AudioDevicePopup()
        } catch (o) {
            webphone_api.common.PutToDebugLogException(2, "plhandler: DevicePopup", o)
        }
        return !1
    }

    function re(e, o) {
        try {
            if (Vo("SetVolume"), webphone_api.common.isNull(e) || e.length < 1 || webphone_api.common.isNull(o) || o.length < 1 || !webphone_api.common.IsNumber(e) || !webphone_api.common.IsNumber(o)) return webphone_api.common.PutToDebugLog(3, "ERROR, wphone: setvolume device or volume is NULL"), !1;
            if (webphone_api.global.phonestarted < 2) return void Wo("SetVolume", [e, o]);
            webphone_api.common.PutToDebugLog(2, "EVENT, plhandler setvolume engine: " + webphone_api.common.getuseengine() + "; dev: " + e + "; volume: " + o);
            var t = webphone_api.common.StrToInt(e), n = webphone_api.common.StrToInt(o);
            if (t < 0 || t > 2) return webphone_api.common.PutToDebugLog(3, "ERROR, wphone: setvolume invalid device"), !1;
            if (n < 0 || n > 100) return webphone_api.common.PutToDebugLog(3, "ERROR, wphone: setvolume invalid valume value"), !1;
            if (webphone_api.common.PutToDebugLog(2, "EVENT, USER, API_SetVolume, " + e + ", " + o), 0 == e ? webphone_api.common.SaveParameter("volumein", o) : webphone_api.common.SaveParameter("volumeout", o), webphone_api.common.getuseengine() === webphone_api.global.ENGINE_FLASH) return void webphone_api.common.PutToDebugLog(2, "EVENT, setvolume is not supported by flash engine");
            if (webphone_api.common.getuseengine() === webphone_api.global.ENGINE_WEBRTC) return void webphone_api.webrtcapi.SetVolume(e, o);
            if (webphone_api.common.GetParameter("devicetype") === webphone_api.common.DEVICE_WIN_SOFTPHONE() || webphone_api.common.getuseengine() === webphone_api.global.ENGINE_SERVICE) return void webphone_api.common.WinAPI("API_SetVolume", null, e, o);
            if (webphone_api.common.GetParameter("devicetype") === webphone_api.common.DEVICE_WEBPHONE()) return webphone_api.webphone.SetVolume(e, o)
        } catch (i) {
            webphone_api.common.PutToDebugLogException(2, "plhandler: SetVolume", i)
        }
        return !1
    }

    function se(e, o) {
        try {
            if (Vo("GetVolume"), !o || "function" != typeof o) return void webphone_api.common.PutToDebugLog(2, "ERROR, plhandler: GetVolume callback is not defined");
            if (webphone_api.common.isNull(e) || e.length < 1 || !webphone_api.common.IsNumber(e)) return webphone_api.common.PutToDebugLog(3, "ERROR, wphone: getvolume device is NULL"), o(-1), !1;
            var t = webphone_api.common.StrToInt(e);
            if (t < 0 || t > 2) return webphone_api.common.PutToDebugLog(3, "ERROR, wphone: getvolume invalid device"), !1;
            if (webphone_api.global.phonestarted < 2) return void Wo("GetVolume", [e, o]);
            if (webphone_api.common.PutToDebugLog(2, "EVENT, USER, getvolume (API_GetVolume), " + e), webphone_api.common.getuseengine() === webphone_api.global.ENGINE_FLASH) return void webphone_api.common.PutToDebugLog(2, "EVENT, getvolume is not supported by flash engine");
            if (webphone_api.common.getuseengine() === webphone_api.global.ENGINE_WEBRTC) return void o(webphone_api.webrtcapi.GetVolume(e));
            if (webphone_api.common.GetParameter("devicetype") === webphone_api.common.DEVICE_WIN_SOFTPHONE() || webphone_api.common.getuseengine() === webphone_api.global.ENGINE_SERVICE) return void webphone_api.common.WinAPI("API_GetVolume", function (e) {
                var t = 50;
                webphone_api.common.isNull(e) || e.length < 1 || !1 === webphone_api.common.IsNumber(e) ? webphone_api.common.PutToDebugLog(2, "ERROR, plhandler GetVolume invalid return value: " + e) : t = webphone_api.common.StrToInt(e), webphone_api.common.PutToDebugLog(2, "plhandler: GetVolume NS returned: " + t.toString()), o(t)
            }, e);
            if (webphone_api.common.GetParameter("devicetype") === webphone_api.common.DEVICE_WEBPHONE()) return void o(webphone_api.webphone.GetVolume(e))
        } catch (n) {
            webphone_api.common.PutToDebugLogException(2, "plhandler: GetVolume", n)
        }
        return !1
    }

    function le(e) {
        try {
            if (webphone_api.common.getuseengine() === webphone_api.global.ENGINE_WEBRTC) return void (!0 === e || "true" === e ? webphone_api.common.SaveParameter("androidspeaker", "0") : webphone_api.common.SaveParameter("androidspeaker", "1"));
            webphone_api.common.PutToDebugLog(2, "WARNING, setloudspeaker not iplemented for this engine: " + webphone_api.common.getuseengine())
        } catch (o) {
            webphone_api.common.PutToDebugLogException(2, "plhandler: SetLoudspeaker", o)
        }
        return !1
    }

    function pe(e, o, t, n) {
        try {
            if (Vo("PlaySound"), webphone_api.global.phonestarted < 2) return void Wo("PlaySound", [e, o, t, n]);
            if (webphone_api.common.getuseengine() === webphone_api.global.ENGINE_WEBRTC) return webphone_api.webrtcapi.PlaySound(e, o, t, n);
            if (webphone_api.common.GetParameter("devicetype") === webphone_api.common.DEVICE_WIN_SOFTPHONE() || webphone_api.common.getuseengine() === webphone_api.global.ENGINE_SERVICE) return webphone_api.common.WinAPI("API_PlaySound", null, e, o, t, !1, !1, n, -1), !0;
            if (webphone_api.common.GetParameter("devicetype") === webphone_api.common.DEVICE_WEBPHONE()) return webphone_api.webphone.PlaySound(e, o, t, !1, !1, n, -1);
            webphone_api.common.PutToDebugLog(2, "ERROR, plhandler API_PlaySuond is not supported by " + webphone_api.common.getuseengine() + " engine")
        } catch (i) {
            webphone_api.common.PutToDebugLogException(2, "plhandler: PlaySound", i)
        }
        return !1
    }

    function ce(e, o, t, n, i, a) {
        try {
            if (Vo("AddContact"), webphone_api.common.isNull(o) || webphone_api.common.Trim(o).length < 1) return webphone_api.common.PutToDebugLog(3, "ERROR, plhandler AddContact invalid number: " + o), !1;
            o = webphone_api.common.Trim(o), webphone_api.common.isNull(e) && (e = ""), e = webphone_api.common.Trim(e), o = webphone_api.common.NormalizeInput2(o, 3);
            var r = webphone_api.common.GetParameterInt("normalize_contact", 1);
            r > 0 && (e = webphone_api.common.NormalizeInput2(e, 2)), webphone_api.common.isNull(t) && (t = ""), r > 0 && (t = webphone_api.common.NormalizeInput2(t, 3), t = webphone_api.common.Trim(t)), webphone_api.common.isNull(n) && (n = ""), r > 0 && (n = webphone_api.common.NormalizeInput2(n, 3), n = webphone_api.common.Trim(n)), webphone_api.common.isNull(i) && (i = ""), r > 0 && (i = webphone_api.common.NormalizeInput2(i, 3), i = webphone_api.common.Trim(i)), webphone_api.common.isNull(a) && (a = ""), r > 0 && (a = webphone_api.common.NormalizeInput2(a, 2), a = webphone_api.common.Trim(a));
            var s = "sip";
            webphone_api.common.IsNumber(o) && (s = "phone");
            return webphone_api.common.PutToDebugLog(2, "EVENT, AddContact name: " + e + "; number: " + o + "; email: " + t + "; address: " + n + "; notes: " + i + "; website: " + a + "; isfromsync: 0"), ue(e, o, "0", s, webphone_api.common.GetTickCount(), t, n, i, a, "0"), !0
        } catch (l) {
            webphone_api.common.PutToDebugLogException(2, "plhandler: AddContact", l)
        }
        return !1
    }

    function ue(e, o, t, n, i, a, r, s, l, p) {
        try {
            webphone_api.common.isNull(webphone_api.global.ctlist) && (webphone_api.global.ctlist = []);
            var c = [];
            c[webphone_api.common.CT_NAME] = e, c[webphone_api.common.CT_NUMBER] = [o], c[webphone_api.common.CT_PTYPE] = [n], c[webphone_api.common.CT_USAGE] = "0", c[webphone_api.common.CT_LASTMODIF] = i, c[webphone_api.common.CT_DELFLAG] = "0", c[webphone_api.common.CT_FAV] = t, c[webphone_api.common.CT_EMAIL] = a, c[webphone_api.common.CT_ADDRESS] = r, c[webphone_api.common.CT_NOTES] = s, c[webphone_api.common.CT_WEBSITE] = l, c[webphone_api.common.CT_LASTACTIVE] = webphone_api.common.GetTickCount().toString(), c[webphone_api.common.CT_ISFROMSYNC] = p;
            for (var u = 0; u < webphone_api.global.ctlist.length; u++) {
                if (webphone_api.global.ctlist[u][webphone_api.common.CT_NUMBER] === o) {
                    webphone_api.global.ctlist.splice(u, 1);
                    break
                }
            }
            webphone_api.global.ctlist.push(c), webphone_api.global.wasCtModified = !0, webphone_api.common.SortContacts()
        } catch (h) {
            webphone_api.common.PutToDebugLogException(2, "plhandler: SaveTheContact", h)
        }
    }

    function he(e, o) {
        try {
            return Vo("DeleteContact"), (webphone_api.common.isNull(e) && (e = ""), e = e.toString(), webphone_api.common.isNull(o) && (o = ""), o = o.toString(), e.length < 0 && o.length < 0) ? (webphone_api.common.PutToDebugLog(2, "ERROR, plhandler DeleteContact invalid name and number"), !1) : (webphone_api.common.isNull(webphone_api.global.ctlist) && (webphone_api.global.ctlist = []), me(e, o), !0)
        } catch (t) {
            webphone_api.common.PutToDebugLogException(2, "plhandler: DeleteContact", t)
        }
        return !1
    }

    function me(e, o) {
        try {
            if (webphone_api.common.isNull(webphone_api.global.ctlist) || webphone_api.global.ctlist.length < 1) return void webphone_api.common.PutToDebugLog(2, "WARNING, plhandler RemoveTheContact no contacts in list");
            if (e.length > 0 && o.length > 0) for (var t = 0; t < webphone_api.global.ctlist.length; t++) {
                var n = webphone_api.global.ctlist[t];
                if (n[webphone_api.common.CT_NAME] === e || n[webphone_api.common.CT_NAME] === o) {
                    webphone_api.global.ctlist.splice(t, 1), webphone_api.global.wasCtModified = !0;
                    break
                }
                for (var i = 0; i < n[webphone_api.common.CT_NUMBER].length; i++) if (n[webphone_api.common.CT_NUMBER][i] === e || n[webphone_api.common.CT_NUMBER][i] === o) {
                    webphone_api.global.ctlist.splice(t, 1), webphone_api.global.wasCtModified = !0;
                    break
                }
            } else if (e.length > 0) for (var t = 0; t < webphone_api.global.ctlist.length; t++) {
                var n = webphone_api.global.ctlist[t];
                if (n[webphone_api.common.CT_NAME] === e) {
                    webphone_api.global.ctlist.splice(t, 1), webphone_api.global.wasCtModified = !0;
                    break
                }
                for (var i = 0; i < n[webphone_api.common.CT_NUMBER].length; i++) if (n[webphone_api.common.CT_NUMBER][i] === e) {
                    webphone_api.global.ctlist.splice(t, 1), webphone_api.global.wasCtModified = !0;
                    break
                }
            } else if (o.length > 0) for (var t = 0; t < webphone_api.global.ctlist.length; t++) {
                var n = webphone_api.global.ctlist[t];
                if (n[webphone_api.common.CT_NAME] === o) {
                    webphone_api.global.ctlist.splice(t, 1), webphone_api.global.wasCtModified = !0;
                    break
                }
                for (var i = 0; i < n[webphone_api.common.CT_NUMBER].length; i++) if (n[webphone_api.common.CT_NUMBER][i] === o) {
                    webphone_api.global.ctlist.splice(t, 1), webphone_api.global.wasCtModified = !0;
                    break
                }
            }
        } catch (a) {
            webphone_api.common.PutToDebugLogException(2, "plhandler: RemoveTheContact", a)
        }
    }

    function ge(e, o) {
        try {
            return Vo("GetContact"), (webphone_api.common.isNull(e) && (e = ""), e = e.toString(), webphone_api.common.isNull(o) && (o = ""), o = o.toString(), e.length < 0 && o.length < 0) ? (webphone_api.common.PutToDebugLog(2, "ERROR, plhandler GetContact invalid name and number"), null) : (webphone_api.common.PutToDebugLog(4, "EVENT, plhandler getcontact with name: " + e + " and number: " + o), webphone_api.common.isNull(webphone_api.global.ctlist) && (webphone_api.global.ctlist = []), function (e, o) {
                try {
                    var t = "";
                    if (e.length > 0) for (var n = 0; n < webphone_api.global.ctlist.length; n++) {
                        var i = webphone_api.global.ctlist[n];
                        i[webphone_api.common.CT_NAME] === e && (t = i[webphone_api.common.CT_NAME] + "\t" + i[webphone_api.common.CT_NUMBER].join("|") + "\t" + i[webphone_api.common.CT_FAV] + "\t" + i[webphone_api.common.CT_EMAIL] + "\t" + i[webphone_api.common.CT_ADDRESS] + "\t" + i[webphone_api.common.CT_NOTES] + "\t" + i[webphone_api.common.CT_WEBSITE])
                    } else if (o.length > 0) for (var n = 0; n < webphone_api.global.ctlist.length; n++) {
                        var i = webphone_api.global.ctlist[n];
                        i[webphone_api.common.CT_NAME] === o && (t = i[webphone_api.common.CT_NAME] + "\t" + i[webphone_api.common.CT_NUMBER].join("|") + "\t" + i[webphone_api.common.CT_FAV] + "\t" + i[webphone_api.common.CT_EMAIL] + "\t" + i[webphone_api.common.CT_ADDRESS] + "\t" + i[webphone_api.common.CT_NOTES] + "\t" + i[webphone_api.common.CT_WEBSITE]);
                        for (var a = 0; a < i[webphone_api.common.CT_NUMBER].length; a++) i[webphone_api.common.CT_NUMBER][a] === o && (t = i[webphone_api.common.CT_NAME] + "\t" + i[webphone_api.common.CT_NUMBER].join("|") + "\t" + i[webphone_api.common.CT_FAV] + "\t" + i[webphone_api.common.CT_EMAIL] + "\t" + i[webphone_api.common.CT_ADDRESS] + "\t" + i[webphone_api.common.CT_NOTES] + "\t" + i[webphone_api.common.CT_WEBSITE])
                    }
                    if (!webphone_api.common.isNull(t)) return t
                } catch (r) {
                    webphone_api.common.PutToDebugLogException(2, "plhandler: FindContactInList", r)
                }
                return null
            }(e, o))
        } catch (t) {
            webphone_api.common.PutToDebugLogException(2, "plhandler: GetContact", t)
        }
        return null
    }

    function de(e) {
        try {
            return Vo("ListContacts"), webphone_api.common.isNull(webphone_api.global.ctlist) && (webphone_api.global.ctlist = []), webphone_api.common.PutToDebugLog(4, "EVENT, plhandler listcontacts called"), function (e) {
                try {
                    for (var o = "", t = 0; t < webphone_api.global.ctlist.length; t++) {
                        var n = webphone_api.global.ctlist[t];
                        if (!1 !== e || "Echo delayed" !== n[webphone_api.common.CT_NAME] && "Echo" !== n[webphone_api.common.CT_NAME] && "Funny" !== n[webphone_api.common.CT_NAME] && "Music" !== n[webphone_api.common.CT_NAME] && "Playback" !== n[webphone_api.common.CT_NAME] && "Record" !== n[webphone_api.common.CT_NAME] && "Redial" !== n[webphone_api.common.CT_NAME] && "Voicemail" !== n[webphone_api.common.CT_NAME]) {
                            !webphone_api.common.isNull(o) && o.length > 0 && (o += "\r\n");
                            for (var i = "", a = 0; a < n[webphone_api.common.CT_NUMBER].length; a++) webphone_api.common.isNull(n[webphone_api.common.CT_NUMBER][a]) || n[webphone_api.common.CT_NUMBER][a].length < 1 || (i.length > 0 && (i += "|"), i += n[webphone_api.common.CT_NUMBER][a]);
                            o += n[webphone_api.common.CT_NAME] + "\t" + i + "\t" + n[webphone_api.common.CT_FAV] + "\t" + n[webphone_api.common.CT_EMAIL] + "\t" + n[webphone_api.common.CT_ADDRESS] + "\t" + n[webphone_api.common.CT_NOTES] + "\t" + n[webphone_api.common.CT_WEBSITE]
                        }
                    }
                    if (!webphone_api.common.isNull(o) && o.length > 0) return o
                } catch (r) {
                    webphone_api.common.PutToDebugLogException(2, "plhandler: BuildCtList", r)
                }
                return null
            }(e)
        } catch (o) {
            webphone_api.common.PutToDebugLogException(2, "plhandler: ListContacts", o)
        }
        return null
    }

    function be() {
        try {
            Vo("ListCallhistory"), webphone_api.common.isNull(webphone_api.global.chlist) && (webphone_api.global.chlist = []), webphone_api.common.PutToDebugLog(4, "EVENT, plhandler listcallhistory called");
            for (var e = "", o = 0; o < webphone_api.global.chlist.length; o++) {
                var t = webphone_api.global.chlist[o];
                !webphone_api.common.isNull(e) && e.length > 0 && (e += "\r\n");
                e += t[webphone_api.common.CH_TYPE] + "\t" + t[webphone_api.common.CH_NAME] + "\t" + t[webphone_api.common.CH_NUMBER] + "\t" + t[webphone_api.common.CH_DATE] + "\t" + t[webphone_api.common.CH_DURATION] + "\t" + t[webphone_api.common.CH_REASON]
            }
            if (!webphone_api.common.isNull(e) && e.length > 0) return e
        } catch (n) {
            webphone_api.common.PutToDebugLogException(2, "plhandler: ListCallhistory", n)
        }
        return null
    }

    function _e(e, o) {
        try {
            if (webphone_api.common.PutToDebugLogSpecial(1, "EVENT, SetParameter user, " + e + ": " + o, !1, ""), Vo("SetParameter: " + e + ": " + o), webphone_api.common.isNull(e) || e.length < 1) return !1;
            if (e = e.toLowerCase(),
                webphone_api.common.isNull(o) && (o = "null"), o = webphone_api.common.Trim(o), 0 === o.indexOf("encrypted__3__") && (o = webphone_api.common.StrDc(o, webphone_api.common.GetPassphrase())), e.indexOf("server") >= 0) {
                if ("YOURSIPDOMAIN.COM" === o || "YOURSIPSERVER.COM" === o || "SIPSERVER" === o || "VOIPSERVER" === o || "SERVERADDRESS" === o) return !1
            } else if (e.indexOf("username") >= 0) {
                if ("USERNAME" === o || "SIPUSERNAME" === o) return !1
            } else if (e.indexOf("password") >= 0) {
                if ("PASSWORD" === o || "SIPPASSWORD" === o || "SIPASSWORD" === o) return !1
            } else if (e.indexOf("callto") >= 0 && ("DESTINATION" === o || "CALLTO" === o)) return !1;
            "webrtcserver" !== e && "webrtcaddress" !== e && "rtcserver" !== e && "rtcaddress" !== e || (e = "webrtcserveraddress");
            try {
                window.location.href.indexOf("isdemopage=true") > 0 && !webphone_api.common.isNull(o) && o.toString().length > 0 && ("sipusername" === e || "username" === e || "password" === e || "sippassword" === e || "serveraddress_user" === e || "serveraddress_orig" === e || "serveraddress" === e || "upperserver" === e || "callto" === e || "destination" === e) && webphone_api.SetCookie("wpdemosett_" + e, o, 365)
            } catch (a) {
                webphone_api.common.PutToDebugLogException(2, "plhandler: SetParameter inner", a)
            }
            var t = o;
            ("password" === e || "sippassword" === e || webphone_api.common.GetParameterInt("loglevel", 1) < 5) && (t = "*****"), webphone_api.common.PutToDebugLogSpecial(1, "EVENT, SetParameter " + e + ": " + t, !1, ""), "serveraddress" === e && o.length > 0 ? webphone_api.common.SaveParameter("serveraddress_user", o) : "theme" === e && o.length > 0 ? webphone_api.common.SaveParameter("colortheme", o) : "colortheme" === e && o.length > 0 && webphone_api.common.SaveParameter("theme", o), webphone_api.common.SaveParameter(e, o), webphone_api.common.isNull(webphone_api.parameters) || webphone_api.common.isNull(webphone_api.parameters[e]) || (webphone_api.parameters[e] = o);
            var n = webphone_api.common.GetParameter("devicetype");
            if (n === webphone_api.common.DEVICE_WIN_SOFTPHONE() || webphone_api.common.getuseengine() === webphone_api.global.ENGINE_SERVICE) return void webphone_api.common.WinAPI("API_SetParameter", null, e, o);
            if (n === webphone_api.common.DEVICE_WEBPHONE()) return webphone_api.webphone.SetParameter(e, o)
        } catch (r) {
            var i = e;
            i = webphone_api.common.isNull(i) ? "" : ": " + i, webphone_api.common.PutToDebugLogException(2, "plhandler: SetParameter" + i, r)
        }
        return !1
    }

    function fe(e) {
        try {
            if (webphone_api.common.isNull(e) || e.length < 1) return null;
            e = e.toLowerCase();
            var o = webphone_api.common.GetParameter(e);
            try {
                if (window.location.href.indexOf("isdemopage=true") > 0 && ("sipusername" === e || "username" === e || "password" === e || "sippassword" === e || "serveraddress_user" === e || "serveraddress_orig" === e || "serveraddress" === e || "upperserver" === e || "callto" === e || "destination" === e)) {
                    var t = webphone_api.GetCookie("wpdemosett_" + e);
                    if (!webphone_api.common.isNull(t) && t.length > 0 && (webphone_api.common.isNull(o) || o.length < 1)) return t
                }
            } catch (n) {
                webphone_api.common.PutToDebugLogException(2, "plhandler: GetParameter inner", n)
            }
            return o
        } catch (i) {
            webphone_api.common.PutToDebugLogException(2, "plhandler: GetParameter", i)
        }
        return null
    }

    function we(e) {
        try {
            if (Vo("SetLine"), webphone_api.common.isNull(e) || e.toString().length < 1) return void webphone_api.common.PutToDebugLog(2, "ERROR, plhandler: SetLine invalid line (1): " + e);
            webphone_api.common.PutToDebugLog(2, "EVENT, USER, setline (API_SetLine), " + e.toString());
            var o = !1, t = -10;
            if (webphone_api.common.IsNumber(e) && e.toString().length < 3) {
                if ((t = webphone_api.common.StrToInt(webphone_api.common.Trim(e))) < -2 || t > 50) return void webphone_api.common.PutToDebugLog(2, "ERROR, plhandler: SetLine invalid line (2): " + e);
                -1 === t && (t = webphone_api.common.GetBestLine())
            }
            if (e = e.toString(), t < -5) {
                o = !0;
                for (var n = 0; n < webphone_api.global.ep.length; n++) if (!webphone_api.common.isNull(webphone_api.global.ep[n])) {
                    var i = webphone_api.global.ep[n][webphone_api.common.EP_DESTNR];
                    !webphone_api.common.isNull(i) && i.length > 1 && e === i && (t = webphone_api.common.StrToInt(webphone_api.global.ep[n][webphone_api.common.EP_LINE]))
                }
            }
            if (t < -5) for (var n = 0; n < webphone_api.global.ep.length; n++) if (!webphone_api.common.isNull(webphone_api.global.ep[n])) {
                var a = webphone_api.global.ep[n][webphone_api.common.EP_CALLID];
                !webphone_api.common.isNull(i) && i.length > 1 && e === a && (t = webphone_api.common.StrToInt(webphone_api.global.ep[n][webphone_api.common.EP_LINE]))
            }
            if (0 === webphone_api.common.IsMultiline()) return void setTimeout(function () {
                var e = [];
                e.push("E"), e.push("R"), e.push("R"), e.push("O"), e.push("R"), e.push(","), e.push("M"), e.push("u"), e.push("l"), e.push("t"), e.push("i"), e.push("l"), e.push("i"), e.push("n"), e.push("e"), e.push(" "), e.push("f"), e.push("e"), e.push("a"), e.push("t"), e.push("u"), e.push("r"), e.push("e"), e.push(" "), e.push("i"), e.push("s"), e.push("d"), e.push("i"), e.push("s"), e.push("a"), e.push("b"), e.push("l"), e.push("e"), e.push("d");
                var o = e.join("");
                webphone_api.common.PutToDebugLog(1, o)
            }, 550);
            if (webphone_api.global.aline = t, !1 === Tt && (webphone_api.common.SaveParameter("multilinegui", "1"), Tt = !0), webphone_api.common.RefreshInfo(), webphone_api.common.getuseengine() === webphone_api.global.ENGINE_WEBRTC) return;
            if (webphone_api.common.getuseengine() === webphone_api.global.ENGINE_FLASH) return void webphone_api.common.PutToDebugLog(2, "WARNING, SetLine method not available for engine: " + webphone_api.common.GetEngineDisplayName(webphone_api.global.useengine));
            if (webphone_api.common.GetParameter("devicetype") === webphone_api.common.DEVICE_WIN_SOFTPHONE() || webphone_api.common.getuseengine() === webphone_api.global.ENGINE_SERVICE) return !0 === o ? webphone_api.common.WinAPI("API_SetLine", null, e) : webphone_api.common.WinAPI("API_SetLine", null, t), void webphone_api.common.SaveParameter("line", t.toString());
            if (webphone_api.common.GetParameter("devicetype") === webphone_api.common.DEVICE_WEBPHONE()) return !0 === o ? webphone_api.webphone.SetLineEx(e) : webphone_api.webphone.SetLine(t), void webphone_api.common.SaveParameter("line", t.toString())
        } catch (r) {
            webphone_api.common.PutToDebugLogException(2, "plhandler: SetLine", r)
        }
        return null
    }

    function ve() {
        var e = webphone_api.global.aline;
        try {
            if (Vo("GetLine"), webphone_api.common.PutToDebugLog(2, "EVENT, USER, getline (API_getLine)"), webphone_api.common.getuseengine() === webphone_api.global.ENGINE_WEBRTC) return e;
            if (webphone_api.common.getuseengine() === webphone_api.global.ENGINE_FLASH) return webphone_api.common.PutToDebugLog(2, "WARNING, GetLine method not available for engine: " + webphone_api.common.GetEngineDisplayName(webphone_api.global.useengine)), e;
            if (webphone_api.common.GetParameter("devicetype") === webphone_api.common.DEVICE_WIN_SOFTPHONE() || webphone_api.common.getuseengine() === webphone_api.global.ENGINE_SERVICE) return e;
            if (webphone_api.common.GetParameter("devicetype") === webphone_api.common.DEVICE_WEBPHONE()) return webphone_api.global.aline = webphone_api.webphone.GetLine(), webphone_api.global.aline
        } catch (o) {
            webphone_api.common.PutToDebugLogException(2, "plhandler: GetLine", o)
        }
        return e
    }

    function Ee(e, o) {
        try {
            if (Vo("LineToCallID"), webphone_api.common.PutToDebugLog(2, "EVENT, USER, linetocallid (API_LineToCallID)"), webphone_api.common.isNull(e) || !webphone_api.common.IsNumber(e)) return void o("ERROR, linetocallid: Invalid line");
            if (webphone_api.common.getuseengine() === webphone_api.global.ENGINE_WEBRTC) return void o(webphone_api.webrtcapi.LineToCallID(e));
            if (webphone_api.common.getuseengine() === webphone_api.global.ENGINE_FLASH) return webphone_api.common.PutToDebugLog(2, "WARNING, LineToCallID method not available for engine: " + webphone_api.common.GetEngineDisplayName(webphone_api.global.useengine)), "";
            if (webphone_api.common.GetParameter("devicetype") === webphone_api.common.DEVICE_WIN_SOFTPHONE() || webphone_api.common.getuseengine() === webphone_api.global.ENGINE_SERVICE) return void webphone_api.common.WinAPI("API_LineToCallID", function (e) {
                o(e)
            }, e);
            if (webphone_api.common.GetParameter("devicetype") === webphone_api.common.DEVICE_WEBPHONE()) return void o(webphone_api.webphone.LineToCallID(e))
        } catch (t) {
            webphone_api.common.PutToDebugLogException(2, "plhandler: LineToCallID", t)
        }
    }

    function Te(e, o) {
        try {
            if (Vo("CallIDToLine"), webphone_api.common.PutToDebugLog(2, "EVENT, USER, callidtoline (API_CallIDToLine)"), webphone_api.common.isNull(e) || e.length < 1) return void o("ERROR, CallIDToLine: Invalid callid");
            if (webphone_api.common.getuseengine() === webphone_api.global.ENGINE_WEBRTC) return void o(webphone_api.webrtcapi.CallIDToLine(e));
            if (webphone_api.common.getuseengine() === webphone_api.global.ENGINE_FLASH) return webphone_api.common.PutToDebugLog(2, "WARNING, CallIDToLine method not available for engine: " + webphone_api.common.GetEngineDisplayName(webphone_api.global.useengine)), "";
            if (webphone_api.common.GetParameter("devicetype") === webphone_api.common.DEVICE_WIN_SOFTPHONE() || webphone_api.common.getuseengine() === webphone_api.global.ENGINE_SERVICE) return void webphone_api.common.WinAPI("API_CallIDToLine", function (e) {
                o(e)
            }, e);
            if (webphone_api.common.GetParameter("devicetype") === webphone_api.common.DEVICE_WEBPHONE()) return void o(webphone_api.webphone.CallIDToLine(e))
        } catch (t) {
            webphone_api.common.PutToDebugLogException(2, "plhandler: CallIDToLine", t)
        }
    }

    function Pe(e) {
        try {
            var o = -5;
            if (!webphone_api.common.isNull(e) && webphone_api.common.IsNumber(e) && (o = webphone_api.common.StrToInt(e)), o < 1 && (o = webphone_api.common.GetBestLine()), webphone_api.common.getuseengine() === webphone_api.global.ENGINE_WEBPHONE) {
                var t = webphone_api.webphone.GetLineDetails(o);
                if (!webphone_api.common.isNull(t) && t.length > 0) {
                    var n = t.split(",");
                    if (!webphone_api.common.isNull(n) && n.length > 0) {
                        t = "";
                        for (var i = 0; i < n.length; i++) webphone_api.common.isNull(n[i]) && (n[i] = ""), n[i] = webphone_api.common.Trim(n[i]), 0 === n[i].indexOf("_BASE64_") && (n[i] = webphone_api.common.B64Dec(n[i]), webphone_api.common.isNull(n[i]) && (n[i] = ""), n[i] = webphone_api.common.Trim(n[i])), t.length > 0 && (t += ","), t += n[i]
                    }
                }
                return t
            }
            var a = o.toString(), r = "Unused line", s = "", l = "", p = "", c = "-1",
                u = webphone_api.common.GetParameter("serveraddress_user"), h = "", m = "false", g = "false", d = "",
                b = webphone_api.common.GetTickCount(), _ = webphone_api.global.lnstat[o];
            if (!webphone_api.common.isNull(_) && _.length > 1) {
                var f = webphone_api.common.GetConfigInt("registerinterval", 0);
                f < 1 && (f = 90), f *= 6e4, !webphone_api.common.isNull(_[0]) && webphone_api.common.IsNumber(_[0]) && b - _[0] <= f && !webphone_api.common.isNull(_[1] && _[1].length) && (r = _[1])
            }
            var w = webphone_api.common.GetEndpoint(o, "", "", !1);
            !webphone_api.common.isNull(w) && w.length > 2 && (s = w[webphone_api.common.EP_CALLID], l = w[webphone_api.common.EP_DESTNR], p = webphone_api.common.GetSipusername(), c = w[webphone_api.common.EP_INCOMING], u = webphone_api.common.GetParameter("serveraddress_user"), h = "", m = w[webphone_api.common.EP_MUTESTATE], g = w[webphone_api.common.EP_HOLDSTATE], d = "");
            var v = "LINEDETAILS," + a + "," + r + "," + s + "," + l + "," + p + "," + c + "," + u + "," + h + "," + m + "," + g + "," + d;
            return webphone_api.common.PutToDebugLog(4, "EVENT, GetLineDetails user: " + v), v
        } catch (E) {
            webphone_api.common.PutToDebugLogException(2, "plhandler: GetLineDetails", E)
        }
        return ""
    }

    function Se() {
        try {
            Vo("GetLastCallDetails");
            var e = webphone_api.global.lastcalldetails;
            if (webphone_api.common.isNull(e) && (e = ""), e = webphone_api.common.Trim(e), webphone_api.global.phonestarted < 2) return void Wo("GetLastCallDetails", []);
            if (webphone_api.common.getuseengine() === webphone_api.global.ENGINE_WEBRTC || webphone_api.common.getuseengine() === webphone_api.global.ENGINE_FLASH) return e;
            if (webphone_api.common.GetParameter("devicetype") === webphone_api.common.DEVICE_WIN_SOFTPHONE() || webphone_api.common.getuseengine() === webphone_api.global.ENGINE_SERVICE) return e;
            if (webphone_api.common.getuseengine() === webphone_api.global.ENGINE_FLASH) return e;
            if (webphone_api.common.GetParameter("devicetype") === webphone_api.common.DEVICE_WEBPHONE()) return webphone_api.webphone.GetLastCallDetails()
        } catch (o) {
            webphone_api.common.PutToDebugLogException(2, "plhandler: GetLastCallDetails", o)
        }
        return ""
    }

    function Ne(e) {
        try {
            if (Vo("GetIcomingDisplay"), !e || "function" != typeof e) return void webphone_api.common.PutToDebugLog(2, "ERROR, plhandler: GetIncomingDisplay callback is not definaed");
            if (webphone_api.global.phonestarted < 2) return void Wo("GetIncomingDisplay", [e]);
            if (webphone_api.common.getuseengine() === webphone_api.global.ENGINE_WEBRTC) return void e(webphone_api.common.GetWebrtcDisplayName());
            if (webphone_api.common.getuseengine() === webphone_api.global.ENGINE_FLASH) return void e("");
            if (webphone_api.common.GetParameter("devicetype") === webphone_api.common.DEVICE_WIN_SOFTPHONE() || webphone_api.common.getuseengine() === webphone_api.global.ENGINE_SERVICE) return void webphone_api.common.WinAPI("API_GetIncomingDisplay", function (o) {
                webphone_api.common.isNull(o) && (o = ""), o = webphone_api.common.Trim(o), 0 === o.indexOf("_BASE64_") && (o = webphone_api.common.B64Dec(o), webphone_api.common.isNull(o) && (o = ""), o = webphone_api.common.Trim(o)), e(o)
            });
            if (webphone_api.common.GetParameter("devicetype") === webphone_api.common.DEVICE_WEBPHONE()) {
                var o = webphone_api.webphone.GetIncomingDisplay();
                return webphone_api.common.isNull(o) && (o = ""), o = webphone_api.common.Trim(o), 0 === o.indexOf("_BASE64_") && (o = webphone_api.common.B64Dec(o), webphone_api.common.isNull(o) && (o = ""), o = webphone_api.common.Trim(o)), void e(o)
            }
        } catch (t) {
            webphone_api.common.PutToDebugLogException(2, "plhandler: GetIncomingDisplay", t)
        }
        return ""
    }

    function Ie() {
        try {
            webphone_api.global.printwad_called = !1, webphone_api.common.PutToDebugLog(2, "EVENT, USER, API_Unregister"), webphone_api.global.authenticated_displayed = !1, webphone_api.global.dispSaveSettMsg = 0, webphone_api.global.pres_unreg_called = !0, webphone_api.global.last_presence_enabled = webphone_api.common.UsePresence2(), webphone_api.global.onregisteredcalled = !1;
            var e = webphone_api.global.dispregfailed;
            if (webphone_api.global.dispregfailed = 2, setTimeout(function () {
                webphone_api.global.dispregfailed = e
            }, 500), !1 === webphone_api.global.onunregistered_flag) {
                webphone_api.global.onunregistered_flag = !0, setTimeout(function () {
                    webphone_api.global.onunregistered_flag = !1
                }, 2e3);
                try {
                    webphone_api.onRegStateChangeCb("unregistered", null)
                } catch (t) {
                    webphone_api.common.PutToDebugLogException(2, "plhandler: There is an error in onUnRegistered(unregistered) callback", t)
                }
                try {
                    webphone_api.onUnRegisteredCb()
                } catch (t) {
                    webphone_api.common.PutToDebugLogException(2, "plhandler: There is an error in onUnRegistered() callback", t)
                }
            }
            var o = webphone_api.common.getuseengine();
            if ((webphone_api.common.isNull(o) || o.length < 1) && (o = webphone_api.global.last_useengine), o === webphone_api.global.ENGINE_WEBRTC) return webphone_api.flagrestartwebrtc = !1, webphone_api.webrtcapi.SipUnRegister(), webphone_api.common.Wsunreg(), void (webphone_api.global.phonestarted = 2);
            if (webphone_api.common.GetParameter("devicetype") === webphone_api.common.DEVICE_WIN_SOFTPHONE() || o === webphone_api.global.ENGINE_SERVICE) return webphone_api.common.WinAPI("API_Unregister", null), void (webphone_api.global.phonestarted = 2);
            if (o === webphone_api.global.ENGINE_FLASH) return webphone_api.flashapi.Logout(null), void (webphone_api.global.phonestarted = 2);
            if (o === webphone_api.global.ENGINE_WEBPHONE) return webphone_api.webphone.Unregister(), void (webphone_api.global.phonestarted = 2)
        } catch (t) {
            webphone_api.common.PutToDebugLogException(2, "plhandler: Unregister", t)
        }
    }

    function Ce(e) {
        try {
            return webphone_api.global.onregisteredcalled = !1, e === webphone_api.global.ENGINE_WEBRTC ? (!0 === webphone_api.global.checkIfInCall && (webphone_api.common.PutToDebugLog(3, "EVENT, Window.OnUnload close or refresh: hangup active call_1: " + e), webphone_api.webrtcapi.SipHangup(!1, -2)), webphone_api.flagrestartwebrtc = !1, webphone_api.webrtcapi.SipStop(), webphone_api.common.Wsunreg(), void (webphone_api.global.phonestarted = 2)) : e === webphone_api.global.ENGINE_FLASH ? (!0 === webphone_api.global.checkIfInCall && (webphone_api.common.PutToDebugLog(3, "EVENT, Window.OnUnload close or refresh: hangup active call_2: " + e), webphone_api.flashapi.Hangup()), webphone_api.flashapi.Logout(null), void (webphone_api.global.phonestarted = 2)) : e === webphone_api.global.ENGINE_WEBPHONE ? (!0 === webphone_api.global.checkIfInCall && (webphone_api.common.PutToDebugLog(3, "EVENT, Window.OnUnload close or refresh: hangup active call_3: " + e), webphone_api.webphone.Hangup(-2)), webphone_api.webphone.Unregister(), void (webphone_api.global.phonestarted = 2)) : (!0 === webphone_api.global.checkIfInCall || webphone_api.common.WinAPI("API_Unregister", null), void (webphone_api.global.phonestarted = 2))
        } catch (o) {
            webphone_api.common.PutToDebugLogException(2, "plhandler: UnregisterEngine", o)
        }
    }

    function Re() {
        try {
            if (Vo("HTTPKeepAlive"), webphone_api.common.PutToDebugLog(5, "EVENT, httpkeepalive (API_HTTPKeepAlive)"), webphone_api.global.useengine !== webphone_api.global.ENGINE_WEBPHONE) return;
            return webphone_api.webphone.HTTPKeepAlive()
        } catch (e) {
            webphone_api.common.PutToDebugLogException(2, "plhandler: HTTPKeepAlive", e)
        }
    }

    function ye() {
        Vo("IsRegistered");
        try {
            if (webphone_api.common.getuseengine() === webphone_api.global.ENGINE_WEBPHONE) {
                var e = webphone_api.webphone.IsRegistered();
                return webphone_api.common.PutToDebugLog(2, "EVENT, USER, API_IsRegistered: wp " + e.toString()), e
            }
            if (webphone_api.global.phonestarted > 2) return webphone_api.common.PutToDebugLog(2, "EVENT, USER, API_IsRegistered: true"), !0;
            webphone_api.common.PutToDebugLog(2, "EVENT, USER, isregistered (API_IsRegistered)")
        } catch (o) {
            webphone_api.common.PutToDebugLogException(2, "plhandler: IsRegistered", o)
        }
        return !1
    }

    function Le() {
        Vo("IsInCall");
        try {
            webphone_api.common.PutToDebugLog(4, "EVENT, isincall: " + webphone_api.global.checkIfInCall.toString())
        } catch (e) {
            webphone_api.common.PutToDebugLogException(2, "plhandler: IsInCall", e)
        }
        return webphone_api.global.checkIfInCall
    }

    function De(e, o, t) {
        try {
            if (!0 !== t) {
                if (Vo("GetDeviceList"), !o || "function" != typeof o) return void webphone_api.common.PutToDebugLog(2, "ERROR, plhandler: GetDeviceList callback is not defined");
                Pt.push(e), St.push(o)
            }
            if (webphone_api.common.getuseengine().length < 1 && webphone_api.global.phonestarted < 2) return webphone_api.common.isNull(Nt) || clearTimeout(Nt), Nt = null, void (Nt = setTimeout(function () {
                De(Pt[0], null, !0)
            }, 250));
            if (webphone_api.common.isNull(Nt) || clearTimeout(Nt), Nt = null, webphone_api.common.GetParameter("devicetype") === webphone_api.common.DEVICE_WIN_SOFTPHONE() || webphone_api.common.getuseengine() === webphone_api.global.ENGINE_SERVICE) return void webphone_api.common.WinAPI("API_GetAudioDeviceList", function (e) {
                var o = St.shift(), t = Pt.shift();
                webphone_api.common.isNull(e) && (e = ""), e = webphone_api.common.Trim(e), 0 === e.indexOf("_BASE64_") && (e = webphone_api.common.B64Dec(e), webphone_api.common.isNull(e) && (e = ""), e = webphone_api.common.Trim(e)), 0 == t ? (webphone_api.global.audio_rec_device_list = e, webphone_api.common.SaveParameter("cache_audio_rec_device_list", e), o(e)) : 1 == t ? (webphone_api.global.audio_play_device_list = e, webphone_api.common.SaveParameter("cache_audio_play_device_list", e), o(e)) : 2 == t ? (!webphone_api.common.isNull(e) && e.length > 0 && e.indexOf("\r\nAll") < 1 && (e += "\r\nAll"), webphone_api.global.audio_ring_device_list = e, webphone_api.common.SaveParameter("cache_audio_ring_device_list", e), o(e)) : (webphone_api.global.video_rec_device_list = e, webphone_api.common.SaveParameter("cache_video_rec_device_list", e), o(e)), !webphone_api.common.isNull(St) && St.length > 0 && setTimeout(function () {
                    De(Pt[0], null, !0)
                }, 100)
            }, e);
            if (webphone_api.common.getuseengine() === webphone_api.global.ENGINE_WEBPHONE) {
                var n = "", i = Pt.shift();
                n = webphone_api.webphone.GetAudioDeviceList(e), webphone_api.common.isNull(n) && (n = ""), n = webphone_api.common.Trim(n), 0 === n.indexOf("_BASE64_") && (n = webphone_api.common.B64Dec(n), webphone_api.common.isNull(n) && (n = ""), n = webphone_api.common.Trim(n)), 0 == i ? (webphone_api.global.audio_rec_device_list = n, webphone_api.common.SaveParameter("cache_audio_rec_device_list", n)) : 1 == i ? (webphone_api.global.audio_play_device_list = n, webphone_api.common.SaveParameter("cache_audio_play_device_list", n)) : 2 == i ? (!webphone_api.common.isNull(n) && n.length > 0 && n.indexOf("\r\nAll") < 1 && (n += "\r\nAll"), webphone_api.global.audio_ring_device_list = n, webphone_api.common.SaveParameter("cache_audio_ring_device_list", n)) : (webphone_api.global.video_rec_device_list = n, webphone_api.common.SaveParameter("cache_video_rec_device_list", n));
                var a = St.shift();
                return a(n), void (!webphone_api.common.isNull(St) && St.length > 0 && setTimeout(function () {
                    De(Pt[0], null, !0)
                }, 100))
            }
            if (webphone_api.common.getuseengine() === webphone_api.global.ENGINE_WEBRTC) {
                var n = "", i = Pt.shift();
                0 == i ? (n = webphone_api.webrtcapi.GetAudioDeviceList(e), webphone_api.global.audio_rec_device_list = n, webphone_api.common.SaveParameter("cache_audio_rec_device_list", n)) : 1 == i ? (n = webphone_api.webrtcapi.GetAudioDeviceList(e), webphone_api.global.audio_play_device_list = n, webphone_api.common.SaveParameter("cache_audio_play_device_list", n)) : 2 == i ? (n = webphone_api.webrtcapi.GetAudioDeviceList(e), webphone_api.global.audio_ring_device_list = n, webphone_api.common.SaveParameter("cache_audio_ring_device_list", n)) : (n = webphone_api.webrtcapi.GetAudioDeviceList(e), webphone_api.global.video_rec_device_list = n, webphone_api.common.SaveParameter("cache_video_rec_device_list", n));
                var a = St.shift();
                return a(n), void (!webphone_api.common.isNull(St) && St.length > 0 && setTimeout(function () {
                    De(Pt[0], null, !0)
                }, 100))
            }
            var a = St.shift();
            Pt.shift(), a("ERROR, Cannot get device list because no engine is started at the moment")
        } catch (r) {
            webphone_api.common.PutToDebugLogException(2, "plhandler: GetDeviceList", r)
        }
    }

    function Ge(e, o, t) {
        try {
            if (!0 !== t) {
                if (Vo("GetDevice"), !o || "function" != typeof o) return void webphone_api.common.PutToDebugLog(2, "ERROR, plhandler: GetDevice callback is not defined");
                It.push(e), Ct.push(o)
            }
            if (webphone_api.common.getuseengine().length < 1 || webphone_api.global.phonestarted < 2) return webphone_api.common.isNull(Rt) || clearTimeout(Rt), Rt = null, void (Rt = setTimeout(function () {
                Ge(It[0], null, !0)
            }, 250));
            if (webphone_api.common.isNull(Rt) || clearTimeout(Rt), Rt = null, webphone_api.common.GetParameter("devicetype") === webphone_api.common.DEVICE_WIN_SOFTPHONE() || webphone_api.common.getuseengine() === webphone_api.global.ENGINE_SERVICE) return void webphone_api.common.WinAPI("API_GetAudioDevice", function (e) {
                var o = It.shift();
                webphone_api.common.isNull(e) && (e = ""), e = webphone_api.common.Trim(e), 0 === e.indexOf("_BASE64_") && (e = webphone_api.common.B64Dec(e), webphone_api.common.isNull(e) && (e = ""), e = webphone_api.common.Trim(e)), 0 == o ? (webphone_api.global.audio_rec_curr_device = e, webphone_api.common.SaveParameter("cache_audio_rec_curr_device", e)) : 1 == o ? (webphone_api.global.audio_play_curr_device = e, webphone_api.common.SaveParameter("cache_audio_play_curr_device", e)) : 2 == o ? (webphone_api.global.audio_ring_curr_device = e, webphone_api.common.SaveParameter("cache_audio_ring_curr_device", e)) : (webphone_api.global.video_rec_curr_device = e, webphone_api.common.SaveParameter("cache_video_rec_curr_device", e));
                var t = Ct.shift();
                webphone_api.common.PutToDebugLog(4, "EVENT, GetDevice (1), res: " + e), t(e), !webphone_api.common.isNull(Ct) && Ct.length > 0 && setTimeout(function () {
                    Ge(It[0], null, !0)
                }, 100)
            }, e);
            if (webphone_api.common.getuseengine() === webphone_api.global.ENGINE_WEBPHONE) {
                var n = "", i = It.shift();
                n = webphone_api.webphone.GetAudioDevice(e), webphone_api.common.isNull(n) && (n = ""), n = webphone_api.common.Trim(n), 0 === n.indexOf("_BASE64_") && (n = webphone_api.common.B64Dec(n), webphone_api.common.isNull(n) && (n = ""), n = webphone_api.common.Trim(n)), 0 == i ? (webphone_api.global.audio_rec_curr_device = n, webphone_api.common.SaveParameter("cache_audio_rec_curr_device", n)) : 1 == i ? (webphone_api.global.audio_play_curr_device = n, webphone_api.common.SaveParameter("cache_audio_play_curr_device", n)) : 2 == i ? (webphone_api.global.audio_ring_curr_device = n, webphone_api.common.SaveParameter("cache_audio_ring_curr_device", n)) : (webphone_api.global.video_rec_curr_device = n, webphone_api.common.SaveParameter("cache_video_rec_curr_device", n));
                var a = Ct.shift();
                return webphone_api.common.PutToDebugLog(4, "EVENT, GetDevice (2), dev: " + i + "; res: " + n), a(n), void (!webphone_api.common.isNull(Ct) && Ct.length > 0 && setTimeout(function () {
                    Ge(It[0], null, !0)
                }, 100))
            }
            if (webphone_api.common.getuseengine() === webphone_api.global.ENGINE_WEBRTC) {
                var n = "", i = It.shift();
                0 == i ? (n = webphone_api.webrtcapi.GetAudioDevice(e), webphone_api.global.audio_rec_curr_device = n, webphone_api.common.SaveParameter("cache_audio_rec_curr_device", n)) : 1 == i ? (n = webphone_api.webrtcapi.GetAudioDevice(e), webphone_api.global.audio_play_curr_device = n, webphone_api.common.SaveParameter("cache_audio_play_curr_device", n)) : 2 == i ? (n = webphone_api.webrtcapi.GetAudioDevice(e), webphone_api.global.audio_ring_curr_device = n, webphone_api.common.SaveParameter("cache_audio_ring_curr_device", n)) : (n = webphone_api.webrtcapi.GetAudioDevice(e), webphone_api.global.video_rec_curr_device = n, webphone_api.common.SaveParameter("cache_video_rec_curr_device", n));
                var a = Ct.shift();
                return webphone_api.common.PutToDebugLog(4, "EVENT, GetDevice (3), dev: " + i + "; res: " + n), a(n), void (!webphone_api.common.isNull(Ct) && Ct.length > 0 && setTimeout(function () {
                    Ge(It[0], null, !0)
                }, 100))
            }
        } catch (r) {
            webphone_api.common.PutToDebugLogException(2, "plhandler: GetDevice", r)
        }
    }

    function Oe(e, o, t, n, i) {
        try {
            if (!0 !== i && (Vo("SetDevice"), yt.push(e), Lt.push(o), Dt.push(t), Gt.push(n)), webphone_api.common.getuseengine().length < 1 || webphone_api.global.phonestarted < 2) return webphone_api.common.isNull(Ot) || clearTimeout(Ot), Ot = null, void (Ot = setTimeout(function () {
                Oe(null, null, null, null, !0)
            }, 250));
            if (webphone_api.common.isNull(Ot) || clearTimeout(Ot), Ot = null, null === e && !webphone_api.common.isNull(yt) && yt.length > 0 && (e = yt.shift(), o = Lt.shift(), t = Dt.shift(), n = Gt.shift()), null === e && null === o) return;
            if (webphone_api.common.PutToDebugLog(4, "EVENT, setdevice, dev: " + e + "; devicename: " + o + "; immediate: " + t), webphone_api.common.GetParameter("devicetype") === webphone_api.common.DEVICE_WIN_SOFTPHONE() || webphone_api.common.getuseengine() === webphone_api.global.ENGINE_SERVICE) return webphone_api.common.WinAPI("API_SetAudioDevice", null, e, o, t), void (!webphone_api.common.isNull(yt) && yt.length > 0 && setTimeout(function () {
                Oe(null, null, null, null)
            }, 100));
            if (webphone_api.common.getuseengine() === webphone_api.global.ENGINE_WEBPHONE) return webphone_api.webphone.SetAudioDevice(e, o, t), !webphone_api.common.isNull(yt) && yt.length > 0 && setTimeout(function () {
                Oe(null, null, null, null)
            }, 100), !0;
            if (webphone_api.common.getuseengine() === webphone_api.global.ENGINE_WEBRTC) return webphone_api.webrtcapi.SetAudioDevice(e, o, n), !webphone_api.common.isNull(yt) && yt.length > 0 && setTimeout(function () {
                Oe(null, null, null, null)
            }, 100), !0
        } catch (a) {
            webphone_api.common.PutToDebugLogException(2, "plhandler: SetDevice", a)
        }
    }

    function xe(e, o) {
        try {
            if (webphone_api.global.isappenginestarted = !1, (webphone_api.common.isNull(e) || e.length < 1) && (e = webphone_api.common.getuseengine()), (webphone_api.common.isNull(e) || e.length < 1) && (e = webphone_api.global.last_useengine), webphone_api.common.isNull(e) || e.length < 1) return void webphone_api.common.PutToDebugLog(2, "ERROR, plhandler: StopEngine engine is not defined");
            webphone_api.global.webrtc_regstate = 0, webphone_api.common.PutToDebugLog(2, "EVENT, USER, stopengine (API_StopEngine)");
            if (!1 === webphone_api.common.GetParameterBool("needunregister", !0) && !0 !== o) return void webphone_api.common.PutToDebugLog(2, "EVENT, API_StopEngine needunregister is FALSE");
            if (webphone_api.common.Glsp()) {
                if (e === webphone_api.global.ENGINE_SERVICE) return webphone_api.global.apistartstate = 0, webphone_api.global.apistarttick = 0, webphone_api.global.wnotstartedsession = !1, void (!1 === webphone_api.common.NSMacLinEnabled() && webphone_api.common.WinAPI("API_Exit", null));
                if (e === webphone_api.global.ENGINE_WEBPHONE) return webphone_api.global.apistartstate = 0, webphone_api.global.apistarttick = 0, webphone_api.global.wnotstartedsession = !1, webphone_api.webphone.Exit()
            }
        } catch (t) {
            webphone_api.common.PutToDebugLogException(2, "plhandler: StopEngine", t)
        }
    }

    function Ae(e) {
        try {
            webphone_api.common.PutToDebugLog(2, "EVENT, USER, API_Stop"), webphone_api.flagrestartwebrtc = !1, webphone_api.global.laststarttick = 0, webphone_api.global.webrtc_regstate = 0, webphone_api.global.apistartstate = 0, webphone_api.global.apistarttick = 0, webphone_api.global.wnotstartedsession = !1, webphone_api.global.isappenginestarted = !1, setTimeout(function () {
                xe(webphone_api.common.getuseengine(), e)
            }, 900), setTimeout(function () {
                webphone_api.common.isNull(webphone_api.global.maintimerid) || (clearInterval(webphone_api.global.maintimerid), webphone_api.global.maintimerid = null, webphone_api.common.isNull(webphone_api.global.initcalled) || (webphone_api.global.initcalled = !1)), webphone_api.global.apistartstate = 0, webphone_api.global.apistarttick = 0, webphone_api.global.wnotstartedsession = !1
            }, 1100), setTimeout(function () {
                try {
                    webphone_api.onAppStateChangeCb("stopped")
                } catch (e) {
                    webphone_api.common.PutToDebugLogException(2, "plhandler: There is an error in onAppStateChange(stopped) callback", e)
                }
                try {
                    webphone_api.onStopCb()
                } catch (e) {
                    webphone_api.common.PutToDebugLogException(2, "There is an error in onStop() callback", e)
                }
            }, 1250), webphone_api.common.isNull(webphone_api.global.serviceStatusPollTimer) || clearInterval(webphone_api.global.serviceStatusPollTimer), webphone_api.common.isNull(webphone_api.global.polltimerid) || clearInterval(webphone_api.global.polltimerid), webphone_api.common.isNull(webphone_api.global.worktimer) || clearTimeout(webphone_api.global.worktimer), webphone_api.global.worktimer = null;
            if (!1 === webphone_api.common.GetParameterBool("needunregister", !0) && !0 !== e) return void webphone_api.common.PutToDebugLog(2, "EVENT, API_Stop needunregister is FALSE");
            webphone_api.common.Glsp() && (webphone_api.common.getuseengine() === webphone_api.global.ENGINE_WEBRTC ? webphone_api.global.phonestarted > 2 && (webphone_api.webrtcapi.SipStop(), webphone_api.common.Wsunreg()) : webphone_api.common.GetParameter("devicetype") === webphone_api.common.DEVICE_WIN_SOFTPHONE() || webphone_api.common.getuseengine() === webphone_api.global.ENGINE_SERVICE ? !1 === webphone_api.common.NSMacLinEnabled() && webphone_api.common.WinAPI("API_Exit", null) : webphone_api.common.getuseengine() === webphone_api.global.ENGINE_WEBPHONE && webphone_api.webphone.Exit())
        } catch (o) {
            webphone_api.common.PutToDebugLogException(2, "plhandler: Stop", o)
        }
        webphone_api.global.phonestarted = 0
    }

    function ke(e) {
        try {
            if (Vo("SendChatIsComposing"), webphone_api.common.isNull(e) || e.lebgth < 1) return void webphone_api.common.PutToDebugLog(2, "ERROR, SendChatIsComposing invalid destination");
            var o = webphone_api.global.aline;
            if ((webphone_api.common.isNull(o) || -3 === o) && (o = -1), webphone_api.common.GetParameter("devicetype") === webphone_api.common.DEVICE_WIN_SOFTPHONE() || webphone_api.common.getuseengine() === webphone_api.global.ENGINE_SERVICE) return void webphone_api.common.WinAPI("API_SendChatIsComposing", null, o, e);
            if (webphone_api.common.getuseengine() === webphone_api.global.ENGINE_WEBPHONE) return webphone_api.webphone.SendChatIsComposing(o, e)
        } catch (t) {
            webphone_api.common.PutToDebugLogException(2, "plhandler: SendChatIsComposing", t)
        }
    }

    function Ue() {
        return webphone_api.common.BrowserWindowIsActive()
    }

    function Ve() {
        try {
            return Vo("HelpWindow"), webphone_api.common.PutToDebugLog(2, "EVENT, USER, helpwindow (API_HelpWindow)"), webphone_api.common.HelpWindow()
        } catch (e) {
            webphone_api.common.PutToDebugLogException(2, "plhandler: HelpWindow", e)
        }
        return !1
    }

    function We() {
        try {
            return Vo("SettingsPage"), webphone_api.common.PutToDebugLog(2, "EVENT, USER, settingspage (API_SettingsPage)"), webphone_api.common.OpenSettings(!0, 9), !0
        } catch (e) {
            webphone_api.common.PutToDebugLogException(2, "plhandler: SettingsPage", e)
        }
        return !1
    }

    function Me() {
        try {
            return Vo("DialPage"), webphone_api.common.PutToDebugLog(2, "EVENT, USER, dialpage (API_DialPage)"), webphone_api.$.mobile.changePage("#page_dialpad", {
                transition: "pop",
                role: "page"
            }), !0
        } catch (e) {
            webphone_api.common.PutToDebugLogException(2, "plhandler: DialPage", e)
        }
        return !1
    }

    function Fe() {
        try {
            return Vo("MessageInboxPage"), webphone_api.common.PutToDebugLog(2, "EVENT, USER, messageinboxpage (API_MessageInboxPage)"), webphone_api.$.mobile.changePage("#page_messagelist", {
                transition: "none",
                role: "page"
            }), !0
        } catch (e) {
            webphone_api.common.PutToDebugLogException(2, "plhandler: MessageInboxPage", e)
        }
        return !1
    }

    function He() {
        try {
            return Vo("MessagePage"), webphone_api.common.PutToDebugLog(2, "EVENT, USER, messagepage (API_MessagePage)"), webphone_api.global.intentmsg[0] = "action=", webphone_api.global.intentmsg[1] = "to=", webphone_api.global.intentmsg[2] = "message=", webphone_api.$.mobile.changePage("#page_message", {
                transition: "none",
                role: "page"
            }), !0
        } catch (e) {
            webphone_api.common.PutToDebugLogException(2, "plhandler: MessagePage", e)
        }
        return !1
    }

    function Be() {
        try {
            return Vo("AddContactPage"), webphone_api.common.PutToDebugLog(2, "EVENT, USER, addcontactpage (API_AddContactPage)"), webphone_api.global.intentaddeditct[0] = "action=add", webphone_api.$.mobile.changePage("#page_addeditcontact", {
                transition: "pop",
                role: "page"
            }), !0
        } catch (e) {
            webphone_api.common.PutToDebugLogException(2, "plhandler: AddContactPage", e)
        }
        return !1
    }

    function je(e) {
        try {
            webphone_api.webphone.InsertApplet(e)
        } catch (o) {
            webphone_api.common.PutToDebugLogException(2, "plhandler: InsertApplet", o)
        }
    }

    function $e() {
        try {
            return webphone_api.common.EnterKeyPress()
        } catch (e) {
            webphone_api.common.PutToDebugLogException(2, "plhandler: EnterKeyPress", e)
        }
        return !1
    }

    function qe(e) {
        Z(e, "FILETRANSFER_DELIVERED:" + e)
    }

    function ze(e, o) {
        try {
            if (Vo("GetTelSearchName"), !o || "function" != typeof o) return void webphone_api.common.PutToDebugLog(2, "ERROR, plhandler: GetTelsearchName callback is not definaed");
            if (webphone_api.common.isNull(e) || e.length < 2) return void webphone_api.common.PutToDebugLog(2, "ERROR, plhandler: GetTelsearchName invalid number: " + e);
            webphone_api.common.GetTelsearchName(e, o)
        } catch (t) {
            webphone_api.common.PutToDebugLogException(2, "plhandler: EnterKeyPress", t)
        }
    }

    function Ke(e) {
        try {
            webphone_api.common.bwanswer(e)
        } catch (o) {
            webphone_api.common.PutToDebugLogException(2, "plhandler: bwanswer", o)
        }
    }

    function Xe() {
        try {
            webphone_api.global.wasSettModified && webphone_api.common.SaveSettingsFile(webphone_api.common.GetActiveAccSettingsFilename(), function (e) {
                e ? webphone_api.common.PutToDebugLog(2, "EVENT, SaveSettingsFile from onappexit Successfull") : webphone_api.common.PutToDebugLog(2, "ERROR, SaveSettingsFile from onappexit Failed")
            })
        } catch (e) {
            webphone_api.common.PutToDebugLogException(2, "plhandler: onappexit", e)
        }
    }

    function Je() {
        Vo("getlogs"), webphone_api.common.PutToDebugLog(2, "EVENT, getlogs called");
        var e = webphone_api.global.logs;
        return webphone_api.global.logs = "", e
    }

    function Ye() {
        try {
            Vo("getlogsex"), webphone_api.common.PutToDebugLog(2, "EVENT, getlogsex called"), webphone_api.common.WinAPI("API_SetLogs", null, webphone_api.global.logs)
        } catch (e) {
            webphone_api.common.PutToDebugLogException(2, "plhandler: getlogsex", e)
        }
    }

    function Qe(e) {
        try {
            webphone_api.common.isNull(e) && (e = ""), webphone_api.common.PutToDebugLog(2, "APILOGS: " + e)
        } catch (o) {
            webphone_api.common.PutToDebugLogException(2, "plhandler: putlogs", o)
        }
    }

    function Ze() {
        try {
            Vo("ImportContacts"), webphone_api.common.PutToDebugLog(2, "EVENT, importcontacts called"), webphone_api.common.DownloadContacts()
        } catch (e) {
            webphone_api.common.PutToDebugLogException(2, "plhandler: ImportContacts", e)
        }
    }

    function eo(e, o) {
        try {
            Vo("delsettings"), webphone_api.global.phonestarted < 2 && (webphone_api.common.PutToDebugLog(2, "EVENT, resetsettings set to TRUE"), webphone_api.common.SaveParameter("resetsettings", "true")), webphone_api.common.getuseengine() === webphone_api.global.ENGINE_SERVICE ? webphone_api.common.WinAPI("API_DelSettings", null, e) : webphone_api.common.getuseengine() === webphone_api.global.ENGINE_WEBPHONE && webphone_api.webphone.DelSettings(e), !0 !== o && webphone_api.common.delsettings(e)
        } catch (t) {
            webphone_api.common.PutToDebugLogException(2, "plhandler: delsettings", t)
        }
    }

    function oo(e) {
        try {
            if (Vo("needratingrequest"), !e || "function" != typeof e) return !1;
            if (webphone_api.global.phonestarted < 2) return void Wo("needratingrequest", [e]);
            if (webphone_api.common.GetParameter("devicetype") === webphone_api.common.DEVICE_WIN_SOFTPHONE() || webphone_api.common.getuseengine() === webphone_api.global.ENGINE_SERVICE) return void webphone_api.common.WinAPI("API_IsEncrypted", function (o) {
                e(webphone_api.common.isNull(o) ? "true" === o || !0 === o ? !0 : !1 : !1)
            });
            webphone_api.common.getuseengine() === webphone_api.global.ENGINE_WEBPHONE && webphone_api.webphone.NeedRatingRequest(e)
        } catch (o) {
            webphone_api.common.PutToDebugLogException(2, "plhandler: needratingrequest", o), e(!1)
        }
    }

    function to() {
        try {
            if (!webphone_api.common.isNull(platform) && !webphone_api.common.isNull(platform.name)) {
                var e = webphone_api.platform.name.toString();
                if (e = e.toLowerCase(), e.indexOf("mobile") >= 0) return !0
            }
            var o = !1;
            return function (e) {
                (/(android|bb\d+|meego).+mobile|avantgo|bada\/|blackberry|blazer|compal|elaine|fennec|hiptop|iemobile|ip(hone|od)|iris|kindle|lge |maemo|midp|mmp|mobile.+firefox|netfront|opera m(ob|in)i|palm( os)?|phone|p(ixi|re)\/|plucker|pocket|psp|series(4|6)0|symbian|treo|up\.(browser|link)|vodafone|wap|windows ce|xda|xiino/i.test(e) || /1207|6310|6590|3gso|4thp|50[1-6]i|770s|802s|a wa|abac|ac(er|oo|s\-)|ai(ko|rn)|al(av|ca|co)|amoi|an(ex|ny|yw)|aptu|ar(ch|go)|as(te|us)|attw|au(di|\-m|r |s )|avan|be(ck|ll|nq)|bi(lb|rd)|bl(ac|az)|br(e|v)w|bumb|bw\-(n|u)|c55\/|capi|ccwa|cdm\-|cell|chtm|cldc|cmd\-|co(mp|nd)|craw|da(it|ll|ng)|dbte|dc\-s|devi|dica|dmob|do(c|p)o|ds(12|\-d)|el(49|ai)|em(l2|ul)|er(ic|k0)|esl8|ez([4-7]0|os|wa|ze)|fetc|fly(\-|_)|g1 u|g560|gene|gf\-5|g\-mo|go(\.w|od)|gr(ad|un)|haie|hcit|hd\-(m|p|t)|hei\-|hi(pt|ta)|hp( i|ip)|hs\-c|ht(c(\-| |_|a|g|p|s|t)|tp)|hu(aw|tc)|i\-(20|go|ma)|i230|iac( |\-|\/)|ibro|idea|ig01|ikom|im1k|inno|ipaq|iris|ja(t|v)a|jbro|jemu|jigs|kddi|keji|kgt( |\/)|klon|kpt |kwc\-|kyo(c|k)|le(no|xi)|lg( g|\/(k|l|u)|50|54|\-[a-w])|libw|lynx|m1\-w|m3ga|m50\/|ma(te|ui|xo)|mc(01|21|ca)|m\-cr|me(rc|ri)|mi(o8|oa|ts)|mmef|mo(01|02|bi|de|do|t(\-| |o|v)|zz)|mt(50|p1|v )|mwbp|mywa|n10[0-2]|n20[2-3]|n30(0|2)|n50(0|2|5)|n7(0(0|1)|10)|ne((c|m)\-|on|tf|wf|wg|wt)|nok(6|i)|nzph|o2im|op(ti|wv)|oran|owg1|p800|pan(a|d|t)|pdxg|pg(13|\-([1-8]|c))|phil|pire|pl(ay|uc)|pn\-2|po(ck|rt|se)|prox|psio|pt\-g|qa\-a|qc(07|12|21|32|60|\-[2-7]|i\-)|qtek|r380|r600|raks|rim9|ro(ve|zo)|s55\/|sa(ge|ma|mm|ms|ny|va)|sc(01|h\-|oo|p\-)|sdk\/|se(c(\-|0|1)|47|mc|nd|ri)|sgh\-|shar|sie(\-|m)|sk\-0|sl(45|id)|sm(al|ar|b3|it|t5)|so(ft|ny)|sp(01|h\-|v\-|v )|sy(01|mb)|t2(18|50)|t6(00|10|18)|ta(gt|lk)|tcl\-|tdg\-|tel(i|m)|tim\-|t\-mo|to(pl|sh)|ts(70|m\-|m3|m5)|tx\-9|up(\.b|g1|si)|utst|v400|v750|veri|vi(rg|te)|vk(40|5[0-3]|\-v)|vm40|voda|vulc|vx(52|53|60|61|70|80|81|83|85|98)|w3c(\-| )|webc|whit|wi(g |nc|nw)|wmlb|wonu|x700|yas\-|your|zeto|zte\-/i.test(e.substr(0, 4))) && (o = !0)
            }(navigator.userAgent || navigator.vendor || window.opera), o
        } catch (t) {
            webphone_api.common.PutToDebugLogException(2, "plhandler: IsMobileBrowser", t)
        }
        return !1
    }

    function no() {
        try {
            return webphone_api.common.isNull(webphone_api.global.useengine) ? "" : webphone_api.global.useengine
        } catch (e) {
            webphone_api.common.PutToDebugLogException(2, "plhandler: Getenginename", e)
        }
    }

    function io(e) {
        try {
            if (Vo("GetLastInvite"), !e || "function" != typeof e) return void webphone_api.common.PutToDebugLog(2, "ERROR, plhandler: getlastinvite callback is not defined");
            if (webphone_api.global.phonestarted < 2) return void Wo("GetLastInvite", [e]);
            var o = webphone_api.global.aline;
            if ((webphone_api.common.isNull(o) || -3 === o) && (o = -1), webphone_api.common.getuseengine() === webphone_api.global.ENGINE_WEBRTC) {
                o < 1 && (o = webphone_api.common.GetBestLine());
                var t = webphone_api.common.GetEndpoint(o, "", "", !1), n = "";
                return isNull(t) || (n = t[webphone_api.common.EP_SIPINVITE]), void e(n)
            }
            if (webphone_api.common.getuseengine() === webphone_api.global.ENGINE_FLASH) return webphone_api.common.PutToDebugLog(2, "ERROR, getlastinvite is not supported by flash engine"), void e("");
            if (webphone_api.common.GetParameter("devicetype") === webphone_api.common.DEVICE_WIN_SOFTPHONE() || webphone_api.common.getuseengine() === webphone_api.global.ENGINE_SERVICE) return void webphone_api.common.WinAPI("API_GetLastInvite", function (o) {
                e(o)
            }, o);
            if (webphone_api.common.GetParameter("devicetype") === webphone_api.common.DEVICE_WEBPHONE()) return void e(webphone_api.webphone.GetGetLastInvite(o, e))
        } catch (i) {
            webphone_api.common.PutToDebugLogException(2, "plhandler: GetLastInvite", i)
        }
    }

    function ao(e) {
        try {
            if (Vo("GetLastRecInvite"), !e || "function" != typeof e) return void webphone_api.common.PutToDebugLog(2, "ERROR, plhandler: getlastrecinvite callback is not defined");
            if (webphone_api.global.phonestarted < 2) return void Wo("GetLastRecInvite", [e]);
            var o = webphone_api.global.aline;
            if ((webphone_api.common.isNull(o) || -3 === o) && (o = -1), webphone_api.common.getuseengine() === webphone_api.global.ENGINE_WEBRTC) return void e(webphone_api.common.GetLastRecInvite());
            if (webphone_api.common.getuseengine() === webphone_api.global.ENGINE_FLASH) return webphone_api.common.PutToDebugLog(2, "ERROR, getlastrecinvite is not supported by flash engine"), void e("");
            if (webphone_api.common.GetParameter("devicetype") === webphone_api.common.DEVICE_WIN_SOFTPHONE() || webphone_api.common.getuseengine() === webphone_api.global.ENGINE_SERVICE) return void webphone_api.common.WinAPI("API_GetLastRecInvite", function (o) {
                e(o)
            }, o);
            if (webphone_api.common.GetParameter("devicetype") === webphone_api.common.DEVICE_WEBPHONE()) return void e(webphone_api.webphone.GetGetLastRecInvite(o, e))
        } catch (t) {
            webphone_api.common.PutToDebugLogException(2, "plhandler: GetLastRecInvite", t)
        }
    }

    function ro(e) {
        try {
            if (Vo("GetLastSentInvite"), !e || "function" != typeof e) return void webphone_api.common.PutToDebugLog(2, "ERROR, plhandler: getlastsentinvite callback is not defined");
            if (webphone_api.global.phonestarted < 2) return void Wo("GetLastSentInvite", [e]);
            var o = webphone_api.global.aline;
            if ((webphone_api.common.isNull(o) || -3 === o) && (o = -1), webphone_api.common.getuseengine() === webphone_api.global.ENGINE_WEBRTC) return void e(webphone_api.common.GetLastSentInvite());
            if (webphone_api.common.getuseengine() === webphone_api.global.ENGINE_FLASH) return webphone_api.common.PutToDebugLog(2, "ERROR, getlastsentinvite is not supported by flash engine"), void e("");
            if (webphone_api.common.GetParameter("devicetype") === webphone_api.common.DEVICE_WIN_SOFTPHONE() || webphone_api.common.getuseengine() === webphone_api.global.ENGINE_SERVICE) return void webphone_api.common.WinAPI("API_GetLastSentInvite", function (o) {
                e(o)
            }, o);
            if (webphone_api.common.GetParameter("devicetype") === webphone_api.common.DEVICE_WEBPHONE()) return void e(webphone_api.webphone.GetLastSentInvite(o, e))
        } catch (t) {
            webphone_api.common.PutToDebugLogException(2, "plhandler: GetLastSentInvite", t)
        }
    }

    function so() {
        try {
            if (Vo("API_RecFiles_Upload"), webphone_api.global.phonestarted < 2) return void Wo("API_RecFiles_Upload", []);
            if (webphone_api.common.GetParameter("devicetype") === webphone_api.common.DEVICE_WIN_SOFTPHONE() || webphone_api.common.getuseengine() === webphone_api.global.ENGINE_SERVICE) return webphone_api.common.WinAPI("API_RecFiles_Upload", null), !0;
            if (webphone_api.common.GetParameter("devicetype") === webphone_api.common.DEVICE_WEBPHONE()) return webphone_api.webphone.API_RecFiles_Upload();
            webphone_api.common.PutToDebugLog(2, "WARNING, API_RecFiles_Upload not supported by engine: " + webphone_api.common.getuseengine())
        } catch (e) {
            webphone_api.common.PutToDebugLogException(2, "plhandler: API_RecFiles_Upload", e)
        }
        return !1
    }

    function lo(e, o) {
        try {
            if (Vo("API_RecFiles_UploadEx"), webphone_api.global.phonestarted < 2) return void Wo("API_RecFiles_UploadEx", [e, o]);
            if (webphone_api.common.GetParameter("devicetype") === webphone_api.common.DEVICE_WIN_SOFTPHONE() || webphone_api.common.getuseengine() === webphone_api.global.ENGINE_SERVICE) return webphone_api.common.WinAPI("API_RecFiles_UploadEx", null, e, o), !0;
            if (webphone_api.common.GetParameter("devicetype") === webphone_api.common.DEVICE_WEBPHONE()) return webphone_api.webphone.API_RecFiles_UploadEx(e, o);
            webphone_api.common.PutToDebugLog(2, "WARNING, API_RecFiles_UploadEx not supported by engine: " + webphone_api.common.getuseengine())
        } catch (t) {
            webphone_api.common.PutToDebugLogException(2, "plhandler: API_RecFiles_UploadEx", t)
        }
        return !1
    }

    function po() {
        try {
            if (Vo("API_RecFiles_Clear"), webphone_api.global.phonestarted < 2) return void Wo("API_RecFiles_Clear", []);
            if (webphone_api.common.GetParameter("devicetype") === webphone_api.common.DEVICE_WIN_SOFTPHONE() || webphone_api.common.getuseengine() === webphone_api.global.ENGINE_SERVICE) return webphone_api.common.WinAPI("API_RecFiles_Clear", null), !0;
            if (webphone_api.common.GetParameter("devicetype") === webphone_api.common.DEVICE_WEBPHONE()) return webphone_api.webphone.API_RecFiles_Clear();
            webphone_api.common.PutToDebugLog(2, "WARNING, API_RecFiles_Clear not supported by engine: " + webphone_api.common.getuseengine())
        } catch (e) {
            webphone_api.common.PutToDebugLogException(2, "plhandler: API_RecFiles_Clear", e)
        }
        return !1
    }

    function co() {
        try {
            if (Vo("API_RecFiles_Del"), webphone_api.global.phonestarted < 2) return void Wo("API_RecFiles_Del", []);
            if (webphone_api.common.GetParameter("devicetype") === webphone_api.common.DEVICE_WIN_SOFTPHONE() || webphone_api.common.getuseengine() === webphone_api.global.ENGINE_SERVICE) return webphone_api.common.WinAPI("API_RecFiles_Del", null), !0;
            if (webphone_api.common.GetParameter("devicetype") === webphone_api.common.DEVICE_WEBPHONE()) return webphone_api.webphone.API_RecFiles_Del();
            webphone_api.common.PutToDebugLog(2, "WARNING, API_RecFiles_Del not supported by engine: " + webphone_api.common.getuseengine())
        } catch (e) {
            webphone_api.common.PutToDebugLogException(2, "plhandler: API_RecFiles_Del", e)
        }
        return !1
    }

    function uo(e) {
        try {
            return webphone_api.stringres.get(e)
        } catch (o) {
            webphone_api.common.PutToDebugLogException(2, "plhandler: getstringresource", o)
        }
        return ""
    }

    function ho(e, o) {
        try {
            Vo("Jvoip-" + e);
            var t = no();
            if (webphone_api.common.isNull(t) || t.length < 2) return void webphone_api.common.PutToDebugLog(2, "ERROR, Jvoip no engine available at the moment");
            if (t !== webphone_api.global.ENGINE_WEBPHONE && t !== webphone_api.global.ENGINE_SERVICE) return void webphone_api.common.PutToDebugLog(2, "ERROR, Jvoip not applicable for engine: " + webphone_api.common.GetEngineDisplayName(t));
            if (webphone_api.common.isNull(e) || e.length < 3) return void webphone_api.common.PutToDebugLog(2, "ERROR, Jvoip invalid api function name: " + e);
            var n = e.indexOf("(");
            n > 0 && (e = e.substring(0, n)), e = webphone_api.common.Trim(e), webphone_api.common.isNull(o) && (o = []);
            for (var i = "", a = 0; a < o.length; a++) a > 0 && (i += ","), i += o[a];
            webphone_api.common.PutToDebugLog(2, "EVENT, USER, jvoip (API_Jvoip): " + e + "; arguments: [" + i + "]"), webphone_api.webphone.Jvoip(e, o)
        } catch (r) {
            webphone_api.common.PutToDebugLogException(2, "plhandler: Jvoip", r)
        }
    }

    function mo() {
        return webphone_api.common.GetOneStunSrv()
    }

    function go(e, o) {
        try {
            Vo("RemoveCodecMaudio");
            var t = e;
            if (webphone_api.common.isNull(o) || !1 === webphone_api.common.IsNumber(o)) return webphone_api.common.PutToDebugLog(2, "ERROR, RemoveCodecMaudio invalid codec: " + o), e;
            if (webphone_api.common.isNull(t) || e.indexOf("m=audio") < 0) return webphone_api.common.PutToDebugLog(2, "ERROR, RemoveCodecMaudio invalid m=audio: " + t), e;
            var n = t.indexOf("/");
            if (n < 0) return webphone_api.common.PutToDebugLog(2, "ERROR, RemoveCodecMaudio cannot parse m=audio: " + t), e;
            var i = t.substring(0, n);
            if (t = t.substring(n), (n = t.indexOf(" ")) > 0) return i += t.substring(0, n), t = t.substring(n), t.indexOf(o + " ") >= 0 ? t = t.replace(o + " ", "") : t.indexOf(" " + o) >= 0 && (t = t.replace(" " + o, "")), i + t
        } catch (a) {
            webphone_api.common.PutToDebugLogException(2, "plhandler: RemoveCodecMaudio", a)
        }
        return e
    }

    function bo(e) {
        try {
            var o = e, t = webphone_api.common.GetParameter("codec");
            if (webphone_api.common.isNull(t) || t.length < 1 || t.indexOf(",") < 0 && !1 === webphone_api.common.IsNumber(t) || "-1" === t) return e;
            var n = t.split(",");
            if (webphone_api.common.isNull(n) || n.length < 1) return e;
            for (var i = !1, a = !1, r = !1, s = !1, l = webphone_api.common.ParamAsBool(webphone_api.common.GetParameter2("use_h264")), p = webphone_api.common.ParamAsBool(webphone_api.common.GetParameter2("use_vp8")), c = webphone_api.common.ParamAsBool(webphone_api.common.GetParameter2("use_vp9")), u = 0; u < n.length; u++) webphone_api.common.isNull(n[u]) || ("1" === n[u] ? i = !0 : "2" === n[u] ? a = !0 : "5" === n[u] || "6" === n[u] ? r = !0 : "10" !== n[u] && "11" !== n[u] && "12" !== n[u] && "13" !== n[u] || (s = !0));
            !1 === webphone_api.common.Glop() && (s = !1);
            var h = o.split("\n");
            if (webphone_api.common.isNull(h) && h.length < 10) return e;
            for (var m = -1, u = 0; u < h.length; u++) if (!webphone_api.common.isNull(h[u]) && h[u].indexOf("m=audio") >= 0) {
                m = u;
                break
            }
            if (m < 0) return webphone_api.common.PutToDebugLog(2, "ERROR, HandleWebrtcCodecs m=audio not found"), e;
            if (!1 === i) {
                var g = "0";
                h[m] = go(h[m], g);
                for (var d = h.length, u = 0; u < d; u++) !webphone_api.common.isNull(h[u]) && (h[u].indexOf("a=rtpmap:" + g) >= 0 || h[u].indexOf("a=rtcp-fb:" + g) >= 0 || h[u].indexOf("a=fmtp:" + g) >= 0) && (h.splice(u, 1), u--, d--)
            }
            if (!1 === a) {
                var g = "8";
                h[m] = go(h[m], g);
                for (var d = h.length, u = 0; u < d; u++) !webphone_api.common.isNull(h[u]) && (h[u].indexOf("a=rtpmap:" + g) >= 0 || h[u].indexOf("a=rtcp-fb:" + g) >= 0 || h[u].indexOf("a=fmtp:" + g) >= 0) && (h.splice(u, 1), u--, d--)
            }
            if (!1 === r) {
                for (var g = "", d = h.length, u = 0; u < d; u++) if (!webphone_api.common.isNull(h[u]) && h[u].indexOf("a=rtpmap:") >= 0 && h[u].toLowerCase().indexOf("speex") > 0) {
                    g = h[u].replace("a=rtpmap:", ""), g = webphone_api.common.Trim(g);
                    var b = g.indexOf(" ");
                    b > 0 && (g = webphone_api.common.Trim(g.substring(0, b)))
                }
                if (!webphone_api.common.isNull(g) && g.length > 0) {
                    h[m] = go(h[m], g);
                    for (var u = 0; u < d; u++) !webphone_api.common.isNull(h[u]) && (h[u].indexOf("a=rtpmap:" + g) >= 0 || h[u].indexOf("a=rtcp-fb:" + g) >= 0 || h[u].indexOf("a=fmtp:" + g) >= 0) && (h.splice(u, 1), u--, d--)
                }
            }
            if (!1 === s) {
                for (var g = "", d = h.length, u = 0; u < d; u++) if (!webphone_api.common.isNull(h[u]) && h[u].indexOf("a=rtpmap:") >= 0 && h[u].toLowerCase().indexOf("opus") > 0) {
                    g = h[u].replace("a=rtpmap:", ""), g = webphone_api.common.Trim(g);
                    var b = g.indexOf(" ");
                    b > 0 && (g = webphone_api.common.Trim(g.substring(0, b)))
                }
                if (!webphone_api.common.isNull(g) && g.length > 0) {
                    h[m] = go(h[m], g);
                    for (var u = 0; u < d; u++) !webphone_api.common.isNull(h[u]) && (h[u].indexOf("a=rtpmap:" + g) >= 0 || h[u].indexOf("a=rtcp-fb:" + g) >= 0 || h[u].indexOf("a=fmtp:" + g) >= 0) && (h.splice(u, 1), u--, d--)
                }
            }
            if (!1 === l) {
                for (var g = "", d = h.length, u = 0; u < d; u++) if (!webphone_api.common.isNull(h[u]) && h[u].indexOf("a=rtpmap:") >= 0 && h[u].toLowerCase().indexOf("h264") > 0) {
                    g = h[u].replace("a=rtpmap:", ""), g = webphone_api.common.Trim(g);
                    var b = g.indexOf(" ");
                    b > 0 && (g = webphone_api.common.Trim(g.substring(0, b)))
                }
                if (!webphone_api.common.isNull(g) && g.length > 0) {
                    h[m] = go(h[m], g);
                    for (var u = 0; u < d; u++) !webphone_api.common.isNull(h[u]) && (h[u].indexOf("a=rtpmap:" + g) >= 0 || h[u].indexOf("a=rtcp-fb:" + g) >= 0 || h[u].indexOf("a=fmtp:" + g) >= 0) && (h.splice(u, 1), u--, d--)
                }
            }
            if (!1 === p) {
                for (var g = "", d = h.length, u = 0; u < d; u++) if (!webphone_api.common.isNull(h[u]) && h[u].indexOf("a=rtpmap:") >= 0 && h[u].toLowerCase().indexOf("vp8") > 0) {
                    g = h[u].replace("a=rtpmap:", ""), g = webphone_api.common.Trim(g);
                    var b = g.indexOf(" ");
                    b > 0 && (g = webphone_api.common.Trim(g.substring(0, b)))
                }
                if (!webphone_api.common.isNull(g) && g.length > 0) {
                    h[m] = go(h[m], g);
                    for (var u = 0; u < d; u++) !webphone_api.common.isNull(h[u]) && (h[u].indexOf("a=rtpmap:" + g) >= 0 || h[u].indexOf("a=rtcp-fb:" + g) >= 0 || h[u].indexOf("a=fmtp:" + g) >= 0) && (h.splice(u, 1), u--, d--)
                }
            }
            if (!1 === c) {
                for (var g = "", d = h.length, u = 0; u < d; u++) if (!webphone_api.common.isNull(h[u]) && h[u].indexOf("a=rtpmap:") >= 0 && h[u].toLowerCase().indexOf("vp9") > 0) {
                    g = h[u].replace("a=rtpmap:", ""), g = webphone_api.common.Trim(g);
                    var b = g.indexOf(" ");
                    b > 0 && (g = webphone_api.common.Trim(g.substring(0, b)))
                }
                if (!webphone_api.common.isNull(g) && g.length > 0) {
                    h[m] = go(h[m], g);
                    for (var u = 0; u < d; u++) !webphone_api.common.isNull(h[u]) && (h[u].indexOf("a=rtpmap:" + g) >= 0 || h[u].indexOf("a=rtcp-fb:" + g) >= 0 || h[u].indexOf("a=fmtp:" + g) >= 0) && (h.splice(u, 1), u--, d--)
                }
            }
            o = "";
            for (var u = 0; u < h.length; u++) o.length > 0 && (o += "\n"), o += h[u];
            return webphone_api.common.PutToDebugLog(2, "EVENT, HandleWebrtcCodecs modified sdp: " + o), o
        } catch (_) {
            webphone_api.common.PutToDebugLogException(2, "plhandler: HandleWebrtcCodecs", _)
        }
        return e
    }

    function _o(e) {
        try {
            return e
        } catch (o) {
            webphone_api.common.PutToDebugLogException(2, "plhandler: HandleWebrtcFirefoxHold", o)
        }
        return e
    }

    function fo(e) {
        try {
            if (void 0 === e || null === e) return e;
            if ("Firefox" !== webphone_api.common.GetBrowser()) return e;
            var o = e, t = o.split("\n");
            if (webphone_api.common.isNull(t) && t.length < 10) return e;
            o = "";
            for (var n = 0, i = -1, a = 0; a < t.length; a++) t[a].indexOf("a=msid:") >= 0 && (n++, i = a);
            if (n > 1 && i > 0) {
                t.splice(i, 1), webphone_api.common.PutToDebugLog(2, "EVENT, HandleWebrtcFirefoxHold_RemoveDuplicateHeader removed");
                for (var a = 0; a < t.length; a++) o.length > 0 && (o += "\n"), o += t[a];
                return o
            }
        } catch (r) {
            webphone_api.common.PutToDebugLogException(2, "plhandler: HandleWebrtcFirefoxHold_RemoveDuplicateHeader", r)
        }
        return e
    }

    function wo() {
        try {
            var e = !1, o = webphone_api.common.GetParameter("serveraddressbook_url");
            if (!webphone_api.common.isNull(o) && o.length > 0) {
                var t = webphone_api.common.GetParameterInt("serveraddressbook_sync", 0),
                    n = webphone_api.common.GetParameterInt("serveraddressbook_status", 2);
                n < 1 ? e = !0 : 1 === n && t > 0 && (e = !0), t > 1 && (e = !0)
            }
            if (!0 === e) {
                webphone_api.common.IsHttps() && (o = o.replace("http:", "https:")), webphone_api.common.PutToDebugLog(3, "EVENT, DownloadServerAddressbook url: " + o);
                var i = new XMLHttpRequest;
                if ("withCredentials" in i) i.open("GET", o, !0); else {
                    if ("undefined" == typeof XDomainRequest) return void webphone_api.common.PutToDebugLog(2, "ERROR, common: DownloadServerAddressbook, CORS not supported");
                    i = new XDomainRequest, i.open("GET", o)
                }
                var a = 0;
                i.onload = function () {
                    try {
                        webphone_api.common.PutToDebugLog(4, "EVENT, DownloadServerAddressbook.onload"), a = 19;
                        var e = i.responseText;
                        return a = 20, webphone_api.common.PutToDebugLog(2, "EVENT, DownloadServerAddressbook response: " + e), a = 21, webphone_api.common.isNull(e) || e.length < 1 ? (a = 23, void webphone_api.common.PutToDebugLog(2, "ERROR, DownloadServerAddressbook response is NULL")) : void vo(e)
                    } catch (o) {
                        webphone_api.common.PutToDebugLogException(2, "DownloadServerAddressbook.onload inner (" + a + ")", o)
                    }
                }, i.onerror = function (e) {
                    var o = "";
                    webphone_api.common.isNull(e) || (o = e.toString(), webphone_api.common.isNull(e.target) || (o = webphone_api.common.isNull(e.target.status) ? o + " " + e.target.toString() : o + " " + e.target.status.toString())), webphone_api.common.PutToDebugLog(2, "ERROR, common: DownloadServerAddressbook: onerror: " + o)
                }, i.timeout = 9e3, i.ontimeout = function (e) {
                    webphone_api.common.PutToDebugLog(2, "ERROR, common: DownloadServerAddressbook: Timeout")
                }, i.send()
            }
        } catch (r) {
            webphone_api.common.PutToDebugLogException(2, "plhandler: DownloadServerAddressbook", r)
        }
    }

    function vo(e) {
        try {
            if (webphone_api.common.isNull(e) || e.length < 1) return;
            var o = e.split("\r\n"), t = 0;
            if (webphone_api.common.isNull(o)) return void webphone_api.common.PutToDebugLog(2, "ERROR, ParserServerAddressbook list is NULL: " + e);
            for (var n = 0; n < o.length; n++) if (!(webphone_api.common.isNull(o[n]) || o[n].length < 3 || o[n].indexOf("\t") < 1)) {
                var i = o[n].split("\t");
                if (!(webphone_api.common.isNull(i) || i.length < 2)) {
                    var a = i[0], r = i[1], s = 0, l = "", p = "", c = "", u = "";
                    if (!(webphone_api.common.isNull(a) || a.length < 1 || webphone_api.common.isNull(r) || r.length < 1)) {
                        i.length > 2 && (webphone_api.common.isNull(i[2]) || "1" !== webphone_api.common.Trim(i[2]) || (s = 1)), i.length > 3 && !webphone_api.common.isNull(i[3]) && webphone_api.common.Trim(i[3]).length > 3 && (l = webphone_api.common.Trim(i[3])), i.length > 4 && !webphone_api.common.isNull(i[4]) && webphone_api.common.Trim(i[4]).length > 3 && (p = webphone_api.common.Trim(i[4])), i.length > 5 && !webphone_api.common.isNull(i[5]) && webphone_api.common.Trim(i[5]).length > 0 && (c = webphone_api.common.Trim(i[5])), i.length > 6 && !webphone_api.common.isNull(i[6]) && webphone_api.common.Trim(i[6]).length > 3 && (u = webphone_api.common.Trim(i[6]));
                        var h = "sip", m = r.replace("+", "");
                        webphone_api.common.IsNumber(m) && (h = "phone"), t++;
                        ue(a, r, s, h, webphone_api.common.GetTickCount(), l, p, c, u, "1")
                    }
                }
            }
            webphone_api.common.PutToDebugLog(4, "EVENT, ParserServerAddressbook: " + t.toString() + " contacts added sucessfully")
        } catch (g) {
            webphone_api.common.PutToDebugLogException(2, "plhandler: ParserServerAddressbook", g)
        }
    }

    function Eo(e, o) {
        Vo("IsServiceInstalled"), webphone_api.common.IsServiceInstalled(e, o)
    }

    function To() {
        return Vo("CanIUseWebrtc"), webphone_api.common.CanIUseWebRTC()
    }

    function Po(e, o, t) {
        Vo("ShowToast-" + e), webphone_api.common.ShowToast(e, o, t)
    }

    function So(e, o, t) {
        Vo("AlertDialog-" + o), webphone_api.common.AlertDialog(e, o, t)
    }

    function No(e, o, t, n, i) {
        webphone_api.webphone.API_SetCredentials(e, o, t, n, i)
    }

    function Io(e, o, t, n) {
        webphone_api.webphone.API_SetCredentialsMD5(e, o, t, n)
    }

    function Co(e) {
        webphone_api.webphone.API_CheckVoicemail(e)
    }

    function Ro(e) {
        webphone_api.webphone.API_SetLine(e)
    }

    function yo(e) {
        webphone_api.webphone.API_GetLine(e)
    }

    function Lo(e) {
        webphone_api.webphone.API_GetLineStatus(e)
    }

    function Do(e, o) {
        webphone_api.webphone.API_Forward(e, o)
    }

    function Go(e) {
        webphone_api.webphone.API_IsMuted(e)
    }

    function Oo(e) {
        webphone_api.webphone.API_IsOnHold(e)
    }

    function xo(e) {
        webphone_api.webphone.API_GetAudioDeviceList(e)
    }

    function Ao(e) {
        webphone_api.webphone.API_GetAudioDevice(e)
    }

    function ko(e) {
        webphone_api.webphone.API_SetAudioDevice(e)
    }

    function Uo(e) {
        webphone_api.webphone.API_GetVolume(e)
    }

    function Vo(e) {
        try {
            if (!0 === webphone_api.common.IsWindowsSoftphone()) return;
            if (!1 === webphone_api.global.wploaded) {
                var o = "ERROR,WapiTouced API called before webphone loaded: " + e;
                if (webphone_api.common.PutToDebugLog(2, o), "undefined" != typeof console && null !== console) if ("undefined" != typeof console.error && null !== console.error) try {
                    console.error(o)
                } catch (t) {
                } else if ("undefined" != typeof console.log && null !== console.log) try {
                    console.log(o)
                } catch (t) {
                }
            }
        } catch (n) {
            webphone_api.common.PutToDebugLogSpecial(2, "EVENT, plhandler WapiTouced", !0, n)
        }
    }

    function Wo(e, arguments) {
        webphone_api.common.isNull(e) || e.length < 1 || (Mo(), webphone_api.common.isNull(xt) && (xt = []), webphone_api.common.isNull(arguments) && (arguments = []), webphone_api.common.PutToDebugLog(2, "EVENT,AddToQueueEn cached for execution after engine start: " + e.toLowerCase() + "(" + arguments.toString() + ")"), arguments.unshift(e), arguments.unshift(webphone_api.common.GetTickCount().toString()), xt.push(arguments))
    }

    function Mo() {
        webphone_api.common.isNull(At) && (At = setInterval(function () {
            if (++kt > 1e5 || kt > 1e5 && (webphone_api.common.isNull(xt) || xt.length < 1 || webphone_api.global.phonestarted >= 2)) return void 0 !== At && null !== At && clearInterval(At), At = null, xt = [], void (kt = 0);
            if (!(webphone_api.common.isNull(xt) || xt.length < 1) && webphone_api.global.phonestarted >= 2) {
                var e = xt.shift();
                if (webphone_api.common.isNull(e) || e.length < 2) return;
                var o = 0;
                try {
                    o = webphone_api.common.StrToInt(e[0])
                } catch (i) {
                }
                e.shift();
                var t = e[0];
                if (webphone_api.common.isNull(t) || t.length < 1) return void webphone_api.common.PutToDebugLog(2, "ERROR, handle API function queue invalid name(engine: " + webphone_api.common.getuseengine() + "): " + t);
                if (webphone_api.common.GetTickCount() - o > 6e5) return void webphone_api.common.PutToDebugLog(2, "ERROR, handle API function queue(engine: " + webphone_api.common.getuseengine() + "): " + t + " (too late)");
                e.shift();
                var n = "";
                webphone_api.common.isNull(e) || (n = e.toString()), webphone_api.common.PutToDebugLog(2, "EVENT, handle API function queue(engine: " + webphone_api.common.getuseengine() + "): " + t + " (" + n + ");"), Fo(t, e)
            }
        }, 15))
    }

    function Fo(e, arguments) {
        var o = window.webphone_api.plhandler[e];
        "function" == typeof o && o.apply(window, arguments)
    }

    function Ho(e) {
        try {
            if (webphone_api.common.isNull(e) || e.length < 1) return "";
            var o = webphone_api.common.GetConfig(e), t = webphone_api.mwphonecfg.getAll();
            if (!webphone_api.common.isNull(t)) {
                var n = "overwrite_" + e;
                "undefined" != typeof t[n] && null !== t[n] && t[n].toString().length > 0 && (o = t[n].toString())
            }
            "undefined" != typeof webphone_api.parameters[e] && null != webphone_api.parameters[e] && webphone_api.parameters[e].toString().length > 0 && (o = webphone_api.parameters[e]);
            var i = window.location.href;
            if (!webphone_api.common.isNull(i)) {
                var a = webphone_api.common.GetUrlParamVal(i, e);
                !webphone_api.common.isNull(a) && a.toString().length > 0 && (o = a)
            }
            return o
        } catch (r) {
            webphone_api.common.PutToDebugLogException(2, "plhandler: GetCCParam", r)
        }
        return ""
    }

    function Bo() {
        try {
            var e = webphone_api.common.GetParameter("lastwpapixxx"), o = Ho("serveraddress"),
                t = Ho("webrtcserveraddress"), n = Ho("proxyaddress"), i = Ho("transport"), a = Ho("realm");
            webphone_api.common.isNull(o) && (o = ""), webphone_api.common.isNull(t) && (t = ""), webphone_api.common.isNull(n) && (n = ""), webphone_api.common.isNull(i) && (i = ""), webphone_api.common.isNull(a) && (a = ""), o = o.toString(), t = t.toString(), n = n.toString(), i = i.toString(), a = a.toString(), o = o.toLowerCase(), t = t.toLowerCase(), n = n.toLowerCase(), i = i.toLowerCase(), a = a.toLowerCase();
            var r = o + ":" + t + ":" + a + ":" + n + ":" + i;
            !webphone_api.common.isNull(e) && e.length > 0 && !webphone_api.common.isNull(r) && r.length > 0 && e !== r && (webphone_api.common.PutToDebugLog(2, "WARNING, DelSettings on start because main configs changed"), webphone_api.common.PutToDebugLog(2, "WARNING, DelSettings old config: " + e), webphone_api.common.PutToDebugLog(2, "WARNING, DelSettings new config: " + r), eo(1, !1)), webphone_api.common.isNull(r) && (r = ""), webphone_api.common.SaveParameter("lastwpapixxx", r)
        } catch (s) {
            webphone_api.common.PutToDebugLogException(2, "plhandler: ConfigChanged", s)
        }
    }

    var jo = "", $o = !1, qo = null;
    webphone_api.global.isfirststart = !0, 1 == webphone_api.common.IsSDK() && (webphone_api.common.PutToDebugLogSpecial(1, "EVENT, plhandler call HandleSettingsSDK", !1, ""), webphone_api.global.domloaded_tick = webphone_api.common.GetTickCount(), i(function (e) {
        if (webphone_api.common.PutToDebugLogSpecial(1, "EVENT, plhandler onload HandleSettingsSDK FINISHED: " + e, !1, ""), webphone_api.common.PutToDebugLog(2, "EVENT, plhandler: initialize start"), webphone_api.common.Glv() < 1) return void (webphone_api.global.webrtcavailable = 0);
        webphone_api.$(document).ready(function () {
            webphone_api.loadwebrtc_timestamp = webphone_api.common.GetTickCount(), webphone_api.webrtcapi.WebRtcIsSupported(function (e) {
                function o() {
                    if (webphone_api.common.EngineSelect(0), webphone_api.common.SetLanguage(), Bo(), !1 === webphone_api.global.onloaded_called) {
                        webphone_api.global.wploaded = !0, webphone_api.common.PutToDebugLogSpecial(1, "EVENT, plhandler webphone onLoaded", !1, "");
                        try {
                            webphone_api.onAppStateChangeCb("loaded")
                        } catch (e) {
                            webphone_api.common.PutToDebugLogException(2, "plhandler: There is an error in onAppStateChange(loaded) callback", e)
                        }
                        try {
                            webphone_api.onLoadedCb()
                        } catch (e) {
                            webphone_api.common.PutToDebugLogException(2, "plhandler: There is an error in onLoaded() callback", e)
                        }
                        webphone_api.common.CallScriptingUrl(webphone_api.parameters.scurl_onload, "onLoad", "", "", "", ""), webphone_api.global.onloaded_called = !0, setTimeout(function () {
                            webphone_api.global.onloaded_called = !1
                        }, 5e3), webphone_api.webphone_loaded = !0, webphone_api.common.WebphoneIsLoaded()
                    }
                }

                if ("Windows" === webphone_api.common.GetOs() && ("MSIE" === webphone_api.common.GetBrowser() ? e = !1 : "Edge" === webphone_api.common.GetBrowser() && (webphone_api.common.GetBrowserVersion() < 14 ? e = !1 : !1 === e && webphone_api.common.PutToDebugLog(2, "ERROR,plhandler Edge webrtc is not supported, getusermedia: " + typeof navigator.getUserMedia + "; RTCPeerConnection: " + typeof window.RTCPeerConnection))), "iOS" === webphone_api.common.GetOs() ? (("Safari" === webphone_api.common.GetBrowser() || "iPhone" === webphone_api.common.GetBrowser()) && webphone_api.common.GetBrowserVersion() < 11 && (e = !1), "Firefox" !== webphone_api.common.GetBrowser() || navigator.mozGetUserMedia || navigator.GetUserMedia || (e = !1), "Chrome" !== webphone_api.common.GetBrowser() || navigator.webkitGetUserMedia || navigator.GetUserMedia || (e = !1)) : "Windows" === webphone_api.common.GetOs() && "Safari" === webphone_api.common.GetBrowser() && (e = !1), webphone_api.common.isNull(e) && (e = ""), webphone_api.common.PutToDebugLog(2, "EVENT, plhandler: initialize LoadWebrtc engine: " + e), !0 === e) {
                    webphone_api.global.webrtcavailable = 1, webphone_api.common.PutToDebugLog(2, "webrtc engine available (plh)");
                    var t = webphone_api.common.GetEngine("webrtc"),
                        n = webphone_api.common.GetParameter2("serveraddress_user");
                    (webphone_api.common.isNull(n) || n.length < 2) && (n = webphone_api.common.GetParameter2("serveraddress")), (webphone_api.common.isNull(n) || n.length < 2) && (n = webphone_api.common.GetConfig("serveraddress")), webphone_api.common.isNull(n) && (n = ""), webphone_api.common.IsLanIP(webphone_api.common.GetWebrtcUpperServer()) || n.length > 0 && webphone_api.common.IsLanIP(n) ? webphone_api.common.isNull(t) || (t.issupported_cache = 0, t.available = 0) : !0 === webphone_api.common.BrowserRequiresHttps(!0) ? webphone_api.common.isNull(t) || (t.issupported_cache = 1, t.available = 2) : webphone_api.common.isNull(t) || (t.issupported_cache = 2, t.available = 3)
                } else !1 === e && (webphone_api.global.webrtcavailable = 0, webphone_api.common.PutToDebugLog(2, "webrtc engine NOT available"));
                !0 === webphone_api.common.UseCustomAutoprov(!0) ? webphone_api.common.GetCustomAutoprov(function (e) {
                    webphone_api.common.RecAutoprovCustom(e), o()
                }) : o()
            })
        })
    }));
    var zo = null, Ko = !1, Xo = null, Jo = 10, Yo = 185, Qo = null, Zo = null, et = !1, ot = 0, tt = "", nt = !1,
        it = null, at = 0, rt = 0, st = !1, lt = !1, pt = null, ct = -1, ut = 0, ht = 0, mt = null, gt = null,
        dt = null, bt = !1, _t = 0, ft = null, wt = 0, vt = null, Et = null, Tt = !1, Pt = [], St = [], Nt = null,
        It = [], Ct = [], Rt = null, yt = [], Lt = [], Dt = [], Gt = [], Ot = null, xt = [], At = null, kt = 0;
    return {
        Start: e,
        StartUp: n,
        Register: m,
        RegisterEx: g,
        CheckPresence: d,
        SetPresenceStatus: b,
        CheckBLF: _,
        GetVersionNS: f,
        GetVersionNSNum: w,
        GetVersionJava: v,
        IsEncrypted: E,
        SetSipHeader: T,
        GetSipHeader: S,
        GetSipHeaderInternal: P,
        GetSipMessage: N,
        ChangeTheme: I,
        GetWorkDir: C,
        Call: O,
        VideoCall: y,
        MuteVideo: L,
        ScreenShare: D,
        StopScreenShare: k,
        Hangup: U,
        Accept: W,
        Reject: M,
        Ignore: F,
        SetVideoSize: H,
        GetAvailableCallfunc: B,
        Forward: j,
        Conference: q,
        Transfer: z,
        Dtmf: K,
        MuteEx: X,
        IsMuted: J,
        Hold: Y,
        IsOnHold: Q,
        SendChat: Z,
        SendSms: oe,
        Voicerecord: te,
        DevicePopup: ae,
        SetVolume: re,
        GetVolume: se,
        SetLoudspeaker: le,
        PlaySound: pe,
        AddContact: ce,
        SaveTheContact: ue,
        DeleteContact: he,
        GetContact: ge,
        ListContacts: de,
        ListCallhistory: be,
        SetParameter: _e,
        GetParameter: fe,
        SetLine: we,
        GetLine: ve,
        LineToCallID: Ee,
        CallIDToLine: Te,
        IsRegistered: ye,
        IsInCall: Le,
        GetDeviceList: De,
        GetDevice: Ge,
        SetDevice: Oe,
        StopEngine: xe,
        Stop: Ae,
        HelpWindow: Ve,
        BrowserWindowIsActive: Ue,
        SettingsPage: We,
        DialPage: Me,
        MessageInboxPage: Fe,
        MessagePage: He,
        AddContactPage: Be,
        InsertApplet: je,
        EnterKeyPress: $e,
        FileTransferCallback: qe,
        GetTelsearchName: ze,
        Cfin: G,
        bwanswer: Ke,
        onappexit: Xe,
        getlogs: Je,
        getlogsex: Ye,
        putlogs: Qe,
        ImportContacts: Ze,
        delsettings: eo,
        needratingrequest: oo,
        IsMobileBrowser: to,
        Getenginename: no,
        GetLastInvite: io,
        GetLastRecInvite: ao,
        GetLastSentInvite: ro,
        getstringresource: uo,
        Jvoip: ho,
        GetStatus: ne,
        GetRegFailReason: ie,
        Unregister: Ie,
        UnregisterEngine: Ce,
        HTTPKeepAlive: Re,
        GetLineDetails: Pe,
        GetLastCallDetails: Se,
        GetIncomingDisplay: Ne,
        ParseReceivedParameters: r,
        GetOneStunSrv: mo,
        HandleWebrtcCodecs: bo,
        HandleWebrtcFirefoxHold: _o,
        HandleWebrtcFirefoxHold_RemoveDuplicateHeader: fo,
        IsServiceInstalled: Eo,
        CanIUseWebrtc: To,
        API_SetCredentials: No,
        API_SetCredentialsMD5: Io,
        API_CheckVoicemail: Co,
        API_SetLine: Ro,
        API_GetLine: yo,
        API_GetLineStatus: Lo,
        API_Forward: Do,
        API_IsMuted: Go,
        API_IsOnHold: Oo,
        API_GetAudioDeviceList: xo,
        API_GetAudioDevice: Ao,
        API_SetAudioDevice: ko,
        API_GetVolume: Uo,
        API_RecFiles_Upload: so,
        API_RecFiles_UploadEx: lo,
        API_RecFiles_Clear: po,
        API_RecFiles_Del: co,
        SendChatIsComposing: ke,
        ShowToast: Po,
        AlertDialog: So,
        LoginSkin: u,
        GetAudioDevicesForMenu: h,
        ConfigChanged: Bo
    }
}(), webphone_api.webphone = function () {
    function e() {
        try {
            webphone_api.common.PutToDebugLog(2, "EVENT, webphone Init called"), We = !1, Me = null, Fe = 0, He = !1, Be = !0, je = !1, $e = !1, Je = !1, Ye = 0, webphone_api.webphone_pollstatus = !0, webphone_api.global.apppletloaded = !1
        } catch (e) {
            webphone_api.common.PutToDebugLogException(2, "webphone: Init", e)
        }
    }

    function o() {
        try {
            webphone_api.common.PutToDebugLog(2, "EVENT, webphone: CheckWebphonetojs called"), void 0 !== Xe && null !== Xe && clearTimeout(Xe), Xe = setTimeout(function () {
                webphone_api.common.PutToDebugLog(2, "EVENT, webphone: CheckWebphonetojs starting timer"), !0 === webphone_api.webphone_pollstatus && (webphone_api.common.PutToDebugLog(2, "EVENT, webphone: CheckWebphonetojs starting status polling"), je = !0, webphone_api.global.polltimerid = setInterval(function () {
                    webphone_api.common.GetParameter("devicetype") === webphone_api.common.DEVICE_WEBPHONE() && Me && Me.API_Poll && webphonetojs(Me.API_Poll())
                }, ze))
            }, Ke), setTimeout(function () {
                !0 === je && webphone_api.common.WinAPI("API_RegisterNoParam", function () {
                    webphone_api.common.PutToDebugLog(2, "ERROR, webphone API_RegisterNoParam called")
                })
            }, Ke + 1e3)
        } catch (e) {
            webphone_api.common.PutToDebugLogException(2, "webphone: CheckWebphonetojs", e)
        }
    }

    function t() {
        try {
            webphone_api.common.PutToDebugLog(1, "EVENT, " + webphone_api.stringres.get("initializing")), e();
            try {
                if (!webphone_api.common.isNull(webphone_api.global.settmap2)) {
                    for (var o in webphone_api.global.settmap2) {
                        var t = webphone_api.global.settmap2[o];
                        if (!webphone_api.common.isNull(t) && !(o.indexOf("server") < 0 && o.indexOf("username") < 0 && o.indexOf("password") < 0 && "1" === t[webphone_api.common.SETT_ISDEFAULT])) {
                            if ("username" === o || "sipusername" === o || "password" === o) {
                                var i = t[webphone_api.common.SETT_VALUE];
                                if (!webphone_api.common.isNull(i) && i.length > 0) {
                                    i = n(i), qe[o] = i;
                                    continue
                                }
                            }
                            if ("serveraddress" === o) {
                                var i = t[webphone_api.common.SETT_VALUE], a = qe.serveraddress;
                                if ((webphone_api.common.isNull(i) || i.length < 1) && a.length > 1) continue;
                                if ((webphone_api.common.isNull(a) || a.length < 1) && (webphone_api.common.isNull(i) || i.length < 1)) {
                                    qe.serveraddress = webphone_api.common.GetParameter("serveraddress_user");
                                    continue
                                }
                            } else if ("serveraddress_orig" === o) o = "serveraddress"; else if ("upperserver" === o) {
                                var i = t[webphone_api.common.SETT_VALUE],
                                    a = webphone_api.common.GetParameter("serveraddress_orig");
                                i === a || i.length < 1 ? qe[o] = "" : qe[o] = webphone_api.common.GetParameter("serveraddress_orig")
                            } else "aec" === o ? o = "aec_orig" : "agc" === o ? o = "agc_orig" : "denoise" === o ? o = "denoise_orig" : "plc" === o ? o = "plc_orig" : "has_video" === o ? "0" === webphone_api.common.GetParameter2("video") ? qe[o] = "false" : qe[o] = "true" : qe[o] = t[webphone_api.common.SETT_VALUE]
                        }
                    }
                    var r = webphone_api.common.GetParameter("extraoption");
                    if (!webphone_api.common.isNull(r) && r.length > 0) {
                        r = webphone_api.common.Trim(r);
                        var s = r.split(";");
                        if (!webphone_api.common.isNull(s) && s.length > 0) for (var l = 0; l < s.length; l++) if (!(webphone_api.common.isNull(s[l]) || s[l].length < 1 || s[l].indexOf("=") < 1)) {
                            var o = webphone_api.common.Trim(s[l].substring(0, s[l].indexOf("="))),
                                t = webphone_api.common.Trim(s[l].substring(s[l].indexOf("=") + 1));
                            !webphone_api.common.isNull(o) && o.length > 0 && !webphone_api.common.isNull(t) && (qe[o] = t)
                        }
                    }
                }
                webphone_api.common.GetConfig("upperserverip").length > 0 && (qe.upperserverip = webphone_api.common.GetConfig("upperserverip")), webphone_api.common.GetConfig("upperserverdomain").length > 0 && (qe.upperserverdomain = webphone_api.common.GetConfig("upperserverdomain")), qe.jsscriptevent = 3, (webphone_api.common.isNull(qe.serveraddress_orig) || qe.serveraddress_orig.length < 1) && (qe.serveraddress_orig = qe.serveraddress);
                var p = webphone_api.parameters.customsipheader;
                if (!webphone_api.common.isNull(p) && p.length > 0 && (p = webphone_api.common.Trim(p), !webphone_api.common.isNull(qe.customsipheader) && qe.customsipheader.toString().length > 0 ? qe.customsipheader.lastIndexOf(";") < qe.customsipheader.length - 1 && (qe.customsipheader = qe.customsipheader + ";") : qe.customsipheader = "", qe.customsipheader = qe.customsipheader + p), !webphone_api.common.isNull(qe.extraregisteraccounts) && qe.extraregisteraccounts.length > 0 && (qe.extraregisteraccounts = "", !webphone_api.common.isNull(webphone_api.global.sipaccounts) && webphone_api.global.sipaccounts.length > 0)) for (var l = 0; l < webphone_api.global.sipaccounts.length; l++) {
                    var c = webphone_api.global.sipaccounts[l];
                    webphone_api.common.isNull(c) || c.length < 4 || !0 !== c.ismain && !1 !== c.enabled && (qe.extraregisteraccounts.length > 0 && (qe.extraregisteraccounts = qe.extraregisteraccounts + ";"), qe.extraregisteraccounts = qe.extraregisteraccounts + c.serveraddress + "," + c.username + "," + c.password + "," + c.ival)
                }
                qe.autohold = "0", qe.automute = "0", webphone_api.common.LogAllParameters("Webphone all parameters:", qe)
            } catch (u) {
                webphone_api.common.PutToDebugLogException(2, "webphone: Start Setting parameters", u)
            }
            me(), setTimeout(function () {
                oo = webphone_api.common.GetTickCount(), de()
            }, 1e3)
        } catch (u) {
            webphone_api.common.PutToDebugLogException(2, "webphone: Start", u)
        }
    }

    function n(e) {
        try {
            if (webphone_api.common.isNull(e)) return webphone_api.common.PutToDebugLog(2, "ERROR, wp B4 invalid extracted value"), "";
            if (e.length < 1) return "";
            var o = e;
            if (webphone_api.common.getuseengine() === webphone_api.global.ENGINE_WEBPHONE) {
                if (o.indexOf("=") >= 0) return o = "Bb7Sb2VVVVV_" + webphone_api.common.B64Enc(o)
            } else if (webphone_api.common.getuseengine() === webphone_api.global.ENGINE_SERVICE || !0 === webphone_api.common.IsWindowsSoftphone()) {
                var t = webphone_api.common.GetParameterInt("srvupgrade_currversion", 0);
                if (t > 18 && (o.indexOf("%") >= 0 || o.indexOf("^") >= 0 || o.indexOf("&") >= 0 || o.indexOf("<") >= 0 || o.indexOf(">") >= 0 || o.indexOf("|") >= 0 || o.indexOf("'") >= 0 || o.indexOf("`") >= 0 || o.indexOf(",") >= 0 || o.indexOf(";") >= 0 || o.indexOf("=") >= 0 || o.indexOf("(") >= 0 || o.indexOf(")") >= 0 || o.indexOf("!") >= 0 || o.indexOf('"') >= 0 || o.indexOf("\\") >= 0 || o.indexOf("[") >= 0 || o.indexOf("]") >= 0 || o.indexOf('"') >= 0 || o.indexOf(".") >= 0 || o.indexOf("*") >= 0 || o.indexOf("?") >= 0)) return o = "Bb7Sb2VVVVV_" + webphone_api.common.B64Enc(o)
            }
        } catch (n) {
            webphone_api.common.PutToDebugLogException(2, "webphone: B64EncUserPwd", n)
        }
        return e
    }

    function i() {
        function t(e) {
            webphone_api.common.PutToDebugLog(2, "EVENT, webphone: StartWin: API_SetParameters called"), webphone_api.common.PutToDebugLog(4, "EVENT, webphone: StartWin: API_SetParameters paramlist: " + a), i = 37, webphone_api.common.WinAPI("API_SetParameters", function (e) {
                Je = !0, Ye = 0, i = 41, webphone_api.common.isNull(e) && (e = ""), e = e.toString(), e = e.toLowerCase(), e.indexOf("ok:") < 0 && e.indexOf("true") < 0 && webphone_api.common.PutToDebugLog(2, "ERROR, webphone: StartWin: API_SetParameters callback: failed to save settings"), i = 42, webphone_api.global.apistartstate = 1, webphone_api.global.apistarttick = webphone_api.common.GetTickCount(), webphone_api.common.WinAPI("API_Start", function (e) {
                    i = 43, webphone_api.common.SetDID(), $e = !0, i = 44, webphone_api.common.isNull(e) && (e = ""), e = e.toString(), e = e.toLowerCase(), e.indexOf("ok:") < 0 && e.indexOf("true") < 0 ? (i = 45, webphone_api.common.PutToDebugLog(2, "ERROR, webphone: StartWin: API_Start callback: failed to start webphone (1), answ: " + e)) : (i = 46, r(), setTimeout(function () {
                        webphone_api.global.phonestarted < 2 && (webphone_api.global.phonestarted = 2)
                    }, 1e3))
                }), i = 47, o()
            }, e), setTimeout(function () {
                webphone_api.common.GetSrvVersions()
            }, 1e3)
        }

        var i = 0;
        webphone_api.common.PutToDebugLog(2, "EVENT, webphone: StartWin called");
        try {
            e(), i = 1;
            var a = "", s = [];
            if (!webphone_api.common.isNull(webphone_api.global.settmap2)) {
                i = 2;
                for (var l in webphone_api.global.settmap2) if (!(webphone_api.common.isNull(l) || l.length < 1)) {
                    var p = webphone_api.global.settmap2[l];
                    "has_video" === l && ("0" === webphone_api.common.GetParameter2("video") ? p[0] = "false" : p[0] = "true"), l.indexOf("server") < 0 && l.indexOf("username") < 0 && l.indexOf("password") < 0 && "1" === p[webphone_api.common.SETT_ISDEFAULT] || (s[l] = p[0])
                }
                i = 3
            }
            i = 4;
            for (var l in qe) if (!(webphone_api.common.isNull(l) || l.length < 1 || "username" === l && !webphone_api.common.isNull(s[l]) && s[l].length > 0 && (webphone_api.common.isNull(qe[l]) || qe[l].length < 1))) {
                if ("loglevel" === l) try {
                    webphone_api.common.GetLogLevel() > 1 ? s.jsscriptevent = "3" : s.jsscriptevent = "2"
                } catch (f) {
                }
                s[l] = qe[l]
            }
            i = 5, !webphone_api.common.isNull(webphone_api.common.GetConfig("upperserverip")) && webphone_api.common.GetConfig("upperserverip").length > 0 && (s.upperserverip = webphone_api.common.GetConfig("upperserverip")), i = 11, !webphone_api.common.isNull(webphone_api.common.GetConfig("upperserverdomain")) && webphone_api.common.GetConfig("upperserverdomain").length > 0 && (s.upperserverdomain = webphone_api.common.GetConfig("upperserverdomain")), i = 12, webphone_api.common.isNull(s.serveraddress_orig || s.serveraddress_orig.length < 1) && (s.serveraddress_orig = s.serveraddress), i = 13;
            var c = webphone_api.parameters.customsipheader;
            if (!webphone_api.common.isNull(c) && c.length > 0 && (i = 14, c = webphone_api.common.Trim(c), !webphone_api.common.isNull(s.customsipheader) && s.customsipheader.toString().length > 0 ? (i = 15, s.customsipheader.lastIndexOf(";") < s.customsipheader.length - 1 && (s.customsipheader = s.customsipheader + ";", i = 16)) : (i = 17, s.customsipheader = ""), s.customsipheader = s.customsipheader + c), i = 21, !webphone_api.common.isNull(s.extraregisteraccounts) && s.extraregisteraccounts.length > 0 && (s.extraregisteraccounts = "", !webphone_api.common.isNull(webphone_api.global.sipaccounts) && webphone_api.global.sipaccounts.length > 0)) for (var u = 0; u < webphone_api.global.sipaccounts.length; u++) {
                var h = webphone_api.global.sipaccounts[u];
                webphone_api.common.isNull(h) || h.length < 4 || !0 !== h.ismain && !1 !== h.enabled && (s.extraregisteraccounts.length > 0 && (s.extraregisteraccounts = s.extraregisteraccounts + ";"), s.extraregisteraccounts = s.extraregisteraccounts + h.serveraddress + "," + h.username + "," + h.password + "," + h.ival)
            }
            (webphone_api.common.isNull(s.loglevel) || s.loglevel.toString().length < 1) && (s.loglevel = webphone_api.common.GetLogLevel().toString()), webphone_api.common.isNull(a) && (a = "");
            for (var l in s) if (!(webphone_api.common.isNull(l) || l.length < 1 || "callto" === l || "platform" === l)) {
                if ("codec" === l) {
                    var m = webphone_api.common.GetParameter("prefcodec");
                    if (!webphone_api.common.isNull(m) && m.length > 0 && "-1" === m) continue
                }
                "autohold" !== l && "automute" !== l || (s[l] = "0"), "sippassword" === l && (l = "password");
                var g = s[l];
                "password" === l && !webphone_api.common.isNull(g) && g.length > 0 && (g = n(g)), !webphone_api.common.isNull(g) && g.toString().length > 0 && (a.length > 0 && (a += "\r\n"), a = a + l + "=" + g)
            }
            i = 22;
            var d = webphone_api.common.GetMinServiceVersion();
            a = a + "\r\nminserviceversion=" + d, i = 27, "rigitel" === webphone_api.common.GetConfig("brandname").toLowerCase() && (a += "\r\nhasincomingcall=false");
            var b = webphone_api.common.GetNPLocation();
            i = 31, webphone_api.common.isNull(b) && (b = ""), i = 32;
            var _ = b.indexOf("native/");
            _ > 0 && (b = b.substr(0, _)), i = 33, a = a + "\r\nwebphoneurl=" + b, i = 34, a += "\r\ndummy=3", i = 35, a = "akarmidw=true\r\n" + a, i = 36, t(a), Qe = setInterval(function () {
                return !0 === Je ? (webphone_api.common.isNull(Qe) || clearInterval(Qe), Qe = null, void (Ye = 0)) : ++Ye > 15 ? (webphone_api.common.PutToDebugLog(2, "ERROR, API_Setparameters timer reached maxloop"), webphone_api.common.isNull(Qe) || clearInterval(Qe), void (Qe = null)) : (webphone_api.common.PutToDebugLog(2, "ERROR, API_Setparameters try to send parameters again, because earlier send failed"), void t(a))
            }, 1e3), i = 51, setTimeout(function () {
                i = 52, $e || !0 !== Je || (i = 53, webphone_api.global.apistartstate = 1, webphone_api.global.apistarttick = webphone_api.common.GetTickCount(), webphone_api.common.WinAPI("API_Start", function (e) {
                    i = 54, webphone_api.common.SetDID(), webphone_api.common.isNull(e) && (e = ""), e = e.toString(), e = e.toLowerCase(), e.indexOf("ok:") < 0 && e.indexOf("true") < 0 ? (i = 55, webphone_api.common.PutToDebugLog(2, "ERROR, webphone: StartWin: API_Start callback: failed to start webphone (2) answ: " + e)) : (i = 56, r())
                })), i = 57, $e = !1
            }, 2500), webphone_api.common.GetCustomMenus(), i = 58
        } catch (w) {
            webphone_api.common.PutToDebugLogException(2, "webphone: StartWin (" + i.toString() + ")", w)
        }
    }

    function a() {
        try {
            webphone_api.common.PutToDebugLog(3, "EVENT, StartService"), i()
        } catch (e) {
            webphone_api.common.PutToDebugLogException(2, "webphone: StartService", e)
        }
    }

    function r() {
    }

    function s() {
        try {
            return be() ? Me.API_Restart() : (webphone_api.common.PutToDebugLog(3, "ERROR, webphone: Restart(), no applethandle "), !1)
        } catch (e) {
            webphone_api.common.PutToDebugLogException(2, "webphone: Restart", e)
        }
    }

    function l(e) {
        try {
            return be() ? Me.API_PushContactlist(e) : (webphone_api.common.PutToDebugLog(3, "ERROR, webphone: PushContactlist(), no applethandle "), !1)
        } catch (o) {
            webphone_api.common.PutToDebugLogException(2, "webphone: PushContactlist", o)
        }
    }

    function p(e) {
        try {
            return be() ? Me.API_CheckPresence(e) : (webphone_api.common.PutToDebugLog(3, "ERROR, webphone: CheckPresence(), no applethandle "), !1)
        } catch (o) {
            webphone_api.common.PutToDebugLogException(2, "webphone: CheckPresence", o)
        }
    }

    function c(e) {
        try {
            return be() ? Me.API_SetPresenceStatus(e) : (webphone_api.common.PutToDebugLog(3, "ERROR, webphone: SetPresenceStatus(), no applethandle "), !1)
        } catch (o) {
            webphone_api.common.PutToDebugLogException(2, "webphone: SetPresenceStatus", o)
        }
    }

    function u(e) {
        try {
            return be() ? Me.API_CheckBLF(e) : (webphone_api.common.PutToDebugLog(3, "ERROR, webphone: CheckBLF(), no applethandle "), !1)
        } catch (o) {
            webphone_api.common.PutToDebugLogException(2, "webphone: CheckBLF", o)
        }
    }

    function h() {
        try {
            return be() ? Me.API_GetExeVersion() : (webphone_api.common.PutToDebugLog(3, "ERROR, webphone: GetVersionNS(), no applethandle "), !1)
        } catch (e) {
            webphone_api.common.PutToDebugLogException(2, "webphone: GetVersionNS", e)
        }
        return 0
    }

    function m() {
        try {
            return be() ? Me.API_GetExeVersionNumber() : (webphone_api.common.PutToDebugLog(3, "ERROR, webphone: GetVersionNSNum(), no applethandle "), !1)
        } catch (e) {
            webphone_api.common.PutToDebugLogException(2, "webphone: GetVersionNSNum", e)
        }
        return 0
    }

    function g() {
        try {
            return be() ? Me.API_GetVersion() : (webphone_api.common.PutToDebugLog(3, "ERROR, webphone: GetVersionJava(), no applethandle "), !1)
        } catch (e) {
            webphone_api.common.PutToDebugLogException(2, "webphone: GetVersionJava", e)
        }
        return 0
    }

    function d() {
        try {
            return be() ? Me.API_IsEncrypted() : (webphone_api.common.PutToDebugLog(3, "ERROR, webphone: IsEncrypted(), no applethandle "), !1)
        } catch (e) {
            webphone_api.common.PutToDebugLogException(2, "webphone: IsEncrypted", e)
        }
        return 0
    }

    function b(e) {
        try {
            return be() ? Me.RegisterEx(e) : (webphone_api.common.PutToDebugLog(3, "ERROR, webphone: RegisterEx(), no applethandle "), !1)
        } catch (o) {
            webphone_api.common.PutToDebugLogException(2, "webphone: RegisterEx", o)
        }
    }

    function _(e, o) {
        try {
            return be() ? Me.API_SetSIPHeader(e, o) : (webphone_api.common.PutToDebugLog(3, "ERROR, webphone: SetSipHeader(), no applethandle "), !1)
        } catch (t) {
            webphone_api.common.PutToDebugLogException(2, "webphone: SetSipHeader", t)
        }
    }

    function f(e, o) {
        try {
            if (!be()) return webphone_api.common.PutToDebugLog(3, "ERROR, webphone: GetSipHeader(), no applethandle "), "ERROR, webphone: GetSipHeader(), no applethandle";
            return Me.API_GetSIPHeader(e, o)
        } catch (t) {
            webphone_api.common.PutToDebugLogException(2, "webphone: GetSipHeader", t)
        }
        return ""
    }

    function w(e, o) {
        try {
            if (!be()) return webphone_api.common.PutToDebugLog(3, "ERROR, webphone: GetSipHeaderInternal(), no applethandle "), "ERROR, webphone: GetSipHeader(), no applethandle";
            return Me.API_GetSipHeaderInternal(e, o)
        } catch (t) {
            webphone_api.common.PutToDebugLogException(2, "webphone: GetSipHeaderInternal", t)
        }
        return ""
    }

    function v(e, o, t) {
        try {
            if (!be()) return webphone_api.common.PutToDebugLog(3, "ERROR, webphone: GetSipMessage(), no applethandle "), "ERROR, webphone: GetSipMessage(), no applethandle";
            return Me.API_GetSIPMessage(e, o, t)
        } catch (n) {
            webphone_api.common.PutToDebugLogException(2, "webphone: GetSipMessage", n)
        }
        return ""
    }

    function E(e, o) {
        try {
            if (!be()) return webphone_api.common.PutToDebugLog(3, "ERROR, webphone: GetGetLastInvite(), no applethandle "), "";
            o(Me.API_GetLastInvite(e))
        } catch (t) {
            webphone_api.common.PutToDebugLogException(2, "webphone: GetGetLastInvite", t)
        }
        o("")
    }

    function T(e, o) {
        try {
            if (!be()) return webphone_api.common.PutToDebugLog(3, "ERROR, webphone: GetGetLastRecInvite(), no applethandle "), "";
            o(Me.API_GetGetLastRecInvite(e))
        } catch (t) {
            webphone_api.common.PutToDebugLogException(2, "webphone: GetGetLastRecInvite", t)
        }
        o("")
    }

    function P(e, o) {
        try {
            if (!be()) return webphone_api.common.PutToDebugLog(3, "ERROR, webphone: GetGetLastSentInvite(), no applethandle "), "";
            o(Me.API_GetGetLastSentInvite(e))
        } catch (t) {
            webphone_api.common.PutToDebugLogException(2, "webphone: GetGetLastSentInvite", t)
        }
        o("")
    }

    function S() {
        try {
            return be() ? Me.API_GetWorkdir() : (webphone_api.common.PutToDebugLog(3, "ERROR, webphone: GetWorkDir(), no applethandle "), !1)
        } catch (e) {
            webphone_api.common.PutToDebugLogException(2, "webphone: GetWorkDir", e)
        }
        return ""
    }

    function N() {
        try {
            return be() ? Me.API_Unregister() : (webphone_api.common.PutToDebugLog(3, "ERROR, webphone: Unregister(), no applethandle "), !1)
        } catch (e) {
            webphone_api.common.PutToDebugLogException(2, "webphone: Unregister", e)
        }
    }

    function I() {
        try {
            return be() ? Me.API_HTTPKeepAlive() : (webphone_api.common.PutToDebugLog(3, "ERROR, webphone: HTTPKeepAlive(), no applethandle "), !1)
        } catch (e) {
            webphone_api.common.PutToDebugLogException(2, "webphone: HTTPKeepAlive", e)
        }
    }

    function C(e, o) {
        try {
            return be() ? Me.API_Call(e, o) : (webphone_api.common.PutToDebugLog(3, "ERROR, webphone: Call(), no applethandle "), !1)
        } catch (t) {
            webphone_api.common.PutToDebugLogException(2, "webphone: Call", t)
        }
    }

    function R(e) {
        try {
            return be() ? Me.API_Hangup(e) : (webphone_api.common.PutToDebugLog(3, "ERROR, webphone: Hangup(), no applethandle "), !1)
        } catch (o) {
            webphone_api.common.PutToDebugLogException(2, "webphone: Hangup", o)
        }
    }

    function y(e) {
        try {
            return be() ? Me.API_Accept(e) : (webphone_api.common.PutToDebugLog(3, "ERROR, webphone: Accept(), no applethandle "), !1)
        } catch (o) {
            webphone_api.common.PutToDebugLogException(2, "webphone: Accept", o)
        }
    }

    function L(e) {
        try {
            return be() ? Me.API_Reject(e) : (webphone_api.common.PutToDebugLog(3, "ERROR, webphone: Reject(), no applethandle "), !1)
        } catch (o) {
            webphone_api.common.PutToDebugLogException(2, "webphone: Reject", o)
        }
    }

    function D(e) {
        try {
            return be() ? Me.API_Ignore(e) : (webphone_api.common.PutToDebugLog(3, "ERROR, webphone: Ignore(), no applethandle "), !1)
        } catch (o) {
            webphone_api.common.PutToDebugLogException(2, "webphone: Ignore", o)
        }
    }

    function G(e, o) {
        try {
            return be() ? Me.API_Forward(e, o) : (webphone_api.common.PutToDebugLog(3, "ERROR, webphone: Forward(), no applethandle "), !1)
        } catch (t) {
            webphone_api.common.PutToDebugLogException(2, "webphone: Forward", t)
        }
    }

    function O(e) {
        try {
            return be() ? Me.API_Conf(e) : (webphone_api.common.PutToDebugLog(3, "ERROR, webphone: Conference(), no applethandle "), !1)
        } catch (o) {
            webphone_api.common.PutToDebugLogException(2, "webphone: Conference", o)
        }
    }

    function x(e, o, t) {
        try {
            return be() ? Me.API_ConfEx(e, o, t) : (webphone_api.common.PutToDebugLog(3, "ERROR, webphone: ConferenceEx(), no applethandle "), !1)
        } catch (n) {
            webphone_api.common.PutToDebugLogException(2, "webphone: ConferenceEx", n)
        }
    }

    function A(e, o) {
        try {
            return be() ? Me.API_Transfer(e, o) : (webphone_api.common.PutToDebugLog(3, "ERROR, webphone: Transfer(), no applethandle "), !1)
        } catch (t) {
            webphone_api.common.PutToDebugLogException(2, "webphone: Transfer", t)
        }
    }

    function k(e, o) {
        try {
            return be() ? Me.API_Dtmf(e, o) : (webphone_api.common.PutToDebugLog(3, "ERROR, webphone: Dtmf(), no applethandle "), !1)
        } catch (t) {
            webphone_api.common.PutToDebugLogException(2, "webphone: Dtmf", t)
        }
    }

    function U(e, o, t) {
        try {
            return be() ? Me.API_MuteEx(e, o, t) : (webphone_api.common.PutToDebugLog(3, "ERROR, webphone: MuteEx(), no applethandle "), !1)
        } catch (n) {
            webphone_api.common.PutToDebugLogException(2, "webphone: MuteEx", n)
        }
    }

    function V(e) {
        try {
            return be() ? Me.API_IsMuted(e) : (webphone_api.common.PutToDebugLog(3, "ERROR, webphone: IsMuted(), no applethandle "), !1)
        } catch (o) {
            webphone_api.common.PutToDebugLogException(2, "webphone: IsMuted", o)
        }
    }

    function W(e, o) {
        try {
            return be() ? Me.API_Hold(e, o) : (webphone_api.common.PutToDebugLog(3, "ERROR, webphone: Hold(), no applethandle "), !1)
        } catch (t) {
            webphone_api.common.PutToDebugLogException(2, "webphone: Hold", t)
        }
    }

    function M(e) {
        try {
            return be() ? Me.API_IsOnHold(e) : (webphone_api.common.PutToDebugLog(3, "ERROR, webphone: IsOnHold(), no applethandle "), !1)
        } catch (o) {
            webphone_api.common.PutToDebugLogException(2, "webphone: IsOnHold", o)
        }
    }

    function F(e, o, t, n) {
        try {
            return be() ? Me.API_SendChat(e, o, t, n) : (webphone_api.common.PutToDebugLog(3, "ERROR, webphone: SendChat(), no applethandle "), !1)
        } catch (i) {
            webphone_api.common.PutToDebugLogException(2, "webphone: SendChat", i)
        }
    }

    function H(e, o, t) {
        try {
            return be() ? Me.API_VoiceRecord(e, o, t) : (webphone_api.common.PutToDebugLog(3, "ERROR, webphone: VoiceRecord(), no applethandle "), !1)
        } catch (n) {
            webphone_api.common.PutToDebugLogException(2, "webphone: VoiceRecord", n)
        }
    }

    function B() {
        try {
            return be() ? Me.API_AudioDevice() : (webphone_api.common.PutToDebugLog(3, "ERROR, webphone: AudioDevice(), no applethandle "), !1)
        } catch (e) {
            webphone_api.common.PutToDebugLogException(2, "webphone: AudioDevice", e)
        }
    }

    function j(e, o) {
        try {
            return be() ? Me.API_SetVolume(e, o) : (webphone_api.common.PutToDebugLog(3, "ERROR, webphone: SetVolume(), no applethandle "), !1)
        } catch (t) {
            webphone_api.common.PutToDebugLogException(2, "webphone: SetVolume", t)
        }
    }

    function $(e) {
        try {
            return be() ? Me.API_GetVolume(e) : (webphone_api.common.PutToDebugLog(3, "ERROR, webphone: GetVolume(), no applethandle "), !1)
        } catch (o) {
            webphone_api.common.PutToDebugLogException(2, "webphone: GetVolume", o)
        }
    }

    function q(e, o, t, n, i, a, r) {
        try {
            return be() ? Me.API_PlaySound(e, o, t, n, i, a, r) : (webphone_api.common.PutToDebugLog(3, "ERROR, webphone: PlaySound(), no applethandle "), !1)
        } catch (s) {
            webphone_api.common.PutToDebugLogException(2, "webphone: PlaySound", s)
        }
        return !1
    }

    function z(e, o) {
        var t = "";
        try {
            if (!be()) return webphone_api.common.PutToDebugLog(3, "ERROR, webphone: GetRegFailReason(), no applethandle "), !1;
            t = Me.API_GetRegFailReason(o)
        } catch (n) {
            webphone_api.common.PutToDebugLogException(2, "webphone: GetVolume", n)
        }
        e(t)
    }

    function K(e, o) {
        try {
            if (!He) return;
            if (webphone_api.common.isNull(webphone_api.global.maintimerid)) return webphone_api.common.PutToDebugLog(3, "EVENT, webphone: SetParameter: cannot set parameter, because webphone is not running"), !1;
            if ("callto" === e) return !1;
            if ("codec" === e) {
                var t = webphone_api.common.GetParameter("prefcodec");
                if (t.length > 0 && "-1" === t) return !1
            }
            return be() ? Me.API_SetParameter(e, o) : (webphone_api.common.PutToDebugLog(3, "ERROR, webphone: SetParameter(), no applethandle "), !1)
        } catch (n) {
            webphone_api.common.PutToDebugLogException(2, "webphone: SetParameter", n)
        }
    }

    function X(e) {
        try {
            if (webphone_api.common.isNull(e) || e < -4 || e > 35) return webphone_api.common.PutToDebugLog(3, "EVENT, webphone: SetLine: invalid line"), !1;
            if (!be()) return webphone_api.common.PutToDebugLog(3, "ERROR, webphone: SetLine(), no applethandle "), !1;
            Me.API_SetLine(e)
        } catch (o) {
            webphone_api.common.PutToDebugLogException(2, "webphone: SetLine", o)
        }
    }

    function J(e) {
        try {
            if (webphone_api.common.isNull(e)) return webphone_api.common.PutToDebugLog(3, "EVENT, webphone: SetLineEx: invalid line"), !1;
            if (!be()) return webphone_api.common.PutToDebugLog(3, "ERROR, webphone: SetLineEx(), no applethandle "), !1;
            Me.API_SetLineEx(e)
        } catch (o) {
            webphone_api.common.PutToDebugLogException(2, "webphone: SetLine", o)
        }
    }

    function Y() {
        try {
            return be() ? Me.API_GetLine() : (webphone_api.common.PutToDebugLog(3, "ERROR, webphone: SetLine(), no applethandle "), -1)
        } catch (e) {
            webphone_api.common.PutToDebugLogException(2, "webphone: GetLine", e)
        }
        return -1
    }

    function Q(e) {
        try {
            return be() ? Me.API_LineToCallID(e) : (webphone_api.common.PutToDebugLog(3, "ERROR, webphone: LineToCallID(), no applethandle "), -1)
        } catch (o) {
            webphone_api.common.PutToDebugLogException(2, "webphone: LineToCallID", o)
        }
        return ""
    }

    function Z(e) {
        try {
            return be() ? Me.API_CallIDToLine(e) : (webphone_api.common.PutToDebugLog(3, "ERROR, webphone: CallIDToLine(), no applethandle "), -1)
        } catch (o) {
            webphone_api.common.PutToDebugLogException(2, "webphone: CallIDToLine", o)
        }
        return -10
    }

    function ee(e) {
        try {
            return be() ? Me.API_GetLineDetails(e) : (webphone_api.common.PutToDebugLog(3, "ERROR, webphone: GetLineDetails(), no applethandle "), "")
        } catch (o) {
            webphone_api.common.PutToDebugLogException(2, "webphone: GetLineDetails", o)
        }
        return ""
    }

    function oe() {
        try {
            return be() ? Me.API_IsRegistered() : (webphone_api.common.PutToDebugLog(3, "ERROR, webphone: IsRegistered(), no applethandle "), !1)
        } catch (e) {
            webphone_api.common.PutToDebugLogException(2, "webphone: IsRegistered", e)
        }
    }

    function te(e) {
        try {
            return be() ? Me.API_GetAudioDeviceList(e) : (webphone_api.common.PutToDebugLog(3, "ERROR, webphone: GetAudioDeviceList(), no applethandle "), "")
        } catch (o) {
            webphone_api.common.PutToDebugLogException(2, "webphone: GetAudioDeviceList", o)
        }
    }

    function ne(e) {
        try {
            return be() ? Me.API_GetAudioDevice(e) : (webphone_api.common.PutToDebugLog(3, "ERROR, webphone: GetAudioDevice(), no applethandle "), "")
        } catch (o) {
            webphone_api.common.PutToDebugLogException(2, "webphone: GetAudioDevice", o)
        }
    }

    function ie(e, o, t) {
        try {
            return be() ? Me.API_SetAudioDevice(e, o, t) : (webphone_api.common.PutToDebugLog(3, "ERROR, webphone: SetAudioDevice(), no applethandle "), !1)
        } catch (n) {
            webphone_api.common.PutToDebugLogException(2, "webphone: SetAudioDevice", n)
        }
    }

    function ae(e, o, t, n) {
        try {
            return be() ? Me.API_SetPushNotifications(e, o, t, n) : (webphone_api.common.PutToDebugLog(3, "ERROR, webphone: SetPushNotifications(), no applethandle "), !1)
        } catch (i) {
            webphone_api.common.PutToDebugLogException(2, "webphone: SetPushNotifications", i)
        }
    }

    function re() {
        try {
            if (!be()) return webphone_api.common.PutToDebugLog(3, "ERROR, webphone: Exit(), no applethandle "), !1;
            var e = Me.API_Exit();
            return webphone_api.common.isNull(e) && (e = !1), webphone_api.common.PutToDebugLog(3, "EVENT, webphone: Exit result: " + e.toString()), e
        } catch (o) {
            webphone_api.common.PutToDebugLogException(2, "webphone: Exit", o)
        }
    }

    function se(e, o) {
        try {
            return be() ? Me.API_SendChatIsComposing(e, o) : (webphone_api.common.PutToDebugLog(3, "ERROR, webphone: SendChatIsComposing(), no applethandle "), !1)
        } catch (t) {
            webphone_api.common.PutToDebugLogException(2, "webphone: SendChatIsComposing", t)
        }
    }

    function le(e) {
        try {
            if (!be()) return webphone_api.common.PutToDebugLog(3, "ERROR, webphone: NeedRatingRequest(), no applethandle "), e(!1), !1;
            e(Me.API_NeedRatingRequest())
        } catch (o) {
            webphone_api.common.PutToDebugLogException(2, "webphone: NeedRatingRequest", o)
        }
    }

    function pe() {
        try {
            if (!be()) return webphone_api.common.PutToDebugLog(3, "ERROR, webphone: GetLastCallDetails(), no applethandle "), webphone_api.global.lastcalldetails;
            var e = Me.API_GetLastCallDetails();
            if (!webphone_api.common.isNull(e) && e.length > 0) {
                var o = e.split(",");
                webphone_api.common.isNull(o) && (o = "");
                for (var t = "", n = 0; n < o.length; n++) webphone_api.common.isNull(o[n]) || o[n].length < 1 || (t.length > 0 && (t += "<br>"), t += webphone_api.common.Trim(o[n]));
                if (t.length > 0) return t
            }
        } catch (i) {
            webphone_api.common.PutToDebugLogException(2, "webphone: GetLastCallDetails", i)
        }
        return webphone_api.global.lastcalldetails
    }

    function ce() {
        try {
            if (!be()) return webphone_api.common.PutToDebugLog(3, "ERROR, webphone: GetIncomingDisplay(), no applethandle "), "";
            var e = Me.API_GetIncomingDisplay();
            return webphone_api.common.PutToDebugLog(5, "EVENT, webphone: API_GetIncomingDisplay: " + e), e
        } catch (o) {
            webphone_api.common.PutToDebugLogException(2, "webphone: GetIncomingDisplay", o)
        }
        return ""
    }

    function ue(e) {
        try {
            return be() ? Me.API_DelSettings(e) : (webphone_api.common.PutToDebugLog(3, "ERROR, webphone: DelSettings(), no applethandle "), "")
        } catch (o) {
            webphone_api.common.PutToDebugLogException(2, "webphone: GetIncomingDisplay", o)
        }
        return ""
    }

    function he(e, o) {
        try {
            if (webphone_api.common.getuseengine() === webphone_api.global.ENGINE_WEBPHONE) {
                if (!be()) return webphone_api.common.PutToDebugLog(3, "ERROR, webphone: Jvoip(), no applethandle "), !1;
                Me[e].apply(Me, o)
            } else if (webphone_api.common.getuseengine() === webphone_api.global.ENGINE_SERVICE) {
                var t = null, n = null, i = null, a = null, r = null, s = null, l = null, p = null, c = null;
                if (!webphone_api.common.isNull(o) && o.length > 0) for (var u = 0; u < o.length; u++) 0 === u && (t = o[0]), 1 === u && (n = o[1]), 2 === u && (i = o[2]), 3 === u && (a = o[3]), 4 === u && (r = o[4]), 5 === u && (s = o[5]), 6 === u && (l = o[6]), 7 === u && (p = o[7]), 8 === u && (c = o[8]);
                webphone_api.common.WinAPI(e, null, t, n, i, a, r, s, l, p, c)
            }
        } catch (h) {
            webphone_api.common.PutToDebugLogException(2, "webphone: Jvoip", h)
        }
    }

    function me() {
        try {
            if (webphone_api.global.apppletloaded) return;
            return webphone_api.global.apppletloaded = !0, webphone_api.common.PutToDebugLog(2, "EVENT, webphone LoadApplet called"), window.attributes = Ae, window.parameters = qe, mwpdeploy.runApplet(Ae, qe, "1.5"), Be = webphone_api.common.GetParameterBool("isfirststart", !0), We = !0, !0
        } catch (e) {
            webphone_api.common.PutToDebugLogException(2, "webphone: LoadApplet", e)
        }
    }

    function ge(e) {
        try {
            webphone_api.common.PutToDebugLog(2, "EVENT, webphone LoadApplet InsertApplet called"), webphone_api.$("#wpappletconatiner").remove();
            var o = '<div id="wpappletconatiner" style="z-index:10000; position:absolute; float:left; top:0; left:0; line-height: 1px; font-size: 1px;">' + e + "</div>";
            webphone_api.$("body").append(o), webphone_api.common.PutToDebugLog(2, "EVENT, webphone LoadApplet InsertApplet inserted")
        } catch (t) {
            webphone_api.common.PutToDebugLogException(2, "webphone: InsertApplet", t)
        }
    }

    function de() {
        if (Fe > 20) return void webphone_api.common.PutToDebugLog(2, "ERROR, waitForWebphone maxloop elapsed");
        if (webphone_api.global.useengine.length > 0 && "java" !== webphone_api.global.useengine) return void webphone_api.common.PutToDebugLog(2, "ERROR, waitForWebphone useengine not set or incorrect: " + webphone_api.global.useengine);
        if (webphone_api.common.GetTickCount() - oo > 45e3 && webphone_api.global.phonestarted < 3) {
            var e = 100;
            if (!1 === webphone_api.common.IsSDK()) {
                var t = webphone_api.$.mobile.activePage.attr("id");
                if (!webphone_api.common.isNull(t) && t.indexOf("_settings") > 0) return void setTimeout(function () {
                    de()
                }, 1e3);
                e = webphone_api.common.GetDeviceWidth(), !webphone_api.common.isNull(e) && webphone_api.common.IsNumber(e) || (e = 200)
            }
            webphone_api.common.PutToDebugLog(2, "WARNING, waitForWebphone display Applet, because no handle found_1");
            var n = webphone_api.common.GetDeviceHeight();
            webphone_api.common.isNull(n) && (n = 200), webphone_api.$("#webphone").css("position", "absolute"), webphone_api.$("#webphone").css("top", "100px"), webphone_api.$("#webphone").width(e), webphone_api.$("#webphone").height(n - 100)
        }
        if (!1 === webphone_api.global.applet_started && webphone_api.global.phonestarted < 3) return void setTimeout(function () {
            de()
        }, 250);
        if ((webphone_api.common.isNull(Ze) || webphone_api.common.isNull(eo) || Ze < 10 || eo < 10) && (Ze = webphone_api.common.GetDeviceWidth(),
            (webphone_api.common.isNull(Ze) || webphone_api.common.isNull(eo) || Ze < 50 || eo < 50) && (Ze = 150, eo = 100)), Fe++, He = be()) setTimeout(function () {
                webphone_api.$("#webphone").width(1), webphone_api.$("#webphone").height(1)
            }, 10), webphone_api.global.phonestarted < 2 && (webphone_api.global.phonestarted = 2), webphone_api.common.isNull(document.getElementById("javaerrormsg")) || (document.getElementById("javaerrormsg").style.display = "none"), Fe = 0, webphone_api.common.SaveParameter("isfirststart", "false"), o(), webphone_api.common.PutToDebugLog(2, "EVENT, appletAvailable: " + He), r(); else {
            var i = 0;
            if (i = !0 === Be ? 25 : 50, Fe >= i && webphone_api.global.phonestarted < 3) {
                webphone_api.common.PutToDebugLog(2, "WARNING, waitForWebphone display Applet, because no handle found_2");
                var n = webphone_api.common.GetDeviceHeight();
                webphone_api.common.isNull(n) && (n = 200), webphone_api.$("#webphone").css("position", "absolute"), webphone_api.$("#webphone").css("top", "100px"), webphone_api.$("#webphone").width(Ze - 1), webphone_api.$("#webphone").height(n - 100), webphone_api.common.isNull(document.getElementById("javaerrormsg")) || (document.getElementById("javaerrormsg").style.display = "block")
            }
            setTimeout(function () {
                de()
            }, 450)
        }
    }

    function be() {
        if (!1 === webphone_api.global.applet_started) return !1;
        if (null === Me || void 0 === Me) {
            try {
                Me = document.getElementById("webphone")
            } catch (r) {
            }
            if (null == Me) {
                var e = null;
                try {
                    e = document.applets, 0 == e.length && (e = document.getElementsByTagName("object")), 0 == e.length && (e = document.getElementsByTagName("applet"));
                    for (var o = 0; o < e.length; ++o) try {
                        if ("undefined" != typeof e[o].API_Call) {
                            Me = e[o];
                            break
                        }
                    } catch (r) {
                    }
                } catch (r) {
                }
                if (null == Me) try {
                    Me = document.applets[0]
                } catch (r) {
                }
                null == Me && webphone_api.common.PutToDebugLog(3, "ERROR, webphone: initcheck(), cannot find applet handle")
            }
            if (null != Me) try {
                var t = Me.getSubApplet();
                null != t && (Me = t)
            } catch (r) {
            }
        }
        var n = "", i = navigator.userAgent.toLowerCase();
        try {
            if (null == Me) return !1;
            if (void 0 !== Me && (n = Me.toString()), i.indexOf("msie") > 0 || i.indexOf("trident") > 0) for (var a in Me) if ("contentDocument" === a) {
                if (null == Me) return !1;
                n = Me[a].toString();
                break
            }
        } catch (r) {
            webphone_api.common.PutToDebugLogException(2, "ERROR, webphone: initcheck", r)
        }
        return null == n || "" == n || n.toLowerCase().indexOf("[object") >= 0 && n.toLowerCase().indexOf("[object") < 5 ? (Me = null, !1) : (webphone_api.webphone_handle = Me, !0)
    }

    function _e(e, o, t, n, i) {
        try {
            return be() ? Me.API_SetCredentials(e, o, t, n, i) : (webphone_api.common.PutToDebugLog(3, "ERROR, webphone: API_SetCredentials(), no applethandle "), !1)
        } catch (a) {
            webphone_api.common.PutToDebugLogException(2, "webphone: API_SetCredentials", a)
        }
    }

    function fe(e, o, t, n) {
        try {
            return be() ? Me.API_SetCredentials(e, o, t, n) : (webphone_api.common.PutToDebugLog(3, "ERROR, webphone: API_SetCredentialsMD5(), no applethandle "), !1)
        } catch (i) {
            webphone_api.common.PutToDebugLogException(2, "webphone: API_SetCredentialsMD5", i)
        }
    }

    function we(e) {
        try {
            return be() ? Me.API_CheckVoicemail(e) : (webphone_api.common.PutToDebugLog(3, "ERROR, webphone: API_CheckVoicemail(), no applethandle "), !1)
        } catch (o) {
            webphone_api.common.PutToDebugLogException(2, "webphone: API_CheckVoicemail", o)
        }
    }

    function ve(e) {
        try {
            return be() ? Me.API_SetLine(e) : (webphone_api.common.PutToDebugLog(3, "ERROR, webphone: API_SetLine(), no applethandle "), !1)
        } catch (o) {
            webphone_api.common.PutToDebugLogException(2, "webphone: API_SetLine", o)
        }
    }

    function Ee(e) {
        try {
            return be() ? Me.API_GetLine(e) : (webphone_api.common.PutToDebugLog(3, "ERROR, webphone: API_GetLine(), no applethandle "), !1)
        } catch (o) {
            webphone_api.common.PutToDebugLogException(2, "webphone: API_GetLine", o)
        }
    }

    function Te(e) {
        try {
            return be() ? Me.API_GetLineStatus(e) : (webphone_api.common.PutToDebugLog(3, "ERROR, webphone: API_GetLineStatus(), no applethandle "), !1)
        } catch (o) {
            webphone_api.common.PutToDebugLogException(2, "webphone: API_GetLineStatus", o)
        }
    }

    function Pe(e, o) {
        try {
            return be() ? Me.API_Forward(e, o) : (webphone_api.common.PutToDebugLog(3, "ERROR, webphone: API_Forward(), no applethandle "), !1)
        } catch (t) {
            webphone_api.common.PutToDebugLogException(2, "webphone: API_Forward", t)
        }
    }

    function Se(e) {
        try {
            return be() ? Me.API_IsMuted(e) : (webphone_api.common.PutToDebugLog(3, "ERROR, webphone: API_IsMuted(), no applethandle "), !1)
        } catch (o) {
            webphone_api.common.PutToDebugLogException(2, "webphone: API_IsMuted", o)
        }
    }

    function Ne(e) {
        try {
            return be() ? Me.API_IsOnHold(e) : (webphone_api.common.PutToDebugLog(3, "ERROR, webphone: API_IsOnHold(), no applethandle "), !1)
        } catch (o) {
            webphone_api.common.PutToDebugLogException(2, "webphone: API_IsOnHold", o)
        }
    }

    function Ie(e) {
        try {
            return be() ? Me.API_GetAudioDeviceList(e) : (webphone_api.common.PutToDebugLog(3, "ERROR, webphone: API_GetAudioDeviceList(), no applethandle "), !1)
        } catch (o) {
            webphone_api.common.PutToDebugLogException(2, "webphone: API_GetAudioDeviceList", o)
        }
    }

    function Ce(e) {
        try {
            return be() ? Me.API_GetAudioDevice(e) : (webphone_api.common.PutToDebugLog(3, "ERROR, webphone: API_GetAudioDevice(), no applethandle "), !1)
        } catch (o) {
            webphone_api.common.PutToDebugLogException(2, "webphone: API_GetAudioDevice", o)
        }
    }

    function Re(e) {
        try {
            return be() ? Me.API_SetAudioDevice(e) : (webphone_api.common.PutToDebugLog(3, "ERROR, webphone: API_SetAudioDevice(), no applethandle "), !1)
        } catch (o) {
            webphone_api.common.PutToDebugLogException(2, "webphone: API_SetAudioDevice", o)
        }
    }

    function ye(e) {
        try {
            if (!be()) return webphone_api.common.PutToDebugLog(3, "ERROR, webphone: API_GetVolume(), no applethandle "), !1;
            var o = Me.API_GetVolume(e);
            return webphone_api.common.PutToDebugLog(2, "webphone: GetVolume java returned: " + o.toString()), o
        } catch (t) {
            webphone_api.common.PutToDebugLogException(2, "webphone: API_GetVolume", t)
        }
    }

    function Le() {
        try {
            return be() ? Me.API_RecFiles_Upload() : (webphone_api.common.PutToDebugLog(3, "ERROR, webphone: API_RecFiles_Upload(), no applethandle "), !1)
        } catch (e) {
            webphone_api.common.PutToDebugLogException(2, "webphone: API_RecFiles_Upload", e)
        }
        return !1
    }

    function De(e, o) {
        try {
            return be() ? Me.API_RecFiles_UploadEx(e, o) : (webphone_api.common.PutToDebugLog(3, "ERROR, webphone: API_RecFiles_UploadEx(), no applethandle "), !1)
        } catch (t) {
            webphone_api.common.PutToDebugLogException(2, "webphone: API_RecFiles_UploadEx", t)
        }
        return !1
    }

    function Ge() {
        try {
            return be() ? Me.API_RecFiles_Clear() : (webphone_api.common.PutToDebugLog(3, "ERROR, webphone: API_RecFiles_Clear(), no applethandle "), !1)
        } catch (e) {
            webphone_api.common.PutToDebugLogException(2, "webphone: API_RecFiles_Clear", e)
        }
        return !1
    }

    function Oe() {
        try {
            return be() ? Me.API_RecFiles_Del() : (webphone_api.common.PutToDebugLog(3, "ERROR, webphone: API_RecFiles_Del(), no applethandle "), !1)
        } catch (e) {
            webphone_api.common.PutToDebugLogException(2, "webphone: API_RecFiles_Del", e)
        }
        return !1
    }

    var xe = webphone_api.getbasedir2() + "native", Ae = {
        id: "webphone",
        code: "webphone.webphone.class",
        name: "webphone",
        archive: "webphone.jar",
        codebase: xe,
        width: 1,
        height: 1,
        MAYSCRIPT: !0
    }, ke = "X-Webdomain: " + webphone_api.common.GetWebdomain(), Ue = webphone_api.common.GetParameter("companyname");
    !webphone_api.common.isNull(Ue) && Ue.length > 0 && (ke = ke + "\r\nX-Company: " + Ue);
    var Ve = webphone_api.common.GetParameter("brandname");
    !webphone_api.common.isNull(Ve) && Ve.length > 0 && (ke = ke + "\r\nX-Brand: " + Ve);
    var We, Me, Fe, He, Be, je, $e, qe = {
        serveraddress: "",
        username: "",
        MAYSCRIPT: !0,
        mayscript: "yes",
        scriptable: !0,
        jsscriptevent: 3,
        autocfgsave: 3,
        align: "middle",
        customsipheader: ke,
        loglevel: 5,
        canopenlogview: !1,
        hasincomingcall: !1,
        haschat: 1,
        pluginspage: "https://java.com/download/",
        permissions: "all-permissions",
        alt: "Enable or install java: https://www.java.com/en/download/index.jsp",
        java_arguments: "-Djava.net.preferIPv4Stack=true -Dsun.net.maxDatagramSockets=60"
    }, ze = 300, Ke = 8e3, Xe = null, Je = !1, Ye = 0, Qe = null, Ze = 0, eo = 0, oo = 0;
    return webphone_api.webphone_handle = Me, webphone_api.webphone_pollstatus = !0, {
        InsertApplet: ge,
        Start: t,
        StartWin: i,
        StartService: a,
        LoadApplet: me,
        Restart: s,
        PushContactlist: l,
        StartPresence: r,
        CheckPresence: p,
        SetPresenceStatus: c,
        CheckBLF: u,
        GetVersionNS: h,
        GetVersionNSNum: m,
        GetVersionJava: g,
        IsEncrypted: d,
        RegisterEx: b,
        SetSipHeader: _,
        GetSipHeader: f,
        GetSipHeaderInternal: w,
        GetSipMessage: v,
        GetGetLastInvite: E,
        GetGetLastRecInvite: T,
        GetGetLastSentInvite: P,
        GetWorkDir: S,
        Unregister: N,
        HTTPKeepAlive: I,
        Call: C,
        Hangup: R,
        Accept: y,
        Reject: L,
        Ignore: D,
        Forward: G,
        Conference: O,
        ConferenceEx: x,
        Transfer: A,
        Dtmf: k,
        MuteEx: U,
        IsMuted: V,
        Hold: W,
        IsOnHold: M,
        SendChat: F,
        VoiceRecord: H,
        AudioDevice: B,
        SetVolume: j,
        GetVolume: $,
        PlaySound: q,
        GetRegFailReason: z,
        SetParameter: K,
        SetLine: X,
        SetLineEx: J,
        GetLine: Y,
        LineToCallID: Q,
        CallIDToLine: Z,
        GetLineDetails: ee,
        IsRegistered: oe,
        GetAudioDeviceList: te,
        GetAudioDevice: ne,
        SetAudioDevice: ie,
        SetPushNotifications: ae,
        Exit: re,
        NeedRatingRequest: le,
        Jvoip: he,
        GetLastCallDetails: pe,
        GetIncomingDisplay: ce,
        DelSettings: ue,
        API_SetCredentials: _e,
        API_SetCredentialsMD5: fe,
        API_CheckVoicemail: we,
        API_SetLine: ve,
        API_GetLine: Ee,
        API_GetLineStatus: Te,
        API_Forward: Pe,
        API_IsMuted: Se,
        API_IsOnHold: Ne,
        API_GetAudioDeviceList: Ie,
        API_GetAudioDevice: Ce,
        API_SetAudioDevice: Re,
        API_GetVolume: ye,
        API_RecFiles_Upload: Le,
        API_RecFiles_UploadEx: De,
        API_RecFiles_Clear: Ge,
        API_RecFiles_Del: Oe,
        SendChatIsComposing: se
    }
}(), webphone_api.notifications = function () {
    function e() {
        try {
            webphone_api.global.creditRequestIval = 100, webphone_api.global.closeCallAtivity = !1, b = !1, u = 0;
            var e = webphone_api.common.GetTickCount();
            P = e, S = e, N = e, h = 0, m = !1, g = !1, ve = "", d = "", webphone_api.global.last_event = "", R = e, webphone_api.global.httpkatimer = e, webphone_api.global.audio_devices_loaded = !1, webphone_api.common.GetParameter("cache_audio_rec_device_list").length > 5 && (webphone_api.global.audio_devices_loaded = !0), webphone_api.global.lastcallduration = 0, L = -1, D = e, O = e, B = null, j = "", $ = "";
            var o = webphone_api.common.GetParameter2("ringtimeout"),
                t = webphone_api.common.GetParameter2("ringtimeoutin"),
                n = webphone_api.common.GetParameter2("ringtimeoutout"),
                i = webphone_api.common.GetParameter2("calltimeout");
            if ((webphone_api.common.isNull(o) || o.length < 2 || !1 === webphone_api.common.IsNumber(o)) && (o = 9e4), (webphone_api.common.isNull(t) || t.length < 2 || !1 === webphone_api.common.IsNumber(t)) && (t = 0), (webphone_api.common.isNull(n) || n.length < 2 || !1 === webphone_api.common.IsNumber(n)) && (n = 0), (webphone_api.common.isNull(i) || i.length < 2 || !1 === webphone_api.common.IsNumber(i)) && (o = 108e5), A = webphone_api.common.StrToInt(o), k = webphone_api.common.StrToInt(t), U = webphone_api.common.StrToInt(n), V = webphone_api.common.StrToInt(i), webphone_api.global.ringstart_time = 0, webphone_api.global.callstart_time = 0, webphone_api.global.useajax_forservice = !1, webphone_api.global.wsuser_succeded = !1, W = !1, webphone_api.global.acallcount = 0, webphone_api.global.enstarteddisplayed = !1, M = !1, we = 0, webphone_api.global.httpheaderslogged = !1, webphone_api.global.onregisteredcalled = !1, webphone_api.global.wsc_contimeout = 0, webphone_api.global.wsc_reqtimeout = 0, webphone_api.global.firstregister_sessiontick = 0, webphone_api.common.isNull(document.getElementById("loader"))) if (webphone_api.common.PutToDebugLog(2, "EVENT, init adding loader iframe, because not found in page"), webphone_api.common.isNull(document.body)) webphone_api.common.PutToDebugLog(2, "ERROR, init adding loader iframe, document.body is NULL"); else {
                var a = document.createElement("iframe");
                a.style.display = "none", a.style.height = "0", a.style.width = "0", a.id = "loader", a.setAttribute("allow", "microphone; camera"), document.body.appendChild(a)
            }
        } catch (r) {
            webphone_api.common.PutToDebugLogException(2, "notifications: Init", r)
        }
    }

    function o(t) {
        var l = 0;
        try {
            if (webphone_api.global.initcalled || (webphone_api.global.initcalled = !0, e()), !webphone_api.common.isNull(t) && t.length > 0) try {
                var u = t.split(",");
                if (!webphone_api.common.isNull(u) && u.length > 0) {
                    for (var h = "", P = 0; P < u.length; P++) webphone_api.common.isNull(u[P]) && (u[P] = ""), u[P] = webphone_api.common.Trim(u[P]), 0 === u[P].indexOf("_BASE64_") && (u[P] = webphone_api.common.B64Dec(u[P]), webphone_api.common.isNull(u[P]) && (u[P] = ""), u[P] = webphone_api.common.Trim(u[P])), h.length > 0 && (h += ","), h += u[P];
                    !webphone_api.common.isNull(h) && h.length > 0 && (t = h)
                }
            } catch (ot) {
                webphone_api.common.PutToDebugLogException(2, "notifications: ProcessNotifications base64 decode", ot)
            }
            if (ne < 0 && (ne = webphone_api.common.IsCExt()), webphone_api.common.isNull(Q) && webphone_api.common.getuseengine().length > 0 && (Q = webphone_api.common.Te2(), webphone_api.common.getuseengine() !== webphone_api.global.ENGINE_WEBRTC && (Q = !1), Q)) {
                var S = [];
                S.push("L"), S.push("i"), S.push("m"), S.push("i"), S.push("t"), S.push(" "), S.push("f"), S.push("u"), S.push("n"), S.push("c");
                var N = S.join("");
                setTimeout(function () {
                    webphone_api.common.PutToDebugLog(3, "EVENT, " + N)
                }, 920), S = [], S.push("S"), S.push("T"), S.push("A"), S.push("T"), S.push("U"), S.push("S"), te = S.join("")
            }
            if (Q && !webphone_api.common.isNull(te) && te.length > 0) {
                var R = "";
                if (!webphone_api.common.isNull(webphone_api.global.ep) && webphone_api.global.ep.length > 0) for (var P = 0; P < webphone_api.global.ep.length; P++) if (!webphone_api.common.isNull(webphone_api.global.ep[P][webphone_api.common.EP_CALLID]) && webphone_api.global.ep[P][webphone_api.common.EP_CALLID].length > 3) {
                    R = webphone_api.global.ep[P][webphone_api.common.EP_CALLID];
                    break
                }
                !webphone_api.common.isNull(R) && R.length > 3 && !1 === p(R) && t.indexOf(te) >= 0 && (t = t.replace(te, ""), t = webphone_api.common.Trim(t), t = t.substring(1), t = webphone_api.common.Trim(t))
            }
            if (l = 10, !b) {
                webphone_api.global.presence_started = !1, b = !0, webphone_api.common.isNull(webphone_api.global.maintimerid) || clearInterval(webphone_api.global.maintimerid), webphone_api.global.maintimerid = null, webphone_api.global.maintimerid = setInterval(function () {
                    n()
                }, I), webphone_api.common.LcAc(!0, !1), l = 14;
                try {
                    if (0 == webphone_api.common.IsSDK()) {
                        var D = webphone_api.common.GetColortheme(), G = webphone_api.themes.gettheme("theme_" + D);
                        if (webphone_api.common.isNull(G)) y = "#ffffff"; else {
                            var O = G.fontcstatus;
                            y = webphone_api.common.isNull(O.match(/^#([0-9a-f]{3}|[0-9a-f]{6})$/i)) ? "#ffffff" : O
                        }
                    }
                } catch (tt) {
                    webphone_api.common.PutToDebugLogException(2, "notifications: ProcessNotifications at init 1", tt)
                }
            }
            if (l = 20, webphone_api.common.isNull(t) || t.length < 1) return;
            if (t = t.replace("NORETRY", ""), K = webphone_api.common.Trim(t), 0 === K.indexOf("START") && (K.indexOf("api") > 0 || K.indexOf("sip") > 0) && (webphone_api.global.apistartstate = 2, webphone_api.plhandler.GetAudioDevicesForMenu(100)), !1 === webphone_api.global.applet_started && webphone_api.common.getuseengine() === webphone_api.global.ENGINE_WEBPHONE && "START,api" === K) {
                webphone_api.global.applet_started = !0, l = 24;
                var x = webphone_api.common.GetParameter2("serveraddress_user");
                if ((webphone_api.common.isNull(x) || x.length < 2) && (x = webphone_api.common.GetParameter2("serveraddress")), (webphone_api.common.isNull(x) || x.length < 2) && webphone_api.common.PutToDebugLog(2, "EVENT, notifications ProcessNotifications serveraddress not set"), !1 === webphone_api.global.usestorage && !webphone_api.common.CheckDID(x, !1)) {
                    var S = [];
                    S.push("E"), S.push("R"), S.push("R"), S.push("O"), S.push("R"), S.push(","), S.push("S"), S.push("e"), S.push("r"), S.push("v"), S.push("e"), S.push("r"), S.push(" "), S.push("n"), S.push("o"), S.push("t"), S.push(" "), S.push("a"), S.push("l"), S.push("l"), S.push("o"), S.push("w"), S.push("e"), S.push("d"), S.push("_"), S.push("3");
                    var N = S.join("");
                    return l = 26, void setTimeout(function () {
                        webphone_api.common.PutToDebugLog(1, N + " " + x)
                    }, 1251)
                }
            }
            if (l = 30, K.indexOf("CHATCOMPOSING") >= 0) {
                var A = 0, k = "", U = K.indexOf(",");
                if (U > 0 && (l = 32, K = K.substring(U + 1), (U = K.indexOf(",")) > 0 && (l = 34, A = webphone_api.common.Trim(K.substring(0, U)), K = K.substring(U + 1), (U = K.indexOf(",")) > 0))) {
                    l = 36, k = webphone_api.common.Trim(K.substring(0, U));
                    var V = webphone_api.common.Trim(K.substring(U + 1));
                    !webphone_api.common.isNull(V) && webphone_api.common.IsNumber(V) && 1 === webphone_api.common.StrToInt(V) && (l = 39, s(k + " " + webphone_api.stringres.get("composing") + "...", "EVENT", 1, -1))
                }
                return
            }
            if (l = 40, K.indexOf("SERVERCONTACTS") >= 0) {
                if (webphone_api.common.PutToDebugLog(3, "EVENT, notifications: " + K), K.toLowerCase().indexOf("error") >= 0) return void webphone_api.common.PutToDebugLog(2, "ERROR, notifications: " + K);
                l = 44;
                var M = "", U = 0;
                U = K.indexOf(","), U > 0 && (M = webphone_api.common.Trim(K.substring(U + 1, K.length))), l = 48, webphone_api.common.SaveParameter("servercontacts", M), !webphone_api.common.isNull(M) && M.length > 0 && webphone_api.common.PutToDebugLog(2, "EVENT, servercontacts list: " + M)
            }
            if (l = 50, K.indexOf("PRESENCE") >= 0 && !0 === webphone_api.common.UsePresence2()) {
                if (webphone_api.common.PutToDebugLog(3, "EVENT, notifications: " + K), K.toLowerCase().indexOf("error") >= 0) return void webphone_api.common.PutToDebugLog(2, "ERROR, notifications: " + K);
                var F = "", U = 0;
                if (U = K.indexOf(","), l = 54, U > 0) {
                    F = webphone_api.common.Trim(K.substring(U + 1, K.length));
                    var H = "", ie = "", ae = "", le = "", pe = "", ce = F.split(",");
                    if (!webphone_api.common.isNull(ce) && ce.length > 1) {
                        H = webphone_api.common.Trim(ce[0]), ie = webphone_api.common.Trim(ce[1]), ce.length > 2 && (ae = webphone_api.common.Trim(ce[2])), ce.length > 3 && (le = webphone_api.common.Trim(ce[3])), ce.length > 4 && (pe = webphone_api.common.Trim(ce[4]));
                        var ue = "-1";
                        (webphone_api.common.isNull(ae) || ae.length < 1) && (ae = ie), ue = webphone_api.common.SaveReceivedPresence2(H, ae), "-2" === ue && ie.length > 1 && ae !== ie && (ue = webphone_api.common.SaveReceivedPresence2(H, ie));
                        try {
                            webphone_api.onPresenceCb(H, ie, le, pe)
                        } catch (nt) {
                            webphone_api.common.PutToDebugLogException(2, "There is an error in onPresenceStateChange() callback", nt)
                        }
                        l = 58, !1 === webphone_api.common.IsSDK() && webphone_api._dialpad.PopulateListRecents(), l = 59, !0 === webphone_api.global.isContactdetailsStarted && !1 === webphone_api.common.IsSDK() && webphone_api._contactdetails.PopulateData(), !0 === webphone_api.global.isMessageStarted && webphone_api._message.DisplayPresence(ue)
                    }
                }
            }
            if (K.indexOf("BLF") >= 0 && webphone_api.common.GetParameterInt("enableblf", 1) > 0) {
                if (webphone_api.common.PutToDebugLog(3, "EVENT, notifications: " + K), K.toLowerCase().indexOf("error") >= 0) return void webphone_api.common.PutToDebugLog(2, "ERROR, notifications: " + K);
                var he = "", U = 0;
                if (U = K.indexOf(","), l = 54, U > 0) {
                    he = webphone_api.common.Trim(K.substring(U + 1, K.length));
                    var H = "", me = "", ie = "", ge = "", de = he.split(",");
                    if (!webphone_api.common.isNull(de) && de.length > 1) {
                        H = webphone_api.common.Trim(de[0]), me = webphone_api.common.Trim(de[1]), de.length > 2 && (ie = webphone_api.common.Trim(de[2])), de.length > 3 && (ge = webphone_api.common.Trim(de[3]));
                        try {
                            webphone_api.onBLFCb(H, me, ie, ge)
                        } catch (nt) {
                            webphone_api.common.PutToDebugLogException(2, "There is an error in onBLFStateChange() callback", nt)
                        }
                    }
                }
            }
            l = 60, q = "", z = "";
            var U = 0;
            if ("[" === K.charAt(0) && (U = K.indexOf("]")) > 0 && (K = webphone_api.common.Trim(K.substring(U + 1, K.length))), l = 63, U = K.indexOf(","), U > 0 ? (q = webphone_api.common.Trim(K.substring(0, U)), K = webphone_api.common.Trim(K.substring(U + 1, K.length))) : q = "EVENT", l = 65, "ANSWER" === q) return l = 69, void webphone_api.common.HttpAsyncHandler(K);
            if (l = 70, "DTMF" === q) {
                var be = -1, _e = webphone_api.common.Trim(t), fe = _e.indexOf(",");
                fe > 0 && (_e = _e.substring(fe + 1), (fe = _e.indexOf(",")) > 0 && (_e = webphone_api.common.Trim(_e.substring(0, fe)), !webphone_api.common.isNull(_e) && webphone_api.common.IsNumber(_e) && (be = webphone_api.common.StrToInt(_e))));
                try {
                    webphone_api.onDTMFCb(K, be)
                } catch (nt) {
                    webphone_api.common.PutToDebugLogException(2, "There is an error in onDTMF() callback", nt)
                }
            }
            if ("STATUS" !== q && "CDR" !== q && "CHAT" !== q && "SUBSCRIBE" !== q && "NOTIFY" !== q && "EVENT" !== q && "ERROR" !== q && "WARNING" !== q && "POPUP" !== q && "CREDIT" !== q && "RATING" !== q && "MWI" !== q && "START" !== q && "VREC" !== q && "DTMF" !== q && "PRESENCE" !== q && "CHATREPORT" !== q && "CHATCOMPOSING" !== q && "BLF" !== q && "LINE" !== q && "STOP" !== q && "LINEDETAILS" !== q && "QRCODE" !== q && "NOTIFICATION" !== q && "GROUP" !== q) return l = 74, void (!1 === Q && webphone_api.common.PutToDebugLog(5, "WARNING, unknown notification a: " + t));
            l = 71;
            try {
                webphone_api.onEventCb("event", webphone_api.common.Trim(t), null)
            } catch (nt) {
                webphone_api.common.PutToDebugLogException(2, "There is an error in onEvent() callback at notification: " + t, nt)
            }
            try {
                webphone_api.RecEvt(webphone_api.common.Trim(t))
            } catch (nt) {
                webphone_api.common.PutToDebugLogException(2, "There is an error in onEvents() callback at notification: " + t, nt)
            }
            try {
                ne > 0 && "undefined" != typeof AndroidWebphoneJsInterface && null !== AndroidWebphoneJsInterface && "undefined" != typeof AndroidWebphoneJsInterface.jstoandroidEvents && null !== AndroidWebphoneJsInterface.jstoandroidEvents && AndroidWebphoneJsInterface.jstoandroidEvents(t)
            } catch (nt) {
                webphone_api.common.PutToDebugLogException(2, "notifications: ProcessNotifications AndroidWebphoneJsInterface send", nt)
            }
            if (t.indexOf("-1,Stop") >= 0 && webphone_api.global.phonestarted > 0 && webphone_api.common.OpenSettings(!0, 8), "GROUP" === q && K.toLowerCase().indexOf("error") < 0 && !1 === webphone_api.common.IsSDK()) try {
                var we = K.split(",");
                if (!webphone_api.common.isNull(we) && we.length > 2) {
                    var ve = we[2];
                    !webphone_api.common.isNull(ve) && ve.length > 0 && isCallStarted && null != Call.instance && (CommonGUI.GetObj().PutToDebugLog(2, "EVENT, Group conference update peers to: " + ve), webphone_api.$("#page_call_additional_info").html(ve), webphone_api.$("#page_call_peer_details").html(""), webphone_api.$("#page_call_peer_details").hide(), webphone_api.$("#display_notmain_account").html(""), webphone_api.$("#display_notmain_account").hide(), webphone_api.$("#contact_image_img").attr("src", webphone_api.common.GetElementSource() + "images/default_contact_conf.png"))
                }
            } catch (it) {
                webphone_api.common.PutToDebugLogException(2, "notifications ProcessNotifications handle group conference", it)
            }
            if ("QRCODE" === q && webphone_api.common.ParseQRcode(K), "CHATREPORT" === q) {
                var Ee = K.split(",");
                if (!webphone_api.common.isNull(Ee) && Ee.length > 5) {
                    var Te = Ee[1], Pe = Ee[2], Se = Ee[5];
                    if (webphone_api.common.isNull(Te) && (Te = ""), Te = webphone_api.common.Trim(Te), Te = Te.toLowerCase(), webphone_api.common.isNull(Pe) && (Pe = ""), Pe = webphone_api.common.Trim(Pe), webphone_api.common.isNull(Se) && (Se = ""), Se = webphone_api.common.Trim(Se), "2" == Pe || "4" == Pe) {
                        var Ne = "chat_" + webphone_api.common.GetSipusername() + "_" + Te;
                        Te.length > 0 && Pe.length > 0 && Se.length > 0 && (Se = Se.toLowerCase(), webphone_api.common.IsWindowsSoftphone() ? webphone_api.common.ApiWinLoadFile(Ne, function (e) {
                            webphone_api.common.isNull(e) && (e = ""), r(Ne, Pe, Se, e, Te)
                        }) : webphone_api.File.ReadFile(Ne, webphone_api.global.STORAGE_LOCAL, function (e) {
                            webphone_api.common.isNull(e) && (e = ""), r(Ne, Pe, Se, e, Te)
                        }))
                    }
                }
            }
            if ("LINEDETAILS" === q) {
                var Ie = K.split(",");
                if (!webphone_api.common.isNull(Ie) && Ie.length > 10) {
                    webphone_api.common.PutToDebugLog(2, "EVENT, update ep from received LINEDETAILS notification");
                    var Ce = Ie[0], Re = Ie[3], ye = Ie[2], Le = Ie[5], De = Ie[8], Ge = Ie[9];
                    webphone_api.common.SaveCallSession(Ce, null, Re, Le, -1, -1, -1, null, ye, "", "", "", De, Ge, "")
                }
            }
            if ("LINE" === q) {
                var Oe = -20, xe = K, U = xe.indexOf(",");
                if (U > 0 && (xe = xe.substring(0, U)), xe = webphone_api.common.Trim(xe), webphone_api.common.IsNumber(xe) && (Oe = webphone_api.common.StrToInt(xe)), Oe > -5) return void (webphone_api.global.aline = Oe)
            }
            if (l = 80, "STATUS" === q) {
                webphone_api.global.apistartstate = 2, d = K;
                var Ae = c(t, -1);
                webphone_api.global.lnstat[Ae] = [webphone_api.common.GetTickCount(), K]
            }
            if (("STATUS" === q || "EVENT" === q) && K.toLowerCase().indexOf("permission") < 0 && (webphone_api.global.last_event = K), !0 === webphone_api.common.Glbr() && "CREDIT" === q) T = !0, webphone_api.global.credit = " " + K; else if (!0 === webphone_api.common.Glbr() && "RATING" === q) l = 82, webphone_api.global.rating = " (" + webphone_api.common.Trim(K) + ")"; else if ("MWI" === q && (l = 83, !webphone_api.common.isNull(K) && K.length > 0 && K.indexOf(",") >= 0)) {
                var ke = K.split(",");
                if (!webphone_api.common.isNull(ke) && ke.length >= 2) if ("no" === ke[0]) l = 85, 60 === webphone_api.common.GetConfigInt("brandid", -1) ? webphone_api.common.SetNotCounter("dialpad_message_counter", "0") : webphone_api.common.SetNotCounter("dialpad_voicemail_counter", "0"); else {
                    l = 87;
                    var Ue = ke[2];
                    webphone_api.common.isNull(Ue) && (Ue = ""), Ue = webphone_api.common.Trim(Ue), Ue.length > 0 && webphone_api.common.IsNumber(Ue) && (l = 88, webphone_api.common.PutToDebugLog(3, "EVENT, New voicemail messages found: " + Ue), 60 === webphone_api.common.GetConfigInt("brandid", -1) ? webphone_api.common.SetNotCounter("dialpad_message_counter", Ue) : webphone_api.common.SetNotCounter("dialpad_voicemail_counter", Ue))
                }
            }
            l = 90;
            var Ve = K.indexOf("POPUP");
            if (Ve >= 0) {
                var We = K.substring(Ve + 5);
                We = webphone_api.common.Trim(We), Ve = We.indexOf(","), Ve >= 0 && (We = We.substring(Ve + 1)), l = 94, !webphone_api.common.isNull(We) && We.length > 0 && webphone_api.common.ShowToast(We, 5e3)
            }
            if (U = K.indexOf(","), K = webphone_api.common.Trim(K), U > 0 && (K = webphone_api.common.Trim(K.substring(U + 1, K.length))), l = 96, U = K.indexOf(","), U > 0 ? (z = webphone_api.common.Trim(K.substring(0, U)), K = webphone_api.common.Trim(K.substring(U + 1, K.length))) : z = K, l = 100, U = z.indexOf("("), U > 0 && z.indexOf(ee) < 0 && z.indexOf(oe) < 0 && (z = webphone_api.common.Trim(z.substring(0, U))), z.length < 1 && !1 === Q) return void webphone_api.common.PutToDebugLog(5, "WARNING, unknown notification b: " + t);
            if (K.length < 1 && !1 === Q) return void webphone_api.common.PutToDebugLog(5, "WARNING, unknown notification c: " + t);
            if (l = 110, "CDR" === q && (webphone_api.common.PutToDebugLog("EVENT, notifications: ProcessNotifications CDR received: " + t, 5), webphone_api.global.lastcallcdr = t, (U = t.indexOf(",")) > 0)) try {
                var Me = "";
                l = 115;
                var Fe = t.split(","), He = Fe[1], H = Fe[2], Be = Fe[3], je = Fe[4], $e = (Fe[5], Fe[6]), qe = Fe[7],
                    ze = Fe[8], Ke = Fe[9], ge = "";
                Fe.length > 10 && (ge = Fe[10]);
                var Xe = 2;
                H === je && (Xe = 1), webphone_api.common.isNull(Ke) && (Ke = ""), Ke.indexOf("[") > 0 && (Ke = Ke.substring(0, Ke.indexOf("["))), l = 120, webphone_api.common.getuseengine() === webphone_api.global.ENGINE_WEBRTC && webphone_api.common.GetDiscReasonFromSignaling(function (e) {
                    (webphone_api.common.isNull(e) || e.length < 2) && (e = Ke), !0 === webphone_api.global.dontshowdiscreason ? webphone_api.common.PutToDebugLog(2, "EVENT, " + webphone_api.stringres.get("disc_reason") + ": " + e) : (webphone_api.common.PutToDebugLog(1, "EVENT, " + webphone_api.stringres.get("disc_reason") + ": " + e), s(webphone_api.stringres.get("disc_reason") + ": " + e, "EVENT", 0, webphone_api.common.StrToIntDef(He, -1)))
                }), webphone_api.global.lastcalldetails = "", webphone_api.common.GetParameter("devicetype") !== webphone_api.common.DEVICE_WIN_SOFTPHONE() && webphone_api.common.getuseengine() !== webphone_api.global.ENGINE_SERVICE || webphone_api.common.WinAPI("API_GetLastCallDetails", null), l = 124;
                var Je = "<br>", me = "outgoing";
                if (2 === Xe && (me = "incoming"), webphone_api.global.lastcalldetails = webphone_api.global.lastcalldetails + "Line: " + He + ", Direction: " + me + Je, webphone_api.global.lastcalldetails = webphone_api.global.lastcalldetails + "Auth Username: " + webphone_api.common.GetSipusername() + Je, 2 === Xe ? (webphone_api.global.lastcalldetails = webphone_api.global.lastcalldetails + "Caller: " + Be + Je, Be !== H && (webphone_api.global.lastcalldetails = webphone_api.global.lastcalldetails + "Caller Name: " + H + Je)) : webphone_api.global.lastcalldetails = webphone_api.global.lastcalldetails + "Caller ID: " + webphone_api.common.GetCallerid() + Je, l = 128, webphone_api.global.lastcalldetails = webphone_api.global.lastcalldetails + "Connecttime: " + $e + " msec" + Je, webphone_api.global.lastcalldetails = webphone_api.global.lastcalldetails + "Duration: " + qe + " msec" + Je, webphone_api.global.lastcalldetails = "1" === ze ? webphone_api.global.lastcalldetails + "Disconnect By: Local" + Je : webphone_api.global.lastcalldetails + "Disconnect By: Remote" + Je, webphone_api.global.lastcalldetails = webphone_api.global.lastcalldetails + "Reason: " + Ke + Je, webphone_api.global.lastcalldetails = webphone_api.global.lastcalldetails + "CDR: " + webphone_api.global.lastcallcdr + Je, webphone_api.common.getuseengine === webphone_api.global.ENGINE_WEBRTC) {
                    var Ye = webphone_api.common.ReplaceAll(webphone_api.global.lastcalldetails, Je, "\n");
                    setTimeout(function () {
                        webphone_api.common.PutToDebugLog(2, "EVENT, Call details:\n" + Ye)
                    }, 1)
                }
                webphone_api.common.getuseengine() !== webphone_api.global.ENGINE_WEBRTC && (!0 === webphone_api.global.dontshowdiscreason ? webphone_api.common.PutToDebugLog(2, "EVENT, " + webphone_api.stringres.get("disc_reason") + ": " + Ke) : (webphone_api.common.PutToDebugLog(1, "EVENT, " + webphone_api.stringres.get("disc_reason") + ": " + Ke), s(webphone_api.stringres.get("disc_reason") + ": " + Ke, "EVENT", 0, webphone_api.common.StrToIntDef(He, -1)))), l = 122;
                try {
                    webphone_api.onCdrCb(Be, je, $e, qe, Xe, H, Ke, webphone_api.common.StrToInt(He), ge)
                } catch (nt) {
                    webphone_api.common.PutToDebugLogException(2, "There is an error in onCdr() callback", nt)
                }
                if (!0 === webphone_api.common.UsePresence2() && !webphone_api.common.isNull(qe) && webphone_api.common.IsNumber(qe)) {
                    if (webphone_api.common.StrToInt(qe) <= 0) webphone_api.common.PutToDebugLog(4, "EVENT,notifications CDR 0 duration get presence status for: " + H), !1 === webphone_api.common.IsSDK() && webphone_api.common.PresenceGet2(H); else {
                        if (!webphone_api.common.isNull(webphone_api.global.presenceHM)) var Qe = webphone_api.global.presenceHM[H];
                        if (!webphone_api.common.isNull(Qe)) {
                            var Ze = Qe[webphone_api.common.PRES_STATUS];
                            webphone_api.common.isNull(Ze) || "0" !== Ze || (webphone_api.common.PutToDebugLog(4, "EVENT,notifications CDR connected call but presence was offline, so set it to online for: " + H), webphone_api.common.SaveReceivedPresence2(H, "online"))
                        }
                    }
                }
                l = 130, !webphone_api.common.isNull(Fe[9]) && Fe[9].length > 0 && webphone_api.common.PutToDebugLog(1, "EVENT, " + Fe[9]), Me = webphone_api.common.Trim(Fe[2]);
                var eo = 0;
                try {
                    eo = webphone_api.common.StrToInt(Fe[7]) / 1e3
                } catch (at) {
                }
                webphone_api.global.lastcallduration = eo, l = 132;
                var oo = "recfile";
                if (2 === Xe ? (_ = !1, !1 === webphone_api.global.acceptReject ? (l = 136, i(Me, "2", oo, eo, He, Ke)) : (l = 137, i(Me, "1", oo, eo, He, Ke)), webphone_api.global.acceptReject = !1) : (l = 138, i(Me, "0", oo, eo, He, Ke)), f = "", oo = "", eo > 60) {
                    var to = webphone_api.common.GetParameterInt("successfulcalls", 0),
                        no = webphone_api.common.GetParameterInt("webrtc_successfulcalls", 0);
                    to < 0 && (to = 0), no < 0 && (no = 0), to++, webphone_api.common.SaveParameter("successfulcalls", to.toString()), webphone_api.common.getuseengine() === webphone_api.global.ENGINE_WEBRTC && (no++, webphone_api.common.SaveParameter("webrtc_successfulcalls", no.toString()));
                    var io = 4;
                    to === io && "Android" === webphone_api.common.GetOs() && (!1 === webphone_api.common.IsSDK() && (webphone_api.common.PutToDebugLog(4, "EVENT, Close call page because trying to display Add to Home Screen popup"), webphone_api._call.CloseCall()), setTimeout(function () {
                        var e = webphone_api.$(".ui-page-active .ui-popup-active").length;
                        !0 === webphone_api.common.IsSDK() || e < 1 ? (webphone_api.common.PutToDebugLog(2, "EVENT, Offer pin to desktop Home Screen Android"), webphone_api.common.AlertDialog(webphone_api.stringres.get("add_to_home_title"), webphone_api.stringres.get("add_to_home_msg"))) : (io -= 1, webphone_api.common.SaveParameter("successfulcalls", io.toString()))
                    }, 500))
                }
            } catch (nt) {
                webphone_api.common.PutToDebugLogException(2, "notifications: ProcessNotifications CDR and save to call history", nt)
            }
            if (l = 140, "STATUS" === q) {
                if ("Registered." === z || "Registered" === z) {
                    webphone_api.global.phonestarted = 3, webphone_api.common.SaveParameter("firststart_webrtc", "false"), webphone_api.common.SaveParameter("last_login_failed", "false");
                    var ao = webphone_api.common.GetParameter("profilepicture");
                    if (!webphone_api.common.isNull(ao) && ao.length > 10 && SetSipHeader("X-Profile: " + ao, -1), webphone_api.global.firstregister_sessiontick < 1 && (webphone_api.global.firstregister_sessiontick = webphone_api.common.GetTickCount()), webphone_api.common.getuseengine() === webphone_api.global.ENGINE_WEBRTC && 2 === webphone_api.global.usuk.length && webphone_api.common.SaveParameter("last_good_webrtc_gw", webphone_api.global.usuk), !1 === webphone_api.common.IsSDK() && ("undefined" != typeof webphone_api._dialpad && null !== webphone_api._dialpad ? webphone_api._dialpad.HandleAutoaction() : console && console.log && console.log("ERROR, notifications ProcessNotifications webphone_api._dialpad is not defined")), l = 141, !0 === webphone_api.common.UsePresence2() && !1 === webphone_api.global.pres_set_at_start && (l = 142, setTimeout(function () {
                        webphone_api.global.pres_set_at_start = !0, webphone_api.common.PutToDebugLog(2, "EVENT,SetSelectedPresence to Online on notification reg"), webphone_api.common.SetSelectedPresence("Online"), webphone_api.common.getuseengine() === webphone_api.global.ENGINE_WEBRTC && webphone_api.webrtcapi.SetSipHeader(-2, "X-IMStatus:" + webphone_api.common.GetParameter("presencestatus"))
                    }, 200)), l = 143, !1 === webphone_api.global.onregisteredcalled) {
                        webphone_api.global.onregisteredcalled = !0;
                        try {
                            webphone_api.onRegStateChangeCb("registered", null)
                        } catch (nt) {
                            webphone_api.common.PutToDebugLogException(2, "There is an error in onRegStateChangeCb(registered) callback", nt)
                        }
                        try {
                            webphone_api.onRegisteredCb()
                        } catch (nt) {
                            webphone_api.common.PutToDebugLogException(2, "There is an error in onRegistered() callback", nt)
                        }
                    }
                    if (webphone_api.$("#webphone").width(1), webphone_api.$("#webphone").height(1), l = 145, l = 147, !0 === webphone_api.common.Glbr() && !T) {
                        var ro = webphone_api.common.GetParameter("creditrequest");
                        !webphone_api.common.isNull(ro) && ro.length > 0 && (l = 148, webphone_api.common.UriParser(ro, "", "", "", "", "creditrequest"))
                    }
                }
                if (l = 150, z.toLowerCase().indexOf("unregistered") >= 0 && (webphone_api.global.authenticated_displayed = !1, !1 === webphone_api.global.onunregistered_flag)) {
                    webphone_api.global.onunregistered_flag = !0, webphone_api.global.onregisteredcalled = !1, setTimeout(function () {
                        webphone_api.global.onunregistered_flag = !1
                    }, 2e3), l = 152;
                    try {
                        webphone_api.onRegStateChangeCb("unregistered", null)
                    } catch (nt) {
                        webphone_api.common.PutToDebugLogException(2, "notifications: There is an error in onRegStateChangeCb(unregistered) callback", nt)
                    }
                    try {
                        webphone_api.onUnRegisteredCb()
                    } catch (nt) {
                        webphone_api.common.PutToDebugLogException(2, "notifications: There is an error in onUnRegistered() callback", nt)
                    }
                }
                if (l = 160, "InProgress" === z) {
                    var so = K.split(",");
                    if (webphone_api.common.isNull(so) || so.length < 3) return void webphone_api.common.PutToDebugLog(3, "EVENT, ProcessNotifications, skip InProgress event, because not enough parameters: " + K);
                    var lo = "", H = "", me = "", po = t.replace(" ", ""), co = "";
                    !webphone_api.common.isNull(so) && so.length > 4 && (co = so[4]), !webphone_api.common.isNull(so) && so.length > 2 && (!webphone_api.common.isNull(so[0]) && so[0].length > 1 ? lo = webphone_api.common.Trim(so[0]) : !webphone_api.common.isNull(so[1]) && so[1].length > 1 && (lo = webphone_api.common.Trim(so[1])), !webphone_api.common.isNull(so[2]) && so[2].length > 0 && (me = webphone_api.common.Trim(so[2])), so.length > 3 && (H = so[3], (webphone_api.common.isNull(H) || H.length < 1) && (H = lo))), webphone_api.common.isNull(lo) && (lo = "");
                    var Oe = webphone_api.global.aline;
                    if (webphone_api.common.getuseengine() !== webphone_api.global.ENGINE_WEBRTC) {
                        var uo = webphone_api.common.Trim(t), ho = uo.indexOf(",");
                        ho > 0 && (uo = uo.substring(ho + 1), uo = webphone_api.common.Trim(uo), (ho = uo.indexOf(",")) > 0 && (uo = uo.substring(0, ho), uo = webphone_api.common.Trim(uo), !webphone_api.common.isNull(uo) && webphone_api.common.IsNumber(uo) && (Oe = webphone_api.common.StrToInt(uo), webphone_api.global.aline = Oe)))
                    }
                    if (1 !== webphone_api.common.GetApibehaviour()) try {
                        webphone_api.onCallStateChangeCb("callTrying", webphone_api.common.StrToInt(me), lo, H, Oe, co)
                    } catch (nt) {
                        webphone_api.common.PutToDebugLogException(2, "There is an error in onCallStateChange() callback callTrying", nt)
                    }
                    try {
                        webphone_api.onCallStateChangeCb("trying", webphone_api.common.StrToInt(me), lo, H, Oe, co)
                    } catch (nt) {
                        webphone_api.common.PutToDebugLogException(2, "There is an error in onCallStateChange() callback trying", nt)
                    }
                }
                if ("Midcall" === z) {
                    var so = K.split(",");
                    if (webphone_api.common.isNull(so) || so.length < 3) return void webphone_api.common.PutToDebugLog(3, "EVENT, ProcessNotifications, skip Midcall event, because not enough parameters: " + K);
                    var lo = "", H = "", me = "", po = t.replace(" ", ""), co = "";
                    !webphone_api.common.isNull(so) && so.length > 4 && (co = so[4]), !webphone_api.common.isNull(so) && so.length > 2 && (!webphone_api.common.isNull(so[0]) && so[0].length > 1 ? lo = webphone_api.common.Trim(so[0]) : !webphone_api.common.isNull(so[1]) && so[1].length > 1 && (lo = webphone_api.common.Trim(so[1])), !webphone_api.common.isNull(so[2]) && so[2].length > 0 && (me = webphone_api.common.Trim(so[2])), so.length > 3 && (H = so[3], (webphone_api.common.isNull(H) || H.length < 1) && (H = lo))), webphone_api.common.isNull(lo) && (lo = "");
                    var Oe = webphone_api.global.aline;
                    if (webphone_api.common.getuseengine() !== webphone_api.global.ENGINE_WEBRTC) {
                        var uo = webphone_api.common.Trim(t), ho = uo.indexOf(",");
                        ho > 0 && (uo = uo.substring(ho + 1), uo = webphone_api.common.Trim(uo), (ho = uo.indexOf(",")) > 0 && (uo = uo.substring(0, ho), uo = webphone_api.common.Trim(uo), !webphone_api.common.isNull(uo) && webphone_api.common.IsNumber(uo) && (Oe = webphone_api.common.StrToInt(uo), webphone_api.global.aline = Oe)))
                    }
                    if (1 === webphone_api.common.GetApibehaviour()) try {
                        webphone_api.onCallStateChangeCb("midcall", webphone_api.common.StrToInt(me), lo, H, Oe, co)
                    } catch (nt) {
                        webphone_api.common.PutToDebugLogException(2, "There is an error in onCallStateChange() callback midcall", nt)
                    }
                }
                if (z === webphone_api.stringres.get("muted") || z === webphone_api.stringres.get("unmuted")) {
                    var po = t.replace(" ", ""), so = po.split(","), Oe = webphone_api.global.aline;
                    if (!webphone_api.common.isNull(so) && so.length > 1 && webphone_api.common.IsNumber(so[1]) && (Oe = webphone_api.common.StrToInt(so[1])), 1 === webphone_api.common.GetApibehaviour()) if (z === webphone_api.stringres.get("muted")) try {
                        webphone_api.onCallStateChangeCb("muted", "", "", "", Oe, "")
                    } catch (nt) {
                        webphone_api.common.PutToDebugLogException(2, "There is an error in onCallStateChange() callback muted", nt)
                    } else try {
                        webphone_api.onCallStateChangeCb("unmuted", "", "", "", Oe, "")
                    } catch (nt) {
                        webphone_api.common.PutToDebugLogException(2, "There is an error in onCallStateChange() callback unmuted", nt)
                    }
                }
                if ("Transfer" === z && 1 === webphone_api.common.GetApibehaviour()) try {
                    webphone_api.onCallStateChangeCb("transfer", "", "", "", -1, "")
                } catch (nt) {
                    webphone_api.common.PutToDebugLogException(2, "There is an error in onCallStateChange() callback transfer", nt)
                }
                if (t.indexOf("EVENT,Hold") >= 0) {
                    if (1 === webphone_api.common.GetApibehaviour()) try {
                        webphone_api.onCallStateChangeCb("hold", "", "", "", "", "")
                    } catch (nt) {
                        webphone_api.common.PutToDebugLogException(2, "There is an error in onCallStateChange() callback hold", nt)
                    }
                } else if (t.indexOf("EVENT,Reload") >= 0 && 1 === webphone_api.common.GetApibehaviour()) try {
                    webphone_api.onCallStateChangeCb("reload", "", "", "", "", "")
                } catch (nt) {
                    webphone_api.common.PutToDebugLogException(2, "There is an error in onCallStateChange() callback reload", nt)
                }
                if (t.indexOf("EVENT,conference created") >= 0 && 1 === webphone_api.common.GetApibehaviour()) try {
                    webphone_api.onCallStateChangeCb("conference", "", "", "", "", "")
                } catch (nt) {
                    webphone_api.common.PutToDebugLogException(2, "There is an error in onCallStateChange() callback conference", nt)
                }
                if ("CallSetup" === z || "Ringing" === z) {
                    var so = K.split(",");
                    if (webphone_api.common.isNull(so) || so.length < 3) return void webphone_api.common.PutToDebugLog(3, "EVENT, ProcessNotifications, skip ringing event, because not enough parameters: " + K);
                    var lo = "", H = "", me = "", po = t.replace(" ", ""), mo = "";
                    if (!webphone_api.common.isNull(so) && so.length > 1 && (mo = so[1]), !1 === webphone_api.common.UserExists(mo)) return webphone_api.common.PutToDebugLog(2, "EVENT, Skip this notification proccessisng"), X = z, J = "STATUS", void (Y = se);
                    var co = "";
                    !webphone_api.common.isNull(so) && so.length > 4 && (co = so[4]), !webphone_api.common.isNull(so) && so.length > 2 && (!webphone_api.common.isNull(so[0]) && so[0].length > 1 ? lo = webphone_api.common.Trim(so[0]) : !webphone_api.common.isNull(so[1]) && so[1].length > 1 && (lo = webphone_api.common.Trim(so[1])), l = 163, !webphone_api.common.isNull(so[2]) && so[2].length > 0 && (me = webphone_api.common.Trim(so[2])), l = 164, so.length > 3 && (H = so[3], (webphone_api.common.isNull(H) || H.length < 1) && (H = lo))), l = 167, webphone_api.common.isNull(lo) && (lo = "");
                    var Oe = webphone_api.global.aline;
                    if (webphone_api.common.getuseengine() !== webphone_api.global.ENGINE_WEBRTC) {
                        var uo = webphone_api.common.Trim(t), ho = uo.indexOf(",");
                        l = 169, ho > 0 && (uo = uo.substring(ho + 1), uo = webphone_api.common.Trim(uo), (ho = uo.indexOf(",")) > 0 && (l = 172, uo = uo.substring(0, ho), uo = webphone_api.common.Trim(uo), !webphone_api.common.isNull(uo) && webphone_api.common.IsNumber(uo) && (l = 175, Oe = webphone_api.common.StrToInt(uo), webphone_api.global.aline = Oe)))
                    }
                    if ("CallSetup" == $ && "Ringing" === z) {
                        if (1 !== webphone_api.common.GetApibehaviour()) try {
                            webphone_api.onCallStateChangeCb("callRinging", webphone_api.common.StrToInt(me), lo, H, Oe, co)
                        } catch (nt) {
                            webphone_api.common.PutToDebugLogException(2, "There is an error in onCallStateChange() callback callRinging", nt)
                        }
                        try {
                            webphone_api.onCallStateChangeCb("ringing", webphone_api.common.StrToInt(me), lo, H, Oe, co)
                        } catch (nt) {
                            webphone_api.common.PutToDebugLogException(2, "There is an error in onCallStateChange() callback ringing", nt)
                        }
                        "1" == me ? (l = 271, webphone_api.common.CallScriptingUrl(webphone_api.parameters.scurl_onoutcallringing, "callRinging", me, lo, lo, "")) : (l = 272, webphone_api.common.CallScriptingUrl(webphone_api.parameters.scurl_onincallringing, "callRinging", me, lo, lo, ""))
                    }
                    if ($ = z, !webphone_api.common.isNull(j) && j.length > 0 && j === co) return;
                    var go = !1, bo = webphone_api.global.aline;
                    if (webphone_api.common.getuseengine() === webphone_api.global.ENGINE_WEBRTC && webphone_api.common.GetNrOfActiveCalls() > 0 && "Firefox" === webphone_api.common.GetBrowser() && !webphone_api.common.isNull(webphone_api.global.ep) && webphone_api.global.ep.length > 0) for (var P = 0; P < webphone_api.global.ep.length; P++) if (!webphone_api.common.isNull(webphone_api.global.ep[P]) && "true" == webphone_api.global.ep[P][webphone_api.common.EP_HOLDSTATE]) {
                        var _o = webphone_api.global.ep[P][webphone_api.common.EP_LINE];
                        webphone_api.setline(_o), webphone_api.common.PutToDebugLog(2, "EVENT, API_Hold mainlogic resume call from nt; peer: " + webphone_api.global.ep[P][webphone_api.common.EP_DESTNR] + " on line: " + _o), webphone_api.hold(!1), webphone_api.mute(!0), go = !0
                    }
                    go && webphone_api.setline(bo), j = co, webphone_api.common.isNull(B) || clearTimeout(B), B = null, webphone_api.global.acallcount++, W = !1, l = 161, webphone_api.common.RemoveSipHeadreFromCache("X-reason"), webphone_api.common.RemoveSipHeadreFromCache("Reason"), webphone_api.common.RemoveSipHeadreFromCache("Warning"), webphone_api.global.ringstart_time = webphone_api.common.GetTickCount(), l = 176;
                    var be = webphone_api.common.StrToInt(Oe);
                    if (be > 0 && webphone_api.common.GetOtherPartyName(be, lo), v = webphone_api.common.GetTickCount(), f = lo, webphone_api.global.currcallnumber = f, webphone_api.global.checkIfInCall = !0, webphone_api.global.checkIfCallActive = !1, !1 === webphone_api.common.IsSDK() && webphone_api.$("#video_container").is(":visible") && setTimeout(function () {
                        webphone_api._call.MeasureCall()
                    }, 200), webphone_api.common.SaveCallSession(Oe, null, lo, me, webphone_api.common.GetTickCount(), -1, -1, "", "", "", "", null), !0 === webphone_api.common.GetParameterBool("voicerecording", !1) && !1 === webphone_api._call.IsRecStarted(lo) && webphone_api._call.StartRecording(lo), l = 177, 1 !== webphone_api.common.GetApibehaviour()) try {
                        webphone_api.onCallStateChangeCb("callSetup", webphone_api.common.StrToInt(me), lo, H, Oe, co)
                    } catch (nt) {
                        webphone_api.common.PutToDebugLogException(2, "There is an error in onCallStateChange() callback callSetup", nt)
                    }
                    try {
                        webphone_api.onCallStateChangeCb("setup", webphone_api.common.StrToInt(me), lo, H, Oe, co)
                    } catch (nt) {
                        webphone_api.common.PutToDebugLogException(2, "There is an error in onCallStateChange() callback setup", nt)
                    }
                    if (1 == me ? (l = 178, webphone_api.common.CallScriptingUrl(webphone_api.parameters.scurl_onoutcallsetup, "callSetup", me, lo, lo, "", "additional_info")) : (l = 179, webphone_api.common.CallScriptingUrl(webphone_api.parameters.scurl_onincallsetup, "callSetup", me, lo, lo, "", "additional_info"), 1 === webphone_api.common.GetParameterInt("beeponincoming", 0) && webphone_api.common.Beep("1")), webphone_api.common.CallScriptingUrl(webphone_api.parameters.scurl_displaypeerdetails, "callSetup", me, lo, lo, "", "scurl_displaypeerdetails"), webphone_api.common.PutToDebugLog(2, "EVENT, currevent: " + po + "; isIcomingCall: " + me + "; line: " + Y), webphone_api.common.PutToDebugLog(2, "EVENT, lastRingEvenet: " + webphone_api.global.lastRingEvenet), webphone_api.common.UpdateContactLastActive(lo), "2" == me) {
                        if (!1 === webphone_api.common.IsSDK() && !webphone_api.common.isNull(document.getElementById("display_notmain_account")) && webphone_api.common.GetNrOfAcc() > 1) {
                            var fo = "", wo = so[1];
                            if (!webphone_api.common.isNull(webphone_api.global.sipaccounts) && webphone_api.global.sipaccounts.length > 0) {
                                for (var P = 0; P < webphone_api.global.sipaccounts.length; P++) {
                                    var vo = webphone_api.global.sipaccounts[P];
                                    if (!0 === vo.ismain) {
                                        if (!webphone_api.common.isNull(wo) && wo.length > 0 && wo != vo.username) for (var Eo = 0; Eo < webphone_api.global.sipaccounts.length; Eo++) if (webphone_api.global.sipaccounts[Eo].username === wo) {
                                            fo = webphone_api.global.sipaccounts[Eo].username, !webphone_api.common.isNull(webphone_api.global.sipaccounts[Eo].serveraddress) && webphone_api.global.sipaccounts[Eo].serveraddress.length > 0 && (fo = fo + "@" + webphone_api.global.sipaccounts[Eo].serveraddress);
                                            break
                                        }
                                        break
                                    }
                                }
                                !webphone_api.common.isNull(fo) && fo.length > 0 && (webphone_api.$("#display_notmain_account").html(fo), webphone_api.$("#display_notmain_account").show())
                            }
                        }
                        var To = webphone_api.common.GetParameter("callnot_title"),
                            Po = webphone_api.common.GetParameter("callnot_body"),
                            So = webphone_api.common.GetParameter("callnot_icon"),
                            No = webphone_api.common.GetParameter("callnot_image");
                        (webphone_api.common.isNull(To) || To.length < 1) && (To = webphone_api.common.GetBrandName()), (webphone_api.common.isNull(Po) || Po.length < 1) && (Po = webphone_api.stringres.get("notification_message")), Po += ": ", H.length > 0 && H !== lo ? Po = Po + H + " (" + lo + ")" : Po += lo, (webphone_api.common.isNull(So) || So.length < 1) && (So = webphone_api.common.GetElementSource() + "images/notification_icon.png"), webphone_api.common.isNull(No) && (No = ""), webphone_api.common.ShowIncomingCallNotification(To, Po, So, !1, No)
                    }
                    if (!webphone_api.common.isNull(me) && "2" == me && po !== webphone_api.global.lastRingEvenet) {
                        if (l = 280, webphone_api.common.IsContactBlocked(f, null)) return l = 281, webphone_api.common.PutToDebugLog(4, "EVENT, call dropped (hangup) because blocked contact: " + f), webphone_api.common.PutToDebugLog(2, "EVENT, mlogic API_Hangup blocked contact: " + f), void webphone_api.hangup();
                        if (webphone_api.common.IsNumberBlacklisted(f, null)) return l = 282, webphone_api.common.PutToDebugLog(4, "EVENT, call dropped (hangup) because blacklisted number: " + f), webphone_api.common.PutToDebugLog(2, "EVENT, mlogic API_Hangup blacklisted number: " + f), void webphone_api.hangup();
                        if (webphone_api.global.active_incoming_call = !0, webphone_api.global.incommingCall = !0, _ = !0, webphone_api.global.checkIfInCall = !0, webphone_api.global.checkIfCallActive = !1, l = 285, webphone_api.common.SaveParameter("redial", f), webphone_api.common.SaveParameter("lastincalltime", webphone_api.common.GetTickCount()), webphone_api.global.intentcall[0] = "number=" + f, webphone_api.global.intentcall[1] = "calltype=incoming", webphone_api.global.intentcall[2] = "name=", l = 286, !0 === webphone_api.common.UsePresence2() && !0 === webphone_api.global.incommingCall && "dnd" === webphone_api.common.GetParameter("presencestatus").toLowerCase()) return webphone_api.common.PutToDebugLog(2, "EVENT, mlogic API_Hangup incoming call from: " + lo + ", because presence is DND"), void webphone_api.hangup();
                        0 == webphone_api.common.IsSDK() && setTimeout(function () {
                            l = 290, !1 === webphone_api.global.isCallStarted ? webphone_api.$.mobile.changePage("#page_call", {
                                transition: "pop",
                                role: "page"
                            }) : (l = 292, webphone_api._call.OnNewIncomingCall())
                        }, 500)
                    }
                    l = 297, (webphone_api.common.isNull(webphone_api.global.lastRingEvenet) || webphone_api.global.lastRingEvenet.length < 1) && (webphone_api.global.lastRingEvenet = po)
                }
                if (l = 180, "CallConnect" === z) {
                    var lo = "", H = "", me = "", so = K.split(","), mo = "";
                    if (!webphone_api.common.isNull(so) && so.length > 1 && (mo = so[1]), !1 === webphone_api.common.UserExists(mo)) return webphone_api.common.PutToDebugLog(2, "EVENT, Skip this notification proccessisng"), X = z, J = "STATUS", void (Y = se);
                    webphone_api.common.PutToDebugLog(5, "EVENT, callConnected event received"), "Android" === webphone_api.common.GetOs() && webphone_api.common.getuseengine() === webphone_api.global.ENGINE_WEBRTC && (webphone_api.common.PutToDebugLog(2, "EVENT, mlogic API_GetDevice Callconnect"), webphone_api.getdevice(0, function (e) {
                        try {
                            if (webphone_api.common.GetParameterInt("androidspeaker", 1) > 0) {
                                if ("Default" === e) {
                                    var o = webphone_api.common.GetAudioRecList();
                                    if (!webphone_api.common.isNull(o) && o.length > 0) for (var t = o.split("\r\n"), n = 0; n < t.length; n++) !webphone_api.common.isNull(t[n]) && (t[n].toLowerCase().indexOf("earpiece") >= 0 || t[n].toLowerCase().indexOf("headset") >= 0) && (e = t[n], webphone_api.common.SaveParameter("sel_rtc_audio_in", e), webphone_api.global.audio_rec_curr_device = e, webphone_api.common.SaveParameter("cache_audio_rec_curr_device", e))
                                }
                                !webphone_api.common.isNull(e) && e.length > 0 && (webphone_api.common.PutToDebugLog(4, "EVENT, Set input device id for Android loudspeaker: " + e), webphone_api.common.PutToDebugLog(2, "EVENT, mlogic API_SetDevice Callconnect"), webphone_api.setdevice(0, e, 2))
                            } else {
                                if (e.toLowerCase().indexOf("earpiece") >= 0 || e.toLowerCase().indexOf("headset") >= 0) {
                                    var o = webphone_api.common.GetAudioRecList();
                                    if (!webphone_api.common.isNull(o) && o.length > 0) for (var t = o.split("\r\n"), n = 0; n < t.length; n++) !webphone_api.common.isNull(t[n]) && t[n].toLowerCase().indexOf("default") >= 0 && (e = t[n], webphone_api.common.SaveParameter("sel_rtc_audio_in", e), webphone_api.global.audio_rec_curr_device = e, webphone_api.common.SaveParameter("cache_audio_rec_curr_device", e))
                                }
                                !webphone_api.common.isNull(e) && e.length > 0 && (webphone_api.common.PutToDebugLog(4, "EVENT, Set input device id for Android loudspeaker: " + e), webphone_api.common.PutToDebugLog(2, "EVENT, mlogic API_SetDevice Callconnect"), webphone_api.setdevice(0, e, 2))
                            }
                        } catch (nt) {
                            webphone_api.common.PutToDebugLogException(2, "notifications: getdevice loudspeaker 2", nt)
                        }
                    })), webphone_api.common.ShowIncomingCallNotification("", "", "", !0, ""), webphone_api.global.checkIfInCall = !0, webphone_api.global.callstart_time = webphone_api.common.GetTickCount(), l = 182, !webphone_api.common.isNull(so) && so.length > 2 && (!webphone_api.common.isNull(so[0]) && so[0].length > 1 ? lo = webphone_api.common.Trim(so[0]) : !webphone_api.common.isNull(so[1]) && so[1].length > 1 && (lo = webphone_api.common.Trim(so[1])), l = 184, !webphone_api.common.isNull(so[2]) && so[2].length > 0 && (me = webphone_api.common.Trim(so[2])), so.length > 3 && (H = so[3], (webphone_api.common.isNull(H) || H.length < 1) && (H = lo)), l = 188);
                    var Io = "";
                    if (so.length > 9 && !webphone_api.common.isNull(so[9]) && (Io = so[9]), webphone_api.common.isNull(lo) && (lo = ""), l = 190, 1 !== webphone_api.common.GetApibehaviour()) try {
                        webphone_api.onCallStateChangeCb("callConnected", webphone_api.common.StrToInt(me), lo, H, webphone_api.common.StrToInt(webphone_api.global.aline), Io)
                    } catch (nt) {
                        webphone_api.common.PutToDebugLogException(2, "There is an error in onCallStateChange() callback callConnected", nt)
                    }
                    try {
                        webphone_api.common.PutToDebugLog(5, "EVENT, call connected event sent"), webphone_api.onCallStateChangeCb("connected", webphone_api.common.StrToInt(me), lo, H, webphone_api.common.StrToInt(webphone_api.global.aline), Io)
                    } catch (nt) {
                        webphone_api.common.PutToDebugLogException(2, "There is an error in onCallStateChange() callback connected", nt)
                    }
                    if (1 === webphone_api.common.StrToInt(me)) {
                        if (l = 205, webphone_api.common.CallScriptingUrl(webphone_api.parameters.scurl_onoutcallconnected, "callConnected", me, lo, lo, ""), webphone_api.common.getuseengine() === webphone_api.global.ENGINE_WEBRTC) {
                            var Co = webphone_api.common.GetParameterInt("beeponconnect", 0);
                            3 !== Co && 4 !== Co || webphone_api.common.Beep("1")
                        }
                    } else l = 206, webphone_api.common.CallScriptingUrl(webphone_api.parameters.scurl_onincallconnected, "callConnected", me, lo, lo, "");
                    l = 207, webphone_api.common.SaveCallSession(webphone_api.global.aline, null, lo, me, -1, webphone_api.common.GetTickCount(), -1, "", "", "", "", null), setTimeout(function () {
                        webphone_api.common.RefreshInfo()
                    }, 400)
                }
                if (l = 200, "CallDisconnect" === z) {
                    webphone_api.common.PutToDebugLog(2, "EVENT, ProcessNotifications call disc received");
                    var Ro = 0;
                    try {
                        var yo = webphone_api.common.Trim(t).split(","), mo = "";
                        if (!webphone_api.common.isNull(yo) && yo.length > 3 && (mo = yo[4]), !1 === webphone_api.common.UserExists(mo)) return webphone_api.common.PutToDebugLog(2, "EVENT, Skip this notification proccessisng"), X = z, J = "STATUS", void (Y = se);
                        Ro = 2, webphone_api.common.ShowIncomingCallNotification("", "", "", !0, "");
                        var A = webphone_api.global.aline, Lo = "";
                        Ro = 3, !webphone_api.common.isNull(yo) && yo.length > 3 && (!webphone_api.common.isNull(yo[1]) && webphone_api.common.IsNumber(yo[1]) && (A = webphone_api.common.StrToInt(yo[1])), webphone_api.common.isNull(yo[3]) || (Lo = webphone_api.common.Trim(yo[3]))), Ro = 4, setTimeout(function () {
                            webphone_api.common.PutToDebugLog(2, "EVENT, notifications delete/remove endpoint on call disconnected for number: " + Lo + "; line: " + A.toString());
                            var e = !0;
                            !0 === webphone_api.global.calltransf_completed && (e = !1), (!0 !== webphone_api.global.checkIfInCall || webphone_api.common.isNull(webphone_api.global.ep) || 1 !== webphone_api.global.ep.length) && webphone_api.common.GetEndpoint(A, Lo, "", e)
                        }, 350), Ro = 5;
                        var so = K.split(","), lo = "", H = "", me = "";
                        if (Ro = 7, l = 202, !webphone_api.common.isNull(so) && so.length > 2 && (!webphone_api.common.isNull(so[0]) && so[0].length > 1 ? lo = webphone_api.common.Trim(so[0]) : !webphone_api.common.isNull(so[1]) && so[1].length > 1 && (lo = webphone_api.common.Trim(so[1])), l = 204, !webphone_api.common.isNull(so[2]) && so[2].length > 0 && (me = webphone_api.common.Trim(so[2])), l = 206, so.length > 3 && (H = so[3], (webphone_api.common.isNull(H) || H.length < 1) && (H = lo))), webphone_api.global.CLOSE_CALL_TIMER < 0) {
                            var Do = 0, Go = webphone_api.common.GetEndpoint(A, Lo, "", !1);
                            if (!webphone_api.common.isNull(Go) && Go.length > 5) {
                                var Oo = Go[webphone_api.common.EP_CONNECTTIME];
                                !webphone_api.common.isNull(Oo) && webphone_api.common.IsNumber(Oo) && (Oo = webphone_api.common.StrToIntDef(Oo, 0)) > 0 && (Do = webphone_api.common.GetTickCount() - Oo)
                            }
                            webphone_api.global.CLOSE_CALL_TIMER = webphone_api.common.GetParameterInt("closecall_timeout", 3e3), (1 == me || "1" == me) && Do < 4e3 && (webphone_api.global.CLOSE_CALL_TIMER = webphone_api.common.GetParameterInt("closecall_timeout_err", 7e3))
                        }
                        webphone_api.common.GetNrOfActiveCalls() < 2 && (webphone_api.global.checkIfInCall = !1, webphone_api.global.isconfcall = !1), Ro = 6, l = 201, webphone_api.common.ResetIce(), Ro = 8;
                        var Io = "";
                        if (so.length > 9 && !webphone_api.common.isNull(so[9]) && (Io = so[9]), l = 213, webphone_api.common.isNull(lo) && (lo = ""), !1 === webphone_api.common.IsSDK() && (l = 215), Ro = 9, !0 === webphone_api.common.GetParameterBool("voicerecording", !1) && !0 === webphone_api._call.IsRecStarted(lo) && webphone_api._call.StopRecording(lo), Ro = 10, l = 218, 1 !== webphone_api.common.GetApibehaviour()) try {
                            webphone_api.onCallStateChangeCb("callDisconnected", webphone_api.common.StrToInt(me), lo, H, A, Io)
                        } catch (nt) {
                            webphone_api.common.PutToDebugLogException(2, "There is an error in onCallStateChange() callback callDisconnected", nt)
                        }
                        try {
                            webphone_api.onCallStateChangeCb("disconnected", webphone_api.common.StrToInt(me), lo, H, A, Io)
                        } catch (nt) {
                            webphone_api.common.PutToDebugLogException(2, "There is an error in onCallStateChange() callback disconnected", nt)
                        }
                        !1 === webphone_api.global.calltransf_completed && webphone_api.common.SaveCallSession(null, null, lo, webphone_api.common.StrToInt(me), -1, -1, webphone_api.common.GetTickCount(), "", "", "", "", null), Ro = 11, webphone_api.global.acallcount--, webphone_api.common.GetNrOfActiveCalls() < 1 && (webphone_api.global.usemutemutiline = !1), Ro = 12
                    } catch (nt) {
                        webphone_api.common.PutToDebugLogException(2, "ProcessNotifications CallDisconnect error: " + Ro.toString(), nt)
                    }
                }
                if (l = 220, "Call Finished" === z) {
                    if (Z = !1, webphone_api.global.bothpartyhold = !1, webphone_api.global.authenticated_displayed = !1, webphone_api.global.ringstart_time = 0, webphone_api.global.callstart_time = 0, webphone_api.isscreensharecall = !1, webphone_api.global.rating = "", webphone_api.global.isholdresume = !1, webphone_api.global.isresume = !1, webphone_api.global.holdresumecount = 0, webphone_api.global.add_recall_header = !1, ne > 0) try {
                        "undefined" != typeof AndroidWebphoneJsInterface && null !== AndroidWebphoneJsInterface && "undefined" != typeof AndroidWebphoneJsInterface.jstoandroidEvents && null !== AndroidWebphoneJsInterface.jstoandroidEvents && AndroidWebphoneJsInterface.jstoandroidEvents("[HANGUP]_NOTIFICATION")
                    } catch (nt) {
                        webphone_api.common.PutToDebugLogException(2, "notifications: ProcessNotifications inner AndroidWebphoneJsInterface", nt)
                    }
                    l = 222, webphone_api.common.ResetIce(), w = webphone_api.common.GetTickCount(), webphone_api.common.GetNrOfActiveCalls() < 1 && (webphone_api.global.closeCallAtivity = !0), webphone_api.global.isCallStarted && webphone_api.common.GetNrOfActiveCalls() < 1 && (webphone_api.common.isNull(webphone_api.global.waiting_conf_numbers) || webphone_api.global.waiting_conf_numbers.length < 1) && !1 === webphone_api.global.dontshow_closecall && (webphone_api.$("#btn_hangup_img").attr("src", webphone_api.common.GetElementSource() + "images/btn_close_txt.png"), webphone_api.$("#btn_hangup").attr("title", webphone_api.stringres.get("hint_closecall")), webphone_api.$("#acceptreject_layout").hide(), webphone_api.$("#callfunctions_layout").hide(), webphone_api.$("#hangup_layout").show()), webphone_api.common.IsMultiline() || (webphone_api.global.hangupPressedCount = 1), l = 232, webphone_api.common.GetNrOfActiveCalls() < 1 && (webphone_api.global.checkIfInCall = !1, webphone_api.global.checkIfCallActive = !1, webphone_api.global.isconfcall = !1, W = !1), webphone_api.global.callTypeInOut = "", webphone_api.global.creditRequestTimer = webphone_api.global.CREDIT_REQUEST_IVAL_DEFVAL - 50, webphone_api.global.lastRingEvenet = "", webphone_api.global.isfirstcall = !1, g = !1
                }
                if (l = 240, "Finished" === z) {
                    Z = !1, webphone_api.global.bothpartyhold = !1, webphone_api.global.ringstart_time = 0, webphone_api.global.callstart_time = 0, webphone_api.global.rating = "", webphone_api.global.firefoxholdcount = 0, webphone_api.global.isholdresume = !1, webphone_api.global.isresume = !1, webphone_api.global.holdresumecount = 0, webphone_api.global.add_recall_header = !1, l = 242, webphone_api.common.ResetIce(), !0 === webphone_api.global.incommingCall && !1 === webphone_api.global.acceptReject && webphone_api.global.isCallStarted && (l = 245, !1 === webphone_api.common.IsSDK() && webphone_api._call.OnCallerHangup()), webphone_api.common.GetNrOfActiveCalls() < 1 && (webphone_api.global.checkIfInCall = !1, webphone_api.global.checkIfCallActive = !1, webphone_api.global.isconfcall = !1, W = !1, webphone_api.global.incommingCall = !1, webphone_api.global.speakerState = !0, webphone_api.global.bluetoothState = !0, webphone_api.global.lastBTclicktick = 0, webphone_api.global.callTypeInOut = "", webphone_api.global.lastRingEvenet = "", webphone_api.global.isfirstcall = !1), g = !1;
                    var xo = webphone_api.common.GetParameterInt("vdnr", 0);
                    if (webphone_api.global.isvideocall || webphone_api.isscreensharecall) {
                        xo += 1, webphone_api.common.SaveParameter("vdnr", xo);
                        4 === webphone_api.common.GetParameterInt("videomode", 0) && webphone_api.common.ExitVideoMode("Auto, on call finished")
                    }
                    if (webphone_api.global.isvideocall = !1, webphone_api.isscreensharecall = !1, l = 247, !1 === webphone_api.global.usestorage && !1 === webphone_api.common.Strl(60) && xo < 2 && webphone_api.common.getuseengine() === webphone_api.global.ENGINE_WEBRTC && !0 === webphone_api.common.CanIUseService()) {
                        if (!0 === (!0 === webphone_api.common.IsMacLin() && !0 === webphone_api.common.IsMizuWebRTCGateway())) {
                            l = 248;
                            var Ao = webphone_api.common.GetParameterInt("lccnr", 0);
                            if (Ao > 0 && Ao < 46) {
                                var ko = webphone_api.common.GetParameterInt("closecall_timeout_err", 7e3);
                                ko < webphone_api.common.GetParameterInt("closecall_timeout", 4e3) && (ko = webphone_api.common.GetParameterInt("closecall_timeout", 4e3)), ko += 1500, setTimeout(function () {
                                    function e() {
                                        webphone_api.common.SaveParameter("lastusedengine", "ns"), webphone_api.flagrestartwebrtc = !1, l = 253, webphone_api.common.ResetEngineClicked();
                                        var e = webphone_api.common.GetEngine("ns");
                                        e.clicked = 2, webphone_api.common.SetEngine("ns", e), webphone_api.common.EngineSelect(1), l = 257, webphone_api.common.PutToDebugLog(2, "EVENT, notifications: offer ns engine instead of WebRTC: " + webphone_api.common.GetMinServiceVersion().toString()), l = 259, webphone_api.common.EngineForcedInstall("ns", webphone_api.stringres.get("serviceengine_msg"), null, function () {
                                            webphone_api.startInner()
                                        })
                                    }

                                    var o = webphone_api.$.mobile.activePage.find(".messagePopup");
                                    !webphone_api.common.isNull(o) && o.length > 0 && !0 !== webphone_api.global.dontclosecurrpopup ? webphone_api.$.mobile.activePage.find(".messagePopup").popup("close").bind({
                                        popupafterclose: function () {
                                            webphone_api.$(this).unbind("popupafterclose").remove(), e()
                                        }
                                    }) : e()
                                }, ko)
                            }
                        }
                    }
                }
                if (l = 260, l = 300, "Starting call" === z && (webphone_api.global.checkIfInCall = !0, webphone_api.global.checkIfCallActive = !1, !1 === webphone_api.common.IsSDK() && webphone_api.$("#video_container").is(":visible") && webphone_api._call.MeasureCall()), l = 304, "InCall" !== z && "In Call" !== z || (webphone_api.global.checkIfInCall = !0, _ && (l = 307, !1 === webphone_api.common.IsSDK() && webphone_api.common.GetNrOfActiveCalls() < 2 && webphone_api._call.AcceptCall(!1))), l = 310, "Speaking" === z) {
                    var so = K.split(","), mo = "";
                    if (!webphone_api.common.isNull(so) && so.length > 1 && (mo = so[1]), !1 === webphone_api.common.UserExists(mo)) return webphone_api.common.PutToDebugLog(2, "EVENT, Skip this notification proccessisng"), X = z, J = "STATUS", void (Y = se);
                    if (webphone_api.global.apistartstate = 2, !1 === Z && (l = 312, Z = !0, !1 === webphone_api.common.IsSDK() && webphone_api.common.GetNrOfActiveCalls() < 2 && webphone_api._call.AcceptCall(!1)), !1 === webphone_api.common.IsSDK() && !1 === webphone_api.global.isCallStarted && webphone_api.common.isNull(B) && (B = setTimeout(function () {
                        !1 === webphone_api.global.isCallStarted && (webphone_api.global.intentcall[0] = "number=", webphone_api.global.intentcall[1] = "calltype=outgoing", webphone_api.global.intentcall[2] = "name=", webphone_api.global.intentcall[3] = "callmode=0", webphone_api.$.mobile.changePage("#page_call", {
                            transition: "pop",
                            role: "page"
                        }))
                    }, 1e3)), C = !0, webphone_api.global.incommingCall && (webphone_api.global.incommingCall = !1), webphone_api.global.checkIfCallActive = !0, webphone_api.global.checkIfInCall = !0, webphone_api.global.lastRingEvenet = "", !1 === webphone_api.common.IsSDK() && webphone_api.$("#video_container").is(":visible") && setTimeout(function () {
                        webphone_api._call.MeasureCall()
                    }, 200), l = 314, webphone_api.common.getuseengine() === webphone_api.global.ENGINE_WEBRTC) {
                        l = 315;
                        var Uo = location.hostname;
                        webphone_api.common.isNull(Uo) && (Uo = "");
                        var Vo = 1;
                        if (!1 === webphone_api.common.Awb2()) {
                            var S = [];
                            S.push("L"), S.push("i"), S.push("c"), S.push("e"), S.push("n"), S.push("s"), S.push("e "), S.push("e"), S.push("r"), S.push("r"), S.push("o"), S.push("r"), S.push(", "), S.push("w"), S.push("e"), S.push("b"), S.push("s"), S.push("e"), S.push("r"), S.push("v"), S.push("e"), S.push("r"), S.push(" "), S.push("n"), S.push("o"), S.push("t"), S.push(" "), S.push("a"), S.push("l"), S.push("l"), S.push("o"), S.push("w"), S.push("e"), S.push("d"), S.push("(");
                            var Wo = [];
                            Wo.push(")"), Wo.push(" "), Wo.push("h"), Wo.push("a"), Wo.push("n"), Wo.push("g"), Wo.push("u"), Wo.push("p");
                            var N = S.join(""), Mo = Wo.join("");
                            l = 320, setTimeout(function () {
                                webphone_api.common.PutToDebugLog(1, "ERROR," + N + Uo + Mo)
                            }, 3576), setTimeout(function () {
                                webphone_api.common.ShowToast(N + Uo + Mo)
                            }, 4235), Vo = 10
                        }
                        if (Vo > 5 && setTimeout(function () {
                            webphone_api.hangup()
                        }, 1180), L < 0) {
                            if (!0 === webphone_api.common.Ch()) L = 1; else {
                                L = 0;
                                var S = [];
                                S.push("L"), S.push("i"), S.push("c"), S.push("e"), S.push("n"), S.push("s"), S.push("e "), S.push("e"), S.push("r"), S.push("r"), S.push("o"), S.push("r"), S.push(", "), S.push("i"), S.push("n"), S.push("v"), S.push("a"), S.push("l"), S.push("i"), S.push("d "), S.push("s"), S.push("e"), S.push("r"), S.push("v"), S.push("e"), S.push("r"), S.push("a"), S.push("d"), S.push("d"), S.push("r"), S.push("e"), S.push("s"), S.push("s"), S.push(" "), S.push("h"), S.push("a"), S.push("n"), S.push("g"), S.push("u"), S.push("p");
                                var N = S.join("");
                                l = 320, setTimeout(function () {
                                    webphone_api.common.PutToDebugLog(1, "ERROR," + N)
                                }, 351), setTimeout(function () {
                                    webphone_api.common.ShowToast(N)
                                }, 391)
                            }
                        }
                        0 === L && setTimeout(function () {
                            webphone_api.hangup()
                        }, 123)
                    }
                    if (l = 322, webphone_api.common.GetNrOfActiveCalls() > 1 && !1 === W) {
                        W = !0;
                        var Fo = webphone_api.common.StrToInt(webphone_api.common.GetParameter("automute")),
                            Ho = webphone_api.common.StrToInt(webphone_api.common.GetParameter("autohold")),
                            Bo = webphone_api.common.GetParameterInt("defmute", 0);
                        if (3 !== Bo && 4 !== Bo || (Bo = 0), (webphone_api.common.isNull(Fo) || Fo < 1) && (webphone_api.common.isNull(Ho) || Ho < 1)); else for (var P = 0; P < webphone_api.global.ep.length; P++) {
                            var jo = webphone_api.global.ep[P];
                            if (!(webphone_api.common.isNull(jo) || jo.length < 1)) {
                                if (!webphone_api.common.isNull(jo[webphone_api.common.EP_DISCONNECTTIME]) && webphone_api.common.IsNumber(jo[webphone_api.common.EP_DISCONNECTTIME])) {
                                    var $o = webphone_api.common.StrToInt(jo[webphone_api.common.EP_DISCONNECTTIME]);
                                    if ($o > 10) continue
                                }
                                var qo = jo[webphone_api.common.EP_LINE];
                                if (!(webphone_api.common.isNull(qo) || qo.length < 1 || !1 === webphone_api.common.IsNumber(qo))) {
                                    var zo = webphone_api.common.StrToInt(qo);
                                    if (webphone_api.global.aline != zo) {
                                        var Ko = jo[webphone_api.common.EP_MUTESTATE],
                                            Xo = jo[webphone_api.common.EP_HOLDSTATE]
                                            ; "false" == Ko && (3 === Fo || 2 === Fo && !1 === _ || 1 === Fo && !0 === _) && (webphone_api.common.getuseengine() === webphone_api.global.ENGINE_WEBRTC ? webphone_api.webrtcapi.SipToggleMute(!0, Bo, zo) : webphone_api.common.GetParameter("devicetype") === webphone_api.common.DEVICE_WIN_SOFTPHONE() || webphone_api.common.getuseengine() === webphone_api.global.ENGINE_SERVICE ? webphone_api.common.WinAPI("API_MuteEx", null, zo, !0, Bo) : webphone_api.common.getuseengine() === webphone_api.global.ENGINE_WEBPHONE && webphone_api.webphone.MuteEx(zo, !0, Bo), webphone_api.global.ep[P][webphone_api.common.EP_MUTESTATE] = "true"), "false" == Xo && (3 === Ho || 2 === Ho && !1 === _ || 1 === Ho && !0 === _) && (webphone_api.common.getuseengine() === webphone_api.global.ENGINE_WEBRTC ? webphone_api.webrtcapi.SipToggleHoldResume(!0, zo) : webphone_api.common.GetParameter("devicetype") === webphone_api.common.DEVICE_WIN_SOFTPHONE() || webphone_api.common.getuseengine() === webphone_api.global.ENGINE_SERVICE ? webphone_api.common.WinAPI("API_Hold", null, zo, !0) : webphone_api.common.getuseengine() === webphone_api.global.ENGINE_WEBPHONE && (webphone_api.common.PutToDebugLog(2, "EVENT, API_Hold mainlogic hold call because autohold; peer: " + webphone_api.global.ep[P][webphone_api.common.EP_DESTNR] + " on line: " + webphone_api.global.ep[P][webphone_api.common.EP_LINE]), webphone_api.webphone.Hold(zo, !0)), webphone_api.global.ep[P][webphone_api.common.EP_HOLDSTATE] = "true")
                                    }
                                }
                            }
                        }
                    }
                    g || (g = !0, l = 338, webphone_api.global.isencrypted = webphone_api.isencrypted(), setTimeout(function () {
                        webphone_api.global.isencrypted > 0 ? webphone_api.$(".img_encrypt").show() : webphone_api.$(".img_encrypt").hide()
                    }, 1e3))
                }
                l = 340, z.toLowerCase().indexOf("registered") >= 0 && z.toLowerCase().indexOf("unregistered") < 0 && (E < 4 && (E = 4), l = 342, webphone_api.global.phonestarted = 3, webphone_api.common.SaveParameter("lastsucc", "1"), m || (m = !0), l = 344, setTimeout(function () {
                    webphone_api.global.isencrypted > 0 ? webphone_api.$(".img_encrypt").show() : webphone_api.$(".img_encrypt").hide()
                }, 1e3)), l = 360
            } else if ("CHAT" === q) {
                var be = -1, _e = webphone_api.common.Trim(t), fe = _e.indexOf(",");
                if (fe > 0 && (_e = _e.substring(fe + 1), (fe = _e.indexOf(",")) > 0 && (_e = webphone_api.common.Trim(_e.substring(0, fe)), !webphone_api.common.isNull(_e) && webphone_api.common.IsNumber(_e) && (be = webphone_api.common.StrToInt(_e)))), K.indexOf("[PRESENCE") >= 0) return K = K.replace("[", ""), K = K.replace("]", ""), void o(K);
                l = 361, a(z, K, be)
            }
            "Rejected" === z && _ && (l = 364, !1 === webphone_api.common.IsSDK() && webphone_api._call.RejectCall(!1)), U = K.indexOf(","), U > 0 && (K = z), l = 366, U = z.indexOf("[ep"), U > 0 && (z = webphone_api.common.Trim(z.substring(0, U)), K = z), l = 370;
            var Jo = "";
            if (("EVENT" === q || "ERROR" === q || "WARNING" === q || "STATUS" === q) && (l = 371, U = K.indexOf("("), Jo = U > 0 && z.indexOf(ee) < 0 && z.indexOf(oe) < 0 ? webphone_api.common.Trim(K.substring(0, U)) : K, l = 374, !webphone_api.common.IsNumber(Jo.charAt(0)))) {
                if (Jo = Jo.substring(0, 1).toUpperCase() + Jo.substring(1), "STATUS" === q) {
                    if ("Deletable" !== Jo && Jo.indexOf("Chat") < 0) {
                        re = Jo, se = -1;
                        var Yo = t.split(",");
                        if (!webphone_api.common.isNull(Yo) && Yo.length > 1 && !webphone_api.common.isNull(Yo[1]) && webphone_api.common.IsNumber(Yo[1]) && (se = webphone_api.common.StrToIntDef(Yo[1], -1)), webphone_api.common.isNull(webphone_api.global.callPageStatusCachePerLine) && (webphone_api.global.callPageStatusCachePerLine = {}), !1 === webphone_api.common.IsSDK() && ("page_call" === webphone_api.$.mobile.activePage.attr("id") || t.indexOf("CallSetup") > 0)) {
                            var Qo = webphone_api.common.StrToIntDef(Yo[1], -1);
                            if (Qo > 0) {
                                var Zo = y;
                                t.indexOf("ERROR") >= 0 ? Zo = "#FF0000" : t.indexOf("WARNING") >= 0 && (Zo = "#D28F00"), "undefined" != typeof webphone_api.global.callPageStatusCachePerLine[Qo] && null !== webphone_api.global.callPageStatusCachePerLine[Qo] && "undefined" != typeof webphone_api.global.callPageStatusCachePerLine[Qo][0] && null !== webphone_api.global.callPageStatusCachePerLine[Qo][0] && "Muted" === webphone_api.global.callPageStatusCachePerLine[Qo][0] && "Speaking" === Jo || (webphone_api.global.callPageStatusCachePerLine[Qo] = [Jo, Zo])
                            }
                        }
                    }
                } else {
                    X = Jo, J = q, Y = -1;
                    var Yo = t.split(",");
                    !webphone_api.common.isNull(Yo) && Yo.length > 1 && !webphone_api.common.isNull(Yo[1]) && webphone_api.common.IsNumber(Yo[1]) && (Y = webphone_api.common.StrToIntDef(Yo[1], -1))
                }
                if (l = 377, "Register failed" === Jo) {
                    re = Jo, se = -1;
                    var Yo = t.split(",");
                    !webphone_api.common.isNull(Yo) && Yo.length > 1 && !webphone_api.common.isNull(Yo[1]) && webphone_api.common.IsNumber(Yo[1]) && (se = webphone_api.common.StrToIntDef(Yo[1], -1))
                }
                if (l = 379, (Jo.indexOf("Register failed") >= 0 || Jo.indexOf("Connection lost") >= 0 || Jo.indexOf("No network") >= 0 || Jo.indexOf("Network is down") >= 0 || Jo.indexOf("No response from server") >= 0 || Jo.indexOf("Server lost") >= 0 || Jo.indexOf("Authentication failed") >= 0 || Jo.indexOf("Rejected by server") >= 0 || Jo.indexOf("Register rejected") >= 0 || Jo.indexOf("Register expired") >= 0 || Jo.indexOf("Register failed") >= 0) && (webphone_api.common.GetParameter("devicetype") !== webphone_api.common.DEVICE_WIN_SOFTPHONE() && webphone_api.common.getuseengine() !== webphone_api.global.ENGINE_SERVICE || webphone_api.common.WinAPI("API_GetRegFailReason", function (e) {
                    try {
                        webphone_api.onRegStateChangeCb("failed", e)
                    } catch (nt) {
                        webphone_api.common.PutToDebugLogException(2, "notifications: There is an error in onRegStateChangeCb(failed) callback service", nt)
                    }
                    try {
                        webphone_api.onRegisterFailedCb(e)
                    } catch (nt) {
                        webphone_api.common.PutToDebugLogException(2, "notifications: There is an error in onRegisterFailed() callback service", nt)
                    }
                }, !0), webphone_api.common.getuseengine() === webphone_api.global.ENGINE_WEBPHONE && webphone_api.webphone.GetRegFailReason(function (e) {
                    try {
                        webphone_api.onRegStateChangeCb("failed", e)
                    } catch (nt) {
                        webphone_api.common.PutToDebugLogException(2, "notifications: There is an error in onRegStateChangeCb(failed) callback webphone", nt)
                    }
                    try {
                        webphone_api.onRegisterFailedCb(e)
                    } catch (nt) {
                        webphone_api.common.PutToDebugLogException(2, "notifications: There is an error in onRegisterFailed() callback webphone", nt)
                    }
                }, !0), !0 === webphone_api.global.onunregistered_flag || !1 === webphone_api.flagrestartwebrtc || webphone_api.common.SaveParameter("lastsucc", "0"), webphone_api.global.dispregfailed < 2 && (webphone_api.global.laststarttick < 1 || webphone_api.common.GetTickCount() - webphone_api.global.laststarttick > 2500))) {
                    l = 382, webphone_api.global.dispregfailed = 2;
                    var et = Jo;
                    et = et.indexOf("Register failed") < 0 ? "Register failed_: " + et : et.replace("Register failed", "Register failed_"), webphone_api.common.PutToDebugLog(2, "EVENT, notification ProcessNotifications display: Register failed_: " + et), webphone_api.common.ShowToast(et, 6e3)
                }
            }
            l = 400
        } catch (nt) {
            webphone_api.common.PutToDebugLogException(2, "notifications: ProcessNotifications (" + l.toString() + "), not: " + t, nt)
        }
    }

    function t(e) {
        be = e
    }

    function n() {
        function e(e) {
            try {
                webphone_api.common.PutToDebugLog(2, "EVENT, mlogic API_Hangup EarlyHangup: " + e), webphone_api.hangup()
            } catch (o) {
                webphone_api.common.PutToDebugLogException(2, "notifications: EarlyHangup", o)
            }
        }

        var o = 0;
        try {
            var t = webphone_api.common.GetTickCount();
            if (webphone_api.global.ever_received_pong && webphone_api.global.pingpong > 2) {
                !0 === WsReconnect() ? webphone_api.common.PutToDebugLog(2, "EVENT, WSReConnect from timer succeded") : webphone_api.common.PutToDebugLog(2, "ERROR, WSReConnect from timer failed")
            }
            webphone_api.global.wsc_contimeout > 10 && t - webphone_api.global.wsc_contimeout > 5e3 && (webphone_api.global.wsc_contimeout = 0, webphone_api.common.PutToDebugLog(2, "ERROR, WSReConnect websocketAPI connection timed out (from timer)"), webphone_api.common.WSReConnect()), webphone_api.global.wsc_reqtimeout > 10 && t - webphone_api.global.wsc_reqtimeout > 5e3 && (webphone_api.global.wsc_reqtimeout = 0, webphone_api.common.PutToDebugLog(2, "ERROR, WSReConnect websocketAPI request timed out (from timer)"), webphone_api.common.WSReConnect()), !0 === webphone_api.global.dontshowdiscreason && F > 25 && (F = 0, webphone_api.global.dontshowdiscreason = !1), 1 === webphone_api.global.dispregfailed && ++we > 330 && (we = 0, webphone_api.global.dispregfailed = 2, webphone_api.global.phonestarted < 2 && !0 === webphone_api.common.NeedRegister() && (webphone_api.common.PutToDebugLog(2, "EVENT, notification OnTimerCycle display: Register failed"), webphone_api.common.ShowToast("Register failed"))), ie < 5e3 && ie++, X.length > 0 ? (X.toLowerCase().indexOf("authenticated successfully") >= 0 && (re = "Registered.", se = -1), le = X, pe = J, ce = Y, ie = 0, X = "", J = "", Y = -1) : ie > ae ? (le = re, pe = "STATUS", ce = se) : re.indexOf("Registered.") >= 0 && "ERROR" !== pe && "WARNING" !== pe && (webphone_api.global.firstregister_sessiontick < 1 || webphone_api.global.firstregister_sessiontick > 0 && t - webphone_api.global.firstregister_sessiontick < 5e3) && (le = re, pe = "STATUS", ce = se);
            try {
                var n = le.indexOf("[");
                n > 0 && (le = le.substring(0, n)), le = webphone_api.common.Trim(le), n = le.indexOf("]"), n > 0 && (le = le.substring(n + 1)), le = webphone_api.common.Trim(le)
            } catch (v) {
                webphone_api.common.PutToDebugLogException(3, "notifications OnTimerCycle parse displayed status", v)
            }
            if ("Registered." !== le && "Registered" !== le || (le += webphone_api.global.credit, ve !== webphone_api.global.useengine && (ve = webphone_api.global.useengine, webphone_api.common.SaveLastUsedEngine())), "Register..." !== le && "Registering..." !== le && "Register Failed" !== le && "Not Found" !== le || ve !== webphone_api.global.useengine && (ve = webphone_api.global.useengine, webphone_api.common.SaveLastUsedEngine()), 0 !== le.indexOf("Credit:") && 1 !== le.indexOf("Credit:") && le.indexOf("Outband") < 0 && le.indexOf("Deletable") < 0 && le.indexOf("Outbound") < 0 && le.toLowerCase().indexOf("subscribe") < 0 && (le.toLowerCase().indexOf("hide") >= 0 && (le = " "), s(le, pe, 0, ce)), o = 40, webphone_api.global.ringstart_time > 0 && webphone_api.global.callstart_time < 1) {
                o = 41, (webphone_api.common.isNull(A) || !1 === webphone_api.common.IsNumber(A)) && (A = 9e4), (webphone_api.common.isNull(k) || !1 === webphone_api.common.IsNumber(k)) && (k = 0), (webphone_api.common.isNull(U) || !1 === webphone_api.common.IsNumber(U)) && (U = 0);
                var i = A;
                !0 === webphone_api.global.incommingCall ? k > 0 && (i = k) : U > 0 && (i = U);
                var a = webphone_api.common.GetParameter2("cutincoming"), r = 0;
                "-1" === a ? r = -1 : "0" === a ? r = 0 : "1" === a && (r = 1), o = 51, t - webphone_api.global.ringstart_time > i && e("Hangup because ringtimeout limit reached: " + i), -1 === r ? !0 === webphone_api.global.incommingCall && t - webphone_api.global.ringstart_time > 14e3 && "Chrome" === webphone_api.common.GetBrowser() && e("Hangup because ringtimeout in Chrome browser limit reached: 14000") : 1 === r && !0 === webphone_api.global.incommingCall && t - webphone_api.global.ringstart_time > 14e3 && e("Hangup because ringtimeout in ALL browsers limit reached: 14000")
            }
            if (o = 55, webphone_api.global.callstart_time > 0 && (o = 56, (webphone_api.common.isNull(V) || !1 === webphone_api.common.IsNumber(V)) && (o = 57, V = 108e5), o = 58, t - webphone_api.global.callstart_time > V && (o = 67, webphone_api.common.PutToDebugLog(2, "EVENT, mlogic API_Hangup because calltimeout limit reached: " + V), o = 68, webphone_api.hangup(), o = 69)), o = 70, !0 === webphone_api.common.Glbr() && !T && 0 === webphone_api.global.creditRequestTimer && E > 2) {
                var l = webphone_api.common.GetParameter("creditrequest");
                !webphone_api.common.isNull(l) && l.length > 0 && webphone_api.common.UriParser(l, "", "", "", "", "creditrequest")
            }
            if (webphone_api.global.creditRequestTimer++, webphone_api.global.creditRequestTimer > webphone_api.global.creditRequestIval && (webphone_api.global.creditRequestTimer = 0), t - R > webphone_api.global.presenceinterval && (R = t, !1 === webphone_api.common.IsSDK() && !0 === (M = webphone_api.common.UsePresence2()) && webphone_api.common.PresenceGet2(webphone_api.common.GetParameter("srvcontacts"))), !0 === M && !0 === webphone_api.global.isMessageStarted && ++webphone_api.global.msg_presence_timer > 200 && (webphone_api.global.msg_presence_timer = 0, !1 === webphone_api.common.IsSDK() && webphone_api._message.RefreshPresence()), t - D > G && (D = t, webphone_api.common.CallWsuserKeepAlive(!1)), t - O > x && (O = t, webphone_api.common.CallWsuserKeepAlive(!0), webphone_api.common.PutToDebugLog(2, "EVENT, wsuser keepalive hourly called")), webphone_api.global.closeCallAtivity && (webphone_api.global.CLOSE_CALL_TIMER < 0 && (webphone_api.global.CLOSE_CALL_TIMER = webphone_api.common.GetParameterInt("closecall_timeout", 3e3)), t - w > webphone_api.global.CLOSE_CALL_TIMER && (webphone_api.global.CLOSE_CALL_TIMER = -100, webphone_api.global.closeCallAtivity = !1, w = 0, !1 === webphone_api.global.incommingCall && !1 === webphone_api.global.checkIfInCall && webphone_api.global.isCallStarted && !1 === webphone_api.common.IsSDK() && webphone_api._call.CloseCall())), t - P > 5e3 && !0 === webphone_api.global.wasSettModified) {
                P = t, webphone_api.global.wasSettModified = !1;
                var p = "";
                p = 1 == webphone_api.common.IsSDK() ? webphone_api.common.GetSettFilenameSDK() : webphone_api.common.GetActiveAccSettingsFilename(), webphone_api.common.SaveSettingsFile(p, function (e) {
                    e ? webphone_api.common.PutToDebugLog(2, "EVENT, SaveSettingsFile from timer Successfull") : webphone_api.common.PutToDebugLog(2, "ERROR, SaveSettingsFile from timer Failed")
                })
            }
            if (t - S > 200 && (S = t, !0 === webphone_api.global.wasCtModified && (webphone_api.global.wasCtModified = !1, webphone_api.common.SaveContactsFile(function (e) {
                e ? webphone_api.common.PutToDebugLog(2, "EVENT, SaveContactsFile from timer Successfull") : webphone_api.common.PutToDebugLog(2, "ERROR, SaveContactsFile from timer Failed")
            }))), t - N > 400 && (N = t, webphone_api.global.wasChModified && (webphone_api.global.wasChModified = !1, webphone_api.common.SaveCallhistoryFile(function (e) {
                e ? webphone_api.common.PutToDebugLog(2, "EVENT, SaveCallhistoryFile from timer Successfull") : webphone_api.common.PutToDebugLog(2, "ERROR, SaveCallhistoryFile from timer Failed")
            }))), "Ringing" === z && !0 === me && (be = webphone_api.common.GetTickCount(), me = !1, de = !0), "Speaking" === z && !0 === ge && (be = webphone_api.common.GetTickCount(), ge = !1, de = !0), !1 === webphone_api.common.IsSDK() && webphone_api.global.isCallStarted && !0 === de && ++_e >= 3) {
                fe = !0 === webphone_api.common.GetHoldState(-1) ? webphone_api.stringres.get("in_hold") + " " : "";
                var t = webphone_api.common.GetTickCount(), c = webphone_api.common.GetTickCount() - be,
                    u = Math.floor(c / 1e3), h = Math.floor(u / 60);
                u %= 60, u < 10 && (u = "0" + u), webphone_api.global.isCallStarted && webphone_api.$("#call_duration").html(fe + h + ":" + u + "&nbsp;"), _e = 0
            }
            if ("Call Finished" !== z && "Finished" !== z || webphone_api.common.GetNrOfActiveCalls() < 1 && (de = !1, me = !0, ge = !0, webphone_api.webrtcapi.RemoveUnusedAudioElements()), K.indexOf(":") > 0) {
                if ("Call duration" === webphone_api.common.Trim(K.substring(0, K.indexOf(":")))) {
                    de = !1, fe = webphone_api.stringres.get("duration") + " ";
                    var m = webphone_api.common.Trim(K.substring(K.indexOf(":") + 1, K.length)), g = 0, h = 0, u = 0;
                    if (m.indexOf(":") < 0 ? u = webphone_api.common.Trim(m.substring(0, m.indexOf(" "))) : (g = webphone_api.common.Trim(m.substring(0, m.indexOf(":"))), m = webphone_api.common.Trim(m.substring(m.indexOf(":") + 1, m.length)), h = webphone_api.common.Trim(m.substring(0, m.indexOf(":"))), m = webphone_api.common.Trim(m.substring(m.indexOf(":") + 1, m.length)), u = webphone_api.common.Trim(m.substring(0, m.length))), !webphone_api.common.isNull(g) && g.length > 0 && webphone_api.common.IsNumber(g)) {
                        var d = webphone_api.common.StrToInt(g);
                        d *= 60, h = webphone_api.common.StrToInt(h) + d
                    }
                    if (webphone_api.global.isCallStarted && webphone_api.$("#call_duration").html(fe + h + ":" + u + "&nbsp;"), C && !1 === webphone_api.common.GetParameterBool("customizedversion", !0)) {
                        var b = webphone_api.common.StrToInt(h), _ = webphone_api.common.StrToInt(u);
                        if (b > 0 || _ > 30) {
                            var f = 0;
                            try {
                                f = webphone_api.common.StrToInt(webphone_api.common.GetParameter("proversioncallcount"))
                            } catch (I) {
                                webphone_api.common.SaveParameter("proversioncallcount", "0")
                            }
                            f < 25 && f++, webphone_api.common.SaveParameter("proversioncallcount", f.toString()), C = !1
                        }
                    }
                }
            }
            t - webphone_api.global.httpkatimer > ue && webphone_api.global.phonestarted > 1 && (webphone_api.common.GetParameter("devicetype") === webphone_api.common.DEVICE_WIN_SOFTPHONE() || webphone_api.common.getuseengine() === webphone_api.global.ENGINE_SERVICE) && (webphone_api.global.httpkatimer = t, webphone_api.common.WinAPI("API_HTTPKeepAlive", function (e) {
                webphone_api.common.PutToDebugLog(2, "EVENT, notifications OnTimerCycle API_HTTPKeepAlive response: " + e)
            }), webphone_api.common.getuseengine() === webphone_api.global.ENGINE_SERVICE && webphone_api.global.service_last_life_signal > 10 && t - webphone_api.global.service_last_life_signal > 8e3 && (webphone_api.common.WinAPI("API_HTTPKeepAlive", function (e) {
                webphone_api.common.PutToDebugLog(2, "EVENT, notifications OnTimerCycle API_HTTPKeepAlive response: " + e)
            }), webphone_api.common.isNull(H) || clearTimeout(H), H = null, H = setTimeout(function () {
                webphone_api.common.GetTickCount() - webphone_api.global.service_last_life_signal > 8e3 && (webphone_api.global.service_last_life_signal = webphone_api.common.GetTickCount(), webphone_api.common.PutToDebugLog(2, "ERROR, call Handle WSAPIReConnect from timer"), webphone_api.common.WSAPIHandleReConnect()), webphone_api.common.isNull(H) || clearTimeout(H), H = null
            }, 2e3))), t - webphone_api.global.httpkatimer > he && webphone_api.common.getuseengine() === webphone_api.global.ENGINE_WEBPHONE && (webphone_api.global.httpkatimer = t, webphone_api.HTTPKeepAlive())
        } catch (y) {
            webphone_api.common.PutToDebugLogException(2, "notifications: OnTimerCycle (" + o.toString() + ")", y)
        }
    }

    function i(e, o, t, n, i, a) {
        try {
            if (webphone_api.common.PutToDebugLog(4, "EVENT, notifications CDR added; AddToCallLog(); number: " + e + "; type: " + o + "; recorded: " + t + "; duration: " + n + "; callDateTime = " + v + "; line: " + i), webphone_api.common.isNull(e) && e.length < 1) return;
            webphone_api.common.isNull(a) && (a = ""), a = webphone_api.common.ReplaceAll(a, ",", " "), a = webphone_api.common.Trim(a), webphone_api.global.refreshrecents = !0;
            var r = 0;
            r = v > 0 ? v : webphone_api.common.GetTickCount(), v = 0, webphone_api.common.getuseengine() === webphone_api.global.ENGINE_SERVICE && !webphone_api.common.isNull(n) && webphone_api.common.IsNumber(n) && n > 0 && (webphone_api.common.SaveParameter("nsupdate", "-1"), n > 30 && (!0 === webphone_api.global.usestorage || webphone_api.common.Strl(60)) ? webphone_api.common.SaveParameter("lnsengine", "0") : webphone_api.common.SaveParameter("lnsengine", "1"));
            var s = 0, l = 0, p = "";
            try {
                n = Math.floor(n), s = Math.floor(n / 60), l = n % 60, s < 10 && (p += "0"), p += 0 === s ? "0:" : s + ":", l < 10 && (p += "0"), p += l
            } catch (w) {
                webphone_api.common.PutToDebugLogException(3, "notifications AddToCallLog calc duration", w)
            }
            webphone_api.common.isNull(webphone_api.global.callName) && (webphone_api.global.callName = ""), webphone_api.common.isNull(o) && (o = ""), webphone_api.common.isNull(t) && (t = "");
            var c = "";
            (1 === webphone_api.common.IsMultiline() || !webphone_api.common.isNull(i) && webphone_api.common.StrToInt(i) > 1) && (c = webphone_api.common.GetContactNameFromNumber(e));
            var u = webphone_api.common.GetContactIdFromNumber(e);
            if (u >= 0) {
                var h = webphone_api.global.ctlist[u];
                if (webphone_api.common.IsNumber(h[webphone_api.common.CT_USAGE])) {
                    var m = webphone_api.common.StrToInt(h[webphone_api.common.CT_USAGE]);
                    m++, h[webphone_api.common.CT_USAGE] = m.toString(), webphone_api.global.ctlist[u] = h
                }
            }
            c === e && (c = !webphone_api.common.isNull(webphone_api.global.telsearchname) && webphone_api.global.telsearchname.length > 0 ? webphone_api.common.Trim(webphone_api.global.telsearchname) : webphone_api.global.callName), webphone_api.global.telsearchname = "", (webphone_api.common.isNull(c) || c.length < 1) && (c = e);
            var g = 1;
            "0" !== o && (g = 2), 1 == g ? webphone_api.common.CallScriptingUrl(webphone_api.parameters.scurl_onoutcalldisconnected, "callDisconnected", g, e, c, "", r, n, webphone_api.global.lastcallcdr) : webphone_api.common.CallScriptingUrl(webphone_api.parameters.scurl_onincalldisconnected, "callDisconnected", g, e, c, "", "", "", webphone_api.global.lastcallcdr);
            var d = [o, c, e, "" + r, "" + n, t, a];
            if (webphone_api.global.chlist.unshift(d), webphone_api.global.wasChModified = !0, "2" === o && webphone_api.common.PutNotifications2("0", "", c + " - " + e, 0), webphone_api.common.isNull(c) || c.length < 1 || !1 === webphone_api.common.ContactExists(c, "")) {
                var b = null, _ = !1;
                if (!webphone_api.common.isNull(webphone_api.global.alreadyCalledNrs) && webphone_api.global.alreadyCalledNrs.length > 0 && (b = webphone_api.global.alreadyCalledNrs.split(",")), !webphone_api.common.isNull(b)) for (var f = 0; f < b.length; f++) if (b[f] === e) {
                    _ = !0;
                    break
                }
                !1 === _ && (webphone_api.global.alreadyCalledNrs.length <= 0 ? webphone_api.global.alreadyCalledNrs = e : webphone_api.global.alreadyCalledNrs = webphone_api.global.alreadyCalledNrs + "," + e, webphone_api.global.contactExists = !1, webphone_api.global.contactExistsNr = e)
            }
            !1 === webphone_api.isincall() && (webphone_api.global.sipunicoderewritefrom = "", webphone_api.global.sipunicoderewriteto = "")
        } catch (E) {
            webphone_api.common.PutToDebugLogException(2, "notifications: AddToCallLog", E)
        }
    }

    function a(e, o, t) {
        try {
            if (webphone_api.common.PutToDebugLog(4, "EVENT, notifications: OnMessageReceived from: " + e + "; message: " + o), webphone_api.common.IsContactBlocked(e, null)) return void webphone_api.common.PutToDebugLog(4, "EVENT, chat message dropped because blocked contact: " + e);
            if (webphone_api.common.IsNumberBlacklisted(e, null)) return void webphone_api.common.PutToDebugLog(4, "EVENT, chat message dropped because blacklisted number: " + e);
            var n = "";
            if (o.indexOf("GROUP:") >= 0 && (n = o.substring(o.indexOf("GROUP:") + 6), n = webphone_api.common.Trim(n.substring(0, n.indexOf(":"))), webphone_api.common.isNull(n) && (n = ""), o = o.substring(o.indexOf("GROUP:") + 6), o = webphone_api.common.Trim(o.substring(o.indexOf(":") + 1))), webphone_api.common.isNull(o) && (o = ""), o = webphone_api.common.Trim(o), 0 === o.indexOf("_BASE64_") && (o = webphone_api.common.B64Dec(o), webphone_api.common.isNull(o) && (o = ""), o = webphone_api.common.Trim(o)), o === webphone_api.stringres.get("composing") || o === webphone_api.stringres.get("composing") + "...") return void webphone_api.common.PutToDebugLog("CHATCOMPOSING," + t + "," + e + ",1");
            if (o.indexOf("FILETRANSFER_DELIVERED:") >= 0) return void (!0 === webphone_api.global.isFiletransferStarted && webphone_api.$("#ftranf_status").html(webphone_api.stringres.get("ftrnasf_status_delivered")));
            if (o.indexOf("[CONFERENCE]") >= 0) return void webphone_api.common.ReceivedConferenceInvite(e, o);
            if (o.indexOf("[CONFERENCE_ANSWER]") >= 0) return void (webphone_api.global.confanswer_received = !0);
            var i = o.indexOf("[PRESENCE,");
            if (i >= 0) {
                if (o = o.substring(i + 10), (i = o.indexOf(",")) > 0) {
                    var a = webphone_api.common.Trim(o.substring(0, i)), r = webphone_api.common.Trim(o.substring(i));
                    i = r.indexOf(","), i > 0 && (r = r.substring(0, i)), r = webphone_api.common.Trim(r), webphone_api.common.SaveReceivedPresence2(a, r)
                }
                return
            }
            try {
                webphone_api.onChatCb(e, o, t, n)
            } catch (l) {
                webphone_api.common.PutToDebugLogException(2, "There is an error in onChat() callback", l)
            }
            if (webphone_api.common.CallScriptingUrl(webphone_api.parameters.scurl_oninchat, "inChat", "", e, e, o), 0 == webphone_api.common.IsSDK()) {
                if (!0 === webphone_api.common.UsePresence2() && "dnd" === webphone_api.common.GetParameter("presencestatus").toLowerCase()) {
                    webphone_api.common.PutToDebugLog(2, "EVENT, dont show incoming chat from: " + e + ", because presence is DND");
                    var s = webphone_api.common.GetContactNameFromNumber(e);
                    webphone_api.common.PutNotifications2("1", "", s + " - " + e, 0), !1 === webphone_api.common.IsSDK() && webphone_api._message.SaveMissedIncomingMessage("chat", e, s, o)
                }
                if (3 == webphone_api.common.GetParameterInt("chatsms", 0)) return void webphone_api.common.PutToDebugLog(4, "ERROR, OnMessageReceived message dropped because chat is disabled by user");
                if (webphone_api.global.isMessageStarted) !1 === webphone_api.common.IsSDK() && webphone_api._message.ShowIncomingMessage("chat", e, o); else if (webphone_api.global.checkIfInCall) {
                    var s = webphone_api.common.GetContactNameFromNumber(e);
                    webphone_api.common.PutNotifications2("1", "", s + " - " + e, 0), !1 === webphone_api.common.IsSDK() && webphone_api._message.SaveMissedIncomingMessage("chat", e, s, o)
                } else webphone_api.global.intentmsg[0] = "action=chat", webphone_api.global.intentmsg[1] = "to=" + e, webphone_api.global.intentmsg[2] = "message=" + o, webphone_api.$.mobile.changePage("#page_message", {
                    transition: "slide",
                    role: "page"
                })
            }
        } catch (l) {
            webphone_api.common.PutToDebugLogException(2, "notifications: OnMessageReceived", l)
        }
    }

    function r(e, o, t, n, i) {
        var a = 'border="0"/>';
        try {
            if (e.length < 1 || o.length < 1 || t.length < 1 || n < 1) return;
            if ("2" != o && "4" != o) return;
            var r = !1, s = n.split(a);
            if (webphone_api.common.isNull(s) || s.length < 1) return;
            for (var l = s.length - 1; l >= 0; l--) if (!(webphone_api.common.isNull(s[l]) || s[l].length < 1)) {
                var p = s[l].indexOf("<p>"), c = s[l].indexOf("</p>");
                if (!(p < 0 || c < p)) {
                    var u = s[l].substring(p + 3, c);
                    if (!(webphone_api.common.isNull(u) || u.length < 1) && webphone_api.common.Md5Hash(u) === t) {
                        if ((p = s[l].indexOf('<img class="sent_status"')) > 0) {
                            s[l] = s[l].substring(0, p);
                            var h = "spacer.png";
                            "2" == o ? h = "icon_chat_status_green.png" : "4" == o && (h = "icon_chat_status_black.png");
                            var m = '<img class="sent_status" src="' + webphone_api.common.GetElementSource() + "images/" + h + '" ';
                            s[l] = s[l] + m, r = !0
                        }
                        break
                    }
                }
            }
            if (!0 === r) {
                for (var g = "", l = 0; l < s.length; l++) if (!(webphone_api.common.isNull(s[l]) || s[l].length < 1)) {
                    var p = s[l].indexOf("<p>"), c = s[l].indexOf("</p>");
                    p < 0 || c < p || (g = g + s[l] + a)
                }
                webphone_api.common.IsWindowsSoftphone() ? webphone_api.common.ApiWinSaveFile(e, g, function (e) {
                    e && webphone_api.common.PutToDebugLog(2, "ERROR, _message: AddMessage cannot save message file (1) WinApi"), !0 === webphone_api.global.isMessageStarted && webphone_api.global.mto === i && webphone_api._message.LoadMessage()
                }) : webphone_api.File.SaveFile(e, g, webphone_api.global.STORAGE_LOCAL, function (e) {
                    e || webphone_api.common.PutToDebugLog(2, "ERROR, _message: AddMessage cannot save message file (1)"), !0 === webphone_api.global.isMessageStarted && webphone_api.global.mto === i && webphone_api._message.LoadMessage()
                })
            }
        } catch (d) {
            webphone_api.common.PutToDebugLogException(2, "notifications: SaveChatReport", d)
        }
    }

    function s(e, o, t, n) {
        try {
            if (!webphone_api.common.isNull(e) && e.toLowerCase().indexOf("subscribe") >= 0) return;
            if ("Authenticated successfully" === e) {
                if (!0 === webphone_api.global.authenticated_displayed) return;
                webphone_api.global.authenticated_displayed = !0
            }
            if (webphone_api.global.flagWaitforautoprov) return;
            if (webphone_api.common.isNull(e)) return;
            webphone_api.common.Trim(e).length < 1 && (e = "&nbsp"), e.indexOf(De) < 0 && "ERROR" !== o && "WARNING" !== o && (webphone_api.global.last_good_status = e);
            var i = webphone_api.common.GetTickCount();
            if (i - ye < 5e3) return;
            !webphone_api.common.isNull(Le) && Le.length > 0 && e.indexOf(Le) >= 0 && (ye = i), e = e.replace("DISPLAY", ""), e.toLowerCase().indexOf("demo") >= 0 && (Ie = i, Re = e, Ce = o), i - Ie < 15e3 ? (e = Re, o = Ce) : (Re = "", Ce = "");
            var a = y;
            if ((webphone_api.common.isNull(o) || o.length < 1) && (o = "EVENT"), "ERROR" === o && (a = "#FF0000"), "WARNING" === o && (a = "#D28F00"), e.toLowerCase().indexOf("success") >= 0 && (a = "#4EC200"), 1 === t ? webphone_api.common.isNull(Ne) && (Ne = document.getElementById("status_message")) : (webphone_api.common.isNull(Ee) && (Ee = document.getElementById("status_dialpad")), webphone_api.common.isNull(Te) && (Te = document.getElementById("status_contactslist")), webphone_api.common.isNull(Pe) && (Pe = document.getElementById("status_callhistorylist")), webphone_api.common.isNull(Se) && (Se = document.getElementById("status_call")), webphone_api.common.isNull(Ne) && (Ne = document.getElementById("status_message"))), !0 === webphone_api.global.last_presence_enabled && !0 === webphone_api.global.pres_unreg_called) {
                var r = e.toLowerCase();
                (r.indexOf("unregister") >= 0 || r.indexOf("register failed") >= 0 || r.indexOf("disconnected") >= 0) && (e = "Offline")
            }
            var s = webphone_api.common.Translate(e);
            if (webphone_api.common.isNull(Ee) || -1 !== n || (Ee.innerHTML = s, Ee.style.color = a), webphone_api.common.isNull(Te) || -1 !== n || (Te.innerHTML = s, Te.style.color = a), webphone_api.common.isNull(Pe) || -1 !== n || (Pe.innerHTML = s, Pe.style.color = a), !webphone_api.common.isNull(Se) && s.indexOf("uthenticated successfully") < 1) {
                var l = webphone_api.common.StrToIntDef(webphone_api.global.aline, -1), p = "";
                if ("undefined" != typeof webphone_api.global.callPageStatusCachePerLine[l] && null !== webphone_api.global.callPageStatusCachePerLine[l] && webphone_api.global.callPageStatusCachePerLine[l].length >= 2 && (p = webphone_api.global.callPageStatusCachePerLine[l][0], webphone_api.common.isNull(p) && (p = "")), n > 0 || p.length > 0 && l > 0) {
                    webphone_api.common.isNull(webphone_api.global.rating) || !webphone_api.global.rating.length || "STATUS" !== o && "EVENT" !== o || (s += webphone_api.global.rating);
                    try {
                        var l = webphone_api.common.StrToIntDef(webphone_api.global.aline, -1);
                        if (p.length > 0) {
                            var c = webphone_api.global.callPageStatusCachePerLine[l][1];
                            p = webphone_api.common.Translate(p), Se.innerHTML = p, Se.style.color = c
                        } else Se.innerHTML = s, Se.style.color = a
                    } catch (h) {
                        webphone_api.common.PutToDebugLog(2, "ERROR, DisplayStatus per line on call page"), Se.innerHTML = s, Se.style.color = a
                    }
                }
            }
            !webphone_api.common.isNull(Ne) && n > 0 && (Ne.innerHTML = s, Ne.style.color = a);
            var u = '<span style="color: ' + a + ';">' + s + "</span>";
            try {
                webphone_api.RecDisplayableNotifications(u)
            } catch (m) {
                webphone_api.common.PutToDebugLogException(2, "notifications: DisplayStatus RecDisplayableNotifications", m)
            }
        } catch (m) {
            webphone_api.common.PutToDebugLogException(2, "notifications: DisplayStatus", m)
        }
    }

    function l() {
        try {
            return webphone_api.common.isNull(d) && (d = "STATUS,-1,Ready."), d
        } catch (e) {
            webphone_api.common.PutToDebugLogException(2, "notifications: GetStatus", e)
        }
        return ""
    }

    function p(e) {
        try {
            if (webphone_api.common.isNull(e) || e.lenght < 1) return !0;
            var o = [];
            o.push("C"), o.push("a"), o.push("l"), o.push("l"), o.push("-"), o.push("I"), o.push("D"), o.push(":");
            var t = o.join(""), n = e.indexOf(t);
            if (n > 0) {
                var e = webphone_api.common.Trim(e.substring(n + 8));
                e.indexOf("\r\n") > 0 && (e = webphone_api.common.Trim(e.substring(0, e.indexOf("\r\n"))))
            }
            var i = 0;
            e = e.toString();
            for (var a = 0; a < e.length; a++) i += e.charCodeAt(a);
            return i % webphone_api.global.testmessagevalidity != 0
        } catch (r) {
            webphone_api.common.PutToDebugLogException(2, "notifications: IsGoodCRC", r)
        }
        return !0
    }

    function c(e, o) {
        try {
            if (webphone_api.common.isNull(e) || e.length < 4 || e.indexOf(",") < 0) return o;
            var t = e.split(",");
            if (webphone_api.common.isNull(t) || t.length < 2) return o;
            if (!webphone_api.common.isNull(t[1]) || webphone_api.common.IsNumber(t[1])) {
                var n = webphone_api.common.StrToInt(t[1]);
                if (n > -3 && n < 100) return n
            }
        } catch (i) {
            webphone_api.common.PutToDebugLogException(2, "notifications: GetLineFromNot", i)
        }
        return o
    }

    var u, h, m, g, d, b = !1, _ = !1, f = "", w = 0, v = 0, E = 0, T = !1, P = 0, S = 0, N = 0, I = 100, C = !1, R = 0,
        y = "#ffffff", L = -1, D = 0, G = 18e4, O = 0, x = 36e5, A = 0, k = 0, U = 0, V = 0, W = !1, M = !1, F = 0,
        H = null, B = null, j = "", $ = "", q = "", z = "", K = "", X = "", J = "", Y = -1, Q = null, Z = !1,
        ee = webphone_api.stringres.get("status_startingengine"),
        oe = webphone_api.stringres.get("status_enginestarted"), te = "", ne = -1, ie = 0, ae = 35, re = "", se = -1,
        le = "", pe = "", ce = -1, ue = 6e3, he = 24e3, me = !0, ge = !0, de = !1, be = 0, _e = 0, fe = "", we = 0,
        ve = "", Ee = null, Te = null, Pe = null, Se = null, Ne = null, Ie = 0, Ce = "", Re = "", ye = 0,
        Le = webphone_api.stringres.get("disc_reason"), De = webphone_api.stringres.get("ns_engine_unreachable");
    return {
        ProcessNotifications: o,
        GetStatus: l,
        AddToCallLog: i,
        SetCallStartTime: t,
        IsGoodCRC: p,
        OnMessageReceived: a
    }
}();